## <a name="repeatability-during-copy"></a>Επαναληψιμότητα κατά την αντιγραφή

Κατά την αντιγραφή δεδομένων σε Azure SQL/SQL Server από άλλα δεδομένα αποθηκεύει ένα πρέπει να έχετε επαναληψιμότητας υπόψη σας για να αποφύγετε τα ανεπιθύμητα αποτελέσματα. 

Κατά την αντιγραφή δεδομένων σε βάση δεδομένων SQL/SQL Server Azure, θα αντίγραφο δραστηριότητα από προεπιλογή ΠΡΟΣΆΡΤΗΣΗΣ το σύνολο δεδομένων στον πίνακα δέκτη από προεπιλογή. Για παράδειγμα, κατά την αντιγραφή δεδομένων από μια προέλευση αρχείου CSV (τιμές διαχωρισμένες με κόμμα τιμές δεδομένων) που περιέχει δύο εγγραφών σε βάση δεδομένων SQL/SQL Server Azure, αυτή είναι η εμφάνιση του πίνακα, όπως:
    
    ID  Product     Quantity    ModifiedDate
    ... ...         ...         ...
    6   Flat Washer 3           2015-05-01 00:00:00
    7   Down Tube   2           2015-05-01 00:00:00

Ας υποθέσουμε ότι βρέθηκαν σφάλματα στο αρχείο προέλευσης και ενημέρωση την ποσότητα των προς τα κάτω σωλήνα από 2 έως 4 στο αρχείο προέλευσης. Εάν εκτελείτε εκ νέου τη φέτα δεδομένων για τη συγκεκριμένη περίοδο, θα βρείτε δύο νέες εγγραφές προσαρτημένο σε βάση δεδομένων SQL/SQL Server Azure. Το παρακάτω προϋποθέτει ότι καμία από τις στήλες του πίνακα έχει τον περιορισμό πρωτεύοντος κλειδιού.
    
    ID  Product     Quantity    ModifiedDate
    ... ...         ...         ...
    6   Flat Washer 3           2015-05-01 00:00:00
    7   Down Tube   2           2015-05-01 00:00:00
    6   Flat Washer 3           2015-05-01 00:00:00
    7   Down Tube   4           2015-05-01 00:00:00

Για να αποφύγετε κάτι τέτοιο, θα πρέπει να καθορίσετε σημασιολογία UPSERT κεντρικά χρησιμοποιώντας μία από την κάτω από το 2 μηχανισμούς αναφέρονται παρακάτω.

> [AZURE.NOTE] Μια φέτα μπορεί να εκ νέου εκτελεστεί αυτόματα στο Azure εργοστασίου δεδομένων σύμφωνα με την πολιτική "Επανάληψη" που καθορίζεται.

### <a name="mechanism-1"></a>Μηχανισμός 1

Μπορείτε να αξιοποιήσετε την ιδιότητα **sqlWriterCleanupScript** για την πρώτη ενέργεια εκκαθάρισης κατά την εκτέλεση μιας φέτα. 

    "sink":  
    { 
      "type": "SqlSink", 
      "sqlWriterCleanupScript": "$$Text.Format('DELETE FROM table WHERE ModifiedDate >= \\'{0:yyyy-MM-dd HH:mm}\\' AND ModifiedDate < \\'{1:yyyy-MM-dd HH:mm}\\'', WindowStart, WindowEnd)"
    }

Μπορεί να εκτελεστεί η δέσμη ενεργειών εκκαθάριση πρώτη κατά την αντιγραφή για μια δεδομένη φέτα που θέλετε να διαγράψετε τα δεδομένα από τον πίνακα SQL που αντιστοιχεί σε αυτήν τη φέτα. Η δραστηριότητα στη συνέχεια θα εισαγάγει τα δεδομένα στον πίνακα SQL. 

Εάν στη φέτα είναι τώρα, εκτελέστε ξανά, στη συνέχεια, που θα βρείτε την ποσότητα ενημερώνεται ως επιθυμητοί.
    
    ID  Product     Quantity    ModifiedDate
    ... ...         ...         ...
    6   Flat Washer 3           2015-05-01 00:00:00
    7   Down Tube   4           2015-05-01 00:00:00

Ας υποθέσουμε ότι η εγγραφή επίπεδο ροδέλας καταργείται από το αρχικό csv. Στη συνέχεια, Επανεκτέλεση στη φέτα θα δημιουργήσουν το εξής αποτέλεσμα: 
    
    ID  Product     Quantity    ModifiedDate
    ... ...         ...         ...
    7   Down Tube   4           2015-05-01 00:00:00

Τίποτα νέα έπρεπε να γίνουν. Η δραστηριότητα αντίγραφο εκτελέσατε τη δέσμη ενεργειών εκκαθάριση για να διαγράψετε τα αντίστοιχα δεδομένα για αυτήν τη φέτα. Στη συνέχεια, να διαβάσει το εισόδου από το csv (το οποίο, στη συνέχεια, που περιέχονται μόνο 1 record) και εισάγονται στον πίνακα. 

### <a name="mechanism-2"></a>Μηχανισμός 2
> [AZURE.IMPORTANT] sliceIdentifierColumnName δεν υποστηρίζεται για αποθήκη δεδομένων του SQL Azure αυτήν τη στιγμή. 

Ένας άλλος μηχανισμός για την επίτευξη επαναληψιμότητας είναι χρειάζεται μια αποκλειστική στήλη (**sliceIdentifierColumnName**) στον πίνακα προορισμού. Η στήλη αυτή θα χρησιμοποιηθεί από προέλευση δεδομένων του Azure για να βεβαιωθείτε ότι συγχρονισμένες προέλευσης και προορισμού. Αυτή η προσέγγιση λειτουργεί όταν υπάρχει ευελιξία στη αλλαγής ή τον καθορισμό της διάταξης πίνακα SQL προορισμού. 

Αυτή η στήλη μπορεί να χρησιμοποιηθεί από Azure εργοστασίου δεδομένων για σκοπούς επαναληψιμότητας και της διαδικασίας εργοστασίου δεδομένων Azure θα δεν κάντε τις αλλαγές σχήματος στον πίνακα. Τρόπος για να χρησιμοποιήσετε αυτήν την προσέγγιση:

1.  Να ορίσετε μια στήλη τύπου δυαδικό (32) με τον προορισμό πίνακα SQL. Πρέπει να υπάρχει χωρίς περιορισμούς σε αυτήν τη στήλη. Ας Δώστε όνομα σε αυτήν τη στήλη ως 'ColumnForADFuseOnly' για αυτό το παράδειγμα.
2.  Χρησιμοποιήστε το στη δραστηριότητα Αντιγραφή ως εξής:

        "sink":  
        { 
          "type": "SqlSink", 
          "sliceIdentifierColumnName": "ColumnForADFuseOnly"
        }

Azure εργοστασιακές δεδομένων θα συμπληρώσετε αυτήν τη στήλη σύμφωνα με την ανάγκη για να βεβαιωθείτε ότι συγχρονισμένες προέλευσης και προορισμού. Οι τιμές αυτής της στήλης δεν πρέπει να χρησιμοποιείται εκτός του περιβάλλοντος σε αυτό από το χρήστη. 

Παρόμοια με μηχανισμό 1, δραστηριότητας αντίγραφο θα αυτόματα πρώτα να εκκαθαρίσετε τα δεδομένα για τη δεδομένη φέτα από τον προορισμό πίνακα SQL και, στη συνέχεια, εκτελέστε τη δραστηριότητα αντίγραφο κανονικά για να εισαγάγετε τα δεδομένα από προέλευση στον προορισμό για αυτήν τη φέτα. 
