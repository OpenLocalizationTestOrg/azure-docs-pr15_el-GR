<properties
    pageTitle="Χρήση χώρος αποθήκευσης αντικειμένων blob για αποθήκευση των υπηρεσιών IIS και πίνακα για συμβάντα | Microsoft Azure"
    description="Αρχείο καταγραφής ανάλυσης να διαβάσετε τα αρχεία καταγραφής για Azure υπηρεσίες που Γράψτε Διαγνωστικά στο χώρο αποθήκευσης πινάκων ή αρχεία καταγραφής των υπηρεσιών IIS εγγραφεί στο χώρο αποθήκευσης blob."
    services="log-analytics"
    documentationCenter=""
    authors="bandersmsft"
    manager="jwhit"
    editor=""/>

<tags
    ms.service="log-analytics"
    ms.workload="na"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/25/2016"
    ms.author="banders"/>


# <a name="using-blob-storage-for-iis-and-table-storage-for-events"></a>Χρήση χώρος αποθήκευσης αντικειμένων blob για τις υπηρεσίες IIS και χώρος αποθήκευσης πινάκων για συμβάντα

Αρχείο καταγραφής ανάλυσης να διαβάσετε τα αρχεία καταγραφής για τις ακόλουθες υπηρεσίες που γράψετε Διαγνωστικά στο χώρο αποθήκευσης πινάκων ή αρχεία καταγραφής των υπηρεσιών IIS εγγραφεί στο χώρο αποθήκευσης blob:

+ Υπηρεσία υφάσματος συμπλεγμάτων (έκδοση Preview)
+ Εικονικές μηχανές
+ Ρόλοι Web/εργαζόμενου

Πριν από την ανάλυση καταγραφής μπορεί να συλλέξει δεδομένα για αυτούς τους πόρους, πρέπει να ενεργοποιηθεί Azure Διαγνωστικά.

Όταν είναι ενεργοποιημένες Διαγνωστικά, μπορείτε να χρησιμοποιήσετε την πύλη του Azure ή PowerShell, ρύθμιση παραμέτρων καταγραφής αναλυτικών στοιχείων για τη συλλογή των αρχείων καταγραφής.

Διαγνωστικά του Azure είναι μια επέκταση Azure που σας επιτρέπει να συλλογή διαγνωστικών δεδομένων από ένα ρόλο εργαζόμενου, ρόλο web ή εικονική μηχανή εκτελείται στο Azure. Τα δεδομένα αποθηκεύονται σε ένα λογαριασμό Azure χώρου αποθήκευσης και, στη συνέχεια, μπορούν να συλλέγονται με ανάλυση καταγραφής.

Για το αρχείο καταγραφής αναλυτικών στοιχείων για τη συλλογή αυτά τα αρχεία καταγραφής διαγνωστικών Azure, πρέπει να είναι τα αρχεία καταγραφής στις ακόλουθες θέσεις:

| Τύπος αρχείου καταγραφής | Τύπος πόρου | Θέση |
| -------- | ------------- | -------- |
| Αρχεία καταγραφής των υπηρεσιών IIS | Εικονικές μηχανές <br> Ρόλοι Web <br> Ρόλοι εργαζόμενου | wad-των υπηρεσιών iis-logfiles (χώρος αποθήκευσης αντικειμένων Blob) |
| SYSLOG | Εικονικές μηχανές | LinuxsyslogVer2v0 (πίνακα χώρο αποθήκευσης) |
| Υπηρεσία υφάσματος λειτουργικές συμβάντα | Οι κόμβοι ύφασμα υπηρεσίας | WADServiceFabricSystemEventTable |
| Υπηρεσία ύφασμα αξιόπιστη παράγοντα συμβάντα | Οι κόμβοι ύφασμα υπηρεσίας | WADServiceFabricReliableActorEventTable |
| Υπηρεσία ύφασμα αξιόπιστη υπηρεσία συμβάντα | Οι κόμβοι υφάσματος υπηρεσίας | WADServiceFabricReliableServiceEventTable |
| Αρχεία καταγραφής συμβάντων των Windows | Οι κόμβοι ύφασμα υπηρεσίας <br> Εικονικές μηχανές <br> Ρόλοι Web <br> Ρόλοι εργαζόμενου | WADWindowsEventLogsTable (χώρος αποθήκευσης πινάκων) |
| Αρχεία καταγραφής των Windows ETW | Οι κόμβοι ύφασμα υπηρεσίας <br> Εικονικές μηχανές <br> Ρόλοι Web <br> Ρόλοι εργαζόμενου | WADETWEventTable (χώρος αποθήκευσης πινάκων) |

>[AZURE.NOTE] Αρχεία καταγραφής των υπηρεσιών IIS από τοποθεσίες Web Azure δεν υποστηρίζονται αυτήν τη στιγμή.

Για εικονικές μηχανές, έχετε την επιλογή την εγκατάσταση του τον [παράγοντα ανάλυση καταγραφής](log-analytics-azure-vm-extension.md) σε την εικονική μηχανή σας για να ενεργοποιήσετε την επιπλέον ιδέες. Εκτός από τη δυνατότητα να αναλύσετε τα αρχεία καταγραφής των υπηρεσιών IIS και αρχεία καταγραφής συμβάντων, μπορείτε να πραγματοποιήσετε επιπλέον ανάλυση, συμπεριλαμβανομένης της παρακολούθησης αλλαγών ρύθμισης παραμέτρων, εκτίμηση SQL και ενημέρωση αξιολόγησης.

## <a name="enable-azure-diagnostics-in-a-virtual-machine-for-event-log-and-iis-log-collection"></a>Ενεργοποίηση Azure Διαγνωστικά σε μια εικονική μηχανή για το αρχείο καταγραφής συμβάντων και των υπηρεσιών IIS καταγραφής συλλογής

Χρησιμοποιήστε την ακόλουθη διαδικασία για να ενεργοποιήσετε την Azure Διαγνωστικά σε μια εικονική μηχανή για το αρχείο καταγραφής συμβάντων και των υπηρεσιών IIS συλλογή αρχείων καταγραφής με την πύλη Microsoft Azure.

### <a name="to-enable-azure-diagnostics-in-a-virtual-machine-with-the-azure-portal"></a>Για να ενεργοποιήσετε την Azure Διαγνωστικά σε μια εικονική μηχανή με την πύλη του Azure

1. Εγκαταστήστε τον παράγοντα Εικονική όταν δημιουργείτε μια εικονική μηχανή. Εάν η εικονική μηχανή υπάρχει ήδη, επαληθεύστε ότι ο παράγοντας Εικονική είναι ήδη εγκατεστημένο.
    - Στην πύλη του Azure, μεταβείτε στην εικονική μηχανή της, επιλέξτε **Προαιρετικών παραμέτρων**, στη συνέχεια, **Διαγνωστικά** και ορισμός της **κατάστασής** σε **σε**.

    Μετά την ολοκλήρωση, η Εικονική περιλαμβάνει την επέκταση Διαγνωστικά Azure εγκατασταθεί και εκτελείται. Αυτή η επέκταση είναι υπεύθυνη για τη συλλογή των δεδομένων σας Διαγνωστικά.

2. Ενεργοποίηση παρακολούθησης και ρύθμιση παραμέτρων καταγραφής σε μια υπάρχουσα Εικονική συμβάντων. Μπορείτε να ενεργοποιήσετε Διαγνωστικά στο επίπεδο Εικονική. Για να ενεργοποιήσετε εργαλεία διαγνωστικού ελέγχου και, στη συνέχεια, ρύθμιση παραμέτρων καταγραφής συμβάντων, εκτελέστε τα ακόλουθα βήματα:
    1. Επιλέξτε την εικονική Μηχανή.
    2. Κάντε κλικ στην επιλογή **Παρακολούθηση**.
    3. Κάντε κλικ στην επιλογή **Διαγνωστικά**.
    4. Ορισμός της **κατάστασης** σε **Ενεργοποιηση**.
    5. Επιλέξτε κάθε αρχείο καταγραφής διαγνωστικών που θέλετε να συλλέξετε.
    7. Κάντε κλικ στο **κουμπί OK**.

Χρήση του Azure PowerShell μπορείτε να καθορίσετε ακόμη μεγαλύτερη ακρίβεια τα συμβάντα που έχουν δημιουργηθεί με το χώρο αποθήκευσης Azure. Αναφορά για τη [συλλογή δεδομένων με χρήση Azure Διαγνωστικά εγγραφεί στο χώρο αποθήκευσης πινάκων ή αρχεία καταγραφής των υπηρεσιών IIS γραμμένο σε αντικειμένων blob](log-analytics-azure-storage-json.md).


## <a name="enable-azure-diagnostics-in-a-web-role-for-iis-log-and-event-collection"></a>Ενεργοποίηση Azure Διαγνωστικά σε ένα ρόλο Web για τη συλλογή καταγραφής και συμβάντων των υπηρεσιών IIS

Ανατρέξτε [Πώς να ενεργοποιήσετε Διαγνωστικά σε μια υπηρεσία Cloud](../cloud-services/cloud-services-dotnet-diagnostics.md) για γενικά βήματα σχετικά με την ενεργοποίηση Azure Διαγνωστικά. Τις παρακάτω οδηγίες, χρησιμοποιήστε αυτές τις πληροφορίες και προσαρμόστε το για χρήση με το αρχείο καταγραφής ανάλυσης.

Με το Azure Διαγνωστικά ενεργοποιημένη:

- Αρχεία καταγραφής των υπηρεσιών IIS αποθηκεύονται από προεπιλογή, με τα δεδομένα καταγραφής μεταφερθεί στο χρονικό διάστημα μεταφοράς scheduledTransferPeriod.
- Αρχεία καταγραφής συμβάντων των Windows δεν μεταβιβάζονται από προεπιλογή.

### <a name="to-enable-diagnostics"></a>Για να ενεργοποιήσετε την Διαγνωστικά

Για να ενεργοποιήσετε την αρχεία καταγραφής συμβάντων των Windows ή για να αλλάξετε το scheduledTransferPeriod, ρύθμιση παραμέτρων Διαγνωστικά Azure χρησιμοποιώντας το αρχείο ρύθμισης παραμέτρων XML (diagnostics.wadcfg), όπως φαίνεται στην [βήμα 4: Δημιουργήστε το αρχείο ρύθμισης παραμέτρων Διαγνωστικά και εγκαταστήστε την επέκταση](../cloud-services/cloud-services-dotnet-diagnostics.md)

Το παρακάτω παράδειγμα αρχείου ρύθμισης παραμέτρων συλλέγει αρχεία καταγραφής των υπηρεσιών IIS και όλα τα συμβάντα από τα αρχεία καταγραφής εφαρμογών και του συστήματος:

```
    <?xml version="1.0" encoding="utf-8" ?>
    <DiagnosticMonitorConfiguration xmlns="http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration"
          configurationChangePollInterval="PT1M"
          overallQuotaInMB="4096">

      <Directories bufferQuotaInMB="0"
         scheduledTransferPeriod="PT10M">  
        <!-- IISLogs are only relevant to Web roles -->
        <IISLogs container="wad-iis" directoryQuotaInMB="0" />
      </Directories>

      <WindowsEventLog bufferQuotaInMB="0"
         scheduledTransferLogLevelFilter="Verbose"
         scheduledTransferPeriod="PT10M">
        <DataSource name="Application!*" />
        <DataSource name="System!*" />
      </WindowsEventLog>

    </DiagnosticMonitorConfiguration>
```

Βεβαιωθείτε ότι το ConfigurationSettings καθορίζει έναν λογαριασμό χώρου αποθήκευσης, όπως στο ακόλουθο παράδειγμα:

```
    <ConfigurationSettings>
       <Setting name="Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString" value="DefaultEndpointsProtocol=https;AccountName=<AccountName>;AccountKey=<AccountKey>"/>
    </ConfigurationSettings>
```

Το **όνομα λογαριασμού** και **AccountKey** τιμών βρίσκονται στην πύλη του Azure στον πίνακα εργαλείων λογαριασμού χώρου αποθήκευσης, στην περιοχή Διαχείριση πλήκτρων πρόσβασης. Το πρωτόκολλο για τη συμβολοσειρά σύνδεσης πρέπει να είναι **https**.

Όταν έχει εφαρμοστεί τις ενημερωμένες παραμέτρους διαγνωστικών για την υπηρεσία cloud και την κάνει εγγραφή Διαγνωστικά αποθήκευσης Azure, στη συνέχεια, είστε έτοιμοι για ρύθμιση παραμέτρων του αρχείου καταγραφής ανάλυσης.


## <a name="use-the-azure-portal-to-collect-logs-from-azure-storage"></a>Χρησιμοποιήστε την πύλη του Azure για τη συλλογή αρχείων καταγραφής από το χώρο αποθήκευσης Azure

Μπορείτε να χρησιμοποιήσετε την πύλη του Azure για τη ρύθμιση παραμέτρων καταγραφής ανάλυση για να συγκεντρώσετε τα αρχεία καταγραφής για τις ακόλουθες υπηρεσίες Azure:

+ Υπηρεσία ύφασμα συμπλεγμάτων
+ Εικονικές μηχανές
+ Ρόλοι Web/εργαζόμενου

Στην πύλη του Azure, μεταβείτε στο χώρο εργασίας σας καταγραφής ανάλυσης και εκτελέστε τις ακόλουθες εργασίες:

1. Κάντε κλικ στην επιλογή *αρχεία καταγραφής λογαριασμούς χώρου αποθήκευσης*
2. Κάντε κλικ στην εργασία *Προσθήκη*
3. Επιλέξτε το λογαριασμό χώρου αποθήκευσης που περιέχει τα αρχεία καταγραφής διαγνωστικών
  - Αυτός ο λογαριασμός μπορεί να είναι είτε ένα λογαριασμό κλασική χώρου αποθήκευσης ή ένα λογαριασμό χώρου αποθήκευσης για τη διαχείριση πόρων Azure
4. Επιλέξτε τον τύπο δεδομένων που θέλετε να συλλέξετε αρχεία καταγραφής για
  - Οι επιλογές είναι αρχεία καταγραφής των υπηρεσιών IIS; Συμβάντα; SYSLOG (Linux) Αρχεία καταγραφής ETW; Υπηρεσία ύφασμα συμβάντα
5. Η τιμή για το αρχείο προέλευσης συμπληρώνεται αυτόματα με βάση τον τύπο δεδομένων και δεν μπορεί να αλλάξει
6. Κάντε κλικ στο κουμπί OK για να αποθηκεύσετε τη ρύθμιση παραμέτρων

Επαναλάβετε τα βήματα 2 έως 6 για τους λογαριασμούς επιπλέον χώρο αποθήκευσης και τους τύπους δεδομένων που θέλετε ανάλυση καταγραφής για τη συλλογή.

Σε 30 λεπτά, θα μπορείτε να δείτε τα δεδομένα από το λογαριασμό χώρου αποθήκευσης στο αρχείο καταγραφής αναλυτικών στοιχείων. Θα δείτε μόνο τα δεδομένα που είναι γραμμένο με το χώρο αποθήκευσης, μετά την εφαρμογή της ρύθμισης παραμέτρων. Αρχείο καταγραφής ανάλυσης δεν διαβάζει τα προ-υπάρχοντα δεδομένα από το λογαριασμό χώρου αποθήκευσης.

>[AZURE.NOTE] Η πύλη δεν επαληθεύει ότι η προέλευση υπάρχει στο λογαριασμό χώρου αποθήκευσης ή εάν την εγγραφή νέων δεδομένων.

## <a name="enable-azure-diagnostics-in-a-virtual-machine-for-event-log-and-iis-log-collection-using-powershell"></a>Ενεργοποίηση Azure Διαγνωστικά σε μια εικονική μηχανή για το αρχείο καταγραφής συμβάντων και των υπηρεσιών IIS καταγραφής συλλογής με χρήση του PowerShell

Χρησιμοποιήστε τα βήματα στην [Ανάλυση καταγραφής τη ρύθμιση των παραμέτρων για να δημιουργήσετε ευρετήριο Azure Διαγνωστικά](log-analytics-powershell-workspace-configuration.md#configuring-log-analytics-to-index-azure-diagnostics) χρήσης του PowerShell για να διαβάσετε από το Azure διαγνωστικά που εγγράφονται στο χώρο αποθήκευσης πινάκων.

Χρήση του Azure PowerShell μπορείτε να καθορίσετε ακόμη μεγαλύτερη ακρίβεια τα συμβάντα που έχουν δημιουργηθεί με το χώρο αποθήκευσης Azure.
Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Ενεργοποίηση Διαγνωστικά σε εικονικές μηχανές Windows Azure](../virtual-machines-dotnet-diagnostics.md).

Μπορείτε να ενεργοποιήσετε και να ενημερώσετε Azure Διαγνωστικά χρησιμοποιώντας την ακόλουθη δέσμη ενεργειών PowerShell.
Μπορείτε επίσης να χρησιμοποιήσετε αυτήν τη δέσμη ενεργειών με τη ρύθμιση παραμέτρων ενός προσαρμοσμένου καταγραφής.
Τροποποιήστε τη δέσμη ενεργειών για να ρυθμίσετε το λογαριασμό χώρου αποθήκευσης, όνομα υπηρεσίας και όνομα εικονική μηχανή.
Η δέσμη ενεργειών χρησιμοποιεί cmdlet του για κλασική εικονικές μηχανές.

Εξετάστε το παρακάτω δείγμα δέσμης ενεργειών, αντιγράψτε το, τροποποιήστε το, ανάλογα με τις ανάγκες, αποθηκεύστε το δείγμα ως αρχείο δέσμης ενεργειών του PowerShell και, στη συνέχεια, εκτελέστε τη δέσμη ενεργειών.

```
    #Connect to Azure
    Add-AzureAccount

    # settings to change:
    $wad_storage_account_name = "myStorageAccount"
    $service_name = "myService"
    $vm_name = "myVM"

    #Construct Azure Diagnostics public config and convert to config format

    # Collect just system error events:
    $wad_xml_config = "<WadCfg><DiagnosticMonitorConfiguration><WindowsEventLog scheduledTransferPeriod=""PT1M""><DataSource name=""System!* "" /></WindowsEventLog></DiagnosticMonitorConfiguration></WadCfg>"

    $wad_b64_config = [System.Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes($wad_xml_config))
    $wad_public_config = [string]::Format("{{""xmlCfg"":""{0}""}}",$wad_b64_config)

    #Construct Azure diagnostics private config

    $wad_storage_account_key = (Get-AzureStorageKey $wad_storage_account_name).Primary
    $wad_private_config = [string]::Format("{{""storageAccountName"":""{0}"",""storageAccountKey"":""{1}""}}",$wad_storage_account_name,$wad_storage_account_key)

    #Enable Diagnostics Extension for Virtual Machine

    $wad_extension_name = "IaaSDiagnostics"
    $wad_publisher = "Microsoft.Azure.Diagnostics"
    $wad_version = (Get-AzureVMAvailableExtension -Publisher $wad_publisher -ExtensionName $wad_extension_name).Version # Gets latest version of the extension

    (Get-AzureVM -ServiceName $service_name -Name $vm_name) | Set-AzureVMExtension -ExtensionName $wad_extension_name -Publisher $wad_publisher -PublicConfiguration $wad_public_config -PrivateConfiguration $wad_private_config -Version $wad_version | Update-AzureVM
```


## <a name="next-steps"></a>Επόμενα βήματα

- Για να διαβάσετε τα αρχεία καταγραφής από το Azure [JSON χρήση αρχείων στο χώρο αποθήκευσης αντικειμένων blob](log-analytics-azure-storage-json.md) υπηρεσιών που Διαγνωστικά εγγραφής στο χώρο αποθήκευσης αντικειμένων blob σε μορφή JSON.
- [Ενεργοποίηση λύσεων](log-analytics-add-solutions.md) για να παρέχετε πληροφορίες για τα δεδομένα.
- [Χρήση ερωτημάτων αναζήτησης](log-analytics-log-searches.md) για την ανάλυση των δεδομένων.
