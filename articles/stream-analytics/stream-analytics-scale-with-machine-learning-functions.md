<properties
    pageTitle="Κλιμάκωση εργασίας ροής ανάλυσης με συναρτήσεις Azure μηχανικής εκμάθησης | Microsoft Azure"
    description="Μάθετε πώς μπορείτε να κλιμακωθεί σωστά ανάλυση ροή εργασιών (διαμερισμάτων, ποσότητα SU και άλλα) κατά τη χρήση συναρτήσεων Azure μηχανικής εκμάθησης."
    keywords=""
    documentationCenter=""
    services="stream-analytics"
    authors="jeffstokes72"
    manager="jhubbard"
    editor="cgronlun"
/>

<tags
    ms.service="stream-analytics"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="data-services"
    ms.date="09/26/2016"
    ms.author="jeffstok"
/>

# <a name="scale-your-stream-analytics-job-with-azure-machine-learning-functions"></a>Κλιμάκωση εργασίας ροής ανάλυσης με συναρτήσεις Azure μηχανικής εκμάθησης

Συχνά είναι αρκετά εύκολο για να ρυθμίσετε μια εργασία ροής ανάλυσης και να εκτελέσετε μερικά δείγματα δεδομένων μέσω του. Τι θα σας θα πρέπει να κάνω όταν πρέπει να εκτελέσετε την ίδια εργασία με υψηλότερη όγκο δεδομένων; Απαιτεί μας για να κατανοήσετε τον τρόπο ρύθμισης της ανάλυσης ροή εργασίας, έτσι ώστε το θα κλίμακα. Σε αυτό το έγγραφο, θα σας εστιάζει στην τις ειδικές πτυχές της κλίμακας ανάλυση ροής εργασιών με τις συναρτήσεις μηχανικής εκμάθησης. Για πληροφορίες σχετικά με τον τρόπο για να κλιμακωθεί ανάλυση ροή εργασιών σε γενικές γραμμές, ανατρέξτε στο άρθρο [Κλιμάκωση εργασίες](stream-analytics-scale-jobs.md).

## <a name="what-is-an-azure-machine-learning-function-in-stream-analytics"></a>Τι είναι μια συνάρτηση Azure μηχανικής εκμάθησης στην ανάλυση ροή;

Μια συνάρτηση μηχανικής εκμάθησης στην ανάλυση ροής μπορεί να χρησιμοποιηθεί όπως μια κλήση συνάρτησης κανονική στη γλώσσα ερωτημάτων ροής ανάλυσης. Ωστόσο, πίσω στη σκηνή, οι κλήσεις συνάρτηση είναι στην πραγματικότητα αιτήσεων υπηρεσίας Web Azure μηχανικής εκμάθησης. Υπηρεσίες web του υπολογιστή εκμάθησης υποστηρίζει "δέσμης" πολλές γραμμές, που ονομάζεται μίνι-δέσμης, στο ίδιο κλήσης στην υπηρεσία web API, για να βελτιώσετε τη συνολική μεταγωγή. Ανατρέξτε στα ακόλουθα άρθρα για περισσότερες λεπτομέρειες; [Συναρτήσεις Azure μηχανικής εκμάθησης σε ροή ανάλυση](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) και τις [Υπηρεσίες Web του Azure μηχανικής εκμάθησης](machine-learning/machine-learning-consume-web-services.md#request-response-service-rrs).

## <a name="configure-a-stream-analytics-job-with-machine-learning-functions"></a>Ρύθμιση παραμέτρων μιας ανάλυσης ροής εργασίας με τις συναρτήσεις μηχανικής εκμάθησης

Όταν ρυθμίζετε τις παραμέτρους μιας συνάρτησης μηχανικής εκμάθησης για ανάλυση ροή εργασίας, υπάρχουν δύο παραμέτρους για να λάβετε υπόψη σας, το μέγεθος δέσμης τις κλήσεις συνάρτηση μηχανικής εκμάθησης και η ροή μονάδες (SUs) παρέχεται για την εργασία ροής ανάλυσης. Για να καθορίσετε τις κατάλληλες τιμές για αυτές τις, πρώτα απόφαση πρέπει να γίνεται μεταξύ λανθάνων χρόνος και απόδοση, δηλαδή, λανθάνων χρόνος της ανάλυσης ροή εργασίας και απόδοση κάθε SU. SUs πάντα μπορούν να προστεθούν σε μια εργασία για να αυξήσετε μετάδοσης καλά διαμερίσματα ερωτήματος ανάλυσης ροής, παρόλο που επιπλέον SUs αυξάνει το κόστος της εργασίας που εκτελούνται.

Επομένως, είναι σημαντικό για να προσδιορίσετε την *ανοχή* λανθάνοντος χρόνου σε εκτέλεσης μιας ανάλυσης ροής εργασίας. Επιπλέον λανθάνων χρόνος από την εκτέλεση αιτήσεις εξυπηρέτησης Azure μηχανικής εκμάθησης, θα αυξήσετε ομαλά με μέγεθος δέσμης, το οποίο θα σύνθετες το λανθάνων χρόνος της ανάλυσης ροής εργασίας. Από την άλλη πλευρά, αύξηση του μεγέθους δέσμης επιτρέπει την ανάλυση ροής εργασίας για την επεξεργασία *περισσότερες συμβάντων με το *ίδιο αριθμό * των αιτήσεων υπηρεσίας web μηχανικής εκμάθησης. Συχνά την αύξηση της λανθάνων χρόνος υπηρεσίας web μηχανικής εκμάθησης είναι δευτερευουσών γραμμικής για την αύξηση του μεγέθους δέσμης, ώστε να είναι σημαντικό να λάβετε υπόψη το μέγεθος δέσμης πιο αποτελεσματική διαχείριση κόστος για μια υπηρεσία web μηχανικής εκμάθησης σε οποιαδήποτε δεδομένη κατάσταση. Το προεπιλεγμένο μέγεθος δέσμη για τις αιτήσεις υπηρεσίας web είναι 1000 και μπορεί να τροποποιηθεί είτε με τη χρήση του [Ροή ανάλυση REST API](https://msdn.microsoft.com/library/mt653706.aspx "Ροής ανάλυση REST API") ή το [πρόγραμμα-πελάτη του PowerShell για ανάλυση ροή](stream-analytics-monitor-and-manage-jobs-use-powershell.md "προγράμματος-πελάτη του PowerShell για ανάλυση ροής").

Όταν έχει οριστεί ένα μέγεθος δέσμης, μπορεί να καθοριστεί το ποσό των μονάδων ροής (SUs), με βάση τον αριθμό των συμβάντων που η συνάρτηση πρέπει να διεργασία ανά δευτερόλεπτο. Για περαιτέρω πληροφορίες σχετικά με ροή μονάδες συμβουλευτείτε στο άρθρο [κλίμακα ανάλυση ροή εργασιών](stream-analytics-scale-jobs.md#configuring-streaming-units).

Σε γενικές γραμμές, υπάρχουν 20 ταυτόχρονες συνδέσεις με την υπηρεσία web μηχανικής εκμάθησης για το κάθε 6 SUs, με τη διαφορά ότι 1 SU εργασίες και 3 SU εργασιών θα σας βοηθήσουν 20 ταυτόχρονες συνδέσεις επίσης.  Για παράδειγμα, εάν η ταχύτητα εισαγωγής δεδομένων είναι 200.000 συμβάντα ανά δευτερόλεπτο και το μέγεθος δέσμης απομένει στην προεπιλεγμένη 1000 το που προκύπτει λανθάνων χρόνος υπηρεσίας web με τη Μίνι-μαζική συμβάντα 1000 είναι 200ms. Αυτό σημαίνει ότι κάθε σύνδεση να κάνετε 5 αιτήσεις για την υπηρεσία web μηχανικής εκμάθησης σε μια δεύτερη. Με 20 συνδέσεις, της ανάλυσης ροή εργασίας μπορεί να επεξεργαστεί 20.000 συμβάντα στο 200ms και, επομένως, 100.000 συμβάντα σε μια δεύτερη. Επομένως, για να επεξεργαστεί 200.000 συμβάντα ανά δευτερόλεπτο, της ανάλυσης ροή εργασίας πρέπει 40 ταυτόχρονες συνδέσεις, που παρέχεται σε 12 SUs. Το παρακάτω διάγραμμα παρουσιάζει τις αιτήσεις από την εργασία ροής ανάλυσης για το τελικό σημείο της υπηρεσίας web μηχανικής εκμάθησης-κάθε 6 SUs με 20 ταυτόχρονες συνδέσεις σε υπηρεσία web μηχανικής εκμάθησης στο μέγιστο.

![Ανάλυση ροή κλίμακα με παράδειγμα εργασία 2 συναρτήσεις μηχανικής εκμάθησης] (./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Ανάλυση ροή κλίμακα με παράδειγμα εργασία 2 συναρτήσεις μηχανικής εκμάθησης")

Σε γενικές γραμμές, ***B*** για μαζική μέγεθος, ***L*** για το λανθάνων χρόνος υπηρεσία web στο μέγεθος δέσμης B σε χιλιοστά του δευτερολέπτου, η ταχύτητα μετάδοσης μια ανάλυση ροής εργασίας με ***N*** SUs είναι:

![Κλιμάκωση ροή ανάλυσης με μηχανικής εκμάθησης συναρτήσεις τύπου] (./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Κλιμάκωση ροή ανάλυσης με μηχανικής εκμάθησης συναρτήσεις τύπου")

Μια πρόσθετη επισήμανση μπορεί να είναι το "Μέγιστος αριθμός ταυτόχρονες κλήσεις' στην πλευρά της υπηρεσίας web εκμάθησης υπολογιστή, συνιστάται να ορίσετε την επιλογή τη μέγιστη τιμή (200 αυτήν τη στιγμή).

Για περισσότερες πληροφορίες σχετικά με αυτήν τη ρύθμιση please διαβάστε το [άρθρο κλίμακα για τις υπηρεσίες Web του μηχανικής εκμάθησης](../machine-learning/machine-learning-scaling-webservice.md).

## <a name="example--sentiment-analysis"></a>Παράδειγμα – άποψη ανάλυσης

Το παρακάτω παράδειγμα περιλαμβάνει μια εργασία ροής αναλυτικών στοιχείων με την ανάλυση άποψη συνάρτηση μηχανικής εκμάθησης, όπως περιγράφεται στην [Εκμάθηση ενοποίησης ροή ανάλυση μηχανικής εκμάθησης](stream-analytics-machine-learning-integration-tutorial.md).

Το ερώτημα είναι ένα απλό ερώτημα πλήρως διαμερίσματα ακολουθούμενο από τη συνάρτηση **άποψη** , όπως φαίνεται παρακάτω:

    WITH subquery AS (
        SELECT text, sentiment(text) as result from input
    )

    Select text, result.[Score]
    Into output
    From subquery

Εξετάστε το ακόλουθο σενάριο; με μια απόδοση 10.000 tweets ανά δευτερόλεπτο πρέπει να δημιουργηθεί μια εργασία ροής ανάλυσης για την εκτέλεση ανάλυσης άποψη από το tweets (συμβάντων). Χρήση 1 SU, αυτή η εργασία ροής ανάλυση θα μπορεί να χειριστείτε την κυκλοφορία; Χρησιμοποιώντας το προεπιλεγμένο μέγεθος δέσμης 1000 η εργασία πρέπει να μπορείτε να παρακολουθείτε την είσοδο. Περαιτέρω συνάρτησης προστέθηκε μηχανικής εκμάθησης θα πρέπει να δημιουργήσουν περισσότερα από ένα δεύτερο λανθάνοντος χρόνου, το οποίο είναι το γενικό προεπιλεγμένος λανθάνων χρόνος της ανάλυσης άποψη υπηρεσίας web μηχανικής εκμάθησης (με ένα προεπιλεγμένο μέγεθος δέσμης 1000). Λανθάνων χρόνος **συνολική** ή τέλος στο τέλος του έργου ανάλυσης ροή συνήθως θα ήταν μερικά δευτερόλεπτα. Ρίξτε μια πιο λεπτομερή ματιά σε αυτήν την εργασία ροής ανάλυση, *ειδικά* το μηχανικής εκμάθησης κλήσεις συναρτήσεων. Αντιμετωπίζετε το μέγεθος δέσμης ως 1000, μια μετάδοσης από 10.000 συμβάντα θα χρειαστεί περίπου 10 αιτήσεις σε υπηρεσία web. Ακόμα και με 1 SU, υπάρχουν αρκετές ταυτόχρονες συνδέσεις για την εξυπηρέτηση αυτής της εισαγωγής κυκλοφορίας.

Αλλά τι γίνεται εάν το επιτόκιο εισόδου συμβάντος αυξάνεται κατά 100 x και τώρα της ανάλυσης ροή εργασίας πρέπει να επεξεργαστούν 1.000.000 tweets ανά δευτερόλεπτο; Υπάρχουν δύο επιλογές:

1.  Αύξηση του μεγέθους δέσμης, ή
2.  Η ροή δεδομένων εισόδου για την επεξεργασία τα συμβάντα παράλληλα partition

Με την πρώτη επιλογή, θα αυξήσετε την εργασία **λανθάνοντος χρόνου** .

Με τη δεύτερη επιλογή, περισσότερες SUs θα πρέπει να είναι παροχή της υπηρεσίας και επομένως, να δημιουργούν πιο ταυτόχρονες αιτήσεις υπηρεσίας web μηχανικής εκμάθησης. Αυτό σημαίνει ότι θα αυξηθεί το **κόστος** του έργου.


Θεωρείται ότι το λανθάνων χρόνος της ανάλυσης άποψη υπηρεσίας web μηχανικής εκμάθησης είναι 200ms για δέσμες 1000 συμβάν ή παρακάτω, 250ms για 5.000 συμβάν δέσμες, 300ms για δέσμες 10.000 συμβάν ή 500ms για δέσμες 25.000 συμβάντων.

1. Χρησιμοποιώντας την πρώτη επιλογή, (**δεν** προμήθεια περισσότερες SUs), το μέγεθος δέσμης θα μπορούσε να αυξάνεται σε **25.000**. Αυτό με τη σειρά θα επιτρέπεται η εργασία να επεξεργαστεί 1.000.000 συμβάντα με 20 ταυτόχρονες συνδέσεις με την υπηρεσία web μηχανικής εκμάθησης (με ένα λανθάνων χρόνος της 500ms ανά κλήσης). Επομένως, το επιπλέον λανθάνων χρόνος της ανάλυσης ροή εργασίας λόγω τις αιτήσεις συνάρτηση άποψη σύμφωνα με τις αιτήσεις υπηρεσίας web μηχανικής εκμάθησης θα αυξάνεται από **200ms** σε **500ms**. Ωστόσο, σημειώστε ότι μαζική μέγεθος **δεν μπορεί να** είναι αυξημένη πολύ με τις υπηρεσίες web του υπολογιστή εκμάθησης απαιτεί το μέγεθος φορτίο της αίτησης είναι 4 MB ή μικρότερο υπηρεσίας web αιτήσεις χρονικού ορίου μετά από 100 δευτερόλεπτα της λειτουργίας.
2. Χρησιμοποιώντας τη δεύτερη επιλογή, το μέγεθος δέσμης είναι αριστερά στο 1000, με λανθάνων χρόνος υπηρεσίας web 200ms, κάθε 20 ταυτόχρονες συνδέσεις με την υπηρεσία web θα έχετε τη δυνατότητα να επεξεργαστεί 1000 συμβάντα *20* 5 = 100,000 ανά δευτερόλεπτο. Επομένως, για να επεξεργαστείτε 1.000.000 συμβάντα ανά δευτερόλεπτο, η εργασία θα πρέπει 60 SUs. Σε σύγκριση με την πρώτη επιλογή, ανάλυση ροή εργασίας θα το έκανε περισσότερες αιτήσεων υπηρεσίας web δέσμης, με τη σειρά της δημιουργίας ενός αυξημένη κόστους.

Τα παρακάτω είναι ένας πίνακας για την απόδοση της ανάλυσης ροής εργασίας για διαφορετικές SUs και μεγέθη δέσμη (σε αριθμό συμβάντων ανά δευτερόλεπτο).

| μέγεθος δέσμης (λανθάνων χρόνος ML)  | 500 (200ms) | 1.000 (200ms) | 5.000 (250ms) | 10.000 (300ms) | 25.000 (500ms) |
|--------|-------------------------|---------------|---------------|----------------|----------------|
| **1 SU** | 2.500 | 5.000 | 20.000 | 30.000 | 50000 |
| **3 SUs** | 2.500 | 5.000 | 20.000 | 30.000 | 50000 |
| **6 SUs** | 2.500 | 5.000 | 20.000 | 30.000 | 50000 |
| **12 SUs** | 5.000 | 10.000 | 40.000 | 60.000 | 100,000 |
| **18 SUs** | 7,500 | 15.000 | 60.000 | 90,000 | 150.000 |
| **24 SUs** | 10.000 | 20.000 | 80,000 | 120,000 | 200.000 |
| **…** | … | … | … | … | … |
| **60 SUs** | 25.000 | 50000 | 200.000 | 300.000 | 500.000 |

Από τώρα, θα πρέπει να έχετε ήδη μια καλή Κατανόηση του τρόπου λειτουργίας των συναρτήσεις μηχανικής εκμάθησης στην ανάλυση ροής. Πιθανώς επίσης γνωρίζετε ότι η ανάλυση ροή εργασιών "ελκυστική" δεδομένα από προελεύσεις δεδομένων και κάθε "ελκυστική" επιστρέφει μια δέσμη συμβάντων για την ανάλυση ροής εργασίας για την επεξεργασία. Πώς αυτό επίδραση μοντέλο ελκυστική το μηχανικής εκμάθησης web αιτήσεις εξυπηρέτησης;

Κανονικά, το μέγεθος δέσμης μπορούμε να εγκαταστήσουμε για τις συναρτήσεις μηχανικής εκμάθησης ακριβώς δεν θα διαιρείται με τον αριθμό των συμβάντων που επιστρέφονται από κάθε εργασία ροής ανάλυσης "ελκυστική". Όταν συμβεί αυτό, η υπηρεσία web μηχανικής εκμάθησης θα ονομάζεται με "μερική" δέσμες. Αυτό γίνεται να αναλάβει δεν επιβάρυνσης λανθάνων χρόνος πρόσθετη εργασία στο coalescing συμβάντα από ελκυστική για να αντλήσει.

## <a name="new-function-related-monitoring-metrics"></a>Νέα που σχετίζονται με τη συνάρτηση παρακολούθησης μετρικά

Στην περιοχή παρακολούθηση μιας εργασίας ροής ανάλυση, έχουν προστεθεί τρεις πρόσθετων μετρήσεων που σχετίζονται με τη συνάρτηση. Έχουν τη ΣΥΝΆΡΤΗΣΗ ΠΡΟΣΚΛΉΣΕΙΣ, ΣΥΝΆΡΤΗΣΗ ΣΥΜΒΆΝΤΑ και ΑΠΈΤΥΧΕ η ΣΥΝΆΡΤΗΣΗ ΑΙΤΉΣΕΙΣ, όπως φαίνεται στο παρακάτω γραφικό.

![Κλιμάκωση ροή ανάλυσης με μηχανικής εκμάθησης μετρικά συναρτήσεις] (./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Κλιμάκωση ροή ανάλυσης με μηχανικής εκμάθησης μετρικά συναρτήσεις")

Που καθορίζεται ως εξής:

**ΣΥΝΆΡΤΗΣΗ ΑΙΤΉΣΕΙΣ**: Ο αριθμός των αιτήσεων συνάρτηση.

**ΣΥΝΆΡΤΗΣΗ ΣΥΜΒΆΝΤΑ**: τα συμβάντα αριθμού στις αιτήσεις συνάρτηση.

**ΑΠΈΤΥΧΕ η ΣΥΝΆΡΤΗΣΗ ΑΙΤΉΣΕΙΣ**: Ο αριθμός των αποτυχημένων συνάρτηση αιτήσεων.

## <a name="key-takeaways"></a>Πλήκτρο Takeaways  

Για να συνοψίσετε τα κύρια σημεία, για να περιορίσετε το μέγεθος μιας εργασίας ροής ανάλυσης με τις συναρτήσεις μηχανικής εκμάθησης, πρέπει να θεωρούνται τα ακόλουθα στοιχεία:

1.  Ο συντελεστής εισόδου συμβάντος
2.  Το ανεκτό λανθάνων χρόνος για την εργασία που εκτελείται ανάλυση ροής (και, επομένως, το μέγεθος δέσμης των αιτήσεων υπηρεσίας web μηχανικής εκμάθησης)
3.  Την προμήθεια του φακέλου SUs ανάλυση ροή και ο αριθμός των αιτήσεων υπηρεσίας web μηχανικής εκμάθησης (το πρόσθετο που σχετίζονται με τη συνάρτηση κόστος)

Πλήρως διαμερίσματα ερωτήματος ανάλυσης ροή χρησιμοποιήθηκε ως παράδειγμα. Εάν είναι απαραίτητο ένα πιο σύνθετο ερώτημα στο [φόρουμ Azure ροή ανάλυσης](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) είναι ένας εξαιρετικός πόρος για τη λήψη επιπλέον Βοήθειας από την ομάδα ανάλυση ροής.

## <a name="next-steps"></a>Επόμενα βήματα

Για να μάθετε περισσότερα σχετικά με τη ροή ανάλυση, ανατρέξτε στα θέματα:

- [Γρήγορα αποτελέσματα με το Azure ροή ανάλυσης](stream-analytics-get-started.md)
- [Κλίμακα Azure ανάλυση ροής εργασιών](stream-analytics-scale-jobs.md)
- [Αναφορά γλώσσας ερωτήματος ανάλυσης Azure ροής](https://msdn.microsoft.com/library/azure/dn834998.aspx)
- [Azure ροή ανάλυση διαχείρισης REST API αναφοράς](https://msdn.microsoft.com/library/azure/dn835031.aspx)
