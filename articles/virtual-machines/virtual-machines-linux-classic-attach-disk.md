<properties
    pageTitle="Επισυνάψτε ένα δίσκο σε μια Εικονική Linux | Microsoft Azure"
    description="Μάθετε πώς μπορείτε να επισυνάψετε ένα δίσκο δεδομένων σε μια Azure εικονικές υπολογιστή που εκτελεί Linux και προετοιμασία του, ώστε να είναι έτοιμα για χρήση."
    services="virtual-machines-linux"
    documentationCenter=""
    authors="iainfoulds"
    manager="timlt"
    editor="tysonn"
    tags="azure-service-management"/>

<tags
    ms.service="virtual-machines-linux"
    ms.workload="infrastructure-services"
    ms.tgt_pltfrm="vm-linux"
    ms.devlang="na"
    ms.topic="article"
    ms.date="08/23/2016"
    ms.author="iainfou"/>

# <a name="how-to-attach-a-data-disk-to-a-linux-virtual-machine"></a>Πώς να επισυνάψετε ένα δίσκο δεδομένων σε μια εικονική μηχανή Linux

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-classic-include.md)]Δείτε πώς μπορείτε να [επισυνάψετε ένα δίσκο δεδομένων με χρήση του μοντέλου ανάπτυξης διαχείρισης πόρων](virtual-machines-linux-add-disk.md).

Μπορείτε να επισυνάψετε τόσο κενή δίσκων και δίσκων που περιέχουν δεδομένα για να σας ΣΠΣ Azure. Και οι δύο τύποι δίσκων είναι .vhd αρχεία που βρίσκονται σε ένα λογαριασμό Azure χώρου αποθήκευσης. Ως με την προσθήκη κάθε δίσκο σε ένα μηχάνημα Linux, αφού συνδέσετε το δίσκο πρέπει να προετοιμάσετε και να τη μορφοποιήσετε, ώστε να είναι έτοιμα για χρήση. Σε αυτό το άρθρο λεπτομέρειες επισύναψη κενή δίσκων και δίσκων ήδη που περιέχει τα δεδομένα σας ΣΠΣ, καθώς και πώς να προετοιμασία και να μορφοποιήσετε έναν νέο δίσκο, στη συνέχεια.

> [AZURE.NOTE]Είναι βέλτιστη πρακτική να χρησιμοποιήσετε μία ή περισσότερες ξεχωριστές δίσκων για την αποθήκευση δεδομένων μια εικονική μηχανή. Όταν δημιουργείτε μια εικονική μηχανή Azure, που έχει ένα λειτουργικό σύστημα και ένα δίσκο προσωρινό. **Μην χρησιμοποιείτε τον προσωρινό δίσκο για την αποθήκευση μόνιμων δεδομένων.** Όπως υποδηλώνει το όνομα, παρέχει προσωρινό χώρο αποθήκευσης. Προσφέρει χωρίς πλεονασμού ή δημιουργία αντιγράφων ασφαλείας, επειδή δεν βρίσκεται στο χώρο αποθήκευσης Azure.
> Ο δίσκος προσωρινό συνήθως γίνεται από τον παράγοντα Linux Azure και ενεργοποιηθεί αυτόματα σε **/mnt/resource** (ή **/mnt** από τις εικόνες Ubuntu). Από την άλλη πλευρά, ένα δίσκο δεδομένων θα μπορούσε να ονομαστεί από τον πυρήνα Linux κάπως `/dev/sdc`, και πρέπει να δημιουργήσετε διαμερίσματα, μορφοποίηση και ενεργοποίησης αυτόν τον πόρο. Ανατρέξτε στο θέμα [Οδηγός παράγοντας Azure Linux] [ Agent] για λεπτομέρειες.

[AZURE.INCLUDE [howto-attach-disk-windows-linux](../../includes/howto-attach-disk-linux.md)]

## <a name="initialize-a-new-data-disk-in-linux"></a>Προετοιμασία ενός νέου δίσκου δεδομένων στο Linux

1. SSH για να σας Εικονική. Για περισσότερες λεπτομέρειες, ανατρέξτε στο θέμα [πώς μπορείτε να συνδεθείτε με μια εικονική μηχανή εκτελείται Linux][Logon].

2. Επόμενο πρέπει να βρείτε το αναγνωριστικό συσκευής για το δίσκο δεδομένων για την προετοιμασία. Υπάρχουν δύο τρόποι για να το κάνετε:

    α) Grep για συσκευές SCSI στα αρχεία καταγραφής, όπως για παράδειγμα από την ακόλουθη εντολή:

            $sudo grep SCSI /var/log/messages

    Για πρόσφατες Ubuntu κατανομές, ίσως χρειαστεί να χρησιμοποιήσετε `sudo grep SCSI /var/log/syslog` επειδή συνδεόμενοι `/var/log/messages` μπορεί να έχει απενεργοποιηθεί από προεπιλογή.

    Μπορείτε να βρείτε το αναγνωριστικό του τελευταίου δίσκου δεδομένων που προστέθηκε στα μηνύματα που εμφανίζονται.

    ![Λάβετε τα μηνύματα στο δίσκο](./media/virtual-machines-linux-classic-attach-disk/scsidisklog.png)

    OR

    β) Χρησιμοποιήστε το `lsscsi` εντολή για να βρείτε το αναγνωριστικό συσκευής. `lsscsi`μπορεί να εγκατασταθεί, είτε `yum install lsscsi` (σε κόκκινο καπέλο βάσει κατανομές) ή `apt-get install lsscsi` (σε Debian βάσει κατανομές). Μπορείτε να βρείτε το δίσκο που αναζητάτε με το _lun_ ή **τον αριθμό λογικής μονάδας**. Για παράδειγμα, τον _lun_ για δίσκων έχετε επισυνάψει μπορούν να προβληθούν εύκολα από `azure vm disk list <virtual-machine>` ως:

            ~$ azure vm disk list TestVM
            info:    Executing command vm disk list
            + Fetching disk images
            + Getting virtual machines
            + Getting VM disks
            data:    Lun  Size(GB)  Blob-Name                         OS
            data:    ---  --------  --------------------------------  -----
            data:         30        TestVM-2645b8030676c8f8.vhd  Linux
            data:    0    100       TestVM-76f7ee1ef0f6dddc.vhd
            info:    vm disk list command OK

    Σύγκριση αυτών των δεδομένων με το αποτέλεσμα της `lsscsi` για το ίδιο δείγμα εικονική μηχανή:

            ops@TestVM:~$ lsscsi
            [1:0:0:0]    cd/dvd  Msft     Virtual CD/ROM   1.0   /dev/sr0
            [2:0:0:0]    disk    Msft     Virtual Disk     1.0   /dev/sda
            [3:0:1:0]    disk    Msft     Virtual Disk     1.0   /dev/sdb
            [5:0:0:0]    disk    Msft     Virtual Disk     1.0   /dev/sdc

    Ο τελευταίος αριθμός της πλειάδας σε κάθε γραμμή είναι ο _lun_. Ανατρέξτε στο θέμα `man lsscsi` για περισσότερες πληροφορίες.

3. Στη γραμμή εντολών, πληκτρολογήστε την παρακάτω εντολή για να δημιουργήσετε τη συσκευή σας:

        $sudo fdisk /dev/sdc


4. Όταν σας ζητηθεί, πληκτρολογήστε **n** για να δημιουργήσετε μια νέα διαμερίσματα.


    ![Δημιουργία συσκευής](./media/virtual-machines-linux-classic-attach-disk/fdisknewpartition.png)

5. Όταν σας ζητηθεί, πληκτρολογήστε **p** για να κάνετε τα διαμερίσματα του πρωτεύοντα διαμερίσματα. Πληκτρολογήστε **1** για να είναι η πρώτη διαμερίσματα και, στη συνέχεια, εισαγάγετε τον τύπο για να αποδεχτείτε την προεπιλεγμένη τιμή για τον κύλινδρο. Σε ορισμένα συστήματα, μπορεί να δείξει τις προεπιλεγμένες τιμές το πρώτο και το τελευταίο τομέων, αντί για τον κύλινδρο. Μπορείτε να επιλέξετε να αποδεχτείτε αυτές τις προεπιλογές.


    ![Δημιουργία partition](./media/virtual-machines-linux-classic-attach-disk/fdisknewpartdetails.png)



6. Πληκτρολογήστε **p** για να δείτε τις λεπτομέρειες σχετικά με το δίσκο που έχει που διαμερίσματα.


    ![Λίστα πληροφοριών δίσκου](./media/virtual-machines-linux-classic-attach-disk/fdiskpartitiondetails.png)



7. Πληκτρολογήστε **w** για να γράψετε τις ρυθμίσεις για το δίσκο.


    ![Γράψτε τις αλλαγές δίσκου](./media/virtual-machines-linux-classic-attach-disk/fdiskwritedisk.png)

8. Τώρα μπορείτε να δημιουργήσετε το σύστημα αρχείων σε τη νέα διαμερίσματα. Προσάρτηση τον αριθμό διαμερίσματα για το Αναγνωριστικό συσκευής (στο παράδειγμα που ακολουθεί `/dev/sdc1`). Το παρακάτω παράδειγμα δημιουργεί μια διαμερίσματα ext4 στα /dev/sdc1:

        # sudo mkfs -t ext4 /dev/sdc1

    ![Δημιουργήστε το σύστημα αρχείων](./media/virtual-machines-linux-classic-attach-disk/mkfsext4.png)

    >[AZURE.NOTE] Συστήματα SuSE Linux Enterprise 11 υποστηρίζει μόνο πρόσβαση μόνο για ανάγνωση για συστήματα αρχείων ext4. Για αυτά τα συστήματα, συνιστάται να μορφοποιήσετε το νέο σύστημα αρχείων ως ext3 αντί για ext4.


9. Κάνετε έναν κατάλογο ώστε να ενεργοποίησης το νέο σύστημα αρχείων, ως εξής:

        # sudo mkdir /datadrive


10. Τέλος έχετε τη δυνατότητα να τοποθετήσετε τη μονάδα δίσκου, ως εξής:

        # sudo mount /dev/sdc1 /datadrive

    Ο δίσκος δεδομένων είναι τώρα έτοιμο για χρήση ως **/datadrive**.
    
    ![Δημιουργία του καταλόγου και ενεργοποίησης του δίσκου](./media/virtual-machines-linux-classic-attach-disk/mkdirandmount.png)


11. Προσθέστε τη νέα μονάδα δίσκου /etc/fstab:

    Για να βεβαιωθείτε ότι έχει ενεργοποιηθεί αυτόματα στη μονάδα δίσκου ξανά μετά την επανεκκίνηση πρέπει να προστεθεί στο αρχείο fstab/κ.λπ /. Επιπλέον, συνιστάται ιδιαίτερα ότι το UUID (παγκοσμίως μοναδικό αναγνωριστικό) χρησιμοποιείται σε /etc/fstab παραπέμπει στη μονάδα δίσκου και όχι απλώς το όνομα της συσκευής (π.χ., /dev/sdc1). Χρησιμοποιώντας το UUID αποτρέπει την εσφαλμένη δίσκου να τοποθετηθεί σε μια συγκεκριμένη θέση, εάν το λειτουργικό σύστημα εντοπίσει σφάλμα στο δίσκο κατά τη διάρκεια της εκκίνησης και τις υπόλοιπες δίσκων δεδομένων την αντιστοίχιση, στη συνέχεια, αυτά τα αναγνωριστικά συσκευών. Για να βρείτε το UUID με τη νέα μονάδα δίσκου, μπορείτε να χρησιμοποιήσετε το βοηθητικό πρόγραμμα **blkid** :

        # sudo -i blkid

    Το αποτέλεσμα μοιάζει με το εξής:

        /dev/sda1: UUID="11111111-1b1b-1c1c-1d1d-1e1e1e1e1e1e" TYPE="ext4"
        /dev/sdb1: UUID="22222222-2b2b-2c2c-2d2d-2e2e2e2e2e2e" TYPE="ext4"
        /dev/sdc1: UUID="33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e" TYPE="ext4"


    >[AZURE.NOTE] Εσφαλμένη επεξεργάζονται το αρχείο **/etc/fstab** θα μπορούσε να έχει ως αποτέλεσμα την αδυναμία εκκίνησης του συστήματος. Εάν βέβαιοι, ανατρέξτε στην τεκμηρίωση της κατανομής για πληροφορίες σχετικά με το πώς μπορείτε να επεξεργαστείτε σωστά αυτό το αρχείο. Συνιστάται επίσης ότι έχει δημιουργήσει ένα αντίγραφο ασφαλείας του αρχείου /etc/fstab πριν από την επεξεργασία.

    Στη συνέχεια, ανοίξτε το αρχείο **/etc/fstab** σε έναν επεξεργαστή κειμένου:

        # sudo vi /etc/fstab

    Σε αυτό το παράδειγμα, μπορούμε να χρησιμοποιήσουμε την τιμή UUID για τη νέα συσκευή **/dev/sdc1** που δημιουργήθηκε με τα προηγούμενα βήματα και το Σημείο_μονταρίσματος **/datadrive**. Προσθέστε την ακόλουθη γραμμή στο τέλος του αρχείου **/etc/fstab** :

        UUID=33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /datadrive   ext4   defaults,nofail   1   2

    Ή, σε συστήματα που βασίζονται σε SuSE Linux που ίσως χρειαστεί να χρησιμοποιήσετε μια ελαφρώς διαφορετική μορφή:

        /dev/disk/by-uuid/33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /datadrive   ext3   defaults,nofail   1   2
    
    >[AZURE.NOTE] Το `nofail` επιλογή εξασφαλίζει ότι η Εικονική ξεκινά ακόμα και αν το σύστημα αρχείων έχει καταστραφεί ή ο δίσκος δεν υπάρχει κατά την εκκίνηση. Χωρίς αυτήν την επιλογή, που μπορεί να αντιμετωπίσετε τη συμπεριφορά όπως περιγράφεται στο [Να SSH για Εικονική Linux λόγω FSTAB σφαλμάτων](https://blogs.msdn.microsoft.com/linuxonazure/2016/07/21/cannot-ssh-to-linux-vm-after-adding-data-disk-to-etcfstab-and-rebooting/).

    Μπορείτε τώρα να ελέγξετε ότι το σύστημα αρχείων έχει ενεργοποιηθεί σωστά, κατάργηση μονταρίσματος και, στη συνέχεια, remounting το σύστημα αρχείων, π.χ. παράδειγμα σημείο ενεργοποίησης `/datadrive` έχουν δημιουργηθεί με τα προηγούμενα βήματα:

        # sudo umount /datadrive
        # sudo mount /datadrive

    Εάν το `mount` εντολή δημιουργεί ένα μήνυμα σφάλματος, ελέγξτε το αρχείο fstab/κ.λπ/για σωστής σύνταξης. Εάν δημιουργήσετε μονάδες πρόσθετα δεδομένα ή τα διαμερίσματα, εισάγετε στα/κ.λπ/fstab ξεχωριστά καθώς και.

    Πραγματοποίηση εγγράψιμο στη μονάδα δίσκου με τη χρήση αυτής της εντολής:

        # sudo chmod go+w /datadrive

>[AZURE.NOTE] Στη συνέχεια αφαίρεση ένα δίσκο δεδομένων χωρίς επεξεργασία fstab μπορεί να προκαλέσει την εικονική Μηχανή αποτυχία εκκίνησης. Εάν αυτή είναι μια συνηθισμένη παρουσία, οι περισσότερες κατανομές παρέχουν είτε το `nofail` ή/και `nobootwait` fstab επιλογές που σας επιτρέπουν ενός συστήματος για εκκίνηση ακόμα και αν ο δίσκος αποτύχει η ενεργοποίησης στο χρόνο εκκίνησης. Συμβουλευτείτε την τεκμηρίωση του διανομής σας για περισσότερες πληροφορίες σχετικά με αυτές τις παραμέτρους.

### <a name="trimunmap-support-for-linux-in-azure"></a>ΑΠΟΚΟΠΉ/UNMAP υποστήριξης για Linux στο Azure
Ορισμένες πυρήνων Linux υποστηρίζει ΑΠΟΚΟΠΉ/UNMAP λειτουργίες για να απορρίψετε που δεν χρησιμοποιούνται μπλοκ στο δίσκο. Αυτές οι λειτουργίες είναι κυρίως χρήσιμη σε τυπική χώρου αποθήκευσης για να ενημερώσετε Azure που διαγραφεί σελίδες δεν είναι πλέον έγκυρες και μπορεί να απορριφθεί. Απόρριψη σελίδες να αποθηκεύσετε κόστος εάν δημιουργείτε μεγάλα αρχεία και, στη συνέχεια, διαγράψτε τα.

Υπάρχουν δύο τρόποι για να ενεργοποιήσετε την ΑΠΟΚΟΠΉ υποστήριξης σε σας Εικονική Linux. Όπως συνήθως, συμβουλευτείτε την κατανομή για την προτεινόμενη προσέγγιση:

- Χρησιμοποιήστε το `discard` ενεργοποίησης επιλογή `/etc/fstab`, για παράδειγμα:

        UUID=33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /datadrive   ext4   defaults,discard   1   2

- Εναλλακτικά, μπορείτε να εκτελέσετε το `fstrim` εντολή με μη αυτόματο τρόπο από τη γραμμή εντολών ή να προσθέσετε αυτό το crontab για να εκτελέσετε τακτικά:

    **Ubuntu**

        # sudo apt-get install util-linux
        # sudo fstrim /datadrive

    **RHEL/CentOS**

        # sudo yum install util-linux
        # sudo fstrim /datadrive

## <a name="troubleshooting"></a>Αντιμετώπιση προβλημάτων
[AZURE.INCLUDE [virtual-machines-linux-lunzero](../../includes/virtual-machines-linux-lunzero.md)]


## <a name="next-steps"></a>Επόμενα βήματα
Μπορείτε να διαβάσετε περισσότερα σχετικά με τη χρήση του Εικονική Linux στα ακόλουθα άρθρα:

- [Πώς μπορείτε να συνδεθείτε με μια εικονική μηχανή εκτελείται Linux][Logon]

- [Πώς να αποσπάσετε ένα δίσκο από μια εικονική μηχανή Linux](virtual-machines-linux-classic-detach-disk.md)

- [Χρήση του Azure CLI με το μοντέλο ανάπτυξης κλασική](../virtual-machines-command-line-tools.md)

<!--Link references-->
[Agent]: virtual-machines-linux-agent-user-guide.md
[Logon]: virtual-machines-linux-mac-create-ssh-keys.md
