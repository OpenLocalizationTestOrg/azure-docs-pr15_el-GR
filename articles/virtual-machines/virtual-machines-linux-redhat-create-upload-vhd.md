<properties
    pageTitle="Δημιουργία και αποστολή ενός VHD Linux κόκκινο καπέλο για μεγάλες επιχειρήσεις για χρήση στο Azure"
    description="Μάθετε πώς να δημιουργήσετε και να στείλετε ένα Azure εικονικού σκληρού δίσκου (VHD) που περιέχει ένα λειτουργικό σύστημα Linux καπέλο κόκκινο χρώμα."
    services="virtual-machines-linux"
    documentationCenter=""
    authors="SuperScottz"
    manager="timlt"
    editor="tysonn"
    tags="azure-resource-manager,azure-service-management"/>

<tags
    ms.service="virtual-machines-linux"
    ms.workload="infrastructure-services"
    ms.tgt_pltfrm="vm-linux"
    ms.devlang="na"
    ms.topic="article"
    ms.date="02/17/2016"
    ms.author="mingzhan"/>


# <a name="prepare-a-red-hat-based-virtual-machine-for-azure"></a>Προετοιμασία μια εικονική μηχανή που βασίζεται σε κόκκινο καπέλο για Azure

Σε αυτό το άρθρο, θα μάθετε πώς να προετοιμάσετε ένα εικονικό μηχάνημα Linux Enterprise καπέλο κόκκινο χρώμα (RHEL) για χρήση σε Azure. Εκδόσεις του RHEL που καλύπτονται σε αυτό το άρθρο είναι 6,7, 7.1 και 7.2. Υπερεπόπτες για την προετοιμασία που καλύπτονται σε αυτό το άρθρο είναι Hyper-V, βάσει πυρήνα εικονική μηχανή (KVM) και VMware. Για περισσότερες πληροφορίες σχετικά με τις απαιτήσεις καταλληλότητας για συμμετοχή στο πρόγραμμα του κόκκινο καπέλο πρόσβασης στο Cloud, ανατρέξτε στο θέμα [τοποθεσία Web του κόκκινο καπέλο πρόσβασης στο Cloud](http://www.redhat.com/en/technologies/cloud-computing/cloud-access) και [Εκτελεί RHEL στην Azure](https://access.redhat.com/articles/1989673).

[Προετοιμασία μια εικονική μηχανή 6,7 RHEL από το διευθυντή Hyper-V](#rhel67hyperv)

[Προετοιμασία μια εικονική μηχανή RHEL 7.1/7.2 από το διευθυντή Hyper-V](#rhel7xhyperv)

[Προετοιμασία μια εικονική μηχανή 6,7 RHEL από KVM](#rhel67kvm)

[Προετοιμασία μια εικονική μηχανή RHEL 7.1/7.2 από KVM](#rhel7xkvm)

[Προετοιμασία μια εικονική μηχανή 6,7 RHEL από VMware](#rhel67vmware)

[Προετοιμασία μια εικονική μηχανή RHEL 7.1/7.2 από VMware](#rhel7xvmware)

[Προετοιμασία μια εικονική μηχανή RHEL 7.1/7.2 από ένα αρχείο kickstart](#rhel7xkickstart)


## <a name="prepare-a-red-hat-based-virtual-machine-from-hyper-v-manager"></a>Προετοιμασία μια εικονική μηχανή που βασίζεται σε κόκκινο καπέλο από το διευθυντή Hyper-V
### <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία
Αυτή η ενότητα προϋποθέτει ότι έχετε εγκαταστήσει ήδη μια εικόνα RHEL (από ένα αρχείο ISO που λάβατε από την τοποθεσία Web του καπέλο κόκκινο) σε έναν εικονικό σκληρό δίσκο (VHD). Για περισσότερες λεπτομέρειες σχετικά με τη χρήση Hyper-V Manager για να εγκαταστήσετε μια εικόνα του λειτουργικού συστήματος, ανατρέξτε στο θέμα [εγκατάσταση του ρόλου Hyper-V και ρύθμιση παραμέτρων μια εικονική μηχανή](http://technet.microsoft.com/library/hh846766.aspx).

**Σημειώσεις εγκατάστασης RHEL**

- Ανατρέξτε στο θέμα επίσης [Γενικές σημειώσεις εγκατάστασης Linux](virtual-machines-linux-create-upload-generic.md#general-linux-installation-notes) για περισσότερες συμβουλές σχετικά με την προετοιμασία Linux για Azure.

- Στη νεότερη μορφή VHDX δεν υποστηρίζεται στο Azure. Μπορείτε να μετατρέψετε το δίσκο VHD μορφή χρησιμοποιώντας το Hyper-V Manager ή το cmdlet του PowerShell **vhd μετατροπή** .

- VHD πρέπει να δημιουργηθεί ως "σταθερή"--δυναμικής VHD δεν υποστηρίζονται.

- Όταν εγκαθιστάτε το σύστημα Linux, συνιστάται να χρησιμοποιήσετε βασικά διαμερίσματα και όχι LVM (συχνά η προεπιλογή για πολλές εγκαταστάσεις). Αυτό θα αποφύγετε LVM όνομα έρχεται σε διένεξη με κλωνοποιημένο ΣΠΣ, ιδίως εάν ένα δίσκο OS πρέπει ποτέ να επισυναφθεί σε μια άλλη Εικονική για την αντιμετώπιση προβλημάτων. LVM ή [RAID](virtual-machines-linux-configure-raid.md) μπορεί να χρησιμοποιηθεί σε δίσκων δεδομένων εάν προτιμώμενη.

- Χωρίς ρύθμιση ένα διαμερίσματα αντιμετάθεσης στο δίσκο OS. Μπορείτε να ρυθμίσετε τον παράγοντα Linux για να δημιουργήσετε ένα αρχείο αντιμετάθεσης στο δίσκο προσωρινών πόρων. Περισσότερες πληροφορίες σχετικά με αυτό είναι διαθέσιμες στα παρακάτω βήματα.

- Όλα τα VHD πρέπει να έχετε τα μεγέθη που είναι πολλαπλάσιο του 1 MB.

- Όταν χρησιμοποιείτε **qemu img** για να μετατρέψετε εικόνες δίσκου VHD μορφή, σημειώστε ότι υπάρχει ένα σφάλμα γνωστά σε εκδόσεις qemu img 2.2.1 ή νεότερη έκδοση. Αυτό το σφάλμα ως αποτέλεσμα μια εσφαλμένη μορφοποίηση VHD. Το ζήτημα προορίζεται για να διορθωθεί σε μια προσεχή έκδοση της qemu img. Προς το παρόν, συνιστάται να χρησιμοποιήσετε την έκδοση 2.2.0 qemu-img ή παλαιότερη έκδοση.

### <a id="rhel67hyperv"> </a>Προετοιμασία μια εικονική μηχανή 6,7 RHEL από το διευθυντή Hyper-V###


1.  Στη Διαχείριση Hyper-V, επιλέξτε την εικονική μηχανή.

2.  Κάντε κλικ στην επιλογή **σύνδεση** για να ανοίξετε ένα παράθυρο κονσόλας για την εικονική μηχανή.

3.  Κατάργηση εγκατάστασης NetworkManager, εκτελώντας την ακόλουθη εντολή:

        # sudo rpm -e --nodeps NetworkManager

    Λάβετε υπόψη ότι εάν δεν είναι ήδη εγκατεστημένο το πακέτο, αυτή η εντολή θα αποτύχει με ένα μήνυμα σφάλματος. Αυτό είναι αναμενόμενο.

4.  Δημιουργήστε ένα αρχείο με το όνομα **δικτύου** σε το `/etc/sysconfig/` κατάλογο που περιέχει το ακόλουθο κείμενο:

        NETWORKING=yes
        HOSTNAME=localhost.localdomain

5.  Δημιουργήστε ένα αρχείο με το όνομα **ifcfg eth0** στο το `/etc/sysconfig/network-scripts/` κατάλογο που περιέχει το ακόλουθο κείμενο:

        DEVICE=eth0
        ONBOOT=yes
        BOOTPROTO=dhcp
        TYPE=Ethernet
        USERCTL=no
        PEERDNS=yes
        IPV6INIT=no

6.  Μετακίνηση (ή κατάργηση) udev κανόνες για να αποφευχθεί η δημιουργία στατικής κανόνες για τη διασύνδεση Ethernet. Αυτούς τους κανόνες προκαλούν προβλήματα κατά την κλωνοποίηση μια εικονική μηχανή στο Microsoft Azure ή Hyper-V:

        # sudo mkdir -m 0700 /var/lib/waagent
        # sudo mv /lib/udev/rules.d/75-persistent-net-generator.rules /var/lib/waagent/
        # sudo mv /etc/udev/rules.d/70-persistent-net.rules /var/lib/waagent/

7.  Βεβαιωθείτε ότι η υπηρεσία δικτύου θα ξεκινήσει κατά την εκκίνηση, εκτελώντας την ακόλουθη εντολή:

        # sudo chkconfig network on

8.  Καταχωρήστε τη συνδρομή σας καπέλο κόκκινο χρώμα για να ενεργοποιήσετε την εγκατάσταση των πακέτων από το χώρο αποθήκευσης RHEL, εκτελώντας την ακόλουθη εντολή:

        # sudo subscription-manager register --auto-attach --username=XXX --password=XXX

9.  Το πακέτο WALinuxAgent `WALinuxAgent-<version>` έχει έχουν προωθηθεί στο αποθετήριο πρόσθετα καπέλο κόκκινο χρώμα. Ενεργοποίηση του αποθετηρίου πρόσθετα, εκτελέστε την παρακάτω εντολή:

        # subscription-manager repos --enable=rhel-6-server-extras-rpms

10. Τροποποίηση της γραμμής εκκίνησης πυρήνα στο εκσκαφή ρύθμιση των παραμέτρων σας για να συμπεριλάβετε τις παραμέτρους επιπλέον πυρήνα για Azure. Για να το κάνετε αυτό, ανοίξτε `/boot/grub/menu.lst` σε έναν επεξεργαστή κειμένου και βεβαιωθείτε ότι η προεπιλεγμένη πυρήνα περιλαμβάνει τις ακόλουθες παραμέτρους:

        console=ttyS0
        earlyprintk=ttyS0
        rootdelay=300
        numa=off

    Αυτό θα εξασφαλίσει επίσης ότι όλα τα μηνύματα κονσόλας αποστέλλονται την πρώτη σειρά θύρα, την οποία μπορούν να σας βοηθήσουν Azure υποστήριξης με τον εντοπισμό σφαλμάτων θέματα. Αυτό θα απενεργοποιήσει NUMA λόγω σφάλματος στην έκδοση πυρήνα που χρησιμοποιείται από RHEL 6.

    Εκτός από την παραπάνω ενέργεια, συνιστάται να καταργήσετε τις ακόλουθες παραμέτρους:

        rhgb quiet crashkernel=auto

    Δεν είναι χρήσιμη σε ένα περιβάλλον cloud όπου θέλουμε όλα τα αρχεία καταγραφής θα αποσταλούν στη σειριακή θύρα γραφικών και ήσυχο εκκίνησης.

    Η επιλογή crashkernel μπορεί να ρυθμιστεί εάν θέλετε τα αριστερά, αλλά Σημειώστε ότι αυτή η παράμετρος θα τη μείωση της διαθέσιμης μνήμης σε η Εικονική από 128 MB ή μεγαλύτερη. Αυτό μπορεί να είναι προβληματικό σε μικρότερα μεγέθη Εικονική.

11. Βεβαιωθείτε ότι ο διακομιστής SSH έχει εγκατασταθεί και ρυθμιστεί να ξεκινά κατά την εκκίνηση. Συνήθως, αυτή είναι η προεπιλεγμένη. Τροποποίηση /etc/ssh/sshd_config για να συμπεριλάβετε την ακόλουθη γραμμή:

        ClientAliveInterval 180

12. Εγκαταστήστε τον παράγοντα Linux Azure, εκτελώντας την ακόλουθη εντολή:

        # sudo yum install WALinuxAgent
        # sudo chkconfig waagent on

    Σημειώστε ότι κατά την εγκατάσταση του πακέτου WALinuxAgent θα καταργήσει τα NetworkManager και NetworkManager gnome πακέτων εάν αυτά δεν ήδη καταργήθηκαν όπως περιγράφεται στο βήμα 2.

13. Μην δημιουργήσετε αντιμετάθεσης χώρο στο δίσκο λειτουργικό σύστημα.
Ο παράγοντας Linux Azure μπορεί να ρυθμίσει αυτόματα χώρος αντιμετάθεσης με τη χρήση του δίσκου τοπικός πόρος που συνδέεται με την εικονική Μηχανή μετά την εικονική Μηχανή παρέχεται σε Azure. Σημειώστε ότι ο δίσκος τοπικός πόρος είναι ένα προσωρινό δίσκο και να αδειάζετε όταν η Εικονική καταργείται. Αφού εγκαταστήσετε τον παράγοντα Linux Azure (ανατρέξτε στο θέμα το προηγούμενο βήμα), τροποποιήστε κατάλληλα τις ακόλουθες παραμέτρους στην /etc/waagent.conf:

        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

14. Καταργήστε τη συνδρομή (εάν χρειάζεται), εκτελώντας την ακόλουθη εντολή:

        # sudo subscription-manager unregister

15. Εκτελέστε τις ακόλουθες εντολές deprovision η εικονική μηχανή και προετοιμασία για προμήθεια στην Azure:

        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout

16. Κάντε κλικ στην επιλογή **ενεργειών > Τερματισμός** στον Hyper-V Manager. Σας VHD Linux είναι τώρα έτοιμο να αποσταλεί Azure.
 

### <a id="rhel7xhyperv"> </a>Προετοιμασία μια εικονική μηχανή RHEL 7.1/7.2 από το διευθυντή Hyper-V###

1.  Στη Διαχείριση Hyper-V, επιλέξτε την εικονική μηχανή.

2.  Κάντε κλικ στην επιλογή **σύνδεση** για να ανοίξετε ένα παράθυρο κονσόλας για την εικονική μηχανή.

3.  Δημιουργήστε ένα αρχείο με το όνομα **δικτύου** σε το `/etc/sysconfig/` κατάλογο που περιέχει το ακόλουθο κείμενο:

        NETWORKING=yes
        HOSTNAME=localhost.localdomain

4.  Δημιουργήστε ένα αρχείο με το όνομα **ifcfg eth0** στο το `/etc/sysconfig/network-scripts/` κατάλογο που περιέχει το ακόλουθο κείμενο:

        DEVICE=eth0
        ONBOOT=yes
        BOOTPROTO=dhcp
        TYPE=Ethernet
        USERCTL=no
        PEERDNS=yes
        IPV6INIT=no

5.  Βεβαιωθείτε ότι η υπηρεσία δικτύου θα ξεκινήσει κατά την εκκίνηση, εκτελώντας την ακόλουθη εντολή:

        # sudo chkconfig network on

6.  Καταχωρήστε τη συνδρομή σας καπέλο κόκκινο χρώμα για να ενεργοποιήσετε την εγκατάσταση των πακέτων από το χώρο αποθήκευσης RHEL, εκτελώντας την ακόλουθη εντολή:

        # sudo subscription-manager register --auto-attach --username=XXX --password=XXX

7.  Τροποποίηση της γραμμής εκκίνησης πυρήνα στο εκσκαφή ρύθμιση των παραμέτρων σας για να συμπεριλάβετε τις παραμέτρους επιπλέον πυρήνα για Azure. Για να το κάνετε αυτό, ανοίξτε `/etc/default/grub` σε ένα πρόγραμμα επεξεργασίας κειμένου και επεξεργαστείτε την παράμετρο **GRUB_CMDLINE_LINUX** . Για παράδειγμα:

        GRUB_CMDLINE_LINUX="rootdelay=300
        console=ttyS0
        earlyprintk=ttyS0"

    Αυτό θα εξασφαλίσει επίσης ότι όλα τα μηνύματα κονσόλας αποστέλλονται την πρώτη σειρά θύρα, την οποία μπορούν να σας βοηθήσουν Azure υποστήριξης με τον εντοπισμό σφαλμάτων θέματα. Εκτός από την παραπάνω ενέργεια, συνιστάται να καταργήσετε τις ακόλουθες παραμέτρους:

        rhgb quiet crashkernel=auto

    Δεν είναι χρήσιμη σε ένα περιβάλλον cloud όπου θέλουμε όλα τα αρχεία καταγραφής θα αποσταλούν στη σειριακή θύρα γραφικών και ήσυχο εκκίνησης.
    Η επιλογή crashkernel μπορεί να ρυθμιστεί εάν θέλετε τα αριστερά, αλλά Σημειώστε ότι αυτή η παράμετρος θα τη μείωση της διαθέσιμης μνήμης σε η Εικονική από 128 MB ή μεγαλύτερη. Αυτό μπορεί να είναι προβληματικό σε μικρότερα μεγέθη Εικονική.

8.  Αφού ολοκληρώσετε την επεξεργασία `/etc/default/grub`, εκτελέστε την ακόλουθη εντολή για να δημιουργήσετε ξανά τις παραμέτρους εκσκαφή:

        # sudo grub2-mkconfig -o /boot/grub2/grub.cfg

9.  Βεβαιωθείτε ότι ο διακομιστής SSH έχει εγκατασταθεί και ρυθμιστεί να ξεκινά κατά την εκκίνηση. Συνήθως, αυτή είναι η προεπιλεγμένη. Τροποποίηση `/etc/ssh/sshd_config` για να συμπεριλάβετε την ακόλουθη γραμμή:

        ClientAliveInterval 180

10. Το πακέτο WALinuxAgent `WALinuxAgent-<version>` έχει έχουν προωθηθεί στο αποθετήριο πρόσθετα καπέλο κόκκινο χρώμα. Ενεργοποίηση του αποθετηρίου πρόσθετα, εκτελέστε την παρακάτω εντολή:

        # subscription-manager repos --enable=rhel-7-server-extras-rpms

11. Εγκαταστήστε τον παράγοντα Linux Azure, εκτελώντας την ακόλουθη εντολή:

        # sudo yum install WALinuxAgent
        # sudo systemctl enable waagent.service

12. Μην δημιουργήσετε αντιμετάθεσης χώρο στο δίσκο λειτουργικό σύστημα. Ο παράγοντας Linux Azure μπορεί να ρυθμίσει αυτόματα χώρος αντιμετάθεσης με τη χρήση του δίσκου τοπικός πόρος που συνδέεται με την εικονική Μηχανή μετά την εικονική Μηχανή παρέχεται σε Azure. Σημειώστε ότι ο δίσκος τοπικός πόρος είναι ένα προσωρινό δίσκο και να αδειάζετε όταν η Εικονική καταργείται. Αφού εγκαταστήσετε τον παράγοντα Linux Azure (ανατρέξτε στο θέμα το προηγούμενο βήμα), τροποποιήστε τις ακόλουθες παραμέτρους στην `/etc/waagent.conf` σωστά:

        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

13. Εάν θέλετε να καταργήσετε την καταχώρηση της συνδρομής, εκτελέστε την ακόλουθη εντολή:

        # sudo subscription-manager unregister

14. Εκτελέστε τις ακόλουθες εντολές deprovision η εικονική μηχανή και προετοιμασία για προμήθεια στην Azure:

        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout

15. Κάντε κλικ στην επιλογή **ενεργειών > Τερματισμός** στον Hyper-V Manager. Σας VHD Linux είναι τώρα έτοιμο να αποσταλεί Azure.
 


## <a name="prepare-a-red-hat-based-virtual-machine-from-kvm"></a>Προετοιμασία μια εικονική μηχανή που βασίζεται σε κόκκινο καπέλο από KVM

### <a id="rhel67kvm"> </a>Προετοιμασία μια εικονική μηχανή 6,7 RHEL από KVM###


1.  Κάντε λήψη της εικόνας KVM 6,7 RHEL από τοποθεσία Web του καπέλο κόκκινο χρώμα.

2.  Ορισμός κωδικού πρόσβασης ριζικό κατάλογο.

    Δημιουργήστε ένα κρυπτογραφημένο κωδικό πρόσβασης και αντιγράψτε το αποτέλεσμα της εντολής:

        # openssl passwd -1 changeme

    Ορισμός κωδικού πρόσβασης ρίζας με guestfish:

        # guestfish --rw -a <image-name>
        ><fs> run
        ><fs> list-filesystems
        ><fs> mount /dev/sda1 /
        ><fs> vi /etc/shadow
        ><fs> exit

    Αλλαγή του ριζικού χρήστη από το δεύτερο πεδίο "!" Για να τον κρυπτογραφημένο κωδικό πρόσβασης.

3.  Για να δημιουργήσετε μια εικονική μηχανή στο KVM από την εικόνα qcow2, ορίστε τον τύπο του δίσκου σε **qcow2**και ορίστε το μοντέλο συσκευής περιβάλλοντος εικονικού δικτύου σε **virtio**. Στη συνέχεια, ξεκινήστε την εικονική μηχανή και πραγματοποιήστε είσοδο ως ριζική.

4.  Δημιουργήστε ένα αρχείο με το όνομα **δικτύου** σε το `/etc/sysconfig/` κατάλογο που περιέχει το ακόλουθο κείμενο:

        NETWORKING=yes
        HOSTNAME=localhost.localdomain

5.  Δημιουργήστε ένα αρχείο με το όνομα **ifcfg eth0** στο το `/etc/sysconfig/network-scripts/` κατάλογο που περιέχει το ακόλουθο κείμενο:

        DEVICE=eth0
        ONBOOT=yes
        BOOTPROTO=dhcp
        TYPE=Ethernet
        USERCTL=no
        PEERDNS=yes
        IPV6INIT=no

6.  Μετακίνηση (ή κατάργηση) udev κανόνα για να αποφευχθεί η δημιουργία στατικής κανόνες για τη διασύνδεση Ethernet. Αυτούς τους κανόνες προκαλούν προβλήματα κατά την κλωνοποίηση μια εικονική μηχανή στο Microsoft Azure ή Hyper-V:

        # mkdir -m 0700 /var/lib/waagent
        # mv /lib/udev/rules.d/75-persistent-net-generator.rules /var/lib/waagent/
        # mv /etc/udev/rules.d/70-persistent-net.rules /var/lib/waagent/

7.  Βεβαιωθείτε ότι η υπηρεσία δικτύου θα ξεκινήσει κατά την εκκίνηση, εκτελώντας την ακόλουθη εντολή:

        # chkconfig network on

8.  Καταχωρήστε τη συνδρομή σας καπέλο κόκκινο χρώμα για να ενεργοποιήσετε την εγκατάσταση των πακέτων από το χώρο αποθήκευσης RHEL, εκτελώντας την ακόλουθη εντολή:

        # subscription-manager register --auto-attach --username=XXX --password=XXX

9.  Τροποποίηση της γραμμής εκκίνησης πυρήνα στο εκσκαφή ρύθμιση των παραμέτρων σας για να συμπεριλάβετε τις παραμέτρους επιπλέον πυρήνα για Azure. Για να το κάνετε αυτό, ανοίξτε `/boot/grub/menu.lst` σε έναν επεξεργαστή κειμένου και βεβαιωθείτε ότι η προεπιλεγμένη πυρήνα περιλαμβάνει τις ακόλουθες παραμέτρους:

        console=ttyS0 earlyprintk=ttyS0 rootdelay=300 numa=off

    Αυτό θα εξασφαλίσει επίσης ότι όλα τα μηνύματα κονσόλας αποστέλλονται την πρώτη σειρά θύρα, την οποία μπορούν να σας βοηθήσουν Azure υποστήριξης με τον εντοπισμό σφαλμάτων θέματα. Αυτό θα απενεργοποιήσει NUMA λόγω σφάλματος στην έκδοση πυρήνα που χρησιμοποιείται από RHEL 6.

    Εκτός από την παραπάνω ενέργεια, συνιστάται να καταργήσετε τις ακόλουθες παραμέτρους:

        rhgb quiet crashkernel=auto

    Δεν είναι χρήσιμη σε ένα περιβάλλον cloud όπου θέλουμε όλα τα αρχεία καταγραφής θα αποσταλούν στη σειριακή θύρα γραφικών και ήσυχο εκκίνησης.
    Η επιλογή crashkernel ενδέχεται να έχει ρυθμιστεί εάν θέλετε τα αριστερά, αλλά Σημειώστε ότι αυτή η παράμετρος θα τη μείωση της διαθέσιμης μνήμης σε η Εικονική από 128 MB ή μεγαλύτερη. Αυτό μπορεί να είναι προβληματικό σε μικρότερα μεγέθη Εικονική.

10. Προσθέστε το Hyper-V λειτουργικές μονάδες σε initramfs:  

    Επεξεργασία `/etc/dracut.conf` και προσθήκη περιεχομένου: add_drivers += "hv_vmbus hv_netvsc hv_storvsc"

    Εκ νέου δημιουργία initramfs: # dracut – f - v

11. Κατάργηση εγκατάστασης την προετοιμασία cloud:

        # yum remove cloud-init

12. Βεβαιωθείτε ότι ο διακομιστής SSH έχει εγκατασταθεί και ρυθμιστεί να ξεκινά κατά την εκκίνηση:

        # chkconfig sshd on

    Τροποποίηση /etc/ssh/sshd_config για να συμπεριλάβετε τις ακόλουθες γραμμές:

        PasswordAuthentication yes
        ClientAliveInterval 180

    Επανεκκινήστε το sshd:

        # service sshd restart

13. Το πακέτο WALinuxAgent `WALinuxAgent-<version>` έχει έχουν προωθηθεί στο αποθετήριο πρόσθετα καπέλο κόκκινο χρώμα. Ενεργοποίηση του αποθετηρίου πρόσθετα, εκτελέστε την παρακάτω εντολή:

        # subscription-manager repos --enable=rhel-6-server-extras-rpms

14. Εγκαταστήστε τον παράγοντα Linux Azure, εκτελώντας την ακόλουθη εντολή:

        # yum install WALinuxAgent
        # chkconfig waagent on

15. Ο παράγοντας Linux Azure μπορεί να ρυθμίσει αυτόματα χώρος αντιμετάθεσης με τη χρήση του δίσκου τοπικός πόρος που συνδέεται με την εικονική Μηχανή μετά την εικονική Μηχανή παρέχεται σε Azure. Σημειώστε ότι ο δίσκος τοπικός πόρος είναι ένα προσωρινό δίσκο και να αδειάζετε όταν η Εικονική καταργείται. Αφού εγκαταστήσετε τον παράγοντα Linux Azure (ανατρέξτε στο θέμα το προηγούμενο βήμα), τροποποιήστε κατάλληλα τις ακόλουθες παραμέτρους στην **/etc/waagent.conf** :

        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

16. Καταργήστε τη συνδρομή (εάν χρειάζεται), εκτελώντας την ακόλουθη εντολή:

        # subscription-manager unregister

17. Εκτελέστε τις ακόλουθες εντολές deprovision η εικονική μηχανή και προετοιμασία για προμήθεια στην Azure:

        # waagent -force -deprovision
        # export HISTSIZE=0
        # logout

18. Τερματίστε την Εικονική στα KVM.

19. Μετατρέψτε την εικόνα qcow2 VHD μορφή.
    Πρώτα να μετατρέψετε την εικόνα ανεπεξέργαστα μορφή:

         # qemu-img convert -f qcow2 –O raw rhel-6.7.qcow2 rhel-6.7.raw
    Βεβαιωθείτε ότι το μέγεθος της εικόνας ανεπεξέργαστα είναι στοιχισμένο με το 1 MB. Διαφορετικά, στρογγυλοποίηση προς τα επάνω το μέγεθος για να στοιχίσετε με 1 MB: # MB = $((1024*1024)) μέγεθος # = $(qemu img πληροφορίες -f ανεπεξέργαστα--εξόδου json "rhel-6.7.raw" | \ gawk ' ταιριάζουν με ($0, / "εικονικό μέγεθος": ([0-9] +), /, val) {εκτύπωση val[1]}') # rounded_size = $((($size/$MB + 1)*$MB))

         # qemu-img resize rhel-6.7.raw $rounded_size

    Μετατρέψτε το ανεπεξέργαστο δίσκο VHD σταθερό μέγεθος:

         # qemu-img convert -f raw -o subformat=fixed -O vpc rhel-6.7.raw rhel-6.7.vhd


### <a id="rhel7xkvm"> </a>Προετοιμασία μια εικονική μηχανή RHEL 7.1/7.2 από KVM###


1.  Κάντε λήψη της εικόνας KVM RHEL 7.1 (ή 7.2) από την τοποθεσία Web καπέλο κόκκινο χρώμα. Θα χρησιμοποιήσουμε RHEL 7.1 ως παράδειγμα εδώ.

2.  Ορισμός κωδικού πρόσβασης ριζικό κατάλογο.

    Δημιουργήστε ένα κρυπτογραφημένο κωδικό πρόσβασης και αντιγράψτε το αποτέλεσμα της εντολής:

        # openssl passwd -1 changeme

    Ορισμός κωδικού πρόσβασης ρίζας με guestfish.

        # guestfish --rw -a <image-name>
        ><fs> run
        ><fs> list-filesystems
        ><fs> mount /dev/sda1 /
        ><fs> vi /etc/shadow
        ><fs> exit

    Αλλαγή του ριζικού χρήστη από το δεύτερο πεδίο "!" Για να τον κρυπτογραφημένο κωδικό πρόσβασης.

3.  Για να δημιουργήσετε μια εικονική μηχανή στο KVM από την εικόνα qcow2, ορίστε τον τύπο του δίσκου σε **qcow2**και ορίστε το μοντέλο συσκευής περιβάλλοντος εικονικού δικτύου σε **virtio**. Στη συνέχεια, ξεκινήστε την εικονική μηχανή και πραγματοποιήστε είσοδο ως ριζική.

4.  Δημιουργήστε ένα αρχείο με το όνομα **δικτύου** σε το `/etc/sysconfig/` κατάλογο που περιέχει το ακόλουθο κείμενο:

        NETWORKING=yes
        HOSTNAME=localhost.localdomain

5.  Δημιουργήστε ένα αρχείο με το όνομα **ifcfg eth0** στο το `/etc/sysconfig/network-scripts/` κατάλογο που περιέχει το ακόλουθο κείμενο:

        DEVICE=eth0
        ONBOOT=yes
        BOOTPROTO=dhcp
        TYPE=Ethernet
        USERCTL=no
        PEERDNS=yes
        IPV6INIT=no

6.  Βεβαιωθείτε ότι η υπηρεσία δικτύου θα ξεκινήσει κατά την εκκίνηση, εκτελώντας την ακόλουθη εντολή:

        # chkconfig network on

7.  Καταχωρήστε τη συνδρομή σας καπέλο κόκκινο χρώμα για να ενεργοποιήσετε την εγκατάσταση των πακέτων από το χώρο αποθήκευσης RHEL, εκτελώντας την ακόλουθη εντολή:

        # subscription-manager register --auto-attach --username=XXX --password=XXX

8.  Τροποποίηση της γραμμής εκκίνησης πυρήνα στο εκσκαφή ρύθμιση των παραμέτρων σας για να συμπεριλάβετε τις παραμέτρους επιπλέον πυρήνα για Azure. Για να το κάνετε αυτό, ανοίξτε `/etc/default/grub` σε ένα πρόγραμμα επεξεργασίας κειμένου και επεξεργαστείτε την παράμετρο **GRUB_CMDLINE_LINUX** . Για παράδειγμα:

        GRUB_CMDLINE_LINUX="rootdelay=300
        console=ttyS0
        earlyprintk=ttyS0"

    Αυτό θα εξασφαλίσει επίσης ότι όλα τα μηνύματα κονσόλας αποστέλλονται την πρώτη σειρά θύρα, την οποία μπορούν να σας βοηθήσουν Azure υποστήριξης με τον εντοπισμό σφαλμάτων θέματα. Εκτός από την παραπάνω ενέργεια, συνιστάται να καταργήσετε τις ακόλουθες παραμέτρους:

        rhgb quiet crashkernel=auto

    Δεν είναι χρήσιμη σε ένα περιβάλλον cloud όπου θέλουμε όλα τα αρχεία καταγραφής θα αποσταλούν στη σειριακή θύρα γραφικών και ήσυχο εκκίνησης.
    Η επιλογή crashkernel μπορεί να ρυθμιστεί εάν θέλετε τα αριστερά, αλλά Σημειώστε ότι αυτή η παράμετρος θα τη μείωση της διαθέσιμης μνήμης σε η Εικονική από 128 MB ή μεγαλύτερη. Αυτό μπορεί να είναι προβληματικό σε μικρότερα μεγέθη Εικονική.

9.  Αφού ολοκληρώσετε την επεξεργασία `/etc/default/grub`, εκτελέστε την ακόλουθη εντολή για να δημιουργήσετε ξανά τις παραμέτρους εκσκαφή:

        # grub2-mkconfig -o /boot/grub2/grub.cfg

10. Προσθέστε το Hyper-V λειτουργικές μονάδες σε initramfs:

    Επεξεργασία `/etc/dracut.conf` και προσθήκη περιεχομένου:

        add_drivers+=”hv_vmbus hv_netvsc hv_storvsc”

    Εκ νέου δημιουργία initramfs:

        # dracut –f -v

11. Κατάργηση εγκατάστασης την προετοιμασία cloud:

        # yum remove cloud-init

12. Βεβαιωθείτε ότι ο διακομιστής SSH έχει εγκατασταθεί και ρυθμιστεί να ξεκινά κατά την εκκίνηση:

        # systemctl enable sshd

    Τροποποίηση /etc/ssh/sshd_config για να συμπεριλάβετε τις ακόλουθες γραμμές:

        PasswordAuthentication yes
        ClientAliveInterval 180

    Επανεκκινήστε το sshd:

        systemctl restart sshd

13. Το πακέτο WALinuxAgent `WALinuxAgent-<version>` έχει έχουν προωθηθεί στο αποθετήριο πρόσθετα καπέλο κόκκινο χρώμα. Ενεργοποίηση του αποθετηρίου πρόσθετα, εκτελέστε την παρακάτω εντολή:

        # subscription-manager repos --enable=rhel-7-server-extras-rpms

14. Εγκαταστήστε τον παράγοντα Linux Azure, εκτελώντας την ακόλουθη εντολή:

        # yum install WALinuxAgent

    Ενεργοποίηση της υπηρεσίας waagent:

        # systemctl enable waagent.service

15. Μην δημιουργήσετε αντιμετάθεσης χώρο στο δίσκο λειτουργικό σύστημα. Ο παράγοντας Linux Azure μπορεί να ρυθμίσει αυτόματα χώρος αντιμετάθεσης με τη χρήση του δίσκου τοπικός πόρος που συνδέεται με την εικονική Μηχανή μετά την εικονική Μηχανή παρέχεται σε Azure. Σημειώστε ότι ο δίσκος τοπικός πόρος είναι ένα προσωρινό δίσκο και να αδειάζετε όταν η Εικονική καταργείται. Αφού εγκαταστήσετε τον παράγοντα Linux Azure (ανατρέξτε στο θέμα το προηγούμενο βήμα), τροποποιήστε τις ακόλουθες παραμέτρους στην `/etc/waagent.conf` σωστά:

        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

16. Καταργήστε τη συνδρομή (εάν χρειάζεται), εκτελώντας την ακόλουθη εντολή:

        # subscription-manager unregister

17. Εκτελέστε τις ακόλουθες εντολές deprovision η εικονική μηχανή και προετοιμασία για προμήθεια στην Azure:

        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout

18. Τερματίστε την εικονική μηχανή στο KVM.

19. Μετατρέψτε την εικόνα qcow2 VHD μορφή.

    Πρώτα να μετατρέψετε την εικόνα ανεπεξέργαστα μορφή:

         # qemu-img convert -f qcow2 –O raw rhel-7.1.qcow2 rhel-7.1.raw

    Βεβαιωθείτε ότι το μέγεθος της εικόνας ανεπεξέργαστα είναι στοιχισμένο με το 1 MB. Διαφορετικά, στρογγυλοποίηση προς τα επάνω το μέγεθος για να στοιχίσετε με 1 MB:

         # MB=$((1024*1024))
         # size=$(qemu-img info -f raw --output json "rhel-7.1.raw" | \
                  gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
         # rounded_size=$((($size/$MB + 1)*$MB))

         # qemu-img resize rhel-7.1.raw $rounded_size

    Μετατρέψτε το ανεπεξέργαστο δίσκο VHD σταθερό μέγεθος:

         # qemu-img convert -f raw -o subformat=fixed -O vpc rhel-7.1.raw rhel-7.1.vhd


## <a name="prepare-a-red-hat-based-virtual-machine-from-vmware"></a>Προετοιμασία μια εικονική μηχανή που βασίζεται σε κόκκινο καπέλο από VMware
### <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία
Αυτή η ενότητα προϋποθέτει ότι έχετε εγκαταστήσει ήδη μια εικονική μηχανή RHEL στο VMware. Για λεπτομέρειες σχετικά με τον τρόπο για να εγκαταστήσετε ένα λειτουργικό σύστημα VMware, ανατρέξτε στο θέμα [Οδηγός εγκατάστασης του λειτουργικού συστήματος επισκέπτη VMware](http://partnerweb.vmware.com/GOSIG/home.html).

- Όταν εγκαθιστάτε το λειτουργικό σύστημα Linux, συνιστάται να χρησιμοποιήσετε βασικά διαμερίσματα και όχι LVM (συχνά η προεπιλογή για πολλές εγκαταστάσεις). Αυτό θα αποφύγετε LVM όνομα έρχεται σε διένεξη με κλωνοποιημένο ΣΠΣ, ιδίως εάν ένα δίσκο OS πρέπει ποτέ να επισυναφθεί σε μια άλλη Εικονική για την αντιμετώπιση προβλημάτων. LVM ή RAID μπορεί να χρησιμοποιηθεί σε δίσκων δεδομένων εάν προτιμώμενη.

- Χωρίς ρύθμιση ένα διαμερίσματα αντιμετάθεσης στο δίσκο OS. Μπορείτε να ρυθμίσετε τον παράγοντα Linux για να δημιουργήσετε ένα αρχείο αντιμετάθεσης στο δίσκο προσωρινών πόρων. Μπορείτε να βρείτε περισσότερες πληροφορίες σχετικά με αυτό στα παρακάτω βήματα.

- Κατά τη δημιουργία του εικονικού σκληρού δίσκου, επιλέξτε **δίσκο εικονικό χώρο αποθήκευσης ως ένα μόνο αρχείο**.



### <a id="rhel67vmware"> </a>Προετοιμάσετε μια εικονική μηχανή 6,7 RHEL από VMware###

1.  Κατάργηση εγκατάστασης NetworkManager, εκτελώντας την ακόλουθη εντολή:

         # sudo rpm -e --nodeps NetworkManager

    Λάβετε υπόψη ότι εάν δεν είναι ήδη εγκατεστημένο το πακέτο, αυτή η εντολή θα αποτύχει με ένα μήνυμα σφάλματος. Αυτό είναι αναμενόμενο.

2.  Δημιουργήστε ένα αρχείο με το όνομα **δικτύου** του /etc/sysconfig/καταλόγου που περιέχει το ακόλουθο κείμενο:

        NETWORKING=yes
        HOSTNAME=localhost.localdomain

3.  Δημιουργήστε ένα αρχείο με το όνομα **ifcfg eth0** στο το /etc/sysconfig/network-scripts / κατάλογο που περιέχει το ακόλουθο κείμενο:

        DEVICE=eth0
        ONBOOT=yes
        BOOTPROTO=dhcp
        TYPE=Ethernet
        USERCTL=no
        PEERDNS=yes
        IPV6INIT=no

4.  Μετακίνηση (ή κατάργηση) udev κανόνα για να αποφευχθεί η δημιουργία στατικής κανόνες για τη διασύνδεση Ethernet. Αυτούς τους κανόνες προκαλούν προβλήματα κατά την κλωνοποίηση μια εικονική μηχανή στο Microsoft Azure ή Hyper-V:

        # sudo mkdir -m 0700 /var/lib/waagent
        # sudo mv /lib/udev/rules.d/75-persistent-net-generator.rules /var/lib/waagent/
        # sudo mv /etc/udev/rules.d/70-persistent-net.rules /var/lib/waagent/

5.  Βεβαιωθείτε ότι η υπηρεσία δικτύου θα ξεκινήσει κατά την εκκίνηση, εκτελώντας την ακόλουθη εντολή:

        # sudo chkconfig network on

6.  Καταχωρήστε τη συνδρομή σας καπέλο κόκκινο χρώμα για να ενεργοποιήσετε την εγκατάσταση των πακέτων από το χώρο αποθήκευσης RHEL, εκτελώντας την ακόλουθη εντολή:

        # sudo subscription-manager register --auto-attach --username=XXX --password=XXX

7.  Το πακέτο WALinuxAgent `WALinuxAgent-<version>` έχει έχουν προωθηθεί στο αποθετήριο πρόσθετα καπέλο κόκκινο χρώμα. Ενεργοποίηση του αποθετηρίου πρόσθετα, εκτελέστε την παρακάτω εντολή:

        # subscription-manager repos --enable=rhel-6-server-extras-rpms

8.  Τροποποίηση της γραμμής εκκίνησης πυρήνα στο εκσκαφή ρύθμιση των παραμέτρων σας για να συμπεριλάβετε τις παραμέτρους επιπλέον πυρήνα για Azure. Για να το κάνετε αυτό, ανοίξτε "/ boot/grub/menu.lst" σε ένα πρόγραμμα επεξεργασίας κειμένου και βεβαιωθείτε ότι η προεπιλεγμένη πυρήνα περιλαμβάνει τις ακόλουθες παραμέτρους:

        console=ttyS0
        earlyprintk=ttyS0
        rootdelay=300
        numa=off

    Αυτό θα εξασφαλίσει επίσης ότι όλα τα μηνύματα κονσόλας αποστέλλονται την πρώτη σειρά θύρα, την οποία μπορούν να σας βοηθήσουν Azure υποστήριξης με τον εντοπισμό σφαλμάτων θέματα. Αυτό θα απενεργοποιήσει NUMA λόγω σφάλματος στην έκδοση πυρήνα που χρησιμοποιείται από RHEL 6.
    Εκτός από την παραπάνω ενέργεια, συνιστάται να καταργήσετε τις ακόλουθες παραμέτρους:

        rhgb quiet crashkernel=auto

    Δεν είναι χρήσιμη σε ένα περιβάλλον cloud όπου θέλουμε όλα τα αρχεία καταγραφής θα αποσταλούν στη σειριακή θύρα γραφικών και ήσυχο εκκίνησης.
    Η επιλογή crashkernel μπορεί να ρυθμιστεί εάν θέλετε τα αριστερά, αλλά Σημειώστε ότι αυτή η παράμετρος θα τη μείωση της διαθέσιμης μνήμης σε η Εικονική από 128 MB ή μεγαλύτερη. Αυτό μπορεί να είναι προβληματικό σε μικρότερα μεγέθη Εικονική.

9.  Προσθέστε το Hyper-V λειτουργικές μονάδες σε initramfs:

        Edit `/etc/dracut.conf` and add content:

            add_drivers+=”hv_vmbus hv_netvsc hv_storvsc”

        Rebuild initramfs:

            # dracut –f -v

10. Βεβαιωθείτε ότι ο διακομιστής SSH έχει εγκατασταθεί και ρυθμιστεί να ξεκινά κατά την εκκίνηση. Συνήθως, αυτή είναι η προεπιλεγμένη. Τροποποίηση `/etc/ssh/sshd_config` για να συμπεριλάβετε την ακόλουθη γραμμή:

        ClientAliveInterval 180

11. Εγκαταστήστε τον παράγοντα Linux Azure, εκτελώντας την ακόλουθη εντολή:

        # sudo yum install WALinuxAgent
        # sudo chkconfig waagent on

12. Μην δημιουργείτε χώρος αντιμετάθεσης στο δίσκο λειτουργικό σύστημα:

    Ο παράγοντας Linux Azure μπορεί να ρυθμίσει αυτόματα χώρος αντιμετάθεσης με τη χρήση του δίσκου τοπικός πόρος που συνδέεται με την εικονική Μηχανή μετά την εικονική Μηχανή παρέχεται σε Azure. Σημειώστε ότι ο δίσκος τοπικός πόρος είναι ένα προσωρινό δίσκο και να αδειάζετε όταν η Εικονική καταργείται. Αφού εγκαταστήσετε τον παράγοντα Linux Azure (ανατρέξτε στο θέμα το προηγούμενο βήμα), τροποποιήστε τις ακόλουθες παραμέτρους στην `/etc/waagent.conf` σωστά:

        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

13. Καταργήστε τη συνδρομή (εάν χρειάζεται), εκτελώντας την ακόλουθη εντολή:

        # sudo subscription-manager unregister

14. Εκτελέστε τις ακόλουθες εντολές deprovision η εικονική μηχανή και προετοιμασία για προμήθεια στην Azure:

        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout

15. Τερματίστε την εικονική Μηχανή και μετατρέψτε το αρχείο VMDK σε ένα αρχείο .vhd.

    Πρώτα να μετατρέψετε την εικόνα ανεπεξέργαστα μορφή:

        # qemu-img convert -f vmdk –O raw rhel-6.7.vmdk rhel-6.7.raw

    Βεβαιωθείτε ότι το μέγεθος της εικόνας ανεπεξέργαστα είναι στοιχισμένο με το 1 MB. Διαφορετικά, στρογγυλοποίηση προς τα επάνω το μέγεθος για να στοιχίσετε με 1 MB:

        # MB=$((1024*1024))
        # size=$(qemu-img info -f raw --output json "rhel-6.7.raw" | \
                gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
        # rounded_size=$((($size/$MB + 1)*$MB))
        # qemu-img resize rhel-6.7.raw $rounded_size

    Μετατρέψτε το ανεπεξέργαστο δίσκο VHD σταθερό μέγεθος:

        # qemu-img convert -f raw -o subformat=fixed -O vpc rhel-6.7.raw rhel-6.7.vhd


### <a id="rhel7xvmware"> </a>Προετοιμασία μια εικονική μηχανή RHEL 7.1/7.2 από VMware###

1.  Δημιουργήστε ένα αρχείο με το όνομα **δικτύου** του /etc/sysconfig/καταλόγου που περιέχει το ακόλουθο κείμενο:

        NETWORKING=yes
        HOSTNAME=localhost.localdomain

2.  Δημιουργήστε ένα αρχείο με το όνομα **ifcfg eth0** στο το /etc/sysconfig/network-scripts / κατάλογο που περιέχει το ακόλουθο κείμενο:

        DEVICE=eth0
        ONBOOT=yes
        BOOTPROTO=dhcp
        TYPE=Ethernet
        USERCTL=no
        PEERDNS=yes
        IPV6INIT=no

3.  Βεβαιωθείτε ότι η υπηρεσία δικτύου θα ξεκινήσει κατά την εκκίνηση, εκτελώντας την ακόλουθη εντολή:

        # sudo chkconfig network on

4.  Καταχωρήστε τη συνδρομή σας καπέλο κόκκινο χρώμα για να ενεργοποιήσετε την εγκατάσταση των πακέτων από το χώρο αποθήκευσης RHEL, εκτελώντας την ακόλουθη εντολή:

        # sudo subscription-manager register --auto-attach --username=XXX --password=XXX

5.  Τροποποίηση της γραμμής εκκίνησης πυρήνα στο εκσκαφή ρύθμιση των παραμέτρων σας για να συμπεριλάβετε τις παραμέτρους επιπλέον πυρήνα για Azure. Για να το κάνετε αυτό, ανοίξτε `/etc/default/grub` σε ένα πρόγραμμα επεξεργασίας κειμένου και επεξεργαστείτε την παράμετρο **GRUB_CMDLINE_LINUX** . Για παράδειγμα:

        GRUB_CMDLINE_LINUX="rootdelay=300
        console=ttyS0
        earlyprintk=ttyS0"

    Αυτό θα εξασφαλίσει επίσης ότι όλα τα μηνύματα κονσόλας αποστέλλονται την πρώτη σειρά θύρα, την οποία μπορούν να σας βοηθήσουν Azure υποστήριξης με τον εντοπισμό σφαλμάτων θέματα. Εκτός από την παραπάνω ενέργεια, συνιστάται να καταργήσετε τις ακόλουθες παραμέτρους:

        rhgb quiet crashkernel=auto

    Δεν είναι χρήσιμη σε ένα περιβάλλον cloud όπου θέλουμε όλα τα αρχεία καταγραφής θα αποσταλούν στη σειριακή θύρα γραφικών και ήσυχο εκκίνησης.
    Η επιλογή crashkernel μπορεί να ρυθμιστεί εάν θέλετε τα αριστερά, αλλά Σημειώστε ότι αυτή η παράμετρος θα τη μείωση της διαθέσιμης μνήμης σε η Εικονική από 128 MB ή μεγαλύτερη. Αυτό μπορεί να είναι προβληματικό σε μικρότερα μεγέθη Εικονική.

6.  Αφού ολοκληρώσετε την επεξεργασία `/etc/default/grub`, εκτελέστε την ακόλουθη εντολή για να δημιουργήσετε ξανά τις παραμέτρους εκσκαφή:

         # sudo grub2-mkconfig -o /boot/grub2/grub.cfg

7.  Προσθέστε το Hyper-V λειτουργικές μονάδες σε initramfs:

    Επεξεργασία `/etc/dracut.conf`, προσθήκη περιεχομένου:

        add_drivers+=”hv_vmbus hv_netvsc hv_storvsc”

    Εκ νέου δημιουργία initramfs:

        # dracut –f -v

8.  Βεβαιωθείτε ότι ο διακομιστής SSH έχει εγκατασταθεί και ρυθμιστεί να ξεκινά κατά την εκκίνηση. Συνήθως, αυτή είναι η προεπιλεγμένη. Τροποποίηση `/etc/ssh/sshd_config` για να συμπεριλάβετε την ακόλουθη γραμμή:

        ClientAliveInterval 180

9.  Το πακέτο WALinuxAgent `WALinuxAgent-<version>` έχει έχουν προωθηθεί στο αποθετήριο πρόσθετα καπέλο κόκκινο χρώμα. Ενεργοποίηση του αποθετηρίου πρόσθετα, εκτελέστε την παρακάτω εντολή:

        # subscription-manager repos --enable=rhel-7-server-extras-rpms

10. Εγκαταστήστε τον παράγοντα Linux Azure, εκτελώντας την ακόλουθη εντολή:

        # sudo yum install WALinuxAgent
        # sudo systemctl enable waagent.service

11. Μην δημιουργήσετε αντιμετάθεσης χώρο στο δίσκο λειτουργικό σύστημα. Ο παράγοντας Linux Azure μπορεί να ρυθμίσει αυτόματα χώρος αντιμετάθεσης με τη χρήση του δίσκου τοπικός πόρος που συνδέεται με την εικονική Μηχανή μετά την εικονική Μηχανή παρέχεται σε Azure. Σημειώστε ότι ο δίσκος τοπικός πόρος είναι ένα προσωρινό δίσκο και να αδειάζετε όταν η Εικονική καταργείται. Αφού εγκαταστήσετε τον παράγοντα Linux Azure (ανατρέξτε στο θέμα το προηγούμενο βήμα), τροποποιήστε τις ακόλουθες παραμέτρους στην `/etc/waagent.conf` σωστά:

        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

12. Εάν θέλετε να καταργήσετε την καταχώρηση της συνδρομής, εκτελέστε την ακόλουθη εντολή:

        # sudo subscription-manager unregister

13. Εκτελέστε τις ακόλουθες εντολές deprovision η εικονική μηχανή και προετοιμασία για προμήθεια στην Azure:

        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout

14. Τερματίστε την εικονική Μηχανή και μετατρέψτε το αρχείο VMDK VHD μορφή.

    Πρώτα να μετατρέψετε την εικόνα ανεπεξέργαστα μορφή:

        # qemu-img convert -f vmdk –O raw rhel-7.1.vmdk rhel-7.1.raw

    Βεβαιωθείτε ότι το μέγεθος της εικόνας ανεπεξέργαστα είναι στοιχισμένο με το 1 MB. Διαφορετικά, στρογγυλοποίηση προς τα επάνω το μέγεθος για να στοιχίσετε με 1 MB:

        # MB=$((1024*1024))
        # size=$(qemu-img info -f raw --output json "rhel-7.1.raw" | \
                 gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
        # rounded_size=$((($size/$MB + 1)*$MB))
        # qemu-img resize rhel-7.1.raw $rounded_size

    Μετατρέψτε το ανεπεξέργαστο δίσκο VHD σταθερό μέγεθος:

        # qemu-img convert -f raw -o subformat=fixed -O vpc rhel-7.1.raw rhel-7.1.vhd


## <a name="prepare-a-red-hat-based-virtual-machine-from-an-iso-by-using-a-kickstart-file-automatically"></a>Προετοιμασία μια εικονική μηχανή που βασίζεται σε κόκκινο καπέλο από μια ISO, χρησιμοποιώντας ένα αρχείο kickstart αυτόματα


### <a id="rhel7xkickstart"> </a>Προετοιμασία μια εικονική μηχανή RHEL 7.1/7.2 από ένα αρχείο kickstart###


1.  Δημιουργήστε ένα αρχείο kickstart με το παρακάτω περιεχόμενο και αποθηκεύστε το αρχείο. Για λεπτομέρειες σχετικά με την εγκατάσταση kickstart, ανατρέξτε στον [Οδηγό εγκατάστασης Kickstart](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Installation_Guide/chap-kickstart-installations.html).



        # Kickstart for provisioning a RHEL 7 Azure VM

        # System authorization information
        auth --enableshadow --passalgo=sha512

        # Use graphical install
        text

        # Do not run the Setup Agent on first boot
        firstboot --disable

        # Keyboard layouts
        keyboard --vckeymap=us --xlayouts='us'

        # System language
        lang en_US.UTF-8

        # Network information
        network  --bootproto=dhcp

        # Root password
        rootpw --plaintext "to_be_disabled"

        # System services
        services --enabled="sshd,waagent,NetworkManager"

        # System timezone
        timezone Etc/UTC --isUtc --ntpservers 0.rhel.pool.ntp.org,1.rhel.pool.ntp.org,2.rhel.pool.ntp.org,3.rhel.pool.ntp.org

        # Partition clearing information
        clearpart --all --initlabel

        # Clear the MBR
        zerombr

        # Disk partitioning information
        part /boot --fstype="xfs" --size=500
        part / --fstyp="xfs" --size=1 --grow --asprimary

        # System bootloader configuration
        bootloader --location=mbr

        # Firewall configuration
        firewall --disabled

        # Enable SELinux
        selinux --enforcing

        # Don't configure X
        skipx

        # Power down the machine after install
        poweroff



        %packages
        @base
        @console-internet
        chrony
        sudo
        parted
        -dracut-config-rescue

        %end

        %post --log=/var/log/anaconda/post-install.log

        #!/bin/bash

        # Register Red Hat Subscription
        subscription-manager register --username=XXX --password=XXX --auto-attach --force

        # Install latest repo update
        yum update -y

        # Enable extras repo
        subscription-manager repos --enable=rhel-7-server-extras-rpms

        # Install WALinuxAgent
        yum install -y WALinuxAgent

        # Unregister Red Hat subscription
        subscription-manager unregister

        # Enable waaagent at boot-up
        systemctl enable waagent

        # Disable the root account
        usermod root -p '!!'

        # Configure swap in WALinuxAgent
        sed -i 's/^\(ResourceDisk\.EnableSwap\)=[Nn]$/\1=y/g' /etc/waagent.conf
        sed -i 's/^\(ResourceDisk\.SwapSizeMB\)=[0-9]*$/\1=2048/g' /etc/waagent.conf

        # Set the cmdline
        sed -i 's/^\(GRUB_CMDLINE_LINUX\)=".*"$/\1="console=tty1 console=ttyS0 earlyprintk=ttyS0 rootdelay=300"/g' /etc/default/grub

        # Enable SSH keepalive
        sed -i 's/^#\(ClientAliveInterval\).*$/\1 180/g' /etc/ssh/sshd_config

        # Build the grub cfg
        grub2-mkconfig -o /boot/grub2/grub.cfg

        # Configure network
        cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth0
        DEVICE=eth0
        ONBOOT=yes
        BOOTPROTO=dhcp
        TYPE=Ethernet
        USERCTL=no
        PEERDNS=yes
        IPV6INIT=no
        NM_CONTROLLED=yes
        EOF

        # Deprovision and prepare for Azure
        waagent -force -deprovision

        %end

2.  Τοποθετήστε το αρχείο kickstart σε μια θέση στην οποία είναι προσβάσιμη από το σύστημα εγκατάστασης.

3.  Στη Διαχείριση Hyper-V, δημιουργήστε μια νέα Εικονική. Στη σελίδα **σύνδεση εικονικού σκληρού δίσκου** , επιλέξτε **Επισύναψη εικονικού σκληρού δίσκου αργότερα**και ολοκλήρωση του Οδηγού δημιουργίας εικονική μηχανή.

4.  Ανοίξτε τις ρυθμίσεις Εικονική:

    μια.  Επισύναψη ενός νέου εικονικού σκληρού δίσκου για να την εικονική Μηχανή. Βεβαιωθείτε ότι έχετε επιλέξει **Μορφή VHD** και το **Σταθερό μέγεθος**.

    β.  Επισύναψη την εγκατάσταση ISO στη μονάδα δίσκου DVD.

    c.  Ορίστε το BIOS για εκκίνηση από CD.

5.  Ξεκινήστε την εικονική Μηχανή. Όταν εμφανίζεται στον Οδηγό εγκατάστασης, πατήστε το πλήκτρο **Tab** για να ρυθμίσετε τις επιλογές εκκίνησης.

6.  ENTER `inst.ks=<the location of the kickstart file>` στο τέλος της επιλογές εκκίνησης και πατήστε το πλήκτρο **Enter**.

7.  Περιμένετε να ολοκληρωθεί η εγκατάσταση. Όταν ολοκληρωθεί, η Εικονική θα τερματιστεί αυτόματα. Σας VHD Linux είναι τώρα έτοιμο να αποσταλεί Azure.

## <a name="known-issues"></a>Γνωστά θέματα
Υπάρχουν γνωστά προβλήματα όταν χρησιμοποιείτε 7.1 RHEL στο Hyper-V και Azure.

### <a name="disk-io-freeze"></a>Σταθεροποίηση εισόδου/εξόδου δίσκου

Αυτό το ζήτημα ενδέχεται να προκύψουν κατά τη διάρκεια δραστηριοτήτων εισόδου/εξόδου δίσκου συχνές χώρου αποθήκευσης με RHEL 7.1 στο Hyper-V και Azure.   

Αναπαραγωγή χρεώσεων:

Αυτό το ζήτημα είναι περιοδικά. Ωστόσο, προκύπτει περισσότερα συχνά κατά τη διάρκεια συχνότερες λειτουργίες εισόδου/εξόδου δίσκου στο Hyper-V και Azure.   


[AZURE.NOTE] Αυτό το γνωστό θέμα έχει ήδη αντιμετωπιστεί με κόκκινο χρώμα καπέλο. Για να εγκαταστήσετε τις σχετικές επιδιορθώσεις, εκτελέστε την ακόλουθη εντολή:

    # sudo yum update

### <a name="the-hyper-v-driver-could-not-be-included-in-the-initial-ram-disk-when-using-a-non-hyper-v-hypervisor"></a>Το πρόγραμμα οδήγησης Hyper-V θα μπορούσε να δεν θα συμπεριληφθούν στον αρχικό δίσκο RAM κατά τη χρήση ενός υπερεπόπτη μη-Hyper-V

Σε ορισμένες περιπτώσεις, προγράμματα εγκατάστασης Linux μπορεί να περιλαμβάνει τα προγράμματα οδήγησης για το Hyper-V στον αρχικό δίσκο RAM (initrd ή initramfs), εκτός αν εντοπίσει ότι εκτελείται σε ένα περιβάλλον Hyper-V.

Όταν χρησιμοποιείτε ένα σύστημα διαφορετικό virtualization (π.χ., Virtualbox, Xen, κ.λπ.) για να προετοιμάσετε την εικόνα σας Linux, ίσως χρειαστεί να αναδημιουργήσετε initrd για να εξασφαλίσει ότι τουλάχιστον οι λειτουργικές μονάδες πυρήνα hv_vmbus και hv_storvsc είναι διαθέσιμα στο αρχικό δίσκο RAM. Πρόκειται για ένα γνωστό θέμα τουλάχιστον σε συστήματα που βασίζονται σε νέα κατανομής καπέλο κόκκινο χρώμα.

Για να επιλύσετε αυτό το ζήτημα, πρέπει να προσθέσετε λειτουργικές μονάδες Hyper-V σε initramfs και να δημιουργήσετε ξανά:

Επεξεργασία `/etc/dracut.conf` και προσθήκη περιεχομένου:

        add_drivers+=”hv_vmbus hv_netvsc hv_storvsc”

Εκ νέου δημιουργία initramfs:

        # dracut –f -v

Για περισσότερες λεπτομέρειες, ανατρέξτε στο θέμα τις πληροφορίες σχετικά με [φτιάχνετε initramfs](https://access.redhat.com/solutions/1958).

## <a name="next-steps"></a>Επόμενα βήματα
Τώρα είστε έτοιμοι να χρησιμοποιήσετε το κόκκινο καπέλο Enterprise Linux εικονικού σκληρού δίσκου για να δημιουργήσετε νέα εικονικές μηχανές στο Azure. Εάν αυτή είναι η πρώτη φορά που που αποστέλλετε το αρχείο .vhd να Azure, δείτε τα βήματα 2 και 3 στη [Δημιουργία και αποστολή ενός εικονικού σκληρού δίσκου που περιέχει το λειτουργικό σύστημα Linux](virtual-machines-linux-classic-create-upload-vhd.md).

Για περισσότερες λεπτομέρειες σχετικά με το υπερεπόπτες που έχουν πιστοποιηθεί για να εκτελέσετε Linux Enterprise καπέλο κόκκινο χρώμα, ανατρέξτε [στην τοποθεσία Web καπέλο κόκκινο χρώμα](https://access.redhat.com/certified-hypervisors).
