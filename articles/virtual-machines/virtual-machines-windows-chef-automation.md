<properties
   pageTitle="Ανάπτυξη Azure εικονική μηχανή με Chef | Microsoft Azure"
   description="Μάθετε πώς μπορείτε να χρησιμοποιήσετε Chef για να κάνετε αυτοματοποιημένη εικονική μηχανή ανάπτυξης και ρύθμισης παραμέτρων στο Microsoft Azure"
   services="virtual-machines-windows"
   documentationCenter=""
   authors="diegoviso"
   manager="timlt"
   tags="azure-service-management,azure-resource-manager"
   editor=""/>

<tags ms.service="virtual-machines-windows" ms.workload="infrastructure-services"
ms.tgt_pltfrm="vm-multiple"
ms.devlang="na"
ms.topic="article"
ms.date="05/19/2015"
ms.author="diviso"/>

# <a name="automating-azure-virtual-machine-deployment-with-chef"></a>Αυτοματοποίηση ανάπτυξη Azure εικονική μηχανή με Chef

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-both-include.md)]

Chef είναι ένα εξαιρετικό εργαλείο για την παροχή αυτοματισμού και επιθυμητοί ρυθμίσεις παραμέτρων κατάσταση.

Με την πιο πρόσφατη έκδοση cloud api, Chef παρέχει απρόσκοπτη ενοποίηση με το Azure, δίνοντάς σας τη δυνατότητα να προμηθεύσουν και ανάπτυξη των μελών ρύθμισης παραμέτρων έως μία εντολή.

Σε αυτό το άρθρο, να σας δείξουμε πώς μπορείτε να ρυθμίσετε το περιβάλλον Chef για παροχή Azure εικονικές μηχανές και να σας καθοδηγήσει στη δημιουργία μια πολιτική ή "Βιβλίο μαγειρικής" και, στη συνέχεια, να αναπτύξετε αυτό βιβλίο μαγειρικής για μια εικονική μηχανή Azure.

Ας ξεκινήσουμε!

## <a name="chef-basics"></a>Βασικά στοιχεία του σεφ

Πριν ξεκινήσετε, να προτείνει εξετάστε τις βασικές έννοιες των Chef. Υπάρχει μεγάλη υλικού <a href="http://www.chef.io/chef" target="_blank">εδώ</a> και να έχετε μια γρήγορη ανάγνωση πριν να επιχειρήσετε αυτόν τον οδηγό. Ωστόσο, που θα recap τα βασικά στοιχεία πριν ξεκινήσουμε.

Το παρακάτω διάγραμμα απεικονίζει την αρχιτεκτονική Chef υψηλού επιπέδου.

![][2]

Chef έχει τρία κύρια στοιχεία αρχιτεκτονική: Chef διακομιστή, Chef προγράμματος-πελάτη (κόμβο) και Chef σταθμούς εργασίας.

Ο διακομιστής Chef είναι το σημείο διαχείρισης και υπάρχουν δύο επιλογές για το διακομιστή Chef: μια φιλοξενούμενη λύση ή μια λύση εσωτερικής εγκατάστασης. Θα χρησιμοποιήσουμε μια φιλοξενούμενη λύση.

Το πρόγραμμα-πελάτη Chef (κόμβο) είναι ο παράγοντας που βρίσκεται στους διακομιστές που διαχειρίζεστε.

Το σταθμούς εργασίας Chef είναι μας σταθμούς εργασίας διαχείρισης όπου θα σας δημιουργήσετε μας πολιτικές και να εκτελέσετε τις εντολές της διαχείρισης μας. Μπορούμε να εκτελέσουμε την εντολή **μαχαιριού** από το Chef σταθμούς εργασίας για να διαχειριστείτε την υποδομή μας.

Υπάρχει επίσης την έννοια της "Cookbooks" και "Συνταγών". Αυτά είναι αποτελεσματικά τις πολιτικές μας ορίσετε και να ισχύουν για τους διακομιστές μας.

## <a name="preparing-the-workstation"></a>Προετοιμασία του σταθμούς εργασίας

Πρώτα, σας επιτρέπει να προετοιμασία του σταθμούς εργασίας. Χρησιμοποιώ μια τυπική σταθμούς εργασίας των Windows. Πρέπει να δημιουργήσετε έναν κατάλογο για την αποθήκευση αρχείων ρύθμισης παραμέτρων και cookbooks μας.

Πρώτα, δημιουργήστε έναν κατάλογο που ονομάζεται C:\chef.

Στη συνέχεια, δημιουργήστε έναν δεύτερο κατάλογο που ονομάζεται c:\chef\cookbooks.

Τώρα πρέπει να λάβετε το αρχείο ρυθμίσεων Azure, ώστε να Chef να επικοινωνείτε μαζί μας Azure συνδρομής.

Κάντε λήψη του δημοσίευση ρυθμίσεις από [εδώ](https://manage.windowsazure.com/publishsettings/).

Αποθηκεύστε το αρχείο ρυθμίσεων δημοσίευση στο C:\chef.

##<a name="creating-a-managed-chef-account"></a>Δημιουργία διαχειριζόμενης Chef λογαριασμού

Εγγραφείτε για ένα λογαριασμό φιλοξενούμενη Chef [εδώ](https://manage.chef.io/signup).

Κατά τη διαδικασία εγγραφής, θα σας ζητηθεί να δημιουργήσετε μια νέα εταιρεία.

![][3]

Όταν δημιουργηθεί η εταιρεία σας, κάντε λήψη του κιτ starter.

![][4]

> [AZURE.NOTE] Εάν λάβετε ένα μήνυμα που προειδοποιεί ότι θα γίνει επαναφορά των αριθμών-κλειδιών, είναι ok για να συνεχίσετε όπως έχουμε χωρίς υπάρχουσα υποδομή έχει ρυθμιστεί προς το παρόν.

Αυτό το αρχείο zip kit starter περιέχει αρχεία ρύθμισης παραμέτρων του οργανισμού και αριθμούς-κλειδιά.

##<a name="configuring-the-chef-workstation"></a>Ρύθμιση παραμέτρων του Chef σταθμούς εργασίας

Εξαγάγετε το περιεχόμενο του chef-starter.zip σε C:\chef.

Αντιγράψτε όλα τα αρχεία στην περιοχή chef-starter\chef-repo\.chef στον κατάλογο c:\chef.

Στον κατάλογο πρέπει τώρα να μοιάζει κάπως το παρακάτω παράδειγμα.

![][5]

Τώρα θα πρέπει να έχετε τέσσερα αρχεία, συμπεριλαμβανομένου του Azure δημοσίευσης αρχείου στη ρίζα της c:\chef.

Τα αρχεία PEM περιέχουν στον οργανισμό σας και ιδιωτικά κλειδιά διαχείρισης για την επικοινωνία, ενώ το αρχείο knife.rb περιέχει της ρύθμισης παραμέτρων μαχαιριού. Θα πρέπει να επεξεργαστείτε το αρχείο knife.rb.

Ανοίξτε το αρχείο στο πρόγραμμα επεξεργασίας της επιλογής και να τροποποιήσετε το "cookbook_path", καταργώντας το /... / από τη διαδρομή, ώστε να εμφανίζεται όπως φαίνεται Επόμενο.

    cookbook_path  ["#{current_dir}/cookbooks"]

Επίσης, προσθέστε τα ακόλουθα αρχείο ρυθμίσεων δημοσίευση γραμμής αναλογιστείτε με το όνομα του Azure σας.

    knife[:azure_publish_settings_file] = "yourfilename.publishsettings"

Το αρχείο knife.rb θα πρέπει τώρα να μοιάζει με το ακόλουθο παράδειγμα.

![][6]

Αυτές οι γραμμές θα βεβαιωθείτε ότι αναφέρεται στον κατάλογο cookbooks στην περιοχή c:\chef\cookbooks μαχαιριού και χρησιμοποιεί επίσης το αρχείο ρυθμίσεων δημοσίευση Azure κατά τη διάρκεια Azure λειτουργιών.

## <a name="installing-the-chef-development-kit"></a>Κατά την εγκατάσταση του Κιτ ανάπτυξης Chef

Επόμενη [λήψη και εγκατάσταση](http://downloads.getchef.com/chef-dk/windows) του ChefDK (Chef Development Kit) για να ρυθμίσετε το Chef σταθμούς εργασίας.

![][7]

Εγκαταστήστε στην προεπιλεγμένη θέση του c:\opscode. Αυτήν την εγκατάσταση, θα χρειαστεί περίπου 10 λεπτά.

Επιβεβαιώστε τη μεταβλητή PATH περιλαμβάνει καταχωρήσεις για C:\opscode\chefdk\bin; C:\opscode\chefdk\embedded\bin;c:\users\yourusername\.chefdk\gem\ruby\2.0.0\bin

Εάν δεν βρίσκονται εκεί, βεβαιωθείτε ότι μπορείτε να προσθέσετε αυτές τις διαδρομές!

*ΣΗΜΕΊΩΣΗ Η ΣΕΙΡΆ ΤΗΣ ΔΙΑΔΡΟΜΉΣ ΕΊΝΑΙ ΣΗΜΑΝΤΙΚΌ!* Εάν σας διαδρομές opscode δεν είναι στη σωστή σειρά αντιμετωπίζετε προβλήματα.

Επανεκκινήστε το σταθμούς εργασίας πριν να συνεχίσετε.

Στη συνέχεια, θα μπορούμε να εγκαταστήσουμε την επέκταση μαχαιριού Azure. Αυτή η δυνατότητα παρέχει μαχαιριού με την "Προσθήκη Azure".

Εκτελέστε την ακόλουθη εντολή.

    chef gem install knife-azure ––pre

> [AZURE.NOTE] Το όρισμα – pre εξασφαλίζει ότι λαμβάνετε την πιο πρόσφατη έκδοση της προσθήκης Azure μαχαιριού που παρέχει πρόσβαση στα το πιο πρόσφατο σύνολο των API RC.

Είναι πιθανό ότι ένας αριθμός εξαρτήσεις θα εγκατασταθεί επίσης την ίδια στιγμή.

![][8]


Για να βεβαιωθείτε ότι όλα τα στοιχεία έχει ρυθμιστεί σωστά, εκτελέστε την ακόλουθη εντολή.

    knife azure image list

Εάν όλα τα στοιχεία έχει ρυθμιστεί σωστά, θα δείτε μια λίστα με τις διαθέσιμες Azure εικόνες μετακινηθείτε με κύλιση.

Συγχαρητήρια. Το σταθμούς εργασίας έχει ρυθμιστεί!

##<a name="creating-a-cookbook"></a>Δημιουργία μιας βιβλίο μαγειρικής

Ένα βιβλίο μαγειρικής χρησιμοποιείται από Chef για να ορίσετε ένα σύνολο εντολών που θέλετε να εκτελέσει στον υπολογιστή-πελάτη διαχειριζόμενων. Δημιουργία ένα βιβλίο μαγειρικής είναι απλές και χρησιμοποιούμε την εντολή **chef δημιουργία βιβλίο μαγειρικής** για τη δημιουργία μας πρότυπο βιβλίο μαγειρικής. Να θα να καλεί το διακομιστή web βιβλίο μαγειρικής όπως θέλω μια πολιτική που αυτόματα ανάπτυξη των υπηρεσιών IIS.

Κάτω από τον κατάλογο C:\Chef, εκτελέστε την ακόλουθη εντολή.

    chef generate cookbook webserver

Αυτό θα δημιουργήσει ένα σύνολο αρχείων κάτω από τον κατάλογο C:\Chef\cookbooks\webserver. Τώρα πρέπει να ορίσετε το σύνολο των εντολών προτείνεται μας προγράμματος-πελάτη Chef να εκτελέσει στη μας διαχειριζόμενων εικονική μηχανή.

Οι εντολές είναι αποθηκευμένα σε default.rb το αρχείο. Σε αυτό το αρχείο που θα ορισμό ενός συνόλου εντολών που εγκαθιστά των υπηρεσιών IIS, ξεκινά των υπηρεσιών IIS και αντιγράφει ένα αρχείο προτύπου στο φάκελο wwwroot.

Τροποποιήστε το αρχείο C:\chef\cookbooks\webserver\recipes\default.rb και προσθέστε τις ακόλουθες γραμμές.

    powershell_script 'Install IIS' do
        action :run
        code 'add-windowsfeature Web-Server'
    end

    service 'w3svc' do
        action [ :enable, :start ]
    end

    template 'c:\inetpub\wwwroot\Default.htm' do
        source 'Default.htm.erb'
        rights :read, 'Everyone'
    end

Όταν ολοκληρώσετε, αποθηκεύστε το αρχείο.

## <a name="creating-a-template"></a>Δημιουργία προτύπου

Όπως αναφέρθηκε προηγουμένως, πρέπει να δημιουργήσετε ένα αρχείο προτύπου που θα χρησιμοποιηθεί ως σελίδα μας default.html.

Εκτελέστε την παρακάτω εντολή για να δημιουργήσετε το πρότυπο.

    chef generate template webserver Default.htm

Τώρα, μεταβείτε στο αρχείο C:\chef\cookbooks\webserver\templates\default\Default.htm.erb. Επεξεργαστείτε το αρχείο με την προσθήκη ορισμένες απλές κώδικα "Γεια" HTML και, στη συνέχεια, αποθηκεύστε το αρχείο.



## <a name="upload-the-cookbook-to-the-chef-server"></a>Αποστείλετε το βιβλίο μαγειρικής στο διακομιστή Chef

Σε αυτό το βήμα, θα σας είναι διαρκεί ένα αντίγραφο του το βιβλίο μαγειρικής που δημιουργήσαμε στον τοπικό υπολογιστή μας και αποστολή του σε φιλοξενούμενο διακομιστή Chef. Μόλις αποσταλεί, θα εμφανιστεί το βιβλίο μαγειρικής κάτω από την καρτέλα **πολιτικής** .

    knife cookbook upload webserver

![][9]

## <a name="deploy-a-virtual-machine-with-knife-azure"></a>Ανάπτυξη μια εικονική μηχανή με μαχαιριού Azure

Τώρα θα αναπτύξετε μια εικονική μηχανή Azure και εφαρμόστε το βιβλίο μαγειρικής "Webserver" που θα εγκαταστήσετε μας των υπηρεσιών IIS web υπηρεσίας και προεπιλεγμένη ιστοσελίδα.

Για να το κάνετε αυτό, χρησιμοποιήστε την εντολή **Δημιουργία μαχαιριού azure διακομιστή** .

Είμαι της εντολής, εμφανίζεται η επόμενη.

    knife azure server create --azure-dns-name 'diegotest01' --azure-vm-name 'testserver01' --azure-vm-size 'Small' --azure-storage-account 'portalvhdsxxxx' --bootstrap-protocol 'cloud-api' --azure-source-image 'a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-Datacenter-201411.01-en.us-127GB.vhd' --azure-service-location 'Southeast Asia' --winrm-user azureuser --winrm-password 'myPassword123' --tcp-endpoints 80,3389 --r 'recipe[webserver]'

Οι παράμετροι είναι αυτονόητα. Αντικαταστήστε το συγκεκριμένο μεταβλητών και να εκτελέσετε.

> [AZURE.NOTE] Από τη γραμμή εντολών, να επίσης αυτοματοποίηση κανόνες φίλτρο μου τελικού σημείου δικτύου, χρησιμοποιώντας την παράμετρο – tcp-τελικά σημεία. Που έχω ανοίξει τις θύρες 80 και 3389 για να παρέχουν πρόσβαση σε ιστοσελίδα και την περίοδο λειτουργίας RDP μου.

Όταν εκτελείτε την εντολή, μεταβείτε στην πύλη του Azure και θα δείτε ξεκινήσει για την παροχή των τον υπολογιστή σας.

![][13]

Γραμμή εντολών εμφανίζεται το επόμενο.

![][10]

Μόλις ολοκληρωθεί η ανάπτυξη, θα σας πρέπει να μπορείτε να συνδεθείτε με την υπηρεσία web μέσω της θύρας 80 μας είχατε ανοίξει τη θύρα όταν θα σας παρασχεθεί η εικονική μηχανή με την εντολή μαχαιριού Azure. Όπως αυτή η εικονική μηχανή είναι η εικονική μηχανή μόνο σε μου υπηρεσία cloud, που θα τη σύνδεση με τη διεύθυνση url της υπηρεσίας cloud.

![][11]

Όπως μπορείτε να δείτε, να έχετε δημιουργικά με μου κώδικα HTML.

Μην ξεχάσετε να μας, επίσης, να συνδεθείτε σε μια περίοδο λειτουργίας RDP από την πύλη του Azure κλασική μέσω θύρα 3389.

Να ελπίζετε αυτός είναι χρήσιμο! Μεταβείτε και ξεκινήστε την υποδομή σας ως κώδικα ταξίδι με Azure σήμερα!


<!--Image references-->
[2]: ./media/virtual-machines-windows-chef-automation/2.png
[3]: ./media/virtual-machines-windows-chef-automation/3.png
[4]: ./media/virtual-machines-windows-chef-automation/4.png
[5]: ./media/virtual-machines-windows-chef-automation/5.png
[6]: ./media/virtual-machines-windows-chef-automation/6.png
[7]: ./media/virtual-machines-windows-chef-automation/7.png
[8]: ./media/virtual-machines-windows-chef-automation/8.png
[9]: ./media/virtual-machines-windows-chef-automation/9.png
[10]: ./media/virtual-machines-windows-chef-automation/10.png
[11]: ./media/virtual-machines-windows-chef-automation/11.png
[13]: ./media/virtual-machines-windows-chef-automation/13.png


<!--Link references-->
