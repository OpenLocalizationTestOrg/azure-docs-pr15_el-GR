<properties
    pageTitle="Καταγράψτε μια Εικονική Linux για να χρησιμοποιήσετε ως πρότυπο | Microsoft Azure"
    description="Μάθετε πώς μπορείτε να καταγράψετε και γενίκευση μια εικόνα από μια βάσει Linux Azure εικονική μηχανή (Εικονική) που δημιουργήθηκαν με το μοντέλο ανάπτυξης Azure διαχείριση πόρων."
    services="virtual-machines-linux"
    documentationCenter=""
    authors="iainfoulds"
    manager="timlt"
    editor=""
    tags="azure-resource-manager"/>

<tags
    ms.service="virtual-machines-linux"
    ms.workload="infrastructure-services"
    ms.tgt_pltfrm="vm-linux"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/25/2016"
    ms.author="iainfou"/>


# <a name="capture-a-linux-virtual-machine-running-on-azure"></a>Καταγράψτε μια εικονική μηχανή Linux εκτελείται σε Azure

Ακολουθήστε τα βήματα σε αυτό το άρθρο για να γενίκευση και να καταγράψετε την εικονική μηχανή Azure Linux (Εικονική) στο μοντέλο ανάπτυξης διαχείρισης πόρων. Όταν γενίκευση η Εικονική, καταργήστε προσωπικά στοιχεία του λογαριασμού και προετοιμασία του Εικονική θα χρησιμοποιηθεί ως εικόνα. Στη συνέχεια, μπορείτε να καταγράψετε μια εικόνα γενικευμένη εικονικού σκληρού δίσκου (VHD) για το λειτουργικό σύστημα, VHD για συνημμένα δεδομένα δίσκων και ένα [πρότυπο από διαχειριστή πόρων](../azure-resource-manager/resource-group-overview.md) για νέα Εικονική αναπτύξεις. 

Για να δημιουργήσετε ΣΠΣ χρησιμοποιώντας την εικόνα, ορίστε τους πόρους του δικτύου για κάθε νέα Εικονική και χρησιμοποιήστε το πρότυπο (ένα αρχείο σημειογραφίας αντικειμένων JavaScript ή JSON,) για να το αναπτύξετε από τις εικόνες που τραβήξατε VHD. Με αυτόν τον τρόπο, μπορείτε να αναπαραγάγετε μια Εικονική με την τρέχουσα ρύθμιση παραμέτρων λογισμικού, παρόμοια με τον τρόπο που μπορείτε να χρησιμοποιήσετε εικόνες από το Azure Marketplace.

>[AZURE.TIP]Εάν θέλετε να δημιουργήσετε ένα αντίγραφο του την υπάρχουσα Εικονική Linux με κατάστασή εξειδικευμένες για δημιουργία αντιγράφων ασφαλείας ή τον εντοπισμό σφαλμάτων, ανατρέξτε στο θέμα [Δημιουργία ένα αντίγραφο του μια εικονική μηχανή Linux εκτελείται σε Azure](virtual-machines-linux-copy-vm.md). Και εάν θέλετε να αποστείλετε ένα VHD Linux από μια Εικονική εσωτερικής εγκατάστασης, ανατρέξτε στο θέμα [Αποστολή και να δημιουργήσετε μια Εικονική Linux από εικόνα προσαρμοσμένης δίσκου](virtual-machines-linux-upload-vhd.md).  

## <a name="before-you-begin"></a>Πριν ξεκινήσετε

Βεβαιωθείτε ότι πληροίτε τις ακόλουθες προϋποθέσεις:

* **Εικονική azure που δημιουργήσατε στο μοντέλο ανάπτυξης διαχείρισης πόρων** - Εάν δεν έχετε δημιουργήσει μια Εικονική Linux, μπορείτε να χρησιμοποιήσετε την [πύλη](virtual-machines-linux-quick-create-portal.md), το [Azure CLI](virtual-machines-linux-quick-create-cli.md)ή [πρότυπα διαχείρισης πόρων](virtual-machines-linux-cli-deploy-templates.md). 

    Ρυθμίστε τις παραμέτρους του Εικονική όπως απαιτείται. Για παράδειγμα, [προσθέστε δεδομένα δίσκων](virtual-machines-linux-add-disk.md), εφαρμογή ενημερώσεων και εγκατάσταση των εφαρμογών. 
* **Azure CLI** - εγκατάσταση του [Azure CLI](../xplat-cli-install.md) σε έναν τοπικό υπολογιστή.

## <a name="step-1-remove-the-azure-linux-agent"></a>Βήμα 1: Κατάργηση τον παράγοντα Azure Linux

Πρώτα, εκτελέστε την εντολή **waagent** με την παράμετρο **διαχειριστείτε** στο η Εικονική Linux. Αυτή η εντολή διαγράφει τα αρχεία και τα δεδομένα για να κάνετε την εικονική Μηχανή είστε έτοιμοι για γενίκευση. Για λεπτομέρειες, ανατρέξτε στο θέμα [Οδηγός Azure Linux παράγοντα χρήστη](virtual-machines-linux-agent-user-guide.md).

1. Σύνδεση με το Εικονική Linux χρησιμοποιώντας ένα πρόγραμμα-πελάτη SSH.

2. Στο παράθυρο SSH, πληκτρολογήστε την ακόλουθη εντολή:

    ```
    sudo waagent -deprovision+user
    ```
    >[AZURE.NOTE] Να εκτελέσετε αυτήν την εντολή μόνο σε μια Εικονική που σκοπεύετε να καταγράψετε ως εικόνα. Δεν εγγυάται ότι η εικόνα είναι απενεργοποιημένο όλων των ευαίσθητων πληροφοριών ή είναι κατάλληλη για αναδιανομή.

3. Πληκτρολογήστε **y** για να συνεχίσετε. Μπορείτε να προσθέσετε το **-επιβάλετε** παράμετρο, για να αποφύγετε αυτό το βήμα επιβεβαίωσης.

4. Μετά την ολοκλήρωση της εντολής, πληκτρολογήστε **κλείσετε**. Αυτό το βήμα κλείνει το πρόγραμμα-πελάτη SSH.

    
## <a name="step-2-capture-the-vm"></a>Βήμα 2: Καταγραφή την εικονική Μηχανή

Χρησιμοποιήστε το Azure CLI να γενίκευση και να καταγράψετε την εικονική Μηχανή. Στα παρακάτω παραδείγματα, αντικαταστήστε τα ονόματα παραμέτρων παράδειγμα με τις δικές σας τιμές. Τα ονόματα παραμέτρων παράδειγμα περιλαμβάνουν **myResourceGroup**, **myVnet**και **myVM**.

5. Από τον τοπικό υπολογιστή, ανοίξτε το Azure CLI και να [συνδεθείτε στη συνδρομή σας στο Azure](../xplat-cli-connect.md). 

6. Βεβαιωθείτε ότι βρίσκεστε σε λειτουργία διαχείρισης πόρων.

    ```
    azure config mode arm
    ```

7. Τερματίστε την εικονική Μηχανή που ήδη κατάργηση, χρησιμοποιώντας την ακόλουθη εντολή:

    ```
    azure vm deallocate -g MyResourceGroup -n myVM
    ```

8. Γενίκευση την εικονική Μηχανή με την ακόλουθη εντολή:

    ```
    azure vm generalize -g MyResourceGroup -n myVM
    ```

9. Τώρα, εκτελέστε την εντολή **Καταγραφή azure εικονική** , η οποία καταγράφει την εικονική Μηχανή. Στο παρακάτω παράδειγμα, η εικόνα VHD καταγράφονται με ονόματα αρχίζουν με **MyVHDNamePrefix**και η επιλογή **-t** καθορίζει μια διαδρομή για το πρότυπο **MyTemplate.json**. 

    ```
    azure vm capture MyResourceGroup MyResourceGroup MyVHDNamePrefix -t MyTemplate.json
    ```

    >[AZURE.IMPORTANT]Τα αρχεία VHD εικόνας δημιουργούνται από προεπιλογή στον ίδιο λογαριασμό χώρου αποθήκευσης που χρησιμοποιείται η αρχική Εικονική. Χρησιμοποιήστε τον *ίδιο λογαριασμό χώρου αποθήκευσης* για την αποθήκευση του VHD για οποιαδήποτε νέα ΣΠΣ που δημιουργείτε από την εικόνα. 

6. Για να βρείτε τη θέση τραβήξατε εικόνας, ανοίξτε το πρότυπο JSON σε έναν επεξεργαστή κειμένου. Στο **storageProfile**, βρείτε το **uri** της **εικόνας** που βρίσκεται στο κοντέινερ **συστήματος** . Για παράδειγμα, το URI της εικόνας δίσκου λειτουργικό σύστημα είναι παρόμοια με`https://xxxxxxxxxxxxxx.blob.core.windows.net/system/Microsoft.Compute/Images/vhds/MyVHDNamePrefix-osDisk.xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.vhd`

## <a name="step-3-create-a-vm-from-the-captured-image"></a>Βήμα 3: Δημιουργήστε μια Εικονική από την καταγεγραμμένη εικόνα
Χρησιμοποιείτε την εικόνα με ένα πρότυπο για να δημιουργήσετε μια Εικονική Linux. Αυτά τα βήματα σας δείχνουν πώς μπορείτε να χρησιμοποιήσετε το CLI Azure και το πρότυπο αρχείου JSON που καταγράφονται για να δημιουργήσετε την εικονική Μηχανή σε ένα νέο εικονικό δίκτυο.

### <a name="create-network-resources"></a>Δημιουργία πόρων δικτύου

Για να χρησιμοποιήσετε το πρότυπο, πρέπει πρώτα να ρυθμίσετε ένα εικονικό δίκτυο και NIC για το νέο Εικονική. Συνιστάται να δημιουργήσετε μια ομάδα πόρων για αυτούς τους πόρους στη θέση όπου είναι αποθηκευμένο το Εικονική εικόνα. Εκτέλεση εντολών παρόμοια με τα εξής, αντικαθιστώντας τα ονόματα για τους πόρους σας και μια κατάλληλη θέση Azure ("centralus" σε αυτές τις εντολές):

    azure group create MyResourceGroup1 -l "centralus"

    azure network vnet create MyResourceGroup1 myVnet -l "centralus"

    azure network vnet subnet create MyResourceGroup1 myVnet mySubnet

    azure network public-ip create MyResourceGroup1 myIP -l "centralus"

    azure network nic create MyResourceGroup1 myNIC -k mySubnet -m myVnet -p myIP -l "centralus"

### <a name="get-the-id-of-the-nic"></a>Λάβετε το αναγνωριστικό του NIC

Για να αναπτύξετε μια Εικονική από την εικόνα χρησιμοποιώντας το JSON που έχουν αποθηκευτεί κατά την καταγραφή, χρειάζεστε το αναγνωριστικό του NIC. Αποκτήστε το, εκτελέστε την παρακάτω εντολή:

    azure network nic show MyResourceGroup1 myNIC

Είναι παρόμοιο με το **αναγνωριστικό** στο αποτέλεσμα`/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/MyResourceGroup1/providers/Microsoft.Network/networkInterfaces/myNic`



### <a name="create-a-vm"></a>Δημιουργήστε μια εικονική Μηχανή
Τώρα, εκτελέστε την ακόλουθη εντολή για να δημιουργήσετε το Εικονική από την καταγεγραμμένη εικόνα Εικονική. Χρησιμοποιήστε την παράμετρο **-f** για να καθορίσετε τη διαδρομή προς το αρχείο JSON πρότυπο που έχετε αποθηκεύσει.

    azure group deployment create MyResourceGroup1 MyDeployment -f MyTemplate.json

Στη λίστα εντολών εξόδου, θα σας ζητηθεί να δώσετε ένα νέο όνομα Εικονική, το όνομα χρήστη του διαχειριστή και τον κωδικό πρόσβασης και το αναγνωριστικό του NIC που δημιουργήσατε προηγουμένως.

    info:    Executing command group deployment create
    info:    Supply values for the following parameters
    vmName: myNewVM
    adminUserName: myAdminuser
    adminPassword: ********
    networkInterfaceId: /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resource Groups/MyResourceGroup1/providers/Microsoft.Network/networkInterfaces/myNic

Το παρακάτω παράδειγμα εμφανίζει αυτό που βλέπετε για επιτυχή ανάπτυξη:

    + Προετοιμασία ρυθμίσεις παραμέτρων του προτύπου και παράμετροι
    + Δημιουργία μιας πληροφορίες ανάπτυξης: δημιουργήθηκε xxxxxxx ανάπτυξη προτύπου
    + Αναμονή για ανάπτυξη για να ολοκληρώσετε δεδομένων: DeploymentName: MyDeployment δεδομένων: ResourceGroupName: MyResourceGroup1 δεδομένων: ProvisioningState: ολοκληρώθηκε με επιτυχία δεδομένων: χρονικής σήμανσης: xxxxxxx δεδομένων: λειτουργία: τμηματικά δεδομένα: τιμή Type όνομα


    data:    ------------------  ------------  -------------------------------------

    δεδομένα: myNewVM συμβολοσειρά vmName


    δεδομένα: vmSize Standard_D1 συμβολοσειράς


    δεδομένα: myAdminuser συμβολοσειρά adminUserName


    δεδομένα: adminPassword απροσδιόριστη SecureString


    δεδομένα: networkInterfaceId συμβολοσειρά /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/MyResourceGroup1/providers/Microsoft.Network/networkInterfaces/myNic πληροφορίες: ομάδα ανάπτυξης "Δημιουργία" OK

### <a name="verify-the-deployment"></a>Επαληθεύστε την ανάπτυξη

Τώρα SSH για την εικονική μηχανή που δημιουργήσατε για να επιβεβαιώσετε την υλοποίηση και την έναρξη χρήσης του νέου Εικονική. Για να συνδεθείτε μέσω SSH, βρείτε τη διεύθυνση IP του η Εικονική που δημιουργήσατε, εκτελώντας την ακόλουθη εντολή:

    azure network public-ip show MyResourceGroup1 myIP

Στη δημόσια διεύθυνση IP παρατίθεται στην έξοδο της εντολής. Από προεπιλογή θα συνδεθείτε με το Εικονική Linux από SSH στη θύρα 22.

## <a name="create-additional-vms"></a>Δημιουργία πρόσθετων ΣΠΣ
Χρησιμοποιήστε το καταγεγραμμένη εικόνα και το πρότυπο για την ανάπτυξη επιπλέον ΣΠΣ χρησιμοποιώντας τα βήματα στην προηγούμενη ενότητα. Άλλες επιλογές για τη δημιουργία ΣΠΣ από την εικόνα που περιλαμβάνουν χρησιμοποιώντας ένα πρότυπο γρήγορη έναρξη ή εκτελέστε την εντολή **Δημιουργία azure εικονική** .

### <a name="use-the-captured-template"></a>Χρήση του προτύπου που τραβήξατε

Για να χρησιμοποιήσετε την καταγεγραμμένη εικόνα και πρότυπο, ακολουθήστε τα παρακάτω βήματα (Λεπτομερής στην προηγούμενη ενότητα):

* Βεβαιωθείτε ότι το Εικονική εικόνα είναι στον ίδιο λογαριασμό χώρου αποθήκευσης που φιλοξενεί το Εικονική VHD.
* Αντιγράψτε το αρχείο προτύπου JSON και καθορίστε ένα μοναδικό όνομα για το λειτουργικό σύστημα δίσκο VHD τη νέα εικονική Μηχανή (ή VHD). Για παράδειγμα, στο το **storageProfile**, στην περιοχή **vhd**, στο **uri**, καθορίστε ένα μοναδικό όνομα για το **osDisk** VHD, παρόμοια με`https://xxxxxxxxxxxxxx.blob.core.windows.net/vhds/MyNewVHDNamePrefix-osDisk.xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.vhd`
* Δημιουργήστε ένα NIC στο ίδιο ή σε διαφορετικό εικονικό δίκτυο.
* Χρησιμοποιώντας το τροποποιημένο JSON αρχείο προτύπου, δημιουργήστε μια ανάπτυξη στην ομάδα πόρων στην οποία ρυθμίζετε το εικονικό δίκτυο.

### <a name="use-a-quickstart-template"></a>Χρησιμοποιήστε ένα πρότυπο γρήγορη έναρξη

Εάν θέλετε το δίκτυο ρύθμιση αυτόματα όταν δημιουργείτε μια Εικονική από την εικόνα, μπορείτε να καθορίσετε αυτούς τους πόρους σε ένα πρότυπο. Για παράδειγμα, ανατρέξτε στο θέμα το [πρότυπο 101 εικονική από το χρήστη εικόνα](https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-from-user-image) από GitHub. Αυτό το πρότυπο δημιουργεί μια Εικονική από προσαρμοσμένο την εικόνα σας και τα απαραίτητα εικονικού δικτύου, δημόσια διεύθυνση IP και NIC πόρους. Για αναλυτικές οδηγίες για χρήση του προτύπου στην πύλη του Azure, ανατρέξτε στο θέμα [πώς μπορείτε να δημιουργήσετε μια εικονική μηχανή από μια προσαρμοσμένη εικόνα με τη χρήση προτύπου για τη διαχείριση πόρων](http://codeisahighway.com/how-to-create-a-virtual-machine-from-a-custom-image-using-an-arm-template/).

### <a name="use-the-azure-vm-create-command"></a>Χρήση του azure εικονική εντολή "Δημιουργία"

Συνήθως είναι ευκολότερο να χρησιμοποιήσετε ένα πρότυπο από διαχειριστή πόρων για να δημιουργήσετε μια Εικονική από την εικόνα. Ωστόσο, μπορείτε να δημιουργήσετε την Εικονική _imperatively_ , χρησιμοποιώντας την εντολή **Δημιουργία azure εικονική** με το **-Q** (**--εικόνα urn**) παραμέτρου. Εάν χρησιμοποιείτε αυτήν τη μέθοδο, που μεταβιβάζουν επίσης την παράμετρο **-δ** (**--os-δίσκου-vhd**) για να καθορίσετε τη θέση του αρχείου .vhd λειτουργικό σύστημα για τη νέα Εικονική. Αυτό το αρχείο πρέπει να είναι στο κοντέινερ οι VHD του λογαριασμού χώρου αποθήκευσης όπου είναι αποθηκευμένο το αρχείο VHD εικόνας. Η εντολή αντιγράφει τον VHD για τη νέα Εικονική αυτόματα στο κοντέινερ **οι VHD** .

Πριν από την εκτέλεση **Δημιουργία azure εικονική** με την εικόνα, ολοκληρώστε τα ακόλουθα βήματα:

1.  Δημιουργήστε μια ομάδα πόρων ή προσδιορίστε μια υπάρχουσα ομάδα πόρων για την ανάπτυξη.

2.  Δημιουργία δημόσια διεύθυνση IP πόρου και πόρου NIC για τη νέα Εικονική. Για τα βήματα για να δημιουργήσετε μια εικονική δικτύου, δημόσια διεύθυνση IP και NIC χρησιμοποιώντας το CLI, ανατρέξτε στο θέμα νωρίτερα σε αυτό το άρθρο. (**Δημιουργία azure εικονική** επίσης να δημιουργήσετε ένα NIC, αλλά πρέπει να μεταβιβάσετε πρόσθετες παραμέτρους για μια εικονικού δικτύου και το δευτερεύον.)


Στη συνέχεια, εκτελέστε μια εντολή που μεταφέρει URIs στο νέο αρχείο VHD λειτουργικό σύστημα και την υπάρχουσα εικόνα. Σε αυτό το παράδειγμα, ένα μέγεθος Εικονική Standard_A1 δημιουργείται στην περιοχή Ανατολικής ΗΠΑ.

    azure vm create MyResourceGroup1 myNewVM eastus Linux -d "https://xxxxxxxxxxxxxx.blob.core.windows.net/vhds/MyNewVHDNamePrefix.vhd" -Q "https://xxxxxxxxxxxxxx.blob.core.windows.net/system/Microsoft.Compute/Images/vhds/MyVHDNamePrefix-osDisk.xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.vhd" -z Standard_A1 -u myAdminname -p myPassword -f myNIC

Για επιλογές πρόσθετων εντολών, εκτελέστε `azure help vm create`.

## <a name="next-steps"></a>Επόμενα βήματα

Για να διαχειριστείτε το ΣΠΣ με το CLI, δείτε τις εργασίες σε [ανάπτυξη και διαχείριση εικονικές μηχανές με τη χρήση προτύπων από διαχειριστή πόρων Azure και το Azure CLI](virtual-machines-linux-cli-deploy-templates.md).
