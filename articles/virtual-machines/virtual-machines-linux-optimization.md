<properties
    pageTitle="Βελτιστοποίηση του Εικονική Linux στην Azure | Microsoft Azure"
    description="Μάθετε μερικές συμβουλές για βελτιστοποίηση για να βεβαιωθείτε ότι έχετε ρυθμίσει το Εικονική Linux για βέλτιστη απόδοση σε Azure"
    keywords="Linux εικονικό υπολογιστή, linux εικονική μηχανή, ubuntu εικονική μηχανή" 
    services="virtual-machines-linux"
    documentationCenter=""
    authors="rickstercdn"
    manager="timlt"
    editor="tysonn"
    tags="azure-resource-manager" />

<tags
    ms.service="virtual-machines-linux"
    ms.workload="infrastructure-services"
    ms.tgt_pltfrm="vm-linux"
    ms.devlang="na"
    ms.topic="article"
    ms.date="09/06/2016"
    ms.author="rclaus"/>

# <a name="optimize-your-linux-vm-on-azure"></a>Βελτιστοποίηση του Εικονική Linux στο Azure

Δημιουργία μια εικονική μηχανή Linux (Εικονική) είναι εύκολο να κάνετε από τη γραμμή εντολών ή από την πύλη. Αυτό το πρόγραμμα εκμάθησης δείχνει πώς μπορείτε να βεβαιωθείτε ότι έχετε ρυθμίσει το για να βελτιστοποιήσετε την την απόδοση της πλατφόρμας Windows Azure. Αυτό το θέμα χρησιμοποιεί μια Εικονική Ubuntu Server, αλλά μπορείτε επίσης να δημιουργήσετε Linux εικονική μηχανή χρησιμοποιώντας [τις δικές σας εικόνες ως πρότυπα](virtual-machines-linux-create-upload-generic.md).  

## <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

Αυτό το θέμα προϋποθέτει ότι έχετε ήδη μια εργασία Azure συνδρομή ([δωρεάν δοκιμαστικής έκδοσης signup](https://azure.microsoft.com/pricing/free-trial/)), [εγκατεστημένο το CLI Azure](../xplat-cli-install.md) και έχουν παρασχεθεί ήδη μια Εικονική στη συνδρομή σας Azure. Πριν από την κάνοντας όλα με Azure - πρέπει να ελέγχουν την ταυτότητα στη συνδρομή σας. Για να το κάνετε αυτό με Azure CLI, απλώς πληκτρολογήστε `azure login` για να ξεκινήσετε τη διαδικασία αλληλεπιδραστικών. 

## <a name="azure-os-disk"></a>Azure δίσκου λειτουργικό σύστημα

Αφού δημιουργήσετε μια εικονική Linux στο Azure, που έχει δύο δίσκων που σχετίζονται με αυτό. /dev/sda είναι ο δίσκος λειτουργικό σύστημα, /dev/sdb είναι προσωρινό δίσκο σας.  Μην χρησιμοποιείτε το κύριο δίσκο λειτουργικό σύστημα (/ ανάπτυξης/sda) για όλα τα στοιχεία εκτός από το λειτουργικό σύστημα που είναι βελτιστοποιημένη για γρήγορη εκκίνηση Εικονική και δεν παρέχει καλή απόδοση για το φόρτο εργασίας. Που θέλετε να επισυνάψετε ένα ή περισσότερα δίσκων σας Εικονική για να λάβετε μόνιμη και βελτιστοποιηθεί χώρου αποθήκευσης για τα δεδομένα σας. 

## <a name="adding-disks-for-size-and-performance-targets"></a>Προσθήκη δίσκων για το μέγεθος και επιδόσεις των προορισμών 

Με βάση το μέγεθος Εικονική, μπορείτε να επισυνάψετε έως 16 επιπλέον δίσκων σε ένα A-σειρές, 32 δίσκων σε μια σειρά D και 64 δίσκων σε μια σειρά G υπολογιστή - κάθε έως 1 TB στο μέγεθος. Μπορείτε να προσθέσετε επιπλέον δίσκων σύμφωνα με τις ανάγκες ανά σας χώρο και τις απαιτήσεις IOP προέλευσης. Κάθε δίσκος έχει ο στόχος επιδόσεων του 500 IOP προέλευσης για τυπική χώρου αποθήκευσης και έως 5000 IOP προέλευσης ανά δίσκο για το χώρο αποθήκευσης Premium.  Για περισσότερες πληροφορίες σχετικά με το χώρο αποθήκευσης Premium δίσκων, ανατρέξτε στην [αποθήκευσης Premium: χώρος αποθήκευσης υψηλών επιδόσεων για ΣΠΣ Azure](../storage/storage-premium-storage.md)

Για να επιτύχετε την υψηλότερη IOP προέλευσης στο χώρο αποθήκευσης Premium δίσκων όπου τις ρυθμίσεις του cache έχει την τιμή "Μόνο για ανάγνωση" ή "Κανένα", πρέπει να απενεργοποιήσετε "εμπόδια" κατά την τοποθέτηση το σύστημα αρχείων στο Linux. Δεν χρειάζεται εμπόδια επειδή οι εγγραφές δίσκων αποθήκευσης Premium αντίγραφα είναι διαρκή για αυτές τις ρυθμίσεις του cache.

- Εάν χρησιμοποιείτε **reiserFS**, απενεργοποίηση εμπόδια χρησιμοποιώντας την επιλογή ενεργοποίησης "απομόνωσης = none" (για ενεργοποίηση εμπόδια, χρησιμοποιήστε το "απομόνωσης = στοίχιση")
- Εάν χρησιμοποιείτε το **ext3/ext4**, απενεργοποίηση εμπόδια χρησιμοποιώντας την επιλογή ενεργοποίησης "απομόνωσης = 0" (για ενεργοποίηση εμπόδια, χρησιμοποιήστε το "απομόνωσης = 1")
- Εάν χρησιμοποιείτε **XFS**, απενεργοποίηση εμπόδια χρησιμοποιώντας την επιλογή ενεργοποίησης "nobarrier" (για την ενεργοποίηση εμπόδια, χρησιμοποιήστε την επιλογή "απομόνωσης")

## <a name="storage-account-considerations"></a>Θέματα λογαριασμού χώρου αποθήκευσης

Όταν δημιουργείτε σας Εικονική Linux στο Azure, που πρέπει να βεβαιωθείτε ότι μπορείτε να επισυνάψετε δίσκων από λογαριασμούς χώρου αποθήκευσης που βρίσκονται στην ίδια περιοχή ως Εικονική σας για να βεβαιωθείτε ότι κοντά και Ελαχιστοποίηση λανθάνοντος χρόνου δικτύου.  Κάθε λογαριασμό τυπική αποθήκευσης περιλαμβάνει έως 20 k IOP προέλευσης και χωρητικότητα μέγεθος 500 TB.  Αυτό λειτουργεί για περίπου 40 δίσκων που χρησιμοποιήθηκαν σε μεγάλο βαθμό, συμπεριλαμβανομένων των ο δίσκος λειτουργικό σύστημα και οποιαδήποτε δίσκων δεδομένων που δημιουργείτε. Για λογαριασμούς Premium χώρου αποθήκευσης, δεν υπάρχει όριο μέγιστο IOP προέλευσης, αλλά υπάρχει ένα όριο μεγέθους 32 TB. 

Όταν ασχολείται με υψηλή φόρτους εργασίας IOP προέλευσης και έχετε επιλέξει τυπική χώρου αποθήκευσης για δίσκων σας, ίσως χρειαστεί να διαιρέσετε το δίσκων σε πολλαπλούς λογαριασμούς χώρου αποθήκευσης για να βεβαιωθείτε ότι δεν έχετε πατήσετε το όριο 20.000 IOP προέλευσης για λογαριασμούς τυπική χώρου αποθήκευσης. Εικονική σας μπορούν να περιέχουν συνδυασμό των δίσκων από σε διαφορετικό χώρο αποθήκευσης λογαριασμών και τύπων λογαριασμών χώρου αποθήκευσης για να επιτύχετε την βέλτιστη ρύθμιση παραμέτρων. 

## <a name="your-vm-temporary-drive"></a>Προσωρινό Εικονική μονάδα δίσκου σας

Από προεπιλογή όταν δημιουργείτε μια Εικονική Azure σάς παρέχει ένα λειτουργικό σύστημα (/ ανάπτυξης/sda) και ένα δίσκο προσωρινό (/ ανάπτυξης/sdb).  Προσθήκη όλων των επιπλέον δίσκων εμφανίζεται ως /dev/sdc, /dev/sdd, /dev/sde και ούτω καθεξής. Όλα τα δεδομένα σας στον προσωρινό δίσκο (/ ανάπτυξης/sdb) δεν είναι διαρκή και μπορεί να χαθούν εάν συγκεκριμένα συμβάντα όπως αλλαγή μεγέθους Εικονική, επανάληψη ανάπτυξης, ή συντήρηση επιβάλει επανεκκίνηση του Εικονική σας.  Το μέγεθος και τον τύπο του δίσκου σας προσωρινό σχετίζεται με το μέγεθος Εικονική που επιλέξατε κατά το χρόνο ανάπτυξης. Στην περίπτωση οποιαδήποτε από το μέγεθος premium ΣΠΣ (σειρά DS, G και DS_V2) την προσωρινή μονάδα δίσκου είναι αντίγραφα ασφαλείας μιας τοπικής SSD για επιπλέον απόδοση της έως 48 k IOP προέλευσης. 

## <a name="linux-swap-file"></a>Αρχείο Linux αντιμετάθεσης

Εάν σας Εικονική Azure προέρχεται από μια εικόνα Ubuntu ή CoreOS, στη συνέχεια, μπορείτε να χρησιμοποιήσετε CustomData για να στείλετε μια cloud-ρύθμισης παραμέτρων για την προετοιμασία cloud. Εάν έχετε [αποστείλει μια προσαρμοσμένη εικόνα Linux](virtual-machines-linux-upload-vhd.md) που χρησιμοποιεί την προετοιμασία cloud, μπορείτε επίσης ρυθμίστε τις παραμέτρους αντιμετάθεσης διαμερίσματα χρησιμοποιώντας την προετοιμασία cloud.

Από τις εικόνες Cloud Ubuntu, πρέπει να χρησιμοποιήσετε την προετοιμασία cloud για να ρυθμίσετε τα διαμερίσματα αντιμετάθεσης. Ανατρέξτε στο θέμα της σελίδας που ακολουθεί στο wiki Ubuntu για περισσότερες λεπτομέρειες: [AzureSwapPartitions](https://wiki.ubuntu.com/AzureSwapPartitions).

Εικόνες χωρίς την υποστήριξη cloud την προετοιμασία, εικόνες Εικονική αναπτυχθεί από το Azure Marketplace έχει έναν παράγοντα Linux Εικονική ενσωματωμένο με το λειτουργικό σύστημα. Αυτός ο παράγοντας επιτρέπει την εικονική Μηχανή για αλληλεπίδραση με τις διάφορες υπηρεσίες Azure. Υπό την προϋπόθεση ότι έχετε αναπτύξει μια τυπική εικόνα από το Azure Marketplace, θα πρέπει να κάνετε τα εξής για να σωστά τις παραμέτρους Linux αντιμετάθεσης αρχείο:

Εντοπισμός και τροποποίηση δύο καταχωρήσεις στο αρχείο **/etc/waagent.conf** . Ελέγχουν την ύπαρξη του αρχείο αποκλειστικό αντιμετάθεσης και το μέγεθος του αρχείου αντιμετάθεσης. Οι παράμετροι που θέλετε να τροποποιήσετε είναι `ResourceDisk.EnableSwap=N` και`ResourceDisk.SwapSizeMB=0` 

Πρέπει να αλλάξετε τους με το εξής:

* ResourceDisk.EnableSwap=Y
* ResourceDisk.SwapSizeMB={size σε MB για τις ανάγκες σας} 

Αφού έχετε κάνει την αλλαγή, θα πρέπει να επανεκκινήσετε το waagent ή να επανεκκινήσετε το Εικονική Linux ώστε να αντικατοπτρίζει αυτές τις αλλαγές.  Μπορείτε να γνωρίζετε τις αλλαγές που έχουν εφαρμοστεί και ένα αρχείο αντιμετάθεσης έχει δημιουργηθεί όταν χρησιμοποιείτε το `free` εντολή για να προβάλετε ελεύθερο χώρο. Το παρακάτω παράδειγμα έχει δημιουργηθεί ως αποτέλεσμα την τροποποίηση του αρχείου waagent.conf αρχείο αντιμετάθεσης 512MB.

    admin@mylinuxvm:~$ free
                total       used       free     shared    buffers     cached
    Mem:       3525156     804168    2720988        408       8428     633192
    -/+ buffers/cache:     162548    3362608
    Swap:       524284          0     524284
    admin@mylinuxvm:~$
 
## <a name="io-scheduling-algorithm-for-premium-storage"></a>Εισόδου/εξόδου προγραμματισμού αλγόριθμο για Premium χώρου αποθήκευσης

Με το 2.6.18 Linux πυρήνα, η προεπιλεγμένη εισόδου/εξόδου προγραμματισμού αλγόριθμο άλλαξε από προθεσμίας σε CFQ (πλήρως έκθεσης ουράς αλγόριθμος). Για μοτίβα εισόδου/εξόδου τυχαία πρόσβαση, υπάρχει ελάχιστος διαφορά στις επιδόσεις διαφορές μεταξύ της CFQ και της προθεσμίας.  Για βάσει SSD δίσκων όπου το μοτίβο εισόδου/εξόδου δίσκου είναι κυρίως διαδοχική, μετάβαση πίσω στον αλγόριθμο NOOP ή προθεσμία να επιτύχετε καλύτερες επιδόσεις εισόδου/εξόδου.

### <a name="view-the-current-io-scheduler"></a>Προβάλετε το τρέχον χρονοδιάγραμμα εισόδου/εξόδου

Χρησιμοποιήστε την ακόλουθη εντολή:  

    admin@mylinuxvm:~# cat /sys/block/sda/queue/scheduler

Θα δείτε παρακάτω εξόδου, που υποδηλώνει το τρέχον χρονοδιάγραμμα.  

    noop [deadline] cfq

###<a name="change-the-current-device-devsda-of-io-scheduling-algorithm"></a>Αλλάξτε την τρέχουσα συσκευή (/ ανάπτυξης/sda) της εισόδου/εξόδου προγραμματισμού αλγόριθμου

Χρησιμοποιήστε τις παρακάτω εντολές:  

    azureuser@mylinuxvm:~$ sudo su -
    root@mylinuxvm:~# echo "noop" >/sys/block/sda/queue/scheduler
    root@mylinuxvm:~# sed -i 's/GRUB_CMDLINE_LINUX=""/GRUB_CMDLINE_LINUX_DEFAULT="quiet splash elevator=noop"/g' /etc/default/grub
    root@mylinuxvm:~# update-grub

>[AZURE.NOTE] Ρύθμιση αυτής της πολιτικής για /dev/sda από μόνο του δεν είναι χρήσιμη. Πρέπει να οριστούν σε όλων των δεδομένων δίσκων όπου διαδοχικές εισόδου/εξόδου dominates το μοτίβο εισόδου/εξόδου.  

Θα πρέπει να βλέπετε το παρακάτω αποτέλεσμα, που υποδεικνύει ότι αυτό grub.cfg έχει αναδημιουργείται με επιτυχία και ότι το προεπιλεγμένο χρονοδιάγραμμα έχει ενημερωθεί σε NOOP.  

    Generating grub configuration file ...
    Found linux image: /boot/vmlinuz-3.13.0-34-generic
    Found initrd image: /boot/initrd.img-3.13.0-34-generic
    Found linux image: /boot/vmlinuz-3.13.0-32-generic
    Found initrd image: /boot/initrd.img-3.13.0-32-generic
    Found memtest86+ image: /memtest86+.elf
    Found memtest86+ image: /memtest86+.bin
    done

Για την οικογένεια διανομής Redhat, χρειάζεστε μόνο την ακόλουθη εντολή:   

    echo 'echo noop >/sys/block/sda/queue/scheduler' >> /etc/rc.local

## <a name="using-software-raid-to-achieve-higher-iops"></a>Χρησιμοποιώντας το λογισμικό RAID για να επιτύχετε υψηλότερη να / Ops

Εάν σας φόρτους εργασίας απαιτούν περισσότερες IOP προέλευσης από εκείνη που παρέχουν ένα μεμονωμένο δίσκο, πρέπει να χρησιμοποιήσετε μια ρύθμιση παραμέτρων RAID λογισμικού πολλών δίσκων. Επειδή το Azure εκτελεί ήδη δίσκου υποστηρίζεται στο επίπεδο του τοπικού ύφασμα, μπορείτε να επιτύχετε το υψηλότερο επίπεδο επιδόσεων από μια ρύθμιση παραμέτρων επιμερισμό RAID-0.  Πρέπει να προμηθεύσουν και δημιουργία νέων δίσκων στο περιβάλλον Azure και επισυνάψτε τις σε σας Εικονική Linux πριν από την διαμερισμάτων, μορφοποίηση και τοποθέτηση των μονάδων δίσκου.  Μπορείτε να βρείτε περισσότερες λεπτομέρειες σχετικά με τη ρύθμιση των παραμέτρων μια εγκατάσταση RAID λογισμικού σε σας Εικονική Linux στα azure στο έγγραφο **[Τη ρύθμιση των παραμέτρων του λογισμικού RAID σε Linux](virtual-machines-linux-configure-raid.md)** .


## <a name="next-steps"></a>Επόμενα βήματα

Να θυμάστε, καθώς με όλες τις συζητήσεις βελτιστοποίηση, πρέπει να εκτελέσετε δοκιμές πριν και μετά από κάθε αλλαγή, για να μετρήσετε την επίδραση που θα έχει την αλλαγή.  Βελτιστοποίηση είναι μια διαδικασία βήμα προς βήμα που θα έχει διαφορετικά αποτελέσματα σε διαφορετικούς υπολογιστές στο περιβάλλον σας.  Τι λειτουργεί για μία ρύθμιση παραμέτρων ενδέχεται να μην λειτουργεί για άλλους.

Ορισμένες χρήσιμες συνδέσεις για επιπλέον πόρους: 

- [Χώρος αποθήκευσης Premium: Χώρος αποθήκευσης υψηλών επιδόσεων για φόρτους εργασίας του Azure εικονική μηχανή](../storage/storage-premium-storage.md)
- [Οδηγός Azure Linux παράγοντα χρήστη](virtual-machines-linux-agent-user-guide.md)
- [Βελτιστοποίηση των επιδόσεων MySQL σε VM Azure Linux](virtual-machines-linux-classic-optimize-mysql.md)
- [Ρύθμιση παραμέτρων του λογισμικού RAID σε Linux](virtual-machines-linux-configure-raid.md)
