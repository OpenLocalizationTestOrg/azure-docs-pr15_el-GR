<properties
    pageTitle="Αυτόματη δημιουργία αντιγράφων ασφαλείας για SQL Server εικονικές μηχανές (Διαχείριση πόρων) | Microsoft Azure"
    description="Εξηγεί τη δυνατότητα αυτόματης δημιουργίας αντιγράφων ασφαλείας για τον SQL Server που εκτελείται σε εικονικές μηχανές Windows Azure χρησιμοποιώντας τη διαχείριση πόρων. "
    services="virtual-machines-windows"
    documentationCenter="na"
    authors="rothja"
    manager="jhubbard"
    editor=""
    tags="azure-resource-manager"/>
<tags
    ms.service="virtual-machines-windows"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="vm-windows-sql-server"
    ms.workload="infrastructure-services"
    ms.date="07/14/2016"
    ms.author="jroth" />

# <a name="automated-backup-for-sql-server-in-azure-virtual-machines-resource-manager"></a>Αυτόματη δημιουργία αντιγράφων ασφαλείας για τον SQL Server σε εικονικές μηχανές Windows (Διαχείριση πόρων) Azure

> [AZURE.SELECTOR]
- [Διαχείριση πόρων](virtual-machines-windows-sql-automated-backup.md)
- [Κλασικό](virtual-machines-windows-classic-sql-automated-backup.md)

Αυτόματη δημιουργία αντιγράφων ασφαλείας ρυθμίζει αυτόματα [Διαχειριζόμενων δημιουργίας αντιγράφων ασφαλείας του Microsoft Azure](https://msdn.microsoft.com/library/dn449496.aspx) για όλες τις υπάρχουσες και τις νέες βάσεις δεδομένων σε μια Εικονική Azure εκτελεί SQL Server 2014 Standard ή για μεγάλες επιχειρήσεις. Αυτό σας επιτρέπει να ρυθμίσετε τις παραμέτρους αντίγραφα ασφαλείας κανονική βάση δεδομένων που χρησιμοποιούν διαρκή αποθήκευσης blob του Azure. Αυτόματη δημιουργία αντιγράφων ασφαλείας εξαρτάται από την [Επέκταση παράγοντας IaaS του SQL Server](virtual-machines-windows-sql-server-agent-extension.md).

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-rm-include.md)]μοντέλο κλασική ανάπτυξης. Για να προβάλετε την κλασική έκδοση αυτού του άρθρου, ανατρέξτε στο θέμα [Αυτόματης δημιουργίας αντιγράφων ασφαλείας για τον SQL Server σε εικονικές μηχανές Azure κλασική](virtual-machines-windows-classic-sql-automated-backup.md).

## <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

Για να χρησιμοποιήσετε αυτόματης δημιουργίας αντιγράφων ασφαλείας, λάβετε υπόψη τις ακόλουθες προϋποθέσεις:

**Λειτουργικό σύστημα**:

- Windows Server 2012
- Windows Server 2012 R2

**Έκδοση SQL Server/edition**:

- Πρότυπο του SQL Server 2014
- SQL Server 2014 για μεγάλες επιχειρήσεις

**Ρύθμιση παραμέτρων βάσης δεδομένων**:

- Βάσεις δεδομένων προορισμού πρέπει να χρησιμοποιήσετε το μοντέλο πλήρους ανάκτησης

**Azure PowerShell**:

- [Εγκαταστήστε τις πιο πρόσφατες εντολές του PowerShell Azure](../powershell-install-configure.md) εάν σκοπεύετε να ρυθμίσετε τις παραμέτρους αυτόματης δημιουργίας αντιγράφων ασφαλείας με το PowerShell.

>[AZURE.NOTE] Αυτόματη δημιουργία αντιγράφων ασφαλείας εξαρτάται από την επέκταση παράγοντας SQL Server IaaS. Τρέχουσα SQL εικονική μηχανή συλλογή εικόνων προσθέστε αυτήν την επέκταση από προεπιλογή. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Επέκταση παράγοντας IaaS του SQL Server](virtual-machines-windows-sql-server-agent-extension.md).

## <a name="settings"></a>Ρυθμίσεις

Ο παρακάτω πίνακας περιγράφει τις επιλογές που μπορούν να ρυθμιστούν για αυτόματη δημιουργία αντιγράφων ασφαλείας. Τα βήματα ρύθμισης παραμέτρων πραγματικού ποικίλλουν ανάλογα με το εάν χρησιμοποιείτε το Azure πύλη ή τις εντολές του Azure Windows PowerShell.

|Ρύθμιση|Περιοχή (προεπιλογή)|Περιγραφή|
|---|---|---|
|**Αυτόματη δημιουργία αντιγράφων ασφαλείας**|Ενεργοποίηση/Απενεργοποίηση (απενεργοποιημένο)|Ενεργοποιεί ή απενεργοποιεί αυτόματης δημιουργίας αντιγράφων ασφαλείας για μια Εικονική Azure εκτελεί SQL Server 2014 Standard ή για μεγάλες επιχειρήσεις.|
|**Περίοδος διατήρησης**|1-30 ημέρες (30 ημέρες)|Ο αριθμός των ημερών για να διατηρήσετε ένα αντίγραφο ασφαλείας.|
|**Το λογαριασμό χώρου αποθήκευσης**|Λογαριασμός Azure χώρου αποθήκευσης (το λογαριασμό χώρου αποθήκευσης που έχει δημιουργηθεί για την καθορισμένη εικονική Μηχανή)|Ένας λογαριασμός Azure χώρου αποθήκευσης για να χρησιμοποιήσετε για την αποθήκευση αρχείων αυτόματης δημιουργίας αντιγράφων ασφαλείας στο χώρο αποθήκευσης αντικειμένων blob. Δημιουργείται ένα κοντέινερ σε αυτήν τη θέση για την αποθήκευση όλα τα αρχεία αντιγράφων ασφαλείας. Το αρχείο αντιγράφου ασφαλείας κανόνες ονοματοθεσίας περιλαμβάνει την ημερομηνία, ώρα και το όνομα του υπολογιστή.|
|**Κρυπτογράφηση**|Ενεργοποίηση/Απενεργοποίηση (απενεργοποιημένο)|Ενεργοποιεί ή απενεργοποιεί κρυπτογράφησης. Όταν είναι ενεργοποιημένη η κρυπτογράφηση, τα πιστοποιητικά που χρησιμοποιούνται για να επαναφέρετε το αντίγραφο ασφαλείας βρίσκονται στο λογαριασμό καθορισμένο χώρο αποθήκευσης στο ίδιο κοντέινερ automaticbackup χρησιμοποιώντας το ίδιο κανόνες ονοματοθεσίας. Εάν αλλάξει τον κωδικό πρόσβασης, δημιουργείται ένα νέο πιστοποιητικό με αυτόν τον κωδικό πρόσβασης, αλλά το παλιό πιστοποιητικό παραμένει για να επαναφέρετε εκ των προτέρων δημιουργίας αντιγράφων ασφαλείας.|
|**Κωδικός πρόσβασης**|Κείμενο τον κωδικό πρόσβασης (καμία)|Ένας κωδικός πρόσβασης για κλειδιά κρυπτογράφησης. Αυτό είναι μόνο απαιτείται εάν είναι ενεργοποιημένη η κρυπτογράφηση. Για να επαναφέρετε ένα κρυπτογραφημένο αντίγραφο ασφαλείας, πρέπει να έχετε το σωστό κωδικό πρόσβασης και σχετικές πιστοποιητικό που χρησιμοποιήθηκε κατά το χρόνο που λήφθηκε το αντίγραφο ασφαλείας.|

## <a name="configuration-in-the-portal"></a>Ρύθμιση παραμέτρων στην πύλη
Μπορείτε να χρησιμοποιήσετε την πύλη του Azure για ρύθμιση παραμέτρων αυτόματης δημιουργίας αντιγράφων ασφαλείας κατά την προμήθεια του ή για υπάρχοντα ΣΠΣ.

### <a name="new-vms"></a>Νέα ΣΠΣ
Χρησιμοποιήστε την πύλη του Azure για ρύθμιση παραμέτρων αυτόματης δημιουργίας αντιγράφων ασφαλείας, όταν δημιουργείτε μια νέα εικονική μηχανή του SQL Server 2014 στο μοντέλο ανάπτυξης διαχείρισης πόρων.

Στο blade του **SQL Server ρυθμίσεις** , επιλέξτε **αυτόματης δημιουργίας αντιγράφων ασφαλείας**. Το παρακάτω στιγμιότυπο οθόνης Azure πύλης εμφανίζει το blade **SQL αυτόματης δημιουργίας αντιγράφων ασφαλείας** .

![Ρύθμιση παραμέτρων SQL αυτόματης δημιουργίας αντιγράφων ασφαλείας στο Azure πύλη](./media/virtual-machines-windows-sql-automated-backup/azure-sql-arm-autobackup.png)

Για το περιβάλλον, ανατρέξτε στο θέμα ολοκλήρωσης στην [προμήθεια μια εικονική μηχανή SQL Server στο Azure](virtual-machines-windows-portal-sql-server-provision.md).

### <a name="existing-vms"></a>Υπάρχουσα ΣΠΣ
Για υπάρχοντα εικονικές μηχανές SQL Server, επιλέξτε την εικονική μηχανή SQL Server. Στη συνέχεια, επιλέξτε την ενότητα **ρύθμισης παραμέτρων του SQL Server** από το blade **Ρυθμίσεις** .

![SQL αυτόματης δημιουργίας αντιγράφων ασφαλείας για υπάρχοντα ΣΠΣ](./media/virtual-machines-windows-sql-automated-backup/azure-sql-rm-autobackup-existing-vms.png)

Στο το blade **ρύθμισης παραμέτρων του SQL Server** , κάντε κλικ στο κουμπί **Επεξεργασία** στην ενότητα αυτόματης δημιουργίας αντιγράφων ασφαλείας.

![Ρύθμιση παραμέτρων του SQL αυτόματης δημιουργίας αντιγράφων ασφαλείας για υπάρχοντα ΣΠΣ](./media/virtual-machines-windows-sql-automated-backup/azure-sql-rm-autobackup-configuration.png)

Όταν τελειώσετε, κάντε κλικ στο κουμπί **OK** στο κάτω μέρος του blade **ρύθμισης παραμέτρων του SQL Server** για να αποθηκεύσετε τις αλλαγές σας.

Εάν ενεργοποιήσετε αυτόματης δημιουργίας αντιγράφων ασφαλείας για πρώτη φορά, Azure ρυθμίζει τις παραμέτρους του SQL Server IaaS Agent στο παρασκήνιο. Σε αυτό το διάστημα, η πύλη του Azure μπορεί να μην εμφανίζεται ότι έχει ρυθμιστεί αυτόματης δημιουργίας αντιγράφων ασφαλείας. Περιμένετε μερικά λεπτά για τον παράγοντα για την εγκατάσταση, να ρυθμίσει τις παραμέτρους. Μετά από αυτό το Azure πύλη θα αντανακλούν τις νέες ρυθμίσεις.

>[AZURE.NOTE] Μπορείτε επίσης να ρυθμίσετε την αυτόματη δημιουργία αντιγράφων ασφαλείας χρησιμοποιώντας ένα πρότυπο. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [πρότυπο Azure γρήγορης έναρξης για αυτόματη δημιουργία αντιγράφων ασφαλείας](https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-sql-existing-autobackup-update).

## <a name="configuration-with-powershell"></a>Ρύθμιση παραμέτρων με το PowerShell

Μετά την προμήθεια του Εικονική SQL, χρήση του PowerShell για τη ρύθμιση παραμέτρων αυτόματης δημιουργίας αντιγράφων ασφαλείας.

Στο παρακάτω παράδειγμα PowerShell, αυτόματης δημιουργίας αντιγράφων ασφαλείας έχει ρυθμιστεί για μια υπάρχουσα Εικονική 2014 του SQL Server. Η εντολή **AzureRM.Compute\New AzureVMSqlServerAutoBackupConfig** ρυθμίζει τις ρυθμίσεις αυτόματης δημιουργίας αντιγράφων ασφαλείας για την αποθήκευση αντιγράφων ασφαλείας στο λογαριασμό Azure χώρου αποθήκευσης που σχετίζεται με την εικονική μηχανή. Αυτά τα αντίγραφα ασφαλείας θα διατηρηθούν για 10 ημερών. Η εντολή **Set-AzureRmVMSqlServerExtension** ενημερώνει το καθορισμένο Εικονική Azure με αυτές τις ρυθμίσεις.

    $vmname = "vmname"
    $resourcegroupname = "resourcegroupname"
    $autobackupconfig = AzureRM.Compute\New-AzureVMSqlServerAutoBackupConfig -Enable -RetentionPeriodInDays 10 -ResourceGroupName $resourcegroupname

    Set-AzureRmVMSqlServerExtension -AutoBackupSettings $autobackupconfig -VMName $vmname -ResourceGroupName $resourcegroupname

Μπορεί να χρειαστούν αρκετά λεπτά για την εγκατάσταση και ρύθμιση παραμέτρων παράγοντα IaaS του SQL Server.

Για να ενεργοποιήσετε την κρυπτογράφηση, τροποποιήστε την προηγούμενη δέσμη ενεργειών για τη μεταβίβαση την παράμετρο **EnableEncryption** μαζί με έναν κωδικό πρόσβασης (ασφαλής συμβολοσειρά) για την παράμετρο **CertificatePassword** . Η ακόλουθη δέσμη ενεργειών ενεργοποιεί τις ρυθμίσεις αυτόματης δημιουργίας αντιγράφων ασφαλείας στο προηγούμενο παράδειγμα και προσθέτει κρυπτογράφησης.

    $vmname = "vmname"
    $resourcegroupname = "resourcegroupname"
    $password = "P@ssw0rd"
    $encryptionpassword = $password | ConvertTo-SecureString -AsPlainText -Force  
    $autobackupconfig = AzureRM.Compute\New-AzureVMSqlServerAutoBackupConfig -Enable -RetentionPeriod 10 -EnableEncryption -CertificatePassword $encryptionpassword -ResourceGroupName $resourcegroupname

    Set-AzureRmVMSqlServerExtension -AutoBackupSettings $autobackupconfig -VMName $vmname -ResourceGroupName $resourcegroupname

Για να απενεργοποιήσετε την αυτόματη δημιουργία αντιγράφων ασφαλείας, εκτελέστε την ίδια δέσμη ενεργειών χωρίς το **-Ενεργοποίηση** παράμετρος για την εντολή **AzureRM.Compute\New AzureVMSqlServerAutoBackupConfig** . Δεν υπάρχει το **-Ενεργοποίηση** παραμέτρου σήματα την εντολή για να απενεργοποιήσετε τη δυνατότητα. Όπως με την εγκατάσταση, μπορεί να χρειαστούν αρκετά λεπτά για να απενεργοποιήσετε την αυτόματη δημιουργία αντιγράφων ασφαλείας.

>[AZURE.NOTE] Κατάργηση παράγοντα IaaS του SQL Server δεν καταργεί τις ρυθμίσεις αυτόματης δημιουργίας αντιγράφων ασφαλείας προηγουμένως έχει ρυθμιστεί. Θα πρέπει να απενεργοποιήσετε την αυτόματη δημιουργία αντιγράφων ασφαλείας πριν από την απενεργοποίηση ή κατάργηση της εγκατάστασης του SQL Server IaaS Agent.

## <a name="next-steps"></a>Επόμενα βήματα

Αυτόματη δημιουργία αντιγράφων ασφαλείας ρυθμίζει τις παραμέτρους διαχειριζόμενων αντίγραφο ασφαλείας ΣΠΣ Azure. Επομένως, είναι σημαντικό να [αναθεωρήσετε την τεκμηρίωση για δημιουργία αντιγράφων ασφαλείας διαχειριζόμενων](https://msdn.microsoft.com/library/dn449496.aspx) για να κατανοήσετε τη συμπεριφορά και τις συνέπειες.

Μπορείτε να βρείτε πρόσθετες δημιουργίας αντιγράφων ασφαλείας και να επαναφέρετε οδηγίες για τον SQL Server σε VM Azure στο ακόλουθο θέμα: [Δημιουργία αντιγράφων ασφαλείας και επαναφοράς για τον SQL Server σε εικονικές μηχανές Windows Azure](virtual-machines-windows-sql-backup-recovery.md).

Για πληροφορίες σχετικά με άλλες εργασίες διαθέσιμη αυτοματισμού, ανατρέξτε στο θέμα [Επέκταση παράγοντας IaaS του SQL Server](virtual-machines-windows-sql-server-agent-extension.md).

Για περισσότερες πληροφορίες σχετικά με την εκτέλεση του SQL Server σε VM Azure, ανατρέξτε στο θέμα [SQL Server σε εικονικές μηχανές Windows Azure Επισκόπηση](virtual-machines-windows-sql-server-iaas-overview.md).
