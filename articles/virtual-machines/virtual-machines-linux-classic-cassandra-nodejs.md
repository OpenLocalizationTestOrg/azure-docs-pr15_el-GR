<properties
    pageTitle="Εκτελέστε Cassandra με Linux στο Azure | Microsoft Azure"
    description="Πώς μπορείτε να εκτελέσετε ένα σύμπλεγμα Cassandra στο Linux σε εικονικές μηχανές Windows Azure από μια εφαρμογή Node.js"
    services="virtual-machines-linux"
    documentationCenter="nodejs"
    authors="hanuk"
    manager="wpickett"
    editor=""
    tags="azure-service-management"/>

<tags
    ms.service="virtual-machines-linux"
    ms.workload="infrastructure-services"
    ms.tgt_pltfrm="vm-linux"
    ms.devlang="na"
    ms.topic="article"
    ms.date="08/11/2016"
    ms.author="hanuk;robmcm"/>

# <a name="running-cassandra-with-linux-on-azure-and-accessing-it-from-nodejs"></a>Εκτέλεση Cassandra με Linux σε Azure και την πρόσβαση από Node.js

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-classic-include.md)]Μάθετε πώς μπορείτε να [εκτελέσετε αυτά τα βήματα χρησιμοποιώντας το μοντέλο από διαχειριστή πόρων](https://azure.microsoft.com/documentation/templates/datastax-on-ubuntu/).

## <a name="overview"></a>Επισκόπηση
Microsoft Azure είναι μια πλατφόρμα Άνοιγμα cloud που εκτελείται και τα δύο Microsoft ως επίσης και ως μη-λογισμικό της Microsoft που περιλαμβάνει λειτουργικά συστήματα, διακομιστές εφαρμογών, ανταλλαγής μηνυμάτων ενδιάμεσο καθώς και SQL και NoSQL βάσεις δεδομένων από δύο μοντέλα εμπορικό "και" Άνοιγμα αρχείου προέλευσης. Δημιουργία είναι ανθεκτικά υπηρεσίες σε δημόσια σύννεφων, συμπεριλαμβανομένων των Azure απαιτεί Προσέξτε σχεδιασμό και την αρχιτεκτονική συγκεκριμένης για τους δύο διακομιστές εφαρμογές ως επίπεδα και χώρου αποθήκευσης. Αρχιτεκτονική κατανέμεται αποθήκευσης του Cassandra βοηθά ομαλά κατά τη δημιουργία ιδιαίτερα διαθέσιμα συστήματα που έχουν ανοχή για αποτυχίες σύμπλεγμα. Cassandra είναι κλίμακα cloud NoSQL βάσης δεδομένων να διατηρηθεί από Apache λογισμικό Foundation σε cassandra.apache.org; Cassandra είναι γραμμένο σε Java και επομένως εκτελεί και στις δύο στο Windows, καθώς και Linux πλατφόρμες.

Σε αυτό το άρθρο εστιάζει για να εμφανίσετε Cassandra ανάπτυξης στην Ubuntu ως ένα σύμπλεγμα μεμονωμένων και πολλαπλών δεδομένων κέντρου αξιοποίηση εικονικές μηχανές Windows Azure Microsoft και εικονικού δίκτυα. Ανάπτυξη συμπλέγματος για παραγωγής βελτιστοποιημένη φόρτους εργασίας είναι εκτός των εμβέλεια αυτού του άρθρου ως απαιτεί ρύθμιση παραμέτρων κόμβου πολλών δίσκου, σχεδίαση τοπολογία κατάλληλο δακτυλίων και μοντελοποίηση για την υποστήριξη του απαιτείται αναπαραγωγής, συνέπεια δεδομένων, μετάδοσης και απαιτήσεις υψηλή διαθεσιμότητα δεδομένων.

Σε αυτό το άρθρο έχει μια θεμελιώδεις προσέγγιση για την εμφάνιση τι περιλαμβάνεται κατά τη δημιουργία του συμπλέγματος Cassandra σε σύγκριση Docker, Chef ή Puppet που διευκολύνει την ανάπτυξη υποδομής συχνά.  

## <a name="the-deployment-models"></a>Τα μοντέλα ανάπτυξης
Microsoft Azure δικτύωση που επιτρέπει την ανάπτυξη απομόνωσης ιδιωτικό συμπλεγμάτων, την πρόσβαση των οποίων μπορεί να περιοριστεί για την επίτευξη ασφάλεια κανονικά κοκκώδης δικτύου.  Δεδομένου ότι σε αυτό το άρθρο σχετικά με την εμφάνιση της ανάπτυξης Cassandra σε θεμελιώδεις επίπεδο, θα σας δεν θα εστίαση σε επίπεδο της συνέπειας και της σχεδίασης βέλτιστη χώρου αποθήκευσης για μετάδοσης. Εδώ είναι η λίστα των δικτύωσης απαιτήσεις για το σύμπλεγμα υποθετική:

- Εξωτερικά συστήματα δεν είναι δυνατό να έχουν πρόσβαση σε βάση δεδομένων Cassandra από εντός ή εκτός Azure
- Σύμπλεγμα Cassandra πρέπει να βρίσκεται πίσω από μια μονάδα εξισορρόπησης φόρτου για την κίνηση thrift
- Αναπτύξτε τους κόμβους Cassandra σε δύο ομάδες σε κάθε κέντρο δεδομένων για ένα βελτιωμένο σύμπλεγμα διαθεσιμότητα
- Κλείδωμα προς τα κάτω στο σύμπλεγμα επομένως που μόνο σύμπλεγμα διακομιστών εφαρμογή έχει απευθείας πρόσβαση στη βάση δεδομένων
- Δεν υπάρχει δημόσια κοινωνικής δικτύωσης τελικά σημεία εκτός από το SSH
- Κάθε κόμβο Cassandra χρειάζεται μια σταθερή εσωτερική διεύθυνση IP

Cassandra μπορεί να αναπτυχθεί σε μία μόνο περιοχή Azure ή σε πολλές περιοχές με βάση τη φύση κατανέμεται των το φόρτο εργασίας. Μοντέλο ανάπτυξης πολλών περιοχών μπορούν να χρησιμοποιηθούν για να εξυπηρετήσει στους τελικούς χρήστες πιο κοντά σε ένα συγκεκριμένο Γεωγραφία έως την ίδια υποδομή Cassandra. Του Cassandra ενσωματωμένη κόμβο αναπαραγωγής παίρνει περίθαλψη του συγχρονισμού πολλών κύριας γράφει που προέρχονται από πολλές κέντρα δεδομένων και παρουσιάζει μια συνεπή προβολή των δεδομένων για τις εφαρμογές. Ανάπτυξη πολλών περιοχών επίσης μπορεί να σας βοηθήσει με την μετριασμού κινδύνου από το ευρύτερης ΡΕΥΜΑΤΟΣ Azure υπηρεσίας. Tunable συνέπειας της Cassandra και τοπολογία αναπαραγωγής θα σας βοηθήσουν στη σύσκεψη διαφορετικές ανάγκες RPO εφαρμογών.

### <a name="single-region-deployment"></a>Μόνο περιοχή ανάπτυξης
Θα ξεκινήσετε με μια ανάπτυξη μόνο περιοχή και να συγκεντρώσετε τα learnings στη δημιουργία ενός μοντέλου πολλών περιοχών. Azure εικονικό δίκτυο θα χρησιμοποιηθεί για τη δημιουργία απομόνωσης δευτερεύοντα δίκτυα ώστε να πληρούνται οι απαιτήσεις ασφαλείας δικτύου που αναφέρονται παραπάνω.  Χρησιμοποιεί τη διαδικασία που περιγράφεται στη δημιουργία ανάπτυξης μόνο περιοχή Ubuntu 14.04 Αποτελεσμάτων και Cassandra 2.08; Ωστόσο, η διαδικασία εύκολα να υιοθετήσει για τις άλλες παραλλαγές Linux. Ακολουθούν ορισμένα από τα χαρακτηριστικά η της ανάπτυξης μία περιοχή.  

**Υψηλή διαθεσιμότητα:** Οι κόμβοι Cassandra φαίνεται στην εικόνα του 1 έχουν αναπτυχθεί σε δύο σύνολα διαθεσιμότητα, έτσι ώστε οι κόμβοι μεταδίδονται ανάμεσα σε πολλούς τομείς σφαλμάτων για υψηλή διαθεσιμότητα. ΣΠΣ με σχόλια με κάθε σύνολο διαθεσιμότητα έχει αντιστοιχιστεί σε 2 τομείς σφαλμάτων.  Microsoft Azure χρησιμοποιεί την έννοια της βλάβης τομέα για τη Διαχείριση χρόνου μη προγραμματισμένη προς τα κάτω (π.χ. αποτυχίες υλικού ή λογισμικού) κατά την έννοια της αναβάθμισης τομέα (π.χ. host ή επισκέπτη OS ενημερωμένων/αναβαθμίσεις, εφαρμογή αναβαθμίσεις) χρησιμοποιείται για τη Διαχείριση προγραμματισμένη χρόνου εκτός λειτουργίας. Ελέγξτε ανατρέξτε στο θέμα [Αποκατάσταση και υψηλή διαθεσιμότητα για τις εφαρμογές του Azure](http://msdn.microsoft.com/library/dn251004.aspx) για το ρόλο του σφάλματος και αναβάθμιση τομέων στο επίτευξη υψηλής διαθεσιμότητας.

![Μόνο περιοχή ανάπτυξης](./media/virtual-machines-linux-classic-cassandra-nodejs/cassandra-linux1.png)

Εικόνα 1: Μία μόνο περιοχή ανάπτυξης

Σημειώστε ότι προς το παρόν, Azure δεν σας επιτρέπει την ρητή αντιστοίχιση μιας ομάδας ΣΠΣ τομέα ένα συγκεκριμένο σφάλμα. Επομένως, ακόμα και με το μοντέλο ανάπτυξης που φαίνεται στην εικόνα 1, είναι στατιστικά πιθανό ότι μπορεί να έχουν αντιστοιχιστεί όλες τις εικονικές μηχανές και στους δύο τομείς σφαλμάτων αντί για τέσσερις.

**Thrift κίνηση εξισορρόπηση φόρτου:** Βιβλιοθήκες προγράμματος-πελάτη thrift μέσα στο διακομιστή web, συνδεθείτε με το σύμπλεγμα μέσω μιας εσωτερικής εξισορρόπηση φόρτου. Αυτή η ενέργεια απαιτεί τη διαδικασία προσθήκης του εσωτερικού εξισορρόπηση φόρτου στο υποδίκτυο "δεδομένα" (ανατρέξτε σχήμα 1) στο περιβάλλον της υπηρεσίας cloud φιλοξενίας του συμπλέγματος Cassandra. Αφού καθοριστεί το εσωτερικό εξισορρόπηση φόρτου, κάθε κόμβο απαιτεί το τελικό σημείο εξισορρόπησης φόρτου που θα προστεθεί με τα σχόλια από ένα σύνολο εξισορρόπησης φόρτου με όνομα εξισορρόπησης φόρτου παλιότερα καθορισμένη. Για περισσότερες λεπτομέρειες, ανατρέξτε στο θέμα [Azure εσωτερικό εξισορρόπηση ](../load-balancer/load-balancer-internal-overview.md).

**Συμπλέγματος σπόροι:** Είναι σημαντικό για να επιλέξετε τα περισσότερα ιδιαίτερα διαθέσιμοι κόμβοι για σπόρους, όπως το νέο κόμβους θα επικοινωνία με τους κόμβους σπόρων για να ανακαλύψετε την τοπολογία του συμπλέγματος. Έναν κόμβο από κάθε σύνολο διαθεσιμότητα ορίζεται ως κόμβοι σπόρων για να αποφύγετε μοναδικό σημείο αποτυχίας.

**Επίπεδο συνέπειας και παραγόντων αναπαραγωγής:** Cassandra της ενσωματωμένης υψηλής διαθεσιμότητας και δεδομένα διάρκεια ζωής χαρακτηρίζεται από το συντελεστή αναπαραγωγής (RF - αριθμό αντιγράφων του κάθε γραμμή που είναι αποθηκευμένη στο σύμπλεγμα) και το επίπεδο συνέπειας (αριθμός αντίγραφα για ανάγνωση/εγγραφή πριν να επιστρέφει το αποτέλεσμα για να τον καλούντα). Αναπαραγωγή παραγόντων καθορίζεται κατά τη δημιουργία KEYSPACE (παρόμοια με μια σχεσιακή βάση δεδομένων) ότι έχει καθοριστεί το επίπεδο συνέπειας κατά έκδοσης του ερωτήματος CRUD. Ανατρέξτε στην τεκμηρίωση Cassandra στο θέμα [Ρύθμιση παραμέτρων για συνέπεια](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) για λεπτομέρειες συνέπειας και τον τύπο για υπολογισμό απαρτίας.

Cassandra υποστηρίζει δύο τύποι μοντέλων ακεραιότητας δεδομένων – συνέπειας και ενδεχόμενες συνέπειας; το επίπεδο συνέπειας και παραγόντων αναπαραγωγής μαζί θα καθορίσει εάν τα δεδομένα θα είναι συνεπείς με μια λειτουργία εγγραφής έχει ολοκληρωθεί ή θα εμφανίσει συνεπή. Για παράδειγμα, καθορίζοντας ΑΠΑΡΤΊΑΣ, όπως το επίπεδο συνέπειας θα πάντα εξασφαλίζει ότι δεδομένα συνέπειας ενώ οποιοδήποτε επίπεδο συνέπειας, κάτω από τον αριθμό των αντίγραφα να εισαχθούν όπως απαιτείται για την επίτευξη ΑΠΑΡΤΊΑΣ (π.χ. ΜΊΑ) έχει ως αποτέλεσμα δεδομένων που τελικά συνεπή.

Το σύμπλεγμα 8 κόμβου φαίνεται παραπάνω, με συντελεστή αναπαραγωγής του 3 και ΑΠΑΡΤΊΑΣ (2 κόμβους ανάγνωση ή εγγραφή για συνέπεια) ανάγνωσης/εγγραφής επίπεδο συνέπειας, κατά την απώλεια θεωρητική τις πιο 1 κόμβο ανά ομάδα αναπαραγωγής πριν από την έναρξη εφαρμογής παρατηρώντας την αποτυχία. Αυτό προϋποθέτει ότι όλα κλειδιού κενά επίσης και έχετε εξισορρόπηση ανάγνωσης/εγγραφής αιτήσεις.  Ακολουθούν οι παράμετροι θα χρησιμοποιήσουμε για το σύμπλεγμα ανεπτυγμένος:

Ρύθμιση παραμέτρων συμπλέγματος Cassandra μόνο περιοχή:

| Η παράμετρος συμπλέγματος | Τιμή | Παρατηρήσεις |
| ----------------- | ----- | ------- |
| Αριθμός κόμβους (N) | 8   | Συνολικός αριθμός των κόμβους του συμπλέγματος |
| Συντελεστής αναπαραγωγής (RF) | 3 | Αριθμός αντίγραφα μιας συγκεκριμένης σειράς |
| Επίπεδο συνέπειας (εγγραφή) | QUORUM[(RF/2) +1) = 2] το αποτέλεσμα του τύπου στρογγυλοποιείται προς τα κάτω | Συντάσσει τις πιο 2 αντίγραφα πριν από την αποστολή της απόκρισης για να τον καλούντα; 3η ρεπλίκα είναι γραμμένο σε μη τελικά συνεπή τρόπο. |
| Επίπεδο συνέπειας (για ανάγνωση) | ΑΠΑΡΤΊΑΣ [(RF/2) + 1 = 2] το αποτέλεσμα του τύπου στρογγυλοποιείται προς τα κάτω | Διαβάζει 2 αντίγραφα πριν από την αποστολή απόκρισης για να τον καλούντα. |
| Στρατηγική αναπαραγωγής | NetworkTopologyStrategy ανατρέξτε στο θέμα [Αναπαραγωγή δεδομένων](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) στο Cassandra τεκμηρίωση για περισσότερες πληροφορίες | Κατανόηση της τοπολογίας ανάπτυξης και τοποθετεί αντίγραφα σε κόμβους, έτσι ώστε όλα τα αντίγραφα του δεν καταλήγουν στο ίδιο rack |
| Snitch | GossipingPropertyFileSnitch ανατρέξτε στο θέμα [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) στην τεκμηρίωση Cassandra για περισσότερες πληροφορίες | NetworkTopologyStrategy χρησιμοποιεί μια έννοια της snitch Κατανόηση της τοπολογίας. GossipingPropertyFileSnitch παρέχει καλύτερο έλεγχο στην αντιστοίχιση κάθε κόμβο στο κέντρο δεδομένων και rack. Στη συνέχεια, το σύμπλεγμα χρησιμοποιεί Κουτσομπολιά για μεταδοθούν αυτές τις πληροφορίες. Αυτό είναι απλουστεύοντας σε δυναμική ρύθμιση IP σε σχέση με PropertyFileSnitch |


**Azure ζητήματα για σύμπλεγμα Cassandra:** Δυνατότητα εικονικές μηχανές Windows Azure Microsoft χρησιμοποιεί χώρο αποθήκευσης αντικειμένων Blob του Azure για διατήρηση δίσκου; Azure αποθήκευσης αποθηκεύει 3 αντίγραφα του κάθε δίσκο για υψηλή διάρκεια ζωής. Αυτό σημαίνει ότι κάθε γραμμή των δεδομένων που έχουν εισαχθεί σε έναν πίνακα Cassandra είναι ήδη αποθηκευμένο στη 3 αντίγραφα και επομένως συνέπεια δεδομένων είναι ήδη ληφθεί φροντίσει ακόμα και αν το συντελεστή αναπαραγωγής (RF) είναι 1. Το κύριο πρόβλημα με συντελεστή αναπαραγωγής που 1 είναι ότι η εφαρμογή θα είναι η εμπειρία χρόνου εκτός λειτουργίας ακόμα και εάν αποτύχει έναν μεμονωμένο κόμβο Cassandra. Ωστόσο, εάν ένας κόμβος είναι προς τα κάτω για τα προβλήματα (π.χ. υλικό, λογισμικό αποτυχιών του συστήματος) που αναγνωρίζεται από το Azure ύφασμα ελεγκτή, θα προμήθεια έναν νέο κόμβο στη θέση χρησιμοποιώντας την ίδια μονάδες χώρου αποθήκευσης. Προμήθεια έναν νέο κόμβο για να αντικαταστήσετε το παλαιό ενδέχεται να χρειαστούν μερικά λεπτά.  Ομοίως για προγραμματισμένη συντήρηση δραστηριότητες όπως αλλαγές OS επισκέπτη, αναβαθμίζει Cassandra και αλλαγές εφαρμογής ελεγκτή ύφασμα Azure εκτελεί αναβαθμίσεις του τους κόμβους του συμπλέγματος.  Επίσης αναβαθμίσεις ενδέχεται να χρειαστούν προς τα κάτω μερικά κόμβους κάθε φορά και επομένως το σύμπλεγμα ενδέχεται να αντιμετωπίσετε σύντομη χρόνου εκτός λειτουργίας για ορισμένα διαμερίσματα. Ωστόσο, τα δεδομένα δεν θα χαθούν λόγω το ενσωματωμένο πλεονασμού αποθήκευσης Azure.  

Για συστήματα αναπτυχθεί σε Azure που δεν απαιτούν υψηλής διαθεσιμότητας (π.χ. γύρω από 99,9 που είναι ισοδύναμη με 8.76 ώρες/έτος, ανατρέξτε στο θέμα [Υψηλής διαθεσιμότητας](http://en.wikipedia.org/wiki/High_availability) για λεπτομέρειες) ενδέχεται να μπορείτε να εκτελέσετε με RF = 1 και επιπέδου συνέπειας = ΜΊΑ.  Για τις εφαρμογές με τις απαιτήσεις υψηλής διαθεσιμότητας, RF = 3 και το επίπεδο συνέπειας = ΑΠΑΡΤΊΑΣ θα να αποδεχτεί τις το χρόνο προς τα κάτω έναν από τους κόμβους ένα από τα αντίγραφα. RF = 1 στο παραδοσιακό αναπτύξεις (π.χ. εσωτερική εγκατάσταση) δεν μπορούν να χρησιμοποιηθούν λόγω την πιθανή απώλεια δεδομένων που προκύπτει από προβλήματα όπως αποτυχίες δίσκου.   

## <a name="multi-region-deployment"></a>Ανάπτυξη πολλών περιοχών
Βοηθά του Cassandra δεδομένων κέντρου-αναγνωρίζουν αναπαραγωγής και τη συνέπεια μοντέλο που περιγράφεται παραπάνω με την ανάπτυξη πολλών περιοχών από το πλαίσιο χωρίς να χρειάζεται οποιαδήποτε εξωτερικών tooling. Αυτό είναι αρκετά διαφορετική από την παραδοσιακή σχεσιακές βάσεις δεδομένων όπου μπορεί να είναι αρκετά πολύπλοκη τη ρύθμιση για τη δημιουργία ειδώλου βάσης δεδομένων για πολλαπλές εγγραφές. Cassandra σε μια περιοχή πολλών ρύθμιση μπορεί να σας βοηθήσει με τα σενάρια χρήσης, συμπεριλαμβανομένων των εξής:

**Εγγύτητα βάσει ανάπτυξης:** Εφαρμογές πολλών μισθωτών, με Απαλοιφή αντιστοίχιση χρηστών μισθωτή-σε-περιοχή, μπορεί να είναι τύχει μέσω των αδρανειών χαμηλής του συμπλέγματος πολλών περιοχών. Για παράδειγμα ένα διαχείρισης εκμάθησης για συστήματα για εκπαιδευτικά ιδρύματα να αναπτύξετε ένα σύμπλεγμα κατανέμεται στις περιοχές Ανατολικής ΗΠΑ και Δυτική η.π.α., για να εξυπηρετήσει τα αντίστοιχα campuses για συναλλαγών καθώς και ανάλυση. Τα δεδομένα μπορεί να είναι συνεπείς τοπικά στο τη φορά ανάγνωσης και εγγραφής και μπορεί να εμφανίσει συνεπείς σε δύο τις περιοχές. Υπάρχουν άλλα παραδείγματα όπως πολυμέσων διανομής ηλεκτρονικού εμπορίου και όλα τα στοιχεία και όλα τα στοιχεία που χρησιμοποιείται βάσης παν πυκνό χρήστη είναι μια υπόθεση χρήσης καλή για αυτό το μοντέλο ανάπτυξης.

**Υψηλή διαθεσιμότητα:** Πλεονασμού είναι κλειδιού συντελεστής επίτευξη υψηλή διαθεσιμότητα του λογισμικού και υλικού. Για λεπτομέρειες, ανατρέξτε δόμησης αξιόπιστη συστήματα Cloud στο Microsoft Azure. Στο Microsoft Azure, ο τρόπος μόνο αξιόπιστη την επίτευξη αληθής πλεονασμού είναι ένα σύμπλεγμα πολλών περιοχών για την ανάπτυξη. Εφαρμογές μπορεί να αναπτυχθεί σε μια λειτουργία ενεργούς ή ενεργό παθητικές και εάν μία από τις περιοχές προς τα κάτω, Διαχείριση κίνηση Azure να ανακατευθύνετε την κίνηση στην περιοχή ενεργό.  Με την ανάπτυξη μόνο περιοχή, στην περίπτωση που η διαθεσιμότητα 99,9, μια περιοχή δύο ανάπτυξη να επιτύχετε διαθεσιμότητα του 99.9999 υπολογιστεί από τον τύπο: (1-(1-0.999) *(1-0.999))*100); ανατρέξτε στο θέμα παραπάνω χαρτιού για λεπτομέρειες.

**Αποκατάσταση:** Σύμπλεγμα Cassandra πολλών περιοχών, εάν έχει σχεδιαστεί σωστά, μπορεί να δέχονται ΡΕΥΜΑΤΟΣ κέντρο καταστροφική δεδομένων. Εάν μία περιοχή είναι προς τα κάτω, αναπτυχθεί σε άλλες περιοχές μπορούν να η εκκίνηση της εφαρμογής που εξυπηρετούν τους τελικούς χρήστες. Όπως τυχόν άλλες επιχειρήσεις συνέχειας εφαρμογές, η εφαρμογή πρέπει να έχει ανοχή σφαλμάτων για ορισμένες απώλεια δεδομένων που προκύπτει από τα δεδομένα στη διοχέτευση ασύγχρονης. Ωστόσο, Cassandra κάνει την ανάκτηση πολύ swifter από το χρόνο που χρειάζεται διαδικασίες ανάκτησης παραδοσιακή βάση δεδομένων. Εικόνα 2 εμφανίζει το μοντέλο τυπικές ανάπτυξης πολλών περιοχών με οκτώ κόμβους σε κάθε περιοχή. Δύο περιοχές είναι εικόνες αντικριστά μεταξύ τους για την ίδια συμμετρίας; πραγματικό κόσμο σχέδια εξαρτώνται από το φόρτο εργασίας τύπου (π.χ. συναλλαγών ή αναλυτικής), RPO, RTO, συνέπεια δεδομένων και διαθεσιμότητα απαιτήσεις.

![Ανάπτυξη περιοχής πολλούς](./media/virtual-machines-linux-classic-cassandra-nodejs/cassandra-linux2.png)

Εικόνα 2: Ανάπτυξη Cassandra πολλών περιοχών

### <a name="network-integration"></a>Ενοποίηση του δικτύου
Σύνολα εικονικές μηχανές αναπτυχθεί σε ιδιωτικά δίκτυα που βρίσκεται σε δύο περιοχές επικοινωνεί με μεταξύ τους, χρησιμοποιώντας μια διοχέτευσης VPN. Της διοχέτευσης VPN συνδέει δύο πύλες λογισμικό παρασχεθεί κατά τη διαδικασία ανάπτυξης του δικτύου. Δύο περιοχές έχουν παρόμοια αρχιτεκτονική δικτύου όσον αφορά δευτερεύοντα δίκτυα "web" και "δεδομένα"; Azure δικτύωση επιτρέπει τη δημιουργία όσο το δυνατόν περισσότερες δευτερεύοντα δίκτυα όπως απαιτείται και εφαρμόστε ACL όπως απαιτείται από την ασφάλεια δικτύου. Κατά τη σχεδίαση της τοπολογίας συμπλέγματος μεταξύ λανθάνων χρόνος επικοινωνίας κέντρο δεδομένων και η οικονομική επίπτωση την κίνηση δικτύου πρέπει να θεωρούνται.

### <a name="data-consistency-for-multi-data-center-deployment"></a>Συνέπεια δεδομένων για το κέντρο δεδομένων πολλών ανάπτυξης
Κατανεμημένο αναπτύξεις πρέπει να λάβετε υπόψη τις επιπτώσεις τοπολογία συμπλέγματος μετάδοσης και τη διαθεσιμότητα υψηλή. Το επίπεδο συνέπειας και RF πρέπει να είναι επιλεγμένο κατά τέτοιο τρόπο ώστε η απαρτία δεν εξαρτάται από τη διαθεσιμότητα των όλα τα κέντρα δεδομένων.
Για ένα σύστημα που χρειάζεται υψηλή συνέπειας, μια LOCAL_QUORUM συνέπειας επίπεδο (για ανάγνωσης και εγγραφής) θα βεβαιωθείτε ότι το τοπικό ανάγνωσης και εγγραφής πληρούνται από το τοπικό κόμβους ενώ αναπαράγεται ασύγχρονα δεδομένων στα κέντρα απομακρυσμένα δεδομένα.  Πίνακας 2 συνοψίζει τις λεπτομέρειες της ρύθμισης παραμέτρων για το σύμπλεγμα πολλών περιοχών περιγράφονται αργότερα σε την εγγραφή.

**Ρύθμιση παραμέτρων του συμπλέγματος Cassandra δύο περιοχής**


| Η παράμετρος συμπλέγματος | Τιμή | Παρατηρήσεις |
| ----------------- | ----- | ------- |
| Αριθμός κόμβους (N) | 8 + 8 | Συνολικός αριθμός των κόμβους του συμπλέγματος |
| Συντελεστής αναπαραγωγής (RF) | 3 | Αριθμός αντίγραφα μιας συγκεκριμένης σειράς |
| Επίπεδο συνέπειας (εγγραφή) | LOCAL_QUORUM [(sum(RF)/2) +1) = 4] το αποτέλεσμα του τύπου στρογγυλοποιείται προς τα κάτω | 2 κόμβους θα εγγραφεί με το πρώτο κέντρο δεδομένων σύγχρονη; οι επιπλέον 2 κόμβοι που χρειάζονται για απαρτίας θα εγγραφούν ασύγχρονα 2η κέντρο δεδομένων. |
| Επίπεδο συνέπειας (για ανάγνωση) | LOCAL_QUORUM ((RF/2) + 1) = 2 το αποτέλεσμα του τύπου στρογγυλοποιείται προς τα κάτω | Ανάγνωση αιτήσεις πληρούνται από μία μόνο περιοχή. 2 κόμβους διαβάζονται πριν από την αποστολή της απόκρισης του υπολογιστή-πελάτη. |
| Στρατηγική αναπαραγωγής | NetworkTopologyStrategy ανατρέξτε στο θέμα [Αναπαραγωγή δεδομένων](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) στο Cassandra τεκμηρίωση για περισσότερες πληροφορίες | Κατανόηση της τοπολογίας ανάπτυξης και τοποθετεί αντίγραφα σε κόμβους, έτσι ώστε όλα τα αντίγραφα του δεν καταλήγουν στο ίδιο rack |
| Snitch | GossipingPropertyFileSnitch ανατρέξτε στο θέμα [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) στην τεκμηρίωση Cassandra για περισσότερες πληροφορίες | NetworkTopologyStrategy χρησιμοποιεί μια έννοια της snitch Κατανόηση της τοπολογίας. GossipingPropertyFileSnitch παρέχει καλύτερο έλεγχο στην αντιστοίχιση κάθε κόμβο στο κέντρο δεδομένων και rack. Στη συνέχεια, το σύμπλεγμα χρησιμοποιεί Κουτσομπολιά για μεταδοθούν αυτές τις πληροφορίες. Αυτό είναι απλουστεύοντας σε δυναμική ρύθμιση IP σε σχέση με PropertyFileSnitch |


##<a name="the-software-configuration"></a>ΡΎΘΜΙΣΗ ΠΑΡΑΜΈΤΡΩΝ ΤΟΥ ΛΟΓΙΣΜΙΚΟΎ
Οι ακόλουθες εκδόσεις λογισμικού χρησιμοποιούνται κατά την ανάπτυξη:

<table>
<tr><th>Λογισμικό</th><th>Αρχείο προέλευσης</th><th>Έκδοση</th></tr>
<tr><td>JRE </td><td>[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </td><td>8U5</td></tr>
<tr><td>JNA </td><td>[JNA](https://github.com/twall/jna) </td><td> 3.2.7</td></tr>
<tr><td>Cassandra</td><td>[Apache Cassandra 2.0.8](http://www.apache.org/dist/cassandra/2.0.8/apache-cassandra-2.0.8-bin.tar.gz)</td><td> 2.0.8</td></tr>
<tr><td>Ubuntu  </td><td>[Microsoft Azure](https://azure.microsoft.com/) </td><td>14.04 ΑΠΟΤΕΛΕΣΜΆΤΩΝ</td></tr>
</table>

Μετά τη λήψη του JRE απαιτεί μη αυτόματη αποδοχή των αδειών χρήσης Oracle, για να απλοποιήσετε την ανάπτυξη, κάντε λήψη του όλο το απαιτούμενο λογισμικό στην επιφάνεια εργασίας για αποστολή αργότερα στην εικόνα προτύπου Ubuntu θα σας θα δημιουργούν ως ένα προδρόμων την ανάπτυξη σύμπλεγμα.

Κάντε λήψη του παραπάνω λογισμικού σε έναν κατάλογο γνωστές λήψης (π.χ., %TEMP%/downloads στα Windows ή ~/Downloads σε περισσότερες κατανομές Linux ή Mac) στον τοπικό υπολογιστή.

### <a name="create-ubuntu-vm"></a>ΔΗΜΙΟΥΡΓΊΑ ΕΙΚΟΝΙΚΉ UBUNTU
Σε αυτό το βήμα της διαδικασίας θα δημιουργήσουμε Ubuntu εικόνα με το λογισμικό προ-απαιτούμενες, έτσι ώστε η εικόνα μπορεί να χρησιμοποιηθεί ξανά για παροχή πολλές Cassandra κόμβους.  
####<a name="step-1-generate-ssh-key-pair"></a>ΒΉΜΑ 1: Δημιουργία ζεύγους κλειδιών SSH
Azure χρειάζεται μια X509 δημόσιο κλειδί που είναι PEM ή DER κωδικοποιημένη τη στιγμή παροχής. Δημιουργήστε ένα ζεύγος κλειδιών δημόσια/ιδιωτική ακολουθώντας τις οδηγίες που βρίσκεται στην ενότητα Τρόπος χρήσης SSH με Linux στην Azure. Εάν σκοπεύετε να χρησιμοποιήσετε putty.exe ως ένα πρόγραμμα-πελάτη SSH, είτε σε Windows ή Linux, πρέπει να μετατρέψετε το PEM κωδικοποιημένη RSA ιδιωτικό κλειδί PPK μορφή χρησιμοποιώντας puttygen.exe; στην παραπάνω ιστοσελίδα, μπορείτε να βρείτε τις οδηγίες για αυτό.

####<a name="step-2-create-ubuntu-template-vm"></a>ΒΉΜΑ 2: Δημιουργία προτύπου Ubuntu Εικονική
Για να δημιουργήσετε το πρότυπο Εικονική, συνδεθείτε στην πύλη του Azure κλασική και χρησιμοποιήστε την ακόλουθη σειρά: κάντε κλικ ΔΗΜΙΟΥΡΓΊΑ, υπολογισμού, ΕΙΚΟΝΙΚΉ ΜΗΧΑΝΉ, από τη ΣΥΛΛΟΓΉ, UBUNTU Ubuntu διακομιστή 14.04 Αποτελεσμάτων και, στη συνέχεια, κάντε κλικ στο δεξιό βέλος. Για ένα πρόγραμμα εκμάθησης που περιγράφει τον τρόπο για να δημιουργήσετε μια Εικονική Linux, ανατρέξτε στο θέμα Δημιουργία μια εικονική μηχανή εκτελείται Linux.

Εισαγάγετε τις παρακάτω πληροφορίες στην οθόνη "Ρύθμιση παραμέτρων εικονική μηχανή" #1:

<table>
<tr><th>ΌΝΟΜΑ ΠΕΔΊΟΥ              </td><td>       Η ΤΙΜΉ ΤΟΥ ΠΕΔΊΟΥ               </td><td>         ΠΑΡΑΤΗΡΉΣΕΙΣ                </td><tr>
<tr><td>ΗΜΕΡΟΜΗΝΊΑ ΔΗΜΟΣΊΕΥΣΗΣ ΈΚΔΟΣΗ    </td><td> Επιλέξτε μια ημερομηνία από το drow προς τα κάτω</td><td></td><tr>
<tr><td>ΌΝΟΜΑ ΕΙΚΟΝΙΚΉ ΜΗΧΑΝΉ    </td><td> πρότυπο CASS                </td><td> Αυτό είναι το όνομα κεντρικού υπολογιστή του την εικονική Μηχανή </td><tr>
<tr><td>ΕΠΊΠΕΔΟ                     </td><td> ΤΥΠΙΚΉ                        </td><td> Αποχώρηση από την προεπιλεγμένη              </td><tr>
<tr><td>ΜΈΓΕΘΟΣ                     </td><td> A1                              </td><td>Επιλέξτε την εικονική Μηχανή ανάλογα με τις ανάγκες εισόδου/ΕΞΌΔΟΥ; για το σκοπό αφήστε την προεπιλεγμένη </td><tr>
<tr><td> ΝΈΟ ΌΝΟΜΑ ΧΡΉΣΤΗ           </td><td> localadmin                      </td><td> "Διαχειριστής" είναι το όνομα χρήστη δεσμευμένες στο xx 12 Ubuntu και μετά</td><tr>
<tr><td> ΈΛΕΓΧΟΣ ΤΑΥΤΌΤΗΤΑΣ      </td><td> Κάντε κλικ στην επιλογή του πλαισίου ελέγχου                 </td><td>Επιλέξτε εάν θέλετε να ασφαλούς με έναν αριθμό-κλειδί SSH </td><tr>
<tr><td> ΠΙΣΤΟΠΟΙΗΤΙΚΌ             </td><td> όνομα αρχείου του το πιστοποιητικό με δημόσιο κλειδί </td><td> Χρησιμοποιήστε το δημόσιο κλειδί που δημιουργούνται προηγουμένως</td><tr>
<tr><td> Νέο κωδικό πρόσβασης   </td><td> ισχυρό κωδικό πρόσβασης </td><td> </td><tr>
<tr><td> Επιβεβαιώστε τον κωδικό πρόσβασης   </td><td> ισχυρό κωδικό πρόσβασης </td><td></td><tr>
</table>

Εισαγάγετε τις παρακάτω πληροφορίες στην οθόνη "Ρύθμιση παραμέτρων εικονική μηχανή" #2:

<table>
<tr><th>ΌΝΟΜΑ ΠΕΔΊΟΥ             </th><th> Η ΤΙΜΉ ΤΟΥ ΠΕΔΊΟΥ                       </th><th> ΠΑΡΑΤΗΡΉΣΕΙΣ                                 </th></tr>
<tr><td> ΥΠΗΡΕΣΊΑ ΣΤΟ CLOUD  </td><td> Δημιουργήστε μια νέα υπηρεσία στο cloud    </td><td>Υπηρεσία cloud είναι ένα κοντέινερ πόρους υπολογισμού όπως εικονικές μηχανές</td></tr>
<tr><td> ΌΝΟΜΑ DNS ΥΠΗΡΕΣΊΑΣ CLOUD </td><td>ubuntu template.cloudapp.net   </td><td>Δώστε ένα όνομα εξισορρόπησης φόρτου είναι ανεξάρτητο υπολογιστή</td></tr>
<tr><td> ΠΕΡΙΟΧΉ/ΟΜΆΔΑΣ ΣΥΝΆΦΕΙΑΣ/ΕΙΚΟΝΙΚΟΎ ΔΙΚΤΎΟΥ </td><td>    Δυτική η.π.α. </td><td> Επιλέξτε μια περιοχή από την οποία σας εφαρμογές web πρόσβασης στο σύμπλεγμα Cassandra</td></tr>
<tr><td>ΤΟ ΛΟΓΑΡΙΑΣΜΌ ΧΏΡΟΥ ΑΠΟΘΉΚΕΥΣΗΣ </td><td>   Χρήση προεπιλογής </td><td>Χρησιμοποιήστε τον προεπιλεγμένο λογαριασμό χώρου αποθήκευσης ή ένα λογαριασμό δημιουργηθεί εκ των προτέρων χώρου αποθήκευσης σε μια συγκεκριμένη περιοχή</td></tr>
<tr><td>ΟΡΙΣΜΌΣ ΔΙΑΘΕΣΙΜΌΤΗΤΑΣ </td><td>  Κανένας </td><td>  Αφήστε το κενό</td></tr>
<tr><td>ΤΑ ΤΕΛΙΚΆ ΣΗΜΕΊΑ   </td><td>Χρήση προεπιλογής </td><td>  Χρησιμοποιήστε την προεπιλεγμένη ρύθμιση παραμέτρων SSH </td></tr>
</table>

Κάντε κλικ στο βέλος προς τα δεξιά, αφήστε τις προεπιλογές στην οθόνη #3 και κάντε κλικ στο κουμπί "Έλεγχος" για να ολοκληρώσετε τη διαδικασία παροχής Εικονική. Μετά από μερικά λεπτά, η Εικονική με το όνομα "ubuntu-πρότυπο" πρέπει να είναι σε κατάσταση "Εκτέλεση".

###<a name="install-the-necessary-software"></a>ΕΓΚΑΤΆΣΤΑΣΗ ΤΟΥ ΛΟΓΙΣΜΙΚΟΎ ΕΊΝΑΙ ΑΠΑΡΑΊΤΗΤΟ
####<a name="step-1-upload-tarballs"></a>ΒΉΜΑ 1: Αποστολή tarballs
Χρήση scp ή pscp, αντιγράψτε το λογισμικό που έχουν ληφθεί προηγουμένως ~/downloads καταλόγου χρησιμοποιώντας την ακόλουθη εντολή μορφή:

#####<a name="pscp-server-jre-8u5-linux-x64targz-localadminhk-cas-templatecloudappnethomelocaladmindownloadsserver-jre-8u5-linux-x64targz"></a>pscp διακομιστή-jre-8u5-linux-x64.tar.gzlocaladmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz

Επαναλάβετε τα παραπάνω εντολή για JRE καθώς και όσον αφορά τα bit Cassandra.

####<a name="step-2-prepare-the-directory-structure-and-extract-the-archives"></a>ΒΉΜΑ 2: Προετοιμασία τη δομή του καταλόγου και εξαγάγετε αρχεία
Συνδεθείτε με την εικονική Μηχανή και δημιουργήστε τη δομή του καταλόγου και εξαγωγή λογισμικού ως υπερ-χρήστης χρησιμοποιώντας την παρακάτω πάρτι δέσμη ενεργειών:

    #!/bin/bash
    CASS_INSTALL_DIR="/opt/cassandra"
    JRE_INSTALL_DIR="/opt/java"
    CASS_DATA_DIR="/var/lib/cassandra"
    CASS_LOG_DIR="/var/log/cassandra"
    DOWNLOADS_DIR="~/downloads"
    JRE_TARBALL="server-jre-8u5-linux-x64.tar.gz"
    CASS_TARBALL="apache-cassandra-2.0.8-bin.tar.gz"
    SVC_USER="localadmin"

    RESET_ERROR=1
    MKDIR_ERROR=2

    reset_installation ()
    {
       rm -rf $CASS_INSTALL_DIR 2> /dev/null
       rm -rf $JRE_INSTALL_DIR 2> /dev/null
       rm -rf $CASS_DATA_DIR 2> /dev/null
       rm -rf $CASS_LOG_DIR 2> /dev/null
    }
    make_dir ()
    {
       if [ -z "$1" ]
       then
          echo "make_dir: invalid directory name"
          exit $MKDIR_ERROR
       fi

       if [ -d "$1" ]
       then
          echo "make_dir: directory already exists"
          exit $MKDIR_ERROR
       fi

       mkdir $1 2>/dev/null
       if [ $? != 0 ]
       then
          echo "directory creation failed"
          exit $MKDIR_ERROR
       fi
    }

    unzip()
    {
       if [ $# == 2 ]
       then
          tar xzf $1 -C $2
       else
          echo "archive error"
       fi

    }

    if [ -n "$1" ]
    then
       SVC_USER=$1
    fi

    reset_installation
    make_dir $CASS_INSTALL_DIR
    make_dir $JRE_INSTALL_DIR
    make_dir $CASS_DATA_DIR
    make_dir $CASS_LOG_DIR

    #unzip JRE and Cassandra
    unzip $HOME/downloads/$JRE_TARBALL $JRE_INSTALL_DIR
    unzip $HOME/downloads/$CASS_TARBALL $CASS_INSTALL_DIR

    #Change the ownership to the service credentials

    chown -R $SVC_USER:$GROUP $CASS_DATA_DIR
    chown -R $SVC_USER:$GROUP $CASS_LOG_DIR
    echo "edit /etc/profile to add JRE to the PATH"
    echo "installation is complete"


Εάν κάνετε επικόλληση αυτήν τη δέσμη ενεργειών σε παράθυρο vim, βεβαιωθείτε ότι έχετε καταργήσει το επαναφοράς ('\r ") χρησιμοποιώντας την ακόλουθη εντολή:

    tr -d '\r' <infile.sh >outfile.sh

####<a name="step-3-edit-etcprofile"></a>Βήμα 3: Επεξεργασία κ.λπ/προφίλ
Προσάρτηση τα εξής στο τέλος:

    JAVA_HOME=/opt/java/jdk1.8.0_05
    CASS_HOME= /opt/cassandra/apache-cassandra-2.0.8
    PATH=$PATH:$HOME/bin:$JAVA_HOME/bin:$CASS_HOME/bin
    export JAVA_HOME
    export CASS_HOME
    export PATH

####<a name="step-4-install-jna-for-production-systems"></a>Βήμα 4: Εγκατάσταση JNA για συστήματα παραγωγής
Χρησιμοποιήστε την παρακάτω εντολή ακολουθία: την ακόλουθη εντολή θα εγκαταστήσετε jna 3.2.7.jar και jna-πλατφόρμα-3.2.7.jar στον κατάλογο /usr/share.java sudo κατάλληλη get-εγκατάσταση libjna java

Δημιουργία συνδέσεων συμβολικής στον κατάλογο CASS_HOME/βιβλιοθήκης $ ώστε να δέσμη ενεργειών εκκίνησης Cassandra να βρείτε αυτές τις πλατύστομα:

    ln -s /usr/share/java/jna-3.2.7.jar $CASS_HOME/lib/jna.jar

    ln -s /usr/share/java/jna-platform-3.2.7.jar $CASS_HOME/lib/jna-platform.jar

####<a name="step-5-configure-cassandrayaml"></a>Βήμα 5: Ρύθμιση παραμέτρων cassandra.yaml
Επεξεργασία cassandra.yaml σε κάθε Εικονική ώστε να αντικατοπτρίζει ρύθμισης παραμέτρων που απαιτούνται από όλες τις εικονικές μηχανές [θα σας να τροποποιήστε αυτό κατά τη διάρκεια του πραγματικού προμήθειας]:

<table>
<tr><th>Όνομα πεδίου   </th><th> Τιμή  </th><th> Παρατηρήσεις </th></tr>
<tr><td>cluster_name </td><td>  "CustomerService"   </td><td> Χρησιμοποιήστε το όνομα που απεικονίζει την ανάπτυξη</td></tr>
<tr><td>listen_address  </td><td>[αφήστε την κενή]   </td><td> Διαγραφή "τοπικού κεντρικού υπολογιστή" </td></tr>
<tr><td>rpc_addres   </td><td>[αφήστε την κενή]  </td><td> Διαγραφή "τοπικού κεντρικού υπολογιστή" </td></tr>
<tr><td>σπόροι   </td><td>"10.1.2.4, 10.1.2.6, 10.1.2.8" </td><td>Λίστα με όλες τις διευθύνσεις IP που έχουν καθοριστεί ως σπόροι.</td></tr>
<tr><td>endpoint_snitch </td><td> org.apache.cassandra.locator.GossipingPropertyFileSnitch </td><td> Αυτή είναι η επιλογή από το NetworkTopologyStrateg έμμεσου προσδιορισμού του κέντρου δεδομένων και rack από την εικονική Μηχανή</td></tr>
</table>

####<a name="step-6-capture-the-vm-image"></a>Βήμα 6: Καταγράψετε την εικόνα Εικονική
Συνδεθείτε στο η εικονική μηχανή χρησιμοποιώντας το όνομα κεντρικού υπολογιστή (hk-αρχές έκδοσης πιστοποιητικών-template.cloudapp.net) και το ιδιωτικό κλειδί SSH δημιουργήσει προηγουμένως. Δείτε πώς μπορείτε να χρησιμοποιήστε SSH με Linux στην Azure για λεπτομέρειες σχετικά με τον τρόπο για να συνδεθείτε χρησιμοποιώντας την εντολή ssh ή putty.exe.

Εκτελέστε την παρακάτω ακολουθία ενεργειών για να καταγράψετε την εικόνα:
#####<a name="1-deprovision"></a>1. διαχειριστείτε
Χρησιμοποιήστε την εντολή "sudo waagent – διαχειριστείτε + χρήστη" για να καταργήσετε εικονική μηχανή παρουσία συγκεκριμένες πληροφορίες. Ανατρέξτε στο θέμα για το [πώς μπορείτε να καταγράψετε μια εικονική μηχανή Linux](virtual-machines-linux-classic-capture-image.md) για χρήση ως πρότυπο περισσότερες λεπτομέρειες σχετικά με τη διαδικασία καταγραφής εικόνας.

#####<a name="2-shutdown-the-vm"></a>2: τερματισμού την εικονική Μηχανή
Βεβαιωθείτε ότι έχει επιλεγεί η εικονική μηχανή και κάντε κλικ στη σύνδεση ΤΕΡΜΑΤΙΣΜΌΣ από το κάτω μέρος της γραμμής εντολών.

#####<a name="3-capture-the-image"></a>3: καταγράψετε την εικόνα
Βεβαιωθείτε ότι έχει επιλεγεί η εικονική μηχανή και κάντε κλικ στη σύνδεση ΚΑΤΑΓΡΑΦΉ από τη γραμμή εντολών κάτω. Στην επόμενη οθόνη, δώστε ένα ΌΝΟΜΑ ΕΙΚΌΝΑΣ (π.χ. hk-cas-2-08-ub-14-04-2014071), με την περίπτωση ΠΕΡΙΓΡΑΦΉ ΕΙΚΌΝΑΣ και κάντε κλικ στην επιλογή "ενεργοποιημένο" για να ολοκληρώσετε τη διαδικασία ΚΑΤΑΓΡΑΦΉΣ.

Αυτό θα χρειαστούν μερικά δευτερόλεπτα και η εικόνα πρέπει να είναι διαθέσιμη στην ενότητα MY ΕΙΚΌΝΕΣ από τη συλλογή εικόνων. Η προέλευση Εικονική θα αυτόματα delated μετά την επιτυχημένη καταγράφεται η εικόνα.

##<a name="single-region-deployment-process"></a>Μόνο περιοχή ανάπτυξη διαδικασίας
**Βήμα 1: Δημιουργήστε το εικονικό δίκτυο** Συνδεθείτε στην πύλη του Azure κλασική και δημιουργήστε ένα εικονικό δίκτυο με εμφάνιση χαρακτηριστικά στον πίνακα. Ανατρέξτε στο θέμα [Ρύθμιση Cloud-Only εικονικού δικτύου στην πύλη του Azure κλασική](../virtual-network/virtual-networks-create-vnet-classic-portal.md) για λεπτομερή βήματα της διαδικασίας.      

<table>
<tr><th>Εικονική όνομα χαρακτηριστικού</th><th>Τιμή</th><th>Παρατηρήσεις</th></tr>
<tr><td>Όνομα</td><td>vnet-cass-Δυτική-μας</td><td></td></tr>
<tr><td>Περιοχή</td><td>Δυτική η.π.α.</td><td></td></tr>
<tr><td>Οι διακομιστές DNS </td><td>Κανένας</td><td>Παραβλέψτε το όπως δεν χρησιμοποιούμε ένα διακομιστή DNS</td></tr>
<tr><td>Ρύθμιση παραμέτρων ενός VPN σημείου σε τοποθεσία</td><td>Κανένας</td><td> Παραβλέψτε το</td></tr>
<tr><td>Ρύθμιση παραμέτρων ενός VPN τοποθεσίας σε τοποθεσία</td><td>Nnone</td><td> Παραβλέψτε το</td></tr>
<tr><td>Χώρος διευθύνσεων</td><td>10.1.0.0/16</td><td></td></tr>
<tr><td>Εκκίνηση IP</td><td>10.1.0.0</td><td></td></tr>
<tr><td>CIDR </td><td>/ 16 (65531)</td><td></td></tr>
</table>

Προσθέστε τα εξής δευτερεύοντα δίκτυα:

<table>
<tr><th>Όνομα</th><th>Εκκίνηση IP</th><th>CIDR</th><th>Παρατηρήσεις</th></tr>
<tr><td>Web</td><td>10.1.1.0</td><td>/ 24 (251)</td><td>Υποδίκτυο για τη συστοιχία web</td></tr>
<tr><td>δεδομένα</td><td>10.1.2.0</td><td>/ 24 (251)</td><td>Υποδίκτυο για τους κόμβους βάσης δεδομένων</td></tr>
</table>

Δεδομένα και δευτερεύοντα δίκτυα Web μπορούν να προστατευτούν μέσω δικτύου ομάδες ασφαλείας την κάλυψη του οποίου είναι εκτός εμβέλειας για αυτό το άρθρο.  

**Βήμα 2: προμήθεια εικονικές μηχανές** Χρήση της εικόνας που δημιουργήσατε προηγουμένως, θα δημιουργήσετε τις εξής εικονικές μηχανές στο διακομιστή cloud "hk-c-svc-Δυτική" και συνδέστε τα με το αντίστοιχο δευτερεύοντα δίκτυα, όπως φαίνεται παρακάτω:

<table>
<tr><th>Το όνομα του υπολογιστή    </th><th>Υποδίκτυο </th><th>Διεύθυνση IP </th><th>Ορισμός διαθεσιμότητας</th><th>Κέντρο Δεδομένων/Rack</th><th>Σπόρων;</th></tr>
<tr><td>HK-c1-Δυτική-μας   </td><td>δεδομένα   </td><td>10.1.2.4   </td><td>HK-c-aset-1    </td><td>ελεγκτή τομέα = WESTUS rack = rack1 </td><td>Ναι</td></tr>
<tr><td>HK-c2-Δυτική-μας   </td><td>δεδομένα   </td><td>10.1.2.5   </td><td>HK-c-aset-1    </td><td>ελεγκτή τομέα = WESTUS rack = rack1 </td><td>Όχι </td></tr>
<tr><td>HK-c3-Δυτική-μας   </td><td>δεδομένα   </td><td>10.1.2.6   </td><td>HK-c-aset-1    </td><td>ελεγκτή τομέα = WESTUS rack = rack2 </td><td>Ναι</td></tr>
<tr><td>HK-c4-Δυτική-μας   </td><td>δεδομένα   </td><td>10.1.2.7   </td><td>HK-c-aset-1    </td><td>ελεγκτή τομέα = WESTUS rack = rack2 </td><td>Όχι </td></tr>
<tr><td>HK-c5-Δυτική-μας   </td><td>δεδομένα   </td><td>10.1.2.8   </td><td>HK-c-aset-2    </td><td>ελεγκτή τομέα = WESTUS rack = rack3 </td><td>Ναι</td></tr>
<tr><td>HK-c6-Δυτική-μας   </td><td>δεδομένα   </td><td>10.1.2.9   </td><td>HK-c-aset-2    </td><td>ελεγκτή τομέα = WESTUS rack = rack3 </td><td>Όχι </td></tr>
<tr><td>HK-c7-Δυτική-μας   </td><td>δεδομένα   </td><td>10.1.2.10  </td><td>HK-c-aset-2    </td><td>ελεγκτή τομέα = WESTUS rack = rack4 </td><td>Ναι</td></tr>
<tr><td>HK-c8-Δυτική-μας   </td><td>δεδομένα   </td><td>10.1.2.11  </td><td>HK-c-aset-2    </td><td>ελεγκτή τομέα = WESTUS rack = rack4 </td><td>Όχι </td></tr>
<tr><td>HK-w1-Δυτική-μας   </td><td>Web    </td><td>10.1.1.4   </td><td>HK-w-aset-1    </td><td>                       </td><td>Δ/Υ</td></tr>
<tr><td>HK-w2-Δυτική-μας   </td><td>Web    </td><td>10.1.1.5   </td><td>HK-w-aset-1    </td><td>                       </td><td>Δ/Υ</td></tr>
</table>

Δημιουργία της παραπάνω λίστας ΣΠΣ απαιτεί την ακόλουθη διαδικασία:

1.  Δημιουργήστε μια υπηρεσία cloud κενά σε μια συγκεκριμένη περιοχή
2.  Δημιουργήστε μια Εικονική από την προηγουμένως καταγεγραμμένη εικόνα και να επισυνάψετε το εικονικό δίκτυο που δημιουργήσατε προηγουμένως, Επαναλάβετε τη διαδικασία για όλα τα ΣΠΣ
3.  Προσθήκη μιας εσωτερικής εξισορρόπηση φόρτου για την υπηρεσία cloud και επισύναψή του σε δευτερεύον "δεδομένα"
4.  Για κάθε Εικονική που δημιουργήσατε προηγουμένως, προσθέστε ένα τελικό σημείο εξισορρόπησης φόρτου για την κίνηση thrift σε ένα σύνολο εξισορρόπησης φόρτου που είναι συνδεδεμένη με τη μονάδα εξισορρόπησης φόρτου που δημιουργήσατε προηγουμένως εσωτερικό

Η παραπάνω διαδικασία μπορεί να εκτελεστεί με Azure κλασική πύλη; Χρησιμοποιήστε έναν υπολογιστή Windows (Χρησιμοποιήστε έναν Εικονική στην Azure Εάν δεν έχετε πρόσβαση σε έναν υπολογιστή Windows), χρησιμοποιήστε την ακόλουθη δέσμη ενεργειών του PowerShell για να προμηθεύσουν όλα 8 ΣΠΣ αυτόματα.

**Λίστα 1: Δέσμης ενεργειών του PowerShell για παροχή εικονικές μηχανές**

        #Tested with Azure Powershell - November 2014
        #This powershell script deployes a number of VMs from an existing image inside an Azure region
        #Import your Azure subscription into the current Powershell session before proceeding
        #The process: 1. create Azure Storage account, 2. create virtual network, 3.create the VM template, 2. crate a list of VMs from the template

        #fundamental variables - change these to reflect your subscription
        $country="us"; $region="west"; $vnetName = "your_vnet_name";$storageAccount="your_storage_account"
        $numVMs=8;$prefix = "hk-cass";$ilbIP="your_ilb_ip"
        $subscriptionName = "Azure_subscription_name";
        $vmSize="ExtraSmall"; $imageName="your_linux_image_name"
        $ilbName="ThriftInternalLB"; $thriftEndPoint="ThriftEndPoint"

        #generated variables
        $serviceName = "$prefix-svc-$region-$country"; $azureRegion = "$region $country"

        $vmNames = @()
        for ($i=0; $i -lt $numVMs; $i++)
        {
           $vmNames+=("$prefix-vm"+($i+1) + "-$region-$country" );
        }

        #select an Azure subscription already imported into Powershell session
        Select-AzureSubscription -SubscriptionName $subscriptionName -Current
        Set-AzureSubscription -SubscriptionName $subscriptionName -CurrentStorageAccountName $storageAccount

        #create an empty cloud service
        New-AzureService -ServiceName $serviceName -Label "hkcass$region" -Location $azureRegion
        Write-Host "Created $serviceName"

        $VMList= @()   # stores the list of azure vm configuration objects
        #create the list of VMs
        foreach($vmName in $vmNames)
        {
           $VMList += New-AzureVMConfig -Name $vmName -InstanceSize ExtraSmall -ImageName $imageName |
           Add-AzureProvisioningConfig -Linux -LinuxUser "localadmin" -Password "Local123" |
           Set-AzureSubnet "data"
        }

        New-AzureVM -ServiceName $serviceName -VNetName $vnetName -VMs $VMList

        #Create internal load balancer
        Add-AzureInternalLoadBalancer -ServiceName $serviceName -InternalLoadBalancerName $ilbName -SubnetName "data" -StaticVNetIPAddress "$ilbIP"
        Write-Host "Created $ilbName"
        #Add add the thrift endpoint to the internal load balancer for all the VMs
        foreach($vmName in $vmNames)
        {
            Get-AzureVM -ServiceName $serviceName -Name $vmName |
                Add-AzureEndpoint -Name $thriftEndPoint -LBSetName "ThriftLBSet" -Protocol tcp -LocalPort 9160 -PublicPort 9160 -ProbePort 9160 -ProbeProtocol tcp -ProbeIntervalInSeconds 10 -InternalLoadBalancerName $ilbName |
                Update-AzureVM

            Write-Host "created $vmName"     
        }

**Βήμα 3: Ρύθμιση παραμέτρων Cassandra σε κάθε εικονική Μηχανή**

Συνδεθείτε με το Εικονική και κάντε τα εξής:

* Επεξεργασία $CASS_HOME/conf/cassandra-rackdc.properties για να καθορίσετε τις ιδιότητες κέντρο και rack δεδομένων:

       dc =EASTUS, rack =rack1

* Επεξεργασία cassandra.yaml για ρύθμιση παραμέτρων σπόρων κόμβους ως εξής:

       Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10"

**Βήμα 4: Έναρξη του ΣΠΣ και δοκιμή του συμπλέγματος**

Συνδεθείτε με έναν από τους κόμβους (π.χ. hk-c1-Δυτική-η.π.α.) και εκτελέστε την ακόλουθη εντολή για να δείτε την κατάσταση του συμπλέγματος:

       nodetool –h 10.1.2.4 –p 7199 status

Θα πρέπει να δείτε την εμφάνιση παρόμοια με την παρακάτω για ένα σύμπλεγμα κόμβου 8:

<table>
<tr><th>Κατάσταση</th><th>Διεύθυνση  </th><th>Φόρτωση   </th><th>Διακριτικά </th><th>Είναι ο κάτοχος </th><th>Αναγνωριστικό κεντρικού υπολογιστή  </th><th>Rack</th></tr>
<tr><th>ΚΑΤΆΡΓΗΣΗ  </td><td>10.1.2.4   </td><td>87.81 KB   </td><td>256    </td><td>38.0%  </td><td>GUID (Κατάργηση)</td><td>rack1</td></tr>
<tr><th>ΚΑΤΆΡΓΗΣΗ  </td><td>10.1.2.5   </td><td>41.08 KB   </td><td>256    </td><td>68.9%  </td><td>GUID (Κατάργηση)</td><td>rack1</td></tr>
<tr><th>ΚΑΤΆΡΓΗΣΗ  </td><td>10.1.2.6   </td><td>55.29 KB   </td><td>256    </td><td>68.8%  </td><td>GUID (Κατάργηση)</td><td>rack2</td></tr>
<tr><th>ΚΑΤΆΡΓΗΣΗ  </td><td>10.1.2.7   </td><td>55.29 KB   </td><td>256    </td><td>68.8%  </td><td>GUID (Κατάργηση)</td><td>rack2</td></tr>
<tr><th>ΚΑΤΆΡΓΗΣΗ  </td><td>10.1.2.8   </td><td>55.29 KB   </td><td>256    </td><td>68.8%  </td><td>GUID (Κατάργηση)</td><td>rack3</td></tr>
<tr><th>ΚΑΤΆΡΓΗΣΗ  </td><td>10.1.2.9   </td><td>55.29 KB   </td><td>256    </td><td>68.8%  </td><td>GUID (Κατάργηση)</td><td>rack3</td></tr>
<tr><th>ΚΑΤΆΡΓΗΣΗ  </td><td>10.1.2.10  </td><td>55.29 KB   </td><td>256    </td><td>68.8%  </td><td>GUID (Κατάργηση)</td><td>rack4</td></tr>
<tr><th>ΚΑΤΆΡΓΗΣΗ  </td><td>10.1.2.11  </td><td>55.29 KB   </td><td>256    </td><td>68.8%  </td><td>GUID (Κατάργηση)</td><td>rack4</td></tr>
</table>

## <a name="test-the-single-region-cluster"></a>Δοκιμή του συμπλέγματος μόνο περιοχή
Χρησιμοποιήστε τα ακόλουθα βήματα για να ελέγξετε το σύμπλεγμα:

1.    Χρήση του Powershell εντολή Get-AzureInternalLoadbalancer commandlet, λήψη της διεύθυνσης IP του το εσωτερικό εξισορρόπηση φόρτου (π.χ.  10.1.2.101). Η σύνταξη της εντολής εμφανίζεται παρακάτω: Get-AzureLoadbalancer – όνομα_υπηρεσίας "hk-c-svc-Δυτική-μας" [εμφανίζει τις λεπτομέρειες του εσωτερικού εξισορρόπηση φόρτου μαζί με τη διεύθυνση IP]
2.  Σύνδεση σε σύμπλεγμα web Εικονική (π.χ. hk-w1-Δυτική-η.π.α.) χρησιμοποιώντας Putty ή ssh
3.  Εκτέλεση $CASS_HOME/bin/cqlsh 10.1.2.101 9160
4.  Χρησιμοποιήστε τις παρακάτω εντολές CQL για να επαληθεύσετε εάν λειτουργεί το σύμπλεγμα:

        CREATE KEYSPACE customers_ks WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };
        USE customers_ks;
        CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);
        INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');
        INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');

        SELECT * FROM Customers;

Θα πρέπει να δείτε μια οθόνη όπως τα παρακάτω:

<table>
  <tr><th> customer_id </th><th> "όνομα" </th><th> Επώνυμο </th></tr>
  <tr><td> 1 </td><td> John </td><td> Κωστίδου </td></tr>
  <tr><td> 2 </td><td> Μαρία </td><td> Κωστίδου </td></tr>
</table>

Έχετε υπόψη ότι η keyspace που δημιουργήσατε στο βήμα 4 χρησιμοποιεί SimpleStrategy με ένα replication_factor του 3. SimpleStrategy προτείνεται για μία μόνο τα δεδομένα αναπτύξεις κέντρο ότι NetworkTopologyStrategy για τα δεδομένα πολλών κέντρο αναπτύξεις. Μια replication_factor 3 θα σας δώσει ανοχή για αποτυχίες κόμβο.

##<a id="tworegion"> </a>Διαδικασία ανάπτυξης πολλών περιοχών
Θα αξιοποιήσετε ανάπτυξης μόνο περιοχή ολοκληρωθεί και επαναλάβετε την ίδια διαδικασία για την εγκατάσταση του τη δεύτερη περιοχή. Η κλειδιού διαφορά μεταξύ ανάπτυξη μίας και πολλών περιοχή είναι τη διαμόρφωση διοχέτευσης VPN για την επικοινωνία μεταξύ περιοχής; θα ξεκινήσετε την εγκατάσταση του δικτύου, προμήθεια του ΣΠΣ και ρύθμιση παραμέτρων Cassandra.

###<a name="step-1-create-the-virtual-network-at-the-2nd-region"></a>Βήμα 1: Δημιουργήστε το εικονικό δίκτυο στην περιοχή 2η
Συνδεθείτε στην πύλη του Azure κλασική και δημιουργήστε ένα εικονικό δίκτυο με εμφάνιση χαρακτηριστικά στον πίνακα. Ανατρέξτε στο θέμα [Ρύθμιση Cloud-Only εικονικού δικτύου στην πύλη του Azure κλασική](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) για λεπτομερή βήματα της διαδικασίας.      

<table>
<tr><th>Όνομα χαρακτηριστικού    </th><th>Τιμή    </th><th>Παρατηρήσεις</th></tr>
<tr><td>Όνομα    </td><td>vnet-cass-Ανατολή-μας</td><td></td></tr>
<tr><td>Περιοχή  </td><td>Ανατολικής η.π.α.</td><td></td></tr>
<tr><td>Οι διακομιστές DNS     </td><td></td><td>Παραβλέψτε το όπως δεν χρησιμοποιούμε ένα διακομιστή DNS</td></tr>
<tr><td>Ρύθμιση παραμέτρων ενός VPN σημείου σε τοποθεσία</td><td></td><td>     Παραβλέψτε το</td></tr>
<tr><td>Ρύθμιση παραμέτρων ενός VPN τοποθεσίας σε τοποθεσία</td><td></td><td>      Παραβλέψτε το</td></tr>
<tr><td>Χώρος διευθύνσεων   </td><td>10.2.0.0/16</td><td></td></tr>
<tr><td>Εκκίνηση IP </td><td>10.2.0.0   </td><td></td></tr>
<tr><td>CIDR    </td><td>/ 16 (65531)</td><td></td></tr>
</table>

Προσθέστε τα εξής δευτερεύοντα δίκτυα:
<table>
<tr><th>Όνομα    </th><th>Εκκίνηση IP    </th><th>CIDR   </th><th>Παρατηρήσεις</th></tr>
<tr><td>Web </td><td>10.2.1.0   </td><td>/ 24 (251)  </td><td>Υποδίκτυο για τη συστοιχία web</td></tr>
<tr><td>δεδομένα    </td><td>10.2.2.0   </td><td>/ 24 (251)  </td><td>Υποδίκτυο για τους κόμβους βάσης δεδομένων</td></tr>
</table>


###<a name="step-2-create-local-networks"></a>Βήμα 2: Δημιουργία τοπικά δίκτυα
Ένα τοπικό δίκτυο στο Azure εικονικού δικτύου είναι ένας χώρος διεύθυνσης διακομιστή μεσολάβησης που αντιστοιχεί σε μια απομακρυσμένη τοποθεσία, όπως ένα σύννεφο ιδιωτική ή μια άλλη περιοχή Azure. Αυτός ο χώρος διεύθυνσης διακομιστή μεσολάβησης είναι συνδεδεμένη με μια απομακρυσμένη πύλη για το δίκτυο δρομολόγησης προς τα δεξιά κοινωνικής δικτύωσης προορισμούς. Ανατρέξτε στο θέμα [Ρύθμιση παραμέτρων ενός VNet VNet σύνδεση](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) για το οδηγίες σχετικά με τη δημιουργία σύνδεσης VNET-VNET.

Δημιουργήστε δύο τοπικά δίκτυα ανά τις ακόλουθες λεπτομέρειες:

| Όνομα δικτύου | Διεύθυνση πύλης VPN | Χώρος διευθύνσεων | Παρατηρήσεις |
| ------------ | ------------------- | ------------- | ------- |
| HK-lnet-Map-to-east-US | 23.1.1.1  | 10.2.0.0/16   | Κατά τη δημιουργία του τοπικού δικτύου δώσετε ένα σύμβολο κράτησης θέσης διεύθυνση πύλης. Η διεύθυνση πραγματικό πύλης συμπληρώνεται μετά τη δημιουργία της πύλης. Βεβαιωθείτε ότι το χώρο διευθύνσεων συμφωνεί ακριβώς με το αντίστοιχο απομακρυσμένης VNET; σε αυτήν την περίπτωση το VNET δημιουργηθεί στην περιοχή Ανατολικής ΗΠΑ. |
| HK-lnet-Map-to-West-US | 23.2.2.2  | 10.1.0.0/16   | Κατά τη δημιουργία του τοπικού δικτύου δώσετε ένα σύμβολο κράτησης θέσης διεύθυνση πύλης. Η διεύθυνση πραγματικό πύλης συμπληρώνεται μετά τη δημιουργία της πύλης. Βεβαιωθείτε ότι το χώρο διευθύνσεων συμφωνεί ακριβώς με το αντίστοιχο απομακρυσμένης VNET; σε αυτήν την περίπτωση το VNET δημιουργηθεί στην περιοχή Δυτική ΗΠΑ. |


###<a name="step-3-map-local-network-to-the-respective-vnets"></a>Βήμα 3: Αντιστοίχιση "Τοπικού" δικτύου για το αντίστοιχο VNETs
Από το Azure κλασική πύλη, επιλέξτε κάθε vnet, κάντε κλικ στην επιλογή "Ρύθμιση παραμέτρων", επιλέξτε "Σύνδεση με το τοπικό δίκτυο" και επιλέξτε τα τοπικά δίκτυα ανά τις ακόλουθες λεπτομέρειες:


| Εικονικό δίκτυο | Τοπικό δίκτυο |
| --------------- | ------------- |
| HK-vnet-Δυτική-μας | HK-lnet-Map-to-east-US |
| HK-vnet-Ανατολή-μας | HK-lnet-Map-to-West-US |


###<a name="step-4-create-gateways-on-vnet1-and-vnet2"></a>Βήμα 4: Δημιουργία πύλες σε VNET1 και VNET2
Από τον πίνακα εργαλείων των δύο εικονικού δικτύων, κάντε κλικ στην επιλογή ΔΗΜΙΟΥΡΓΊΑ ΠΎΛΗΣ που θα ενεργοποιεί την πύλη VPN προμήθεια διαδικασία. Μετά από μερικά λεπτά στον πίνακα εργαλείων του κάθε εικονικού δικτύου πρέπει να εμφανίζουν τη διεύθυνση της πύλης πραγματική.

###<a name="step-5-update-local-networks-with-the-respective-gateway-addresses"></a>Βήμα 5: Ενημέρωση "Τοπικό" δίκτυα με τις διευθύνσεις αντίστοιχα "πύλη"###
Επεξεργαστείτε τα τοπικά δίκτυα για να αντικαταστήσετε τη διεύθυνση IP πύλης κράτησης θέσης με η πραγματική διεύθυνση IP των πυλών απλώς προμήθεια του φακέλου. Χρησιμοποιήστε την παρακάτω αντιστοίχιση:

<table>
<tr><th>Τοπικό δίκτυο    </th><th>Η πύλη εικονικού δικτύου</th></tr>
<tr><td>HK-lnet-Map-to-east-US </td><td>Η πύλη hk-vnet-Δυτική-εμάς</td></tr>
<tr><td>HK-lnet-Map-to-West-US </td><td>Η πύλη hk-vnet-Ανατολή-εμάς</td></tr>
</table>

###<a name="step-6-update-the-shared-key"></a>Βήμα 6: Ενημερώστε το κοινόχρηστο κλειδί
Χρησιμοποιήστε την ακόλουθη δέσμη ενεργειών του Powershell για να ενημερώσετε το κλειδί ασφαλείας IP του κάθε πύλη VPN [Χρησιμοποιήστε το κλειδί χάρη για δύο πυλών]: hk-lnet-map-to-west-us - LocalNetworkSiteName Ορισμός AzureVNetGatewayKey - VNetName hk-vnet-Ανατολή-μας - SharedKey hk-lnet-map-to-east-us - LocalNetworkSiteName D9E76BKK Set-AzureVNetGatewayKey - VNetName hk-vnet-Δυτική-μας - SharedKey D9E76BKK

###<a name="step-7-establish-the-vnet-to-vnet-connection"></a>Βήμα 7: Δημιουργία της σύνδεσης VNET-VNET
Από την πύλη του Azure κλασική, χρησιμοποιήστε το μενού "Πίνακας ΕΡΓΑΛΕΊΩΝ" και οι δύο εικονικού δικτύων για να δημιουργήσετε σύνδεση πύλης προς πύλη. Χρησιμοποιήστε τα στοιχεία του μενού "ΣΎΝΔΕΣΗ" στη γραμμή εργαλείων κάτω. Μετά από μερικά λεπτά στον πίνακα εργαλείων πρέπει να εμφανίζει γραφικά τις λεπτομέρειες της σύνδεσης.

###<a name="step-8-create-the-virtual-machines-in-region-2"></a>Βήμα 8: Δημιουργία τις εικονικές μηχανές στην περιοχή #2
Δημιουργήστε την εικόνα Ubuntu, όπως περιγράφεται στην περιοχή #1 ανάπτυξη, ακολουθώντας τα ίδια βήματα ή αντιγράψτε το αρχείο VHD εικόνας με το λογαριασμό Azure χώρου αποθήκευσης που βρίσκεται στην περιοχή #2 και δημιουργήστε την εικόνα. Χρησιμοποιήστε αυτήν την εικόνα και δημιουργήστε την ακόλουθη λίστα εικονικές μηχανές σε μια νέα υπηρεσία cloud hk-c-svc-Ανατολή-μας:


| Το όνομα του υπολογιστή | Υποδίκτυο | Διεύθυνση IP | Ορισμός διαθεσιμότητας | Κέντρο Δεδομένων/Rack | Σπόρων; |
| ------------ | ------ | ---------- | ---------------- | ------- | ----- |
| HK-c1-Ανατολή-μας | δεδομένα  | 10.2.2.4   | HK-c-aset-1      | ελεγκτή τομέα = EASTUS rack = rack1 | Ναι |
| HK-c2-Ανατολή-μας | δεδομένα  | 10.2.2.5   | HK-c-aset-1      | ελεγκτή τομέα = EASTUS rack = rack1 | Όχι  |
| HK-c3-Ανατολή-μας | δεδομένα  | 10.2.2.6   | HK-c-aset-1      | ελεγκτή τομέα = EASTUS rack = rack2 | Ναι |
| HK-c5-Ανατολή-μας | δεδομένα  | 10.2.2.8   | HK-c-aset-2      | ελεγκτή τομέα = EASTUS rack = rack3 | Ναι |
| HK-c6-Ανατολή-μας | δεδομένα  | 10.2.2.9   | HK-c-aset-2      | ελεγκτή τομέα = EASTUS rack = rack3 | Όχι  |
| HK-c7-Ανατολή-μας | δεδομένα  | 10.2.2.10  | HK-c-aset-2      | ελεγκτή τομέα = EASTUS rack = rack4 | Ναι |
| HK-c8-Ανατολή-μας | δεδομένα  | 10.2.2.11  | HK-c-aset-2      | ελεγκτή τομέα = EASTUS rack = rack4 | Όχι  |
| HK-w1-Ανατολή-μας | Web   | 10.2.1.4   | HK-w-aset-1      | Δ/Υ                    | Δ/Υ |
| HK-w2-Ανατολή-μας | Web   | 10.2.1.5   | HK-w-aset-1      | Δ/Υ                    | Δ/Υ |


Ακολουθήστε τις ίδιες οδηγίες ως περιοχή #1, αλλά χρησιμοποιούν χώρο διευθύνσεων 10.2.xxx.xxx.

###<a name="step-9-configure-cassandra-on-each-vm"></a>Βήμα 9: Ρύθμιση παραμέτρων Cassandra σε κάθε εικονική Μηχανή
Συνδεθείτε με το Εικονική και κάντε τα εξής:

1. Επεξεργασία $CASS_HOME/conf/cassandra-rackdc.properties για να καθορίσετε τις ιδιότητες κέντρο και rack δεδομένων με τη μορφή: ελεγκτή τομέα = EASTUS rack = rack1
2. Επεξεργασία cassandra.yaml για ρύθμιση παραμέτρων σπόρων κόμβοι: σπόροι: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"

###<a name="step-10-start-cassandra"></a>Βήμα 10: Έναρξη Cassandra
Συνδεθείτε σε κάθε Εικονική και ξεκινήστε Cassandra στο παρασκήνιο, εκτελέστε την παρακάτω εντολή: $CASS_HOME/bin/cassandra

## <a name="test-the-multi-region-cluster"></a>Δοκιμή του συμπλέγματος πολλών περιοχών
Από τώρα Cassandra έχει αναπτυχθεί σε 16 κόμβους με 8 κόμβους σε κάθε περιοχή Azure. Αυτές οι κόμβοι είναι στο ίδιο σύμπλεγμα σύμφωνα με το κοινό όνομα συμπλέγματος και τη ρύθμιση παραμέτρων κόμβου σπόρων. Χρησιμοποιήστε την ακόλουθη διαδικασία για να ελέγξετε το σύμπλεγμα:

###<a name="step-1-get-the-internal-load-balancer-ip-for-both-the-regions-using-powershell"></a>Βήμα 1: Λήψη του εσωτερικού φόρτωσης IP εξισορρόπησης για δύο τις περιοχές με χρήση του PowerShell
- Get-AzureInternalLoadbalancer - όνομα_υπηρεσίας "hk-c-svc-Δυτική-μας"
- Get-AzureInternalLoadbalancer - όνομα_υπηρεσίας "hk-c-svc-Ανατολή-μας"  

    Σημειώστε τις διευθύνσεις IP (π.χ. Δυτική - 10.1.2.101 Ανατολή - 10.2.2.101) εμφανίζεται.

###<a name="step-2-execute-the-following-in-the-west-region-after-logging-into-hk-w1-west-us"></a>Βήμα 2: Εκτέλεση τα εξής στην περιοχή Δυτική μετά τη σύνδεση σε hk-w1-Δυτική-μας
1.    Εκτέλεση $CASS_HOME/bin/cqlsh 10.1.2.101 9160
2.  Εκτελέστε τις ακόλουθες εντολές CQL:

        CREATE KEYSPACE customers_ks
        WITH REPLICATION = { 'class' : 'NetworkToplogyStrategy', 'WESTUS' : 3, 'EASTUS' : 3};
        USE customers_ks;
        CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);
        INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');
        INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');
        SELECT * FROM Customers;

Θα πρέπει να δείτε μια οθόνη όπως τα παρακάτω:

| customer_id | "όνομα" | Επώνυμο |
| ----------- | --------- | -------- |
| 1           | John      | Κωστίδου      |
| 2           | Μαρία      | Κωστίδου      |


###<a name="step-3-execute-the-following-in-the-east-region-after-logging-into-hk-w1-east-us"></a>Βήμα 3: Εκτελέστε τα εξής στην Ανατολική περιοχή μετά τη σύνδεση σε hk-w1-Ανατολή-μας:
1.    Εκτέλεση $CASS_HOME/bin/cqlsh 10.2.2.101 9160
2.  Εκτελέστε τις ακόλουθες εντολές CQL:

        USE customers_ks;
        CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);
        INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');
        INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');
        SELECT * FROM Customers;

Θα πρέπει να δείτε την ίδια εμφάνιση όπως φαίνεται για την περιοχή Δυτική:


| customer_id | "όνομα" | Επώνυμο   |
|------------ | --------- | ---------- |
| 1           | John      | Κωστίδου        |
| 2           | Μαρία      | Κωστίδου        |


Εκτέλεση μερικά περισσότερες εισάγει και δείτε ότι αυτά να αναπαραχθούν σε δυτικές-μας μέρος του συμπλέγματος.

## <a name="test-cassandra-cluster-from-nodejs"></a>Δοκιμή Cassandra σύμπλεγμα από Node.js
Χρησιμοποιώντας ένα μέρος του ΣΠΣ Linux εισαγωγή στο "web" σειρά προηγουμένως, θα σας θα εκτελέσει μια απλή δέσμη ενεργειών Node.js για να διαβάσετε τα δεδομένα που έχουν εισαχθεί προηγουμένως

**Βήμα 1: Εγκατάσταση Node.js και Cassandra προγράμματος-πελάτη**

1. Εγκατάσταση Node.js και npm
2. Εγκατάσταση κόμβο πακέτου "cassandra-προγράμματος-πελάτη" Χρήση npm
3. Εκτελέστε την ακόλουθη δέσμη ενεργειών στη γραμμή εντολών του κελύφους που εμφανίζει τη συμβολοσειρά json των δεδομένων που ανακτήθηκαν:

        var pooledCon = require('cassandra-client').PooledConnection;
        var ksName = "custsupport_ks";
        var cfName = "customers_cf";
        var hostList = ['internal_loadbalancer_ip:9160'];
        var ksConOptions = { hosts: hostList,
                             keyspace: ksName, use_bigints: false };

        function createKeyspace(callback){
           var cql = 'CREATE KEYSPACE ' + ksName + ' WITH strategy_class=SimpleStrategy AND strategy_options:replication_factor=1';
           var sysConOptions = { hosts: hostList,  
                                 keyspace: 'system', use_bigints: false };
           var con = new pooledCon(sysConOptions);
           con.execute(cql,[],function(err) {
           if (err) {
             console.log("Failed to create Keyspace: " + ksName);
             console.log(err);
           }
           else {
             console.log("Created Keyspace: " + ksName);
             callback(ksConOptions, populateCustomerData);
           }
           });
           con.shutdown();
        }

        function createColumnFamily(ksConOptions, callback){
          var params = ['customers_cf','custid','varint','custname',
                        'text','custaddress','text'];
          var cql = 'CREATE COLUMNFAMILY ? (? ? PRIMARY KEY,? ?, ? ?)';
        var con =  new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) {
                 console.log("Failed to create column family: " + params[0]);
                 console.log(err);
              }
              else {
                 console.log("Created column family: " + params[0]);
                 callback();
              }
          });
          con.shutdown();
        }

        //populate Data
        function populateCustomerData() {
           var params = ['John','Infinity Dr, TX', 1];
           updateCustomer(ksConOptions,params);

           params = ['Tom','Fermat Ln, WA', 2];
           updateCustomer(ksConOptions,params);
        }

        //update will also insert the record if none exists
        function updateCustomer(ksConOptions,params)
        {
          var cql = 'UPDATE customers_cf SET custname=?,custaddress=? where custid=?';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) console.log(err);
              else console.log("Inserted customer : " + params[0]);
          });
          con.shutdown();
        }

        //read the two rows inserted above
        function readCustomer(ksConOptions)
        {
          var cql = 'SELECT * FROM customers_cf WHERE custid IN (1,2)';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,[],function(err,rows) {
              if (err)
                 console.log(err);
              else
                 for (var i=0; i<rows.length; i++)
                    console.log(JSON.stringify(rows[i]));
            });
           con.shutdown();
        }

        //exectue the code
        createKeyspace(createColumnFamily);
        readCustomer(ksConOptions)


## <a name="conclusion"></a>Ολοκλήρωση
Microsoft Azure είναι μια ευέλικτη πλατφόρμα που επιτρέπει την εκτέλεση της τόσο της Microsoft, καθώς και λογισμικό Άνοιγμα αρχείου προέλευσης, όπως παρουσιάζεται αυτήν την άσκηση. Ιδιαίτερα διαθέσιμη συμπλεγμάτων Cassandra μπορεί να αναπτυχθεί σε ένα κέντρο δεδομένων μονής ακρίβειας έως τη διάδοση της κόμβους συμπλέγματος σε πολλούς τομείς σφαλμάτων. Cassandra συμπλεγμάτων επίσης μπορεί να αναπτυχθεί σε πολλές γεωγραφικά απομακρυσμένοι Azure περιοχές για συστήματα απόδειξη καταστροφής. Azure και Cassandra μαζί επιτρέπει την κατασκευή ιδιαίτερα μεταβλητού μεγέθους, ιδιαίτερα διαθέσιμες και τις υπηρεσίες cloud ανακτήσιμα καταστροφής χρειάζεται μέσω internet σημερινή περιορίσετε το μέγεθος των υπηρεσιών.  

##<a name="references"></a>Αναφορές##
- [http://cassandra.Apache.org](http://cassandra.apache.org)
- [http://www.datastax.com](http://www.datastax.com)
- [http://www.nodejs.org](http://www.nodejs.org)
