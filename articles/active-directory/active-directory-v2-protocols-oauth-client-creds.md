
<properties
    pageTitle="Azure AD v2.0 διακριτικό προγράμματος-πελάτη διαπιστευτήρια ροής | Microsoft Azure"
    description="Εφαρμογές web δόμησης, χρησιμοποιώντας την εφαρμογή Azure AD του πρωτοκόλλου ελέγχου ταυτότητας διακριτικό 2.0."
    services="active-directory"
    documentationCenter=""
    authors="dstrockis"
    manager="mbaldwin"
    editor=""/>

<tags
    ms.service="active-directory"
    ms.workload="identity"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="09/26/2016"
    ms.author="dastrock"/>

# <a name="v20-protocols---oauth-20-client-credentials-flow"></a>Ροή πρωτόκολλα v2.0 - διακριτικό διαπιστευτήρια 2.0 προγράμματος-πελάτη

Τα [διαπιστευτήρια προγράμματος-πελάτη 2.0 διακριτικό εκχώρηση](http://tools.ietf.org/html/rfc6749#section-4.4), ορισμένες φορές αναφέρεται ως "με δύο-σκέλη διακριτικό", μπορεί να χρησιμοποιηθεί για πρόσβαση σε πόρους web που φιλοξενείται χρησιμοποιώντας την ταυτότητα μιας εφαρμογής του.  Χρησιμοποιείται συνήθως για τις αλληλεπιδράσεις διακομιστή προς διακομιστή που πρέπει να εκτελείται στο παρασκήνιο χωρίς την άμεση precense του ενός τελικού χρήστη.  Αυτούς τους τύπους των εφαρμογών του αναφέρονται συχνά ως **στοιχεία daemon** ή **λογαριασμούς υπηρεσίας**.

> [AZURE.NOTE]
    Δεν όλα τα σενάρια Azure Active Directory και δυνατότητες που υποστηρίζονται από το τελικό σημείο v2.0.  Για να καθορίσετε εάν θα πρέπει να χρησιμοποιήσετε το τελικό σημείο v2.0, διαβάστε σχετικά με [τους περιορισμούς v2.0](active-directory-v2-limitations.md).

Σε το πιο τυπικό τρεις "με σκέλη τριών OAuth," μια εφαρμογή προγράμματος-πελάτη έχει εκχωρηθεί δικαιώματα πρόσβασης σε έναν πόρο εκ μέρους ενός συγκεκριμένου χρήστη.  Το δικαίωμα είναι **Πληρεξούσιοι** από το χρήστη με την εφαρμογή, συνήθως κατά τη διαδικασία [τη συγκατάθεσή σας](active-directory-v2-scopes.md) .  Ωστόσο, της ροής διαπιστευτήρια προγράμματος-πελάτη, εκχωρούνται δικαιώματα **απευθείας** με την ίδια την εφαρμογή.  Όταν η εφαρμογή παρουσιάζει ένα διακριτικό σε έναν πόρο, ο πόρος επιβάλλει ότι η ίδια την εφαρμογή έχει εξουσιοδότηση για να εκτελέσετε κάποια ενέργεια - δεν ότι ορισμένα χρήστης διαθέτει εξουσιοδότηση.

## <a name="protocol-diagram"></a>Διάγραμμα πρωτοκόλλου
Η ροή διαπιστευτήρια ολόκληρο προγράμματος-πελάτη μοιάζει κάπως έτσι - κάθε βήματα που περιγράφονται αναλυτικά παρακάτω.

![Ροή διαπιστευτήρια προγράμματος-πελάτη](../media/active-directory-v2-flows/convergence_scenarios_client_creds.png)

## <a name="get-direct-authorization"></a>Λάβετε άμεση εξουσιοδότησης 
Υπάρχουν δύο τρόποι ότι μια εφαρμογή λαμβάνει συνήθως απευθείας εξουσιοδότησης για να αποκτήσετε πρόσβαση σε έναν πόρο: μέσω μιας λίστας ελέγχου πρόσβασης στο ο πόρος ή μέσω της εφαρμογής εκχώρηση δικαιωμάτων σε Azure AD.  Υπάρχουν διάφοροι τρόποι να επιλέξετε έναν πόρο για να εξουσιοδοτήσετε υπολογιστές-πελάτες του και κάθε πόρων διακομιστή ενδέχεται να επιλέξτε τη μέθοδο που θεωρείτε καταλληλότερο για την εφαρμογή.  Αυτές τις δύο μεθόδους είναι οι πιο συνηθισμένες στο Azure AD και reccommended για προγράμματα-πελάτες και τους πόρους που θέλετε να εκτελέσετε τη ροή διαπιστευτήρια προγράμματος-πελάτη.

### <a name="access-control-lists"></a>Λίστες ελέγχου πρόσβασης
Μια υπηρεσία παροχής δεδομένο πόρο μπορεί να επιβάλετε μια ελέγχου εξουσιοδότησης που βασίζεται σε μια λίστα αναγνωριστικών εφαρμογής που γνωρίζει και παρέχει ορισμένες συγκεκριμένο επίπεδο πρόσβασης.  Όταν ο πόρος λαμβάνει ενός διακριτικού από το τελικό σημείο v2.0, μπορούν να αποκωδικοποιείτε το διακριτικό και εξαγάγετε το Αναγνωριστικό εφαρμογής του υπολογιστή-πελάτη από το `appid` και `iss` αξιώσεων.  Στη συνέχεια, να συγκριτικά ότι η εφαρμογή σε σχέση με κάποια λίστα ελέγχου πρόσβασης (ACL) διατηρεί.  Η υποδιαίρεση και η μέθοδος από τη λίστα ελέγχου πρόσβασης μπορεί να διαφέρει σημαντικά από πόρων για πόρο.

Μια υπόθεση κοινής χρήσης για τέτοιου είδους ACL είναι δοκιμής δρομείς για μια εφαρμογή web ή στο web api.  Το web api μπορεί να μόνο να εκχωρήσετε ένα υποσύνολο την πλήρη δικαιώματα με τα διάφορα προγράμματα-πελάτες.  Αλλά για να εκτελέσετε δοκιμές τελικών σε το api, ένα πρόγραμμα-πελάτη δοκιμής δημιουργείται που θα αποκτήσει ο διακριτικά από το τελικό σημείο v2.0 και τις στέλνει το api.  Το api στη συνέχεια, να ACL Αναγνωριστικό εφαρμογής τη δοκιμή του προγράμματος-πελάτη για την πλήρη πρόσβαση σε ολόκληρη τη λειτουργικότητα του api.  Λάβετε υπόψη ότι εάν έχετε όπως μια λίστα την υπηρεσία, θα πρέπει να ότι για την επικύρωση όχι μόνο ο καλών `appid`, αλλά να επικυρώσετε τη που το `iss` του διακριτικού είναι αξιόπιστο καθώς και.

Αυτός ο τύπος της άδειας είναι κοινά για τα στοιχεία daemon και οι λογαριασμοί που πρέπει να έχουν πρόσβαση σε δεδομένα που ανήκουν σε χρήστες καταναλωτή με προσωπικοί λογαριασμοί Microsoft.  Για τα δεδομένα που ανήκουν σε εταιρείες, συνιστάται να ανανεώσετε την απαραίτητες άδεια μέσω perimssions εφαρμογής.

### <a name="application-permissions"></a>Δικαιώματα εφαρμογής
Αντί να χρησιμοποιήσετε ACL, APIs μπορούν να εμφανίζουν ένα σύνολο **δικαιωμάτων εφαρμογών** που εκχωρούνται σε μια εφαρμογή του.  Μια εφαρμογή δικαιωμάτων έχει εκχωρηθεί σε μια εφαρμογή από ένα διαχειριστή μιας εταιρείας, και μπορεί να χρησιμοποιηθεί μόνο για να αποκτήσετε πρόσβαση σε δεδομένα που ανήκουν σε αυτήν την εταιρεία και τους υπαλλήλους.  Για παράδειγμα, το Microsoft Graph εκθέτει πολλά δικαιώματα εφαρμογής:

- Ανάγνωση αλληλογραφίας σε όλα τα γραμματοκιβώτια
- Ανάγνωση και εγγραφή αλληλογραφίας σε όλα τα γραμματοκιβώτια
- Αποστολή αλληλογραφίας ως οποιονδήποτε χρήστη
- Ανάγνωση δεδομένων καταλόγου
- [+ περισσότερα](https://graph.microsoft.io)

Για να αποκτήσετε αυτά τα δικαιώματα στην εφαρμογή σας, μπορείτε να εκτελέσετε τα παρακάτω βήματα.

#### <a name="request-the-permissions-in-the-app-registration-portal"></a>Αίτηση για τα δικαιώματα στην πύλη καταχώρηση εφαρμογής

- Εάν δεν το έχετε κάνει ήδη, μεταβείτε στην εφαρμογή σας με [apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)ή να [δημιουργήσετε μια εφαρμογή](active-directory-v2-app-registration.md) .  Θα πρέπει να βεβαιωθείτε ότι η εφαρμογή σας έχει δημιουργήσει τουλάχιστον μία μυστικό εφαρμογής.
- Εντοπίστε την ενότητα **Άμεση εφαρμογή δικαιώματα** και προσθέστε τα δικαιώματα που απαιτεί την εφαρμογή σας.
- Βεβαιωθείτε ότι για να **αποθηκεύσετε** την καταχώρηση εφαρμογής

#### <a name="recommended-sign-the-user-into-your-app"></a>Προτεινόμενα: Πραγματοποιήστε είσοδο στο χρήστη στο την εφαρμογή σας

Συνήθως όταν δημιουργείτε μια εφαρμογή που χρησιμοποιεί δικαιώματα εφαρμογής, η εφαρμογή θα πρέπει να έχετε μια σελίδα/προβολή που επιτρέπει ο διαχειριστής για να εγκρίνετε την εφαρμογή δικαιωμάτων.  Αυτή η σελίδα μπορεί να είναι μέρος της εγγραφής στην εφαρμογή ροής, μέρος των ρυθμίσεων της εφαρμογής ή μια αποκλειστική ροής "σύνδεση".  Σε πολλές περιπτώσεις, έχει νόημα για την εφαρμογή για να εμφανίσετε αυτό "σύνδεση" Προβολή μόνο αφού ένας χρήστης έχει συνδεθεί με έναν εταιρικό ή σχολικό λογαριασμό Microsoft που διαθέτετε.

Σχετικά με την είσοδο στο χρήστη στην εφαρμογή σας επιτρέπει να προσδιορίζετε τη organziation στην οποία ανήκει ο χρήστης πριν να τους ζητήσετε να εγκρίνουν τα δικαιώματα εφαρμογής.  Ενώ δεν είναι απολύτως απαραίτητο, μπορεί να σας βοηθήσει να δημιουργήσετε μια πιο διαισθητική εμπειρία για τους χρήστες του οργανισμού.  Για να υπογράψετε το χρήστη στο, ακολουθήστε τα [προγράμματα εκμάθησης για το πρωτόκολλο v2.0](active-directory-v2-protocols.md).

#### <a name="request-the-permissions-from-a-directory-admin"></a>Αίτηση για τα δικαιώματα από ένα διαχειριστή καταλόγου

Όταν είστε έτοιμοι για να ζητήσετε δικαιώματα από το διαχειριστή της εταιρείας, μπορείτε να ανακατευθύνετε το χρήστη να v2.0 **διαχείρισης συγκατάθεση τελικού σημείου**.

```
// Line breaks for legibility only

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro Tip: Try pasting the below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| Παράμετρος | | Περιγραφή |
| ----------------------- | ------------------------------- | --------------- |
| μισθωτή | απαιτείται | Ο μισθωτής καταλόγου που θέλετε να ζητήσετε δικαιώματα από.  Μπορεί να παρέχεται σε μορφή φιλικό όνομα ή guid.  Εάν δεν γνωρίζετε ποιο μισθωτή ανήκει ο χρήστης και θέλετε για να συνδεθείτε με οποιαδήποτε μισθωτή, χρησιμοποιήστε `common`. |
| client_id | απαιτείται | Το αναγνωριστικό εφαρμογής ότι η πύλη εγγραφής ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)), στους οποίους έχουν ανατεθεί την εφαρμογή σας. |
| redirect_uri | απαιτείται | Το σημείο όπου θέλετε την απάντηση που θα σταλεί σε εφαρμογή σας για το χειρισμό redirect_uri.  Αυτό πρέπει να αντιστοιχεί ακριβώς ένα από τα redirect_uris που έχουν καταχωρηθεί στην πύλη του, εκτός από αυτό πρέπει να κωδικοποιηθεί ως διεύθυνση url και μπορούν να έχουν επιπλέον διαδρομή τμήματα. |
| κατάσταση | Συνιστάται | Μια τιμή που περιλαμβάνονται στην αίτηση που θα επιστραφεί επίσης στην διακριτικού απάντηση.  Μπορεί να είναι μια συμβολοσειρά οποιοδήποτε περιεχόμενο που θέλετε.  Η κατάσταση χρησιμοποιείται για την κωδικοποίηση πληροφοριών σχετικά με την κατάσταση του χρήστη στην εφαρμογή πριν από την αίτηση ελέγχου ταυτότητας προέκυψε, όπως τη σελίδα ή την προβολή που είχαν στην. |

Σε αυτό το σημείο, Azure AD θα επιβάλει ότι μόνο ένας διαχειριστής μισθωτή να συνδεθώ στο για να ολοκληρώσετε την αίτηση.  Ο διαχειριστής θα σας ζητηθεί να εγκρίνουν όλα τα δικαιώματα άμεση εφαρμογή που έχετε ζητήσει για την εφαρμογή σας στην πύλη εγγραφής. 

##### <a name="successful-response"></a>Επιτυχής απόκρισης
Εάν ο διαχειριστής εγκρίνει τα δικαιώματα για την εφαρμογή σας, θα είναι επιτυχής απάντηση:

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- | --------------- |
| μισθωτή | Ο μισθωτής καταλόγου που παραχωρηθεί τα δικαιώματα εφαρμογής σας το ζητήσει, σε μορφή guid. |
| κατάσταση | Μια τιμή που περιλαμβάνονται στην αίτηση που θα επιστραφεί επίσης στην διακριτικού απάντηση.  Μπορεί να είναι μια συμβολοσειρά οποιοδήποτε περιεχόμενο που θέλετε.  Η κατάσταση χρησιμοποιείται για την κωδικοποίηση πληροφοριών σχετικά με την κατάσταση του χρήστη στην εφαρμογή πριν από την αίτηση ελέγχου ταυτότητας προέκυψε, όπως τη σελίδα ή την προβολή που είχαν στην. |
| admin_consent | Θα οριστεί σε `True`. |


##### <a name="error-response"></a>Απόκριση σφάλμα
Εάν ο διαχειριστής δεν εγκρίνει τα δικαιώματα για την εφαρμογή σας, θα αποτυχίας απάντηση:

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- | --------------- |
| Σφάλμα | Μια συμβολοσειρά κωδικό σφάλματος που μπορεί να χρησιμοποιηθεί για την ταξινόμηση των τύπων σφάλματα που προκύπτουν και μπορεί να χρησιμοποιηθεί προκειμένου να αντιμετωπίζεται σφάλματα. |
| error_description | Ένα συγκεκριμένο μήνυμα σφάλματος που μπορεί να σας βοηθήσει ο προγραμματιστής Προσδιορισμός της αρχικής αιτίας ενός σφάλματος.  |

Αφού έχετε λάβει μια επιτυχημένη απόκριση από την εφαρμογή προμήθεια του τελικού σημείου, την εφαρμογή σας έχει συγκεντρώσει τα δικαιώματα άμεση εφαρμογή τους ζητήσει.  Τώρα μπορείτε να μετακινήσετε σε αίτηση ενός διακριτικού για τον πόρο που θέλετε.

## <a name="get-a-token"></a>Λήψη ενός διακριτικού
Αφού έχετε αποκτήσατε άδειας είναι απαραίτητο για την εφαρμογή σας, μπορείτε να προχωρήσετε κατά τη λήψη διακριτικά πρόσβασης για API.  Για να λάβετε ένα διακριτικό χρησιμοποιώντας το πρόγραμμα-πελάτη εκχώρηση διαπιστευτήρια, Αποστολή πρόσκλησης ΔΗΜΟΣΊΕΥΣΗ για να το `/token` v2.0 τελικού σημείου:

```
POST /common/oauth2/v2.0/token HTTP/1.1
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

client_id=535fb089-9ff3-47b6-9bfb-4f1264799865&scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&client_secret=qWgdYAmab0YSkuL1qKv5bPX&grant_type=client_credentials
```

```
curl -X POST -H "Content-Type: application/x-www-form-urlencoded" -d 'client_id=535fb089-9ff3-47b6-9bfb-4f1264799865&scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&client_secret=qWgdYAmab0YSkuL1qKv5bPX&grant_type=client_credentials' 'https://login.microsoftonline.com/common/oauth2/v2.0/token'
```

| Παράμετρος | | Περιγραφή |
| ----------------------- | ------------------------------- | --------------- |
| client_id | απαιτείται | Το αναγνωριστικό εφαρμογής ότι η πύλη εγγραφής ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)), στους οποίους έχουν ανατεθεί την εφαρμογή σας. |
| πεδίο εφαρμογής | απαιτείται | Η τιμή που μεταβιβάζεται το `scope` παραμέτρου σε αυτήν την αίτηση πρέπει να είναι το αναγνωριστικό πόρου (URI Αναγνωριστικό εφαρμογής) του επιθυμητή πόρου, τίθεται με το `.default` επίθημα.  Ώστε η τιμή του παραδείγματος Microsoft Graph, πρέπει να `https://graph.microsoft.com/.default`.  Αυτή η τιμή σας ενημερώνει για το τελικό σημείο v2.0 ότι όλα τα άμεση εφαρμογή δικαιώματα που έχετε ρυθμίσει τις παραμέτρους για την εφαρμογή σας, αυτό θα πρέπει να θεμάτων ενός διακριτικού για αυτά που αφορούν την επιθυμητή πόρου. |
| client_secret | απαιτείται | Το μυστικό της εφαρμογής που δημιουργήσατε στην πύλη εγγραφής για την εφαρμογή σας. |
| grant_type | απαιτείται | Πρέπει να είναι `client_credentials`. | 

#### <a name="successful-response"></a>Επιτυχής απόκρισης
Μια επιτυχημένη απόκριση θα λάβουν τη μορφή:

```
{
  "token_type": "Bearer",
  "expires_in": 3599,
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBP..."
}
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| access_token | Το διακριτικό πρόσβασης ζητήθηκε. Η εφαρμογή να χρησιμοποιήσετε αυτό το διακριτικό για τον έλεγχο ταυτότητας για την ασφαλή πόρου, όπως ένα API web. |
| token_type | Υποδεικνύει την τιμή διακριτικού τύπου. Ο μόνος τύπος που υποστηρίζει Azure AD είναι `Bearer`.  |
| expires_in | Πόσο χρόνο το διακριτικό πρόσβασης είναι έγκυρη (σε δευτερόλεπτα). |

#### <a name="error-response"></a>Απόκριση σφάλμα
Μια απάντηση σφάλματος θα λάβουν τη μορφή:

```
{
  "error": "invalid_scope",
  "error_description": "AADSTS70011: The provided value for the input parameter 'scope' is not valid. The scope https://foo.microsoft.com/.default is not valid.\r\nTrace ID: 255d1aef-8c98-452f-ac51-23d051240864\r\nCorrelation ID: fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7\r\nTimestamp: 2016-01-09 02:02:12Z",
  "error_codes": [
    70011
  ],
  "timestamp": "2016-01-09 02:02:12Z",
  "trace_id": "255d1aef-8c98-452f-ac51-23d051240864",
  "correlation_id": "fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7"
}
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| Σφάλμα | Μια συμβολοσειρά κωδικό σφάλματος που μπορεί να χρησιμοποιηθεί για την ταξινόμηση των τύπων σφάλματα που προκύπτουν και μπορεί να χρησιμοποιηθεί προκειμένου να αντιμετωπίζεται σφάλματα. |
| error_description | Ένα συγκεκριμένο μήνυμα σφάλματος που μπορεί να σας βοηθήσει ο προγραμματιστής Προσδιορισμός της αρχικής αιτίας ενός σφάλματος ελέγχου ταυτότητας.  |
| error_codes | Μια λίστα STS συγκεκριμένων κωδικών σφάλματος που μπορεί να σας βοηθήσει στη Διαγνωστικά.  |
| χρονική σήμανση | Η ώρα κατά την οποία παρουσιάστηκε το σφάλμα. |
| trace_id | Ένα μοναδικό αναγνωριστικό για την αίτηση που μπορούν να σας βοηθήσουν στην Διαγνωστικά.  |
| correlation_id | Ένα μοναδικό αναγνωριστικό για την αίτηση που μπορούν να σας βοηθήσουν στην Διαγνωστικά σε όλα τα στοιχεία. |

## <a name="use-a-token"></a>Χρησιμοποιήστε ένα διακριτικό
Τώρα που έχετε αποκτήσει ένα διακριτικό, μπορείτε να χρησιμοποιήσετε αυτό το διακριτικό για να κάνετε αιτήσεις για τον πόρο.  Όταν λήξει το διακριτικό, απλά επαναλάβετε την πρόσκληση σε σύσκεψη του `/token` τελικό σημείο για να αποκτήσετε ένα διακριτικό πρόσβασης Φρέσκο.

```
GET /v1.0/me/messages
Host: https://graph.microsoft.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
```

```
// Pro Tip: Try the below command out! (but replace the token with your own)
```

```
curl -X GET -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q" 'https://graph.microsoft.com/v1.0/me/messages'
```

## <a name="code-sample"></a>Δείγμα κώδικα
Για να δείτε ένα παράδειγμα μιας εφαρμογής που υλοποιεί το client_credentials εκχώρηση χρησιμοποιώντας τη Διαχείριση συγκατάθεση τελικό σημείο, ανατρέξτε μας [δείγμα κώδικα μονού v2.0](https://github.com/Azure-Samples/active-directory-dotnet-daemon-v2).
