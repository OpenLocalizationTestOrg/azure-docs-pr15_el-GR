<properties
    pageTitle="Είσοδος Azure AD αναστροφής κλειδιού | Microsoft Azure"
    description="Σε αυτό το άρθρο περιγράφει τις βέλτιστες πρακτικές υπογραφής αναστροφής κλειδιού για Azure Active Directory"
    services="active-directory"
    documentationCenter=".net"
    authors="gsacavdm"
    manager="krassk"
    editor=""/>

<tags
    ms.service="active-directory"
    ms.workload="identity"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="07/18/2016"
    ms.author="gsacavdm"/>

# <a name="signing-key-rollover-in-azure-active-directory"></a>Είσοδος αναστροφής κλειδιού στο Azure Active Directory

Αυτό το θέμα περιγράφει τι πρέπει να γνωρίζετε σχετικά με τα δημόσια κλειδιά που χρησιμοποιούνται σε Azure Active Directory (Azure AD) για να πραγματοποιήσετε κωδικοί ασφαλείας. Είναι σημαντικό να θυμάστε ότι αυτά τα πλήκτρα κατάδειξης σε περιοδική βάση και, σε περίπτωση έκτακτης ανάγκης, μπορεί να γίνει επαναφορά αμέσως. Όλες οι εφαρμογές που χρησιμοποιούν Azure AD πρέπει να μπορείτε να χειρισμού της διαδικασίας αναστροφής κλειδιού ή να δημιουργήσετε μια διαδικασία περιοδικό κατάδειξης μη αυτόματη μέσω προγραμματισμού. Συνεχίστε να διαβάζετε για να κατανοήσετε τον τρόπο λειτουργίας των πλήκτρων, πώς μπορείτε να αξιολογήσετε τις επιπτώσεις των κατάδειξης στην εφαρμογή σας και πώς μπορείτε να ενημερώσετε την εφαρμογή σας ή να δημιουργήσετε μια διαδικασία περιοδικό κατάδειξης μη αυτόματου χειρισμού αναστροφής κλειδιού, εάν είναι απαραίτητο.

## <a name="overview-of-signing-keys-in-azure-ad"></a>Επισκόπηση των είσοδο πλήκτρα Azure AD

Azure AD χρησιμοποιεί κρυπτογράφηση δημόσιου κλειδιού ενσωματωμένη σε βιομηχανικά πρότυπα για τη δημιουργία αξιοπιστίας ανάμεσα στον ίδιο και τις εφαρμογές που χρησιμοποιείτε. Πρακτικά, αυτό λειτουργεί με τον εξής τρόπο: Azure AD χρησιμοποιεί ένα κλειδί υπογραφής που αποτελείται από ένα ζεύγος κλειδιών δημόσια και ιδιωτικά. Όταν ένας χρήστης πραγματοποιεί είσοδο σε μια εφαρμογή που χρησιμοποιεί Azure AD για τον έλεγχο ταυτότητας, Azure AD δημιουργεί έναν κωδικό ασφαλείας που περιέχει πληροφορίες σχετικά με το χρήστη. Αυτό το διακριτικό είναι υπογεγραμμένο από Azure AD χρησιμοποιώντας το ιδιωτικό κλειδί πριν από την αποστολή ξανά με την εφαρμογή. Για να επαληθεύσετε ότι το διακριτικό δεν είναι έγκυρη και στην πραγματικότητα εκδοθέντων από το Azure AD, η εφαρμογή πρέπει να επικυρώσει το διακριτικό υπογραφή χρησιμοποιώντας το δημόσιο κλειδί που εκτίθεται από Azure AD που περιέχεται στο [έγγραφο εντοπισμού OpenID σύνδεση](http://openid.net/specs/openid-connect-discovery-1_0.html) ή SAML/WS-Fed [Ομοσπονδία μετα-δεδομένα εγγράφων](active-directory-federation-metadata.md)του μισθωτή.

Για λόγους ασφαλείας, Azure AD είσοδο κλειδιού ρόλους σε περιοδική βάση και, στην περίπτωση έκτακτης ανάγκης, μπορεί να γίνει επαναφορά αμέσως. Οποιαδήποτε εφαρμογή που ενοποιείται με το Azure AD πρέπει να προετοιμαστείτε για να χειριστείτε ένα συμβάν αναστροφής κλειδιού ανεξάρτητα από το πόσο συχνά μπορεί να προκύψουν. Εάν δεν το και την εφαρμογή προσπαθεί να χρησιμοποιήσει ένα κλειδί έχουν λήξει για να επιβεβαιώσετε την υπογραφή ενός διακριτικού, θα αποτύχει η αίτηση εισόδου.

Πάντα υπάρχει περισσότερους από έναν έγκυρο αριθμό-κλειδί στο έγγραφο εντοπισμού OpenID σύνδεση και το έγγραφο Ομοσπονδία μετα-δεδομένων. Η εφαρμογή σας πρέπει να είστε έτοιμοι να χρησιμοποιήσετε οποιοδήποτε από τα πλήκτρα που καθορίζεται στο έγγραφο, επειδή ένα πλήκτρο μπορεί να γίνει επαναφορά σύντομα, μια άλλη μπορεί να είναι το αντικατάστασης, και ούτω καθεξής.

## <a name="how-to-assess-if-your-application-will-be-affected-and-what-to-do-about-it"></a>Πώς να αξιολογεί εάν η εφαρμογή σας, θα επηρεαστεί και τι μπορείτε να κάνετε για αυτό

Τρόπος χειρισμού αναστροφής κλειδιού της εφαρμογής σας εξαρτάται από μεταβλητές, όπως τον τύπο της εφαρμογής ή τι πρωτόκολλο ταυτότητας και τη βιβλιοθήκη που χρησιμοποιήθηκε. Οι παρακάτω ενότητες διαπιστώσει εάν τους πιο κοινούς τύπους εφαρμογών επηρεάζονται από το αναστροφής κλειδιού και παρέχουν οδηγίες σχετικά με τον τρόπο ενημέρωσης της εφαρμογής για την υποστήριξη αυτόματης κατάδειξης ή να ενημερώσετε με μη αυτόματο τρόπο τον αριθμό-κλειδί.

* [Πρόσβαση σε πόρους εφαρμογές εγγενές πρόγραμμα-πελάτη](#nativeclient)
* [Εφαρμογές Web / APIs πρόσβαση σε πόρους](#webclient)
* [Εφαρμογές Web / API προστασία των πόρων και δημιουργούνται χρησιμοποιώντας τις υπηρεσίες εφαρμογών Azure](#appservices)
* [Εφαρμογές Web / APIs προστασία των πόρων με χρήση της .NET OWIN OpenID σύνδεσης, WS-Fed ή το ενδιάμεσο WindowsAzureActiveDirectoryBearerAuthentication](#owin)
* [Εφαρμογές Web / APIs προστασία των πόρων χρησιμοποιώντας το ενδιάμεσο σύνδεση OpenID πυρήνα .NET ή JwtBearerAuthentication](#owincore)
* [Εφαρμογές Web / APIs προστασία πόρων με χρήση της λειτουργικής μονάδας passport-azure ad Node.js](#passport)
* [Εφαρμογές Web / API προστασία των πόρων και που δημιουργήθηκαν με Visual Studio 2015](#vs2015)
* [Προστασία των πόρων και δημιουργηθεί με το Visual Studio 2013 τις εφαρμογές Web](#vs2013)
* [APIs Web προστασία των πόρων και δημιουργηθεί με το Visual Studio 2013](#vs2013_webapi)
* [Εφαρμογές Web προστασία των πόρων και που δημιουργήθηκαν με το Visual Studio 2012](#vs2012)
* [Εφαρμογές Web προστασία των πόρων και που δημιουργήθηκαν με Visual Studio 2010, o 2008 χρησιμοποιώντας υποδομής ταυτότητας των Windows](#vs2010)
* [Εφαρμογές Web / APIs προστασία των πόρων χρησιμοποιώντας άλλες βιβλιοθήκες ή με μη αυτόματο τρόπο εφαρμογής οποιοδήποτε από τα υποστηριζόμενα πρωτόκολλα](#other)

Αυτές οι οδηγίες είναι **δεν** ισχύει για:

* Εφαρμογές έχουν προστεθεί από το Azure AD εφαρμογής συλλογή (συμπεριλαμβανομένης της προσαρμοσμένης) έχουν ξεχωριστή καθοδήγηση όσον αφορά την είσοδο πλήκτρα. [Περισσότερες πληροφορίες.](active-directory-sso-certs.md)
* Εσωτερικής εφαρμογές που δημοσιεύονται μέσω του διακομιστή μεσολάβησης εφαρμογής δεν χρειάζεται να ανησυχείτε σχετικά με την είσοδο πλήκτρα.

### <a name="nativeclient"></a>Πρόσβαση σε πόρους εφαρμογές εγγενές πρόγραμμα-πελάτη

Εφαρμογές που μόνο την πρόσβαση σε πόρους (δηλαδή Microsoft Graph, KeyVault, API του Outlook και άλλες Microsoft API του Yammer) γενικά μόνο η λήψη διακριτικού και μεταβιβάζουν το κατά μήκος στον κάτοχο του πόρου. Δεδομένου ότι αυτές δεν προστασία πόροι, ελέγχουν το διακριτικό και, επομένως, δεν χρειάζεται να βεβαιωθείτε ότι έχει υπογραφεί σωστά.

Εφαρμογές εγγενές πρόγραμμα-πελάτη, ανεξάρτητα από το επιφάνειας εργασίας ή κινητού, εμπίπτουν σε αυτή την κατηγορία και, επομένως, δεν επηρεάζεται από την εικόνα κατάδειξης.

### <a name="webclient"></a>Εφαρμογές Web / APIs πρόσβαση σε πόρους

Εφαρμογές που μόνο την πρόσβαση σε πόρους (δηλαδή Microsoft Graph, KeyVault, API του Outlook και άλλες Microsoft API του Yammer) γενικά μόνο η λήψη διακριτικού και μεταβιβάζουν το κατά μήκος στον κάτοχο του πόρου. Δεδομένου ότι αυτές δεν προστασία πόροι, ελέγχουν το διακριτικό και, επομένως, δεν χρειάζεται να βεβαιωθείτε ότι έχει υπογραφεί σωστά.

Εφαρμογές Web και web API που χρησιμοποιούν τη ροή μόνο για εφαρμογή (τα διαπιστευτήρια προγράμματος-πελάτη / πιστοποιητικό προγράμματος-πελάτη), εμπίπτουν σε αυτή την κατηγορία και, επομένως, δεν επηρεάζεται από την εικόνα κατάδειξης.

### <a name="appservices"></a>Εφαρμογές Web / API προστασία των πόρων και δημιουργούνται χρησιμοποιώντας τις υπηρεσίες εφαρμογών Azure

Έλεγχος ταυτότητας Azure εφαρμογής των υπηρεσιών / λειτουργίες εξουσιοδότησης (EasyAuth) έχει ήδη της λογικής είναι απαραίτητο να χειρίζεται αναστροφής κλειδιού αυτόματα.

### <a name="owin"></a>Εφαρμογές Web / APIs προστασία των πόρων με χρήση της .NET OWIN OpenID σύνδεσης, WS-Fed ή το ενδιάμεσο WindowsAzureActiveDirectoryBearerAuthentication

Εάν η εφαρμογή σας χρησιμοποιεί το .NET OWIN OpenID σύνδεση, WS-Fed ή το ενδιάμεσο WindowsAzureActiveDirectoryBearerAuthentication, που έχει ήδη της λογικής είναι απαραίτητο να χειρίζεται αναστροφής κλειδιού αυτόματα.

Μπορείτε να επιβεβαιώσετε ότι η εφαρμογή σας χρησιμοποιεί οποιαδήποτε από αυτές τις αναζητώντας οποιοδήποτε από τα εξής τμήματα κώδικα της εφαρμογής σας Startup.cs ή Startup.Auth.cs

```
app.UseOpenIdConnectAuthentication(
     new OpenIdConnectAuthenticationOptions
     {
         // ...
     });
```
```
app.UseWsFederationAuthentication(
    new WsFederationAuthenticationOptions
    {
     // ...
    });
```
```
 app.UseWindowsAzureActiveDirectoryBearerAuthentication(
     new WindowsAzureActiveDirectoryBearerAuthenticationOptions
     {
     // ...
     });
```

### <a name="owincore"></a>Εφαρμογές Web / APIs προστασία των πόρων χρησιμοποιώντας το ενδιάμεσο σύνδεση OpenID πυρήνα .NET ή JwtBearerAuthentication

Εάν η εφαρμογή σας χρησιμοποιεί το ενδιάμεσο το .NET πυρήνα OWIN OpenID η σύνδεση ή JwtBearerAuthentication, που έχει ήδη της λογικής είναι απαραίτητο να χειρίζεται αναστροφής κλειδιού αυτόματα.

Μπορείτε να επιβεβαιώσετε ότι η εφαρμογή σας χρησιμοποιεί οποιαδήποτε από αυτές τις αναζητώντας οποιοδήποτε από τα εξής τμήματα κώδικα της εφαρμογής σας Startup.cs ή Startup.Auth.cs

```
app.UseOpenIdConnectAuthentication(
     new OpenIdConnectAuthenticationOptions
     {
         // ...
     });
```
```
app.UseJwtBearerAuthentication(
    new JwtBearerAuthenticationOptions
    {
     // ...
    });
```

### <a name="passport"></a>Εφαρμογές Web / APIs προστασία πόρων με χρήση της λειτουργικής μονάδας passport-azure ad Node.js

Εάν η εφαρμογή σας χρησιμοποιεί τη λειτουργική μονάδα passport ad Node.js, που έχει ήδη της λογικής είναι απαραίτητο να χειρίζεται αναστροφής κλειδιού αυτόματα.

Μπορείτε να επιβεβαιώσετε ότι το passport-ad εφαρμογής κάνοντας αναζήτηση για το παρακάτω τμήμα κώδικα στο app.js της εφαρμογής σας

```
var OIDCStrategy = require('passport-azure-ad').OIDCStrategy;

passport.use(new OIDCStrategy({
    //...
));
```

### <a name="vs2015"></a>Εφαρμογές Web / API προστασία των πόρων και που δημιουργήθηκαν με Visual Studio 2015

Εάν η εφαρμογή σας τα οποία δημιουργήθηκε με τη χρήση προτύπου εφαρμογής web στο Visual Studio 2015 και έχετε επιλέξει **Εργασία σχολείο τους λογαριασμούς και** από το μενού **Αλλαγής ελέγχου ταυτότητας** , που έχει ήδη της λογικής είναι απαραίτητο να χειρίζεται αναστροφής κλειδιού αυτόματα. Αυτή η λογική, ενσωματωμένα στο ενδιάμεσο σύνδεση OpenID OWIN, ανακτά και αποθηκεύει προσωρινά τα πλήκτρα από το έγγραφο εντοπισμού OpenID σύνδεση και περιοδικά ανανεώνει τους.

Αν έχετε προσθέσει τον έλεγχο ταυτότητας στη λύση σας με μη αυτόματο τρόπο, η εφαρμογή σας ίσως δεν έχετε της λογικής απαραίτητες αναστροφής κλειδιού. Θα χρειαστεί να γράψετε στον εαυτό σας ή ακολουθήστε τα βήματα στο [εφαρμογές Web / APIs χρησιμοποιώντας άλλες βιβλιοθήκες ή με μη αυτόματο τρόπο εφαρμογής οποιοδήποτε από τα υποστηριζόμενα πρωτόκολλα.](#other).

### <a name="vs2013"></a>Προστασία των πόρων και δημιουργηθεί με το Visual Studio 2013 τις εφαρμογές Web

Εάν η εφαρμογή σας δημιουργήθηκε με χρήση ενός προτύπου εφαρμογής web στο Visual Studio 2013 και έχετε επιλέξει **Εταιρικοί λογαριασμοί** από το μενού **Αλλαγής ελέγχου ταυτότητας** , που έχει ήδη της λογικής είναι απαραίτητο να χειρίζεται αναστροφής κλειδιού αυτόματα. Αυτή η λογική αποθηκεύει μοναδικό αναγνωριστικό της εταιρείας σας και τις πληροφορίες του κλειδιού υπογραφής σε δύο πίνακες βάσεων δεδομένων που σχετίζονται με το έργο. Μπορείτε να βρείτε τη συμβολοσειρά σύνδεσης για τη βάση δεδομένων σε αρχείο Web.config του έργου.

Αν έχετε προσθέσει τον έλεγχο ταυτότητας στη λύση σας με μη αυτόματο τρόπο, η εφαρμογή σας ίσως δεν έχετε της λογικής απαραίτητες αναστροφής κλειδιού. Θα χρειαστεί να γράψετε στον εαυτό σας ή ακολουθήστε τα βήματα στο [εφαρμογές Web / APIs χρησιμοποιώντας άλλες βιβλιοθήκες ή με μη αυτόματο τρόπο εφαρμογής οποιοδήποτε από τα υποστηριζόμενα πρωτόκολλα.](#other).

Ακολουθήστε τα παρακάτω βήματα θα σας βοηθήσει να επιβεβαιώσετε ότι η λογική λειτουργούν σωστά στην εφαρμογή σας.

1. Στο Visual Studio 2013, ανοίξτε τη λύση και, στη συνέχεια, κάντε κλικ στην καρτέλα **Εξερεύνηση Server** στο δεξιό παράθυρο.
2. Ανάπτυξη **συνδέσεις δεδομένων**, **DefaultConnection**και, στη συνέχεια, **οι πίνακες**. Εντοπίστε τον πίνακα **IssuingAuthorityKeys** , κάντε δεξί κλικ και, στη συνέχεια, κάντε κλικ στην επιλογή **Εμφάνιση πίνακα δεδομένων**.
3. Στον πίνακα **IssuingAuthorityKeys** , θα υπάρχει τουλάχιστον μία γραμμή, που αντιστοιχεί στην τιμή αποτύπωση για το κλειδί. Διαγραφή οποιεσδήποτε γραμμές στον πίνακα.
4. Κάντε δεξί κλικ στον πίνακα **μισθωτές** και, στη συνέχεια, κάντε κλικ στην επιλογή **Εμφάνιση πίνακα δεδομένων**.
5. Στον πίνακα **μισθωτές** , θα υπάρχει τουλάχιστον μία γραμμή, που αντιστοιχεί σε ένα αναγνωριστικό μισθωτή μοναδικό καταλόγου. Διαγραφή οποιεσδήποτε γραμμές στον πίνακα. Εάν δεν μπορείτε να διαγράψετε τις γραμμές στον τόσο το **μισθωτές** και **IssuingAuthorityKeys** πίνακα, θα λάβετε ένα σφάλμα κατά το χρόνο εκτέλεσης.
6. Δημιουργία και εκτέλεση της εφαρμογής. Αφού έχετε συνδεθεί λογαριασμό σας, μπορείτε να διακόψετε την εφαρμογή.
7. Επιστρέψτε στην **Εξερεύνηση Server** και εξετάστε τις τιμές στον πίνακα **IssuingAuthorityKeys** και **μισθωτές** . Θα παρατηρήσετε ότι αυτές έχουν έχουν αυτόματα ξανά με τις κατάλληλες πληροφορίες από το έγγραφο Ομοσπονδία μετα-δεδομένων.

### <a name="vs2013"></a>APIs Web προστασία των πόρων και δημιουργηθεί με το Visual Studio 2013

Εάν δημιουργήσατε API εφαρμογής web στο Visual Studio 2013 χρησιμοποιώντας το πρότυπο Web API και, στη συνέχεια, επιλέξετε **Εταιρικοί λογαριασμοί** από το μενού **Αλλαγής ελέγχου ταυτότητας** , έχετε ήδη της λογικής απαραίτητες στην εφαρμογή σας.

Εάν έχετε ρυθμίσει με μη αυτόματο τρόπο τον έλεγχο ταυτότητας, ακολουθήστε τις οδηγίες παρακάτω για να μάθετε πώς να ρυθμίσετε τις παραμέτρους του API Web για να ενημερώσετε αυτόματα τις βασικές πληροφορίες.

Το παρακάτω τμήμα κώδικα παρουσιάζει πώς μπορείτε να λάβετε την πιο πρόσφατη πλήκτρα από το έγγραφο Ομοσπονδία μετα-δεδομένων και, στη συνέχεια, χρησιμοποιήστε το [Πρόγραμμα χειρισμού διακριτικού JWT](https://msdn.microsoft.com/library/dn205065.aspx) για να επικυρώσει το διακριτικό. Το τμήμα κώδικα προϋποθέτει ότι πρόκειται να χρησιμοποιήσετε το δικό σας μηχανισμό αποθήκευσης για συνεχίζεται τον αριθμό-κλειδί για την επικύρωση μελλοντική διακριτικά από Azure AD, είτε πρόκειται για σε μια βάση δεδομένων, αρχείο ρύθμισης παραμέτρων ή σε άλλη θέση.

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IdentityModel.Tokens;
using System.Configuration;
using System.Security.Cryptography.X509Certificates;
using System.Xml;
using System.IdentityModel.Metadata;
using System.ServiceModel.Security;
using System.Threading;

namespace JWTValidation
{
    public class JWTValidator
    {
        private string MetadataAddress = "[Your Federation Metadata document address goes here]";

        // Validates the JWT Token that's part of the Authorization header in an HTTP request.
        public void ValidateJwtToken(string token)
        {
            JwtSecurityTokenHandler tokenHandler = new JwtSecurityTokenHandler()
            {
                // Do not disable for production code
                CertificateValidator = X509CertificateValidator.None
            };

            TokenValidationParameters validationParams = new TokenValidationParameters()
            {
                AllowedAudience = "[Your App ID URI goes here, as registered in the Azure Classic Portal]",
                ValidIssuer = "[The issuer for the token goes here, such as https://sts.windows.net/68b98905-130e-4d7c-b6e1-a158a9ed8449/]",
                SigningTokens = GetSigningCertificates(MetadataAddress)

                // Cache the signing tokens by your desired mechanism
            };

            Thread.CurrentPrincipal = tokenHandler.ValidateToken(token, validationParams);
        }

        // Returns a list of certificates from the specified metadata document.
        public List<X509SecurityToken> GetSigningCertificates(string metadataAddress)
        {
            List<X509SecurityToken> tokens = new List<X509SecurityToken>();

            if (metadataAddress == null)
            {
                throw new ArgumentNullException(metadataAddress);
            }

            using (XmlReader metadataReader = XmlReader.Create(metadataAddress))
            {
                MetadataSerializer serializer = new MetadataSerializer()
                {
                    // Do not disable for production code
                    CertificateValidationMode = X509CertificateValidationMode.None
                };

                EntityDescriptor metadata = serializer.ReadMetadata(metadataReader) as EntityDescriptor;

                if (metadata != null)
                {
                    SecurityTokenServiceDescriptor stsd = metadata.RoleDescriptors.OfType<SecurityTokenServiceDescriptor>().First();

                    if (stsd != null)
                    {
                        IEnumerable<X509RawDataKeyIdentifierClause> x509DataClauses = stsd.Keys.Where(key => key.KeyInfo != null && (key.Use == KeyType.Signing || key.Use == KeyType.Unspecified)).
                                                             Select(key => key.KeyInfo.OfType<X509RawDataKeyIdentifierClause>().First());

                        tokens.AddRange(x509DataClauses.Select(token => new X509SecurityToken(new X509Certificate2(token.GetX509RawData()))));
                    }
                    else
                    {
                        throw new InvalidOperationException("There is no RoleDescriptor of type SecurityTokenServiceType in the metadata");
                    }
                }
                else
                {
                    throw new Exception("Invalid Federation Metadata document");
                }
            }
            return tokens;
        }
    }
}
```

### <a name="vs2012"></a>Εφαρμογές Web προστασία των πόρων και που δημιουργήθηκαν με το Visual Studio 2012

Εάν η εφαρμογή σας έχει δημιουργηθεί στο Visual Studio 2012, πιθανότατα χρησιμοποιούσατε την ταυτότητα και εργαλείο πρόσβασης για να ρυθμίσετε την εφαρμογή σας. Επίσης, είναι πιθανό ότι χρησιμοποιείτε το [Αρχείο επικύρωση εκδότη όνομα μητρώου (VINR)](https://msdn.microsoft.com/library/dn205067.aspx). Το VINR είναι υπεύθυνη για τη διατήρηση πληροφορίες σχετικά με τις υπηρεσίες παροχής ταυτότητας αξιόπιστων (Azure AD) και τα πλήκτρα που χρησιμοποιούνται για την επικύρωση διακριτικά εκδοθεί από τους. Το VINR επίσης καθιστά εύκολη την αυτόματη ενημέρωση του βασικών πληροφοριών που είναι αποθηκευμένες σε ένα αρχείο Web.config κατά τη λήψη του πιο πρόσφατη εγγράφου Ομοσπονδία μετα-δεδομένων που σχετίζεται με τον κατάλογο, επιλέγοντας εάν η ρύθμιση παραμέτρων είναι ενημερωμένο με την πιο πρόσφατη έγγραφο και ενημέρωση της εφαρμογής για να χρησιμοποιήσετε το νέο κλειδί ανάλογα με τις απαιτήσεις.

Εάν έχετε δημιουργήσει την εφαρμογή σας χρησιμοποιώντας οποιαδήποτε δείγματα κώδικα ή τεκμηρίωση αναλυτικές οδηγίες που παρέχονται από τη Microsoft, η λογική αναστροφής κλειδιού περιλαμβάνεται ήδη στο έργο σας. Θα παρατηρήσετε ότι υπάρχει ήδη τον παρακάτω κώδικα στο έργο σας. Εάν η εφαρμογή σας δεν διαθέτει ήδη αυτή η λογική, ακολουθήστε τα βήματα που περιγράφονται παρακάτω για να την προσθέσετε και για να επιβεβαιώσετε ότι λειτουργεί σωστά.

1. Στην **Εξερεύνηση λύσεων**, προσθέστε μια αναφορά σε συγκρότησης **System.IdentityModel** για το κατάλληλο έργο.
2. Ανοίξτε το αρχείο **Global.asax.cs** και προσθέστε τα ακόλουθα χρησιμοποιώντας οδηγίες:
```
using System.Configuration;
using System.IdentityModel.Tokens;
```
3. Προσθέστε την ακόλουθη μέθοδο για το αρχείο **Global.asax.cs** :
```
protected void RefreshValidationSettings()
{
    string configPath = AppDomain.CurrentDomain.BaseDirectory + "\\" + "Web.config";
    string metadataAddress =
                  ConfigurationManager.AppSettings["ida:FederationMetadataLocation"];
    ValidatingIssuerNameRegistry.WriteToConfig(metadataAddress, configPath);
}
```
4. Κλήση της μεθόδου **RefreshValidationSettings()** στη μέθοδο **Application_Start()** στο **Global.asax.cs** , όπως φαίνεται:
```
protected void Application_Start()
{
    AreaRegistration.RegisterAllAreas();
    ...
    RefreshValidationSettings();
}
```

Αφού έχετε ακολουθήσει τα παρακάτω βήματα, Web.config της εφαρμογής σας θα ενημερωθεί με τις πιο πρόσφατες πληροφορίες από το έγγραφο μετα-δεδομένων ομοσπονδίας, όπως τα πλήκτρα με τα πιο πρόσφατα. Αυτή η ενημέρωση θα παρουσιαστεί κάθε φορά που ο χώρος συγκέντρωσης εφαρμογών ανακυκλώνει στις υπηρεσίες IIS; από προεπιλογή των υπηρεσιών IIS έχει οριστεί σε Ανακύκλωσης εφαρμογές κάθε 29 ώρες.

Ακολουθήστε τα παρακάτω βήματα για να βεβαιωθείτε ότι λειτουργεί η λογική αναστροφής κλειδιού.

1. Αφού επαληθεύσετε ότι η εφαρμογή σας χρησιμοποιεί τον παραπάνω κώδικα, ανοίξτε το αρχείο **Web.config** και μεταβείτε σε το **<issuerNameRegistry>** μπλοκ, ειδικά αναζητάτε τα ακόλουθα μερικές γραμμές:
```
<issuerNameRegistry type="System.IdentityModel.Tokens.ValidatingIssuerNameRegistry, System.IdentityModel.Tokens.ValidatingIssuerNameRegistry">
        <authority name="https://sts.windows.net/ec4187af-07da-4f01-b18f-64c2f5abecea/">
          <keys>
            <add thumbprint="3A38FA984E8560F19AADC9F86FE9594BB6AD049B" />
          </keys>
```
2. Στο το **<add thumbprint=””>** τη ρύθμιση, αλλάξτε την τιμή αποτύπωση, αντικαθιστώντας οποιονδήποτε χαρακτήρα με έναν άλλο. Αποθηκεύστε το αρχείο **Web.config** .

3. Δημιουργία της εφαρμογής και, στη συνέχεια, εκτελέστε το. Εάν μπορείτε να ολοκληρώσετε τη διαδικασία εισόδου, η εφαρμογή σας είναι ενημέρωση με επιτυχία τον αριθμό-κλειδί κατά τη λήψη τις απαιτούμενες πληροφορίες από το έγγραφο μετα-δεδομένων ομοσπονδίας του καταλόγου σας. Εάν αντιμετωπίζετε προβλήματα εισόδου στην, βεβαιωθείτε ότι οι αλλαγές στην εφαρμογή σας είναι σωστή ανάγνωσης στο θέμα [Προσθήκη καθολικής σύνδεσης για να σας με χρήση εφαρμογής Web Azure AD](https://github.com/Azure-Samples/active-directory-dotnet-webapp-openidconnect) , ή τη λήψη και έλεγχο το παρακάτω δείγμα κώδικα: [Εφαρμογή Cloud πολλών μισθωτή για το Azure Active Directory](https://code.msdn.microsoft.com/multi-tenant-cloud-8015b84b).


### <a name="vs2010"></a>Εφαρμογές Web προστασία των πόρων και που δημιουργήθηκαν με το Visual Studio 2008 ή 2010 και Foundation ταυτότητας των Windows (WIF) έκδοση 1.0 για το .NET 3.5

Εάν η ενσωματωμένη εφαρμογή στην έκδοση 1.0 WIF, δεν υπάρχει παρεχόμενη μηχανισμός για την αυτόματη ανανέωση ρύθμισης παραμέτρων της εφαρμογής σας για να χρησιμοποιήσετε έναν νέο αριθμό-κλειδί.

- *Ευκολότερος τρόπος* Χρησιμοποιήστε το tooling FedUtil περιλαμβάνονται στο WIF SDK, το οποίο μπορεί να ανακτήσετε την πιο πρόσφατη έγγραφο μετα-δεδομένων και να ενημερώσετε τις ρυθμίσεις σας.
- Ενημερώστε την εφαρμογή με το διαίρεσης 4,5 .NET, το οποίο περιλαμβάνει την πιο πρόσφατη έκδοση του WIF που βρίσκεται στο χώρο ονομάτων συστήματος. Στη συνέχεια, μπορείτε να χρησιμοποιήσετε το [Αρχείο επικύρωση εκδότη όνομα μητρώου (VINR)](https://msdn.microsoft.com/library/dn205067.aspx) για να εκτελέσετε τις Αυτόματες ενημερώσεις των παραμέτρων της εφαρμογής.
- Εκτελέστε μια μη αυτόματη κατάδειξης σύμφωνα με τις οδηγίες στο τέλος αυτού του εγγράφου οδηγίες.

Οδηγίες για να χρησιμοποιήσετε το FedUtil για να ενημερώσετε τις ρυθμίσεις σας:

1. Βεβαιωθείτε ότι έχετε την έκδοση 1.0 WIF SDK εγκατεστημένο στον υπολογιστή σας ανάπτυξης για το Visual Studio 2008 ή 2010. Μπορείτε να [κάνετε λήψη του από εδώ](https://www.microsoft.com/en-us/download/details.aspx?id=4451) , εάν δεν έχετε ακόμη εγκαταστήσει το.
2. Στο Visual Studio, ανοίξτε τη λύση, και, στη συνέχεια, κάντε δεξί κλικ στο έργο που ισχύουν και επιλέξτε **Ενημέρωση Ομοσπονδία μετα-δεδομένων**. Εάν αυτή η επιλογή δεν είναι διαθέσιμη, FedUtil ή/και την έκδοση 1.0 WIF SDK δεν έχει εγκατασταθεί.
3. Από τη γραμμή εντολών, επιλέξτε **Update** για να ξεκινήσει η ενημέρωση μετα-δεδομένων του ομοσπονδίας. Εάν έχετε πρόσβαση στο περιβάλλον διακομιστή όπου φιλοξενούνται την εφαρμογή, μπορείτε να χρησιμοποιήσετε προαιρετικά του FedUtil [αυτόματων μετα-δεδομένων ενημέρωση του χρονοδιαγράμματος](https://msdn.microsoft.com/library/ee517272.aspx).
4. Κάντε κλικ στο κουμπί **Τέλος** για να ολοκληρώσετε τη διαδικασία της ενημέρωσης.

### <a name="other"></a>Εφαρμογές Web / APIs προστασία των πόρων χρησιμοποιώντας άλλες βιβλιοθήκες ή με μη αυτόματο τρόπο εφαρμογής οποιοδήποτε από τα υποστηριζόμενα πρωτόκολλα

Εάν χρησιμοποιείτε κάποια άλλη βιβλιοθήκη ή με μη αυτόματο τρόπο υλοποιηθεί οποιοδήποτε από τα υποστηριζόμενα πρωτόκολλα, θα πρέπει να εξετάσετε τη βιβλιοθήκη ή την εφαρμογή για να βεβαιωθείτε ότι το κλειδί ανακτώνται από το έγγραφο εντοπισμού OpenID σύνδεση ή το έγγραφο Ομοσπονδία μετα-δεδομένων. Ένας τρόπος για να ελέγξετε για αυτό είναι να κάνετε αναζήτηση σε σας κώδικα ή κώδικα στη βιβλιοθήκη για κλήσεις εκτός του εγγράφου εντοπισμού OpenID ή το έγγραφο Ομοσπονδία μετα-δεδομένων.

Εάν αυτά κλειδιού είναι αποθηκευμένα σε ένα σημείο ή οποίος καθορίζεται στην εφαρμογή σας, μπορείτε να κάνετε με μη αυτόματο τρόπο ανακτήστε το κλειδί και το ανάλογα με την εκτελέσετε μια μη αυτόματη κατάδειξης σύμφωνα με τις οδηγίες στο τέλος αυτού του εγγράφου καθοδήγηση ενημερωμένη έκδοση. **Είναι συνιστάται ότι μπορείτε να βελτιώσετε την εφαρμογή σας για την υποστήριξη αυτόματης κατάδειξης** χρησιμοποιώντας οποιαδήποτε από τις μεθόδους διάρθρωση σε αυτό το άρθρο για να αποφύγετε μελλοντικές διακοπές και επιβάρυνσης εάν αυξάνεται Azure AD είναι cadence κατάδειξης ή έχει μια έκτακτης ανάγκης κατάδειξης εκτός εύρους.

## <a name="how-to-test-your-application-to-determine-if-it-will-be-affected"></a>Πώς μπορείτε να δοκιμάσετε την εφαρμογή σας για να προσδιορίσετε εάν αυτό, θα επηρεαστεί

Μπορείτε να επικυρώσετε είτε εφαρμογή σας υποστηρίζει αυτόματη αναστροφής κλειδιού κατά τη λήψη των δεσμών ενεργειών και ακολουθώντας τις οδηγίες στο θέμα [αυτό το αποθετήριο δεδομένων GitHub.](https://github.com/AzureAD/azure-activedirectory-powershell-tokenkey)

## <a name="how-to-perform-a-manual-rollover-if-you-application-does-not-support-automatic-rollover"></a>Πώς να εκτελείτε μη αυτόματη κατάδειξης εάν εφαρμογή που δεν υποστηρίζει αυτόματη κατάδειξης

Εάν η εφαρμογή σας κάνει **δεν** αυτόματων κατάδειξης υποστήριξης, θα πρέπει να δημιουργήσετε μια διαδικασία που περιοδικά παρακολουθεί Azure AD υπογραφής πλήκτρα και εκτελεί μια μη αυτόματη κατάδειξης ανάλογα. [Αποθετήριο GitHub αυτό](https://github.com/AzureAD/azure-activedirectory-powershell-tokenkey) περιέχει δέσμες ενεργειών και οδηγίες σχετικά με το πώς μπορείτε να το κάνετε αυτό.
