<properties
   pageTitle="Πώς να δημιουργείτε μια εφαρμογή η οποία μπορεί να συνδεθείτε σε οποιονδήποτε χρήστη Azure Active Directory | Microsoft Azure"
   description="Βήμα προς βήμα οδηγίες για τη δημιουργία μιας εφαρμογής που μπορεί να συνδεθείτε σε ένα χρήστη από οποιαδήποτε μισθωτή Azure Active Directory, γνωστές και ως μια εφαρμογή πολλών μισθωτή."
   services="active-directory"
   documentationCenter=""
   authors="skwan"
   manager="mbaldwin"
   editor=""/>

<tags
   ms.service="active-directory"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="identity"
   ms.date="10/11/2016"
   ms.author="skwan;bryanla"/>

# <a name="how-to-sign-in-any-azure-active-directory-ad-user-using-the-multi-tenant-application-pattern"></a>Μάθετε πώς να συνδεθείτε σε οποιονδήποτε χρήστη Azure Active Directory (AD) χρησιμοποιώντας το μοτίβο εφαρμογή πολλών μισθωτή
Αν προσφέρετε ένα λογισμικό ως μιας εφαρμογής υπηρεσίας για πολλές επιχειρήσεις, μπορείτε να ρυθμίσετε την εφαρμογή σας για να αποδεχτείτε εισόδου πρόσθετα από οποιαδήποτε μισθωτή Azure AD.  Στο Azure AD αυτό ονομάζεται δημιουργία πολλών μισθωτή σας εφαρμογή.  Οι χρήστες σε οποιαδήποτε μισθωτή Azure AD θα μπορούν να πραγματοποιήσουν είσοδο στην εφαρμογή σας μετά την δέχεστε να χρησιμοποιήσετε το λογαριασμό με την εφαρμογή.  

Εάν έχετε μια υπάρχουσα εφαρμογή που έχει το δικό του σύστημα λογαριασμό ή υποστηρίζει άλλα είδη είσοδος από άλλες υπηρεσίες παροχής cloud, η προσθήκη Azure AD είσοδος από οποιαδήποτε μισθωτή είναι τόσο απλή όσο η καταχώρηση της εφαρμογής σας, προσθήκη εισόδου στον κώδικα μέσω OAuth2, σύνδεση OpenID ή SAML και με ένα σύμβολο στο πλαίσιο με κουμπί του Microsoft στην εφαρμογή σας. Κάντε κλικ στο κουμπί παρακάτω για να μάθετε περισσότερα σχετικά με την εμπορική προσαρμογή την εφαρμογή σας.

[! [Είσοδος στο κουμπί] [AAD-είσοδος]][AAD-App-Branding]


Σε αυτό το άρθρο προϋποθέτει ότι είστε ήδη εξοικειωμένοι με τη δημιουργία μιας εφαρμογής μία μισθωτή για Azure AD.  Εάν δεν, κεφαλή πίσω έως και την [κεντρική σελίδα του οδηγού για προγραμματιστές] [ AAD-Dev-Guide] και δοκιμάστε κάποια από τη Γρήγορη εκκίνηση!

Υπάρχουν τέσσερα απλά βήματα για να μετατρέψετε την εφαρμογή σας σε μια εφαρμογή πολλών μισθωτών Azure AD:

1.  Ενημερώστε την εγγραφή σας εφαρμογής για να πολλών μισθωτή
2.  Ενημερώστε τον κώδικά σας για να στείλετε προσκλήσεις για να το/Common τελικού σημείου 
3.  Ενημερώστε τον κωδικό για το χειρισμό πολλαπλών τιμών εκδότη
4.  Κατανόηση των χρηστών και διαχείρισης συγκατάθεση και να κάνετε αλλαγές κατάλληλο κώδικα

Ας ρίξουμε μια ματιά σε κάθε βήμα με λεπτομέρειες. Μπορείτε επίσης να μεταβείτε απευθείας σε [αυτήν τη λίστα των δειγμάτων πολλών μισθωτών][AAD-Samples-MT].

## <a name="update-registration-to-be-multi-tenant"></a>Ενημέρωση εγγραφής για να πολλών μισθωτή
Από προεπιλογή, web app/API καταχωρήσεων σε Azure AD είναι μία μισθωτή.  Μπορείτε να κάνετε την εγγραφή σας πολλών μισθωτών, μπορείτε να βρείτε το διακόπτη "Εφαρμογή είναι πολλών μισθωτών" στη σελίδα Ρύθμιση παραμέτρων την εγγραφή σας εφαρμογής στην [πύλη του Azure κλασική] [ AZURE-classic-portal] και ορισμός της σε "Ναι".

Σημείωση: Πριν από μια εφαρμογή του μπορούν να γίνουν πολλών μισθωτών, Azure AD απαιτεί το URI Αναγνωριστικό εφαρμογής της εφαρμογής για να είναι καθολικά μοναδικά. Το URI Αναγνωριστικό εφαρμογής είναι ένας από τους τρόπους που προσδιορίζεται μια εφαρμογή του πρωτοκόλλου μηνυμάτων.  Για μια εφαρμογή μία μισθωτή, αρκεί για το URI Αναγνωριστικό εφαρμογής για να είναι μοναδικό μέσα σε αυτόν το μισθωτή.  Για μια εφαρμογή πολλών μισθωτή, πρέπει να είναι μοναδικό καθολικό, ώστε να Azure AD να βρείτε την εφαρμογή σε όλα μισθωτές.  Καθολικό τη μοναδικότητα τίθεται σε ισχύ απαιτώντας το URI Αναγνωριστικό εφαρμογής για να έχετε ένα όνομα κεντρικού υπολογιστή που ταιριάζει με επαληθευτεί τομέα του μισθωτή του Azure AD.  Για παράδειγμα, αν το όνομα του μισθωτή σας ήταν contoso.onmicrosoft.com, στη συνέχεια, ένα έγκυρο URI Αναγνωριστικό εφαρμογής θα `https://contoso.onmicrosoft.com/myapp`.  Εάν το μισθωτή είχε επαληθευτεί τομέα της `contoso.com`, στη συνέχεια, θα είναι επίσης ένα έγκυρο URI Αναγνωριστικό εφαρμογής `https://contoso.com/myapp`.  Ρύθμιση μιας εφαρμογής ως πολλών μισθωτών θα αποτύχει εάν το URI Αναγνωριστικό εφαρμογής δεν ακολουθεί αυτό το μοτίβο.

Καταχωρήσεις εγγενές πρόγραμμα-πελάτη είναι πολλών μισθωτών από προεπιλογή.  Δεν χρειάζεται να κάνετε κάποια ενέργεια για να κάνετε εγγενή μισθωτή πολλών καταχώρηση εφαρμογής υπολογιστή-πελάτη.

## <a name="update-your-code-to-send-requests-to-common"></a>Ενημερώστε τον κώδικά σας για να στείλετε προσκλήσεις σε/Common
Σε μια εφαρμογή μία μισθωτή, αποστέλλονται είσοδος αιτήσεις του μισθωτή είσοδος τελικό σημείο.   Για παράδειγμα, για το contoso.onmicrosoft.com θα είναι το τελικό σημείο:

    https://login.microsoftonline.com/contoso.onmicrosoft.com

Προσκλήσεις που αποστέλλονται σε έναν μισθωτή τελικού σημείου να συνδεθείτε στην χρήστες (ή επισκέπτες) σε αυτόν το μισθωτή για τις εφαρμογές σε αυτόν το μισθωτή.  Με μια εφαρμογή πολλών μισθωτών, η εφαρμογή δεν γνωρίζει προκαταβολικά τι μισθωτή ο χρήστης είναι από, συνεπώς δεν μπορείτε να στείλετε προσκλήσεις τελικό σημείο του μισθωτή.  Αντί για αυτό, αποστέλλονται προσκλήσεις σε ένα τελικό σημείο που multiplexes κατά μήκος μισθωτές όλα Azure AD:

    https://login.microsoftonline.com/common

Όταν το Azure AD λαμβάνει μια αίτηση στο το/Common τελικό σημείο, την είσοδο στο χρήστη και κατά συνέπεια ανακαλύψει ποιο μισθωτή ο χρήστης είναι από.  Το/κοινό τελικό σημείο λειτουργεί με όλα τα πρωτόκολλα ελέγχου ταυτότητας που υποστηρίζονται από το Azure AD: σύνδεση OpenID, διακριτικό 2.0, SAML 2.0 και WS ομοσπονδίας.

Είσοδος απάντηση με την εφαρμογή, στη συνέχεια, περιέχει ένα διακριτικό που αντιπροσωπεύει το χρήστη.  Η τιμή εκδότη στο διακριτικό ενημερώνει μια εφαρμογή του τι είναι ο χρήστης από το μισθωτή.  Όταν επιστρέφει μια απάντηση από το/Common τελικό σημείο, η τιμή εκδότη στο διακριτικό θα αντιστοιχούν στο μισθωτή του χρήστη.  Είναι σημαντικό να λάβετε υπόψη το/Common τελικού σημείου δεν είναι ένας μισθωτής και δεν είναι ένας εκδότης, είναι απλώς μια Πολυπλέκτης.  Όταν χρησιμοποιείτε/Common, της λογικής της εφαρμογής σας για να επικυρώσει τα διακριτικά πρέπει να ενημερωθούν ώστε να λαμβάνει υπόψη. 

Όπως προαναφέρθηκε, εφαρμογές πολλαπλών μισθωτή πρέπει να παρέχουν επίσης μια συνεπή εμπειρία εισόδου για τους χρήστες, μετά την εφαρμογή Azure AD εμπορική προσαρμογή κατευθυντήριες γραμμές. Κάντε κλικ στο κουμπί παρακάτω για να μάθετε περισσότερα σχετικά με την εμπορική προσαρμογή την εφαρμογή σας.

[! [Είσοδος στο κουμπί] [AAD-είσοδος]][AAD-App-Branding]

Ας ρίξουμε μια ματιά τη χρήση του/Common τελικό σημείο και υλοποίηση της κώδικα με περισσότερες λεπτομέρειες.

## <a name="update-your-code-to-handle-multiple-issuer-values"></a>Ενημερώστε τον κωδικό για το χειρισμό πολλαπλών τιμών εκδότη
Εφαρμογές Web και web APIs λαμβάνετε και επικύρωση διακριτικά από Azure AD.  

> [AZURE.NOTE] Ενώ εφαρμογές προγράμματος-πελάτη εγγενούς αίτηση και να λαμβάνετε τα διακριτικά από το Azure AD, κάνουν αυτό να τους στείλετε API, όπου επικυρώνονται.  Εγγενείς εφαρμογές δεν είναι η επικύρωση διακριτικά και πρέπει να τα χειριστεί ως αδιαφανές.

Ας ρίξουμε μια ματιά στο πώς μια εφαρμογή επικυρώσει τα διακριτικά που λαμβάνει από Azure AD.  Μια εφαρμογή μία μισθωτή κανονικά θα λάβουν μια τιμή τελικού σημείου όπως:

    https://login.microsoftonline.com/contoso.onmicrosoft.com

και χρησιμοποιήστε το για να δημιουργήσετε μια διεύθυνση URL μετα-δεδομένα (σε αυτήν την περίπτωση, OpenID σύνδεση), όπως:

    https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration

Για να κάνετε λήψη δύο βασικές πληροφορίες που χρησιμοποιούνται για την επικύρωση διακριτικά: ο μισθωτής υπογραφής πλήκτρα και τιμή εκδότη.  Κάθε μισθωτή Azure AD περιλαμβάνει μια τιμή μοναδικό εκδότη της φόρμας:

    https://sts.windows.net/31537af4-6d77-4bb9-a681-d2394888ea26/

όπου η τιμή GUID είναι η έκδοση Μετονομασία ασφαλείς το αναγνωριστικό μισθωτή του μισθωτή.  Εάν κάνετε κλικ στη σύνδεση μετα-δεδομένων παραπάνω για `contoso.onmicrosoft.com`, μπορείτε να δείτε αυτήν την τιμή εκδότη στο έγγραφο.

Όταν μια εφαρμογή μία μισθωτή επικυρώσει ενός διακριτικού, ελέγχει την υπογραφή του διακριτικού σε σχέση με τα πλήκτρα υπογραφής από το έγγραφο μετα-δεδομένων και διασφαλίζει ότι η τιμή εκδότη στο διακριτικό ταιριάζει με αυτό που βρέθηκε στο έγγραφο μετα-δεδομένων.

Από το/Common τελικό σημείο δεν αντιστοιχεί σε έναν μισθωτή και δεν είναι μια εκδότη, όταν εξετάζετε την τιμή εκδότη στο μετα-δεδομένων/κοινές που έχει μια διεύθυνση URL προτύπου αντί για μια πραγματική τιμή:

    https://sts.windows.net/{tenantid}/

Γι ' αυτό, μια εφαρμογή πολλών μισθωτών δεν μπορεί να επικυρώσει τα διακριτικά αντιστοιχίζοντας την τιμή εκδότη στο τα μετα-δεδομένα με το `issuer` τιμή στο διακριτικό.  Μια εφαρμογή πολλών μισθωτή λογικής για να αποφασίσετε ποιες τιμές εκδότη είναι έγκυρες και ποια είναι δεν χρειάζεται, με βάση το μισθωτή Αναγνωριστικό τμήμα της τιμής εκδότη.  

Για παράδειγμα, εάν μια εφαρμογή πολλών μισθωτών επιτρέπει μόνο είσοδος από συγκεκριμένες μισθωτές που έχουν εγγραφεί για την υπηρεσία, στη συνέχεια, αυτό πρέπει να ελέγξετε είτε την τιμή εκδότη ή το `tid` διεκδίκηση τιμή στο διακριτικό για να βεβαιωθείτε ότι είναι αυτόν το μισθωτή σε λίστα τους των συνδρομητών.  Εάν μια εφαρμογή πολλών μισθωτών μόνο ασχολείται με άτομα και δεν αποφάσεων οποιαδήποτε access που βασίζονται σε μισθωτές, στη συνέχεια, το να αγνοήσετε την τιμή εκδότη εντελώς.

Στα δείγματα πολλών μισθωτών θα βρείτε στην ενότητα [Σχετικό περιεχόμενο](#related-content) στο τέλος αυτού του άρθρου, επικύρωσης εκδότη είναι απενεργοποιημένη για να ενεργοποιήσετε οποιαδήποτε μισθωτή Azure AD για να πραγματοποιήσετε είσοδο.

Τώρα ας ρίξουμε μια ματιά της εμπειρίας χρήστη για τους χρήστες που είσοδος σε εφαρμογές πολλών μισθωτή.

## <a name="understanding-user-and-admin-consent"></a>Κατανόηση των χρηστών και συγκατάθεση διαχείρισης
Για ένα χρήστη για να πραγματοποιήσετε είσοδο σε μια εφαρμογή στο Azure AD, η εφαρμογή πρέπει να αντιστοιχεί στο μισθωτή του χρήστη.  Αυτό σας επιτρέπει την οργάνωση για να κάνετε πράγματα όπως εφαρμογή μοναδικό πολιτικών όταν οι χρήστες από τους μισθωτή συνδέονται με την εφαρμογή.  Για μια εφαρμογή μία μισθωτή, αυτή η καταχώρηση είναι απλή. είναι εκείνη που θα συμβεί όταν καταχωρείτε την εφαρμογή στην [πύλη του Azure κλασική][AZURE-classic-portal].

Για μια εφαρμογή πολλών μισθωτών, η αρχική καταχώρηση για την εφαρμογή βρίσκονται στο μισθωτή του Azure AD χρησιμοποιούνται από τον προγραμματιστή.  Όταν ένας χρήστης από έναν διαφορετικό μισθωτή πραγματοποιεί είσοδο στην εφαρμογή για πρώτη φορά, Azure AD σας ζητά να δώσετε τη συγκατάθεσή σας για να τα δικαιώματα που απαιτούνται από την εφαρμογή.  Εάν αυτές τη συγκατάθεσή σας, στη συνέχεια, δημιουργείται μια απεικόνιση της εφαρμογής που ονομάζεται *υπηρεσία κεφαλαίου* στο μισθωτή του χρήστη και είσοδος να συνεχίσετε. Μια ανάθεση δημιουργείται επίσης στον κατάλογο που καταγράφει τη συγκατάθεσή του χρήστη για την εφαρμογή. Ανατρέξτε στο θέμα [εφαρμογή και των αντικειμένων υπηρεσίας κεφάλαιο] [ AAD-App-SP-Objects] για λεπτομέρειες σχετικά με την εφαρμογή εφαρμογής και ServicePrincipal αντικείμενα και πώς σχετίζονται μεταξύ τους.

![Συγκατάθεση εφαρμογή ενός επιπέδου][Consent-Single-Tier] 

Αυτή η εμπειρία συγκατάθεση επηρεάζεται από τα δικαιώματα που απαιτούνται από την εφαρμογή.  Azure AD υποστηρίζει δύο είδη δικαιωμάτων, μόνο για εφαρμογή και ανάθεση:

- Μια ανάθεση δικαιωμάτων εκχωρεί μια εφαρμογή που λειτουργεί ως είσοδο στο χρήστη για ένα υποσύνολο δυνατότητες στο χρήστη τη δυνατότητα να κάνετε.  Για παράδειγμα, μπορείτε να εκχωρήσετε μια εφαρμογή η ανάθεση δικαίωμα ανάγνωσης ο συνδεδεμένος χρήστης ημερολογίου.
- Παρέχεται ένα δικαίωμα μόνο για εφαρμογή απευθείας με την ταυτότητα της εφαρμογής.  Για παράδειγμα, μπορείτε να εκχωρήσετε μια εφαρμογή για το δικαίωμα μόνο για εφαρμογή για να διαβάσετε τη λίστα των χρηστών στο μισθωτή και θα είναι σε θέση να το κάνετε αυτό, ανεξάρτητα από το ποιος είναι συνδεδεμένος στην εφαρμογή.

Ορισμένα δικαιώματα μπορεί να δεχθεί να από το κανονικό χρήστη, ενώ άλλοι χρειάζονται συγκατάθεση διαχειριστής μισθωτή. 

### <a name="admin-consent"></a>Συγκατάθεση διαχείρισης
Δικαιώματα μόνο για εφαρμογή απαιτούν πάντα συγκατάθεση διαχειριστής μισθωτή.  Εάν η εφαρμογή σας ζητά ένα μόνο για εφαρμογή δικαιωμάτων και μια κανονική χρήστης προσπαθήσει να εισέλθετε στην εφαρμογή, η εφαρμογή σας θα λάβετε ένα μήνυμα σφάλματος που αναφέρει ότι ο χρήστης δεν μπορεί να τη συγκατάθεσή σας.

Ορισμένα δικαιώματα πληρεξούσιου απαιτούν επίσης τη συγκατάθεσή διαχειριστής μισθωτή.  Για παράδειγμα, η δυνατότητα να συντάξουν στο Azure AD ως ο συνδεδεμένος χρήστης απαιτεί τη συγκατάθεσή διαχειριστής μισθωτή.  Όπως δικαιώματα μόνο για εφαρμογή, εάν μια κανονική χρήστης προσπαθήσει να εισέλθετε σε μια εφαρμογή που ζητά μια ανάθεση δικαιωμάτων που απαιτεί συγκατάθεση διαχειριστή, την εφαρμογή σας θα λάβουν ένα μήνυμα σφάλματος.  Έστω και απαιτεί ένα δικαίωμα διαχείρισης συγκατάθεση προσδιορίζεται από τον προγραμματιστή που δημοσιεύονται στον πόρο και μπορεί να βρεθεί στην τεκμηρίωση για τον πόρο.  Συνδέσεις σε θέματα που περιγράφει τα διαθέσιμα δικαιώματα για το API Azure AD Graph και API του Microsoft Graph είναι στην ενότητα [Σχετικό περιεχόμενο](#related-content) αυτού του άρθρου.

Εάν η εφαρμογή σας χρησιμοποιεί δικαιώματα που απαιτούν τη συγκατάθεσή διαχείρισης, πρέπει να έχετε μια χειρονομία στην εφαρμογή σας, όπως ένα κουμπί ή στη σύνδεση όπου ο διαχειριστής μπορεί να ξεκινήσει η ενέργεια.  Η πρόσκληση σε εφαρμογή σας στέλνει αυτή η ενέργεια είναι συνήθη σύνδεση OAuth2/OpenID εξουσιοδότησης αίτησης, ωστόσο, που περιλαμβάνει επίσης την `prompt=admin_consent` παραμέτρου συμβολοσειράς ερωτήματος.  Αφού ο διαχειριστής έχει δεχθεί και του αρχικού υπηρεσίας δημιουργείται στο μισθωτή του πελάτη, οι επόμενες είσοδος αιτήσεις δεν χρειάζεται η `prompt=admin_consent` παραμέτρου.   Επειδή ο διαχειριστής έχει αποφασίσει να τα δικαιώματα που ζητήθηκαν είναι αποδεκτές, άλλοι χρήστες στο μισθωτή θα του ζητηθεί για συγκατάθεση από εκείνη τη στιγμή προς τα εμπρός.

Το `prompt=admin_consent` παραμέτρου μπορεί επίσης να χρησιμοποιηθεί από τις εφαρμογές που απαιτούν δικαιώματα που δεν απαιτούν τη συγκατάθεσή διαχείρισης, αλλά θέλετε να δώσετε μια εμπειρία όπου ο διαχειριστής του μισθωτή "Εγγραφή" για την εφαρμογή μία φορά και άλλοι χρήστες θα σας ζητηθεί για συγκατάθεση από εκείνη τη στιγμή σε.

Εάν μια εφαρμογή απαιτεί τη συγκατάθεσή διαχειριστή και ο διαχειριστής πραγματοποιεί είσοδο στην εφαρμογή, αλλά το `prompt=admin_consent` δεν αποστέλλεται παραμέτρου, ο διαχειριστής θα μπορούν να τη συγκατάθεσή σας με επιτυχία με την εφαρμογή, αλλά αυτά θα μόνο τη συγκατάθεσή σας για το λογαριασμό χρήστη.  Κανονική οι χρήστες εξακολουθούν να δεν θα μπορείτε να πραγματοποιήσετε είσοδο και τη συγκατάθεσή σας για την εφαρμογή.  Αυτό είναι χρήσιμο εάν θέλετε να δώσετε τη δυνατότητα να εξερευνήσετε την εφαρμογή σας πριν να επιτρέψετε σε άλλους χρήστες πρόσβαση ο διαχειριστής του μισθωτή.

Διαχειριστής μισθωτή να απενεργοποιήσετε τη δυνατότητα για κανονική στους χρήστες να τη συγκατάθεσή σας για τις εφαρμογές.  Εάν αυτή η δυνατότητα είναι απενεργοποιημένη, συγκατάθεση διαχείρισης απαιτείται πάντα για την εφαρμογή για να ρυθμίσετε στο μισθωτή.  Εάν θέλετε να δοκιμάσετε την εφαρμογή σας με τη συγκατάθεσή τακτικός χρήστης απενεργοποιημένη, μπορείτε να βρείτε τον τρόπο ρύθμισης παραμέτρων μισθωτή Azure AD ενότητας ρύθμισης παραμέτρων της [πύλης Azure κλασική][AZURE-classic-portal].

> [AZURE.NOTE] Ορισμένες εφαρμογές θέλετε μια εμπειρία όπου κανονική οι χρήστες θα μπορούν να συγκατάθεση αρχικά και νεότερη έκδοση της εφαρμογής μπορούν να περιλαμβάνουν τα δικαιώματα διαχειριστή και αίτηση που απαιτούν τη συγκατάθεσή διαχείρισης.  Δεν υπάρχει τρόπος να το κάνετε αυτό με μια μεμονωμένη εφαρμογή εγγραφής στο Azure AD σήμερα.  Το επερχόμενες τελικού σημείου v2 Azure AD επιτρέπει εφαρμογές για να ζητήσετε δικαιώματα κατά το χρόνο εκτέλεσης, αντί για τη στιγμή εγγραφής, που επιτρέπει σε αυτό το σενάριο.  Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Οδηγός για προγραμματιστές v2 μοντέλο εφαρμογών Azure AD][AAD-V2-Dev-Guide].

### <a name="consent-and-multi-tier-applications"></a>Εφαρμογές συγκατάθεση και πολλαπλών επιπέδων
Η εφαρμογή σας μπορεί να έχει πολλές σειρές, κάθε που αντιπροσωπεύονται από το δικό της εγγραφής στο Azure AD.  Για παράδειγμα, μια εγγενή εφαρμογή που καλεί μια API web ή μια εφαρμογή web που καλεί μια API web.  Και στις δύο αυτές τις περιπτώσεις, το πρόγραμμα-πελάτη (εγγενούς εφαρμογής ή web app) αιτήσεις δικαιωμάτων για να καλέσετε τον πόρο (web API).  Για το πρόγραμμα-πελάτη για να δεχθεί με επιτυχία στο μισθωτή του πελάτη, όλους τους πόρους στο οποίο ζητά δικαιώματα πρέπει να υπάρχει ήδη στο μισθωτή του πελάτη.  Εάν αυτή η συνθήκη δεν ισχύει, Azure AD θα επιστρέψουν σφάλμα ότι ο πόρος πρέπει πρώτα να προστεθούν.

Αυτό μπορεί να είναι ένα πρόβλημα εάν λογική εφαρμογή σας αποτελείται από δύο ή περισσότερες εφαρμογή καταχωρήσεων, για παράδειγμα ένα νέο πρόγραμμα-πελάτη και πόρων.  Πώς θα αρχίσει τον πόρο στο μισθωτή του πελάτη πρώτη;  Azure AD καλύπτει αυτήν την περίπτωση, ενεργοποιώντας προγράμματος-πελάτη και πόρων για να δεχθεί με ένα βήμα, όπου ο χρήστης δεν βλέπει το σύνολο των τα δικαιώματα που ζητήθηκε από το πρόγραμμα-πελάτη και το πόρων στη σελίδα συγκατάθεσης.  Για να ενεργοποιήσετε αυτήν τη συμπεριφορά, δήλωση εφαρμογής του πόρου πρέπει να περιλαμβάνει το πρόγραμμα-πελάτη Αναγνωριστικό εφαρμογής ως μια `knownClientApplications` στο τη δήλωση της εφαρμογής.  Για παράδειγμα:

    knownClientApplications": ["94da0930-763f-45c7-8d26-04d5938baab2"]

Αυτή η ιδιότητα μπορεί να ενημερωθεί μέσω του πόρου [δηλωτικό της εφαρμογής][AAD-App-Manifest], και έχει αναπτυχθεί στο πρόγραμμα-πελάτη εγγενής πολλαπλών επιπέδων κλήση δείγμα web API στην ενότητα [Σχετικό περιεχόμενο](#related-content) στο τέλος αυτού του άρθρου. Στο παρακάτω διάγραμμα παρέχει μια επισκόπηση της συγκατάθεσης για μια εφαρμογή πολλαπλών επιπέδων:

![Συγκατάθεση εφαρμογή προγράμματος-πελάτη γνωστά πολλαπλών επιπέδων][Consent-Multi-Tier-Known-Client] 

Παρόμοια υπόθεσης συμβαίνει αν έχετε καταχωρήσει τις διαφορετικές βαθμίδες μιας εφαρμογής σε διαφορετική μισθωτές.  Για παράδειγμα, μπορείτε να τα γράμματα του δημιουργία μιας εφαρμογής εγγενές πρόγραμμα-πελάτη που καλεί το Office 365 Online το API του Exchange.  Για να αναπτύξετε την εγγενή εφαρμογή και νεότερη έκδοση για την εγγενή εφαρμογή για να εκτελέσετε στο μισθωτή του πελάτη, πρέπει να υπάρχει ο κύριος υπηρεσία Exchange Online.  Σε αυτήν την περίπτωση ο πελάτης πρέπει να αγοράσετε το Exchange Online για την υπηρεσία κεφαλαίου να δημιουργηθούν σε τους μισθωτή.  Στην περίπτωση API δημιουργήθηκε από μια εταιρεία εκτός της Microsoft, ο προγραμματιστής του API πρέπει να παρέχει κάποιο τρόπο για τους πελάτες να συγκατάθεση εφαρμογής τους σε ένα μισθωτή πελατών, για παράδειγμα μια ιστοσελίδα που κατευθύνει συγκατάθεση χρησιμοποιώντας τους μηχανισμούς που περιγράφονται σε αυτό το άρθρο.  Μετά τη δημιουργία του αρχικού υπηρεσίας στο μισθωτή, την εγγενή εφαρμογή μπορεί να λάβετε τα διακριτικά για το API.

Στο παρακάτω διάγραμμα παρέχει μια επισκόπηση της συγκατάθεσης για μια εφαρμογή πολλαπλών επιπέδων που έχουν καταχωρηθεί σε διαφορετική μισθωτές:

![Συγκατάθεση εφαρμογή πολλών ατόμων πολλαπλών επιπέδων][Consent-Multi-Tier-Multi-Party] 

### <a name="revoking-consent"></a>Ανάκληση συγκατάθεση
Χρήστες και διαχειριστές να ανακαλέσετε τη συγκατάθεσή για την εφαρμογή σας οποιαδήποτε στιγμή:

- Οι χρήστες ανακαλέσετε την πρόσβαση σε μεμονωμένες εφαρμογές αφαιρώντας τις από τις [Εφαρμογές της Access πίνακα] [ AAD-Access-Panel] λίστας.
- Οι διαχειριστές ανακαλέσετε την πρόσβαση σε εφαρμογές, καταργώντας τα από Azure AD χρησιμοποιώντας την ενότητα Διαχείριση Azure AD του [Azure κλασική πύλη][AZURE-classic-portal].

Εάν ο διαχειριστής συγκατάθεση σε μια εφαρμογή για όλους τους χρήστες στο μισθωτή, οι χρήστες δεν είναι δυνατό να ανακαλέσετε την πρόσβαση ξεχωριστά.  Μόνο ο διαχειριστής μπορεί να ανακαλέσετε την πρόσβαση και μόνο για όλη την εφαρμογή.

### <a name="consent-and-protocol-support"></a>Συγκατάθεση και υποστήριξη πρωτοκόλλου
Συγκατάθεση υποστηρίζεται στο Azure AD μέσω το διακριτικό, συνδεθείτε OpenID, WS Ομοσπονδία και τα πρωτόκολλα SAML.  Τα πρωτόκολλα SAML και WS Ομοσπονδία δεν υποστηρίζουν την `prompt=admin_consent` παράμετρο, ώστε να συγκατάθεση διαχείρισης είναι δυνατή μέσω OAuth και OpenID σύνδεση μόνο.

## <a name="multi-tenant-applications-and-caching-access-tokens"></a>Εφαρμογές πολλαπλών μισθωτή και σε cache διακριτικά πρόσβασης
Εφαρμογές πολλών μισθωτών επίσης να λάβετε διακριτικά πρόσβασης για να καλέσετε API που προστατεύονται από Azure AD.  Ένα κοινό σφάλμα όταν χρησιμοποιώντας το ενεργό βιβλιοθήκη ελέγχου ταυτότητας καταλόγου (ADAL) με μια εφαρμογή πολλών μισθωτή για να ζητήσετε αρχικά ενός διακριτικού για ένα χρήστη που χρησιμοποιεί/Common, λαμβάνετε μια απάντηση και, στη συνέχεια, ζητήστε μια οι επόμενες κωδικό για τον συγκεκριμένο χρήστη ίδια επίσης χρησιμοποιεί το/Common.  Επειδή η απόκριση από Azure AD προέρχεται από ένα μισθωτή, δεν/κοινές, ADAL αποθηκεύει προσωρινά το διακριτικό ως από το μισθωτή. Την επόμενη κλήση/Common για να λάβετε ένα διακριτικό πρόσβασης για το χρήστη σας χάσει καταχώρησης στο χώρο αποθήκευσης και ο χρήστης είναι σας ζητηθεί να συνδεθείτε ξανά.  Για να αποφύγετε λείπει το cache, βεβαιωθείτε ότι οι επόμενες κλήσεις για έναν χρήστη ήδη συνδεδεμένος πραγματοποιούνται τελικό σημείο του μισθωτή.

## <a name="related-content"></a>Σχετικό περιεχόμενο

- [Εφαρμογή πολλών μισθωτών δείγματα][AAD-Samples-MT]
- [Εμπορική προσαρμογή οδηγίες για τις εφαρμογές][AAD-App-Branding]
- [Azure AD για προγραμματιστές του οδηγού][AAD-Dev-Guide]
- [Εφαρμογή και των αντικειμένων κεφάλαιο υπηρεσίας][AAD-App-SP-Objects]
- [Ενσωμάτωση εφαρμογών με το Azure Active Directory][AAD-Integrating-Apps]
- [Επισκόπηση του πλαισίου συγκατάθεση][AAD-Consent-Overview]
- [Microsoft Graph API δικαιωμάτων εύρους][MSFT-Graph-AAD]
- [Azure AD Graph API δικαιωμάτων εύρους][AAD-Graph-Perm-Scopes]

Χρησιμοποιήστε την παρακάτω ενότητα Disqus σχολίων για να στείλετε τα σχόλιά σας και Βοηθήστε μας να περιορίσετε και να διαμορφώσετε μας περιεχόμενο.

<!--Reference style links IN USE -->
[AAD-Access-Panel]:  https://myapps.microsoft.com
[AAD-App-Branding]: ./active-directory-branding-guidelines.md
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Consent-Overview]: ./active-directory-integrating-applications.md#overview-of-the-consent-framework
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Overview]: https://azure.microsoft.com/en-us/documentation/articles/active-directory-graph-api/
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Samples-MT]: https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multitenant
[AAD-Why-To-Integrate]: ./active-directory-how-to-integrate.md
[AZURE-classic-portal]: https://manage.windowsazure.com
[MSFT-Graph-AAD]: https://graph.microsoft.io/en-us/docs/authorization/permission_scopes

<!--Image references-->
[AAD-Sign-In]: ./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png
[Consent-Single-Tier]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-single-tier.png
[Consent-Multi-Tier-Known-Client]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-known-clients.png
[Consent-Multi-Tier-Multi-Party]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-multi-party.png

<!--Reference style links -->
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Graph-App-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity
[AAD-Graph-Sp-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity
[AAD-Graph-User-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity
[AAD-How-To-Integrate]: ./active-directory-how-to-integrate.md
[AAD-Security-Token-Claims]: ./active-directory-authentication-scenarios/#claims-in-azure-ad-security-tokens
[AAD-Tokens-Claims]: ./active-directory-token-and-claims.md
[AAD-V2-Dev-Guide]: ./active-directory-appmodel-v2-overview.md
[AZURE-classic-portal]: https://manage.windowsazure.com
[Duyshant-Role-Blog]: http://www.dushyantgill.com/blog/2014/12/10/roles-based-access-control-in-cloud-applications-using-azure-ad/
[JWT]: https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32
[O365-Perm-Ref]: https://msdn.microsoft.com/en-us/office/office365/howto/application-manifest
[OAuth2-Access-Token-Scopes]: https://tools.ietf.org/html/rfc6749#section-3.3
[OAuth2-AuthZ-Code-Grant-Flow]: https://msdn.microsoft.com/library/azure/dn645542.aspx
[OAuth2-AuthZ-Grant-Types]: https://tools.ietf.org/html/rfc6749#section-1.3 
[OAuth2-Client-Types]: https://tools.ietf.org/html/rfc6749#section-2.1
[OAuth2-Role-Def]: https://tools.ietf.org/html/rfc6749#page-6
[OpenIDConnect]: http://openid.net/specs/openid-connect-core-1_0.html
[OpenIDConnect-ID-Token]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken














