

<properties
    pageTitle="Azure AD v2.0 διακριτικό εξουσιοδότησης κώδικα ροής | Microsoft Azure"
    description="Εφαρμογές web δόμησης, χρησιμοποιώντας την εφαρμογή Azure AD του πρωτοκόλλου ελέγχου ταυτότητας διακριτικό 2.0."
    services="active-directory"
    documentationCenter=""
    authors="dstrockis"
    manager="mbaldwin"
    editor=""/>

<tags
    ms.service="active-directory"
    ms.workload="identity"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="08/08/2016"
    ms.author="dastrock"/>

# <a name="v20-protocols---oauth-20-authorization-code-flow"></a>v2.0 πρωτόκολλα - κωδικό εξουσιοδότησης διακριτικό 2.0 ροής

Η εκχώρηση 2.0 διακριτικό εξουσιοδότησης κώδικα μπορεί να χρησιμοποιηθεί σε εφαρμογές που έχουν εγκατασταθεί σε μια συσκευή για να αποκτήσετε πρόσβαση σε προστατευμένο πόρους, όπως web APIs.  Χρησιμοποιώντας την εφαρμογή v2.0 μοντέλο εφαρμογή της OAuth 2.0, μπορείτε να προσθέσετε είσοδος και API του αποκτήσει πρόσβαση σε εφαρμογές σας φορητούς και επιτραπέζιους.  Αυτός ο οδηγός είναι ανεξάρτητο γλώσσας και περιγράφει πώς μπορείτε να στέλνετε και να λαμβάνετε μηνύματα HTTP χωρίς να χρησιμοποιήσετε οποιαδήποτε μας βιβλιοθηκών Άνοιγμα προέλευσης.

<!-- TODO: Need link to libraries -->

> [AZURE.NOTE]
    Δεν όλα τα σενάρια Azure Active Directory και δυνατότητες που υποστηρίζονται από το τελικό σημείο v2.0.  Για να καθορίσετε εάν θα πρέπει να χρησιμοποιήσετε το τελικό σημείο v2.0, διαβάστε σχετικά με [τους περιορισμούς v2.0](active-directory-v2-limitations.md).

Ροής κώδικα της εξουσιοδότησης 2.0 διακριτικό περιγράφεται στα στην [ενότητα 4.1 της προδιαγραφής διακριτικό 2.0](http://tools.ietf.org/html/rfc6749).  Χρησιμοποιείται για την εκτέλεση του ελέγχου ταυτότητας και εξουσιοδότησης στο το μεγαλύτερο μέρος των τύπους εφαρμογής, συμπεριλαμβανομένων των [εφαρμογών web](active-directory-v2-flows.md#web-apps) και [εγγενώς εγκαταστήσετε εφαρμογές](active-directory-v2-flows.md#mobile-and-native-apps).  Επιτρέπει σε εφαρμογές για να αποκτήσετε με ασφάλεια access_tokens που μπορεί να χρησιμοποιηθεί για πρόσβαση σε πόρους που είναι ασφαλείς χρησιμοποιώντας το τελικό σημείο v2.0.  

## <a name="protocol-diagram"></a>Διάγραμμα πρωτοκόλλου
Σε υψηλό επίπεδο, η ροή ολόκληρο τον έλεγχο ταυτότητας για μια εφαρμογή εγγενής/mobile λίγο μοιάζει κάπως έτσι:

![Διακριτικό κώδικα Auth ροής](../media/active-directory-v2-flows/convergence_scenarios_native.png)

## <a name="request-an-authorization-code"></a>Πρόσκληση σε έναν κωδικό εξουσιοδότησης
Ροής κώδικα της εξουσιοδότησης αρχίζει με το πρόγραμμα-πελάτη που κατευθύνει το χρήστη να το `/authorize` τελικού σημείου.  Σε αυτήν την αίτηση, ο υπολογιστής-πελάτης υποδεικνύει τα δικαιώματα που χρειάζεται να αποκτήσετε από το χρήστη:

```
// Line breaks for legibility only

https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=openid%20offline_access%20https%3A%2F%2Fgraph.microsoft.com%2Fmail.read
&state=12345
```

> [AZURE.TIP] Κάντε κλικ στη σύνδεση παρακάτω για να εκτελέσει αυτήν την αίτηση! Μετά την είσοδο, θα πρέπει να ανακατευθύνονται το πρόγραμμα περιήγησης `https://localhost/myapp/` με ένα `code` στη γραμμή διευθύνσεων.
    <a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&response_mode=query&scope=openid%20offline_access%20https%3A%2F%2Fgraph.microsoft.com%2Fmail.read&state=12345" target="_blank">https://Login.microsoftonline.com/Common/oauth2/v2.0/Authorize...</a>

| Παράμετρος | | Περιγραφή |
| ----------------------- | ------------------------------- | --------------- |
| μισθωτή | απαιτείται | Το `{tenant}` τιμή στη διαδρομή της αίτησης μπορούν να χρησιμοποιηθούν για να ελέγχετε ποιος μπορεί να συνδεθείτε στην εφαρμογή.  Οι επιτρεπόμενοι τιμές είναι `common`, `organizations`, `consumers`, και μισθωτή αναγνωριστικά.  Για περισσότερες λεπτομέρειες, ανατρέξτε στο θέμα [βασικές δυνατότητες πρωτόκολλο](active-directory-v2-protocols.md#endpoints). |
| client_id | απαιτείται | Το αναγνωριστικό εφαρμογής ότι η πύλη εγγραφής ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)), στους οποίους έχουν ανατεθεί την εφαρμογή σας. |
| response_type | απαιτείται | Πρέπει να περιλαμβάνει `code` για τη ροή κώδικα εξουσιοδότησης. |
| redirect_uri | Συνιστάται | Το redirect_uri της εφαρμογής, όπου μπορούν να αποστολής και λήψης από την εφαρμογή του ελέγχου ταυτότητας των απαντήσεων.  Αυτό πρέπει να αντιστοιχεί ακριβώς ένα από τα redirect_uris που έχουν καταχωρηθεί στην πύλη του, εκτός από αυτό πρέπει να κωδικοποιηθεί ως διεύθυνση url.  Για εφαρμογές εγγενής & κινητές συσκευές, μπορείτε να χρησιμοποιήσετε την προεπιλεγμένη τιμή του `https://login.microsoftonline.com/common/oauth2/nativeclient`. |
| πεδίο εφαρμογής | απαιτείται | Μια λίστα διαχωρισμένες με [πεδία](active-directory-v2-scopes.md) που θέλετε στο χρήστη να τη συγκατάθεσή σας για να.  |
| response_mode | Συνιστάται | Καθορίζει τη μέθοδο που πρέπει να χρησιμοποιούνται για την αποστολή που προκύπτει διακριτικού πίσω για την εφαρμογή σας.  Μπορεί να είναι `query` ή `form_post`.  |
| κατάσταση | Συνιστάται | Μια τιμή που περιλαμβάνονται στην αίτηση που θα επιστραφεί επίσης στην διακριτικού απάντηση.  Μπορεί να είναι μια συμβολοσειρά οποιοδήποτε περιεχόμενο που θέλετε.  Μια μοναδική τιμή που δημιούργησε τυχαία χρησιμοποιείται συνήθως για την [Αποτροπή επιθέσεις πλαστογράφησης διατοποθεσιακή αίτηση](http://tools.ietf.org/html/rfc6749#section-10.12).  Η κατάσταση χρησιμοποιείται επίσης για την κωδικοποίηση πληροφοριών σχετικά με την κατάσταση του χρήστη στην εφαρμογή πριν από την αίτηση ελέγχου ταυτότητας προέκυψε, όπως τη σελίδα ή την προβολή που είχαν στην. |
| γραμμή εντολών | προαιρετικό | Υποδεικνύει τον τύπο της αλληλεπίδραση με το χρήστη που είναι απαραίτητη.  Οι έγκυρες μόνο τιμές αυτήν τη στιγμή είναι "σύνδεση", "Καμία", και 'συγκατάθεση'.  `prompt=login`θα επιβάλετε το χρήστη για να εισαγάγετε τα διαπιστευτήριά τους σε αυτό το αίτημα, προσήμου καθολικής σύνδεσης σε.  `prompt=none`είναι το αντίθετο - εξασφαλίζει ότι ο χρήστης δεν παρέχονται αλληλεπίδραση με το χρήστη οποιαδήποτε.  Εάν δεν είναι δυνατή η ολοκλήρωση της αίτησης σιωπηρά μέσω καθολικής σύνδεσης στην, το τελικό σημείο v2.0 θα επιστρέψουν σφάλμα.  `prompt=consent`θα ενεργοποιήσει το παράθυρο διαλόγου συγκατάθεση διακριτικό αφού ο χρήστης που πραγματοποιεί είσοδο, που σας ρωτά το χρήστη για να εκχωρήσετε δικαιώματα για την εφαρμογή. |
| login_hint | προαιρετικό | Μπορεί να χρησιμοποιηθεί για προ-συμπληρώσετε το πεδίο διεύθυνση username/ηλεκτρονικού ταχυδρομείου της διαδικασίας Πραγματοποιήστε είσοδο στη σελίδα για το χρήστη, εάν γνωρίζετε το όνομα χρήστη εκ των προτέρων.  Συχνά οι εφαρμογές θα χρησιμοποιήσετε αυτήν την παράμετρο κατά την επανάληψη του ελέγχου ταυτότητας, έχοντας ήδη που έχουν εξαχθεί το όνομα χρήστη από μια προηγούμενη είσοδος με χρήση του `preferred_username` διεκδίκηση. |
| domain_hint | προαιρετικό | Μπορεί να είναι μία από `consumers` ή `organizations`.  Εάν συμπεριλαμβάνεται, αυτό θα παραλείψετε τη διαδικασία εντοπισμού βασίζεται στο ηλεκτρονικό ταχυδρομείο αυτόν το χρήστη, έχετε στη σελίδα, είσοδος v2.0 αποτέλεσμα ελαφρώς πιο ομαλή εμπειρία χρήστη.  Συχνά οι εφαρμογές θα χρησιμοποιήσετε αυτήν την παράμετρο κατά την επανάληψη του ελέγχου ταυτότητας, κατά την εξαγωγή του `tid` από μια προηγούμενη εισόδου.  Εάν το `tid` διεκδίκηση τιμή είναι `9188040d-6c67-4c5b-b112-36a304b66dad`, θα πρέπει να χρησιμοποιήσετε `domain_hint=consumers`.  Διαφορετικά, χρησιμοποιήστε `domain_hint=organizations`. |

Σε αυτό το σημείο, ο χρήστης θα σας ζητηθεί να εισαγάγετε τα διαπιστευτήριά τους και να ολοκληρώσετε τον έλεγχο ταυτότητας.  Το τελικό σημείο v2.0 θα εξασφαλίσει ότι ο χρήστης έχει δεχθεί να τα δικαιώματα που υποδεικνύεται στην επίσης το `scope` ερώτημα παραμέτρων.  Εάν ο χρήστης δεν έχει δεχθεί σε οποιαδήποτε από αυτά τα δικαιώματα, αυτό θα ερώτηση στο χρήστη για να δώσετε τη συγκατάθεσή σας για να τα απαραίτητα δικαιώματα.  Λεπτομέρειες [δικαιώματα, συγκατάθεση, και εφαρμογές πολλών μισθωτών παρέχονται εδώ](active-directory-v2-scopes.md).

Όταν ο χρήστης πραγματοποιεί έλεγχο ταυτότητας και εκχωρεί συγκατάθεση, το τελικό σημείο v2.0 θα επιστρέψει μια απάντηση σε εφαρμογή στο του καθορισμένου `redirect_uri`, χρησιμοποιώντας τη μέθοδο που καθορίζεται στο το `response_mode` παραμέτρου.

#### <a name="successful-response"></a>Επιτυχής απόκρισης
Μια επιτυχημένη απόκριση με τη χρήση `response_mode=query` μοιάζει με:

```
GET https://login.microsoftonline.com/common/oauth2/nativeclient?
code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...
&state=12345
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| κωδικός | Το authorization_code που ζητήθηκε από την εφαρμογή. Η εφαρμογή μπορεί να χρησιμοποιήσει τον κωδικό εξουσιοδότησης για να ζητήσετε από ένα διακριτικό πρόσβασης για τον πόρο προορισμού.  Authorization_codes είναι πολύ μικρό χρόνο ζωής, συνήθως λήγουν μετά περίπου 10 λεπτά. |
| κατάσταση | Εάν μια παράμετρος κατάσταση περιλαμβάνει την αίτηση, την ίδια τιμή θα πρέπει να εμφανίζεται στην απάντηση. Η εφαρμογή θα πρέπει να βεβαιωθείτε ότι τις τιμές κατάσταση της αίτησης και της απόκρισης είναι πανομοιότυπες. |

#### <a name="error-response"></a>Απόκριση σφάλμα
Απαντήσεις σφάλματος μπορεί να αποσταλούν επίσης για το `redirect_uri` , ώστε η εφαρμογή να τους χειριστεί σωστά:

```
GET https://login.microsoftonline.com/common/oauth2/nativeclient?
error=access_denied
&error_description=the+user+canceled+the+authentication
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| Σφάλμα | Μια συμβολοσειρά κωδικό σφάλματος που μπορεί να χρησιμοποιηθεί για την ταξινόμηση των τύπων σφάλματα που προκύπτουν και μπορεί να χρησιμοποιηθεί προκειμένου να αντιμετωπίζεται σφάλματα. |
| error_description | Ένα συγκεκριμένο μήνυμα σφάλματος που μπορεί να σας βοηθήσει ο προγραμματιστής Προσδιορισμός της αρχικής αιτίας ενός σφάλματος ελέγχου ταυτότητας.  |

#### <a name="error-codes-for-authorization-endpoint-errors"></a>Κωδικοί σφάλματος για σφάλματα εξουσιοδότησης τελικού σημείου

Ο παρακάτω πίνακας περιγράφει τα διάφορα τους κωδικούς σφάλματος που μπορεί να επιστραφούν στο το `error` παράμετρος της απόκρισης σφάλματος.

| Κωδικός σφάλματος | Περιγραφή | Ενέργεια προγράμματος-πελάτη |
|------------|-------------|---------------|
| invalid_request | Πρωτόκολλο σφάλμα, όπως μια απαιτούμενη παράμετρος λείπει. | Διόρθωση και υποβάλετε ξανά την αίτηση. Αυτή είναι μια ανάπτυξη συνήθως εντοπίζεται σφάλμα κατά την αρχική δοκιμή.|
| unauthorized_client | Δεν επιτρέπεται η εφαρμογή προγράμματος-πελάτη για να ζητήσετε από έναν κωδικό εξουσιοδότησης. | Αυτό συνήθως συμβαίνει όταν η εφαρμογή προγράμματος-πελάτη δεν έχει καταχωρηθεί στο Azure AD ή δεν προστίθεται στο μισθωτή Azure AD του χρήστη. Η εφαρμογή μπορεί να γίνεται ερώτηση στο χρήστη με οδηγίες για την εγκατάσταση της εφαρμογής και προσθήκη του Azure AD. |
| access_denied | Δεν επιτρέπεται η συγκατάθεση κάτοχο πόρων | Η εφαρμογή προγράμματος-πελάτη μπορεί να ειδοποιήσει στο χρήστη που αυτό δεν είναι δυνατό να συνεχίσετε, εκτός εάν υπάρξει συγκατάθεση του χρήστη. |
| unsupported_response_type | Ο διακομιστής εξουσιοδότησης δεν υποστηρίζει τον τύπο απάντηση στην πρόσκληση σε. | Διόρθωση και υποβάλετε ξανά την αίτηση. Αυτή είναι μια ανάπτυξη συνήθως εντοπίζεται σφάλμα κατά την αρχική δοκιμή.|
|server_error | Ο διακομιστής αντιμετώπισε ένα μη αναμενόμενο σφάλμα. | Προσπαθήστε ξανά. Αυτά τα σφάλματα μπορεί να προκύψουν από προσωρινό συνθήκες. Την εφαρμογή-πελάτη μπορεί να εξηγήσετε στο χρήστη ότι η απόκρισή καθυστερήσει προθεσμία ένα προσωρινό σφάλμα. |
| temporarily_unavailable | Ο διακομιστής είναι προσωρινά πολύ απασχολημένοι για να διαχειριστεί την αίτηση. | Προσπαθήστε ξανά. Την εφαρμογή-πελάτη μπορεί να εξηγήσετε στο χρήστη ότι η απόκρισή καθυστερήσει προθεσμία προσωρινό συνθήκης. |
| invalid_resource |Ο πόρος προορισμού δεν είναι έγκυρη, επειδή δεν υπάρχει, δεν μπορείτε να βρείτε το Azure AD ή δεν έχει ρυθμιστεί σωστά.| Αυτό υποδεικνύει τον πόρο, εάν υπάρχει, δεν έχει ρυθμιστεί στο μισθωτή. Η εφαρμογή μπορεί να γίνεται ερώτηση στο χρήστη με οδηγίες για την εγκατάσταση της εφαρμογής και προσθήκη του Azure AD. |

## <a name="request-an-access-token"></a>Πρόσκληση σε ένα διακριτικό πρόσβασης
Τώρα που έχετε αποκτήσει ένα authorization_code και έχουν εκχωρηθεί δικαιώματα από το χρήστη, που μπορούν να αποκτήσουν το `code` για μια `access_token` στον επιθυμητό πόρο, στέλνοντας μια `POST` αίτηση για να το `/token` τελικού σημείου:

```
// Line breaks for legibility only

POST /{tenant}/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&scope=https%3A%2F%2Fgraph.microsoft.com%2Fmail.read
&code=OAAABAAAAiL9Kn2Z27UubvWFPbm0gLWQJVzCTE9UkP3pSx1aXxUjq3n8b2JRLk4OxVXr...
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&grant_type=authorization_code
&client_secret=JqQX2PNo9bpM0uEihUPzyrh    // NOTE: Only required for web apps
```

> [AZURE.TIP] Δοκιμάστε την εκτέλεση αυτής της αίτησης στο Postman! (Μην ξεχάσετε να αντικαταστήσετε το `code`)     [ ![Εκτέλεση στο Postman](./media/active-directory-v2-protocols-oauth-code/runInPostman.png)](https://app.getpostman.com/run-collection/8f5715ec514865a07e6a)

| Παράμετρος | | Περιγραφή |
| ----------------------- | ------------------------------- | --------------------- |
| μισθωτή | απαιτείται | Το `{tenant}` τιμή στη διαδρομή της αίτησης μπορούν να χρησιμοποιηθούν για να ελέγχετε ποιος μπορεί να συνδεθείτε στην εφαρμογή.  Οι επιτρεπόμενοι τιμές είναι `common`, `organizations`, `consumers`, και μισθωτή αναγνωριστικά.  Για περισσότερες λεπτομέρειες, ανατρέξτε στο θέμα [βασικές δυνατότητες πρωτόκολλο](active-directory-v2-protocols.md#endpoints). |
| client_id | απαιτείται | Το αναγνωριστικό εφαρμογής ότι η πύλη εγγραφής ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)), στους οποίους έχουν ανατεθεί την εφαρμογή σας. |
| grant_type | απαιτείται | Πρέπει να είναι `authorization_code` για τη ροή κώδικα εξουσιοδότησης. |
| πεδίο εφαρμογής | απαιτείται | Μια λίστα διαχωρισμένες με εύρους.  Το εύρος ζητήθηκε στο πόδι αυτό πρέπει να είναι ισοδύναμο ή ένα υποσύνολο των εμβελειών ζητήσει με το πρώτο πόδι.  Εάν τα πεδία που καθορίζονται σε αυτήν την αίτηση εκτείνονται σε πολλούς διακομιστές πόρων, στη συνέχεια, το τελικό σημείο v2.0 θα επιστρέψει ένα διακριτικό για τον πόρο που καθορίζεται στο πρώτο πεδίο.  Για μια πιο λεπτομερή εξήγηση των εμβελειών, ανατρέξτε στην [δικαιώματα, συγκατάθεση, και εύρους](active-directory-v2-scopes.md).  |
| κωδικός | απαιτείται | Το authorization_code που αποκτήθηκε στο το πρώτο πόδι της ροής της.   |
| redirect_uri | απαιτείται | Την ίδια τιμή redirect_uri που χρησιμοποιήθηκε για να αποκτήσετε το authorization_code. |
| client_secret | απαιτείται για τις εφαρμογές web | Το μυστικό της εφαρμογής που δημιουργήσατε στην πύλη καταχώρηση εφαρμογής για την εφαρμογή σας.  Δεν θα πρέπει να χρησιμοποιηθεί σε μια εφαρμογή για εγγενή, επειδή client_secrets δεν μπορούν να αποθηκευτούν αξιόπιστα σε συσκευές.  Είναι απαραίτητη για το web apps και API, τα οποία έχουν τη δυνατότητα να αποθηκεύσετε το client_secret με ασφάλεια στο διακομιστή web. |

#### <a name="successful-response"></a>Επιτυχής απόκρισης
Επιτυχής διακριτικού απόκριση θα μοιάζει κάπως:

```
{
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "token_type": "Bearer",
    "expires_in": 3599,
    "scope": "https%3A%2F%2Fgraph.microsoft.com%2Fmail.read",
    "refresh_token": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4...",
    "id_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctOD...",
}
```
| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| access_token | Το διακριτικό πρόσβασης ζητήθηκε. Η εφαρμογή να χρησιμοποιήσετε αυτό το διακριτικό για τον έλεγχο ταυτότητας για την ασφαλή πόρου, όπως ένα API web. |
| token_type | Υποδεικνύει την τιμή διακριτικού τύπου. Ο μόνος τύπος που υποστηρίζει το Azure AD είναι φορέα  |
| expires_in | Πόσο χρόνο το διακριτικό πρόσβασης είναι έγκυρη (σε δευτερόλεπτα). |
| πεδίο εφαρμογής | Τα πεδία που ισχύει για το access_token. |
| refresh_token |  Ένα διακριτικό ανανέωση διακριτικό 2.0. Η εφαρμογή να χρησιμοποιήσετε αυτό το διακριτικό απόκτηση διακριτικά επιπλέον πρόσβασης αφού λήξει η τρέχουσα διακριτικό πρόσβασης.  Refresh_tokens είναι μεγάλης διάρκειας και μπορούν να χρησιμοποιηθούν για να διατηρήσετε την πρόσβαση σε πόρους για εκτεταμένη χρονική περίοδο.  Για περισσότερες λεπτομέρειες, ανατρέξτε στην [αναφορά διακριτικού v2.0](active-directory-v2-tokens.md).  |
| id_token | Ένα μη υπογεγραμμένο JSON Web διακριτικού (JWT). Η εφαρμογή base64Url μπορούν να αποκωδικοποιείτε τα τμήματα της αυτό το διακριτικό να ζητήσετε πληροφορίες σχετικά με το χρήστη που έχετε συνδεθεί στο. Η εφαρμογή μπορεί να cache τις τιμές και να τις εμφανίσετε, αλλά δεν πρέπει να βασίζεστε σε αυτές για τυχόν εξουσιοδότησης ή όρια ασφαλείας.  Για περισσότερες πληροφορίες σχετικά με την id_tokens ανατρέξτε στο άρθρο [αναφορά διακριτικού v2.0 τελικού σημείου](active-directory-v2-tokens.md). |

#### <a name="error-response"></a>Απόκριση σφάλμα
Θα μοιάζει η απαντήσεις σφάλματος:

```
{
  "error": "invalid_scope",
  "error_description": "AADSTS70011: The provided value for the input parameter 'scope' is not valid. The scope https://foo.microsoft.com/mail.read is not valid.\r\nTrace ID: 255d1aef-8c98-452f-ac51-23d051240864\r\nCorrelation ID: fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7\r\nTimestamp: 2016-01-09 02:02:12Z",
  "error_codes": [
    70011
  ],
  "timestamp": "2016-01-09 02:02:12Z",
  "trace_id": "255d1aef-8c98-452f-ac51-23d051240864",
  "correlation_id": "fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7"
}
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| Σφάλμα | Μια συμβολοσειρά κωδικό σφάλματος που μπορεί να χρησιμοποιηθεί για την ταξινόμηση των τύπων σφάλματα που προκύπτουν και μπορεί να χρησιμοποιηθεί προκειμένου να αντιμετωπίζεται σφάλματα. |
| error_description | Ένα συγκεκριμένο μήνυμα σφάλματος που μπορεί να σας βοηθήσει ο προγραμματιστής Προσδιορισμός της αρχικής αιτίας ενός σφάλματος ελέγχου ταυτότητας.  |
| error_codes | Μια λίστα STS συγκεκριμένων κωδικών σφάλματος που μπορεί να σας βοηθήσει στη Διαγνωστικά.  |
| χρονική σήμανση | Η ώρα κατά την οποία παρουσιάστηκε το σφάλμα. |
| trace_id | Ένα μοναδικό αναγνωριστικό για την αίτηση που μπορούν να σας βοηθήσουν στην Διαγνωστικά.  |
| correlation_id | Ένα μοναδικό αναγνωριστικό για την αίτηση που μπορούν να σας βοηθήσουν στην Διαγνωστικά σε όλα τα στοιχεία. |

#### <a name="error-codes-for-token-endpoint-errors"></a>Κωδικοί σφάλματος για σφάλματα διακριτικού τελικού σημείου

| Κωδικός σφάλματος | Περιγραφή | Ενέργεια προγράμματος-πελάτη |
|------------|-------------|---------------|
| invalid_request | Πρωτόκολλο σφάλμα, όπως μια απαιτούμενη παράμετρος λείπει. | Διόρθωση και υποβάλετε ξανά την αίτηση |
| invalid_grant | Ο κώδικας εξουσιοδότησης δεν είναι έγκυρη ή έχει λήξει. | Δοκιμάστε μια νέα αίτηση για την `/authorize` τελικού σημείου |
| unauthorized_client | Το πρόγραμμα-πελάτη με έλεγχο ταυτότητας δεν έχετε δικαίωμα να χρησιμοποιήσετε αυτόν τον τύπο εκχώρηση άδειας. | Αυτό συνήθως συμβαίνει όταν η εφαρμογή προγράμματος-πελάτη δεν έχει καταχωρηθεί στο Azure AD ή δεν προστίθεται στο μισθωτή Azure AD του χρήστη. Η εφαρμογή μπορεί να γίνεται ερώτηση στο χρήστη με οδηγίες για την εγκατάσταση της εφαρμογής και προσθήκη του Azure AD. |
| invalid_client | Έλεγχος ταυτότητας του προγράμματος-πελάτη απέτυχε. | Τα διαπιστευτήρια προγράμματος-πελάτη δεν είναι έγκυρη. Για να διορθώσετε το πρόβλημα, ο διαχειριστής της εφαρμογής ενημερώνει τα διαπιστευτήρια. |
| unsupported_grant_type | Ο διακομιστής εξουσιοδότησης δεν υποστηρίζει τον τύπο εκχώρηση άδειας. | Αλλάξτε τον τύπο εκχώρηση στην αίτηση. Αυτός ο τύπος του σφάλματος πρέπει να πραγματοποιείται μόνο κατά τη διάρκεια της ανάπτυξης και να εντοπίζονται κατά την αρχική δοκιμή. |
| invalid_resource | Ο πόρος προορισμού δεν είναι έγκυρη, επειδή δεν υπάρχει, δεν μπορείτε να βρείτε το Azure AD ή δεν έχει ρυθμιστεί σωστά. | Αυτό υποδεικνύει τον πόρο, εάν υπάρχει, δεν έχει ρυθμιστεί στο μισθωτή. Η εφαρμογή μπορεί να γίνεται ερώτηση στο χρήστη με οδηγίες για την εγκατάσταση της εφαρμογής και προσθήκη του Azure AD. |
| interaction_required | Η αίτηση απαιτεί παρέμβαση του χρήστη. Για παράδειγμα, απαιτείται ένα βήμα πρόσθετου ελέγχου ταυτότητας. | Επαναλάβετε το ερώτημα με τον ίδιο πόρο. |
| temporarily_unavailable | Ο διακομιστής είναι προσωρινά πολύ απασχολημένοι για να διαχειριστεί την αίτηση. | Προσπαθήστε ξανά. Την εφαρμογή-πελάτη μπορεί να εξηγήσετε στο χρήστη ότι η απόκρισή καθυστερήσει προθεσμία προσωρινό συνθήκης.|

## <a name="use-the-access-token"></a>Χρησιμοποιήστε το διακριτικό πρόσβασης
Τώρα που έχετε με επιτυχία αποκτήσατε μια `access_token`, μπορείτε να χρησιμοποιήσετε το διακριτικό σε προσκλήσεις προς API Web, συμπεριλαμβάνοντας με το `Authorization` κεφαλίδας:

> [AZURE.TIP] Εκτέλεση αυτής της αίτησης στο Postman! (Αντικαταστήστε το `Authorization` κεφαλίδα πρώτη)     [ ![Εκτέλεση στο Postman](./media/active-directory-v2-protocols-oauth-code/runInPostman.png)](https://app.getpostman.com/run-collection/8f5715ec514865a07e6a)

```
GET /v1.0/me/messages
Host: https://graph.microsoft.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
```

## <a name="refresh-the-access-token"></a>Ανανεώστε το διακριτικό πρόσβασης
Access_tokens είναι σύντομο διάρκειας ζωής και πρέπει να ανανεώσετε τους μετά τη λήξη τους για να συνεχίσετε την πρόσβαση σε πόρους.  Μπορείτε να το κάνετε υποβάλλοντας μια άλλη `POST` αίτηση για να το `/token` τελικού σημείου, αυτό χρόνου παροχή το `refresh_token` αντί για το `code`:

```
// Line breaks for legibility only

POST /{tenant}/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&scope=https%3A%2F%2Fgraph.microsoft.com%2Fmail.read
&refresh_token=OAAABAAAAiL9Kn2Z27UubvWFPbm0gLWQJVzCTE9UkP3pSx1aXxUjq...
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&grant_type=refresh_token
&client_secret=JqQX2PNo9bpM0uEihUPzyrh    // NOTE: Only required for web apps
```

> [AZURE.TIP] Δοκιμάστε την εκτέλεση αυτής της αίτησης στο Postman! (Μην ξεχάσετε να αντικαταστήσετε το `refresh_token`)     [ ![Εκτέλεση στο Postman](./media/active-directory-v2-protocols-oauth-code/runInPostman.png)](https://app.getpostman.com/run-collection/8f5715ec514865a07e6a)

| Παράμετρος | | Περιγραφή |
| ----------------------- | ------------------------------- | -------- |
| μισθωτή | απαιτείται | Το `{tenant}` τιμή στη διαδρομή της αίτησης μπορούν να χρησιμοποιηθούν για να ελέγχετε ποιος μπορεί να συνδεθείτε στην εφαρμογή.  Οι επιτρεπόμενοι τιμές είναι `common`, `organizations`, `consumers`, και μισθωτή αναγνωριστικά.  Για περισσότερες λεπτομέρειες, ανατρέξτε στο θέμα [βασικές δυνατότητες πρωτόκολλο](active-directory-v2-protocols.md#endpoints). |
| client_id | απαιτείται | Το αναγνωριστικό εφαρμογής ότι η πύλη εγγραφής ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)), στους οποίους έχουν ανατεθεί την εφαρμογή σας. |
| grant_type | απαιτείται | Πρέπει να είναι `refresh_token` για αυτό πόδι της ροής της εξουσιοδότησης κώδικα. |
| πεδίο εφαρμογής | απαιτείται | Μια λίστα διαχωρισμένες με εύρους.  Το εύρος ζητήθηκε στο πόδι αυτό πρέπει να είναι ισοδύναμο ή ένα υποσύνολο των εμβελειών ζητήσει με το αρχικό πόδι αίτηση authorization_code.  Εάν τα πεδία που καθορίζονται σε αυτήν την αίτηση εκτείνονται σε πολλούς διακομιστές πόρων, στη συνέχεια, το τελικό σημείο v2.0 θα επιστρέψει ένα διακριτικό για τον πόρο που καθορίζεται στο πρώτο πεδίο.  Για μια πιο λεπτομερή εξήγηση των εμβελειών, ανατρέξτε στην [δικαιώματα, συγκατάθεση, και εύρους](active-directory-v2-scopes.md).  |
| refresh_token | απαιτείται | Το refresh_token που αποκτήθηκε στο το δεύτερο πόδι της ροής της.   |
| redirect_uri | απαιτείται | Την ίδια τιμή redirect_uri που χρησιμοποιήθηκε για να αποκτήσετε το authorization_code. |
| client_secret | απαιτείται για τις εφαρμογές web | Το μυστικό της εφαρμογής που δημιουργήσατε στην πύλη καταχώρηση εφαρμογής για την εφαρμογή σας.  Δεν θα πρέπει να χρησιμοποιηθεί σε μια εφαρμογή για εγγενή, επειδή client_secrets δεν μπορούν να αποθηκευτούν αξιόπιστα σε συσκευές.  Είναι απαραίτητη για το web apps και API, τα οποία έχουν τη δυνατότητα να αποθηκεύσετε το client_secret με ασφάλεια στο διακομιστή web. |

#### <a name="successful-response"></a>Επιτυχής απόκρισης
Επιτυχής διακριτικού απόκριση θα μοιάζει κάπως:

```
{
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "token_type": "Bearer",
    "expires_in": 3599,
    "scope": "https%3A%2F%2Fgraph.microsoft.com%2Fmail.read",
    "refresh_token": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4...",
    "id_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctOD...",
}
```
| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| access_token | Το διακριτικό πρόσβασης ζητήθηκε. Η εφαρμογή να χρησιμοποιήσετε αυτό το διακριτικό για τον έλεγχο ταυτότητας για την ασφαλή πόρου, όπως ένα API web. |
| token_type | Υποδεικνύει την τιμή διακριτικού τύπου. Ο μόνος τύπος που υποστηρίζει το Azure AD είναι φορέα  |
| expires_in | Πόσο χρόνο το διακριτικό πρόσβασης είναι έγκυρη (σε δευτερόλεπτα). |
| πεδίο εφαρμογής | Τα πεδία που ισχύει για το access_token. |
| refresh_token |  Έναν νέο κωδικό ανανέωση διακριτικό 2.0. Θα πρέπει να αντικαταστήσετε το παλιό διακριτικό ανανέωσης με αυτό το διακριτικό που μόλις που αποκτήθηκε Ανανέωση για να βεβαιωθείτε ότι το διακριτικά ανανέωση εξακολουθεί να ισχύει για το χρονικό διάστημα όσο το δυνατόν.  |
| id_token | Ένα μη υπογεγραμμένο JSON Web διακριτικού (JWT). Η εφαρμογή base64Url μπορούν να αποκωδικοποιείτε τα τμήματα της αυτό το διακριτικό να ζητήσετε πληροφορίες σχετικά με το χρήστη που έχετε συνδεθεί στο. Η εφαρμογή μπορεί να cache τις τιμές και να τις εμφανίσετε, αλλά δεν πρέπει να βασίζεστε σε αυτές για τυχόν εξουσιοδότησης ή όρια ασφαλείας.  Για περισσότερες πληροφορίες σχετικά με την id_tokens ανατρέξτε στο άρθρο [αναφορά διακριτικού v2.0 τελικού σημείου](active-directory-v2-tokens.md). |

#### <a name="error-response"></a>Απόκριση σφάλμα
```
{
  "error": "invalid_scope",
  "error_description": "AADSTS70011: The provided value for the input parameter 'scope' is not valid. The scope https://foo.microsoft.com/mail.read is not valid.\r\nTrace ID: 255d1aef-8c98-452f-ac51-23d051240864\r\nCorrelation ID: fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7\r\nTimestamp: 2016-01-09 02:02:12Z",
  "error_codes": [
    70011
  ],
  "timestamp": "2016-01-09 02:02:12Z",
  "trace_id": "255d1aef-8c98-452f-ac51-23d051240864",
  "correlation_id": "fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7"
}
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| Σφάλμα | Μια συμβολοσειρά κωδικό σφάλματος που μπορεί να χρησιμοποιηθεί για την ταξινόμηση των τύπων σφάλματα που προκύπτουν και μπορεί να χρησιμοποιηθεί προκειμένου να αντιμετωπίζεται σφάλματα. |
| error_description | Ένα συγκεκριμένο μήνυμα σφάλματος που μπορεί να σας βοηθήσει ο προγραμματιστής Προσδιορισμός της αρχικής αιτίας ενός σφάλματος ελέγχου ταυτότητας.  |
| error_codes | Μια λίστα STS συγκεκριμένων κωδικών σφάλματος που μπορεί να σας βοηθήσει στη Διαγνωστικά.  |
| χρονική σήμανση | Η ώρα κατά την οποία παρουσιάστηκε το σφάλμα. |
| trace_id | Ένα μοναδικό αναγνωριστικό για την αίτηση που μπορούν να σας βοηθήσουν στην Διαγνωστικά.  |
| correlation_id | Ένα μοναδικό αναγνωριστικό για την αίτηση που μπορούν να σας βοηθήσουν στην Διαγνωστικά σε όλα τα στοιχεία. |

Για μια περιγραφή των τους κωδικούς σφάλματος και την ενέργεια συνιστάται προγράμματος-πελάτη, ανατρέξτε στο θέμα [τους κωδικούς σφάλματος για σφάλματα διακριτικού τελικού σημείου](#error-codes-for-token-endpoint-errors).
