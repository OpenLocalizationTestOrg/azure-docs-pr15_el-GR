<properties
    pageTitle="Επισκόπηση πρωτοκόλλου .NET Azure AD | Microsoft Azure"
    description="Σε αυτό το άρθρο περιγράφει τον τρόπο χρήσης μηνύματα HTTP για να εξουσιοδοτήσετε πρόσβαση στις εφαρμογές web και web APIs στο μισθωτή σας με χρήση του Azure Active Directory και διακριτικό 2.0."
    services="active-directory"
    documentationCenter=".net"
    authors="priyamohanram"
    manager="mbaldwin"
    editor=""/>

<tags
    ms.service="active-directory"
    ms.workload="identity"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/03/2016"
    ms.author="priyamo"/>


# <a name="authorize-access-to-web-applications-using-oauth-20-and-azure-active-directory"></a>Εξουσιοδότηση για πρόσβαση στις εφαρμογές web, χρησιμοποιώντας το διακριτικό 2.0 και Azure Active Directory

Azure Active Directory (Azure AD) χρησιμοποιεί διακριτικό 2.0 για να μπορέσετε να εγκρίνετε πρόσβαση στις εφαρμογές web και web APIs στο μισθωτή του Azure AD. Αυτός ο οδηγός είναι ανεξάρτητο γλώσσας και περιγράφει πώς μπορείτε να στέλνετε και να λαμβάνετε μηνύματα HTTP χωρίς να χρησιμοποιήσετε οποιαδήποτε μας βιβλιοθηκών Άνοιγμα προέλευσης.

Ροής κώδικα της εξουσιοδότησης 2.0 διακριτικό περιγράφεται στην [ενότητα 4.1 της προδιαγραφής διακριτικό 2.0](https://tools.ietf.org/html/rfc6749#section-4.1) . Χρησιμοποιείται για την εκτέλεση του ελέγχου ταυτότητας και εξουσιοδότησης στο το μεγαλύτερο μέρος των τύπων εφαρμογής, συμπεριλαμβανομένων των εφαρμογών web και εγγενώς εγκαταστήσετε εφαρμογές.

[AZURE.INCLUDE [active-directory-protocols-getting-started](../../includes/active-directory-protocols-getting-started.md)]


## <a name="oauth-20-authorization-flow"></a>Ροή εξουσιοδότησης διακριτικό 2.0

Σε υψηλό επίπεδο, η ροή ολόκληρο εξουσιοδότησης για μια εφαρμογή λίγο μοιάζει κάπως έτσι:

![Διακριτικό κώδικα Auth ροής](media/active-directory-protocols-oauth-code/active-directory-oauth-code-flow-native-app.png)


## <a name="request-an-authorization-code"></a>Πρόσκληση σε έναν κωδικό εξουσιοδότησης

Ροής κώδικα της εξουσιοδότησης αρχίζει με το πρόγραμμα-πελάτη που κατευθύνει το χρήστη να το `/authorize` τελικού σημείου. Σε αυτήν την αίτηση, ο υπολογιστής-πελάτης υποδεικνύει τα δικαιώματα που χρειάζεται να αποκτήσετε από το χρήστη. Μπορείτε να λάβετε τα τελικά σημεία 2.0 διακριτικό από τη σελίδα της εφαρμογής σας στην πύλη κλασική Azure, στο κουμπί **Προβολή τελικά σημεία** στο το σχέδιο κάτω.

```
// Line breaks for legibility only

https://login.microsoftonline.com/{tenant}/oauth2/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&resource=https%3A%2F%2Fservice.contoso.com%2F
&state=12345
```

| Παράμετρος | | Περιγραφή |
| ----------------------- | ------------------------------- | --------------- |
| μισθωτή | απαιτείται | Το `{tenant}` τιμή στη διαδρομή της αίτησης μπορούν να χρησιμοποιηθούν για να ελέγχετε ποιος μπορεί να συνδεθείτε στην εφαρμογή.  Οι επιτρεπόμενοι τιμές είναι αναγνωριστικά μισθωτή, π.χ. `8eaef023-2b34-4da1-9baa-8bc8c9d6a490` ή `contoso.onmicrosoft.com` ή `common` για τα διακριτικά ανεξάρτητο μισθωτή |
| client_id | απαιτείται | Το αναγνωριστικό εφαρμογής που έχουν ανατεθεί σε εφαρμογή όταν καταχωρήσατε με το Azure AD. Μπορείτε να το βρείτε στην πύλη διαχείρισης του Azure. Κάντε κλικ στην **Υπηρεσία καταλόγου Active Directory**, κάντε κλικ στον κατάλογο, κάντε κλικ στην επιλογή σχετικά με την εφαρμογή και, στη συνέχεια, κάντε κλικ στη **Ρύθμιση παραμέτρων** |
| response_type | απαιτείται | Πρέπει να περιλαμβάνει `code` για τη ροή κώδικα εξουσιοδότησης. |
| redirect_uri | Συνιστάται | Το redirect_uri της εφαρμογής, όπου μπορούν να αποστολής και λήψης από την εφαρμογή του ελέγχου ταυτότητας των απαντήσεων.  Αυτό πρέπει να αντιστοιχεί ακριβώς ένα από τα redirect_uris που έχουν καταχωρηθεί στην πύλη του, εκτός από αυτό πρέπει να κωδικοποιηθεί ως διεύθυνση url.  Για εφαρμογές native & κινητές συσκευές, μπορείτε να χρησιμοποιήσετε την προεπιλεγμένη τιμή του `urn:ietf:wg:oauth:2.0:oob`. |
| response_mode | Συνιστάται | Καθορίζει τη μέθοδο που πρέπει να χρησιμοποιούνται για την αποστολή που προκύπτει διακριτικού πίσω για την εφαρμογή σας.  Μπορεί να είναι `query` ή `form_post`.  |
| κατάσταση | Συνιστάται | Μια τιμή που περιλαμβάνονται στην αίτηση που θα επιστραφεί επίσης στην διακριτικού απάντηση. Μια μοναδική τιμή που δημιούργησε τυχαία χρησιμοποιείται συνήθως για την [Αποτροπή επιθέσεις πλαστογράφησης διατοποθεσιακή αίτηση](http://tools.ietf.org/html/rfc6749#section-10.12).  Η κατάσταση χρησιμοποιείται επίσης για την κωδικοποίηση πληροφοριών σχετικά με την κατάσταση του χρήστη στην εφαρμογή πριν από την αίτηση ελέγχου ταυτότητας προέκυψε, όπως τη σελίδα ή την προβολή που είχαν στην. |
| πόρων | προαιρετικό | Το Αναγνωριστικό εφαρμογής URI του web API (ασφαλή πόρων). Για να βρείτε το URI Αναγνωριστικό εφαρμογής του web API, στην πύλη διαχείρισης του Azure, κάντε κλικ στην επιλογή **Υπηρεσία καταλόγου Active Directory**, κάντε κλικ στον κατάλογο, κάντε κλικ στην εφαρμογή και, στη συνέχεια, κάντε κλικ στην επιλογή **Ρύθμιση παραμέτρων**. |
| γραμμή εντολών | προαιρετικό |  Υποδεικνύει τον τύπο της αλληλεπίδραση με το χρήστη που είναι απαραίτητη.<p> Έγκυρες τιμές είναι: <p> *σύνδεση*: Ο χρήστης πρέπει να σας ζητηθεί να επαναλάβετε τον έλεγχο ταυτότητας. <p> *συγκατάθεση*: έχει χορηγηθεί συγκατάθεση χρήστη, αλλά πρέπει να ενημερωθεί. Ο χρήστης πρέπει να σας ζητηθεί να τη συγκατάθεσή σας. <p> *admin_consent*: Ο διαχειριστής πρέπει να σας ζητηθεί να συγκατάθεση εκ μέρους όλους τους χρήστες στον οργανισμό τους |
| login_hint | προαιρετικό | Μπορεί να χρησιμοποιηθεί για προ-συμπληρώσετε το πεδίο διεύθυνση username/ηλεκτρονικού ταχυδρομείου της διαδικασίας Πραγματοποιήστε είσοδο στη σελίδα για το χρήστη, εάν γνωρίζετε το όνομα χρήστη εκ των προτέρων.  Συχνά οι εφαρμογές θα χρησιμοποιήσετε αυτήν την παράμετρο κατά την επανάληψη του ελέγχου ταυτότητας, έχοντας ήδη που έχουν εξαχθεί το όνομα χρήστη από μια προηγούμενη είσοδος με χρήση του `preferred_username` διεκδίκηση. |
| domain_hint | προαιρετικό | Παρέχει μια υπόδειξη σχετικά με το μισθωτή ή τον τομέα που ο χρήστης θα πρέπει να χρησιμοποιήσετε για να πραγματοποιήσετε είσοδο. Η τιμή του domain_hint είναι καταχωρημένες τομέα για το μισθωτή. Εάν ο μισθωτής είναι ομόσπονδες σε έναν κατάλογο εσωτερικής εγκατάστασης, AAD ανακατευθύνει στο διακομιστή ομοσπονδίας καθορισμένο μισθωτή. |

> [AZURE.NOTE] Εάν ο χρήστης είναι μέρος μιας εταιρείας, ο διαχειριστής της εταιρείας μπορεί να τη συγκατάθεσή σας ή απόρριψη εκ μέρους του χρήστη, ή επιτρέπει στο χρήστη να τη συγκατάθεσή σας. Ο χρήστης λαμβάνει την επιλογή για να τη συγκατάθεσή σας μόνο όταν το επιτρέπει ο διαχειριστής.

Σε αυτό το σημείο, ο χρήστης θα σας ζητηθεί να εισαγάγετε τα διαπιστευτήριά τους και να τη συγκατάθεσή σας για να τα δικαιώματα που υποδεικνύεται στην το `scope` ερώτημα παραμέτρων. Όταν ο χρήστης πραγματοποιεί έλεγχο ταυτότητας και εκχωρεί συγκατάθεση, Azure AD στέλνει μια απάντηση σε εφαρμογή στο το `redirect_uri` διεύθυνση στην πρόσκληση σε.

### <a name="successful-response"></a>Επιτυχής απόκρισης

Μια επιτυχημένη απόκριση μπορεί να μοιάζει κάπως έτσι:

```
GET  HTTP/1.1 302 Found
Location: http://localhost/myapp/?code= AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrqqf_ZT_p5uEAEJJ_nZ3UmphWygRNy2C3jJ239gV_DBnZ2syeg95Ki-374WHUP-i3yIhv5i-7KU2CEoPXwURQp6IVYMw-DjAOzn7C3JCu5wpngXmbZKtJdWmiBzHpcO2aICJPu1KvJrDLDP20chJBXzVYJtkfjviLNNW7l7Y3ydcHDsBRKZc3GuMQanmcghXPyoDg41g8XbwPudVh7uCmUponBQpIhbuffFP_tbV8SNzsPoFz9CLpBCZagJVXeqWoYMPe2dSsPiLO9Alf_YIe5zpi-zY4C3aLw5g9at35eZTfNd0gBRpR5ojkMIcZZ6IgAA&session_state=7B29111D-C220-4263-99AB-6F6E135D75EF&state=D79E5777-702E-4260-9A62-37F75FF22CCE
```

| Παράμετρος | Περιγραφή |
| -----------------------| --------------- |
| admin_consent | Η τιμή είναι True εάν ο διαχειριστής δεχθεί μια ερώτηση αίτηση συγκατάθεση.|
| κωδικός | Ο κωδικός εξουσιοδότησης που ζητήθηκε από την εφαρμογή. Η εφαρμογή μπορεί να χρησιμοποιήσει τον κωδικό εξουσιοδότησης για να ζητήσετε από ένα διακριτικό πρόσβασης για τον πόρο προορισμού. |
| session_state | Μια μοναδική τιμή που προσδιορίζει την τρέχουσα περίοδο λειτουργίας του χρήστη. Αυτή η τιμή είναι ένα GUID, αλλά θα πρέπει να αντιμετωπίζεται ως αδιαφανές τιμή που μεταβιβάζεται χωρίς εξέταση. |
| κατάσταση | Εάν μια παράμετρος κατάσταση περιλαμβάνει την αίτηση, την ίδια τιμή θα πρέπει να εμφανίζεται στην απάντηση. Είναι μια καλή πρακτική για την εφαρμογή για να επαληθεύσετε ότι τις τιμές κατάστασης στην αίτησης και απόκρισης πανομοιότυπες πριν από τη χρήση της απόκρισης. Αυτό σας βοηθά να εντοπίσει [επιθέσεις πλαστογράφησης αίτηση διατοποθεσιακή (CSRF)](https://tools.ietf.org/html/rfc6749#section-10.12) σε σχέση με το πρόγραμμα-πελάτη.  

### <a name="error-response"></a>Απόκριση σφάλμα

Απαντήσεις σφάλματος μπορεί να αποσταλούν επίσης για το `redirect_uri` , έτσι ώστε η εφαρμογή να τους χειριστεί σωστά.

```
GET http://localhost:12345/?
error=access_denied
&error_description=the+user+canceled+the+authentication
```

| Παράμετρος | Περιγραφή |
|-----------|-------------|
| Σφάλμα | Μια τιμή κωδικός σφάλματος οριστεί στην ενότητα 5.2 του [Framework εξουσιοδότησης 2.0 OAuth](http://tools.ietf.org/html/rfc6749). Στον επόμενο πίνακα περιγράφει τους κωδικούς σφάλματος που επιστρέφει Azure AD. |
| error_description | Μια πιο λεπτομερή περιγραφή του σφάλματος. Αυτό το μήνυμα δεν προορίζεται για να φιλικούς προς τελικού χρήστη. |
| κατάσταση | Η τιμή κατάστασης είναι μια που δημιούργησε τυχαία τιμή μη ξανά που στέλνονται στην αίτηση και να επιστραφεί στην απάντηση για να αποτρέψετε την αίτηση διατοποθεσιακή επιθέσεις πλαστογράφησης (CSRF). |

#### <a name="error-codes-for-authorization-endpoint-errors"></a>Κωδικοί σφάλματος για σφάλματα εξουσιοδότησης τελικού σημείου

Ο παρακάτω πίνακας περιγράφει τα διάφορα τους κωδικούς σφάλματος που μπορεί να επιστραφούν στο το `error` παράμετρος της απόκρισης σφάλματος.

| Κωδικός σφάλματος | Περιγραφή | Ενέργεια προγράμματος-πελάτη |
|------------|-------------|---------------|
| invalid_request | Πρωτόκολλο σφάλμα, όπως μια απαιτούμενη παράμετρος λείπει. | Διόρθωση και υποβάλετε ξανά την αίτηση. Αυτή είναι μια ανάπτυξη συνήθως εντοπίζεται σφάλμα κατά την αρχική δοκιμή.|
| unauthorized_client | Δεν επιτρέπεται η εφαρμογή προγράμματος-πελάτη για να ζητήσετε από έναν κωδικό εξουσιοδότησης. | Αυτό συνήθως συμβαίνει όταν η εφαρμογή προγράμματος-πελάτη δεν έχει καταχωρηθεί στο Azure AD ή δεν προστίθεται στο μισθωτή Azure AD του χρήστη. Η εφαρμογή μπορεί να γίνεται ερώτηση στο χρήστη με οδηγίες για την εγκατάσταση της εφαρμογής και προσθήκη του Azure AD. |
| access_denied | Δεν επιτρέπεται η συγκατάθεση κάτοχο πόρων | Η εφαρμογή προγράμματος-πελάτη μπορεί να ειδοποιήσει στο χρήστη που αυτό δεν είναι δυνατό να συνεχίσετε, εκτός εάν υπάρξει συγκατάθεση του χρήστη. |
| unsupported_response_type | Ο διακομιστής εξουσιοδότησης δεν υποστηρίζει τον τύπο απάντηση στην πρόσκληση σε. | Διόρθωση και υποβάλετε ξανά την αίτηση. Αυτή είναι μια ανάπτυξη συνήθως εντοπίζεται σφάλμα κατά την αρχική δοκιμή.|
|server_error | Ο διακομιστής αντιμετώπισε ένα μη αναμενόμενο σφάλμα. | Προσπαθήστε ξανά. Αυτά τα σφάλματα μπορεί να προκύψουν από προσωρινό συνθήκες. Την εφαρμογή-πελάτη μπορεί να εξηγήσετε στο χρήστη ότι η απόκρισή καθυστερήσει προθεσμία ένα προσωρινό σφάλμα. |
| temporarily_unavailable | Ο διακομιστής είναι προσωρινά πολύ απασχολημένοι για να διαχειριστεί την αίτηση. | Προσπαθήστε ξανά. Την εφαρμογή-πελάτη μπορεί να εξηγήσετε στο χρήστη ότι η απόκρισή καθυστερήσει προθεσμία προσωρινό συνθήκης. |
| invalid_resource |Ο πόρος προορισμού δεν είναι έγκυρη, επειδή δεν υπάρχει, δεν μπορείτε να βρείτε το Azure AD ή δεν έχει ρυθμιστεί σωστά.| Αυτό υποδεικνύει τον πόρο, εάν υπάρχει, δεν έχει ρυθμιστεί στο μισθωτή. Η εφαρμογή μπορεί να γίνεται ερώτηση στο χρήστη με οδηγίες για την εγκατάσταση της εφαρμογής και προσθήκη του Azure AD. |

## <a name="use-the-authorization-code-to-request-an-access-token"></a>Χρήση του κωδικού εξουσιοδότηση για να ζητήσετε από ένα διακριτικό πρόσβασης

Τώρα που έχετε αποκτήσει ένα κωδικό εξουσιοδότησης και έχουν εκχωρηθεί δικαιώματα από το χρήστη, που μπορούν να αποκτήσουν τον κωδικό για ένα διακριτικό πρόσβασης στον επιθυμητό πόρο, στέλνοντας μια αίτηση ΚΑΤΑΧΏΡΗΣΗ για το `/token` τελικού σημείου:

```
// Line breaks for legibility only

POST /{tenant}/oauth2/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded
grant_type=authorization_code
&client_id=2d4d11a2-f814-46a7-890a-274a72a7309e
&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrqqf_ZT_p5uEAEJJ_nZ3UmphWygRNy2C3jJ239gV_DBnZ2syeg95Ki-374WHUP-i3yIhv5i-7KU2CEoPXwURQp6IVYMw-DjAOzn7C3JCu5wpngXmbZKtJdWmiBzHpcO2aICJPu1KvJrDLDP20chJBXzVYJtkfjviLNNW7l7Y3ydcHDsBRKZc3GuMQanmcghXPyoDg41g8XbwPudVh7uCmUponBQpIhbuffFP_tbV8SNzsPoFz9CLpBCZagJVXeqWoYMPe2dSsPiLO9Alf_YIe5zpi-zY4C3aLw5g9at35eZTfNd0gBRpR5ojkMIcZZ6IgAA
&redirect_uri=https%3A%2F%2Flocalhost%2Fmyapp%2F
&resource=https%3A%2F%2Fservice.contoso.com%2F
&client_secret=p@ssw0rd

//NOTE: client_secret only required for web apps
```

| Παράμετρος | | Περιγραφή |
| ----------------------- | ------------------------------- | --------------------- |
| μισθωτή | απαιτείται |  Το `{tenant}` τιμή στη διαδρομή της αίτησης μπορούν να χρησιμοποιηθούν για να ελέγχετε ποιος μπορεί να συνδεθείτε στην εφαρμογή.  Οι επιτρεπόμενοι τιμές είναι αναγνωριστικά μισθωτή, π.χ. `8eaef023-2b34-4da1-9baa-8bc8c9d6a490` ή `contoso.onmicrosoft.com` ή `common` για τα διακριτικά ανεξάρτητο μισθωτή |
| client_id | απαιτείται | Το αναγνωριστικό εφαρμογής που έχουν ανατεθεί σε εφαρμογή όταν καταχωρήσατε με το Azure AD. Μπορείτε να το βρείτε στην πύλη κλασική Azure. Κάντε κλικ στην **Υπηρεσία καταλόγου Active Directory**, κάντε κλικ στον κατάλογο, κάντε κλικ στην επιλογή σχετικά με την εφαρμογή και, στη συνέχεια, κάντε κλικ στη **Ρύθμιση παραμέτρων** |
| grant_type | απαιτείται | Πρέπει να είναι `authorization_code` για τη ροή κώδικα εξουσιοδότησης. |
| κωδικός | απαιτείται | Το `authorization_code` που αποκτήσατε στην προηγούμενη ενότητα   |
| redirect_uri | απαιτείται | Το ίδιο `redirect_uri` τιμή που χρησιμοποιήθηκε για να αποκτήσετε το `authorization_code`. |
| client_secret | απαιτείται για τις εφαρμογές web | Το μυστικό της εφαρμογής που δημιουργήσατε στην πύλη καταχώρηση εφαρμογής για την εφαρμογή σας.  Δεν θα πρέπει να χρησιμοποιηθεί σε μια εφαρμογή για εγγενή, επειδή client_secrets δεν μπορούν να αποθηκευτούν αξιόπιστα σε συσκευές.  Απαιτείται για εφαρμογές web και web API, τα οποία έχουν τη δυνατότητα να αποθηκεύσετε το `client_secret` με ασφάλεια στο διακομιστή. |
| πόρος | απαιτείται εάν καθορίζεται στην αίτηση κωδικό εξουσιοδότησης, αλλιώς προαιρετικά | Το Αναγνωριστικό εφαρμογής URI του web API (ασφαλή πόρων).
Για να βρείτε το Αναγνωριστικό URI εφαρμογής, στην πύλη διαχείρισης του Azure, κάντε κλικ στην επιλογή **Υπηρεσία καταλόγου Active Directory**, κάντε κλικ στον κατάλογο, κάντε κλικ στην εφαρμογή και, στη συνέχεια, κάντε κλικ στην επιλογή **Ρύθμιση παραμέτρων**.

### <a name="successful-response"></a>Επιτυχής απόκρισης

Azure AD επιστρέφει ένα διακριτικό πρόσβασης κατά την επιτυχή απάντηση. Για να ελαχιστοποιήσετε δικτύου κλήσεις από την εφαρμογή-πελάτη και τις σχετικές λανθάνοντος χρόνου, την εφαρμογή-πελάτη πρέπει να cache διακριτικά πρόσβασης για το διακριτικό διάρκειας ζωής που καθορίζεται στην απάντηση διακριτικό 2.0. Για να προσδιορίσετε τη διάρκεια ζωής διακριτικού, χρησιμοποιήστε το `expires_in` ή `expires_on` τιμές παραμέτρων.

Εάν μια web πόρων API επιστρέφει ένα `invalid_token` κωδικό σφάλματος, αυτό μπορεί να δηλώνει ότι ο πόρος έχει προσδιορίσει ότι έχει λήξει το διακριτικό. Εάν οι χρόνοι ρολόι του υπολογιστή-πελάτη και πόρων είναι διαφορετικό (γνωστά και ως "ώρα skew"), ο πόρος μπορεί να μπορείτε να το διακριτικό να έχει λήξει πριν από το διακριτικό απενεργοποιείται από το cache του προγράμματος-πελάτη. Αν συμβεί αυτό, καταργήστε την επιλογή από το διακριτικό από το cache, ακόμα και αν είναι ακόμη μέσα σε διάρκεια ζωής του υπολογισμού.

Μια επιτυχημένη απόκριση μπορεί να μοιάζει κάπως έτσι:

```
{
  "access_token": " eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1THdqcHdBSk9NOW4tQSJ9.eyJhdWQiOiJodHRwczovL3NlcnZpY2UuY29udG9zby5jb20vIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvN2ZlODE0NDctZGE1Ny00Mzg1LWJlY2ItNmRlNTdmMjE0NzdlLyIsImlhdCI6MTM4ODQ0MDg2MywibmJmIjoxMzg4NDQwODYzLCJleHAiOjEzODg0NDQ3NjMsInZlciI6IjEuMCIsInRpZCI6IjdmZTgxNDQ3LWRhNTctNDM4NS1iZWNiLTZkZTU3ZjIxNDc3ZSIsIm9pZCI6IjY4Mzg5YWUyLTYyZmEtNGIxOC05MWZlLTUzZGQxMDlkNzRmNSIsInVwbiI6ImZyYW5rbUBjb250b3NvLmNvbSIsInVuaXF1ZV9uYW1lIjoiZnJhbmttQGNvbnRvc28uY29tIiwic3ViIjoiZGVOcUlqOUlPRTlQV0pXYkhzZnRYdDJFYWJQVmwwQ2o4UUFtZWZSTFY5OCIsImZhbWlseV9uYW1lIjoiTWlsbGVyIiwiZ2l2ZW5fbmFtZSI6IkZyYW5rIiwiYXBwaWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctODkwYS0yNzRhNzJhNzMwOWUiLCJhcHBpZGFjciI6IjAiLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJhY3IiOiIxIn0.JZw8jC0gptZxVC-7l5sFkdnJgP3_tRjeQEPgUn28XctVe3QqmheLZw7QVZDPCyGycDWBaqy7FLpSekET_BftDkewRhyHk9FW_KeEz0ch2c3i08NGNDbr6XYGVayNuSesYk5Aw_p3ICRlUV1bqEwk-Jkzs9EEkQg4hbefqJS6yS1HoV_2EsEhpd_wCQpxK89WPs3hLYZETRJtG5kvCCEOvSHXmDE6eTHGTnEgsIk--UlPe275Dvou4gEAwLofhLDQbMSjnlV5VLsjimNBVcSRFShoxmQwBJR_b2011Y5IuD6St5zPnzruBbZYkGNurQK63TJPWmRd3mbJsGM0mf3CUQ",
  "token_type": "Bearer",
  "expires_in": "3600",
  "expires_on": "1388444763",
  "resource": "https://service.contoso.com/",
  "refresh_token": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4rTfgV29ghDOHRc2B-C_hHeJaJICqjZ3mY2b_YNqmf9SoAylD1PycGCB90xzZeEDg6oBzOIPfYsbDWNf621pKo2Q3GGTHYlmNfwoc-OlrxK69hkha2CF12azM_NYhgO668yfcUl4VBbiSHZyd1NVZG5QTIOcbObu3qnLutbpadZGAxqjIbMkQ2bQS09fTrjMBtDE3D6kSMIodpCecoANon9b0LATkpitimVCrl-NyfN3oyG4ZCWu18M9-vEou4Sq-1oMDzExgAf61noxzkNiaTecM-Ve5cq6wHqYQjfV9DOz4lbceuYCAA",
  "scope": "https%3A%2F%2Fgraph.microsoft.com%2Fmail.read",
"id_token": " eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctODkwYS0yNzRhNzJhNzMwOWUiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC83ZmU4MTQ0Ny1kYTU3LTQzODUtYmVjYi02ZGU1N2YyMTQ3N2UvIiwiaWF0IjoxMzg4NDQwODYzLCJuYmYiOjEzODg0NDA4NjMsImV4cCI6MTM4ODQ0NDc2MywidmVyIjoiMS4wIiwidGlkIjoiN2ZlODE0NDctZGE1Ny00Mzg1LWJlY2ItNmRlNTdmMjE0NzdlIiwib2lkIjoiNjgzODlhZTItNjJmYS00YjE4LTkxZmUtNTNkZDEwOWQ3NGY1IiwidXBuIjoiZnJhbmttQGNvbnRvc28uY29tIiwidW5pcXVlX25hbWUiOiJmcmFua21AY29udG9zby5jb20iLCJzdWIiOiJKV3ZZZENXUGhobHBTMVpzZjd5WVV4U2hVd3RVbTV5elBtd18talgzZkhZIiwiZmFtaWx5X25hbWUiOiJNaWxsZXIiLCJnaXZlbl9uYW1lIjoiRnJhbmsifQ.”
}

```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| access_token | Το διακριτικό πρόσβασης ζητήθηκε. Η εφαρμογή να χρησιμοποιήσετε αυτό το διακριτικό για τον έλεγχο ταυτότητας για την ασφαλή πόρου, όπως ένα API web. |
| token_type | Υποδεικνύει την τιμή διακριτικού τύπου. Ο μόνος τύπος που υποστηρίζει το Azure AD είναι φορέα. Για περισσότερες πληροφορίες σχετικά με τα διακριτικά φορέα, ανατρέξτε στο θέμα [OAuth2.0 εξουσιοδότησης Framework: χρήση διακριτικό φορέα (RFC 6750)](http://www.rfc-editor.org/rfc/rfc6750.txt)  |
| expires_in | Πόσο χρόνο το διακριτικό πρόσβασης είναι έγκυρη (σε δευτερόλεπτα). |
| expires_on | Η ώρα κατά την οποία λήγει το διακριτικό πρόσβασης. Η ημερομηνία αποδίδεται με τον αριθμό των δευτερολέπτων από 1970-01-01T0:0:0Z UTC μέχρι την ώρα λήξης. Αυτή η τιμή χρησιμοποιείται για τον καθορισμό της διάρκειας ζωής των διακριτικά στο cache. |
| πόρων | Το Αναγνωριστικό εφαρμογής URI του web API (ασφαλή πόρου).|
| πεδίο εφαρμογής | Δικαιώματα απομίμησης που έχουν εκχωρηθεί στην εφαρμογή-πελάτη. Είναι τα προεπιλεγμένα δικαιώματα `user_impersonation`. Ο κάτοχος του πόρου ασφαλές να καταχωρήσετε πρόσθετες τιμές στο Azure AD.|
| refresh_token |  Ένα διακριτικό ανανέωση διακριτικό 2.0. Η εφαρμογή να χρησιμοποιήσετε αυτό το διακριτικό να αποκτήσετε πρόσθετες access διακριτικά αφού λήξει η τρέχουσα διακριτικό πρόσβασης.  Ανανεώστε τα διακριτικά είναι μεγάλης διάρκειας και μπορούν να χρησιμοποιηθούν για να διατηρήσετε την πρόσβαση σε πόρους για εκτεταμένη χρονική περίοδο. |
| id_token | Ένα μη υπογεγραμμένο JSON Web διακριτικού (JWT). Η εφαρμογή base64Url μπορούν να αποκωδικοποιείτε τα τμήματα της αυτό το διακριτικό να ζητήσετε πληροφορίες σχετικά με το χρήστη που έχετε συνδεθεί στο. Η εφαρμογή μπορεί να cache τις τιμές και να τις εμφανίσετε, αλλά δεν πρέπει να βασίζεστε σε αυτές για τυχόν εξουσιοδότησης ή όρια ασφαλείας. |

### <a name="jwt-token-claims"></a>JWT αξιώσεων διακριτικού
Το διακριτικό JWT την τιμή από το `id_token` παραμέτρου μπορεί να αποκωδικοποιηθεί σε τις ακόλουθες απαιτήσεις:

```
{
 "typ": "JWT",
 "alg": "none"
}.
{
 "aud": "2d4d11a2-f814-46a7-890a-274a72a7309e",
 "iss": "https://sts.windows.net/7fe81447-da57-4385-becb-6de57f21477e/",
 "iat": 1388440863,
 "nbf": 1388440863,
 "exp": 1388444763,
 "ver": "1.0",
 "tid": "7fe81447-da57-4385-becb-6de57f21477e",
 "oid": "68389ae2-62fa-4b18-91fe-53dd109d74f5",
 "upn": "frank@contoso.com",
 "unique_name": "frank@contoso.com",
 "sub": "JWvYdCWPhhlpS1Zsf7yYUxShUwtUm5yzPmw_-jX3fHY",
 "family_name": "Miller",
 "given_name": "Frank"
}.
```

Το `id_token` παράμετρος περιλαμβάνει τους ακόλουθους τύπους διεκδίκηση. Για περισσότερες πληροφορίες σχετικά με τα διακριτικά JSON web, ανατρέξτε στο θέμα της [JWT IETF προδιαγραφή Πρόχειρο](http://go.microsoft.com/fwlink/?LinkId=392344). Για περισσότερες πληροφορίες σχετικά με τους τύπους διακριτικού και τις απαιτήσεις, διαβάστε [τύποι διεκδίκηση και υποστηρίζονται διακριτικού](active-directory-token-and-claims.md)

| Τύπος δήλωσης | Περιγραφή |
|------------|-------------|
| πληροφορίες | Ακροατήριο του διακριτικού. Όταν το διακριτικό εκδίδεται για μια εφαρμογή προγράμματος-πελάτη, το κοινό είναι το `client_id` του προγράμματος-πελάτη.
| EXP | Ώρα λήξης. Η ώρα κατά την οποία λήγει το διακριτικό. Για το διακριτικό να είναι έγκυρες, η τρέχουσα ημερομηνία/ώρα πρέπει να είναι μικρότερη ή ίση με την `exp` τιμή. Ο χρόνος αποδίδεται με τον αριθμό των δευτερολέπτων από 1 Ιανουαρίου 1970 (1970-01-01T0:0:0Z) UTC μέχρι την ώρα που έχει εκδοθεί από το διακριτικό. |
| family_name | Του χρήστη τελευταίο όνομα ή επώνυμο. Η εφαρμογή να εμφανίσετε αυτήν την τιμή. |
| given_name | Όνομα του χρήστη. Η εφαρμογή να εμφανίσετε αυτήν την τιμή. |
| IAT | Εκδοθεί κατά το χρόνο. Το χρονικό διάστημα κατά το JWT έχει εκδοθεί. Ο χρόνος αποδίδεται με τον αριθμό των δευτερολέπτων από 1 Ιανουαρίου 1970 (1970-01-01T0:0:0Z) UTC μέχρι την ώρα που έχει εκδοθεί από το διακριτικό. |
| ISS | Προσδιορίζει τον εκδότη διακριτικού |
| NBF | Όχι πριν από την ώρα. Το χρονικό διάστημα κατά το διακριτικό γίνεται ενεργή. Για το διακριτικό να είναι έγκυρες, η τρέχουσα ημερομηνία/ώρα πρέπει να είναι μεγαλύτερη ή ίση της τιμής Nbf. Ο χρόνος αποδίδεται με τον αριθμό των δευτερολέπτων από 1 Ιανουαρίου 1970 (1970-01-01T0:0:0Z) UTC μέχρι την ώρα που έχει εκδοθεί από το διακριτικό. |
| αναγνωριστικό αντικειμένου | Αναγνωριστικό αντικειμένου (ID) του αντικειμένου χρήστη στο Azure AD. |
| Sub | Αναγνωριστικό διακριτικού θέμα. Αυτή είναι μια μόνιμη και αμετάβλητες αναγνωριστικό για το χρήστη που περιγράφει το διακριτικό. Χρησιμοποιήστε αυτήν την τιμή σε λογική προσωρινή αποθήκευση. |
| TID | Αναγνωριστικό μισθωτή (ID) του μισθωτή του Azure AD που εξέδωσε το διακριτικό. |
| unique_name | Ένα μοναδικό αναγνωριστικό για που μπορεί να εμφανίζεται στο χρήστη. Αυτό είναι συνήθως ένα κύριο όνομα χρήστη (UPN). |
| UPN | Κύριο όνομα χρήστη του χρήστη. |
| έκδοση | Έκδοση. Η έκδοση του το διακριτικό JWT, συνήθως 1.0. |

### <a name="error-response"></a>Απόκριση σφάλμα

Τα σφάλματα τελικού σημείου έκδοση κωδικού είναι HTTP τους κωδικούς σφάλματος, επειδή το πρόγραμμα-πελάτη σας καλεί το τελικό σημείο έκδοση κωδικού απευθείας. Εκτός από τον κωδικό κατάστασης HTTP, το τελικό σημείο έκδοση κωδικού Azure AD επιστρέφει επίσης ένα έγγραφο JSON με αντικείμενα που περιγράφουν το σφάλμα.

Δείγμα απόκριση σφάλματος μπορεί να μοιάζει κάπως έτσι:

```
{
  "error": "invalid_grant",
  "error_description": "AADSTS70002: Error validating credentials. AADSTS70008: The provided authorization code or refresh token is expired. Send a new interactive authorization request for this user and resource.\r\nTrace ID: 3939d04c-d7ba-42bf-9cb7-1e5854cdce9e\r\nCorrelation ID: a8125194-2dc8-4078-90ba-7b6592a7f231\r\nTimestamp: 2016-04-11 18:00:12Z",
  "error_codes": [
    70002,
    70008
  ],
  "timestamp": "2016-04-11 18:00:12Z",
  "trace_id": "3939d04c-d7ba-42bf-9cb7-1e5854cdce9e",
  "correlation_id": "a8125194-2dc8-4078-90ba-7b6592a7f231"
}
```
| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| Σφάλμα | Μια συμβολοσειρά κωδικό σφάλματος που μπορεί να χρησιμοποιηθεί για την ταξινόμηση των τύπων σφάλματα που προκύπτουν και μπορεί να χρησιμοποιηθεί προκειμένου να αντιμετωπίζεται σφάλματα. |
| error_description | Ένα συγκεκριμένο μήνυμα σφάλματος που μπορεί να σας βοηθήσει ο προγραμματιστής Προσδιορισμός της αρχικής αιτίας ενός σφάλματος ελέγχου ταυτότητας.  |
| error_codes | Μια λίστα STS συγκεκριμένων κωδικών σφάλματος που μπορεί να σας βοηθήσει στη Διαγνωστικά. |
| χρονική σήμανση | Η ώρα κατά την οποία παρουσιάστηκε το σφάλμα. |
| trace_id | Ένα μοναδικό αναγνωριστικό για την αίτηση που μπορούν να σας βοηθήσουν στην Διαγνωστικά.  |
| correlation_id | Ένα μοναδικό αναγνωριστικό για την αίτηση που μπορούν να σας βοηθήσουν στην Διαγνωστικά σε όλα τα στοιχεία.|

#### <a name="http-status-codes"></a>Κωδικοί κατάστασης HTTP

Ο παρακάτω πίνακας παραθέτει τους κωδικούς κατάστασης HTTP που επιστρέφει το τελικό σημείο έκδοση κωδικού. Σε ορισμένες περιπτώσεις, ο κωδικός σφάλματος είναι αρκετά μεγάλο για να περιγράψετε την απόκριση, αλλά σε περίπτωση σφάλματα, θα πρέπει να ανάλυση συνοδευτικό έγγραφο JSON και να εξετάσετε τον κωδικό σφάλματος.

| Κωδικός HTTP | Περιγραφή |
|-----------|-------------|
| 400       | Προεπιλεγμένο κωδικό HTTP. Χρησιμοποιείται στις περισσότερες περιπτώσεις και οφείλεται συνήθως μια ακατάλληλη αίτηση. Διόρθωση και υποβάλετε ξανά την αίτηση. |
| 401       | Έλεγχος ταυτότητας απέτυχε. Για παράδειγμα, την αίτηση λείπει η παράμετρος client_secret.|
| 403       | Ο έλεγχος ταυτότητας απέτυχε. Για παράδειγμα, ο χρήστης δεν διαθέτει δικαιώματα πρόσβασης στον πόρο. |
| 500       | Παρουσιάστηκε εσωτερικό σφάλμα κατά την υπηρεσία. Προσπαθήστε ξανά. |

#### <a name="error-codes-for-token-endpoint-errors"></a>Κωδικοί σφάλματος για σφάλματα διακριτικού τελικού σημείου

| Κωδικός σφάλματος | Περιγραφή | Ενέργεια προγράμματος-πελάτη |
|------------|-------------|---------------|
| invalid_request | Πρωτόκολλο σφάλμα, όπως μια απαιτούμενη παράμετρος λείπει. | Διόρθωση και υποβάλετε ξανά την αίτηση |
| invalid_grant | Ο κώδικας εξουσιοδότησης δεν είναι έγκυρη ή έχει λήξει. | Δοκιμάστε μια νέα αίτηση για την `/authorize` τελικού σημείου |
| unauthorized_client | Το πρόγραμμα-πελάτη με έλεγχο ταυτότητας δεν έχετε δικαίωμα να χρησιμοποιήσετε αυτόν τον τύπο εκχώρηση άδειας. | Αυτό συνήθως συμβαίνει όταν η εφαρμογή προγράμματος-πελάτη δεν έχει καταχωρηθεί στο Azure AD ή δεν προστίθεται στο μισθωτή Azure AD του χρήστη. Η εφαρμογή μπορεί να γίνεται ερώτηση στο χρήστη με οδηγίες για την εγκατάσταση της εφαρμογής και προσθήκη του Azure AD. |
| invalid_client | Έλεγχος ταυτότητας του προγράμματος-πελάτη απέτυχε. | Τα διαπιστευτήρια προγράμματος-πελάτη δεν είναι έγκυρη. Για να διορθώσετε το πρόβλημα, ο διαχειριστής της εφαρμογής ενημερώνει τα διαπιστευτήρια. |
| unsupported_grant_type | Ο διακομιστής εξουσιοδότησης δεν υποστηρίζει τον τύπο εκχώρηση άδειας. | Αλλάξτε τον τύπο εκχώρηση στην αίτηση. Αυτός ο τύπος του σφάλματος πρέπει να πραγματοποιείται μόνο κατά τη διάρκεια της ανάπτυξης και να εντοπίζονται κατά την αρχική δοκιμή. |
| invalid_resource | Ο πόρος προορισμού δεν είναι έγκυρη, επειδή δεν υπάρχει, δεν μπορείτε να βρείτε το Azure AD ή δεν έχει ρυθμιστεί σωστά. | Αυτό υποδεικνύει τον πόρο, εάν υπάρχει, δεν έχει ρυθμιστεί στο μισθωτή. Η εφαρμογή μπορεί να γίνεται ερώτηση στο χρήστη με οδηγίες για την εγκατάσταση της εφαρμογής και προσθήκη του Azure AD. |
| interaction_required | Η αίτηση απαιτεί παρέμβαση του χρήστη. Για παράδειγμα, απαιτείται ένα βήμα πρόσθετου ελέγχου ταυτότητας. | Επαναλάβετε το ερώτημα με τον ίδιο πόρο. |
| temporarily_unavailable | Ο διακομιστής είναι προσωρινά πολύ απασχολημένοι για να διαχειριστεί την αίτηση. | Προσπαθήστε ξανά. Την εφαρμογή-πελάτη μπορεί να εξηγήσετε στο χρήστη ότι η απόκρισή καθυστερήσει προθεσμία προσωρινό συνθήκης.|

## <a name="use-the-access-token-to-access-the-resource"></a>Χρησιμοποιήστε το διακριτικό πρόσβασης για να αποκτήσετε πρόσβαση στον πόρο

Τώρα που έχετε με επιτυχία αποκτήσατε μια `access_token`, μπορείτε να χρησιμοποιήσετε το διακριτικό στο αιτήσεων σε API Web, συμπεριλαμβάνοντας με το `Authorization` κεφαλίδα. Η προδιαγραφή [RFC 6750](http://www.rfc-editor.org/rfc/rfc6750.txt) εξηγεί τον τρόπο για να χρησιμοποιήσετε τα διακριτικά φορέα στο HTTP αιτήσεων πρόσβασης σε προστατευμένα πόρους.

### <a name="sample-request"></a>Δείγμα αίτησης

```
GET /data HTTP/1.1
Host: service.contoso.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1THdqcHdBSk9NOW4tQSJ9.eyJhdWQiOiJodHRwczovL3NlcnZpY2UuY29udG9zby5jb20vIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvN2ZlODE0NDctZGE1Ny00Mzg1LWJlY2ItNmRlNTdmMjE0NzdlLyIsImlhdCI6MTM4ODQ0MDg2MywibmJmIjoxMzg4NDQwODYzLCJleHAiOjEzODg0NDQ3NjMsInZlciI6IjEuMCIsInRpZCI6IjdmZTgxNDQ3LWRhNTctNDM4NS1iZWNiLTZkZTU3ZjIxNDc3ZSIsIm9pZCI6IjY4Mzg5YWUyLTYyZmEtNGIxOC05MWZlLTUzZGQxMDlkNzRmNSIsInVwbiI6ImZyYW5rbUBjb250b3NvLmNvbSIsInVuaXF1ZV9uYW1lIjoiZnJhbmttQGNvbnRvc28uY29tIiwic3ViIjoiZGVOcUlqOUlPRTlQV0pXYkhzZnRYdDJFYWJQVmwwQ2o4UUFtZWZSTFY5OCIsImZhbWlseV9uYW1lIjoiTWlsbGVyIiwiZ2l2ZW5fbmFtZSI6IkZyYW5rIiwiYXBwaWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctODkwYS0yNzRhNzJhNzMwOWUiLCJhcHBpZGFjciI6IjAiLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJhY3IiOiIxIn0.JZw8jC0gptZxVC-7l5sFkdnJgP3_tRjeQEPgUn28XctVe3QqmheLZw7QVZDPCyGycDWBaqy7FLpSekET_BftDkewRhyHk9FW_KeEz0ch2c3i08NGNDbr6XYGVayNuSesYk5Aw_p3ICRlUV1bqEwk-Jkzs9EEkQg4hbefqJS6yS1HoV_2EsEhpd_wCQpxK89WPs3hLYZETRJtG5kvCCEOvSHXmDE6eTHGTnEgsIk--UlPe275Dvou4gEAwLofhLDQbMSjnlV5VLsjimNBVcSRFShoxmQwBJR_b2011Y5IuD6St5zPnzruBbZYkGNurQK63TJPWmRd3mbJsGM0mf3CUQ
```

### <a name="error-response"></a>Απόκριση σφάλμα

Ασφαλείς πόρους που υλοποίηση κωδικοί κατάστασης HTTP RFC 6750 το ζήτημα. Εάν η αίτηση δεν περιλαμβάνει διαπιστευτήρια ελέγχου ταυτότητας ή λείπει το διακριτικό, η απόκριση που περιλαμβάνει μια `WWW-Authenticate` κεφαλίδα. Όταν αποτύχει μια αίτηση, ο διακομιστής πόρων απαντά με το έναν κωδικό κατάστασης HTTP και έναν κωδικό σφάλματος.

Ακολουθεί ένα παράδειγμα ενός επιτυχής απάντηση όταν η αίτηση προγράμματος-πελάτη δεν περιλαμβάνει το διακριτικό φορέα:

```
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer authorization_uri="https://login.window.net/contoso.com/oauth2/authorize",  error="invalid_token",  error_description="The access token is missing.",
```

#### <a name="error-parameters"></a>Παράμετροι σφάλματος

| Παράμετρος | Περιγραφή |
|-----------|-------------|
| authorization_uri | Το URI (φυσική τελικού σημείου) του διακομιστή εξουσιοδότησης. Αυτή η τιμή χρησιμοποιείται επίσης ως έναν αριθμό-κλειδί αναζήτησης για να λάβετε περισσότερες πληροφορίες σχετικά με το διακομιστή από ένα τελικό σημείο εντοπισμού. <p><p> Ο υπολογιστής-πελάτης πρέπει να επικυρώσετε ότι ο διακομιστής εξουσιοδότησης είναι αξιόπιστη. Όταν ο πόρος είναι προστατευμένο από Azure AD, είναι αρκετό ώστε να επαληθεύσετε ότι η διεύθυνση URL αρχίζει με https://login.windows.net ή με άλλο όνομα κεντρικού υπολογιστή που υποστηρίζει το Azure AD. Ένας πόρος συγκεκριμένο μισθωτή πρέπει να επιστρέφει πάντα έναν συγκεκριμένο μισθωτή εξουσιοδότησης URI. |
| Σφάλμα | Μια τιμή κωδικός σφάλματος οριστεί στην ενότητα 5.2 του [Framework εξουσιοδότησης 2.0 OAuth](http://tools.ietf.org/html/rfc6749).|
| error_description | Μια πιο λεπτομερή περιγραφή του σφάλματος. Αυτό το μήνυμα δεν προορίζεται για να φιλικούς προς τελικού χρήστη.|
| αναγνωριστικό_πόρου | Επιστρέφει το μοναδικό αναγνωριστικό του πόρου. Την εφαρμογή-πελάτη να χρησιμοποιήσετε αυτό το αναγνωριστικό ως η τιμή του το `resource` παραμέτρου όταν απαιτεί ενός διακριτικού για τον πόρο. <p><p> Είναι πολύ σημαντικό για την εφαρμογή-πελάτη για να επιβεβαιώσετε αυτήν την τιμή, διαφορετικά κακόβουλο υπηρεσίας ίσως να προκαλέσουν επίθεση **ανύψωση των δικαιωμάτων** <p><p> Είναι η προτεινόμενη στρατηγική για την αποτροπή επίθεση για να βεβαιωθείτε ότι το `resource_id` ταιριάζει με τη βάση του API διεύθυνση URL web που γίνεται πρόσβαση. Για παράδειγμα, εάν https://service.contoso.com/data γίνεται πρόσβαση, το `resource_id` μπορεί να είναι htttps://service.contoso.com/. Πρέπει να απορρίψετε την εφαρμογή-πελάτη ένα `resource_id` που δεν ξεκινούν με τη βασική διεύθυνση URL, εκτός εάν υπάρχει μια αξιόπιστη εναλλακτικό τρόπος για να επαληθεύσετε το αναγνωριστικό. |

#### <a name="bearer-scheme-error-codes"></a>Κωδικοί σφάλματος φορέα συνδυασμού

Η προδιαγραφή RFC 6750 ορίζει τα ακόλουθα σφάλματα για τους πόρους που χρησιμοποιούν χρησιμοποιώντας τον έλεγχο ταυτότητας WWW κεφαλίδας και συνδυασμού φορέα στην απάντηση.

| Ο κωδικός κατάστασης HTTP | Κωδικός σφάλματος | Περιγραφή | Ενέργεια προγράμματος-πελάτη |
|------------------|------------|-------------|---------------|
| 400 | invalid_request | Η αίτηση δεν έχει μορφοποιηθεί σωστά. Για παράδειγμα, ενδέχεται να μια παράμετρο που λείπουν ή χρησιμοποιώντας την ίδια παράμετρο δύο φορές. | Διορθώστε το σφάλμα και προσπαθήστε ξανά. Αυτός ο τύπος του σφάλματος πρέπει να πραγματοποιείται μόνο κατά τη διάρκεια της ανάπτυξης και να εντοπίζονται στην αρχική δοκιμή. |
| 401 | invalid_token   | Το διακριτικό πρόσβασης λείπει, δεν είναι έγκυρη ή έχει ανακληθεί. Η τιμή της παραμέτρου error_description παρέχει πρόσθετες λεπτομέρειες. |  Αίτηση για έναν νέο κωδικό από το διακομιστή εξουσιοδότησης. Εάν το νέο διακριτικό αποτύχει, Παρουσιάστηκε ένα μη αναμενόμενο σφάλμα. Στείλτε ένα μήνυμα σφάλματος για το χρήστη και προσπαθήστε ξανά μετά την τυχαία καθυστερήσεις. |
| 403 | insufficient_scope | Το διακριτικό πρόσβασης δεν περιέχει τα δικαιώματα απομίμησης που απαιτούνται για να αποκτήσετε πρόσβαση στον πόρο. | Στείλτε μια νέα πρόσκληση σε εξουσιοδότησης στο τελικό σημείο εξουσιοδότησης. Εάν η απόκριση περιέχει την παράμετρο εύρος, χρησιμοποιήστε την τιμή εμβέλειας στην αίτηση στον πόρο. |
| 403 | insufficient_access | Το θέμα του διακριτικού δεν διαθέτει τα δικαιώματα που απαιτούνται για την πρόσβαση στον πόρο. | Να γίνεται ερώτηση στο χρήστη για να χρησιμοποιήσετε ένα διαφορετικό λογαριασμό ή για να ζητήσετε δικαιώματα για το συγκεκριμένο πόρο. |

## <a name="refreshing-the-access-tokens"></a>Ανανέωση τα διακριτικά πρόσβασης

Διακριτικά πρόσβασης είναι μικρής διάρκειας και πρέπει να ανανεωθεί μετά τη λήξη τους για να συνεχίσετε την πρόσβαση σε πόρους. Μπορείτε να ανανεώσετε την `access_token` υποβάλλοντας μια άλλη `POST` αίτηση για να το `/token` τελικό σημείο, αλλά αυτό παρέχοντας ώρα το `refresh_token` αντί για το `code`.

Ανανεώστε τα διακριτικά δεν έχουν καθορισμένη διάρκεια ζωής. Συνήθως, η διάρκεια ζωής της ανανέωσης διακριτικά είναι σχετικά μεγάλων. Ωστόσο, σε ορισμένες περιπτώσεις, τα διακριτικά ανανέωσης λήξει, είναι ανακληθεί, ή δεν διαθέτουν επαρκή δικαιώματα για την επιθυμητή ενέργεια. Η εφαρμογή σας πρέπει να αναμένετε και να χειριστείτε σφάλματα που επιστρέφονται από το τελικό σημείο έκδοση κωδικού σωστά.

Όταν λαμβάνετε μια απάντηση με ένα σφάλμα διακριτικού ανανέωσης, απόρριψη το τρέχον διακριτικό ανανέωση και αίτηση για έναν νέο κωδικό εξουσιοδότησης ή διακριτικό πρόσβασης. Συγκεκριμένα, όταν χρησιμοποιώντας μια ανανέωση διακριτικό της ροής εκχώρηση άδειας κώδικα, εάν λαμβάνετε μια απάντηση με την `interaction_required` ή `invalid_grant` τους κωδικούς σφάλματος, απόρριψη το διακριτικό ανανέωσης και να ζητήσετε νέο κωδικό εξουσιοδότησης.

Δείγμα αίτησης στο τελικό σημείο **συγκεκριμένο μισθωτή** (Μπορείτε επίσης να χρησιμοποιήσετε το τελικό σημείο **κοινές** ) για να λάβετε μια νέα πρόσβασης διακριτικού τη χρήση ενός διακριτικού ανανέωση μοιάζει κάπως έτσι:

```
// Line breaks for legibility only

POST /{tenant}/oauth2/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&refresh_token=OAAABAAAAiL9Kn2Z27UubvWFPbm0gLWQJVzCTE9UkP3pSx1aXxUjq...
&grant_type=refresh_token
&resource=https%3A%2F%2Fservice.contoso.com%2F
&client_secret=JqQX2PNo9bpM0uEihUPzyrh    // NOTE: Only required for web apps
```
| Παράμετρος | Περιγραφή |
|-----------|-------------|
| access_token | Το νέο κωδικό πρόσβασης που ζητήθηκε.|
| expires_in   | Η υπόλοιπη διάρκεια ζωής του διακριτικού σε δευτερόλεπτα. Μια τυπική τιμή είναι 3600 (1 ώρα). |
| expires_on   | Η ημερομηνία και ώρα κατά την οποία λήγει το διακριτικό. Η ημερομηνία αποδίδεται με τον αριθμό των δευτερολέπτων από 1970-01-01T0:0:0Z UTC μέχρι την ώρα λήξης. |
| refresh_token | Μια νέα refresh_token 2.0 διακριτικό που μπορούν να χρησιμοποιηθούν για να ζητήσετε νέο διακριτικά πρόσβαση όταν λήξει η μία με αυτήν την απόκριση. |
| πόρων     | Προσδιορίζει τον πόρο ασφαλή που το διακριτικό πρόσβασης μπορεί να χρησιμοποιηθεί για την πρόσβαση. |
| πεδίο εφαρμογής        | Δικαιώματα απομίμησης που έχουν εκχωρηθεί στην εφαρμογή εγγενές πρόγραμμα-πελάτη. Τα προεπιλεγμένα δικαιώματα είναι **user_impersonation**. Ο κάτοχος του πόρου προορισμού να καταχωρήσετε εναλλακτικές τιμές στο Azure AD. |
| token_type   | Ο τύπος διακριτικού. Η μόνη τιμή υποστηριζόμενες είναι **φορέα**. |

### <a name="successful-response"></a>Επιτυχής απόκρισης

Επιτυχής διακριτικού απόκριση θα μοιάζει κάπως:

```
{
  "token_type": "Bearer",
  "expires_in": "3600",
  "expires_on": "1460404526",
  "resource": "https://service.contoso.com/",
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1THdqcHdBSk9NOW4tQSJ9.eyJhdWQiOiJodHRwczovL3NlcnZpY2UuY29udG9zby5jb20vIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvN2ZlODE0NDctZGE1Ny00Mzg1LWJlY2ItNmRlNTdmMjE0NzdlLyIsImlhdCI6MTM4ODQ0MDg2MywibmJmIjoxMzg4NDQwODYzLCJleHAiOjEzODg0NDQ3NjMsInZlciI6IjEuMCIsInRpZCI6IjdmZTgxNDQ3LWRhNTctNDM4NS1iZWNiLTZkZTU3ZjIxNDc3ZSIsIm9pZCI6IjY4Mzg5YWUyLTYyZmEtNGIxOC05MWZlLTUzZGQxMDlkNzRmNSIsInVwbiI6ImZyYW5rbUBjb250b3NvLmNvbSIsInVuaXF1ZV9uYW1lIjoiZnJhbmttQGNvbnRvc28uY29tIiwic3ViIjoiZGVOcUlqOUlPRTlQV0pXYkhzZnRYdDJFYWJQVmwwQ2o4UUFtZWZSTFY5OCIsImZhbWlseV9uYW1lIjoiTWlsbGVyIiwiZ2l2ZW5fbmFtZSI6IkZyYW5rIiwiYXBwaWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctODkwYS0yNzRhNzJhNzMwOWUiLCJhcHBpZGFjciI6IjAiLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJhY3IiOiIxIn0.JZw8jC0gptZxVC-7l5sFkdnJgP3_tRjeQEPgUn28XctVe3QqmheLZw7QVZDPCyGycDWBaqy7FLpSekET_BftDkewRhyHk9FW_KeEz0ch2c3i08NGNDbr6XYGVayNuSesYk5Aw_p3ICRlUV1bqEwk-Jkzs9EEkQg4hbefqJS6yS1HoV_2EsEhpd_wCQpxK89WPs3hLYZETRJtG5kvCCEOvSHXmDE6eTHGTnEgsIk--UlPe275Dvou4gEAwLofhLDQbMSjnlV5VLsjimNBVcSRFShoxmQwBJR_b2011Y5IuD6St5zPnzruBbZYkGNurQK63TJPWmRd3mbJsGM0mf3CUQ",
  "refresh_token": "AwABAAAAv YNqmf9SoAylD1PycGCB90xzZeEDg6oBzOIPfYsbDWNf621pKo2Q3GGTHYlmNfwoc-OlrxK69hkha2CF12azM_NYhgO668yfcUl4VBbiSHZyd1NVZG5QTIOcbObu3qnLutbpadZGAxqjIbMkQ2bQS09fTrjMBtDE3D6kSMIodpCecoANon9b0LATkpitimVCrl PM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4rTfgV29ghDOHRc2B-C_hHeJaJICqjZ3mY2b_YNqmf9SoAylD1PycGCB90xzZeEDg6oBzOIPfYsbDWNf621pKo2Q3GGTHYlmNfwoc-OlrxK69hkha2CF12azM_NYhgO668yfmVCrl-NyfN3oyG4ZCWu18M9-vEou4Sq-1oMDzExgAf61noxzkNiaTecM-Ve5cq6wHqYQjfV9DOz4lbceuYCAA"
}
```

### <a name="error-response"></a>Απόκριση σφάλμα

Δείγμα απόκριση σφάλματος μπορεί να μοιάζει κάπως έτσι:

```
{
  "error": "invalid_resource",
  "error_description": "AADSTS50001: The application named https://foo.microsoft.com/mail.read was not found in the tenant named 295e01fc-0c56-4ac3-ac57-5d0ed568f872.  This can happen if the application has not been installed by the administrator of the tenant or consented to by any user in the tenant.  You might have sent your authentication request to the wrong tenant.\r\nTrace ID: ef1f89f6-a14f-49de-9868-61bd4072f0a9\r\nCorrelation ID: b6908274-2c58-4e91-aea9-1f6b9c99347c\r\nTimestamp: 2016-04-11 18:59:01Z",
  "error_codes": [
    50001
  ],
  "timestamp": "2016-04-11 18:59:01Z",
  "trace_id": "ef1f89f6-a14f-49de-9868-61bd4072f0a9",
  "correlation_id": "b6908274-2c58-4e91-aea9-1f6b9c99347c"
}
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| Σφάλμα | Μια συμβολοσειρά κωδικό σφάλματος που μπορεί να χρησιμοποιηθεί για την ταξινόμηση των τύπων σφάλματα που προκύπτουν και μπορεί να χρησιμοποιηθεί προκειμένου να αντιμετωπίζεται σφάλματα. |
| error_description | Ένα συγκεκριμένο μήνυμα σφάλματος που μπορεί να σας βοηθήσει ο προγραμματιστής Προσδιορισμός της αρχικής αιτίας ενός σφάλματος ελέγχου ταυτότητας.  |
| error_codes | Μια λίστα STS συγκεκριμένων κωδικών σφάλματος που μπορεί να σας βοηθήσει στη Διαγνωστικά. |
| χρονική σήμανση | Η ώρα κατά την οποία παρουσιάστηκε το σφάλμα. |
| trace_id | Ένα μοναδικό αναγνωριστικό για την αίτηση που μπορούν να σας βοηθήσουν στην Διαγνωστικά.  |
| correlation_id | Ένα μοναδικό αναγνωριστικό για την αίτηση που μπορούν να σας βοηθήσουν στην Διαγνωστικά σε όλα τα στοιχεία.|

Για μια περιγραφή των τους κωδικούς σφάλματος και την ενέργεια συνιστάται προγράμματος-πελάτη, ανατρέξτε στο θέμα [τους κωδικούς σφάλματος για σφάλματα διακριτικού τελικού σημείου](#error-codes-for-token-endpoint-errors).
