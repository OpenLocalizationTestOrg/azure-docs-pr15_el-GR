<properties
    pageTitle="Αρχειοθέτηση το αρχείο καταγραφής της δραστηριότητας Azure | Microsoft Azure"
    description="Μάθετε πώς μπορείτε να αρχειοθετήσετε το αρχείο καταγραφής δραστηριότητας Azure για μακροπρόθεσμες διατήρησης σε ένα λογαριασμό του χώρου αποθήκευσης."
    authors="johnkemnetz"
    manager="rboucher"
    editor=""
    services="monitoring-and-diagnostics"
    documentationCenter="monitoring-and-diagnostics"/>

<tags
    ms.service="monitoring-and-diagnostics"
    ms.workload="na"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="08/23/2016"
    ms.author="johnkem"/>

# <a name="archive-the-azure-activity-log"></a>Αρχειοθέτηση το αρχείο καταγραφής της δραστηριότητας Azure
Σε αυτό το άρθρο, θα σας δείξουμε πώς μπορείτε να χρησιμοποιήσετε την πύλη Azure, cmdlet του PowerShell ή CLI πλατφόρμες για να αρχειοθετήσετε το [**Αρχείο καταγραφής δραστηριοτήτων Azure**](monitoring-overview-activity-logs.md) σε ένα λογαριασμό του χώρου αποθήκευσης. Αυτή η επιλογή είναι χρήσιμη αν θέλετε να διατηρήσετε το αρχείο καταγραφής δραστηριοτήτων περισσότερο από 90 ημέρες (με πλήρη έλεγχο της πολιτικής διατήρησης) για ελέγχου, στατική ανάλυση ή δημιουργία αντιγράφων ασφαλείας. Εάν χρειάζεται να διατηρήσετε τα συμβάντα σας για 90 ημέρες μόνο ή λιγότερο δεν χρειάζεται να ρυθμίσετε αρχειοθέτησης σε ένα λογαριασμό του χώρου αποθήκευσης, επειδή το συμβάντα του αρχείου καταγραφής δραστηριότητας διατηρούνται στην Azure πλατφόρμα για 90 ημέρες χωρίς ενεργοποίηση αρχειοθέτησης.

## <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία
Προτού ξεκινήσετε, πρέπει να [δημιουργήσετε ένα λογαριασμό του χώρου αποθήκευσης](../storage/storage-create-storage-account.md#create-a-storage-account) στο οποίο μπορείτε να αρχειοθετήσετε το αρχείο καταγραφής δραστηριοτήτων. Προτείνουμε να μην χρησιμοποιήσετε έναν υπάρχοντα λογαριασμό του χώρου αποθήκευσης που περιλαμβάνει άλλες, μη παρακολούθηση δεδομένα που είναι αποθηκευμένα σε αυτό, ώστε να μπορείτε να ελέγχετε καλύτερα πρόσβαση σε δεδομένα παρακολούθησης. Ωστόσο, εάν έχετε επίσης αρχειοθέτηση αρχείων καταγραφής διαγνωστικών και μετρήσεις σε ένα λογαριασμό του χώρου αποθήκευσης, μπορεί να νόημα να χρησιμοποιήσετε αυτόν το λογαριασμό χώρου αποθήκευσης για το αρχείο καταγραφής δραστηριοτήτων καθώς και για να διατηρήσετε όλα τα δεδομένα παρακολούθησης σε μια κεντρική θέση. Ο λογαριασμός χώρου αποθήκευσης που χρησιμοποιείτε πρέπει να είναι ένα λογαριασμό χώρου αποθήκευσης γενικής χρήσης, δεν ένα λογαριασμό χώρο αποθήκευσης αντικειμένων blob.

## <a name="log-profile"></a>Αρχείο καταγραφής προφίλ
Για να αρχειοθετήσετε το αρχείο καταγραφής δραστηριότητας χρησιμοποιώντας οποιαδήποτε από τις παρακάτω μεθόδους, μπορείτε να ρυθμίσετε το **Αρχείο καταγραφής προφίλ** για μια συνδρομή. Στο προφίλ του αρχείου καταγραφής καθορίζει τον τύπο των συμβάντων που είναι αποθηκευμένα ή ροής και των εξόδων του — διανομέα λογαριασμό ή/και το συμβάν χώρου αποθήκευσης. Καθορίζει επίσης την πολιτική διατήρησης (αριθμός των ημερών που θέλετε να διατηρούνται) για συμβάντα που είναι αποθηκευμένα σε ένα λογαριασμό του χώρου αποθήκευσης. Εάν η πολιτική διατήρησης έχει οριστεί στην τιμή μηδέν, συμβάντα αποθηκεύονται απεριόριστο χρονικό διάστημα. Διαφορετικά, αυτό μπορεί να οριστεί σε οποιαδήποτε τιμή μεταξύ 1 και 2147483647. [Μπορείτε να διαβάσετε περισσότερα σχετικά με το αρχείο καταγραφής προφίλ εδώ](monitoring-overview-activity-logs.md#export-the-activity-log-with-log-profiles).

## <a name="archive-the-activity-log-using-the-portal"></a>Αρχειοθέτηση το αρχείο καταγραφής δραστηριοτήτων με την πύλη
1. Στην πύλη, κάντε κλικ στη σύνδεση **Log δραστηριότητας** στην αριστερή πλευρά περιήγησης. Εάν δεν βλέπετε μια σύνδεση για το αρχείο καταγραφής της δραστηριότητας, επιλέξτε πρώτα τη σύνδεση **Περισσότερες υπηρεσίες** .

    ![Μεταβείτε στο αρχείο καταγραφής δραστηριοτήτων blade](media/monitoring-archive-activity-log/act-log-portal-navigate.png)
2. Στο επάνω μέρος του blade, κάντε κλικ στην επιλογή **Εξαγωγή**.

    ![Κάντε κλικ στο κουμπί εξαγωγή](media/monitoring-archive-activity-log/act-log-portal-export-button.png)
3. Στο το blade που εμφανίζεται, επιλέξτε το πλαίσιο ελέγχου για **Εξαγωγή σε ένα λογαριασμό του χώρου αποθήκευσης** και επιλέξτε ένα λογαριασμό του χώρου αποθήκευσης.

    ![Ρύθμιση ενός λογαριασμού χώρου αποθήκευσης](media/monitoring-archive-activity-log/act-log-portal-export-blade.png)
4. Χρησιμοποιώντας το ρυθμιστικό ή πλαίσιο κειμένου, ορίστε έναν αριθμό ημερών για την οποία πρέπει να διατηρούνται συμβάντα του αρχείου καταγραφής δραστηριότητας στο λογαριασμό σας στο χώρο αποθήκευσης. Εάν προτιμάτε να έχουν τα δεδομένα σας διατηρηθεί στο λογαριασμό χώρου αποθήκευσης απεριόριστο χρονικό διάστημα, ορίστε αυτόν τον αριθμό με μηδέν.
5. Κάντε κλικ στην επιλογή **Αποθήκευση**.

## <a name="archive-the-activity-log-via-powershell"></a>Αρχειοθέτηση το αρχείο καταγραφής της δραστηριότητας μέσω του PowerShell
```
Add-AzureRmLogProfile -Name my_log_profile -StorageAccountId /subscriptions/s1/resourceGroups/myrg1/providers/Microsoft.Storage/storageAccounts/my_storage -Locations global,westus,eastus -RetentionInDays 180 -Categories Write,Delete,Action
```

| Ιδιότητα         | Απαιτείται | Περιγραφή                                                                                                                                                                                                                                                                                       |
|------------------|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| StorageAccountId | Όχι       | Αναγνωριστικό πόρου του λογαριασμού χώρου αποθήκευσης στην οποία θα πρέπει να αποθηκεύονται τα αρχεία καταγραφής δραστηριότητας.                                                                                                                                                                                                                        |
| Θέσεις        | Ναι      | Διαχωρισμένες με κόμματα λίστα περιοχές για την οποία θέλετε να συλλογή δραστηριότητα καταγραφής συμβάντων. Μπορείτε να προβάλετε μια λίστα με όλες τις περιοχές [με την επίσκεψή σας αυτήν τη σελίδα](https://azure.microsoft.com/en-us/regions) ή με τη χρήση [Του Azure διαχείρισης REST API](https://msdn.microsoft.com/library/azure/gg441293.aspx). |
| RetentionInDays  | Ναι      | Αριθμός των ημερών για τα συμβάντα που θα πρέπει να διατηρηθούν, μεταξύ 1 και 2147483647. Η τιμή μηδέν αποθηκεύει τα αρχεία καταγραφής απεριόριστο χρονικό διάστημα (αιώνες).                                                                                                                                                                                             |
| Κατηγορίες       | Ναι      | Διαχωρισμένες με κόμματα λίστα κατηγοριών συμβάντων που θα πρέπει να συγκεντρώσει. Πιθανές τιμές είναι εγγραφής, διαγραφή και ενέργεια.                                                                                                                                                                                 |
## <a name="archive-the-activity-log-via-cli"></a>Το αρχείο καταγραφής της δραστηριότητας μέσω CLI αρχειοθέτησης
```
azure insights logprofile add --name my_log_profile --storageId /subscriptions/s1/resourceGroups/insights-integration/providers/Microsoft.Storage/storageAccounts/my_storage --locations global,westus,eastus,northeurope --retentionInDays 180 –categories Write,Delete,Action
```

| Ιδιότητα        | Απαιτείται | Περιγραφή                                                                                                                                                                                                                                                                                       |
|-----------------|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Όνομα            | Ναι      | Όνομα του προφίλ σας στο αρχείο καταγραφής.                                                                                                                                                                                                                                                                         |
| storageId       | Όχι       | Αναγνωριστικό πόρου του λογαριασμού χώρου αποθήκευσης στην οποία θα πρέπει να αποθηκεύονται τα αρχεία καταγραφής δραστηριότητας.                                                                                                                                                                                                                        |
| θέσεις       | Ναι      | Διαχωρισμένες με κόμματα λίστα περιοχές για την οποία θέλετε να συλλογή δραστηριότητα καταγραφής συμβάντων. Μπορείτε να προβάλετε μια λίστα με όλες τις περιοχές [με την επίσκεψή σας αυτήν τη σελίδα](https://azure.microsoft.com/en-us/regions) ή με τη χρήση [Του Azure διαχείρισης REST API](https://msdn.microsoft.com/library/azure/gg441293.aspx). |
| retentionInDays | Ναι      | Αριθμός των ημερών για τα συμβάντα που θα πρέπει να διατηρηθούν, μεταξύ 1 και 2147483647. Η τιμή μηδέν θα αποθηκεύσει τα αρχεία καταγραφής απεριόριστο χρονικό διάστημα (αιώνες).                                                                                                                                                                                             |
| κατηγορίες      | Ναι      | Διαχωρισμένες με κόμματα λίστα κατηγοριών συμβάντων που θα πρέπει να συγκεντρώσει. Πιθανές τιμές είναι εγγραφής, διαγραφή και ενέργεια.                                                                                                                                                                                 |

## <a name="storage-schema-of-the-activity-log"></a>Σχήμα χώρου αποθήκευσης του αρχείου καταγραφής της δραστηριότητας
Αφού έχετε ρυθμίσει αρχειοθέτησης, ένα κοντέινερ χώρου αποθήκευσης θα δημιουργηθεί στο λογαριασμό χώρου αποθήκευσης μόλις προκύπτει ένα συμβάν καταγραφής δραστηριότητας. Τα αντικείμενα BLOB μέσα στο κοντέινερ, ακολουθήστε την ίδια μορφοποίηση σε το αρχείο καταγραφής δραστηριοτήτων και αρχεία καταγραφής διαγνωστικών. Η δομή του αυτά τα αντικείμενα BLOB είναι:

> ιδέες-λειτουργικές-αρχεία καταγραφής/name = προεπιλογή/resourceId = / ΣΥΝΔΡΟΜΈΣ / {Αναγνωριστικό συνδρομής} / y = {τετραψήφια αριθμητική έτος} / m = {διψήφια αριθμητική μήνας} / d = {διψήφια αριθμητική ημέρα} / h = {hour}/m=00/PT1H.json διψήφιο 24-ωρης μορφής ώρας

Για παράδειγμα, ένα όνομα blob μπορεί να είναι:

> insights-Operational-Logs/Name=Default/resourceId=/SUBSCRIPTIONS/s1id1234-5679-0123-4567-890123456789/y=2016/m=08/d=22/h=18/m=00/PT1H.JSON

Κάθε blob PT1H.json περιέχει ένα blob JSON συμβάντων που έγιναν κατά την ώρα που καθορίζεται στη διεύθυνση URL blob (π.χ. h = 12). Κατά την παρουσίαση ώρα, θα προσαρτηθούν συμβάντα στο αρχείο PT1H.json, καθώς προκύπτουν. Η τιμή minute (m = 00) είναι πάντα 00, επειδή το αρχείο καταγραφής δραστηριοτήτων συμβάντα είναι εσφαλμένος σε μεμονωμένα αντικείμενα BLOB ανά ώρα.

Μέσα στο αρχείο PT1H.json, κάθε συμβάντος αποθηκεύεται στον πίνακα "εγγραφές", ακολουθώντας αυτήν τη μορφή:

```
{
    "records": [
        {
            "time": "2015-01-21T22:14:26.9792776Z",
            "resourceId": "/subscriptions/s1/resourceGroups/MSSupportGroup/providers/microsoft.support/supporttickets/115012112305841",
            "operationName": "microsoft.support/supporttickets/write",
            "category": "Write",
            "resultType": "Success",
            "resultSignature": "Succeeded.Created",
            "durationMs": 2826,
            "callerIpAddress": "111.111.111.11",
            "correlationId": "c776f9f4-36e5-4e0e-809b-c9b3c3fb62a8",
            "identity": {
                "authorization": {
                    "scope": "/subscriptions/s1/resourceGroups/MSSupportGroup/providers/microsoft.support/supporttickets/115012112305841",
                    "action": "microsoft.support/supporttickets/write",
                    "evidence": {
                        "role": "Subscription Admin"
                    }
                },
                "claims": {
                    "aud": "https://management.core.windows.net/",
                    "iss": "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/",
                    "iat": "1421876371",
                    "nbf": "1421876371",
                    "exp": "1421880271",
                    "ver": "1.0",
                    "http://schemas.microsoft.com/identity/claims/tenantid": "1e8d8218-c5e7-4578-9acc-9abbd5d23315 ",
                    "http://schemas.microsoft.com/claims/authnmethodsreferences": "pwd",
                    "http://schemas.microsoft.com/identity/claims/objectidentifier": "2468adf0-8211-44e3-95xq-85137af64708",
                    "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn": "admin@contoso.com",
                    "puid": "20030000801A118C",
                    "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier": "9vckmEGF7zDKk1YzIY8k0t1_EAPaXoeHyPRn6f413zM",
                    "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname": "John",
                    "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname": "Smith",
                    "name": "John Smith",
                    "groups": "cacfe77c-e058-4712-83qw-f9b08849fd60,7f71d11d-4c41-4b23-99d2-d32ce7aa621c,31522864-0578-4ea0-9gdc-e66cc564d18c",
                    "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name": " admin@contoso.com",
                    "appid": "c44b4083-3bq0-49c1-b47d-974e53cbdf3c",
                    "appidacr": "2",
                    "http://schemas.microsoft.com/identity/claims/scope": "user_impersonation",
                    "http://schemas.microsoft.com/claims/authnclassreference": "1"
                }
            },
            "level": "Information",
            "location": "global",
            "properties": {
                "statusCode": "Created",
                "serviceRequestId": "50d5cddb-8ca0-47ad-9b80-6cde2207f97c"
            }
        }
    ]
}
```


| Όνομα στοιχείου    | Περιγραφή                                                                                                    |
|-----------------|----------------------------------------------------------------------------------------------------------------|
| ώρα            | Χρονική σήμανση όταν δημιουργήθηκε το συμβάν από την υπηρεσία Azure επεξεργασία της αίτησης που αντιστοιχεί στο συμβάν.    |
| resourceId      | Αναγνωριστικό πόρου του επηρεαζόμενη πόρου.                                                                          |
| operationName   | Όνομα της λειτουργίας.                                                                                         |
| κατηγορία        | Κατηγορία της ενέργειας, π.χ. Εγγραφή, ανάγνωση, ενέργεια.                                                               |
| resultType      | Ο τύπος του αποτελέσματος, π.χ. Επιτυχία, αποτυχία, Έναρξη                                                            |
| resultSignature | Εξαρτάται από τον τύπο του πόρου.                                                                                  |
| durationMs      | Διάρκεια της λειτουργίας σε χιλιοστά του δευτερολέπτου                                                                      |
| callerIpAddress | Διεύθυνση IP του χρήστη που έχει εκτελεστεί η λειτουργία, UPN διεκδίκηση ή με βάση τη διαθεσιμότητα διεκδίκηση κύριο όνομα Υπηρεσίας.         |
| correlationId   | Συνήθως ένα GUID σε μορφή συμβολοσειράς. Τα συμβάντα που μοιράζονται ένα correlationId ανήκει σε την ίδια ενέργεια uber.         |
| ταυτότητα        | JSON blob που περιγράφει την εξουσιοδότηση και αξιώσεων.                                                             |
| εξουσιοδότηση   | BLOB RBAC ιδιοτήτων του συμβάντος. Συνήθως περιλαμβάνει τις ιδιότητες "ενέργεια", "ρόλος" και "εύρος".            |
| επίπεδο           | Επίπεδο του συμβάντος. Μία από τις παρακάτω τιμές: "Κρίσιμη", "Σφάλμα", "Προειδοποίηση", "Ενημερωτικό" και "Λεπτομερές" |
| θέση        | Περιοχή στην οποία παρουσιάστηκε στη θέση (ή καθολικός).                                                             |
| Ιδιότητες      | Ορισμός της `<Key, Value>` ζεύγη (δηλαδή λεξικό) που περιγράφει τις λεπτομέρειες του συμβάντος.                             |

> [AZURE.NOTE] Η ιδιότητες και η χρήση της αυτές τις ιδιότητες μπορεί να διαφέρουν ανάλογα με τον πόρο.

## <a name="next-steps"></a>Επόμενα βήματα
- [Λήψη αντικείμενα BLOB για την ανάλυση](../storage/storage-dotnet-how-to-use-blobs.md#download-blobs)
- [Ροή το αρχείο καταγραφής δραστηριοτήτων με διανομείς συμβάντος](monitoring-stream-activity-logs-event-hubs.md)
- [Διαβάστε περισσότερα σχετικά με το αρχείο καταγραφής της δραστηριότητας](monitoring-overview-activity-logs.md)
