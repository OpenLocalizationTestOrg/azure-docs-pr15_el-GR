<properties
    pageTitle="Μετεγκατάσταση στο χώρο αποθήκευσης Azure Premium | Microsoft Azure"
    description="Μετεγκατάσταση του υπάρχοντος εικονικές μηχανές στο χώρο αποθήκευσης Premium Azure. Χώρος αποθήκευσης Premium προσφέρει υποστήριξη υψηλών επιδόσεων, χαμηλής αδράνειας δίσκου για να/O-εντατική φόρτους εργασίας εκτελούνται σε εικονικές μηχανές Windows Azure."
    services="storage"
    documentationCenter="na"
    authors="aungoo-msft"
    manager="tadb"
    editor="tysonn"/>

<tags
    ms.service="storage"
    ms.workload="storage"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/21/2016"
    ms.author="yuemlu"/>


# <a name="migrating-to-azure-premium-storage"></a>Μετεγκατάσταση στο χώρο αποθήκευσης Azure Premium

## <a name="overview"></a>Επισκόπηση

Azure Premium αποθήκευσης παρέχει υποστήριξη υψηλών επιδόσεων, χαμηλής αδράνειας δισκέτα για εικονικές μηχανές εκτελούνται φόρτους εργασίας να/O-εντατική. Μπορείτε να επωφεληθείτε από την ταχύτητα και τις επιδόσεις του αυτών των δίσκων κατά τη μετεγκατάσταση δίσκων Εικονική της εφαρμογής σας στο χώρο αποθήκευσης Premium Azure.

Είναι το σκοπό αυτού του οδηγού για να τους νέους χρήστες του χώρου αποθήκευσης Premium Azure καλύτερη προετοιμασία για να κάνετε ομαλή μετάβαση από το τρέχον σύστημα με το χώρο αποθήκευσης Premium. Ο οδηγός διευθύνσεις τρεις από τα βασικά στοιχεία σε αυτήν τη διαδικασία: 

  - [Σχεδιασμός για τη μετεγκατάσταση με το χώρο αποθήκευσης Premium](#plan-the-migration-to-premium-storage)
  - [Προετοιμασία και αντιγράψτε εικονικού σκληρού δίσκων (VHD) με το χώρο αποθήκευσης Premium](#prepare-and-copy-virtual-hard-disks-VHDs-to-premium-storage)
  - [Δημιουργία Azure εικονική μηχανή χρησιμοποιώντας Premium χώρου αποθήκευσης](#create-azure-virtual-machine-using-premium-storage)

Μπορείτε να μετεγκαταστήσετε ΣΠΣ από άλλες πλατφόρμες στο χώρο αποθήκευσης Premium Azure ή να μετεγκατάσταση υπάρχοντος ΣΠΣ Azure από τυπική χώρου αποθήκευσης με το χώρο αποθήκευσης Premium. Αυτός ο οδηγός καλύπτει τα βήματα για δύο δύο σενάρια. Ακολουθήστε τα βήματα που καθορίζονται στην ενότητα σχετικές ανάλογα με το σενάριό σας.

>[AZURE.NOTE] Μπορείτε να βρείτε μια επισκόπηση των δυνατοτήτων και τις πληροφορίες τιμολόγησης Premium χώρου αποθήκευσης στο χώρο αποθήκευσης Premium: [Χώρος αποθήκευσης υψηλών επιδόσεων για φόρτους εργασίας εικονική μηχανή Azure](storage-premium-storage.md). Συνιστάται να τη μετεγκατάσταση οποιονδήποτε δίσκο εικονικό μηχάνημα που απαιτούν υψηλή IOP Προέλευσης με το χώρο αποθήκευσης Premium Azure για καλύτερες επιδόσεις για την εφαρμογή σας. Εάν σας δίσκου δεν απαιτεί υψηλή IOP Προέλευσης, μπορείτε να περιορίσετε κόστους, διατηρώντας το σε τυπική χώρο αποθήκευσης, η οποία αποθηκεύει δεδομένα δίσκου εικονική μηχανή σε μονάδες σκληρού δίσκου (σκληροί), αντί να SSD.

Ολοκλήρωση της διαδικασίας μετεγκατάστασης στο σύνολό μπορεί να απαιτεί πρόσθετες ενέργειες πριν και μετά τα βήματα που περιγράφονται σε αυτόν τον οδηγό. Παραδείγματα τη ρύθμιση των παραμέτρων εικονικού δίκτυα ή τα τελικά σημεία ή να κάνουν αλλαγές κώδικα μέσα την ίδια την εφαρμογή που μπορεί να απαιτούν ορισμένες χρόνου εκτός λειτουργίας στην εφαρμογή σας. Αυτές οι ενέργειες είναι μοναδικές για κάθε εφαρμογή και θα πρέπει να ολοκληρώσετε τις μαζί με τα βήματα που περιγράφονται σε αυτόν τον οδηγό για να κάνετε τη μετάβαση πλήρους Premium αποθήκευσης ως απρόσκοπτη όσο το δυνατόν πιο.


## <a name="plan-the-migration-to-premium-storage"></a>Σχεδιασμός για τη μετεγκατάσταση με το χώρο αποθήκευσης Premium

Αυτή η ενότητα εξασφαλίζει ότι είστε έτοιμοι να ακολουθήσετε τα βήματα μετεγκατάστασης σε αυτό το άρθρο και σάς βοηθά να είναι η καλύτερη απόφαση Εικονική και δίσκου τύπων.

### <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία
- Θα χρειαστείτε μια συνδρομή του Azure. Εάν δεν έχετε, μπορείτε να δημιουργήσετε μια συνδρομή ενός μήνα [δωρεάν δοκιμαστική έκδοση](https://azure.microsoft.com/pricing/free-trial/) ή να επισκεφθείτε [Τις τιμές Azure](https://azure.microsoft.com/pricing/) για περισσότερες επιλογές.
- Για να εκτελέσετε τα cmdlet του PowerShell, θα χρειαστεί της λειτουργικής μονάδας Microsoft Azure PowerShell. Δείτε [πώς μπορείτε να εγκαταστήσετε και να ρυθμίσετε τις παραμέτρους του PowerShell Azure](../powershell-install-configure.md) για τις οδηγίες εγκατάστασης σημείου και εγκατάστασης.
- Όταν σχεδιάζετε να χρησιμοποιήσετε ΣΠΣ Azure που εκτελούνται στο χώρο αποθήκευσης Premium, πρέπει να χρησιμοποιήσετε το ΣΠΣ με δυνατότητα αποθήκευσης Premium. Μπορείτε να χρησιμοποιήσετε τυπικές και αποθήκευσης Premium δίσκων με ΣΠΣ με δυνατότητα αποθήκευσης Premium. Premium δίσκων χώρου αποθήκευσης θα είναι διαθέσιμο με περισσότεροι τύποι Εικονική στο μέλλον. Για περισσότερες πληροφορίες σε όλες τις διαθέσιμες Εικονική Azure δίσκου τύπους και μεγέθη, ανατρέξτε στο θέμα [μεγέθη για εικονικές μηχανές](../virtual-machines/virtual-machines-windows-sizes.md) και τα [μεγέθη για τις υπηρεσίες Cloud](../cloud-services/cloud-services-sizes-specs.md).

### <a name="considerations"></a>Ζητήματα

Εικονική μηχανή Azure υποστηρίζει επισύναψη διάφορες δίσκων Premium χώρου αποθήκευσης, έτσι ώστε οι εφαρμογές σας μπορεί να έχει έως 64 TB χώρου αποθήκευσης ανά Εικονική. Με το χώρο αποθήκευσης Premium, τις εφαρμογές σας να επιτύχετε 80.000 IOP Προέλευσης (λειτουργίες εισαγωγής/εξαγωγής ανά δευτερόλεπτο) ανά Εικονική και 2000 MB ανά δεύτερη ταχύτητα μεταγωγής του δίσκου ανά Εικονική με πολύ χαμηλή των αδρανειών για λειτουργίες ανάγνωσης. Έχετε επιλογές σε μια ποικιλία ΣΠΣ και δίσκων. Αυτή η ενότητα είναι να σας βοηθήσει να βρείτε μια επιλογή που ταιριάζει καλύτερα με το φόρτο εργασίας.

#### <a name="vm-sizes"></a>Εικονική μεγέθη
Οι προδιαγραφές μέγεθος Εικονική Azure παρατίθενται σε [μεγέθη για εικονικές μηχανές](../virtual-machines/virtual-machines-windows-sizes.md). Αναθεωρήστε τα χαρακτηριστικά των εικονικές μηχανές που λειτουργούν με το χώρο αποθήκευσης Premium και επιλέξτε το πιο κατάλληλο μέγεθος Εικονική που ταιριάζει καλύτερα με το φόρτο εργασίας επιδόσεων. Βεβαιωθείτε ότι υπάρχει επαρκές εύρος ζώνης στη Εικονική σας να οδηγεί η κυκλοφορία του δίσκου.


#### <a name="disk-sizes"></a>Μεγέθη δίσκων
Υπάρχουν τρεις τύποι δίσκων που μπορούν να χρησιμοποιηθούν με Εικονική σας και το καθένα έχει συγκεκριμένες IOP και απόδοση όρια. Λάβετε υπόψη τα παρακάτω όρια όταν επιλέγοντας τον τύπο του δίσκου για την Εικονική ανάλογα με τις ανάγκες της εφαρμογής σας όσον αφορά την ικανότητα, επιδόσεων, κλιμάκωση και φορτώνει κορύφωσης.

|Τύπος δίσκου αποθήκευσης Premium|P10|Ρ20|P30|
|:---:|:---:|:---:|:---:|
|Μέγεθος δίσκου|128 GB|512 GB|1024 GB (1 TB)|
|IOP Προέλευσης ανά δίσκο|500|2300|5000|
|Μετάδοσης ανά δίσκο|100 MB ανά δευτερόλεπτο|150 MB ανά δευτερόλεπτο|200 MB ανά δευτερόλεπτο|

Ανάλογα με το φόρτο εργασίας, να καθορίσετε εάν είναι απαραίτητες για την Εικονική δίσκων πρόσθετα δεδομένα. Μπορείτε να επισυνάψετε διάφορες μόνιμη δεδομένων δίσκων σας Εικονική. Εάν είναι απαραίτητο, να διαγραμμίσεων κατά μήκος των δίσκων για να αυξήσετε τη χωρητικότητα και τις επιδόσεις του όγκου. (Ανατρέξτε στο θέμα τι είναι το δίσκο επιμερισμό [εδώ](storage-premium-storage-performance.md#disk-striping).) Εάν έχετε διαγραμμίσεων Premium χώρος αποθήκευσης δεδομένων δίσκων με χρήση [Χώροι αποθήκευσης][4], θα πρέπει να τη ρυθμίσετε με μία μόνο στήλη για κάθε δίσκο που χρησιμοποιείται. Διαφορετικά, τη συνολική απόδοση του όγκου ραβδωτό ενδέχεται να είναι χαμηλότερη από την αναμενόμενη λόγω άνιση κατανομή της κυκλοφορίας κατά μήκος των δίσκων. Για ΣΠΣ Linux μπορείτε να χρησιμοποιήσετε το βοηθητικό πρόγραμμα *mdadm* για να επιτύχετε το ίδιο. Ανατρέξτε στο άρθρο [Ρύθμιση παραμέτρων RAID λογισμικού σε Linux](../virtual-machines/virtual-machines-linux-configure-raid.md) για λεπτομέρειες.

#### <a name="storage-account-scalability-targets"></a>Προορισμών κλιμάκωση λογαριασμού χώρου αποθήκευσης
Οι λογαριασμοί του χώρου αποθήκευσης Premium έχουν των ακόλουθων στόχων κλιμάκωση εκτός από το [Azure κλιμάκωση χώρου αποθήκευσης και τους στόχους επιδόσεων](storage-scalability-targets.md). Εάν απαιτήσεις της εφαρμογής σας πρέπει να υπερβαίνει τους στόχους κλιμάκωση ενός λογαριασμού μόνο χώρου αποθήκευσης, δημιουργήστε την εφαρμογή σας να χρησιμοποιεί πολλούς λογαριασμούς χώρου αποθήκευσης και διαμερισμάτων των δεδομένων σας σε αυτούς τους λογαριασμούς χώρου αποθήκευσης.

|Σύνολο λογαριασμού χωρητικότητα|Συνολικού εύρους ζώνης για ένα λογαριασμό τοπικά πλεονάζοντα χώρου αποθήκευσης|
|:--|:---|
|Δίσκο χωρητικότητα: 35TB<br />Στιγμιότυπο χωρητικότητα: 10 TB|Έως και 50 gigabits ανά δευτερόλεπτο για εισερχόμενα + εξαγωγής|

Για περισσότερες πληροφορίες στο χώρο αποθήκευσης Premium προδιαγραφές, ανατρέξτε στο θέμα [κλιμάκωση και τους στόχους επιδόσεων κατά τη χρήση του χώρου αποθήκευσης Premium](storage-premium-storage.md#scalability-and-performance-targets-when-using-premium-storage).

#### <a name="disk-caching-policy"></a>Πολιτική σε cache στο δίσκο
Από προεπιλογή, δίσκος σε cache πολιτικής είναι *Μόνο για ανάγνωση* για όλα τα δεδομένα Premium δίσκων "και" *Ανάγνωση και εγγραφή* για το δίσκο Premium λειτουργικό σύστημα που έχουν επισυναφθεί σε η Εικονική. Αυτή η ρύθμιση παραμέτρων συνιστάται να επιτύχετε τη βέλτιστη απόδοση για IOs της εφαρμογής σας. Για δεδομένα εγγραφής χοντρό ή μόνο για εγγραφή δίσκων (όπως αρχεία καταγραφής του SQL Server), απενεργοποίηση προσωρινή αποθήκευση στο δίσκο, έτσι ώστε να μπορείτε να επιτύχετε καλύτερες επιδόσεις εφαρμογής. Ρυθμίσεις cache για υπάρχοντα δεδομένα δίσκων μπορεί να ενημερωθεί με τη χρήση [Πύλη Azure](https://portal.azure.com) ή την παράμετρο *- HostCaching* από το cmdlet *Set-AzureDataDisk* .

#### <a name="location"></a>Θέση
Επιλέξτε μια θέση όπου είναι διαθέσιμο το χώρο αποθήκευσης Premium Azure. Ανατρέξτε στο θέμα [Υπηρεσίες Azure ανά περιοχή](https://azure.microsoft.com/regions/#services) για ενημερωμένες πληροφορίες για τις διαθέσιμες θέσεις. ΣΠΣ που βρίσκεται στην ίδια περιοχή με το λογαριασμό χώρου αποθήκευσης που αποθηκεύει τα δίσκων για την εικονική Μηχανή θα σας δώσει όγκο καλύτερες επιδόσεις από εάν βρίσκονται σε ξεχωριστές περιοχές.

#### <a name="other-azure-vm-configuration-settings"></a>Άλλες ρυθμίσεις παραμέτρων Εικονική Azure
Όταν δημιουργείτε μια Εικονική Azure, θα σας ζητηθεί να ρυθμίσετε τις παραμέτρους ορισμένες ρυθμίσεις Εικονική. Να θυμάστε ότι μερικές ρυθμίσεις είναι σταθερές για τη διάρκεια ζωής του η Εικονική, ενώ μπορείτε να τροποποιήσετε ή να προσθέσετε άλλους αργότερα. Ελέγξτε αυτές τις ρυθμίσεις παραμέτρων Εικονική Azure και βεβαιωθείτε ότι αυτές έχουν ρυθμιστεί σωστά ώστε να ταιριάζει με τις απαιτήσεις φόρτου εργασίας σας.

### <a name="optimization"></a>Βελτιστοποίηση

[Αποθήκευσης Premium azure: Σχεδίαση για υψηλές επιδόσεις](storage-premium-storage-performance.md) παρέχει οδηγίες για τη δημιουργία υψηλών επιδόσεων εφαρμογών χρησιμοποιώντας αποθήκευσης Premium Azure. Μπορείτε να ακολουθήσετε τις οδηγίες που συνδυάζονται με τις επιδόσεις βέλτιστες πρακτικές που ισχύουν για τις τεχνολογίες που χρησιμοποιούνται από την εφαρμογή σας.


## <a name="prepare-and-copy-virtual-hard-disks-VHDs-to-premium-storage"></a>Προετοιμασία και αντιγράψτε εικονικού σκληρού δίσκων (VHD) με το χώρο αποθήκευσης Premium

Η παρακάτω ενότητα παρέχει οδηγίες για την προετοιμασία VHD από την Εικονική και αντιγραφή VHD στο χώρο αποθήκευσης Azure.

- [Σενάριο 1: "να τη μετεγκατάσταση υπάρχοντος Azure ΣΠΣ με το χώρο αποθήκευσης Azure Premium."](#scenario1)
- [Σενάριο 2: "να μετεγκατάσταση ΣΠΣ από άλλες πλατφόρμες με το χώρο αποθήκευσης Azure Premium."](#scenario2)

### <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

Για να προετοιμάσετε το VHD για μετεγκατάσταση, θα πρέπει:

- Μια συνδρομή του Azure, ένα λογαριασμό του χώρου αποθήκευσης και ένα κοντέινερ σε αυτόν το λογαριασμό χώρου αποθήκευσης στο οποίο μπορείτε να αντιγράψετε τον VHD. Σημειώστε ότι το λογαριασμό χώρου αποθήκευσης προορισμού μπορεί να είναι μια τυπική ή χώρο αποθήκευσης Premium λογαριασμό ανάλογα με τις απαιτήσεις σας.
- Ένα εργαλείο γενίκευσης VHD εάν σκοπεύετε να δημιουργήσετε πολλές παρουσίες Εικονική από αυτό. Για παράδειγμα, sysprep για Windows ή μέλους Εικον-sysprep για Ubuntu.
- Ένα εργαλείο για να αποστείλετε το αρχείο VHD με το λογαριασμό χώρου αποθήκευσης. Ανατρέξτε στο θέμα [μεταφορά δεδομένων με το βοηθητικό πρόγραμμα γραμμής εντολών AzCopy](storage-use-azcopy.md) ή χρησιμοποιήστε μια [explorer Azure χώρου αποθήκευσης](http://blogs.msdn.com/b/windowsazurestorage/archive/2014/03/11/windows-azure-storage-explorers-2014.aspx). Αυτός ο οδηγός περιγράφει αντιγραφή σας VHD χρησιμοποιώντας το εργαλείο AzCopy.

> [AZURE.NOTE] Εάν ενεργοποιήσετε την επιλογή σύγχρονη αντίγραφο με AzCopy, για βέλτιστη απόδοση, αντιγράψτε τον VHD, εκτελώντας το ένα από αυτά τα εργαλεία από μια Εικονική Azure που βρίσκεται στην ίδια περιοχή με το λογαριασμό χώρου αποθήκευσης προορισμού. Εάν θέλετε να αντιγράψετε έναν VHD από μια Εικονική Azure σε διαφορετική περιοχή, ενδέχεται να είναι χαμηλότερες των επιδόσεων.
>
> Για την αντιγραφή σε μεγάλο όγκο δεδομένων μέσω περιορισμένο εύρος ζώνης, εξετάστε το ενδεχόμενο [με την υπηρεσία Azure εισαγωγή/εξαγωγή για να μεταφέρετε δεδομένα στο χώρο αποθήκευσης αντικειμένων Blob](storage-import-export-service.md); Αυτό σας επιτρέπει να μεταφέρετε τα δεδομένα σας με αποστολής μονάδες σκληρού δίσκου σε ένα κέντρο δεδομένων του Azure. Μπορείτε να χρησιμοποιήσετε την υπηρεσία Azure εισαγωγή/εξαγωγή για να αντιγράψετε δεδομένα μόνο σε λογαριασμό τυπική χώρου αποθήκευσης. Μόλις τα δεδομένα στο λογαριασμό σας τυπική χώρου αποθήκευσης, μπορείτε να χρησιμοποιήσετε το [API Blob αντιγραφή](https://msdn.microsoft.com/library/azure/dd894037.aspx) ή AzCopy για να μεταφέρετε τα δεδομένα στο λογαριασμό σας premium χώρου αποθήκευσης.
>
> Σημειώστε ότι το Microsoft Azure υποστηρίζει μόνο αρχεία VHD σταθερό μέγεθος. Αρχεία VHDX ή δυναμικής VHD δεν υποστηρίζονται. Εάν έχετε μια δυναμική VHD, μπορείτε να το μετατρέψετε σε σταθερό μέγεθος χρησιμοποιώντας το cmdlet [VHD μετατροπή](http://technet.microsoft.com/library/hh848454.aspx) .

### <a name="scenario1"></a>Σενάριο 1: "να τη μετεγκατάσταση υπάρχοντος Azure ΣΠΣ με το χώρο αποθήκευσης Azure Premium."

Εάν κάνετε μετεγκατάσταση υπάρχοντος ΣΠΣ Azure, διακόψετε την εικονική Μηχανή Προετοιμασία VHD ανά τον τύπο του VHD που θέλετε και, στη συνέχεια, αντιγράψτε τον VHD με AzCopy ή PowerShell.

Η Εικονική πρέπει να είναι πλήρως προς τα κάτω για να μετεγκαταστήσετε μια καθαρή κατάσταση. Θα υπάρξει ένα χρόνου εκτός λειτουργίας μέχρι να ολοκληρωθεί η μετεγκατάσταση.

#### <a name="step-1-prepare-vhds-for-migration"></a>Βήμα 1. Προετοιμασία VHD για μετεγκατάσταση

Αν κάνετε μετεγκατάσταση υπάρχοντος ΣΠΣ Azure με το χώρο αποθήκευσης Premium, μπορεί να σας VHD:

- Μια εικόνα γενικευμένη λειτουργικό σύστημα
- Ένα δίσκο μοναδικό λειτουργικό σύστημα
- Ένα δίσκο δεδομένων

Παρακάτω θα σας καθοδηγήσουμε σε αυτά τα σενάρια 3 για την προετοιμασία VHD σας.

##### <a name="use-a-generalized-operating-system-vhd-to-create-multiple-vm-instances"></a>Χρησιμοποιήστε έναν γενικευμένη VHD λειτουργικό σύστημα για να δημιουργήσετε πολλές παρουσίες Εικονική

Εάν στέλνετε VHD που θα χρησιμοποιηθεί για τη δημιουργία πολλών παρουσιών Εικονική Azure γενικής χρήσης, μπορείτε πρώτα πρέπει να γενίκευση VHD χρησιμοποιώντας ένα βοηθητικό πρόγραμμα sysprep. Αυτό ισχύει για VHD που βρίσκεται στην εσωτερική εγκατάσταση είτε στο cloud. Sysprep καταργεί τις πληροφορίες για το συγκεκριμένο υπολογιστή από τον VHD.

>[AZURE.IMPORTANT] Να καταγράψετε ένα στιγμιότυπο ή δημιουργία αντιγράφων ασφαλείας σας Εικονική πριν από την γενίκευση. Εκτελείται sysprep θα σταματήσει και εκχώρηση την παρουσία Εικονική. Ακολουθήστε τα παρακάτω βήματα για να sysprep VHD λειτουργικό σύστημα Windows. Σημειώστε ότι η εκτέλεση της εντολής Sysprep θα απαιτούν να τερματίσετε την εικονική μηχανή. Για περισσότερες πληροφορίες σχετικά με το Sysprep, ανατρέξτε στο θέμα [Επισκόπηση Sysprep](http://technet.microsoft.com/library/hh825209.aspx) ή [Τεχνική αναφορά του Sysprep](http://technet.microsoft.com/library/cc766049.aspx).

1. Ανοίξτε ένα παράθυρο γραμμής εντολών ως διαχειριστής.
2. Πληκτρολογήστε την παρακάτω εντολή για να ανοίξετε Sysprep:

        %windir%\system32\sysprep\sysprep.exe

3. Στο εργαλείο προετοιμασίας συστήματος, επιλέξτε Εισαγωγή συστήματος της πρώτης εμπειρία (OOBE), επιλέξτε το πλαίσιο ελέγχου Generalize, επιλέξτε **τον τερματισμό**και, στη συνέχεια, κάντε κλικ στο **κουμπί OK**, όπως φαίνεται στην παρακάτω εικόνα. Sysprep θα γενίκευση το λειτουργικό σύστημα και τερματισμός λειτουργίας του συστήματος.

    ![][1]

Για μια Εικονική Ubuntu, χρησιμοποιήστε μέλους Εικον sysprep για να επιτύχετε το ίδιο. Ανατρέξτε στο θέμα [μέλους Εικον sysprep](http://manpages.ubuntu.com/manpages/precise/man1/virt-sysprep.1.html) για περισσότερες λεπτομέρειες. Δείτε επίσης ορισμένες από την ανοιχτή προέλευση [Linux διακομιστή παροχής λογισμικού](http://www.cyberciti.biz/tips/server-provisioning-software.html) για άλλα λειτουργικά συστήματα Linux.

##### <a name="use-a-unique-operating-system-vhd-to-create-a-single-vm-instance"></a>Χρησιμοποιήστε ένα μοναδικό VHD λειτουργικό σύστημα για να δημιουργήσετε μια μεμονωμένη παρουσία Εικονική

Εάν έχετε μια εφαρμογή που εκτελείται σε η Εικονική που απαιτεί των συγκεκριμένων δεδομένων υπολογιστή, δεν γενίκευση VHD. Ένα μη γενίκευση VHD μπορεί να χρησιμοποιηθεί για να δημιουργήσετε μια μοναδικά παρουσία Εικονική Azure. Για παράδειγμα, εάν έχετε ελεγκτή τομέα σε σας VHD, εκτέλεση sysprep θα κάνει ανενεργή ως ελεγκτή τομέα. Αναθεώρηση των εφαρμογών που εκτελούνται σε Εικονική σας και την επίδραση των εκτέλεση του sysprep σε αυτά πριν γενίκευση VHD.

##### <a name="register-data-disk-vhd"></a>Καταχώρηση δεδομένων δίσκου VHD

Εάν έχετε δεδομένα δίσκων στο Azure προς μετεγκατάσταση, πρέπει να βεβαιωθείτε τερματίζονται του ΣΠΣ που χρησιμοποιούν αυτών των δίσκων δεδομένων.

Ακολουθήστε τα βήματα που περιγράφονται παρακάτω για να αντιγράψετε VHD με το χώρο αποθήκευσης Premium Azure και να καταχωρήσετε ως ένα δίσκο προμήθεια του φακέλου δεδομένων.

#### <a name="step-2-create-the-destination-for-your-vhd"></a>Βήμα 2. Δημιουργήστε τον προορισμό για τις VHD

Δημιουργία λογαριασμού χώρου αποθήκευσης για τη διατήρηση του VHD. Κατά το σχεδιασμό πού να αποθηκεύσει το VHD, λάβετε υπόψη τα εξής σημεία:

- Ο προορισμός αποθήκευσης άρτιο.
- Η θέση αποθήκευσης για το λογαριασμό πρέπει να είναι ίδια με το χώρο αποθήκευσης Premium με δυνατότητα Azure ΣΠΣ θα δημιουργήσετε με το τελικό στάδιο. Ενδέχεται να μπορείτε να αντιγράψετε σε ένα νέο λογαριασμό του χώρου αποθήκευσης, ή ένα σχέδιο για να χρησιμοποιήσετε τον ίδιο λογαριασμό χώρου αποθήκευσης με βάση τις ανάγκες σας.
- Αντιγραφή και αποθηκεύσετε το κλειδί λογαριασμού χώρου αποθήκευσης του λογαριασμού χώρου αποθήκευσης προορισμού για το επόμενο στάδιο.

Για δίσκων δεδομένων, μπορείτε να επιλέξετε να διατηρήσετε ορισμένων δίσκων δεδομένων σε ένα λογαριασμό τυπική χώρου αποθήκευσης (για παράδειγμα, δίσκων που έχουν πιο ψυχρή χώρο αποθήκευσης), αλλά συνιστάται ιδιαίτερα να μετακινήσετε όλα τα δεδομένα για παραγωγής φόρτο εργασίας για να χρησιμοποιήσετε premium χώρου αποθήκευσης.

#### <a name="copy-vhd-with-azcopy-or-powershell"></a>Βήμα 3. Αντιγραφή VHD με AzCopy ή PowerShell

Θα πρέπει να βρείτε κοντέινερ διαδρομή και το χώρο αποθήκευσης το κλειδί λογαριασμού σας να επεξεργαστεί οποιαδήποτε από αυτές τις δύο επιλογές. Μπορείτε να βρείτε κοντέινερ διαδρομή και το χώρο αποθήκευσης κλειδί λογαριασμού στην **Πύλη Azure** > **χώρου αποθήκευσης**. Η διεύθυνση URL κοντέινερ θα όπως "https://myaccount.blob.core.windows.net/mycontainer/".

##### <a name="option-1-copy-a-vhd-with-azcopy-asynchronous-copy"></a>Επιλογή 1: Αντιγραφή ενός VHD με AzCopy (ασύγχρονης αντίγραφο)

Χρήση AzCopy, μπορείτε να αποστείλετε εύκολα VHD μέσω του Internet. Ανάλογα με το μέγεθος του VHD, ίσως χρειαστούν χρόνο. Να θυμάστε ότι για να ελέγξετε τα όρια χώρου αποθήκευσης λογαριασμό εισόδου/εξόδου, όταν χρησιμοποιείτε αυτήν την επιλογή. Ανατρέξτε στο θέμα [Azure κλιμάκωση χώρου αποθήκευσης και τους στόχους επιδόσεων](storage-scalability-targets.md) για λεπτομέρειες.

1. Λήψη και εγκατάσταση του AzCopy από εδώ: [πιο πρόσφατη έκδοση του AzCopy](http://aka.ms/downloadazcopy)
2. Ανοίξτε το Azure PowerShell και μεταβείτε στο φάκελο όπου είναι εγκατεστημένο το AzCopy.
3. Χρησιμοποιήστε την παρακάτω εντολή για να αντιγράψετε το αρχείο VHD από "Προέλευση" "Προορισμού".

        AzCopy /Source: <source> /SourceKey: <source-account-key> /Dest: <destination> /DestKey: <dest-account-key> /BlobType:page /Pattern: <file-name>

    Παράδειγμα:

        AzCopy /Source:https://sourceaccount.blob.core.windows.net/mycontainer1 /SourceKey:key1 /Dest:https://destaccount.blob.core.windows.net/mycontainer2 /DestKey:key2 /Pattern:abc.vhd

    Ακολουθούν περιγραφές για τις παραμέτρους που χρησιμοποιούνται στην εντολή AzCopy:

 - * */Προέλευσης: * &lt;προέλευσης&gt;:*** θέση του φακέλου ή διεύθυνση URL κοντέινερ χώρου αποθήκευσης που περιέχει τον VHD.
 - * */SourceKey: * &lt;κλειδί λογαριασμού προέλευσης&gt;:*** κλειδί λογαριασμού χώρου αποθήκευσης του λογαριασμού χώρου αποθήκευσης προέλευσης.
 - * */Dest: * &lt;προορισμού&gt;:*** διεύθυνση URL κοντέινερ χώρου αποθήκευσης για να αντιγράψετε τον VHD σε.
 - * */DestKey: * &lt;κλειδί λογαριασμού προορισμού&gt;:*** κλειδί λογαριασμού χώρου αποθήκευσης του λογαριασμού χώρου αποθήκευσης προορισμού.
 - * */Μοτίβο: * &lt;ονόματος αρχείου&gt;:*** Καθορίστε το όνομα αρχείου του VHD για να αντιγράψετε.

Για λεπτομέρειες σχετικά με τη χρήση του εργαλείου AzCopy, ανατρέξτε στο θέμα [μεταφορά δεδομένων με το βοηθητικό πρόγραμμα γραμμής εντολών AzCopy](storage-use-azcopy.md).

##### <a name="option-2-copy-a-vhd-with-powershell-synchronized-copy"></a>Επιλογή 2: Αντιγραφή ενός VHD με το PowerShell (συγχρονισμένες αντίγραφο)

Μπορείτε επίσης να αντιγράψετε το αρχείο VHD χρησιμοποιώντας το cmdlet του PowerShell AzureStorageBlobCopy Έναρξη. Χρησιμοποιήστε την ακόλουθη εντολή στο Azure PowerShell για να αντιγράψετε VHD. Αντικαταστήστε τις τιμές σε <> με τις αντίστοιχες τιμές από το λογαριασμό χώρου αποθήκευσης προέλευσης και προορισμού. Για να χρησιμοποιήσετε αυτή την εντολή, πρέπει να έχετε ένα κοντέινερ που ονομάζεται οι VHD στο λογαριασμό σας στο χώρο αποθήκευσης προορισμού. Εάν δεν υπάρχει το κοντέινερ, δημιουργήστε ένα πριν από την εκτέλεση της εντολής.

    $sourceBlobUri = <source-vhd-uri>

    $sourceContext = New-AzureStorageContext  –StorageAccountName <source-account> -StorageAccountKey <source-account-key>

    $destinationContext = New-AzureStorageContext  –StorageAccountName <dest-account> -StorageAccountKey <dest-account-key>

    Start-AzureStorageBlobCopy -srcUri $sourceBlobUri -SrcContext $sourceContext -DestContainer <dest-container> -DestBlob <dest-disk-name> -DestContext $destinationContext

Παράδειγμα:

    C:\PS> $sourceBlobUri = "https://sourceaccount.blob.core.windows.net/vhds/myvhd.vhd"

    C:\PS> $sourceContext = New-AzureStorageContext  –StorageAccountName "sourceaccount" -StorageAccountKey "J4zUI9T5b8gvHohkiRg"

    C:\PS> $destinationContext = New-AzureStorageContext  –StorageAccountName "destaccount" -StorageAccountKey "XZTmqSGKUYFSh7zB5"

    C:\PS> Start-AzureStorageBlobCopy -srcUri $sourceBlobUri -SrcContext $sourceContext -DestContainer "vhds" -DestBlob "myvhd.vhd" -DestContext $destinationContext

### <a name="scenario2"></a>Σενάριο 2: "να μετεγκατάσταση ΣΠΣ από άλλες πλατφόρμες με το χώρο αποθήκευσης Azure Premium."

Εάν κάνετε μετεγκατάσταση VHD από μη - Azure χώρο αποθήκευσης στο Cloud για να Azure, πρέπει πρώτα να εξαγάγετε τον VHD σε έναν τοπικό κατάλογο. Έχουν την προέλευση πλήρη διαδρομή του τοπικού καταλόγου όπου είναι αποθηκευμένο εύχρηστο VHD και, στη συνέχεια, χρησιμοποιώντας AzCopy για αποστολή αποθήκευσης Azure.

#### <a name="step-1-export-vhd-to-a-local-directory"></a>Βήμα 1. Εξαγωγή VHD σε έναν τοπικό κατάλογο

##### <a name="copy-a-vhd-from-aws"></a>Αντιγραφή ενός VHD από AWS

1. Εάν χρησιμοποιείτε AWS, εξαγωγή την παρουσία EC2 σε έναν VHD σε ένα χρωματισμού Amazon S3. Ακολουθήστε τα βήματα που περιγράφονται στην τεκμηρίωση του Amazon για εξαγωγή του Amazon EC2 παρουσίες για να εγκαταστήσετε το εργαλείο περιβάλλον γραμμής εντολών (CLI) Amazon EC2 και εκτελέστε την εντολή Δημιουργία παρουσία-εξαγωγή-εργασιών για να εξαγάγετε την παρουσία EC2 σε ένα αρχείο VHD. Φροντίστε να χρησιμοποιήσετε **VHD** για το ΔΊΣΚΟ & #95; ΕΙΚΌΝΑ & 95 #. Μεταβλητή ΜΟΡΦΉ όταν εκτελείται η εντολή **Δημιουργία παρουσία-εξαγωγή-εργασιών** . Το εξαγόμενο αρχείο VHD έχει αποθηκευτεί το Amazon S3 χρωματισμού ορίζετε κατά τη διάρκεια αυτής της διαδικασίας.

        aws ec2 create-instance-export-task --instance-id ID --target-environment TARGET_ENVIRONMENT \
        --export-to-s3-task DiskImageFormat=DISK_IMAGE_FORMAT,ContainerFormat=ova,S3Bucket=BUCKET,S3Prefix=PREFIX

2. Κάντε λήψη του αρχείου VHD από το χρωματισμού S3. Επιλέξτε το αρχείο VHD, στη συνέχεια, **Ενέργειες** > **λήψη**.

    ![][3]

##### <a name="copy-a-vhd-from-other-non-azure-cloud"></a>Αντιγραφή ενός VHD από άλλα cloud μη Azure

Εάν κάνετε μετεγκατάσταση VHD από μη - Azure χώρο αποθήκευσης στο Cloud για να Azure, πρέπει πρώτα να εξαγάγετε τον VHD σε έναν τοπικό κατάλογο. Αντιγράψτε τη διαδρομή ολοκλήρωσης προέλευσης του τοπικού καταλόγου όπου είναι αποθηκευμένο VHD.

##### <a name="copy-a-vhd-from-on-premise"></a>Αντιγραφή ενός VHD από εσωτερική εγκατάσταση

Εάν πραγματοποιείτε μετεγκατάσταση VHD από ένα περιβάλλον εσωτερικής εγκατάστασης, θα πρέπει η διαδρομή ολοκλήρωσης προέλευσης όπου είναι αποθηκευμένο VHD. Η διαδρομή προέλευσης μπορεί να είναι ένα κοινόχρηστο στοιχείο τοποθεσία ή αρχείο διακομιστή.

#### <a name="step-2-create-the-destination-for-your-vhd"></a>Βήμα 2. Δημιουργήστε τον προορισμό για τις VHD

Δημιουργία λογαριασμού χώρου αποθήκευσης για τη διατήρηση του VHD. Κατά το σχεδιασμό πού να αποθηκεύσει το VHD, λάβετε υπόψη τα εξής σημεία:

- Το λογαριασμό χώρου αποθήκευσης προορισμού μπορεί να είναι τυπικά ή premium χώρου αποθήκευσης, ανάλογα με τις απαιτήσεις εφαρμογής σας.
- Στην περιοχή λογαριασμός χώρου αποθήκευσης πρέπει να είναι ίδια με το χώρο αποθήκευσης Premium με δυνατότητα Azure ΣΠΣ θα δημιουργήσετε με το τελικό στάδιο. Ενδέχεται να μπορείτε να αντιγράψετε σε ένα νέο λογαριασμό του χώρου αποθήκευσης, ή ένα σχέδιο για να χρησιμοποιήσετε τον ίδιο λογαριασμό χώρου αποθήκευσης με βάση τις ανάγκες σας.
- Αντιγραφή και αποθηκεύσετε το κλειδί λογαριασμού χώρου αποθήκευσης του λογαριασμού χώρου αποθήκευσης προορισμού για το επόμενο στάδιο.

Συνιστάται να μπορείτε να μετακινήσετε όλα τα δεδομένα για παραγωγής φόρτο εργασίας για να χρησιμοποιήσετε premium χώρου αποθήκευσης.

#### <a name="step-3-upload-the-vhd-to-azure-storage"></a>Βήμα 3. Αποστολή του VHD Azure χώρου αποθήκευσης

Τώρα που έχετε σας VHD στον τοπικό κατάλογο, μπορείτε να χρησιμοποιήσετε για να αποστείλετε το αρχείο .vhd στο χώρο αποθήκευσης Azure AzCopy ή AzurePowerShell. Και οι δύο επιλογές παρέχονται εδώ:

##### <a name="option-1-using-azure-powershell-add-azurevhd-to-upload-the-vhd-file"></a>Επιλογή 1: Χρήση του PowerShell Azure Προσθήκη-AzureVhd για να αποστείλετε το αρχείο .vhd

    Add-AzureVhd [-Destination] <Uri> [-LocalFilePath] <FileInfo>

Παράδειγμα <Uri> μπορεί να είναι **_"https://storagesample.blob.core.windows.net/mycontainer/blob1.vhd"_**. Παράδειγμα <FileInfo> μπορεί να είναι **_"C:\path\to\upload.vhd"_**.

##### <a name="option-2-using-azcopy-to-upload-the-vhd-file"></a>Επιλογή 2: Χρήση AzCopy για να αποστείλετε το αρχείο .vhd

Χρήση AzCopy, μπορείτε να αποστείλετε εύκολα VHD μέσω του Internet. Ανάλογα με το μέγεθος του VHD, ίσως χρειαστούν χρόνο. Να θυμάστε ότι για να ελέγξετε τα όρια χώρου αποθήκευσης λογαριασμό εισόδου/εξόδου, όταν χρησιμοποιείτε αυτήν την επιλογή. Ανατρέξτε στο θέμα [Azure κλιμάκωση χώρου αποθήκευσης και τους στόχους επιδόσεων](storage-scalability-targets.md) για λεπτομέρειες.

1. Λήψη και εγκατάσταση του AzCopy από εδώ: [πιο πρόσφατη έκδοση του AzCopy](http://aka.ms/downloadazcopy)
2. Ανοίξτε το Azure PowerShell και μεταβείτε στο φάκελο όπου είναι εγκατεστημένο το AzCopy.
3. Χρησιμοποιήστε την παρακάτω εντολή για να αντιγράψετε το αρχείο VHD από "Προέλευση" "Προορισμού".

        AzCopy /Source: <source> /SourceKey: <source-account-key> /Dest: <destination> /DestKey: <dest-account-key> /BlobType:page /Pattern: <file-name>

    Παράδειγμα:

        AzCopy /Source:https://sourceaccount.blob.core.windows.net/mycontainer1 /SourceKey:key1 /Dest:https://destaccount.blob.core.windows.net/mycontainer2 /DestKey:key2 /BlobType:page /Pattern:abc.vhd

    Ακολουθούν περιγραφές για τις παραμέτρους που χρησιμοποιούνται στην εντολή AzCopy:

 - * */Προέλευσης: * &lt;προέλευσης&gt;:*** θέση του φακέλου ή διεύθυνση URL κοντέινερ χώρου αποθήκευσης που περιέχει τον VHD.
 - * */SourceKey: * &lt;κλειδί λογαριασμού προέλευσης&gt;:*** κλειδί λογαριασμού χώρου αποθήκευσης του λογαριασμού χώρου αποθήκευσης προέλευσης.
 - * */Dest: * &lt;προορισμού&gt;:*** διεύθυνση URL κοντέινερ χώρου αποθήκευσης για να αντιγράψετε τον VHD σε.
 - * */DestKey: * &lt;κλειδί λογαριασμού προορισμού&gt;:*** κλειδί λογαριασμού χώρου αποθήκευσης του λογαριασμού χώρου αποθήκευσης προορισμού.
 - **/BlobType: σελίδας:** Καθορίζει ότι ο προορισμός είναι ένα blob σελίδας.
 - * */Μοτίβο: * &lt;ονόματος αρχείου&gt;:*** Καθορίστε το όνομα αρχείου του VHD για να αντιγράψετε.

Για λεπτομέρειες σχετικά με τη χρήση του εργαλείου AzCopy, ανατρέξτε στο θέμα [μεταφορά δεδομένων με το βοηθητικό πρόγραμμα γραμμής εντολών AzCopy](storage-use-azcopy.md).

##### <a name="other-options-for-uploading-a-vhd"></a>Άλλες επιλογές για την αποστολή ενός VHD

Μπορείτε επίσης να αποστείλετε VHD στο λογαριασμό σας χώρο αποθήκευσης, χρησιμοποιώντας έναν από τους εξής τρόπους:

- [Αντιγραφή Azure χώρο αποθήκευσης Blob API](https://msdn.microsoft.com/library/azure/dd894037.aspx)
- [Αντικείμενα BLOB αποστολή Explorer Azure χώρου αποθήκευσης](https://azurestorageexplorer.codeplex.com/)
- [Χώρος αποθήκευσης εισαγωγή/εξαγωγή υπηρεσίας REST API αναφοράς](https://msdn.microsoft.com/library/dn529096.aspx)

>[AZURE.NOTE] Συνιστάται να χρησιμοποιείτε την υπηρεσία εισαγωγής/εξαγωγής εάν εκτιμώμενη αποστολή ώρας είναι μεγαλύτερο από 7 ημέρες. Μπορείτε να χρησιμοποιήσετε [DataTransferSpeedCalculator](https://github.com/Azure-Samples/storage-dotnet-import-export-job-management/blob/master/DataTransferSpeedCalculator.html) για να εκτιμήσετε την ώρα από μονάδα μέγεθος και τη μεταφορά δεδομένων.
>
> Εισαγωγή/εξαγωγή μπορεί να χρησιμοποιηθεί για να αντιγράψετε ένα λογαριασμό τυπική χώρου αποθήκευσης. Θα πρέπει να αντιγράψετε από χώρο αποθήκευσης στο τυπικό λογαριασμό χώρου αποθήκευσης premium χρησιμοποιώντας ένα εργαλείο όπως AzCopy.


## <a name="create-azure-virtual-machine-using-premium-storage"></a>Δημιουργία ΣΠΣ Azure χρησιμοποιώντας Premium χώρου αποθήκευσης

Αφού VHD είναι που έχουν αποσταλεί ή αντιγραφεί στο λογαριασμό επιθυμητό χώρου αποθήκευσης, ακολουθήστε τις οδηγίες σε αυτήν την ενότητα για να καταχωρήσετε τον VHD ως εικόνα λειτουργικό σύστημα ή λειτουργικό σύστημα δίσκου ανάλογα με το σενάριό σας και, στη συνέχεια, να δημιουργήσετε μια Εικονική παρουσία από αυτό. Μπορείτε να το επισυνάψετε ο δίσκος δεδομένων VHD την εικονική Μηχανή αφού δημιουργηθεί. Ένα δείγμα δέσμης ενεργειών μετεγκατάστασης παρέχονται στο τέλος αυτής της ενότητας. Αυτή η απλή δέσμη ενεργειών δεν ταιριάζουν με όλα τα σενάρια. Ίσως χρειαστεί να ενημερώσετε τη δέσμη ενεργειών για να ταιριάζουν με το συγκεκριμένο σενάριο. Για να δείτε εάν αυτήν τη δέσμη ενεργειών ισχύει για το σενάριό σας, ανατρέξτε στο θέμα κάτω από [Ένα δείγμα δέσμης ενεργειών μετεγκατάστασης](#a-sample-migration-script).

### <a name="checklist"></a>Λίστα ελέγχου

1.  Περιμένετε έως ότου όλων των δίσκων VHD αντιγραφή έχει ολοκληρωθεί.
2.  Βεβαιωθείτε ότι ο χώρος αποθήκευσης Premium είναι διαθέσιμη στην περιοχή κάνετε μετεγκατάσταση για να.
3.  Καθορισμός της νέας σειράς Εικονική που θα χρησιμοποιήσετε. Θα πρέπει να είναι ένα με δυνατότητα αποθήκευσης Premium και το μέγεθος θα πρέπει να είναι ανάλογα με τη διαθεσιμότητα της περιοχής και με βάση τις ανάγκες σας.
4.  Αποφασίστε το ακριβές μέγεθος Εικονική που θα χρησιμοποιήσετε. Εικονική μέγεθος πρέπει να είναι αρκετά μεγάλος, ώστε να υποστηρίζει τον αριθμό των δίσκων δεδομένων που έχετε. Π.χ. Εάν έχετε 4 δίσκων δεδομένων, η Εικονική πρέπει να έχετε 2 ή περισσότερα πυρήνων. Επίσης, εξετάστε το ενδεχόμενο να επεξεργασίας power, μνήμης και χρειάζεται εύρους ζώνης δικτύου.
5.  Δημιουργία λογαριασμού χώρου αποθήκευσης Premium στην περιοχή προορισμού. Αυτός είναι ο λογαριασμός που θα χρησιμοποιήσετε για τη νέα Εικονική.
6.  Έχετε την τρέχουσα λεπτομέρειες Εικονική εύχρηστο, συμπεριλαμβανομένων των τη λίστα δίσκων και τις αντίστοιχες αντικείμενα BLOB VHD.

Προετοιμάστε την εφαρμογή του χρόνου εκτός λειτουργίας. Για να εκτελέσετε μια καθαρή μετεγκατάσταση, πρέπει να διακόψετε όλους την επεξεργασία στο τρέχον σύστημα. Μόνο, στη συνέχεια, μπορείτε να το λάβετε συνεπή μέλος το οποίο μπορείτε να κάνετε μετεγκατάσταση στη νέα πλατφόρμα. Χρόνος εκτός λειτουργίας διάρκεια εξαρτώνται από την ποσότητα των δεδομένων σε των δίσκων για τη μετεγκατάσταση.

>[AZURE.NOTE] Εάν θέλετε να δημιουργήσετε μια Εικονική διαχείριση πόρων Azure από ένα δίσκο εξειδικευμένες VHD, ανατρέξτε σε [αυτό το πρότυπο](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-from-specialized-vhd) για την ανάπτυξη Εικονική διαχείριση πόρων χρησιμοποιώντας υπάρχοντα δίσκο.

### <a name="register-your-vhd"></a>Καταχώρηση σας VHD

Για να δημιουργήσετε μια Εικονική από VHD λειτουργικό σύστημα ή για να επισυνάψετε ένα δίσκο δεδομένων σε μια νέα Εικονική, πρέπει πρώτα να δηλώσετε τους. Ακολουθήστε τα παρακάτω βήματα ανάλογα με το σενάριό σας VHD.

#### <a name="generalized-operating-system-vhd-to-create-multiple-azure-vm-instances"></a>Γενίκευση VHD λειτουργικό σύστημα για να δημιουργήσετε πολλές παρουσίες Εικονική Azure

Μετά την αποστολή της εικόνας γενικευμένη OS VHD με το λογαριασμό χώρου αποθήκευσης, καταχωρήσετε ως **Εικόνα Εικονική Azure** , έτσι ώστε να μπορείτε να δημιουργήσετε μία ή περισσότερες παρουσίες Εικονική από αυτό. Χρησιμοποιήστε τα παρακάτω cmdlet του PowerShell για να καταχωρήσετε τον VHD ως εικόνα Azure Εικονική OS. Δώστε τη διεύθυνση URL ολοκλήρωσης κοντέινερ όπου έχει αντιγραφεί VHD.

    Add-AzureVMImage -ImageName "OSImageName" -MediaLocation "https://storageaccount.blob.core.windows.net/vhdcontainer/osimage.vhd" -OS Windows

Αντιγραφή και αποθηκεύστε το όνομα αυτής της νέας εικόνας Εικονική Azure. Στο παραπάνω παράδειγμα, είναι *OSImageName*.

#### <a name="unique-operating-system-vhd-to-create-a-single-azure-vm-instance"></a>Μοναδικό VHD λειτουργικό σύστημα για να δημιουργήσετε μια μεμονωμένη παρουσία Εικονική Azure

Μετά τον μοναδικό VHD OS αποστολή με το λογαριασμό χώρου αποθήκευσης, καταχωρήσετε ως ένα **Δίσκο OS Azure** έτσι ώστε να μπορείτε να δημιουργήσετε μια Εικονική παρουσία από αυτό. Χρησιμοποιήστε αυτά τα cmdlet του PowerShell για να καταχωρήσετε τον VHD ως ένα δίσκο OS Azure. Δώστε τη διεύθυνση URL ολοκλήρωσης κοντέινερ όπου έχει αντιγραφεί VHD.

    Add-AzureDisk -DiskName "OSDisk" -MediaLocation "https://storageaccount.blob.core.windows.net/vhdcontainer/osdisk.vhd" -Label "My OS Disk" -OS "Windows"

Αντιγραφή και αποθηκεύστε το όνομα αυτού του νέου δίσκου OS Azure. Στο παραπάνω παράδειγμα, είναι *OSDisk*.

#### <a name="data-disk-vhd-to-be-attached-to-new-azure-vm-instances"></a>Δεδομένα δίσκου VHD επισυνάπτεται νέο των παρουσιών Εικονική Azure

Αφού ο δίσκος δεδομένων VHD αποσταλεί με το λογαριασμό χώρου αποθήκευσης, καταχωρήσετε ως ένα δίσκο Azure δεδομένων ώστε να μπορείτε να το επισυνάψετε για νέες σειρές DS, DSv2 σειρά ή GS σειρά Azure Εικονική παρουσία.

Χρησιμοποιήστε αυτά τα cmdlet του PowerShell για να καταχωρήσετε τον VHD ως ένα δίσκο δεδομένων Azure. Δώστε τη διεύθυνση URL ολοκλήρωσης κοντέινερ όπου έχει αντιγραφεί VHD.

    Add-AzureDisk -DiskName "DataDisk" -MediaLocation "https://storageaccount.blob.core.windows.net/vhdcontainer/datadisk.vhd" -Label "My Data Disk"

Αντιγραφή και αποθηκεύστε το όνομα αυτού του νέου δίσκου δεδομένων Azure. Στο παραπάνω παράδειγμα, είναι *DataDisk*.

### <a name="create-a-premium-storage-capable-vm"></a>Δημιουργήστε μια Εικονική με δυνατότητα αποθήκευσης Premium

Μία φορά την εικόνα του λειτουργικού Συστήματος ή έχετε καταχωρήσει OS δίσκου, Δημιουργία νέας σειράς DS, DSv2 σειρά ή Εικονική GS σειρά. Θα χρησιμοποιήσετε στην εικόνα λειτουργικό σύστημα ή το όνομα του δίσκου λειτουργικό σύστημα που καταχωρήσατε. Επιλέξτε τον τύπο Εικονική από το επίπεδο του χώρου αποθήκευσης Premium. Στο παρακάτω παράδειγμα, χρησιμοποιούμε το μέγεθος Εικονική *Standard_DS2* .

>[AZURE.NOTE] Ενημερώστε το μέγεθος του δίσκου για να βεβαιωθείτε ότι ταιριάζει με τη χωρητικότητα και απαιτήσεις για την απόδοση και τα μεγέθη Azure δίσκο.

Ακολουθήστε τα cmdlet του PowerShell βήμα προς βήμα παρακάτω, για να δημιουργήσετε τη νέα Εικονική. Αρχικά, ρυθμίστε τις παραμέτρους κοινές:

    $serviceName = "yourVM"
    $location = "location-name" (e.g., West US)
    $vmSize ="Standard_DS2"
    $adminUser = "youradmin"
    $adminPassword = "yourpassword"
    $vmName ="yourVM"
    $vmSize = "Standard_DS2"

Πρώτα, δημιουργήστε μια υπηρεσία στο cloud με την οποία θα φιλοξενίας σας νέα ΣΠΣ.

    New-AzureService -ServiceName $serviceName -Location $location

Στη συνέχεια, ανάλογα με το σενάριό σας, δημιουργήστε την παρουσία Εικονική Azure από το λειτουργικό σύστημα εικόνας ή δίσκου λειτουργικό σύστημα που καταχωρήσατε.

#### <a name="generalized-operating-system-vhd-to-create-multiple-azure-vm-instances"></a>Γενίκευση VHD λειτουργικό σύστημα για να δημιουργήσετε πολλές παρουσίες Εικονική Azure

Δημιουργήστε τη μία ή περισσότερες νέες Εικονική Azure σειράς DS παρουσίες χρησιμοποιώντας το **Azure OS εικόνα** που έχετε καταχωρήσει. Καθορίστε αυτό το όνομα OS εικόνα στη ρύθμιση παραμέτρων Εικονική κατά τη δημιουργία νέας Εικονική, όπως φαίνεται παρακάτω.

    $OSImage = Get-AzureVMImage –ImageName "OSImageName"

    $vm = New-AzureVMConfig -Name $vmName –InstanceSize $vmSize -ImageName $OSImage.ImageName

    Add-AzureProvisioningConfig -Windows –AdminUserName $adminUser -Password $adminPassword –VM $vm

    New-AzureVM -ServiceName $serviceName -VM $vm

#### <a name="unique-operating-system-vhd-to-create-a-single-azure-vm-instance"></a>Μοναδικό VHD λειτουργικό σύστημα για να δημιουργήσετε μια μεμονωμένη παρουσία Εικονική Azure

Δημιουργήσετε μια νέα DS σειρά Εικονική Azure παρουσία χρησιμοποιώντας το **Azure OS δίσκου** που έχετε καταχωρήσει. Καθορίστε αυτό το όνομα OS δίσκο στη ρύθμιση παραμέτρων Εικονική κατά τη δημιουργία του νέου Εικονική, όπως φαίνεται παρακάτω.

    $OSDisk = Get-AzureDisk –DiskName "OSDisk"

    $vm = New-AzureVMConfig -Name $vmName -InstanceSize $vmSize -DiskName $OSDisk.DiskName

    New-AzureVM -ServiceName $serviceName –VM $vm

Καθορίστε άλλες πληροφορίες Εικονική Azure, όπως μια υπηρεσία cloud, περιοχή, το λογαριασμό χώρου αποθήκευσης, ορισμός διαθεσιμότητας και σε cache πολιτικής. Σημειώστε ότι η παρουσία Εικονική πρέπει να βρίσκονται από κοινού με σχετικές λειτουργικό σύστημα ή δίσκων δεδομένων, ώστε ο λογαριασμός υπηρεσίας, περιοχής και αποθήκευσης επιλεγμένο cloud πρέπει να είναι στην ίδια θέση ως τα υποκείμενα VHD δίσκων αυτές τις.

### <a name="attach-data-disk"></a>Επισύναψη δίσκου δεδομένων

Τέλος, αν έχετε εγγραφεί δεδομένων δίσκου VHD, επισυνάψτε τις σε Εικονική νέα με δυνατότητα Azure Premium χώρου αποθήκευσης.

Χρησιμοποιήστε παρακάτω cmdlet του PowerShell για να επισυνάψετε δίσκου δεδομένων για το νέο Εικονική και να καθορίσετε την πολιτική σε cache. Στο παρακάτω παράδειγμα η πολιτική σε cache έχει οριστεί σε *μόνο για ανάγνωση*.

    $vm = Get-AzureVM -ServiceName $serviceName -Name $vmName

    Add-AzureDataDisk -ImportFrom -DiskName "DataDisk" -LUN 0 –HostCaching ReadOnly –VM $vm

    Update-AzureVM  -VM $vm

>[AZURE.NOTE] Μπορεί να υπάρχουν επιπλέον βήματα είναι απαραίτητο να υποστηρίζει την εφαρμογή που δεν καλύπτεται από αυτόν τον οδηγό.

### <a name="checking-and-plan-backup"></a>Έλεγχος και πρόγραμμα δημιουργίας αντιγράφων ασφαλείας

Μόλις το νέο Εικονική εγκατάσταση και λειτουργία, έχετε πρόσβαση σε αυτά χρησιμοποιώντας το ίδιο αναγνωριστικό σύνδεσης και τον κωδικό πρόσβασης είναι ως το αρχικό Εικονική και επαλήθευση ότι εμφανίζονται τα πάντα λειτουργεί με τον αναμενόμενο τρόπο. Όλες τις ρυθμίσεις, όπως το ραβδωτό όγκους, θα ήταν παρουσίαση σε τη νέα Εικονική.

Το τελευταίο βήμα είναι να σχεδιάσετε δημιουργίας αντιγράφων ασφαλείας και χρονοδιάγραμμα συντήρησης για το νέο Εικονική ανάλογα με τις ανάγκες της εφαρμογής.

### <a name="a-sample-migration-script"></a>Ένα δείγμα δέσμης ενεργειών μετεγκατάστασης

Εάν έχετε πολλές ΣΠΣ για τη μετεγκατάσταση, θα ήταν χρήσιμο αυτοματοποίηση μέσω δεσμών ενεργειών του PowerShell. Ακολουθεί ένα δείγμα δέσμης ενεργειών που αυτοματοποιεί τη μετεγκατάσταση από μια Εικονική. Σημείωση που κάτω από το στοιχείο δέσμης ενεργειών είναι μόνο ένα παράδειγμα και υπάρχουν μερικά εκτιμήσεις σχετικά με την τρέχουσα δίσκων Εικονική. Ίσως χρειαστεί να ενημερώσετε τη δέσμη ενεργειών για να ταιριάζουν με το συγκεκριμένο σενάριο.

Οι υποθέσεις είναι οι εξής:

- Δημιουργείτε κλασική ΣΠΣ Azure.
- Σας δίσκων OS προέλευσης και δίσκων δεδομένων προέλευσης είναι στο ίδιο λογαριασμό χώρου αποθήκευσης και το ίδιο κοντέινερ. Εάν το λειτουργικό σύστημα δίσκων και δίσκων δεδομένων δεν είναι στην ίδια θέση, μπορείτε να χρησιμοποιήσετε AzCopy ή Azure PowerShell για να αντιγράψετε VHD πάνω από λογαριασμούς χώρου αποθήκευσης και κοντέινερ. Ανατρέξτε στο προηγούμενο βήμα: [Αντιγραφή VHD με AzCopy ή PowerShell](#copy-vhd-with-azcopy-or-powershell). Επεξεργασία αυτήν τη δέσμη ενεργειών να πληροί το σενάριό σας είναι μια άλλη επιλογή, αλλά συνιστάται να χρησιμοποιείτε AzCopy ή PowerShell, εφόσον είναι πιο εύκολη και πιο γρήγορη.

Η δέσμη ενεργειών αυτοματισμού παρέχεται παρακάτω. Αντικατάσταση κειμένου με τις πληροφορίες σας και να ενημερώσετε τη δέσμη ενεργειών για να ταιριάζουν με το συγκεκριμένο σενάριο.

>[AZURE.NOTE] Χρησιμοποιώντας την υπάρχουσα δέσμη ενεργειών δεν διατηρεί τις ρυθμίσεις δικτύου σας εικονική Μηχανή προέλευσης. Θα πρέπει να επανάληψη ρύθμισης των ρυθμίσεων δικτύου σε σας μετεγκαταστάθηκαν VM.

    <#
    .Synopsis
    This script is provided as an EXAMPLE to show how to migrate a VM from a standard storage account to a premium storage account. You can customize it according to your specific requirements.

    .Description
    The script will copy the vhds (page blobs) of the source VM to the new storage account.
    And then it will create a new VM from these copied vhds based on the inputs that you specified for the new VM.
    You can modify the script to satisfy your specific requirement, but please be aware of the items specified
    in the Terms of Use section.

    .Terms of Use
    Copyright © 2015 Microsoft Corporation.  All rights reserved.

    THIS CODE AND ANY ASSOCIATED INFORMATION ARE PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND,
    EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF MERCHANTABILITY
    AND/OR FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK OF USE, INABILITY TO USE, OR
    RESULTS FROM THE USE OF THIS CODE REMAINS WITH THE USER.

    .Example (Save this script as Migrate-AzureVM.ps1)

    .\Migrate-AzureVM.ps1 -SourceServiceName CurrentServiceName -SourceVMName CurrentVMName –DestStorageAccount newpremiumstorageaccount -DestServiceName NewServiceName -DestVMName NewDSVMName -DestVMSize "Standard_DS2" –Location “Southeast Asia”

    .Link
    To find more information about how to set up Azure PowerShell, refer to the following links.
    http://azure.microsoft.com/documentation/articles/powershell-install-configure/
    http://azure.microsoft.com/documentation/articles/storage-powershell-guide-full/
    http://azure.microsoft.com/blog/2014/10/22/migrate-azure-virtual-machines-between-storage-accounts/

    #>

    Param(
    # the cloud service name of the VM.
    [Parameter(Mandatory = $true)]
    [string] $SourceServiceName,

    # The VM name to copy.
    [Parameter(Mandatory = $true)]
    [String] $SourceVMName,

    # The destination storage account name.
    [Parameter(Mandatory = $true)]
    [String] $DestStorageAccount,

    # The destination cloud service name
    [Parameter(Mandatory = $true)]
    [String] $DestServiceName,

    # the destination vm name
    [Parameter(Mandatory = $true)]
    [String] $DestVMName,

    # the destination vm size
    [Parameter(Mandatory = $true)]
    [String] $DestVMSize,

    # the location of destination VM.
    [Parameter(Mandatory = $true)]
    [string] $Location,

    # whether or not to copy the os disk, the default is only copy data disks
    [Parameter(Mandatory = $false)]
    [Bool] $DataDiskOnly = $true,

    # how frequently to report the copy status in sceconds
    [Parameter(Mandatory = $false)]
    [Int32] $CopyStatusReportInterval = 15,

    # the name suffix to add to new created disks to avoid conflict with source disk names
    [Parameter(Mandatory = $false)]
    [String]$DiskNameSuffix = "-prem"

    ) #end param

    #######################################################################
    #  Verify Azure PowerShell module and version
    #######################################################################

    #import the Azure PowerShell module
    Write-Host "`n[WORKITEM] - Importing Azure PowerShell module" -ForegroundColor Yellow
    $azureModule = Import-Module Azure -PassThru

    if ($azureModule -ne $null)
    {
        Write-Host "`tSuccess" -ForegroundColor Green
    }
    else
    {
        #show module not found interaction and bail out
        Write-Host "[ERROR] - PowerShell module not found. Exiting." -ForegroundColor Red
        Exit
    }


    #Check the Azure PowerShell module version
    Write-Host "`n[WORKITEM] - Checking Azure PowerShell module verion" -ForegroundColor Yellow
    If ($azureModule.Version -ge (New-Object System.Version -ArgumentList "0.8.14"))
    {
        Write-Host "`tSuccess" -ForegroundColor Green
    }
    Else
    {
        Write-Host "[ERROR] - Azure PowerShell module must be version 0.8.14 or higher. Exiting." -ForegroundColor Red
        Exit
    }

    #Check if there is an azure subscription set up in PowerShell
    Write-Host "`n[WORKITEM] - Checking Azure Subscription" -ForegroundColor Yellow
    $currentSubs = Get-AzureSubscription -Current
    if ($currentSubs -ne $null)
    {
        Write-Host "`tSuccess" -ForegroundColor Green
        Write-Host "`tYour current azure subscription in PowerShell is $($currentSubs.SubscriptionName)." -ForegroundColor Green
    }
    else
    {
        Write-Host "[ERROR] - There is no valid Azure subscription found in PowerShell. Please refer to this article http://azure.microsoft.com/documentation/articles/powershell-install-configure/ to connect an Azure subscription. Exiting." -ForegroundColor Red
        Exit
    }


    #######################################################################
    #  Check if the VM is shut down
    #  Stopping the VM is a required step so that the file system is consistent when you do the copy operation.
    #  Azure does not support live migration at this time..
    #######################################################################

    if (($sourceVM = Get-AzureVM –ServiceName $SourceServiceName –Name $SourceVMName) -eq $null)
    {
        Write-Host "[ERROR] - The source VM doesn't exist in the current subscription. Exiting." -ForegroundColor Red
        Exit
    }

    # check if VM is shut down
    if ( $sourceVM.Status -notmatch "Stopped" )
    {
        Write-Host "[Warning] - Stopping the VM is a required step so that the file system is consistent when you do the copy operation. Azure does not support live migration at this time. If you’d like to create a VM from a generalized image, sys-prep the Virtual Machine before stopping it." -ForegroundColor Yellow
        $ContinueAnswer = Read-Host "`n`tDo you wish to stop $SourceVMName now? Input 'N' if you want to shut down the VM manually and come back later.(Y/N)"
        If ($ContinueAnswer -ne "Y") { Write-Host "`n Exiting." -ForegroundColor Red;Exit }
        $sourceVM | Stop-AzureVM

        # wait until the VM is shut down
        $VMStatus = (Get-AzureVM –ServiceName $SourceServiceName –Name $vmName).Status
        while ($VMStatus -notmatch "Stopped")
        {
            Write-Host "`n[Status] - Waiting VM $vmName to shut down" -ForegroundColor Green
            Sleep -Seconds 5
            $VMStatus = (Get-AzureVM –ServiceName $SourceServiceName –Name $vmName).Status
        }
    }

    # exporting the sourve vm to a configuration file, you can restore the original VM by importing this config file
    # see more information for Import-AzureVM
    $workingDir = (Get-Location).Path
    $vmConfigurationPath = $env:HOMEPATH + "\VM-" + $SourceVMName + ".xml"
    Write-Host "`n[WORKITEM] - Exporting VM configuration to $vmConfigurationPath" -ForegroundColor Yellow
    $exportRe = $sourceVM | Export-AzureVM -Path $vmConfigurationPath


    #######################################################################
    #  Copy the vhds of the source vm
    #  You can choose to copy all disks including os and data disks by specifying the
    #  parameter -DataDiskOnly to be $false. The default is to copy only data disk vhds
    #  and the new VM will boot from the original os disk.
    #######################################################################

    $sourceOSDisk = $sourceVM.VM.OSVirtualHardDisk
    $sourceDataDisks = $sourceVM.VM.DataVirtualHardDisks

    # Get source storage account information, not considering the data disks and os disks are in different accounts
    $sourceStorageAccountName = $sourceOSDisk.MediaLink.Host -split "\." | select -First 1
    $sourceStorageKey = (Get-AzureStorageKey -StorageAccountName $sourceStorageAccountName).Primary
    $sourceContext = New-AzureStorageContext –StorageAccountName $sourceStorageAccountName -StorageAccountKey $sourceStorageKey

    # Create destination context
    $destStorageKey = (Get-AzureStorageKey -StorageAccountName $DestStorageAccount).Primary
    $destContext = New-AzureStorageContext –StorageAccountName $DestStorageAccount -StorageAccountKey $destStorageKey

    # Create a container of vhds if it doesn't exist
    if ((Get-AzureStorageContainer -Context $destContext -Name vhds -ErrorAction SilentlyContinue) -eq $null)
    {
        Write-Host "`n[WORKITEM] - Creating a container vhds in the destination storage account." -ForegroundColor Yellow
        New-AzureStorageContainer -Context $destContext -Name vhds
    }


    $allDisksToCopy = $sourceDataDisks
    # check if need to copy os disk
    $sourceOSVHD = $sourceOSDisk.MediaLink.Segments[2]
    if ($DataDiskOnly)
    {
        # copy data disks only, this option requires deleting the source VM so that dest VM can boot
        # from the same vhd blob.
        $ContinueAnswer = Read-Host "`n`t[Warning] You chose to copy data disks only. Moving VM requires removing the original VM (the disks and backing vhd files will NOT be deleted) so that the new VM can boot from the same vhd. This is an irreversible action. Do you wish to proceed right now? (Y/N)"
        If ($ContinueAnswer -ne "Y") { Write-Host "`n Exiting." -ForegroundColor Red;Exit }
        $destOSVHD = Get-AzureStorageBlob -Blob $sourceOSVHD -Container vhds -Context $sourceContext
        Write-Host "`n[WORKITEM] - Removing the original VM (the vhd files are NOT deleted)." -ForegroundColor Yellow
        Remove-AzureVM -Name $SourceVMName -ServiceName $SourceServiceName

        Write-Host "`n[WORKITEM] - Waiting utill the OS disk is released by source VM. This may take up to several minutes."
        $diskAttachedTo = (Get-AzureDisk -DiskName $sourceOSDisk.DiskName).AttachedTo
        while ($diskAttachedTo -ne $null)
        {
            Start-Sleep -Seconds 10
            $diskAttachedTo = (Get-AzureDisk -DiskName $sourceOSDisk.DiskName).AttachedTo
        }

    }
    else
    {
        # copy the os disk vhd
        Write-Host "`n[WORKITEM] - Starting copying os disk $($disk.DiskName) at $(get-date)." -ForegroundColor Yellow
        $allDisksToCopy += @($sourceOSDisk)
        $targetBlob = Start-AzureStorageBlobCopy -SrcContainer vhds -SrcBlob $sourceOSVHD -DestContainer vhds -DestBlob $sourceOSVHD -Context $sourceContext -DestContext $destContext -Force
        $destOSVHD = $targetBlob
    }


    # Copy all data disk vhds
    # Start all async copy requests in parallel.
    foreach($disk in $sourceDataDisks)
    {
        $blobName = $disk.MediaLink.Segments[2]
        # copy all data disks
        Write-Host "`n[WORKITEM] - Starting copying data disk $($disk.DiskName) at $(get-date)." -ForegroundColor Yellow
        $targetBlob = Start-AzureStorageBlobCopy -SrcContainer vhds -SrcBlob $blobName -DestContainer vhds -DestBlob $blobName -Context $sourceContext -DestContext $destContext -Force
        # update the media link to point to the target blob link
        $disk.MediaLink = $targetBlob.ICloudBlob.Uri.AbsoluteUri
    }

    # Wait until all vhd files are copied.
    $diskComplete = @()
    do
    {
        Write-Host "`n[WORKITEM] - Waiting for all disk copy to complete. Checking status every $CopyStatusReportInterval seconds." -ForegroundColor Yellow
        # check status every 30 seconds
        Sleep -Seconds $CopyStatusReportInterval
        foreach ( $disk in $allDisksToCopy)
        {
            if ($diskComplete -contains $disk)
            {
                Continue
            }
            $blobName = $disk.MediaLink.Segments[2]
            $copyState = Get-AzureStorageBlobCopyState -Blob $blobName -Container vhds -Context $destContext
            if ($copyState.Status -eq "Success")
            {
                Write-Host "`n[Status] - Success for disk copy $($disk.DiskName) at $($copyState.CompletionTime)" -ForegroundColor Green
                $diskComplete += $disk
            }
            else
            {
                if ($copyState.TotalBytes -gt 0)
                {
                    $percent = ($copyState.BytesCopied / $copyState.TotalBytes) * 100
                    Write-Host "`n[Status] - $('{0:N2}' -f $percent)% Complete for disk copy $($disk.DiskName)" -ForegroundColor Green
                }
            }
        }
    }
    while($diskComplete.Count -lt $allDisksToCopy.Count)

    #######################################################################
    #  Create a new vm
    #  the new VM can be created from the copied disks or the original os disk.
    #  You can ddd your own logic here to satisfy your specific requirements of the vm.
    #######################################################################

    # Create a VM from the existing os disk
    if ($DataDiskOnly)
    {
        $vm = New-AzureVMConfig -Name $DestVMName -InstanceSize $DestVMSize -DiskName $sourceOSDisk.DiskName
    }
    else
    {
        $newOSDisk = Add-AzureDisk -OS $sourceOSDisk.OS -DiskName ($sourceOSDisk.DiskName + $DiskNameSuffix) -MediaLocation $destOSVHD.ICloudBlob.Uri.AbsoluteUri
        $vm = New-AzureVMConfig -Name $DestVMName -InstanceSize $DestVMSize -DiskName $newOSDisk.DiskName
    }
    # Attached the copied data disks to the new VM
    foreach ($dataDisk in $sourceDataDisks)
    {
        # add -DiskLabel $dataDisk.DiskLabel if there are labels for disks of the source vm
        $diskLabel = "drive" + $dataDisk.Lun
        $vm | Add-AzureDataDisk -ImportFrom -DiskLabel $diskLabel -LUN $dataDisk.Lun -MediaLocation $dataDisk.MediaLink
    }

    # Edit this if you want to add more custimization to the new VM
    # $vm | Add-AzureEndpoint -Protocol tcp -LocalPort 443 -PublicPort 443 -Name 'HTTPs'
    # $vm | Set-AzureSubnet "PubSubnet","PrivSubnet"

    New-AzureVM -ServiceName $DestServiceName -VMs $vm -Location $Location

#### <a name="optimization"></a>Βελτιστοποίηση

Η τρέχουσα ρύθμιση παραμέτρων Εικονική μπορεί να προσαρμοστεί ειδικά ώστε να λειτουργεί καλά με τυπική δίσκων. Για παράδειγμα, για να αυξήσετε την απόδοση, χρησιμοποιώντας πολλά δίσκων σε ένα ραβδωτό έντασης ήχου. Για παράδειγμα, αντί να χρησιμοποιήσετε 4 δίσκων ξεχωριστά στο χώρο αποθήκευσης Premium, ίσως μπορείτε να βελτιστοποιήσετε το κόστος, με έναν μόνο δίσκο. Βελτιστοποιήσεις όπως αυτό πρέπει να γίνεται με βάση κατά περίπτωση και απαιτούν προσαρμοσμένες βήματα μετά τη μετεγκατάσταση. Επίσης, σημειώστε ότι αυτή η διαδικασία μπορεί να λειτουργεί καλά για βάσεις δεδομένων και εφαρμογές που εξαρτώνται από τη διάταξη που ορίζονται από το στη ρύθμιση των.

##### <a name="preparation"></a>Προετοιμασία

1.  Ολοκλήρωση της μετεγκατάστασης απλό όπως περιγράφεται στην προηγούμενη ενότητα. Βελτιστοποιήσεις θα εκτελεστεί σε τη νέα Εικονική μετά τη μετεγκατάσταση.
2.  Ορισμός τα νέα μεγέθη δίσκου που απαιτείται για τη ρύθμιση παραμέτρων βελτιστοποιημένη.
3.  Καθορισμός αντιστοίχισης από την τρέχουσα δίσκων/όγκους για τις νέες προδιαγραφές δίσκου.

##### <a name="execution-steps"></a>Βήματα εκτέλεσης

1.  Δημιουργήστε το νέο δίσκων με τα μεγέθη δεξιά στην η Εικονική αποθήκευσης Premium.
2.  Συνδεθείτε στο την Εικονική και αντιγράψτε τα δεδομένα από την τρέχουσα ένταση στον νέο δίσκο που αντιστοιχεί σε αυτήν την ένταση ήχου. Κάντε τα εξής για όλα τα τρέχουσα όγκους που πρέπει να αντιστοιχίσετε ένα νέο δίσκο.
3.  Στη συνέχεια, αλλαγή των ρυθμίσεων της εφαρμογής για να μεταβείτε σε το νέων δίσκων και απόσπαση το παλιό όγκους.

Για τη ρύθμιση της εφαρμογής για βελτίωση των επιδόσεων του δίσκου, ανατρέξτε στην [Βελτιστοποίηση των επιδόσεων εφαρμογής](storage-premium-storage-performance.md#optimizing-application-performance).

### <a name="application-migrations"></a>Μετεγκαταστάσεις εφαρμογής

Βάσεις δεδομένων και άλλες εφαρμογές σύνθετες μπορεί να απαιτεί ειδική βήματα όπως καθορίζεται από την υπηρεσία παροχής της εφαρμογής για τη μετεγκατάσταση. Ανατρέξτε στην τεκμηρίωση της εφαρμογής αντίστοιχα. Π.χ. Συνήθως, μπορείτε να μετεγκαταστήσετε βάσεις δεδομένων μέσω δημιουργίας αντιγράφων ασφαλείας και επαναφορά.

## <a name="next-steps"></a>Επόμενα βήματα

Ανατρέξτε στους παρακάτω πόρους για συγκεκριμένα σενάρια για τη μετεγκατάσταση εικονικές μηχανές:

- [Μετεγκατάσταση Azure εικονικές μηχανές μεταξύ λογαριασμών χώρου αποθήκευσης](https://azure.microsoft.com/blog/2014/10/22/migrate-azure-virtual-machines-between-storage-accounts/)
- [Δημιουργία και αποστολή ενός VHD διακομιστή Windows Azure.](../virtual-machines/virtual-machines-windows-classic-createupload-vhd.md)
- [Δημιουργία και αποστολή ενός εικονικού σκληρού δίσκου που περιέχει το λειτουργικό σύστημα Linux](../virtual-machines/virtual-machines-linux-classic-create-upload-vhd.md)
- [Η μετεγκατάσταση εικονικές μηχανές από το Amazon AWS στο Microsoft Azure](http://channel9.msdn.com/Series/Migrating-Virtual-Machines-from-Amazon-AWS-to-Microsoft-Azure)

Επίσης, ανατρέξτε στους παρακάτω πόρους για να μάθετε περισσότερα σχετικά με το χώρο αποθήκευσης Azure και εικονικές μηχανές Windows Azure:

- [Azure χώρου αποθήκευσης](https://azure.microsoft.com/documentation/services/storage/)
- [Azure εικονικές μηχανές](https://azure.microsoft.com/documentation/services/virtual-machines/)
- [Χώρος αποθήκευσης Premium: Χώρος αποθήκευσης υψηλών επιδόσεων για φόρτους εργασίας του Azure εικονική μηχανή](storage-premium-storage.md)

[1]:./media/storage-migration-to-premium-storage/migration-to-premium-storage-1.png
[2]:./media/storage-migration-to-premium-storage/migration-to-premium-storage-1.png
[3]:./media/storage-migration-to-premium-storage/migration-to-premium-storage-3.png
[4]: http://technet.microsoft.com/library/hh831739.aspx
