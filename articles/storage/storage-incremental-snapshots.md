<properties
    pageTitle="Χρησιμοποιήσετε αυξανόμενες στιγμιότυπα για αντίγραφα ασφαλείας και επαναφορά της Azure εικονικές μηχανές | Microsoft Azure"
    description="Δημιουργήστε μια προσαρμοσμένη λύση για αντίγραφα ασφαλείας και επαναφορά των δίσκων σας Azure εικονική μηχανή χρησιμοποιώντας αυξάνονται στιγμιότυπα."
    services="storage"
    documentationCenter="na"
    authors="aungoo-msft"
    manager="tadb"
    editor="tysonn"/>

<tags
    ms.service="storage"
    ms.workload="storage"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/18/2016"
    ms.author="aungoo"/>


# <a name="back-up-azure-virtual-machine-disks-with-incremental-snapshots"></a>Δημιουργία αντιγράφου ασφαλείας δίσκων Azure εικονική μηχανή με στιγμιότυπα επαυξητική

## <a name="overview"></a>Επισκόπηση

Azure αποθήκευσης παρέχει τη δυνατότητα στιγμιότυπα αντικείμενα blob. Στιγμιότυπα να καταγράψετε την κατάσταση blob σε αυτό το σημείο στο χρόνο. Σε αυτό το άρθρο θα σας θα περιγράφουν ένα σενάριο του πώς μπορείτε να διατηρείτε αντίγραφα ασφαλείας των δίσκων εικονική μηχανή με χρήση στιγμιότυπα. Μπορείτε να χρησιμοποιήσετε αυτή η μέθοδος όταν επιλέξετε να μην χρησιμοποιήσετε Azure δημιουργίας αντιγράφων ασφαλείας και της υπηρεσίας ανάκτησης και θέλετε να δημιουργήσετε μια προσαρμοσμένη στρατηγική αντιγράφων ασφαλείας για δίσκων σας εικονική μηχανή.

Azure εικονική μηχανή δίσκων αποθηκεύονται ως αντικείμενα BLOB σελίδας στο χώρο αποθήκευσης Azure. Εφόσον μιλήσουμε για στρατηγική αντιγράφων ασφαλείας για εικονική μηχανή δίσκων σε αυτό το άρθρο, θα σας θα που αναφέρονται σε στιγμιότυπα στο περιβάλλον της αντικείμενα BLOB σελίδας. Για να μάθετε περισσότερα σχετικά με τα στιγμιότυπα, ανατρέξτε [δημιουργίας ενός στιγμιοτύπου από ένα αντικείμενο Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).

## <a name="what-is-a-snapshot"></a>Τι είναι ένα στιγμιότυπο;

Ένα στιγμιότυπο blob είναι μια έκδοση μόνο για ανάγνωση του ένα blob που καταγράφονται σε ένα σημείο στο χρόνο. Μόλις δημιουργηθεί ένα στιγμιότυπο, το μπορούν να διαβάσετε, αντιγραφή, ή διαγραφεί, αλλά δεν τροποποιηθεί. Στιγμιότυπα παρέχει κάποιο τρόπο για να δημιουργήσετε αντίγραφα ασφαλείας ένα blob, όπως εμφανίζεται σε μια συγκεκριμένη χρονική στιγμή. Μέχρι την ΥΠΌΛΟΙΠΗ έκδοση 2015-04-05 είχατε τη δυνατότητα να αντιγράψετε πλήρους στιγμιότυπα. Με τα ΥΠΌΛΟΙΠΑ έκδοση 2015-07-08 και παραπάνω, μπορείτε επίσης να αντιγράψετε αυξάνονται στιγμιότυπα.

## <a name="full-snapshot-copy"></a>Αντιγραφή πλήρους στιγμιότυπο

Στιγμιότυπα μπορούν να αντιγραφούν σε άλλο λογαριασμό χώρου αποθήκευσης ως blob για να διατηρήσετε αντίγραφα ασφαλείας των τη βασική blob. Μπορείτε επίσης να αντιγράψετε ένα στιγμιότυπο πάνω από τη βασική blob, που μοιάζει με την επαναφορά του blob με μια παλαιότερη έκδοση. Όταν ένα στιγμιότυπο αντιγράφεται από έναν λογαριασμό χώρου αποθήκευσης σε μια άλλη, καταλαμβάνουν τον ίδιο χώρο ως το blob βασικής σελίδας. Επομένως, αντιγραφή ολόκληρου στιγμιότυπα από ένα λογαριασμό χώρου αποθήκευσης σε μια άλλη θα είναι αργή και θα επίσης κατανάλωση πολύ χώρο στο λογαριασμό χώρου αποθήκευσης προορισμού.

>[AZURE.NOTE] Εάν αντιγράψετε τη βασική blob σε άλλον προορισμό, τα στιγμιότυπα από το αντικείμενο blob δεν αντιγράφονται μαζί με αυτήν. Ομοίως, εάν αντικαταστήσετε ένα βασικό blob με ένα αντίγραφο, στιγμιότυπα που σχετίζεται με τη βασική blob δεν επηρεάζονται και να παραμένετε ανέπαφη στην περιοχή όνομα βάσης blob.

### <a name="back-up-disks-using-snapshots"></a>Δημιουργία αντιγράφου ασφαλείας δίσκων με χρήση στιγμιότυπα

Ως μια στρατηγική αντιγράφων ασφαλείας για δίσκων σας εικονική μηχανή, μπορείτε να κάνετε περιοδικό στιγμιότυπων των αντικειμένων blob του δίσκου ή μια σελίδα, και αντιγράψτε τα σε άλλο λογαριασμό χώρου αποθήκευσης με εργαλεία όπως το [Αντίγραφο Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) λειτουργία ή [AzCopy](storage-use-azcopy.md). Μπορείτε να αντιγράψετε ένα στιγμιότυπο σε ένα αντικείμενο blob σελίδα προορισμού με διαφορετικό όνομα. Το που προκύπτει blob σελίδα προορισμού είναι ένα blob εγγράψιμο σελίδα και όχι ένα στιγμιότυπο. Παρακάτω σε αυτό το άρθρο θα σας θα περιγράφει τα βήματα για να αντίγραφα ασφαλείας των δίσκων εικονική μηχανή με χρήση στιγμιότυπα.

### <a name="restore-disks-using-snapshots"></a>Επαναφορά δίσκων με χρήση στιγμιότυπα

Όταν είναι καιρός να επαναφέρετε δίσκο σας σε μια προηγούμενη έκδοση σταθερό καταγράφονται σε ένα από τα στιγμιότυπα αντιγράφου ασφαλείας, μπορείτε να αντιγράψετε ένα στιγμιότυπο επάνω από το αντικείμενο blob βασικής σελίδας. Αφού το στιγμιότυπο προωθείται στη βασική σελίδα αντικειμένων blob, το στιγμιότυπο παραμένει, αλλά την προέλευσή αντικαθίσταται με ένα αντίγραφο που μπορούν να τόσο ανάγνωση και εγγραφή. Παρακάτω σε αυτό το άρθρο θα σας θα περιγράφει τα βήματα για να επαναφέρετε μια προηγούμενη έκδοση του δίσκου σας από το στιγμιότυπο.

### <a name="implementing-full-snapshot-copy"></a>Αντιγραφή εφαρμογής πλήρους στιγμιότυπο

Μπορείτε να υλοποιήσετε ένα αντίγραφο πλήρους στιγμιότυπο, κάνοντας τα εξής,

-   Πρώτα, δημιουργήστε ένα στιγμιότυπο από το βασικό blob χρησιμοποιώντας τη λειτουργία [Blob στιγμιότυπο](https://msdn.microsoft.com/library/azure/ee691971.aspx) .
-   Στη συνέχεια, αντιγράψτε το στιγμιότυπο σε ένα λογαριασμό του χώρου αποθήκευσης προορισμού χρησιμοποιώντας [Blob αντίγραφο](https://msdn.microsoft.com/library/azure/dd894037.aspx).
-   Επαναλάβετε αυτήν τη διαδικασία για να διατηρήσετε αντίγραφα ασφαλείας των σας βάσης blob.

## <a name="incremental-snapshot-copy"></a>Αντιγραφή αυξάνονται στιγμιότυπο

Η νέα δυνατότητα στο [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API παρέχει έναν πολύ καλύτερο τρόπο για να δημιουργήσετε αντίγραφα ασφαλείας των στιγμιοτύπων αντικείμενα BLOB σελίδας ή δίσκων. Το API επιστρέφει τη λίστα των αλλαγών μεταξύ του blob βάσης και τα στιγμιότυπα. Αυτό μειώνει την ποσότητα του χώρου αποθήκευσης που χρησιμοποιείται στο λογαριασμό του αντιγράφου ασφαλείας. Το API υποστηρίζει αντικείμενα BLOB σελίδας στο χώρο αποθήκευσης Premium, καθώς και τυπικές χώρου αποθήκευσης. Χρησιμοποιώντας αυτό το API, μπορείτε να δημιουργήσετε τώρα πιο γρήγορη και αποτελεσματική λύσεις δημιουργίας αντιγράφων ασφαλείας για ΣΠΣ Azure. Αυτό θα είναι διαθέσιμες με την έκδοση ΥΠΌΛΟΙΠΑ 2015-07-08 και νεότερη έκδοση.

Τμηματική αντιγραφή στιγμιότυπο σας επιτρέπει να αντιγράψετε από ένα λογαριασμό χώρου αποθήκευσης σε μια άλλη τη διαφορά μεταξύ,

-   Βασική blob και το στιγμιότυπο ή
-   Δύο στιγμιότυπα από τη βασική blob

Προϋπόθεση ότι πληρούνται οι ακόλουθες συνθήκες,

- Το αντικείμενο blob δημιουργήθηκε σε Ιαν-1-2016 ή νεότερη έκδοση.
- Το αντικείμενο blob δεν έχει αντικατασταθεί με [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) ή [Αντιγραφή αντικειμένων Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) μεταξύ των δύο στιγμιότυπα.


**Σημείωση**: Αυτή η δυνατότητα είναι διαθέσιμη για Premium και τυπική αντικείμενα BLOB σελίδα Azure.

Όταν έχετε μια προσαρμοσμένη στρατηγική αντιγράφων ασφαλείας που χρησιμοποιεί στιγμιότυπα, αντιγραφή τα στιγμιότυπα από ένα λογαριασμό χώρου αποθήκευσης σε άλλο μπορεί να είναι πολύ αργή και χρησιμοποιεί πολλά χώρου αποθήκευσης. Αντί να την αντιγράψετε ολόκληρο το στιγμιότυπο σε ένα λογαριασμό αποθήκευσης αντιγράφων ασφαλείας, μπορείτε να συντάξετε τη διαφορά μεταξύ διαδοχικών στιγμιοτύπων ένα blob αντιγράφου ασφαλείας της σελίδας. Με αυτόν τον τρόπο, το χρόνο για να αντιγράψετε και χώρο για την αποθήκευση αντιγράφων ασφαλείας μειώνεται σημαντικά.

### <a name="implementing-incremental-snapshot-copy"></a>Αντιγραφή εφαρμογής αυξάνονται στιγμιότυπο

Μπορείτε να υλοποιήσετε αυξάνονται στιγμιότυπο αντίγραφο, κάνοντας τα εξής,

-   Λάβετε ένα στιγμιότυπο του το βάσης blob χρησιμοποιώντας [Blob στιγμιότυπο](https://msdn.microsoft.com/library/azure/ee691971.aspx).
-   Αντιγράψτε το στιγμιότυπο στο λογαριασμό αποθήκευσης αντιγράφων ασφαλείας του προορισμού το [Αντίγραφο Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx). Αυτό θα είναι το αντικείμενο blob αντιγράφου ασφαλείας της σελίδας. Λάβετε ένα στιγμιότυπο του αυτό blob αντιγράφου ασφαλείας της σελίδας και να αποθηκεύσετε στο λογαριασμό δημιουργίας αντιγράφων ασφαλείας.
-   Λάβετε ένα άλλο στιγμιότυπο του το βάσης blob χρησιμοποιώντας Blob στιγμιότυπο.
-   Λάβετε τη διαφορά μεταξύ της πρώτης και της δεύτερης στιγμιότυπων των βάσης blob χρησιμοποιώντας [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx). Χρησιμοποιήστε το νέο παραμέτρου **prevsnapshot** για να καθορίσετε την τιμή ημερομηνίας/ώρας από το οποίο θέλετε να λάβετε τη διαφορά με στιγμιότυπο. Όταν υπάρχει αυτή η παράμετρος, η απόκριση ΥΠΌΛΟΙΠΟ θα περιλαμβάνει μόνο τις σελίδες που έχουν αλλάξει μεταξύ στιγμιότυπο προορισμού και προηγούμενο στιγμιότυπο, συμπεριλαμβανομένων των σελίδων Απαλοιφή.
-   Χρησιμοποιήστε [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) για να εφαρμόσετε αυτές τις αλλαγές του blob αντιγράφου ασφαλείας της σελίδας.
-   Τέλος, να καταγράψετε ένα στιγμιότυπο του blob του αντιγράφου ασφαλείας της σελίδας και αποθηκεύστε το στο λογαριασμό αποθήκευσης αντιγράφων ασφαλείας.

Στην επόμενη ενότητα, θα σας θα περιγράφουν με περισσότερες λεπτομέρειες πώς μπορείτε να διατηρείτε αντίγραφα ασφαλείας των δίσκων με χρήση αντιγραφής αυξάνονται στιγμιότυπο

## <a name="scenario"></a>Σενάριο

Σε αυτήν την ενότητα θα σας θα περιγράφουν ένα σενάριο που περιλαμβάνει ένα προσαρμοσμένο στρατηγική αντιγράφων ασφαλείας για χρήση των στιγμιότυπων δίσκων εικονική μηχανή.

Εξετάστε το ενδεχόμενο μια Εικονική Azure σειράς DS σε ένα δίσκο P30 χώρου αποθήκευσης premium συνημμένα. Ο δίσκος P30 που ονομάζεται *mypremiumdisk* αποθηκεύονται σε ένα άρτιο χώρου αποθήκευσης που ονομάζεται *mypremiumaccount*. Ένας λογαριασμός τυπική χώρου αποθήκευσης που ονομάζεται *mybackupstdaccount* θα χρησιμοποιηθεί για την αποθήκευση το αντίγραφο ασφαλείας της *mypremiumdisk*. Θα σας θα θέλατε να διατηρήσετε ένα στιγμιότυπο του *mypremiumdisk* κάθε 12 ώρες.

Για να μάθετε περισσότερα σχετικά με τη δημιουργία λογαριασμού χώρου αποθήκευσης και δίσκων, ανατρέξτε [Azure σχετικά με τους λογαριασμούς χώρου αποθήκευσης](storage-create-storage-account.md).

Για να μάθετε περισσότερα σχετικά με τη δημιουργία αντιγράφων ασφαλείας ΣΠΣ Azure, ανατρέξτε [Εικονική Azure πρόγραμμα δημιουργίας αντιγράφων ασφαλείας](../backup/backup-azure-vms-introduction.md).

## <a name="steps-to-maintain-backups-of-a-disk-using-incremental-snapshots"></a>Βήματα για να διατηρήσετε αντίγραφα ασφαλείας των ένα δίσκο χρησιμοποιώντας αυξάνονται στιγμιότυπα

Τα βήματα που περιγράφονται παρακάτω θα στιγμιότυπα για *mypremiumdisk* και να διατηρήσετε τα αντίγραφα ασφαλείας σε *mybackupstdaccount*. Το αντίγραφο ασφαλείας θα είναι μια τυπική σελίδα blob που ονομάζεται *mybackupstdpageblob*. Το αντικείμενο blob αντιγράφου ασφαλείας της σελίδας θα αντανακλούν πάντα την ίδια κατάσταση ως το τελευταίο στιγμιότυπο του *mypremiumdisk*.

1.  Πρώτα, δημιουργήστε το blob αντιγράφου ασφαλείας της σελίδας για το χώρο αποθήκευσης στο δίσκο σας premium. Για να το κάνετε αυτό, δημιουργήστε ένα στιγμιότυπο της *mypremiumdisk* που ονομάζεται *mypremiumdisk_ss1*.
2.  Αντιγράψτε αυτό το στιγμιότυπο mybackupstdaccount ως blob σελίδας που ονομάζεται *mybackupstdpageblob*.
3.  Λάβετε ένα στιγμιότυπο του *mybackupstdpageblob* που ονομάζεται *mybackupstdpageblob_ss1*, με χρήση [Αντικειμένων Blob στιγμιότυπο](https://msdn.microsoft.com/library/azure/ee691971.aspx) και αποθηκεύστε το στο *mybackupstdaccount*.
4.  Κατά τη διάρκεια δημιουργίας αντιγράφων ασφαλείας του παραθύρου, δημιουργήστε μια άλλη στιγμιότυπο των *mypremiumdisk*, πείτε *mypremiumdisk_ss2*και αποθηκεύστε το στο *mypremiumaccount*.
5.  Λάβετε τις αλλαγές βηματική μεταξύ των δύο στιγμιοτύπων, *mypremiumdisk_ss2* και *mypremiumdisk_ss1*, χρησιμοποιώντας [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) στο *mypremiumdisk_ss2* με την παράμετρο **prevsnapshot** ορίστε τη χρονική σήμανση του *mypremiumdisk_ss1*. Η εγγραφή αυτές οι αλλαγές βηματική αντικειμένων blob του αντιγράφου ασφαλείας της σελίδας *mybackupstdpageblob* στο *mybackupstdaccount*. Εάν υπάρχουν διαγραμμένες περιοχές στο τις αλλαγές βηματική, πρέπει να διαγραφούν από το αντικείμενο blob αντιγράφου ασφαλείας της σελίδας. Χρησιμοποιήστε [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) για να γράψετε αλλαγές βηματική για το αντικείμενο blob αντιγράφου ασφαλείας της σελίδας.
6.  Λάβετε ένα στιγμιότυπο του του αντιγράφου ασφαλείας της σελίδας blob *mybackupstdpageblob*, που ονομάζεται *mybackupstdpageblob_ss2*. Διαγράψτε το προηγούμενο στιγμιότυπο *mypremiumdisk_ss1* από το λογαριασμό χώρου αποθήκευσης premium.
7.  Επαναλάβετε τα βήματα 4-6 κάθε παραθύρου δημιουργίας αντιγράφων ασφαλείας. Με αυτόν τον τρόπο, μπορείτε να διατηρείτε αντίγραφα ασφαλείας των *mypremiumdisk* σε λογαριασμό τυπική χώρου αποθήκευσης.

![Δημιουργία αντιγράφου ασφαλείας δίσκου χρησιμοποιώντας αυξάνονται στιγμιότυπα](./media/storage-incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-to-restore-a-disk-from-snapshots"></a>Βήματα για να επαναφέρετε ένα δίσκο από στιγμιότυπα

Τα βήματα που περιγράφονται παρακάτω θα γίνει επαναφορά premium δίσκο, *mypremiumdisk* σε μια προηγούμενη στιγμιότυπο από το λογαριασμό αποθήκευσης αντιγράφων ασφαλείας *mybackupstdaccount*.

1.  Προσδιορίστε το σημείο στην ώρα που θέλετε να επαναφέρετε το δίσκο premium για να. Ας υποθέσουμε ότι αυτό είναι στιγμιότυπο *mybackupstdpageblob_ss2*, που είναι αποθηκευμένη στο λογαριασμό του αποθήκευσης αντιγράφων ασφαλείας *mybackupstdaccount*.
2.  Στο mybackupstdaccount, προωθήστε το στιγμιότυπο *mybackupstdpageblob_ss2* ως το νέο blob αντιγράφου ασφαλείας της βάσης σελίδας *mybackupstdpageblobrestored*.
3.  Λάβετε ένα στιγμιότυπο του αυτό blob επαναφορά αντιγράφου ασφαλείας της σελίδας, που ονομάζεται *mybackupstdpageblobrestored_ss1*.
4.  Αντιγράψτε το blob επαναφέρει σελίδα *mybackupstdpageblobrestored* από *mybackupstdaccount* *mypremiumaccount* ως το νέο δίσκο premium *mypremiumdiskrestored*.
5.  Λάβετε ένα στιγμιότυπο του *mypremiumdiskrestored*, που ονομάζεται *mypremiumdiskrestored_ss1* για δημιουργία αντιγράφων ασφαλείας μελλοντική αυξάνονται.
6.  Σημείο DS σειρά Εικονική για να το επαναφέρετε δίσκο *mypremiumdiskrestored* και απόσπαση το παλιό *mypremiumdisk* από την εικονική Μηχανή.
7.  Ξεκινήστε τη διαδικασία δημιουργίας αντιγράφων ασφαλείας που περιγράφεται στην προηγούμενη ενότητα για την επαναφορά δίσκου *mypremiumdiskrestored*, χρησιμοποιώντας το *mybackupstdpageblobrestored* ως blob του αντιγράφου ασφαλείας της σελίδας.

![Επαναφορά δίσκου από στιγμιότυπα](./media/storage-incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a>Επόμενα βήματα

Μάθετε περισσότερα σχετικά με τη δημιουργία στιγμιότυπα από ένα blob και σχεδιασμός υποδομή αντιγράφων ασφαλείας Εικονική σας χρησιμοποιώντας τις παρακάτω συνδέσεις.

- [Δημιουργία ένα στιγμιότυπο του ένα Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx)
- [Σχεδιασμός δημιουργίας αντιγράφων ασφαλείας υποδομής σας Εικονική](../backup/backup-azure-vms-introduction.md)
