<properties
    pageTitle="Δημιουργήστε ένα στιγμιότυπο μόνο για ανάγνωση του ένα blob | Microsoft Azure"
    description="Μάθετε πώς μπορείτε να δημιουργήσετε ένα στιγμιότυπο του ένα blob για να δημιουργήσετε αντίγραφα ασφαλείας των δεδομένων blob σε μια δεδομένη χρονική στιγμή. Κατανόηση πώς θα χρεωθεί στιγμιότυπα και πώς μπορείτε να τις χρησιμοποιήσετε για να ελαχιστοποιήσετε την ικανότητα χρεώσεις."
    services="storage"
    documentationCenter=""
    authors="tamram"
    manager="carmonm"
    editor="tysonn"/>

<tags
    ms.service="storage"
    ms.workload="storage"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/18/2016"
    ms.author="tamram"/>

# <a name="create-a-blob-snapshot"></a>Δημιουργήστε ένα στιγμιότυπο blob

## <a name="overview"></a>Επισκόπηση

Ένα στιγμιότυπο είναι μια έκδοση μόνο για ανάγνωση του ένα blob που λαμβάνεται σε ένα σημείο στο χρόνο. Τα στιγμιότυπα είναι χρήσιμη για τη δημιουργία αντιγράφων ασφαλείας αντικείμενα blob. Αφού δημιουργήσετε ένα στιγμιότυπο, μπορείτε να διαβάσετε, να αντιγράψετε ή να διαγράψετε, αλλά δεν μπορείτε να το τροποποιήσετε.

Ένα στιγμιότυπο του ένα blob είναι ίδια με τη βασική blob, με τη διαφορά ότι το αντικείμενο blob URI περιλαμβάνει μια τιμή **DateTime** προσαρτημένο σε το αντικείμενο blob URI για να υποδείξετε την ώρα κατά την οποία πραγματοποιήθηκε το στιγμιότυπο. Για παράδειγμα, εάν μια σελίδα blob URI είναι `http://storagesample.core.blob.windows.net/mydrives/myvhd`, το στιγμιότυπο URI είναι παρόμοια με `http://storagesample.core.blob.windows.net/mydrives/myvhd?snapshot=2011-03-09T01:42:34.9360000Z`. 

> [AZURE.NOTE] Όλα τα στιγμιότυπα κοινή χρήση της βάσης blob URI. Η μόνο διάκριση μεταξύ του blob βάσης και το στιγμιότυπο είναι την προσαρτημένη τιμή **ημερομηνίας/ώρας** .

Ένα blob μπορεί να έχει οποιονδήποτε αριθμό στιγμιότυπα. Στιγμιότυπα διατηρούνται έως ότου ρητά διαγράφονται. Ένα στιγμιότυπο δεν είναι δυνατό να outlive τη βασική blob. Μπορείτε να απαριθμήσετε τα στιγμιότυπα που σχετίζεται με τη βασική blob για να παρακολουθείτε την τρέχουσα στιγμιότυπα.

Όταν δημιουργείτε ένα στιγμιότυπο του ένα blob, ιδιότητες συστήματος του blob αντιγράφονται το στιγμιότυπο οθόνης με τις ίδιες τιμές. Η βασική αντικειμένων blob μετα-δεδομένων αντιγράφεται επίσης το στιγμιότυπο οθόνης, εκτός εάν καθορίσετε ξεχωριστές μετα-δεδομένων για το στιγμιότυπο κατά τη δημιουργία της.

Οποιαδήποτε μισθώσεις που σχετίζεται με τη βασική blob δεν επηρεάζουν το στιγμιότυπο. Δεν είναι δυνατό να αποκτήσετε μια μίσθωση σε ένα στιγμιότυπο.

## <a name="create-a-snapshot"></a>Δημιουργία ενός στιγμιότυπου

Το παρακάτω παράδειγμα κώδικα εμφανίζει τον τρόπο δημιουργίας ενός στιγμιοτύπου στο .NET. Αυτό το παράδειγμα καθορίζει ξεχωριστή μετα-δεδομένων για το στιγμιότυπο κατά τη δημιουργία.

    private static async Task CreateBlockBlobSnapshot(CloudBlobContainer container)
    {
        // Create a new block blob in the container.
        CloudBlockBlob baseBlob = container.GetBlockBlobReference("sample-base-blob.txt");

        // Add blob metadata.
        baseBlob.Metadata.Add("ApproxBlobCreatedDate", DateTime.UtcNow.ToString());

        try
        {
            // Upload the blob to create it, with its metadata.
            await baseBlob.UploadTextAsync(string.Format("Base blob: {0}", baseBlob.Uri.ToString()));

            // Sleep 5 seconds.
            System.Threading.Thread.Sleep(5000);

            // Create a snapshot of the base blob.
            // Specify metadata at the time that the snapshot is created to specify unique metadata for the snapshot.
            // If no metadata is specified when the snapshot is created, the base blob's metadata is copied to the snapshot.
            Dictionary<string, string> metadata = new Dictionary<string, string>();
            metadata.Add("ApproxSnapshotCreatedDate", DateTime.UtcNow.ToString());
            await baseBlob.CreateSnapshotAsync(metadata, null, null, null);
        }
        catch (StorageException e)
        {
            Console.WriteLine(e.Message);
            Console.ReadLine();
            throw;
        }
    }
 

## <a name="copy-snapshots"></a>Αντιγραφή στιγμιότυπα

Λειτουργίες αντιγραφής που αφορούν αντικείμενα BLOB και στιγμιότυπα Ακολουθήστε αυτούς τους κανόνες:

- Μπορείτε να αντιγράψετε ένα στιγμιότυπο πάνω από τη βασική blob. Κατά την προώθηση ενός στιγμιοτύπου στη θέση του το βασικό blob, μπορείτε να επαναφέρετε μια προηγούμενη έκδοση του ένα blob. Το στιγμιότυπο παραμένει, αλλά τη βάση blob αντικαθίσταται με ένα εγγράψιμο αντίγραφο της το στιγμιότυπο.

- Μπορείτε να αντιγράψετε ένα στιγμιότυπο σε ένα blob προορισμού με διαφορετικό όνομα. Το που προκύπτει blob προορισμού είναι ένα εγγράψιμο blob και όχι ένα στιγμιότυπο.

- Κατά την αντιγραφή ένα blob προέλευσης, οποιαδήποτε στιγμιότυπα από το αντικείμενο blob προέλευσης δεν αντιγράφονται στον προορισμό. Όταν ένα blob προορισμού αντικαθίσταται με ένα αντίγραφο, στιγμιότυπα που σχετίζεται με το αρχικό blob προορισμού παραμένουν ανέπαφες.

- Όταν δημιουργείτε ένα στιγμιότυπο του ένα μπλοκ blob, λίστα δεσμευμένη μπλοκ το αντικείμενο blob αντιγράφεται επίσης το στιγμιότυπο. Οποιαδήποτε μη ολοκληρωμένη μπλοκ δεν αντιγράφονται.

## <a name="specify-an-access-condition"></a>Να καθορίσετε μια συνθήκη πρόσβασης

Μπορείτε να καθορίσετε μια συνθήκη πρόσβασης ώστε να δημιουργηθεί το στιγμιότυπο μόνο αν ικανοποιείται μια συνθήκη. Για να καθορίσετε μια συνθήκη access, χρησιμοποιήστε την ιδιότητα **AccessCondition** . Εάν η καθορισμένη δεν συνθήκη, το στιγμιότυπο δεν έχει δημιουργηθεί και την υπηρεσία Blob επιστρέφει κωδικός κατάστασης HTTPStatusCode.PreconditionFailed.

## <a name="delete-snapshots"></a>Διαγραφή στιγμιότυπα

Δεν μπορείτε να διαγράψετε ένα blob με τα στιγμιότυπα, εκτός εάν τα στιγμιότυπα διαγράφονται επίσης. Μπορείτε να διαγράψετε ένα στιγμιότυπο μεμονωμένα ή να καθορίσετε ότι όλα τα στιγμιότυπα διαγραφούν όταν διαγράφεται η blob προέλευσης. Εάν προσπαθήσετε να διαγράψετε ένα blob που εξακολουθεί να έχει στιγμιότυπα, προκύπτει σφάλμα.

Το ακόλουθο παράδειγμα κώδικα δείχνει πώς μπορείτε να διαγράψετε ένα blob και τα στιγμιότυπα στο .NET, όπου `blockBlob` είναι μια μεταβλητή τύπου **CloudBlockBlob**:

    await blockBlob.DeleteIfExistsAsync(DeleteSnapshotsOption.IncludeSnapshots, null, null, null);

## <a name="snapshots-with-azure-premium-storage"></a>Στιγμιότυπα με Azure Premium αποθήκευσης

Χρήση των στιγμιότυπων με Premium χώρου αποθήκευσης, ακολουθήστε αυτούς τους κανόνες:

- Ο μέγιστος αριθμός στιγμιότυπα ανά blob σελίδας σε ένα άρτιο χώρου αποθήκευσης είναι 100. Εάν έχει υπερβεί το όριο, η λειτουργία Blob στιγμιότυπο επιστρέφει τον κωδικό σφάλματος 409 (**SnapshotCountExceeded**).

- Μπορείτε να κρατήσετε ένα στιγμιότυπο του blob μια σελίδα σε ένα λογαριασμό του χώρου αποθήκευσης premium μία φορά κάθε 10 λεπτά. Εάν ο συντελεστής ξεπεραστεί, η λειτουργία Blob στιγμιότυπο επιστρέφει τον κωδικό σφάλματος 409 (**SnaphotOperationRateExceeded**).

- Δεν μπορείτε να καλέσετε Blob λήψη για να διαβάσετε ένα στιγμιότυπο του ένα blob σελίδας σε ένα άρτιο χώρου αποθήκευσης. Κλήση Blob γρήγορα σε ένα στιγμιότυπο σε ένα λογαριασμό του χώρου αποθήκευσης premium επιστρέφει τον κωδικό σφάλματος 400 (**InvalidOperation**). Ωστόσο, μπορείτε να καλέσετε λήψη ιδιοτήτων αντικειμένων Blob και λάβετε Blob μετα-δεδομένων σε σχέση με ένα στιγμιότυπο σε ένα άρτιο χώρου αποθήκευσης.

- Για να διαβάσετε ένα στιγμιότυπο, μπορείτε να χρησιμοποιήσετε τη λειτουργία Blob Αντιγραφή για να αντιγράψετε ένα στιγμιότυπο σε μια άλλη σελίδα blob στο λογαριασμό. Το αντικείμενο blob προορισμού για τη λειτουργία αντιγραφής δεν πρέπει να περιέχει οποιαδήποτε υπάρχοντα στιγμιότυπα. Εάν το αντικείμενο blob προορισμού έχουν στιγμιότυπα, στη συνέχεια, τη λειτουργία Αντιγραφή αντικειμένων Blob επιστρέφει τον κωδικό σφάλματος 409 (**SnapshotsPresent**).

## <a name="return-the-absolute-uri-to-a-snapshot"></a>Επιστροφή απόλυτη URI ένα στιγμιότυπο

Το παράδειγμα κώδικα C# δημιουργεί ένα στιγμιότυπο και συντάσσει εκτός του απόλυτη URI για τα κύρια θέση.

    //Create the blob service client object.
    const string ConnectionString = "DefaultEndpointsProtocol=https;AccountName=account-name;AccountKey=account-key";

    CloudStorageAccount storageAccount = CloudStorageAccount.Parse(ConnectionString);
    CloudBlobClient blobClient = storageAccount.CreateCloudBlobClient();

    //Get a reference to a container.
    CloudBlobContainer container = blobClient.GetContainerReference("sample-container");
    container.CreateIfNotExists();

    //Get a reference to a blob.
    CloudBlockBlob blob = container.GetBlockBlobReference("sampleblob.txt");
    blob.UploadText("This is a blob.");

    //Create a snapshot of the blob and write out its primary URI.
    CloudBlockBlob blobSnapshot = blob.CreateSnapshot();
    Console.WriteLine(blobSnapshot.SnapshotQualifiedStorageUri.PrimaryUri);

## <a name="understand-how-snapshots-accrue-charges"></a>Κατανόηση τρόπου στιγμιότυπα συσσώρευσης χρεώσεων

Δημιουργία ένα στιγμιότυπο, το οποίο είναι ένα αντίγραφο μόνο για ανάγνωση του ένα blob, μπορεί να έχει ως αποτέλεσμα χρεώσεις αποθήκευσης πρόσθετα δεδομένα στο λογαριασμό σας. Κατά τη σχεδίαση την εφαρμογή σας, είναι σημαντικό να γνωρίζετε πώς μπορεί να προσαύξηση αυτές τις χρεώσεις, έτσι ώστε να μπορείτε να ελαχιστοποιήσετε κόστους δεν είναι απαραίτητες.

### <a name="important-billing-considerations"></a>Σημαντικά θέματα χρεώσεων

Η παρακάτω λίστα περιλαμβάνει τα βασικά σημεία πρέπει να λάβετε υπόψη κατά τη δημιουργία ενός στιγμιοτύπου.

- Χώρος αποθήκευσης λογαριασμό των περιλαμβάνει χρεώσεις για μοναδικές μπλοκ ή σελίδες, είτε είναι στο αντικείμενο blob είτε στο στιγμιότυπο. Ο λογαριασμός σας δεν προκύψουν πρόσθετες χρεώσεις για στιγμιότυπα που σχετίζεται με ένα blob μέχρι να ενημερώσετε το αντικείμενο blob στα οποία βασίζονται. Μετά την ενημέρωση του βάσης blob, αποκλίνει από τα στιγμιότυπα. Όταν συμβαίνει αυτό, θα χρεωθείτε για τα μπλοκ μοναδικών ή των σελίδων σε κάθε blob ή στιγμιότυπο.

- Όταν αντικαθιστάτε ένα μπλοκ μέσα σε ένα μπλοκ blob, που αποκλείουν χρεώνεται αργότερα ως ένα μοναδικό μπλοκ. Αυτό ισχύει ακόμα και αν ο αποκλεισμός έχει το ίδιο Αναγνωριστικό μπλοκ και τα ίδια δεδομένα όπως έχει στο στιγμιότυπο. Όταν δεσμευτεί το μπλοκ ξανά, το αποκλίνει από το αντίστοιχο σε οποιαδήποτε στιγμιότυπο και θα χρεωθεί για τα δεδομένα του. Το ίδιο ισχύει για μια σελίδα σε ένα blob σελίδας που είναι ενημερωθεί με πανομοιότυπες δεδομένα.

- Αντικατάσταση ενός μπλοκ blob καλώντας τη μέθοδο **UploadFile θα**, **UploadText**, **UploadStream**ή **UploadByteArray** αντικαθιστά όλα τα μπλοκ στο αντικείμενο blob. Εάν έχετε ένα στιγμιότυπο που σχετίζεται με το αντικείμενο blob, όλα τα μπλοκ στη βασική blob και στιγμιότυπο τώρα εξελίσσονται και θα χρεωθεί για όλα τα μπλοκ σε δύο αντικείμενα blob. Αυτό ισχύει ακόμα και εάν τα δεδομένα σε τη βασική blob και το στιγμιότυπο παραμένουν ίδιες.

- Η υπηρεσία αντικειμένων Blob του Azure δεν διαθέτει ένα μέσο για να προσδιορίσετε αν δύο μπλοκ περιέχουν τα ίδια δεδομένα. Κάθε μπλοκ που έχουν αποσταλεί και δεσμευμένου αντιμετωπίζεται ως μοναδικές, ακόμα και αν έχει τα ίδια δεδομένα και το ίδιο αναγνωριστικό μπλοκ. Επειδή χρεώσεις προσαύξηση για μοναδικές μπλοκ, είναι σημαντικό να λαμβάνετε υπόψη που ενημερώσετε ένα blob που περιλαμβάνει ένα στιγμιότυπο αποτελέσματα σε επιπλέον μοναδικό μπλοκ και πρόσθετες χρεώσεις.

> [AZURE.NOTE] Βέλτιστες πρακτικές διάρκεια της υπαγόρευσης που διαχειρίζεστε στιγμιότυπα προσεκτικά για να αποφύγετε επιπλέον χρεώσεις. Συνιστάται να διαχειρίζεστε στιγμιότυπα με τον ακόλουθο τρόπο:

> - Διαγραφή και εκ νέου δημιουργία στιγμιότυπα που σχετίζεται με ένα blob κάθε φορά που ενημερώνετε το αντικείμενο blob, ακόμα και αν θέλετε να ενημερώσετε με πανομοιότυπες δεδομένα, εκτός εάν η σχεδίαση της εφαρμογής σας απαιτεί να διατηρείτε στιγμιότυπα. Διαγράφοντας και να δημιουργήσετε ξανά το αντικείμενο blob στιγμιότυπα, μπορείτε να διασφαλίσετε ότι η blob και στιγμιότυπα δεν εξελίσσονται.

> - Εάν διατηρείτε στιγμιότυπα για ένα blob, αποφύγετε την κλήση **UploadFile θα**, **UploadText**, **UploadStream**ή **UploadByteArray** για να ενημερώσετε το αντικείμενο blob. Αυτές τις μεθόδους αντικατάσταση όλων των μπλοκ στο αντικείμενο blob, έτσι ώστε το βασικό blob και στιγμιότυπα εξελίσσονται έχουν σημαντικές. Αντί για αυτό, μπορείτε να ενημερώσετε το μικρότερο δυνατό αριθμό μπλοκ, χρησιμοποιώντας τις μεθόδους **PutBlock** και **PutBlockList** .


### <a name="snapshot-billing-scenarios"></a>Στιγμιότυπο χρεώσεις σενάρια


Τα παρακάτω σενάρια που καταδεικνύουν τρόπου συσσώρευσης χρεώσεις για ένα μπλοκ blob και τα στιγμιότυπα.

Σε σενάριο 1, η βασική blob δεν έχει ενημερωθεί μετά το στιγμιότυπο τραβήξατε, ώστε να χρεώσεις προκύπτουν μόνο για το μοναδικό μπλοκ 1, 2 και 3.

![Azure πόρων αποθήκευσης](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-1.png)

Στο σενάριο 2, η βασική blob έχει ενημερωθεί, αλλά δεν έχει το στιγμιότυπο. Μπλοκ 3 ενημερώθηκε και Παρόλο που περιέχει τα ίδια δεδομένα και το ίδιο Αναγνωριστικό, δεν είναι ίδια όπως αποκλεισμός 3 στο στιγμιότυπο. Ως αποτέλεσμα, ο λογαριασμός θα χρεωθεί για τέσσερις μπλοκ.

![Azure πόρων αποθήκευσης](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-2.png)

Σε σενάριο 3, η βασική blob έχει ενημερωθεί, αλλά δεν έχει το στιγμιότυπο. Μπλοκ 3 έχει αντικατασταθεί με μπλοκ 4 στο αντικείμενο blob βάσης, αλλά το στιγμιότυπο εξακολουθεί να απεικονίζει μπλοκ 3. Ως αποτέλεσμα, ο λογαριασμός θα χρεωθεί για τέσσερις μπλοκ.

![Azure πόρων αποθήκευσης](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-3.png)

Σε σενάριο 4, η βασική blob έχει ενημερωθεί πλήρως και περιέχει κανένα από τα αρχικά μπλοκ. Ως αποτέλεσμα, ο λογαριασμός θα χρεωθεί για όλα τα οκτώ μπλοκ μοναδικών τιμών. Αυτό το σενάριο μπορεί να προκύψει εάν χρησιμοποιείτε μια μέθοδο update όπως **UploadFile θα**, **UploadText**, **UploadFromStream**ή **UploadByteArray**, επειδή αυτές οι μέθοδοι αντικατάσταση όλων των περιεχομένων του ένα blob.

![Azure πόρων αποθήκευσης](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-4.png)

## <a name="next-steps"></a>Επόμενα βήματα

Για περισσότερα παραδείγματα χρησιμοποιώντας χώρο αποθήκευσης αντικειμένων Blob, ανατρέξτε στο θέμα [Δείγματα κώδικα Azure](https://azure.microsoft.com/documentation/samples/?service=storage&term=blob). Μπορείτε να κάνετε λήψη ενός δείγματος εφαρμογής και εκτελέστε το ή αναζητήστε τον κωδικό στη GitHub. 
