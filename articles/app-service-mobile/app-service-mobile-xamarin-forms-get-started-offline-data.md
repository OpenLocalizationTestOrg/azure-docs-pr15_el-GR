<properties
    pageTitle="Ενεργοποίηση του συγχρονισμού χωρίς σύνδεση για την εφαρμογή Mobile Azure (Xamarin.Forms) | Microsoft Azure"
    description="Μάθετε πώς να χρησιμοποιείτε την εφαρμογή Mobile εφαρμογής υπηρεσίας στο cache και συγχρονισμός δεδομένων χωρίς σύνδεση στην εφαρμογή σας Xamarin.Forms"
    documentationCenter="xamarin"
    authors="adrianhall"
    manager="yochayk"
    editor=""
    services="app-service\mobile"/>

<tags
    ms.service="app-service-mobile"
    ms.workload="mobile"
    ms.tgt_pltfrm="mobile-xamarin-ios"
    ms.devlang="dotnet"
    ms.topic="article"
    ms.date="10/04/2016"
    ms.author="adrianha"/>

# <a name="enable-offline-sync-for-your-xamarinforms-mobile-app"></a>Ενεργοποίηση του συγχρονισμού χωρίς σύνδεση για την εφαρμογή για κινητές συσκευές Xamarin.Forms

[AZURE.INCLUDE [app-service-mobile-selector-offline](../../includes/app-service-mobile-selector-offline.md)]

## <a name="overview"></a>Επισκόπηση
Αυτό το πρόγραμμα εκμάθησης παρουσιάζει τη δυνατότητα συγχρονισμού χωρίς σύνδεση του Azure Mobile Apps για Xamarin.Forms. Συγχρονισμού χωρίς σύνδεση επιτρέπει στους τελικούς χρήστες να αλληλεπιδράσετε με μια εφαρμογή για κινητές συσκευές--προβολή, προσθήκη ή τροποποίηση δεδομένων--ακόμα και όταν δεν υπάρχει σύνδεση δικτύου. Οι αλλαγές αποθηκεύονται σε μια τοπική βάση δεδομένων. Όταν η συσκευή είναι πάλι σε σύνδεση, αυτές οι αλλαγές συγχρονίζονται με την υπηρεσία απομακρυσμένης.

Αυτό το πρόγραμμα εκμάθησης είναι βάσει της λύσης γρήγορη έναρξη Xamarin.Forms για εφαρμογές του Mobile που δημιουργείτε όταν ολοκληρωθεί το πρόγραμμα εκμάθησης [δημιουργία μια εφαρμογή iOS Xamarin]. Η λύση γρήγορης έναρξης για Xamarin.Forms περιέχει τον κωδικό για την υποστήριξη συγχρονισμού χωρίς σύνδεση, η οποία πρέπει απλώς να ενεργοποιηθεί. Σε αυτό το πρόγραμμα εκμάθησης, μπορείτε να ενημερώσετε τη λύση γρήγορης έναρξης για να ενεργοποιήσετε τις δυνατότητες για εργασία χωρίς σύνδεση του Azure εφαρμογές του Mobile. Θα σας επισημάνετε επίσης τον κωδικό ειδικά για εργασία χωρίς σύνδεση στην εφαρμογή. Εάν δεν χρησιμοποιείτε τη λύση γρήγορη Έναρξη λήψης, πρέπει να προσθέσετε τα πακέτα επέκτασης πρόσβασης δεδομένων στο έργο σας. Για περισσότερες πληροφορίες σχετικά με τα πακέτα επέκτασης server, ανατρέξτε στο θέμα [εργασία με το διακομιστή υποστήριξης .NET SDK για εφαρμογές του Mobile Azure][1].

Για να μάθετε περισσότερα σχετικά με τη δυνατότητα συγχρονισμού χωρίς σύνδεση, ανατρέξτε στο θέμα [Συγχρονισμού χωρίς σύνδεση δεδομένων σε εφαρμογές του Mobile Azure][2].

## <a name="enable-offline-sync-functionality-in-the-quickstart-solution"></a>Ενεργοποίηση της δυνατότητας συγχρονισμού χωρίς σύνδεση στη λύση γρήγορη έναρξη

Περιλαμβάνεται ο κώδικας συγχρονισμού χωρίς σύνδεση του έργου με τη χρήση οδηγίες προεπεξεργαστή C#. Όταν το **χωρίς ΣΎΝΔΕΣΗ\_ΣΥΓΧΡΟΝΙΣΜΟΎ\_ΕΝΕΡΓΟΠΟΙΗΜΈΝΟ** ορίζεται σύμβολο, περιλαμβάνονται αυτές τις διαδρομές κώδικα στο Δημιουργία. Για τις εφαρμογές των Windows, μπορείτε, επίσης, πρέπει να εγκαταστήσετε την πλατφόρμα SQLite.

1. Στο Visual Studio, κάντε δεξί κλικ της λύσης > **Διαχείριση πακέτων NuGet για λύση...**, στη συνέχεια, αναζητήστε και εγκαταστήστε το πακέτο NuGet **Microsoft.Azure.Mobile.Client.SQLiteStore** για όλα τα έργα από τη λύση.

2. Στην Εξερεύνηση λύσεων, ανοίξτε το αρχείο TodoItemManager.cs από το έργο με **φορητή** στο όνομά της, που είναι φορητό βιβλιοθήκη κλάσεων έργου, στη συνέχεια, καταργήστε τα σχόλια από την παρακάτω οδηγία προεπεξεργαστή:

        #define OFFLINE_SYNC_ENABLED

4. (Προαιρετικό) Για να υποστηρίζουν συσκευές με Windows, εγκαταστήστε ένα από τα εξής πακέτα χρόνου εκτέλεσης SQLite:

    * **Χρόνου εκτέλεσης Windows 8.1:** Εγκατάσταση [SQLite για τα Windows 8.1][3].
    * **Windows Phone 8.1:** Εγκατάσταση [SQLite για Windows Phone 8.1][4].
    * **Πλατφόρμα γενικής χρήσης των Windows** Εγκατάσταση [SQLite για την καθολική Windows Universal][5].

    Παρόλο που η γρήγορη έναρξη δεν περιέχει ένα έργο καθολικής Windows, την πλατφόρμα Windows καθολικής υποστηρίζεται με φόρμες Xamarin.

5. (Προαιρετικό) Σε κάθε έργο εφαρμογής των Windows, κάντε δεξί κλικ σε **αναφορές** > **Προσθήκη αναφοράς...**, αναπτύξτε το φάκελο **των Windows** > **επεκτάσεις**.
    Ενεργοποιήστε την κατάλληλη **SQLite για Windows** SDK μαζί με τη **Visual C++ 2013 Runtime για Windows** SDK.
    Τα ονόματα SQLite SDK λίγο ανάλογα με κάθε πλατφόρμα των Windows.

## <a name="review-the-client-sync-code"></a>Αναθεώρηση του κώδικα συγχρονισμού προγράμματος-πελάτη

Ακολουθεί μια σύντομη επισκόπηση του τι περιλαμβάνεται ήδη τον κώδικα προγραμμάτων εκμάθησης εντός του `#if OFFLINE_SYNC_ENABLED` οδηγίες. Η λειτουργία συγχρονισμού χωρίς σύνδεση είναι στο αρχείο έργου TodoItemManager.cs του έργου Portable βιβλιοθήκη κλάσεων. Για μια επισκόπηση της δυνατότητας, ανατρέξτε στο θέμα [Δεδομένων συγχρονισμού χωρίς σύνδεση σε εφαρμογές του Mobile Azure][2].

* Πριν από τις λειτουργίες πίνακα μπορούν να πραγματοποιηθούν, πρέπει να προετοιμαστεί του τοπικού χώρου αποθήκευσης. Η βάση δεδομένων του τοπικού χώρου αποθήκευσης έχει προετοιμαστεί στην κατασκευή κλάσης **TodoItemManager** , χρησιμοποιώντας τον ακόλουθο κώδικα:

        var store = new MobileServiceSQLiteStore(OfflineDbPath);
        store.DefineTable<TodoItem>();

        //Initializes the SyncContext using the default IMobileServiceSyncHandler.
        this.client.SyncContext.InitializeAsync(store);

        this.todoTable = client.GetSyncTable<TodoItem>();

    Αυτός ο κωδικός δημιουργεί μια νέα τοπική βάση SQLite χρησιμοποιώντας την κλάση **MobileServiceSQLiteStore** .

    Η μέθοδος **DefineTable** δημιουργεί έναν πίνακα στον τοπικό χώρο αποθήκευσης που ταιριάζει με τα πεδία στο πλαίσιο που παρέχεται, πληκτρολογήστε.  Ο τύπος δεν χρειάζεται να συμπεριλάβετε όλες τις στήλες που βρίσκονται σε απομακρυσμένη βάση δεδομένων. Είναι δυνατό να αποθηκεύσετε ένα υποσύνολο των στηλών.

* Στο πεδίο **todoTable** **TodoItemManager** είναι ένας τύπος **IMobileServiceSyncTable** αντί για **IMobileServiceTable**. Αυτό χρήσεις της κατηγορίας της τοπικής βάσης δεδομένων για όλες δημιουργία, ανάγνωση, ενημέρωση και διαγραφή λειτουργίες πίνακα (CRUD). Μπορείτε να αποφασίσετε όταν προωθούνται αυτές τις αλλαγές στον υπολογιστή στο παρασκήνιο εφαρμογή Mobile με κλήση **PushAsync** σε το **IMobileServiceSyncContext**. Το περιβάλλον συγχρονισμού σάς βοηθά να διατηρήσει τις σχέσεις πινάκων, παρακολούθηση και Ώθηση αλλαγές σε όλους τους πίνακες που έχει τροποποιηθεί μια εφαρμογή προγράμματος-πελάτη όταν καλείται **PushAsync** .

    Η παρακάτω μέθοδος **SyncAsync** καλείται για συγχρονισμό με την εφαρμογή Mobile υποστήριξης:

        public async Task SyncAsync()
        {
            ReadOnlyCollection<MobileServiceTableOperationError> syncErrors = null;

            try
            {
                await this.client.SyncContext.PushAsync();

                await this.todoTable.PullAsync(
                    "allTodoItems",
                    this.todoTable.CreateQuery());
            }
            catch (MobileServicePushFailedException exc)
            {
                if (exc.PushResult != null)
                {
                    syncErrors = exc.PushResult.Errors;
                }
            }

            // Simple error/conflict handling.
            if (syncErrors != null)
            {
                foreach (var error in syncErrors)
                {
                    if (error.OperationKind == MobileServiceTableOperationKind.Update && error.Result != null)
                    {
                        //Update failed, reverting to server's copy.
                        await error.CancelAndUpdateItemAsync(error.Result);
                    }
                    else
                    {
                        // Discard local change.
                        await error.CancelAndDiscardItemAsync();
                    }

                    Debug.WriteLine(@"Error executing sync operation. Item: {0} ({1}). Operation discarded.",
                        error.TableName, error.Item["id"]);
                }
            }
        }

    Αυτό το δείγμα χρησιμοποιεί απλό σφάλμα κατά το χειρισμό με το προεπιλεγμένο πρόγραμμα χειρισμού συγχρονισμού. Μια πραγματική εφαρμογή θα χειρίζεται τα διάφορα σφάλματα όπως συνθήκες δικτύου και διενέξεων διακομιστή, χρησιμοποιώντας μια προσαρμοσμένη υλοποίηση **IMobileServiceSyncHandler** .

## <a name="offline-sync-considerations"></a>Ζητήματα συγχρονισμού χωρίς σύνδεση

Στο δείγμα, η μέθοδος **SyncAsync** καλείται μόνο στην εκκίνησης και όταν ζητείται συγχρονισμού.  Για να ξεκινήσετε το συγχρονισμό σε μια εφαρμογή Android ή iOS, ελκυστική προς τα κάτω στη λίστα στοιχείων. για τα Windows, χρησιμοποιήστε το κουμπί **Συγχρονισμός** . Σε μια εφαρμογή ρεαλιστικό, μπορείτε επίσης να κάνετε το έναυσμα συγχρονισμού όταν αλλάζει την κατάσταση του δικτύου.

Όταν μια ελκυστική έχει εκτελεστεί σε έναν πίνακα που έχει σε εκκρεμότητα τοπικό ενημερώσεις παρακολουθείται από το περιβάλλον, που ελκυστική λειτουργία αυτόματα εναύσματα μια προηγούμενη push περιβάλλοντος. Κατά την ανανέωση, την προσθήκη και την ολοκλήρωση των στοιχείων σε αυτό το δείγμα, μπορείτε να παραλείψετε το ρητή κλήση **PushAsync** .

Στον κώδικα που παρέχεται, υποβάλλεται ερώτημα όλες τις εγγραφές στον απομακρυσμένο TodoItem πίνακα, αλλά είναι επίσης πιθανό να φιλτράρετε εγγραφές, μεταφέροντας ένα αναγνωριστικό ερωτήματος και το ερώτημα για να **PushAsync**. Για περισσότερες πληροφορίες, ανατρέξτε στην ενότητα *Αυξάνονται συγχρονισμού* στην [Δεδομένων συγχρονισμού χωρίς σύνδεση σε εφαρμογές του Mobile Azure][2].

## <a name="run-the-client-app"></a>Εκτελέστε την εφαρμογή υπολογιστή-πελάτη

Με εργασία χωρίς σύνδεση τώρα τη δυνατότητα συγχρονισμού, εκτελέστε την εφαρμογή-πελάτη τουλάχιστον μία φορά σε κάθε πλατφόρμα για να συμπληρώσετε τη βάση δεδομένων του τοπικού χώρου αποθήκευσης. Αργότερα, προσομοιώνουν ένα σενάριο χωρίς σύνδεση και τροποποιήστε τα δεδομένα του τοπικού χώρου αποθήκευσης, ενώ η εφαρμογή είναι χωρίς σύνδεση.

## <a name="update-the-sync-behavior-of-the-client-app"></a>Ενημέρωση της συμπεριφοράς συγχρονισμού της εφαρμογής υπολογιστή-πελάτη

Σε αυτήν την ενότητα, τροποποιήστε το έργο προγράμματος-πελάτη για να προσομοιώσετε ένα σενάριο χωρίς σύνδεση, χρησιμοποιώντας μια διεύθυνση URL δεν είναι έγκυρη εφαρμογή για τον υπολογιστή στο παρασκήνιο. Εναλλακτικά, μπορείτε να απενεργοποιήσετε τις συνδέσεις δικτύου, μετακινώντας τη συσκευή σας σε "Λειτουργία αεροπλάνο."  Όταν προσθέτετε ή αλλάζετε στοιχεία δεδομένων, αυτές οι αλλαγές είναι που θα διατηρούνται στα του τοπικού χώρου αποθήκευσης, αλλά δεν συγχρονίζονται στο χώρο αποθήκευσης δεδομένων παρασκηνίου μέχρι η σύνδεση έχει αποκατασταθεί.

1. Στην Εξερεύνηση λύσεων, ανοίξτε το αρχείο έργου Constants.cs από το έργο **φορητό** και αλλάξτε την τιμή του `ApplicationURL` να οδηγούν σε μη έγκυρη διεύθυνση URL:

        public static string ApplicationURL = @"https://your-service.azurewebsites.net/";

2. Ανοίξτε το αρχείο TodoItemManager.cs από το **Portable** έργο και, στη συνέχεια, προσθήκη ενός **Ενημερωθείτε** για τη βασική κλάση **εξαίρεσης** στο μπλοκ **δοκιμάστε... προϊόντων** στο **SyncAsync**. Αυτό το μπλοκ **Ενημερωθείτε** συντάσσει το μήνυμα εξαίρεσης στην κονσόλα, ως εξής:

            catch (Exception ex)
            {
                Console.Error.WriteLine(@"Exception: {0}", ex.Message);
            }

3. Δημιουργήστε και εκτελέστε την εφαρμογή υπολογιστή-πελάτη.  Προσθήκη ορισμένα νέα στοιχεία. Παρατηρήστε ότι έχει συνδεθεί μια εξαίρεση στην κονσόλα κάθε προσπάθεια για να συγχρονίσετε με τον υπολογιστή στο παρασκήνιο. Αυτά τα νέα στοιχεία υπάρχει μόνο στον του τοπικού χώρου αποθήκευσης, μέχρι να είναι δυνατή η προώθηση τους στον φορητό υπολογιστή στο παρασκήνιο. Η εφαρμογή προγράμματος-πελάτη συμπεριφέρεται σαν να είναι συνδεδεμένη παρασκηνίου, υποστήριξης όλα δημιουργία, ανάγνωση, ενημέρωση, λειτουργίες διαγραφής (CRUD).

4. Κλείστε την εφαρμογή και κάντε επανεκκίνηση, για να βεβαιωθείτε ότι τα νέα στοιχεία που δημιουργήσατε διατηρούνται στον τοπικό χώρο αποθήκευσης.

5. (Προαιρετικό) Χρησιμοποιήστε το Visual Studio για να προβάλετε τον πίνακα βάσης δεδομένων SQL Azure για να δείτε ότι τα δεδομένα στη βάση δεδομένων παρασκηνίου δεν έχει αλλάξει.

    Στο Visual Studio, ανοίξτε την **Εξερεύνηση διακομιστή**. Περιήγηση στη βάση δεδομένων σας στο **Azure**->**Βάσεις δεδομένων SQL**. Κάντε δεξί κλικ σε βάση δεδομένων σας και επιλέξτε **Άνοιγμα στην Εξερεύνηση αντικειμένου SQL Server**. Τώρα μπορείτε να περιηγηθείτε σε πίνακα της βάσης δεδομένων SQL και τα περιεχόμενά της.

## <a name="update-the-client-app-to-reconnect-your-mobile-backend"></a>Ενημέρωση της εφαρμογής του προγράμματος-πελάτη για να συνδέσετε τις κινητές συσκευές παρασκηνίου

Σε αυτήν την ενότητα, συνδεθείτε ξανά την εφαρμογή για κινητές συσκευές υπόβαθρο, που αναπαριστά την εφαρμογή σύντομα επιστροφή σε κατάσταση σύνδεσης. Όταν εκτελείτε την κίνηση ανανέωσης, δεδομένα συγχρονίζεται με τις κινητές συσκευές παρασκηνίου.

1. Επανάληψη ανοίγματος των Constants.cs. Διορθώστε το `applicationURL` ώστε να δείχνει προς τη σωστή διεύθυνση URL.

2. Εκ νέου δημιουργία και εκτέλεση της εφαρμογής υπολογιστή-πελάτη. Η εφαρμογή προσπαθεί να συγχρονίσετε με την εφαρμογή για κινητές συσκευές παρασκηνίου μετά την εκκίνηση. Βεβαιωθείτε ότι έχουν συνδεθεί χωρίς εξαιρέσεις στην κονσόλα εντοπισμού σφαλμάτων.

3. (Προαιρετικό) Προβάλετε τα ενημερωμένα δεδομένα χρησιμοποιώντας Εξερεύνηση αντικειμένου SQL Server ή ένα εργαλείο ΥΠΌΛΟΙΠΑ όπως Fiddler ή [Postman][6]. Παρατηρήστε τα δεδομένα έχει συγχρονιστεί μεταξύ της βάσης δεδομένων παρασκηνίου και του τοπικού χώρου αποθήκευσης.

    Παρατηρήστε τα δεδομένα έχει συγχρονιστεί μεταξύ της βάσης δεδομένων και του τοπικού χώρου αποθήκευσης και περιέχει τα στοιχεία που προσθέσατε κατά την εφαρμογή σας έχει αποσυνδεθεί.

## <a name="additional-resources"></a>Πρόσθετοι πόροι

* [Συγχρονισμός δεδομένων χωρίς σύνδεση στο Azure εφαρμογές για κινητές συσκευές][2]
* [ΔΙΑΔΙΚΑΣΙΕΣ SDK .NET Azure εφαρμογές για κινητές συσκευές][8]

<!-- URLs. -->
[1]: app-service-mobile-dotnet-backend-how-to-use-server-sdk.md
[2]: app-service-mobile-offline-data-sync.md
[3]: http://go.microsoft.com/fwlink/p/?LinkID=716919
[4]: http://go.microsoft.com/fwlink/p/?LinkID=716920
[5]: http://sqlite.org/2016/sqlite-uwp-3120200.vsix
[6]: https://www.getpostman.com/
[7]: http://www.telerik.com/fiddler
[8]: app-service-mobile-dotnet-how-to-use-client-library.md