<properties
    pageTitle="Ενεργοποίηση του συγχρονισμού χωρίς σύνδεση για την εφαρμογή Mobile Azure (Xamarin iOS)"
    description="Μάθετε πώς να χρησιμοποιείτε την εφαρμογή Mobile εφαρμογής υπηρεσίας στο cache και συγχρονισμός δεδομένων χωρίς σύνδεση στην εφαρμογή iOS Xamarin"
    documentationCenter="xamarin"
    authors="adrianhall"
    manager="dwrede"
    editor=""
    services="app-service\mobile"/>

<tags
    ms.service="app-service-mobile"
    ms.workload="mobile"
    ms.tgt_pltfrm="mobile-xamarin-ios"
    ms.devlang="dotnet"
    ms.topic="article"
    ms.date="10/01/2016"
    ms.author="adrianha"/>

# <a name="enable-offline-sync-for-your-xamarinios-mobile-app"></a>Ενεργοποίηση του συγχρονισμού χωρίς σύνδεση για την εφαρμογή για κινητές συσκευές Xamarin.iOS

[AZURE.INCLUDE [app-service-mobile-selector-offline](../../includes/app-service-mobile-selector-offline.md)]

## <a name="overview"></a>Επισκόπηση

Αυτό το πρόγραμμα εκμάθησης παρουσιάζει τη δυνατότητα συγχρονισμού χωρίς σύνδεση του Azure Mobile Apps για Xamarin.iOS. Συγχρονισμού χωρίς σύνδεση επιτρέπει στους τελικούς χρήστες να αλληλεπιδράσετε με μια εφαρμογή για κινητές συσκευές--προβολή, προσθήκη ή τροποποίηση δεδομένων--ακόμη και όταν δεν υπάρχει σύνδεση δικτύου. Οι αλλαγές αποθηκεύονται σε μια τοπική βάση δεδομένων. Όταν η συσκευή είναι πάλι σε σύνδεση, αυτές οι αλλαγές συγχρονίζονται με την υπηρεσία απομακρυσμένης.

Σε αυτό το πρόγραμμα εκμάθησης, ενημερώνετε το έργο εφαρμογής Xamarin.iOS από το στοιχείο [Δημιουργία μια εφαρμογή iOS Xamarin] να υποστηρίζει τις δυνατότητες για εργασία χωρίς σύνδεση του Azure εφαρμογές του Mobile. Εάν δεν χρησιμοποιείτε το έργο διακομιστή ληφθέντων γρήγορης εκκίνησης, πρέπει να προσθέσετε τα πακέτα επέκτασης πρόσβασης δεδομένων στο έργο σας. Για περισσότερες πληροφορίες σχετικά με τα πακέτα επέκτασης server, ανατρέξτε στο θέμα [εργασία με το διακομιστή υποστήριξης .NET SDK για εφαρμογές του Mobile Azure](app-service-mobile-dotnet-backend-how-to-use-server-sdk.md).

Για να μάθετε περισσότερα σχετικά με τη δυνατότητα συγχρονισμού χωρίς σύνδεση, ανατρέξτε στο θέμα [Συγχρονισμού χωρίς σύνδεση δεδομένων σε εφαρμογές του Mobile Azure].

## <a name="update-the-client-app-to-support-offline-features"></a>Ενημέρωση της εφαρμογής του προγράμματος-πελάτη για την υποστήριξη δυνατοτήτων για εργασία χωρίς σύνδεση

Azure δυνατότητες χωρίς σύνδεση εφαρμογή Mobile σάς επιτρέπουν να αλληλεπιδράσετε με μια τοπική βάση δεδομένων όταν βρίσκεστε σε ένα σενάριο χωρίς σύνδεση. Για να χρησιμοποιήσετε αυτές τις δυνατότητες της εφαρμογής σας, η προετοιμασία ενός [SyncContext] σε έναν τοπικό χώρο αποθήκευσης. Αναφορά πίνακα μέσω του περιβάλλοντος εργασίας [IMobileServiceSyncTable]. SQLite χρησιμοποιείται ως τον τοπικό χώρο αποθήκευσης στη συσκευή.

1. Άνοιγμα της διαχείρισης πακέτου NuGet του έργου που έχετε ολοκληρώσει στην εκμάθηση [Δημιουργία μια εφαρμογή iOS Xamarin] , στη συνέχεια, αναζητήστε και εγκαταστήστε το πακέτο **Microsoft.Azure.Mobile.Client.SQLiteStore** NuGet.

2. Ανοίξτε το αρχείο QSTodoService.cs και καταργήστε τα σχόλια από το `#define OFFLINE_SYNC_ENABLED` ορισμού.

3. Εκ νέου δημιουργία και εκτέλεση της εφαρμογής υπολογιστή-πελάτη. Η εφαρμογή λειτουργεί με τον ίδιο τρόπο όπως και πριν από τη δυνατότητα συγχρονισμού χωρίς σύνδεση. Ωστόσο, της τοπικής βάσης δεδομένων τώρα συμπληρώνεται με δεδομένα που μπορεί να χρησιμοποιηθεί σε ένα σενάριο για εργασία χωρίς σύνδεση.

## <a name="update-sync"></a>Ενημέρωση της εφαρμογής για να αποσυνδεθείτε από υπολογιστή στο παρασκήνιο

Σε αυτήν την ενότητα, μπορείτε να διακόψετε τη σύνδεση για την εφαρμογή Mobile παρασκηνίου να προσομοιώνουν μια κατάσταση χωρίς σύνδεση. Όταν προσθέτετε στοιχεία δεδομένων, το πρόγραμμα χειρισμού εξαίρεσης σάς ενημερώνει ότι η εφαρμογή είναι σε λειτουργία χωρίς σύνδεση. Σε αυτήν την κατάσταση, νέα στοιχεία προστέθηκαν στο του τοπικού χώρου αποθήκευσης και θα συγχρονίζονται υπόβαθρο εφαρμογής για κινητές συσκευές κατά την εκτέλεση Επόμενο push σε κατάσταση σύνδεσης.

1. Επεξεργασία QSToDoService.cs στο κοινόχρηστο έργο. Αλλάξτε το **applicationURL** να οδηγούν σε μη έγκυρη διεύθυνση URL:

         const string applicationURL = @"https://your-service.azurewebsites.fail";

    Μπορείτε επίσης να δείχνουν συμπεριφοράς χωρίς σύνδεση απενεργοποιώντας wifi και δίκτυα κινητής τηλεφωνίας στη συσκευή ή χρήση της κατάστασης λειτουργίας αεροπλάνου.

2. Δημιουργία και εκτέλεση της εφαρμογής. Ειδοποίηση συγχρονισμού σας απέτυχε κατά την ανανέωση κατά την εκκίνηση της εφαρμογής.

3. Πληκτρολογήστε νέα στοιχεία και παρατηρήστε ότι push αποτυγχάνει με κατάσταση [CancelledByNetworkError] κάθε φορά που κάνετε κλικ στο κουμπί **Αποθήκευση**. Ωστόσο, τα νέα στοιχεία todo υπάρχει στον τοπικό χώρο αποθήκευσης μέχρι να είναι δυνατή η προώθηση τους στον υπολογιστή στο παρασκήνιο εφαρμογής για κινητές συσκευές.  Σε μια εφαρμογή παραγωγής, εάν μπορείτε να αποκρύψετε τις εξής εξαιρέσεις στην εφαρμογή υπολογιστή-πελάτη συμπεριφέρεται σαν να εξακολουθεί να είναι συνδεδεμένος στον υπολογιστή στο παρασκήνιο εφαρμογής για κινητές συσκευές.

4. Κλείστε την εφαρμογή και κάντε επανεκκίνηση, για να βεβαιωθείτε ότι τα νέα στοιχεία που δημιουργήσατε διατηρούνται στον τοπικό χώρο αποθήκευσης.

5. (Προαιρετικό) Εάν έχετε εγκατεστημένο σε Υπολογιστή με το Visual Studio, ανοίξτε την **Εξερεύνηση διακομιστή**. Περιήγηση στη βάση δεδομένων σας στο **Azure**-> **Βάσεις δεδομένων SQL**. Κάντε δεξί κλικ σε βάση δεδομένων σας και επιλέξτε **Άνοιγμα στην Εξερεύνηση αντικειμένου SQL Server**. Τώρα μπορείτε να περιηγηθείτε σε πίνακα της βάσης δεδομένων SQL και τα περιεχόμενά της. Βεβαιωθείτε ότι τα δεδομένα στη βάση δεδομένων παρασκηνίου δεν έχει αλλάξει.

6. (Προαιρετικό) Χρησιμοποιήστε ένα εργαλείο ΥΠΌΛΟΙΠΑ όπως Fiddler ή Postman ερώτημα για τις κινητές συσκευές παρασκηνίου, με χρήση ενός ερωτήματος ΛΉΨΗ στη φόρμα `https://<your-mobile-app-backend-name>.azurewebsites.net/tables/TodoItem`.

## <a name="update-online-app"></a>Ενημέρωση της εφαρμογής για να συνδεθείτε ξανά την εφαρμογή Mobile παρασκηνίου

Σε αυτήν την ενότητα, συνδεθείτε ξανά την εφαρμογή στον υπολογιστή στο παρασκήνιο εφαρμογής για κινητές συσκευές. Αυτό προσομοιώνει την εφαρμογή Μετακίνηση από μια κατάσταση χωρίς σύνδεση σε κατάσταση σύνδεσης με την εφαρμογή για κινητές συσκευές παρασκηνίου.   Εάν προσομοιωμένη το θραύσης δικτύου με την απενεργοποίηση της συνδεσιμότητας δικτύου, χωρίς αλλαγές κώδικα είναι απαραίτητες.
Ενεργοποιήστε το δίκτυο ξανά.  Πρώτη φορά που εκτελείτε την εφαρμογή, η `RefreshDataAsync` μέθοδος καλείται. Αυτό με τη σειρά κλήσεις `SyncAsync` για συγχρονισμό του τοπικού χώρου αποθήκευσης με βάση δεδομένων παρασκηνίου.

1. Ανοίξτε το QSToDoService.cs στο κοινόχρηστο έργο και γίνεται επαναφορά την αλλαγή της ιδιότητας **applicationURL** .

2. Εκ νέου δημιουργία και εκτέλεση της εφαρμογής. Η εφαρμογή συγχρονίζει τις τοπικές αλλαγές σας με την εφαρμογή Mobile Azure παρασκηνίου χρησιμοποιώντας λειτουργίες push και ελκυστική όταν το `OnRefreshItemsSelected` εκτελεί τη μέθοδο.

3. (Προαιρετικό) Προβάλετε τα ενημερωμένα δεδομένα χρησιμοποιώντας Εξερεύνηση αντικειμένου SQL Server ή ένα εργαλείο ΥΠΌΛΟΙΠΑ όπως Fiddler. Ανακοίνωση των δεδομένων έχει συγχρονιστεί μεταξύ της βάσης δεδομένων παρασκηνίου Azure εφαρμογή Mobile και του τοπικού χώρου αποθήκευσης.

4. Στην εφαρμογή, επιλέξτε το πλαίσιο ελέγχου δίπλα στο στοιχείο μερικά στοιχεία για να ολοκληρώσετε τις στον τοπικό χώρο αποθήκευσης.

  `CompleteItemAsync`κλήσεις `SyncAsync` ο συγχρονισμός κάθε ολοκληρώθηκε στοιχείο με την εφαρμογή Mobile παρασκηνίου. `SyncAsync`κλήσεις Ώθηση και έλξη.
  **Κάθε φορά που εκτελείτε μια ελκυστική σε σχέση με έναν πίνακα που ο υπολογιστής-πελάτης έχει κάνει αλλαγές, πάτημα σε περιβάλλον συγχρονισμού προγράμματος-πελάτη είναι πάντα πρώτα αυτόματη εκτέλεση**. Το πάτημα έμμεσα εξασφαλίζει όλους τους πίνακες του τοπικού χώρου αποθήκευσης μαζί με τις σχέσεις παραμένουν συνεπή. Για περισσότερες πληροφορίες σχετικά με αυτήν τη συμπεριφορά, ανατρέξτε στο θέμα [Δεδομένων συγχρονισμού χωρίς σύνδεση σε εφαρμογές του Mobile Azure].

## <a name="review-the-client-sync-code"></a>Αναθεώρηση του κώδικα συγχρονισμού προγράμματος-πελάτη

Το έργο προγράμματος-πελάτη Xamarin που έχετε λάβει, όταν ολοκληρωθεί το πρόγραμμα εκμάθησης [Δημιουργία μια εφαρμογή iOS Xamarin] ήδη περιέχει κώδικα υποστήριξης, χρησιμοποιώντας μια τοπική βάση δεδομένων SQLite συγχρονισμού εκτός σύνδεσης. Ακολουθεί μια σύντομη επισκόπηση του τι περιλαμβάνεται ήδη τον κώδικα προγραμμάτων εκμάθησης. Για μια επισκόπηση της δυνατότητας, ανατρέξτε στο θέμα [Δεδομένων συγχρονισμού χωρίς σύνδεση σε εφαρμογές του Mobile Azure].

* Πριν από τις λειτουργίες πίνακα μπορούν να πραγματοποιηθούν, πρέπει να προετοιμαστεί του τοπικού χώρου αποθήκευσης. Προετοιμασία της βάσης δεδομένων τοπικού χώρου αποθήκευσης όταν `QSTodoListViewController.ViewDidLoad()` εκτελεί την `QSTodoService.InitializeStoreAsync()`. Αυτή η μέθοδος δημιουργεί μια νέα τοπική SQLite βάση δεδομένων χρησιμοποιώντας το `MobileServiceSQLiteStore` κλάσης που παρέχεται από το πρόγραμμα-πελάτη εφαρμογή Mobile Azure SDK.

    Το `DefineTable` μέθοδος δημιουργεί έναν πίνακα στο του τοπικού χώρου αποθήκευσης που ταιριάζει με τα πεδία στον τύπο παρεχόμενη, `ToDoItem` σε αυτήν την περίπτωση. Ο τύπος δεν χρειάζεται να συμπεριλάβετε όλες τις στήλες που βρίσκονται σε απομακρυσμένη βάση δεδομένων. Είναι δυνατή η αποθήκευση μόνο ένα υποσύνολο των στηλών.

        // QSTodoService.cs

        public async Task InitializeStoreAsync()
        {
            var store = new MobileServiceSQLiteStore(localDbPath);
            store.DefineTable<ToDoItem>();

            // Uses the default conflict handler, which fails on conflict
            await client.SyncContext.InitializeAsync(store);
        }


* Το `todoTable` μέλος `QSTodoService` δεν είναι το `IMobileServiceSyncTable` πληκτρολογήστε αντί `IMobileServiceTable`. Το IMobileServiceSyncTable κατευθύνει όλες δημιουργία, ανάγνωση, ενημέρωση και διαγραφή λειτουργίες πίνακα (CRUD) στη βάση δεδομένων του τοπικού χώρου αποθήκευσης.

    Μπορείτε να αποφασίσετε όταν αυτών των αλλαγών μετακινούνται υπόβαθρο εφαρμογή Mobile Azure καλώντας `IMobileServiceSyncContext.PushAsync()`. Περιβάλλον συγχρονισμού σάς βοηθά να διατηρήσετε τις σχέσεις πινάκων, παρακολούθηση και Ώθηση αλλαγές σε όλους τους πίνακες, μια εφαρμογή προγράμματος-πελάτη έχει τροποποιηθεί όταν `PushAsync` ονομάζεται.

    Οι κλήσεις παρεχόμενη κώδικα `QSTodoService.SyncAsync()` για συγχρονισμό κάθε φορά που η λίστα todoitem ανανεώνεται ή μια todoitem προστίθεται ή ολοκληρώθηκε. Η εφαρμογή συγχρονίζει μετά από κάθε αλλαγή τοπικό. Εάν μια ελκυστική έχει εκτελεστεί σε έναν πίνακα που έχει εκκρεμείς ενημερώσεις τοπικού παρακολουθούνται με το περιβάλλον, αυτή η λειτουργία ελκυστική θα ενεργοποιήσει αυτόματα ένα περιβάλλον push πρώτα.

    Στον κώδικα που παρέχεται, όλες τις εγγραφές στη ο απομακρυσμένος `TodoItem` υποβάλλονται ερωτήματα πίνακα, αλλά είναι επίσης πιθανό να φιλτράρετε εγγραφές, μεταφέροντας ένα αναγνωριστικό ερωτήματος και ερωτήματος για να `PushAsync`. Για περισσότερες πληροφορίες, ανατρέξτε στην ενότητα *Αυξάνονται συγχρονισμός* στην [Δεδομένων συγχρονισμού χωρίς σύνδεση σε εφαρμογές του Mobile Azure].

        // QSTodoService.cs
        public async Task SyncAsync()
        {
            try
            {
                await client.SyncContext.PushAsync();
                await todoTable.PullAsync("allTodoItems", todoTable.CreateQuery()); // query ID is used for incremental sync
            }

            catch (MobileServiceInvalidOperationException e)
            {
                Console.Error.WriteLine(@"Sync Failed: {0}", e.Message);
            }
        }


## <a name="additional-resources"></a>Πρόσθετοι πόροι

* [Συγχρονισμός δεδομένων χωρίς σύνδεση στο Azure εφαρμογές για κινητές συσκευές]
* [ΔΙΑΔΙΚΑΣΙΕΣ SDK .NET Azure εφαρμογές για κινητές συσκευές][8]

<!-- Images -->

<!-- URLs. -->
[Δημιουργία εφαρμογής iOS Xamarin]: app-service-mobile-xamarin-ios-get-started.md
[Συγχρονισμός δεδομένων χωρίς σύνδεση στο Azure εφαρμογές για κινητές συσκευές]: app-service-mobile-offline-data-sync.md
[SyncContext]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.mobileservices.mobileserviceclient.synccontext(v=azure.10).aspx
[8]: app-service-mobile-dotnet-how-to-use-client-library.md