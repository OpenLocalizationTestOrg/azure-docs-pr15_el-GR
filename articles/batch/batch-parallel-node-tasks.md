<properties
    pageTitle="Μεγιστοποίηση δέσμη χρήση κόμβο με παράλληλες εργασίες | Microsoft Azure"
    description="Αύξηση της αποδοτικότητας και χαμηλότερο κόστος, χρησιμοποιώντας λιγότερα κόμβους υπολογιστικών και χρησιμοποιείτε ταυτόχρονες εργασίες σε κάθε κόμβο σε ένα σύνολο δέσμη Azure"
    services="batch"
    documentationCenter=".net"
    authors="mmacy"
    manager="timlt"
    editor="" />

<tags
    ms.service="batch"
    ms.devlang="multiple"
    ms.topic="article"
    ms.tgt_pltfrm="vm-windows"
    ms.workload="big-compute"
    ms.date="10/25/2016"
    ms.author="marsma" />

# <a name="maximize-azure-batch-compute-resource-usage-with-concurrent-node-tasks"></a>Μεγιστοποίηση δέσμη Azure υπολογισμού χρήση πόρων με εργασίες ταυτόχρονες κόμβου

Με την εκτέλεση ταυτόχρονα περισσότερες από μία εργασία σε κάθε κόμβο υπολογισμού του χώρου συγκέντρωσης δέσμη Azure, μπορείτε να μεγιστοποιήσετε χρήση πόρων σε μικρότερο αριθμό κόμβους στο χώρο συγκέντρωσης. Για ορισμένες φόρτους εργασίας, αυτό μπορεί να έχει ως αποτέλεσμα μειώνει το χρόνο εργασίας και χαμηλότερο κόστος.

Ενώ ορισμένα σενάρια επωφεληθείτε από όλους τους πόρους έναν κόμβο διαθέσετε σε μία μόνο εργασία, διάφορες περιπτώσεις επωφεληθείτε από παρέχει πολλές εργασίες για να κάνετε κοινή χρήση αυτών των πόρων:

 - **Ελαχιστοποίηση μεταφορά δεδομένων** όταν εργασίες έχουν τη δυνατότητα να κάνετε κοινή χρήση δεδομένων. Σε αυτό το σενάριο, μπορείτε να μειώσετε εντυπωσιακά χρεώσεις μεταφορά δεδομένων, αντιγράφοντας κοινόχρηστων δεδομένων σε μικρότερο αριθμό κόμβους και εκτελεί εργασίες παράλληλα σε κάθε κόμβο. Αυτό ισχύει ιδίως εάν τα δεδομένα για να αντιγραφεί σε κάθε κόμβο πρέπει να μεταφερθεί από διαφορετικές γεωγραφικές περιοχές.

 - **Χρήση μνήμης Maximizing** όταν εργασίες που απαιτούν μεγάλο όγκο μνήμης, αλλά μόνο κατά τη διάρκεια σύντομο περιόδους του χρόνου και μεταβλητής φορές κατά την εκτέλεση. Μπορείτε να χρησιμοποιήσετε κόμβους υπολογιστικών λιγότερες, αλλά μεγαλύτερα, με περισσότερη μνήμη αποτελεσματικά χειρισμού όπως αιχμές. Αυτές οι κόμβοι να έχουν πολλές εργασίες που εκτελούνται παράλληλα σε κάθε κόμβο, αλλά κάθε εργασία να επωφεληθείτε από τους κόμβους πλούσια μνήμης σε διαφορετικούς χρόνους.

 - **Διακοπής όρια αριθμού κόμβου** όταν απαιτείται επικοινωνία μεταξύ κόμβο μέσα σε ένα χώρο συγκέντρωσης. Προς το παρόν, χώρους συγκέντρωσης έχει ρυθμιστεί για την επικοινωνία μεταξύ κόμβο περιορίζονται 50 κόμβους υπολογιστικών. Εάν μπορεί να εκτελέσει εργασίες παράλληλα κάθε κόμβο σε ένα χώρο συγκέντρωσης, μεγαλύτερο αριθμό των εργασιών μπορεί να εκτελεστεί ταυτόχρονα.

 - **Αναπαραγωγή μιας εσωτερικής εγκατάστασης τον υπολογισμό σύμπλεγμα**, όπως όταν μετακινείτε για πρώτη φορά ένα περιβάλλον υπολογισμού για να Azure. Εάν η τρέχουσα λύση εσωτερικής εγκατάστασης για εκτέλεση πολλές εργασίες ανά κόμβος, μπορείτε να αυξήσετε τον μέγιστο αριθμό κόμβου εργασίες να είναι αντικριστά λεπτομερέστερα ότι η ρύθμιση παραμέτρων.

## <a name="example-scenario"></a>Παράδειγμα σεναρίου

Ως παράδειγμα για την απεικόνιση τα πλεονεκτήματα της εκτέλεσης παράλληλες εργασιών, ας υποθέσουμε ότι η εφαρμογή σας εργασίας έχει απαιτήσεις CPU και μνήμης τέτοια ώστε [τυπική\_D1](../cloud-services/cloud-services-sizes-specs.md#general-purpose-d) κόμβοι είναι αρκετό. Όμως, για να ολοκληρώσετε την εργασία στην ώρα απαιτείται, απαιτούνται 1.000 από αυτές τις κόμβους.

Αντί να χρησιμοποιήσετε τυπική\_κόμβους D1 που έχουν 1 CPU πυρήνα, θα μπορούσατε να χρησιμοποιήσετε [τυπική\_D14](../cloud-services/cloud-services-sizes-specs.md#memory-intensive-d) κόμβους που έχουν 16 πυρήνων και ενεργοποίηση εκτέλεσης παράλληλες εργασίας. Επομένως, *λιγότερες 16 ώρες κόμβους* θα μπορούσαν να χρησιμοποιηθούν--αντί για 1.000 κόμβους, μόνο 63 μπορεί να απαιτούνται. Επιπλέον, εάν απαιτούνται μεγάλης εφαρμογής αρχεία ή δεδομένα αναφοράς για κάθε κόμβο, διάρκεια έργου και της αποτελεσματικότητας είναι ξανά βελτιωθεί καθώς τα δεδομένα αντιγράφονται μόνο 16 κόμβους.

## <a name="enable-parallel-task-execution"></a>Ενεργοποίηση εκτέλεσης παράλληλες εργασίας

Μπορείτε να ρυθμίσετε τις παραμέτρους κόμβους υπολογιστικών για εκτέλεση παράλληλες εργασιών στο επίπεδο χώρου συγκέντρωσης. Με τη βιβλιοθήκη .NET δέσμη, ορίστε το [CloudPool.MaxTasksPerComputeNode] [ maxtasks_net] ιδιότητα κατά τη δημιουργία ενός χώρου συγκέντρωσης. Εάν χρησιμοποιείτε το REST API δέσμη, ορίστε το [maxTasksPerNode] [ rest_addpool] στοιχείο στο σώμα της αίτησης κατά τη δημιουργία χώρου συγκέντρωσης.

Azure δέσμη σάς επιτρέπει να ορίσετε μέγιστο εργασίες ανά κόμβο έως τέσσερις φορές (4 x) ο αριθμός πυρήνων κόμβο. Για παράδειγμα, εάν ο χώρος συγκέντρωσης έχει ρυθμιστεί με κόμβους μέγεθος "Μεγάλο" (τεσσάρων πυρήνων), στη συνέχεια, `maxTasksPerNode` ενδέχεται να έχει καθοριστεί 16. Για λεπτομέρειες σχετικά με τον αριθμό των πυρήνων για κάθε μία από τις διαστάσεις του κόμβου, ανατρέξτε στο θέμα [μεγέθη για τις υπηρεσίες Cloud](../cloud-services/cloud-services-sizes-specs.md). Για περισσότερες πληροφορίες σχετικά με τα όρια της υπηρεσίας, ανατρέξτε στο θέμα [όρια και περιορισμοί για την υπηρεσία δέσμη Azure](batch-quota-limit.md).

> [AZURE.TIP] Θα πρέπει να λάβετε υπόψη το `maxTasksPerNode` τιμή όταν δημιουργείτε έναν [τύπο autoscale] [ enable_autoscaling] για το χώρο συγκέντρωσης. Για παράδειγμα, ένας τύπος που αποδίδει `$RunningTasks` θα μπορούσαν να επηρεαστούν εντυπωσιακά αύξηση της εργασίες ανά κόμβο. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Αυτόματη κλίμακα τον υπολογισμό κόμβους σε ένα σύνολο δέσμη Azure](batch-automatic-scaling.md) .

## <a name="distribution-of-tasks"></a>Κατανομή των εργασιών

Όταν οι κόμβοι υπολογισμού σε ένα χώρο συγκέντρωσης μπορούν να εκτελούν εργασίες ταυτόχρονα, είναι σημαντικό για να καθορίσετε τον τρόπο που θέλετε για τις εργασίες να διανεμηθούν κατά μήκος τους κόμβους στο χώρο συγκέντρωσης.

Χρησιμοποιώντας το [CloudPool.TaskSchedulingPolicy] [ task_schedule] ιδιότητα, μπορείτε να καθορίσετε ότι οι εργασίες, θα πρέπει να ανατεθούν ομοιόμορφα σε όλους τους κόμβους στο χώρο συγκέντρωσης ("που"). Ή μπορείτε να καθορίσετε ότι όσο το δυνατόν περισσότερες εργασίες όσο το δυνατόν πρέπει να ανατεθούν σε κάθε κόμβο πριν εργασίες έχουν ανατεθεί σε έναν άλλο κόμβο στο χώρο συγκέντρωσης ("συσκευασίας").

Ως παράδειγμα του τρόπου αυτή η δυνατότητα είναι χρήσιμη, εξετάστε το ενδεχόμενο να το χώρο συγκέντρωσης [τυπική\_D14](../cloud-services/cloud-services-sizes-specs.md#memory-intensive-d) κόμβους (στο παραπάνω παράδειγμα) που έχει ρυθμιστεί με έναν [CloudPool.MaxTasksPerComputeNode] [ maxtasks_net] τιμή του 16. Εάν το [CloudPool.TaskSchedulingPolicy] [ task_schedule] έχει ρυθμιστεί με έναν [ComputeNodeFillType] [ fill_type] του *πακέτου*, θα Μεγιστοποίηση χρήση όλα 16 πυρήνων κάθε κόμβου και να επιτρέψετε ένα [χώρο συγκέντρωσης autoscaling](batch-automatic-scaling.md) να καταργήσει κόμβους που δεν χρησιμοποιείται από το χώρο συγκέντρωσης (κόμβους χωρίς όλες τις εργασίες που έχουν εκχωρηθεί). Αυτό ελαχιστοποιεί χρήση πόρων και αποθηκεύει χρήματα.

## <a name="batch-net-example"></a>Παράδειγμα .NET δέσμης

Αυτό [.NET δέσμη] [ api_net] API τμήμα κώδικα εμφανίζει μια αίτηση για να δημιουργήσετε ένα χώρο συγκέντρωσης που περιέχει τέσσερις μεγάλο κόμβους με έως τέσσερα εργασίες ανά κόμβο. Καθορίζει μια εργασία προγραμματισμού πολιτικής που θα γεμίσει κάθε κόμβο με εργασίες πριν από την ανάθεση εργασιών σε άλλο κόμβο στο χώρο συγκέντρωσης. Για περισσότερες πληροφορίες σχετικά με την προσθήκη χώρους συγκέντρωσης με τη χρήση του API .NET δέσμης, ανατρέξτε στο θέμα [BatchClient.PoolOperations.CreatePool][poolcreate_net].

```csharp
CloudPool pool =
    batchClient.PoolOperations.CreatePool(
        poolId: "mypool",
        targetDedicated: 4
        virtualMachineSize: "large",
        cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: "4"));

pool.MaxTasksPerComputeNode = 4;
pool.TaskSchedulingPolicy = new TaskSchedulingPolicy(ComputeNodeFillType.Pack);
pool.Commit();
```

## <a name="batch-rest-example"></a>Παράδειγμα ΥΠΌΛΟΙΠΑ δέσμης

Το [ΥΠΌΛΟΙΠΟ δέσμη] [ api_rest] τμήματος κώδικα API εμφανίζει μια αίτηση για να δημιουργήσετε ένα χώρο συγκέντρωσης που περιέχει δύο μεγάλες κόμβους με έως τέσσερα εργασίες ανά κόμβο. Για περισσότερες πληροφορίες σχετικά με την προσθήκη χώρους συγκέντρωσης, χρησιμοποιώντας το REST API, ανατρέξτε στο θέμα [Προσθήκη ενός χώρου συγκέντρωσης για ένα λογαριασμό][rest_addpool].

```json
{
  "odata.metadata":"https://myaccount.myregion.batch.azure.com/$metadata#pools/@Element",
  "id":"mypool",
  "vmSize":"large",
  "cloudServiceConfiguration": {
    "osFamily":"4",
    "targetOSVersion":"*",
  }
  "targetDedicated":2,
  "maxTasksPerNode":4,
  "enableInterNodeCommunication":true,
}
```

> [AZURE.NOTE] Μπορείτε να ορίσετε το `maxTasksPerNode` στοιχείο και [MaxTasksPerComputeNode] [ maxtasks_net] ιδιότητα μόνο κατά το χρόνο δημιουργίας χώρου συγκέντρωσης. Δεν μπορεί να τροποποιηθεί αφού έχει ήδη δημιουργηθεί ένα χώρο συγκέντρωσης.

## <a name="code-sample"></a>Δείγμα κώδικα

Το [ParallelNodeTasks] [ parallel_tasks_sample] έργου σε GitHub δείχνει τη χρήση των το [CloudPool.MaxTasksPerComputeNode] [ maxtasks_net] την ιδιότητα.

Χρησιμοποιεί το [.NET δέσμης] η εφαρμογή κονσόλας C#[ api_net] βιβλιοθήκη για να δημιουργήσετε ένα χώρο συγκέντρωσης με έναν ή περισσότερους κόμβους υπολογισμού. Εκτελείται με δυνατότητα ρύθμισης παραμέτρων πολλές εργασίες σε αυτές τις κόμβους για να προσομοιώσετε μεταβλητής φόρτωση. Έξοδος από την εφαρμογή καθορίζει τους κόμβους στους εκτελείται κάθε εργασίας. Η εφαρμογή παρέχει επίσης μια σύνοψη των παράμετροι εργασίας και διάρκειας. Η σύνοψη τμήμα του αποτελέσματος από δύο διαφορετικές επαναλαμβανόμενα το δείγμα εφαρμογής εμφανίζεται κάτω από.

```
Nodes: 1
Node size: large
Max tasks per node: 1
Tasks: 32
Duration: 00:30:01.4638023
```

Την πρώτη εκτέλεση του δείγματος εφαρμογής δείχνει ότι με έναν μεμονωμένο κόμβο στο χώρο συγκέντρωσης και την προεπιλεγμένη ρύθμιση μία εργασία ανά κόμβο, η διάρκεια της εργασίας είναι μεγαλύτερη από 30 λεπτά.

```
Nodes: 1
Node size: large
Max tasks per node: 4
Tasks: 32
Duration: 00:08:48.2423500
```

Εκτελέστε το δεύτερο από το δείγμα εμφανίζει μια σημαντική μείωση της διάρκειας εργασίας. Αυτό συμβαίνει επειδή το χώρο συγκέντρωσης έχει ρυθμιστεί με τέσσερις εργασίες ανά κόμβο, που επιτρέπει την εκτέλεση παράλληλες εργασίας για να ολοκληρώσετε την εργασία σε σχεδόν ένα τέταρτο της ώρας.

> [AZURE.NOTE] Τις διάρκειες εργασία στις συνόψεις παραπάνω δεν περιλαμβάνει το χρόνο δημιουργίας χώρου συγκέντρωσης. Κάθε μία από τις παραπάνω εργασίες υποβλήθηκε σε που δημιουργήσατε προηγουμένως χώρους συγκέντρωσης των οποίων κόμβους υπολογιστικών βρίσκονταν την κατάσταση *αδράνειας* υποβολής τη στιγμή.

## <a name="next-steps"></a>Επόμενα βήματα

### <a name="batch-explorer-heat-map"></a>Χάρτης θερμότητας Explorer δέσμης

Η [Εξερεύνηση δέσμη Azure][batch_explorer], μία από τις δέσμη Azure [δείγματα εφαρμογών][github_samples], περιέχει μια δυνατότητα *Χάρτη θερμότητας* που παρέχει απεικόνιση της εκτέλεσης της εργασίας. Όταν που η εκτέλεση του [ParallelTasks] [ parallel_tasks_sample] δείγμα εφαρμογής, μπορείτε να χρησιμοποιήσετε τη δυνατότητα χάρτη θερμότητας για την απεικόνιση εύκολα την εκτέλεση της παράλληλες εργασίες σε κάθε κόμβο.

![Χάρτης θερμότητας Explorer δέσμης][1]

*Χάρτης θερμότητας Explorer δέσμη που εμφανίζει ένα σύνολο τέσσερις κόμβους, με κάθε κόμβο τέσσερις εργασίες που εκτελούνται αυτήν τη στιγμή*

[api_net]: http://msdn.microsoft.com/library/azure/mt348682.aspx
[api_rest]: http://msdn.microsoft.com/library/azure/dn820158.aspx
[batch_explorer]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/BatchExplorer
[cloudpool]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudpool.aspx
[enable_autoscaling]: https://msdn.microsoft.com/library/azure/dn820173.aspx
[fill_type]: https://msdn.microsoft.com/library/microsoft.azure.batch.common.computenodefilltype.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[maxtasks_net]: http://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudpool.maxtaskspercomputenode.aspx
[rest_addpool]: https://msdn.microsoft.com/library/azure/dn820174.aspx
[parallel_tasks_sample]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/ParallelTasks
[poolcreate_net]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.pooloperations.createpool.aspx
[task_schedule]: https://msdn.microsoft.com/library/microsoft.azure.batch.cloudpool.taskschedulingpolicy.aspx

[1]: ./media/batch-parallel-node-tasks\heat_map.png
