<properties
    pageTitle="Visual Studio πρότυπα για μαζική Azure | Microsoft Azure"
    description="Μάθετε πώς αυτά τα πρότυπα του project Visual Studio μπορούν να σας βοηθήσουν να υλοποιήσετε και να εκτελέσετε το φόρτο εργασίας υπολογισμού στενής στη δέσμη Azure"
    services="batch"
    documentationCenter=".net"
    authors="fayora"
    manager="timlt"
    editor="" />

<tags
    ms.service="batch"
    ms.devlang="multiple"
    ms.topic="article"
    ms.tgt_pltfrm="vm-windows"
    ms.workload="big-compute"
    ms.date="09/07/2016"
    ms.author="marsma" />

# <a name="visual-studio-project-templates-for-azure-batch"></a>Visual Studio έργου πρότυπα για μαζική Azure

Η **Διαχείριση έργων** και **εργασιών επεξεργαστής Visual Studio πρότυπα** για μαζική παρέχουν κωδικό για να μπορείτε να υλοποιήσετε και να εκτελέσετε το φόρτο εργασίας υπολογισμού στενής στη δέσμη με την ελάχιστη προσπάθειας. Αυτό το έγγραφο περιγράφει αυτά τα πρότυπα και παρέχει οδηγίες σχετικά με τον τρόπο χρήσης τους.

>[AZURE.IMPORTANT] Σε αυτό το άρθρο περιγράφει μόνο τις πληροφορίες που ισχύουν για αυτά τα δύο πρότυπα και προϋποθέτει ότι είστε εξοικειωμένοι με την υπηρεσία δέσμης και βασικές έννοιες που σχετίζονται με αυτό: χώρους συγκέντρωσης, τον υπολογισμό κόμβους, εργασίες και εργασίες, οι εργασίες διαχείρισης έργου, μεταβλητές περιβάλλοντος και άλλες σχετικές πληροφορίες. Μπορείτε να βρείτε περισσότερες πληροφορίες στα [Βασικά στοιχεία του Azure δέσμη](batch-technical-overview.md), [επισκόπηση δυνατοτήτων δέσμης για τους προγραμματιστές](batch-api-basics.md)και [Γρήγορα αποτελέσματα με τη βιβλιοθήκη Azure δέσμη για .NET](batch-dotnet-get-started.md).

## <a name="high-level-overview"></a>Επισκόπηση υψηλού επιπέδου

Τα πρότυπα διαχείρισης έργων και εργασιών επεξεργαστή μπορεί να χρησιμοποιηθεί για να δημιουργήσετε δύο χρήσιμες στοιχεία:

* Μια εργασία διαχείρισης έργου που υλοποιεί μιας διαίρεσης εργασίας που μπορούν να διασπάσετε μια εργασία σε πολλές εργασίες που είναι δυνατό να εκτελεστεί ανεξάρτητα από αυτό, παράλληλα.

* Ένα πρόγραμμα επεξεργασίας εργασιών που μπορούν να χρησιμοποιηθούν για την εκτέλεση προ-επεξεργασία και επεξεργασίας εξόδου γύρω από μια γραμμή εντολών εφαρμογής.

Για παράδειγμα, σε ένα σενάριο απόδοσης ταινίας, διαχωριστή εργασία να μετατρέψετε μια ταινία μία μόνο εργασία σε εκατοντάδες ή χιλιάδες ξεχωριστές εργασίες που θα επεξεργάζονται μεμονωμένα καρέ ξεχωριστά. Αντίστοιχα, ο επεξεργαστής εργασίας θα καλέσει την εφαρμογή απόδοσης και όλες τις διεργασίες εξαρτώμενα που απαιτούνται για την απόδοση κάθε πλαίσιο, καθώς και εκτελέστε τυχόν πρόσθετες ενέργειες (για παράδειγμα, Αντιγραφή στο πλαίσιο αποδίδονται σε μια θέση αποθήκευσης).

>[AZURE.NOTE] Τα πρότυπα διαχείρισης έργων και εργασιών επεξεργαστή είναι ανεξάρτητες μεταξύ τους, ώστε να μπορείτε να επιλέξετε να χρησιμοποιήσετε και τα δύο ή μόνο ένα από αυτά, ανάλογα με τις απαιτήσεις της εργασίας σας υπολογισμού και τις προτιμήσεις σας.

Όπως φαίνεται στο παρακάτω διάγραμμα, θα μεταβείτε μιας εργασίας υπολογισμού που χρησιμοποιεί αυτά τα πρότυπα έως τρία στάδια:

1. Ο κωδικός προγράμματος-πελάτη (π.χ., εφαρμογή, υπηρεσία web, κ.λπ.) υποβάλλει μια εργασία με την υπηρεσία δέσμη στο Azure, καθορίζοντας ως τη διαχείριση έργων της εργασίας στο πρόγραμμα διαχείρισης έργου.

2. Η υπηρεσία δέσμη εκτελεί την εργασία manager σε έναν κόμβο υπολογισμού και την διαχωριστή εργασία ανοίγει τον καθορισμένο αριθμό εργασίας επεξεργαστής εργασίες, στην όπως πολλές τον υπολογισμό κόμβους όπως απαιτείται, με βάση τις παραμέτρους και προδιαγραφές στον κώδικα διαίρεσης εργασίας.

3. Οι εργασίες επεξεργαστής εργασίας εκτελούνται ανεξάρτητα από αυτό, παράλληλα, για να επεξεργαστείτε τα δεδομένα εισόδου και δημιουργία των δεδομένων εξόδου.

![Διάγραμμα που δείχνει τον τρόπο κωδικός προγράμματος-πελάτη αλληλεπιδρά με την υπηρεσία δέσμης][diagram01]

## <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

Για να χρησιμοποιήσετε τα πρότυπα δέσμη, θα πρέπει τα εξής:

* Ένας υπολογιστής με το Visual Studio 2015, ή νεότερη έκδοση, ήδη εγκατεστημένα σε αυτόν.

* Τα πρότυπα δέσμης, τα οποία είναι διαθέσιμα από τη [Συλλογή του Visual Studio] [ vs_gallery] ως Visual Studio επεκτάσεις. Υπάρχουν δύο τρόποι για να λάβετε τα πρότυπα:

  * Εγκατάσταση των προτύπων χρησιμοποιώντας το πλαίσιο διαλόγου **επεκτάσεις και ενημερώσεις** στο Visual Studio (για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Εύρεση και χρήση του Visual Studio επεκτάσεις][vs_find_use_ext]). Στο παράθυρο διαλόγου **επεκτάσεις και ενημερώσεις** , κάντε αναζήτηση και λήψη τις εξής επεκτάσεις δύο:

    * Azure της διαχείρισης έργων δέσμη με διαίρεσης εργασίας
    * Επεξεργαστής εργασίας Azure δέσμης

  * Λήψη των προτύπων από τη συλλογή online για το Visual Studio: [Πρότυπα έργων δέσμη Microsoft Azure][vs_gallery_templates]

* Εάν σκοπεύετε να χρησιμοποιήσετε τη δυνατότητα [Πακέτων εφαρμογών](batch-application-packages.md) για να αναπτύξετε τη διαχείριση έργων και επεξεργαστής εργασίας με τη δέσμη τον υπολογισμό κόμβους, πρέπει να δημιουργήσετε τη σύνδεση ενός λογαριασμού χώρου αποθήκευσης στο λογαριασμό σας δέσμης.

## <a name="preparation"></a>Προετοιμασία

Συνιστάται η δημιουργία μιας λύσης που μπορεί να περιέχει το διαχειριστή έργου, καθώς και τον επεξεργαστή εργασίας σας, επειδή αυτό μπορεί να είναι πιο εύκολη για την κοινή χρήση κώδικα μεταξύ της διαχείρισης έργων και των προγραμμάτων επεξεργαστής εργασίας. Για να δημιουργήσετε αυτήν τη λύση, ακολουθήστε τα παρακάτω βήματα:

1. Ανοίξτε το Visual Studio 2015 και επιλέξτε **αρχείο** > **Δημιουργία** > **έργου**.

2. Στην περιοχή **πρότυπα**, αναπτύξτε **Άλλοι τύποι έργου**, κάντε κλικ στην επιλογή **Visual Studio λύσεις**και, στη συνέχεια, επιλέξτε **Κενό λύση**.

3. Πληκτρολογήστε ένα όνομα που περιγράφει το σκοπό αυτής της λύσης (π.χ., "LitwareBatchTaskPrograms") και της εφαρμογής σας.

4. Για να δημιουργήσετε τη νέα λύση, κάντε κλικ στο **κουμπί OK**.

## <a name="job-manager-template"></a>Το πρότυπο διαχείρισης έργου

Το πρότυπο διαχείρισης έργων βοηθά να εφαρμόζετε μια εργασία διαχείρισης έργου που μπορούν να εκτελούν τις ακόλουθες ενέργειες:

* Διαιρέστε μια εργασία σε πολλές εργασίες.
* Υποβολή αυτές τις εργασίες για να εκτελέσετε στη δέσμη.

>[AZURE.NOTE] Για περισσότερες πληροφορίες σχετικά με τη Διαχείριση εργασιών, ανατρέξτε στο θέμα [επισκόπηση δυνατοτήτων δέσμης για τους προγραμματιστές](batch-api-basics.md#job-manager-task).

### <a name="create-a-job-manager-using-the-template"></a>Δημιουργήστε ένα διαχειριστή έργου χρησιμοποιώντας το πρότυπο

Για να προσθέσετε ένα διαχειριστή έργου στη λύση που δημιουργήσατε νωρίτερα, ακολουθήστε τα παρακάτω βήματα:

1. Ανοίξτε την υπάρχουσα λύση στο Visual Studio 2015.

2. Στην Εξερεύνηση λύσεων, κάντε δεξί κλικ της λύσης, κάντε κλικ στην επιλογή **Προσθήκη** > **Νέο έργο**.

3. Στην περιοχή **Visual C#**, κάντε κλικ στο **Cloud**και, στη συνέχεια, κάντε κλικ στη **Διαχείριση έργου δέσμη Azure με διαίρεσης εργασίας**.

4. Πληκτρολογήστε ένα όνομα που περιγράφει την εφαρμογή και προσδιορίζει αυτό το έργο ως διαχειριστής του έργου (π.χ. "LitwareJobManager").

5. Για να δημιουργήσετε το έργο, κάντε κλικ στο **κουμπί OK**.

6. Τέλος, δημιουργήστε το έργο για να επιβάλετε το Visual Studio για να φορτώσετε όλα τα πακέτα NuGet αναφοράς και για να επιβεβαιώσετε ότι το έργο είναι έγκυρη πριν να ξεκινήσετε την τροποποίηση.

### <a name="job-manager-template-files-and-their-purpose"></a>Αρχεία προτύπων διαχείρισης έργων και το σκοπό τους

Όταν δημιουργείτε ένα έργο χρησιμοποιώντας το πρότυπο διαχείρισης έργου, δημιουργεί τρεις ομάδες αρχείων κώδικα:

* Το κύριο πρόγραμμα αρχείο (Program.cs). Περιέχει το σημείο εισόδου προγράμματος και χειρισμού εξαιρέσεων ανώτατου επιπέδου. Δεν θα πρέπει κανονικά πρέπει να τροποποιήσετε.

* Ο κατάλογος Framework. Περιέχει τα αρχεία που είναι υπεύθυνος για την εργασία 'στερεότυπο' που πραγματοποιήθηκε από το πρόγραμμα διαχείρισης εργασίας – αποσυσκευασία παραμέτρους, προσθήκη εργασιών για τη μαζική εργασία, κ.λπ. Κανονικά δεν πρέπει να πρέπει να τροποποιήσετε αυτά τα αρχεία.

* Το αρχείο διαίρεσης εργασίας (JobSplitter.cs). Αυτό είναι όπου θα τοποθετήσετε λογικής συγκεκριμένη εφαρμογή για τη διαίρεση μιας εργασίας σε εργασίες.

Φυσικά, μπορείτε να προσθέσετε επιπλέον αρχείων όπως απαιτείται για την υποστήριξη τον κωδικό διαίρεσης εργασίας, ανάλογα με την πολυπλοκότητα της λογικής η διαίρεση εργασίας.

Το πρότυπο δημιουργεί επίσης τυπική αρχεία έργου .NET όπως ένα αρχείο .csproj app.config, packages.config, κ.λπ.

Τα υπόλοιπα αυτή η ενότητα περιγράφει τα διαφορετικά αρχεία και τους δομή του κώδικα και εξηγεί τι σημαίνει κάθε κατηγορία.

![Οπτική Εξερεύνηση λύσεων Studio που εμφανίζει τη Διαχείριση έργου λύση προτύπου][solution_explorer01]

**Αρχεία Framework**

* `Configuration.cs`: Ενσωματώνει τη φόρτωση εργασία δεδομένων ρύθμισης παραμέτρων όπως λεπτομέρειες λογαριασμού δέσμη, διαπιστευτήρια λογαριασμού συνδεδεμένων χώρου αποθήκευσης, εργασία και πληροφορίες εργασίας και παράμετροι εργασίας. Επίσης, παρέχει πρόσβαση σε μεταβλητές που ορίζονται από το δέσμη περιβάλλοντος (ανατρέξτε στο θέμα ρυθμίσεις περιβάλλοντος για τις εργασίες, στην τεκμηρίωση της δέσμης) μέσω τάξη Configuration.EnvironmentVariable.

* `IConfiguration.cs`: Συνοψίζει την υλοποίηση της κλάσης ρύθμισης παραμέτρων, ώστε να μπορείτε να κάνετε δοκιμή μονάδας σας διαίρεσης εργασίας χρησιμοποιώντας ένα αντικείμενο πλαστές ή mock ρύθμισης παραμέτρων.

* `JobManager.cs`: Orchestrates τα στοιχεία από το πρόγραμμα διαχείρισης έργου. Είναι υπεύθυνος για την προετοιμασία διαχωριστή εργασία, κλήση διαχωριστή έργου, και την αποστολή των εργασιών που επιστρέφονται από το διαίρεσης εργασίας για να τον υπεύθυνο υποβολής εργασίας.

* `JobManagerException.cs`: Αντιπροσωπεύει ένα μήνυμα σφάλματος που απαιτεί ο διαχειριστής έργου για να τερματιστεί. JobManagerException χρησιμοποιείται για να αναδιπλώσετε 'αναμενόμενη' σφάλματα όπου συγκεκριμένες πληροφορίες διαγνωστικών παρέχονται ως μέρος του τερματισμού.

* `TaskSubmitter.cs`: Αυτή η κατηγορία είναι υπεύθυνος για την προσθήκη εργασιών που επιστρέφονται από το διαίρεσης εργασίας για τη μαζική εργασία. Τις συγκεντρώσεις κλάσης JobManager τη σειρά των εργασιών σε δέσμες για αποτελεσματική αλλά έγκαιρη εκτός από την εργασία, στη συνέχεια, κλήσεις TaskSubmitter.SubmitTasks σε ένα νήμα φόντου για κάθε δέσμη.

**Διαίρεση εργασίας**

`JobSplitter.cs`: Αυτή η κλάση περιέχει συγκεκριμένη εφαρμογή λογική για τη διαίρεση της εργασίας σε εργασίες. Πλαίσιο ενεργοποιεί τη μέθοδο JobSplitter.Split για να αποκτήσετε μια ακολουθία εργασίες, η οποία προσθέτει στο έργο, όπως η μέθοδος επιστρέφει τους. Αυτή είναι η κλάση όπου που θα εισαγάγει της λογικής της εργασίας σας. Υλοποίηση της μεθόδου διαίρεσης για να επιστρέψει μια ακολουθία των παρουσιών CloudTask που αντιπροσωπεύει τις εργασίες στο οποίο θέλετε να δημιουργήσετε διαμερίσματα της εργασίας.

**Τυπική αρχεία του έργου γραμμής εντολών .NET**

* `App.config`: Αρχείο ρύθμισης παραμέτρων εφαρμογής τυπική .NET.

* `Packages.config`: Αρχείο εξάρτηση πακέτου τυπική NuGet.

* `Program.cs`: Περιέχει το σημείο εισόδου προγράμματος και χειρισμού εξαιρέσεων ανώτατου επιπέδου.

### <a name="implementing-the-job-splitter"></a>Εφαρμογή του διαίρεσης εργασίας

Όταν ανοίγετε το έργο πρότυπο διαχείρισης έργου, το project θα έχει το αρχείο JobSplitter.cs που ανοίγουν από προεπιλογή. Μπορείτε να υλοποιήσετε της λογικής διαίρεσης για τις εργασίες στο του φόρτου εργασίας σας, χρησιμοποιώντας την προβολή μέθοδο Split() παρακάτω:

```csharp
/// <summary>
/// Gets the tasks into which to split the job. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The job manager framework invokes the Split method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation should return tasks lazily, for example using a C#
/// iterator and the "yield return" statement; this allows tasks to be added
/// and to start running while splitting is still in progress.
/// </summary>
/// <returns>The tasks to be added to the job. Tasks are added automatically
/// by the job manager framework as they are returned by this method.</returns>
public IEnumerable<CloudTask> Split()
{
    // Your code for the split logic goes here.
    int startFrame = Convert.ToInt32(_parameters["StartFrame"]);
    int endFrame = Convert.ToInt32(_parameters["EndFrame"]);

    for (int i = startFrame; i <= endFrame; i++)
    {
        yield return new CloudTask("myTask" + i, "cmd /c dir");
    }
}
```

>[AZURE.NOTE] Ενότητα με σχόλια στο το `Split()` μέθοδος είναι η μόνη ενότητα του κώδικα πρότυπο διαχείρισης έργου που προορίζονται για την τροποποίηση με την προσθήκη της λογικής για να διαιρέσετε τις εργασίες σε διαφορετικές εργασίες. Εάν θέλετε να τροποποιήσετε μια διαφορετική ενότητα του προτύπου, βεβαιωθείτε ότι είναι familiarized με τον τρόπο λειτουργίας της δέσμης, και δοκιμάστε το μερικά από τα [δείγματα κώδικα δέσμης][github_samples].

Υλοποίηση της Split() έχει πρόσβαση σε:

* Τις παραμέτρους της εργασίας, μέσω του `_parameters` πεδίο.
* Το αντικείμενο CloudJob που αντιπροσωπεύει την εργασία, μέσω του `_job` πεδίο.
* Το αντικείμενο CloudTask που αντιπροσωπεύει την εργασία manager, μέσω του `_jobManagerTask` πεδίο.

Σας `Split()` εφαρμογή δεν χρειάζεται να προσθέσετε εργασίες στο έργο απευθείας. Αντί για αυτό, τον κωδικό πρέπει να επιστρέψει μια ακολουθία CloudTask αντικειμένων και αυτά θα προστεθούν στο έργο αυτόματα από τις κατηγορίες framework που ενεργοποιήσει το διαίρεσης εργασίας. Είναι κοινά και για χρήση C# του επαναλήπτη (`yield return`) για την εφαρμογή γραμμές διαχωρισμού εργασία αυτό σας επιτρέπει τις εργασίες για να ξεκινήσετε με όσο το δυνατόν πιο σύντομα και όχι σε αναμονή για όλες τις εργασίες που θα υπολογιστεί η δυνατότητα.

**Αποτυχία διαίρεσης εργασίας**

Αν σας διαίρεσης εργασίας παρουσιάσει σφάλμα, θα πρέπει είτε:

* Τερματισμός την ακολουθία χρησιμοποιώντας το C# `yield break` πρόταση, στο οποίο πεζών-κεφαλαίων της διαχείρισης έργων θα αντιμετωπίζεται ως επιτυχημένη; ή

* Δημιουργήστε μια εξαίρεση, στην οποία περίπτωση που ο διαχειριστής του έργου θα αντιμετωπίζεται ως απέτυχε και ενδέχεται να επαναληφθεί ανάλογα με τον τρόπο ο υπολογιστής-πελάτης έχει ρυθμίσει τις παραμέτρους του).

Και στις δύο περιπτώσεις, θα είναι κατάλληλη για να εκτελέσετε όλες τις εργασίες που επιστρέφονται από το διαίρεσης εργασίας ήδη και να προστεθεί για τη μαζική εργασία. Εάν δεν θέλετε να συμβεί αυτό, στη συνέχεια, μπορείτε να:

* Τερματισμός της εργασίας πριν την επιστροφή από το διαίρεσης εργασίας

* Διατύπωση στη συλλογή ολόκληρη την εργασία πριν από την επιστροφή του (δηλαδή, επιστρέφουν μια `ICollection<CloudTask>` ή `IList<CloudTask>` αντί για εφαρμογή σας διαίρεσης εργασίας χρησιμοποιώντας μια επαναλήπτη C#)

* Χρησιμοποιήστε εξαρτήσεις εργασιών για να κάνετε όλων των εργασιών που εξαρτώνται από την επιτυχή ολοκλήρωση της διαχείρισης έργου

**Επαναλήψεις Διαχείριση έργου**

Εάν η διαχείριση εργασία αποτύχει, ενδέχεται να επαναληφθεί από την υπηρεσία δέσμη ανάλογα με τις ρυθμίσεις προγράμματος-πελάτη "Επανάληψη". Σε γενικές γραμμές, αυτό είναι ασφαλής, επειδή όταν το πλαίσιο προσθέτει εργασίες στο έργο, αγνοεί όλες τις εργασίες που υπάρχουν ήδη. Ωστόσο, εάν τον υπολογισμό εργασίες είναι ακριβό, ίσως δεν θέλετε να αναλάβει το κόστος των επανάληψη υπολογισμού των εργασιών που έχουν προστεθεί ήδη στο έργο; Αντίθετα, εάν η εκ νέου εκτέλεση δεν εγγυάται για τη δημιουργία των αναγνωριστικών εργασιών ίδια, στη συνέχεια, τη συμπεριφορά "Παράβλεψη διπλότυπες επαφές" θα δεν εκκίνηση. Σε αυτές τις περιπτώσεις, μπορείτε να σχεδιάσετε το διαίρεσης εργασίας για να εντοπίσετε την εργασία που έχει ήδη πραγματοποιηθεί και δεν επαναλαμβάνονται, για παράδειγμα, εκτελώντας μια CloudJob.ListTasks πριν να ξεκινήσετε την απόδοση εργασίες.

### <a name="exit-codes-and-exceptions-in-the-job-manager-template"></a>Έξοδος από τους κωδικούς και εξαιρέσεις στο πρότυπο με το διαχειριστή έργου

Κωδικοί εξόδου και εξαιρέσεις παρέχουν ένα μηχανισμό για να καθορίσετε το αποτέλεσμα της εκτέλεσης ενός προγράμματος και μπορούν να σας βοηθήσουν να αναγνωρίσετε προβλήματα με την εκτέλεση του προγράμματος. Το πρότυπο διαχείρισης έργων εφαρμόζει τους κωδικούς εξόδου και τις εξαιρέσεις που περιγράφονται σε αυτήν την ενότητα.

Μια εργασία διαχείρισης έργου που έχει υλοποιηθεί με το πρότυπο διαχείρισης έργου μπορεί να επιστρέψει κωδικών τρεις πιθανές εξόδου:

| Κωδικός | Περιγραφή |
|------|-------------|
| 0    | Ο διευθυντής εργασία ολοκληρώθηκε με επιτυχία. Τον κωδικό διαίρεσης εργασίας εκτελέσατε ολοκλήρωσης και όλες τις εργασίες που έχουν προστεθεί στο έργο. |
| 1    | Απέτυχε η εργασίας διαχείριση του έργου με μια εξαίρεση σε ένα τμήμα 'αναμενόμενη' του προγράμματος. Η εξαίρεση έχει μεταφραστεί σε μια JobManagerException με διαγνωστικών πληροφοριών και, εάν είναι δυνατόν, προτάσεις για την επίλυση της αποτυχίας. |
| 2    | Απέτυχε η εργασίας διαχείριση του έργου με μια εξαίρεση 'μη αναμενόμενο'. Η εξαίρεση καταγράφηκε τυπική έξοδο, αλλά δεν ήταν δυνατή η για να προσθέσετε τυχόν πρόσθετες πληροφορίες diagnostic ή αποκατάσταση εύρυθμης λειτουργίας της διαχείρισης έργου. |

Στην περίπτωση αποτυχίας εργασιών διαχείρισης έργου, ορισμένες εργασίες μπορεί να εξακολουθούν να έχουν προστεθεί στην υπηρεσία πριν από το σφάλμα. Αυτές οι εργασίες θα εκτελείται ως συνήθως. Ανατρέξτε στο θέμα "Αποτυχία διαίρεσης εργασίας" παραπάνω για τη συζήτηση αυτής της διαδρομής κώδικα.

Όλες τις πληροφορίες που επιστρέφονται από εξαιρέσεις είναι γραμμένο σε αρχεία stdout.txt και stderr.txt. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Χειρισμού σφαλμάτων](batch-api-basics.md#error-handling).

### <a name="client-considerations"></a>Ζητήματα του υπολογιστή-πελάτη

Αυτή η ενότητα περιγράφει ορισμένες απαιτήσεις εφαρμογή προγράμματος-πελάτη κατά την κλήση διαχείρισης έργου που βασίζονται σε αυτό το πρότυπο. Δείτε [πώς μπορείτε να μεταβιβάζουν τις παραμέτρους και μεταβλητές περιβάλλοντος από τον κώδικα του προγράμματος-πελάτη](#pass-environment-settings) για λεπτομέρειες σχετικά με τη διέλευση παραμέτρους και ρυθμίσεων περιβάλλοντος.

**Υποχρεωτική διαπιστευτήρια**

Για να προσθέσετε εργασίες στη Azure μαζική εργασία, την εργασία manager απαιτεί το διεύθυνση URL δέσμης Azure λογαριασμού και αριθμού-κλειδιού. Πρέπει να μεταβιβάσετε αυτά τα στοιχεία στο περιβάλλον μεταβλητές που ονομάζεται YOUR_BATCH_URL και YOUR_BATCH_KEY. Μπορείτε να ορίσετε αυτές στη Διαχείριση έργου ρυθμίσεων περιβάλλοντος εργασίας. Για παράδειγμα, σε ένα C# πρόγραμμα-πελάτη:

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    new EnvironmentSetting("YOUR_BATCH_URL", "https://account.region.batch.azure.com"),
    new EnvironmentSetting("YOUR_BATCH_KEY", "{your_base64_encoded_account_key}"),
};
```
**Χώρος αποθήκευσης διαπιστευτηρίων**

Συνήθως, ο υπολογιστής-πελάτης δεν χρειάζεται να παρέχετε τα διαπιστευτήρια λογαριασμού συνδεδεμένων χώρου αποθήκευσης για τη Διαχείριση εργασία επειδή (α) πιο οι διαχειριστές έργου, δεν χρειάζεται να ρητά πρόσβαση στο λογαριασμό συνδεδεμένων χώρου αποθήκευσης και (β) ο λογαριασμός συνδεδεμένων αποθήκευσης παρέχεται συχνά σε όλες τις εργασίες ως μια συνηθισμένη ρύθμιση περιβάλλοντος για το έργο. Αν που δεν παρέχουν το λογαριασμό χώρου αποθήκευσης συνδεδεμένων μέσω τις κοινές ρυθμίσεις περιβάλλοντος και τη διαχείριση έργων απαιτεί πρόσβαση στον συνδεδεμένο χώρο αποθήκευσης, στη συνέχεια, θα πρέπει να δώσετε τα διαπιστευτήρια συνδεδεμένων χώρου αποθήκευσης ως εξής:

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    /* other environment settings */
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

**Ρυθμίσεις εργασίας διαχείρισης έργου**

Ο υπολογιστής-πελάτης πρέπει να ορίσετε τη σημαία *killJobOnCompletion* διαχείριση έργων σε **false**.

Είναι συνήθως ασφαλές για το πρόγραμμα-πελάτη για να ορίσετε *runExclusive* σε **false**.

Ο υπολογιστής-πελάτης θα πρέπει να χρησιμοποιήσετε τη συλλογή *resourceFiles* ή *applicationPackageReferences* για την εργασία για διαχείριση εκτελέσιμο (και τα απαιτούμενα DLL) αναπτυχθεί στον κόμβο υπολογισμού.

Από προεπιλογή, ο διαχειριστής του έργου θα δεν επαναληφθεί εάν αποτύχει. Ανάλογα με το λογικής διαχείρισης έργου, ο υπολογιστής-πελάτης ίσως θέλετε να ενεργοποιήσετε επαναλήψεις μέσω *περιορισμούς*/*maxTaskRetryCount*.

**Ρυθμίσεις εργασίας**

Εάν η εργασία διαίρεσης εκπέμπει εργασίες με τις εξαρτήσεις, ο υπολογιστής-πελάτης πρέπει να ορίσετε usesTaskDependencies την εργασία στην τιμή true.

Στο μοντέλο διαίρεσης εργασίας, είναι ασυνήθιστο για προγράμματα-πελάτες να θέλετε να προσθέσετε εργασίες εργασίες πέραν τι δημιουργεί το διαίρεσης εργασίας. Το πρόγραμμα-πελάτη, επομένως, θα πρέπει να ρυθμίσετε κανονικά η εργασία *onAllTasksComplete* να **terminatejob**.

## <a name="task-processor-template"></a>Πρότυπο επεξεργαστής εργασιών

Ένα πρότυπο επεξεργαστής εργασίας σάς βοηθά να υλοποιήσετε ένα πρόγραμμα επεξεργασίας εργασιών που μπορούν να εκτελούν τις ακόλουθες ενέργειες:

* Ρυθμίστε τις πληροφορίες που απαιτούνται από κάθε εργασία δέσμης για να εκτελέσετε.
* Εκτελέστε όλες τις ενέργειες που απαιτούνται από κάθε εργασία δέσμης.
* Αποθηκεύστε εξόδους εργασίας μόνιμη χώρου αποθήκευσης.

Παρόλο που ένα πρόγραμμα επεξεργασίας εργασίας δεν απαιτείται για την εκτέλεση εργασιών στη δέσμη, το βασικό πλεονέκτημα της χρησιμοποιώντας ένα πρόγραμμα επεξεργασίας εργασίας είναι ότι παρέχει μια περιτυλίγματος για την υλοποίηση όλες οι ενέργειες εκτέλεση εργασιών σε μία θέση. Για παράδειγμα, εάν πρέπει να εκτελέσετε διάφορες εφαρμογές στο περιβάλλον κάθε εργασίας, ή εάν θέλετε να αντιγράψετε δεδομένα για μόνιμη αποθήκευση μετά την ολοκλήρωση κάθε εργασίας.

Τις ενέργειες που εκτελούνται από τον επεξεργαστή εργασίας μπορεί να είναι ως απλό ή μιγαδικού, και όσα ή ως λίγα, όπως απαιτείται από το φόρτο εργασίας. Επιπλέον, με την εφαρμογή όλες οι ενέργειες εργασίας σε έναν επεξεργαστή εργασίας, μπορείτε να εύκολα ενημερώσετε ή να προσθέσετε ενέργειες με βάση τις αλλαγές σε εφαρμογές ή απαιτήσεις φόρτο εργασίας. Ωστόσο, σε ορισμένες περιπτώσεις μια επεξεργαστής εργασίας ενδέχεται να μην είναι η βέλτιστη λύση για την εφαρμογή όπως το να προσθέσετε περιττές πολυπλοκότητα, για παράδειγμα, όταν εκτελεί εργασίες που μπορεί να ξεκινήσει γρήγορα από μια απλή γραμμή εντολών.

### <a name="create-a-task-processor-using-the-template"></a>Δημιουργήστε ένα πρόγραμμα επεξεργασίας εργασίας με χρήση του προτύπου

Για να προσθέσετε ένα πρόγραμμα επεξεργασίας εργασίας της λύσης που δημιουργήσατε νωρίτερα, ακολουθήστε τα παρακάτω βήματα:

1. Ανοίξτε την υπάρχουσα λύση στο Visual Studio 2015.

2. Στην Εξερεύνηση λύσεων, κάντε δεξί κλικ της λύσης, κάντε κλικ στην επιλογή **Προσθήκη**και, στη συνέχεια, κάντε κλικ στην επιλογή **Νέο έργο**.

3. Στην περιοχή **Visual C#**, κάντε κλικ στο **Cloud**και, στη συνέχεια, κάντε κλικ στην επιλογή **Azure δέσμη εργασιών επεξεργαστής**.

4. Πληκτρολογήστε ένα όνομα που περιγράφει την εφαρμογή και προσδιορίζει αυτό το έργο ως ο επεξεργαστής εργασίας (π.χ. "LitwareTaskProcessor").

5. Για να δημιουργήσετε το έργο, κάντε κλικ στο **κουμπί OK**.

6. Τέλος, δημιουργήστε το έργο για να επιβάλετε το Visual Studio για να φορτώσετε όλα τα πακέτα NuGet αναφοράς και για να επιβεβαιώσετε ότι το έργο είναι έγκυρη πριν να ξεκινήσετε την τροποποίηση.

### <a name="task-processor-template-files-and-their-purpose"></a>Αρχεία προτύπων επεξεργαστής εργασίας και το σκοπό τους

Όταν δημιουργείτε ένα έργο χρησιμοποιώντας το πρότυπο επεξεργαστής εργασιών, δημιουργεί τρεις ομάδες αρχείων κώδικα:

* Το κύριο πρόγραμμα αρχείο (Program.cs). Περιέχει το σημείο εισόδου προγράμματος και χειρισμού εξαιρέσεων ανώτατου επιπέδου. Δεν θα πρέπει κανονικά πρέπει να τροποποιήσετε.

* Ο κατάλογος Framework. Περιέχει τα αρχεία που είναι υπεύθυνος για την εργασία 'στερεότυπο' που πραγματοποιήθηκε από το πρόγραμμα διαχείρισης εργασίας – αποσυσκευασία παραμέτρους, προσθήκη εργασιών για τη μαζική εργασία, κ.λπ. Κανονικά δεν πρέπει να πρέπει να τροποποιήσετε αυτά τα αρχεία.

* Το αρχείο επεξεργαστής εργασίας (TaskProcessor.cs). Αυτό είναι όπου θα τοποθετήσετε λογικής συγκεκριμένη εφαρμογή για την εκτέλεση μιας εργασίας (συνήθως με κλήση σε ένα υπάρχον εκτελέσιμο αρχείο). Παλαιοί και επεξεργασίας εξόδου κωδικό, όπως τη λήψη πρόσθετων δεδομένων ή την αποστολή αρχείων αποτέλεσμα, μεταβαίνει επίσης εδώ.

Φυσικά, μπορείτε να προσθέσετε επιπλέον αρχείων όπως απαιτείται για την υποστήριξη τον κωδικό επεξεργαστής εργασιών, ανάλογα με την πολυπλοκότητα της λογικής διαίρεσης εργασίας.

Το πρότυπο δημιουργεί επίσης τυπική αρχεία έργου .NET όπως ένα αρχείο .csproj app.config, packages.config, κ.λπ.

Τα υπόλοιπα αυτή η ενότητα περιγράφει τα διαφορετικά αρχεία και τους δομή του κώδικα και εξηγεί τι σημαίνει κάθε κατηγορία.

![Οπτική Εξερεύνηση λύσεων Studio που εμφανίζει τη λύση πρότυπο επεξεργαστής εργασίας][solution_explorer02]

**Αρχεία Framework**

* `Configuration.cs`: Ενσωματώνει τη φόρτωση εργασία δεδομένων ρύθμισης παραμέτρων όπως λεπτομέρειες λογαριασμού δέσμη, διαπιστευτήρια λογαριασμού συνδεδεμένων χώρου αποθήκευσης, εργασία και πληροφορίες εργασίας και παράμετροι εργασίας. Επίσης, παρέχει πρόσβαση σε μεταβλητές που ορίζονται από το δέσμη περιβάλλοντος (ανατρέξτε στο θέμα ρυθμίσεις περιβάλλοντος για τις εργασίες, στην τεκμηρίωση της δέσμης) μέσω τάξη Configuration.EnvironmentVariable.

* `IConfiguration.cs`: Συνοψίζει την υλοποίηση της κλάσης ρύθμισης παραμέτρων, ώστε να μπορείτε να κάνετε δοκιμή μονάδας σας διαίρεσης εργασίας χρησιμοποιώντας ένα αντικείμενο πλαστές ή mock ρύθμισης παραμέτρων.

* `TaskProcessorException.cs`: Αντιπροσωπεύει ένα μήνυμα σφάλματος που απαιτεί ο διαχειριστής έργου για να τερματιστεί. TaskProcessorException χρησιμοποιείται για να αναδιπλώσετε 'αναμενόμενη' σφάλματα όπου συγκεκριμένες πληροφορίες διαγνωστικών παρέχονται ως μέρος του τερματισμού.

**Επεξεργαστής εργασίας**

* `TaskProcessor.cs`: Εκτελεί την εργασία. Πλαίσιο ενεργοποιεί τη μέθοδο TaskProcessor.Run. Αυτή είναι η κλάση όπου που θα εισαγάγει τη συγκεκριμένη εφαρμογή λογική της εργασίας σας. Υλοποίηση της μεθόδου εκτέλεση για να:
  * Ανάλυση και επικύρωση οποιεσδήποτε παραμέτρους εργασίας
  * Σύνθεση της γραμμής εντολών για οποιοδήποτε εξωτερικό πρόγραμμα που θέλετε να καλέσετε
  * Καταγραφή οποιαδήποτε διαγνωστικών πληροφοριών που μπορεί να απαιτεί για σκοπούς εντοπισμού σφαλμάτων
  * Ξεκινήστε μια διεργασία χρησιμοποιώντας αυτήν τη γραμμή εντολών
  * Αναμονή για τη διαδικασία για να εξέλθετε από
  * Καταγραφή τον κωδικό εξόδου της διαδικασίας για να προσδιορίσετε αν ολοκληρώθηκε με επιτυχία ή απέτυχε
  * Αποθήκευση των αρχείων εξόδου που θέλετε να διατηρήσετε για μόνιμη χώρου αποθήκευσης

**Τυπική αρχεία του έργου γραμμής εντολών .NET**

* `App.config`: Αρχείο ρύθμισης παραμέτρων εφαρμογής τυπική .NET.
* `Packages.config`: Αρχείο εξάρτηση πακέτου τυπική NuGet.
* `Program.cs`: Περιέχει το σημείο εισόδου προγράμματος και χειρισμού εξαιρέσεων ανώτατου επιπέδου.

## <a name="implementing-the-task-processor"></a>Ο επεξεργαστής εργασίας εφαρμογής

Όταν ανοίγετε το έργο πρότυπο επεξεργαστής εργασίας, το project θα έχει το αρχείο TaskProcessor.cs που ανοίγουν από προεπιλογή. Μπορείτε να εφαρμόσετε την εκτέλεση λογική για τις εργασίες στο του φόρτου εργασίας σας, χρησιμοποιώντας τη μέθοδο εκτεταμένο φαίνεται παρακάτω:

```csharp
/// <summary>
/// Runs the task processing logic. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The task processor framework invokes the Run method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation will execute an external program (from resource files or
/// an application package), check the exit code of that program and
/// save output files to persistent storage.
/// </summary>
public async Task<int> Run()

{
    try
    {
        //Your code for the task processor goes here.
        var command = $"compare {_parameters["Frame1"]} {_parameters["Frame2"]} compare.gif";
        using (var process = Process.Start($"cmd /c {command}"))
        {
            process.WaitForExit();
            var taskOutputStorage = new TaskOutputStorage(
            _configuration.StorageAccount,
            _configuration.JobId,
            _configuration.TaskId
            );
            await taskOutputStorage.SaveAsync(
            TaskOutputKind.TaskOutput,
            @"..\stdout.txt",
            @"stdout.txt"
            );
            return process.ExitCode;
        }
    }
    catch (Exception ex)
    {
        throw new TaskProcessorException(
        $"{ex.GetType().Name} exception in run task processor: {ex.Message}",
        ex
        );
    }
}
```
>[AZURE.NOTE] Ενότητα με σχόλια στη μέθοδο εκτεταμένο είναι η μόνη ενότητα του κώδικα πρότυπο επεξεργαστής εργασιών που προορίζονται για να τροποποιήσετε, προσθέτοντας την εκτέλεση λογική για τις εργασίες στο του φόρτου εργασίας σας. Εάν θέλετε να τροποποιήσετε μια διαφορετική ενότητα του προτύπου, ανατρέξτε πρώτα εξοικειωθείτε με το πώς λειτουργεί η δέσμη, ανασκόπηση στην τεκμηρίωση δέσμης και δοκιμάζοντας μερικά από τα δείγματα κώδικα δέσμης.

Η μέθοδος εκτεταμένο είναι υπεύθυνοι για την εκκίνηση τη γραμμή εντολών, ξεκινώντας μία ή περισσότερες διεργασίες, αναμονή για όλους διαδικασία για να ολοκληρώσετε, αποθήκευση των αποτελεσμάτων και, τέλος επιστροφής με έναν κωδικό εξόδου. Η μέθοδος εκτεταμένο είναι όπου μπορείτε να υλοποιήσετε λογικής για την επεξεργασία για τις εργασίες σας. Πλαίσιο εργασίας επεξεργαστής καλεί τη μέθοδο εκτεταμένο για εσάς. Δεν χρειάζεται να καλέσετε τον εαυτό σας.

Υλοποίηση της εκτεταμένο έχει πρόσβαση σε:

* Τις παραμέτρους της εργασίας, μέσω του `_parameters` πεδίο.
* Τα αναγνωριστικά έργων και εργασιών, μέσω του `_jobId` και `_taskId` πεδία.
* Τις παραμέτρους της εργασίας, μέσω του `_configuration` πεδίο.

**Αποτυχία εργασίας**

Σε περίπτωση αποτυχίας, μπορείτε να κλείσετε τη μέθοδο εκτεταμένο με εμφάνιση εξαίρεσης, αλλά αυτό αφήνει τη λαβή επάνω επιπέδου εξαίρεση ελέγχουν τον κωδικό εξόδου εργασίας. Εάν χρειάζεστε για να ελέγξετε τον κωδικό εξόδου, ώστε να μπορείτε να διακρίνετε διαφορετικούς τύπους αποτυχίας, για παράδειγμα, για σκοπούς διαγνωστικών ή επειδή ορισμένες λειτουργίες αποτυχία θα πρέπει να τερματίσετε την εργασία και άλλα άτομα δεν θα πρέπει να, θα πρέπει να κλείσετε τη μέθοδο εκτεταμένο, επιστρέφοντας έναν κωδικό εξόδου μη μηδενική. Αυτό γίνεται τον κωδικό εξόδου εργασίας.

### <a name="exit-codes-and-exceptions-in-the-task-processor-template"></a>Έξοδος από τους κωδικούς και εξαιρέσεις στο πρότυπο επεξεργαστής εργασίας

Κωδικοί εξόδου και εξαιρέσεις παρέχουν ένα μηχανισμό για να καθορίσετε το αποτέλεσμα της εκτέλεσης ενός προγράμματος και να σας βοηθήσει να προσδιορίσετε τυχόν προβλήματα με την εκτέλεση του προγράμματος. Το πρότυπο εργασίας επεξεργαστής εφαρμόζει τους κωδικούς εξόδου και τις εξαιρέσεις που περιγράφονται σε αυτήν την ενότητα.

Μια εργασία Επεξεργαστής εργασίας που έχει υλοποιηθεί με το πρότυπο επεξεργαστής εργασίας μπορεί να επιστρέψει κωδικών τρεις πιθανές εξόδου:

| Κωδικός | Περιγραφή |
|------|-------------|
|  [Process.ExitCode][process_exitcode] | Ο επεξεργαστής εργασίας εκτελέσατε ολοκλήρωσης. Σημειώστε ότι αυτό δεν σημαίνει ότι το πρόγραμμα που καλέσατε ολοκληρώθηκε με επιτυχία – μόνο ότι ο επεξεργαστής εργασίας την κλήση με επιτυχία και έχει πραγματοποιηθεί οποιαδήποτε επεξεργασίας μετά χωρίς εξαιρέσεις. Την έννοια του κώδικα εξόδου εξαρτάται από το πρόγραμμα καλούνται – συνήθως κωδικό εξόδου 0 σημαίνει ότι το πρόγραμμα ολοκληρώθηκε με επιτυχία και οποιονδήποτε άλλο κωδικό, Έξοδος, σημαίνει ότι το πρόγραμμα απέτυχε. |
| 1    | Ο επεξεργαστής εργασίας απέτυχε με εξαίρεση σε ένα τμήμα 'αναμενόμενη' του προγράμματος. Η εξαίρεση έχει μετατραπεί σε ένα `TaskProcessorException` με διαγνωστικών πληροφοριών και, εάν είναι δυνατόν, προτάσεις για την επίλυση της αποτυχίας. |
| 2    | Ο επεξεργαστής εργασίας απέτυχε με εξαίρεση 'μη αναμενόμενο'. Η εξαίρεση καταγράφηκε τυπική έξοδο, αλλά ο επεξεργαστής εργασίας δεν ήταν δυνατό να προσθέστε τυχόν πρόσθετες πληροφορίες diagnostic ή αποκατάσταση εύρυθμης λειτουργίας. |

>[AZURE.NOTE] Εάν το πρόγραμμα που καλείτε χρησιμοποιεί τους κωδικούς εξόδου 1 και 2 για να υποδείξετε λειτουργίες αποτυχίας του συγκεκριμένου, στη συνέχεια, χρησιμοποιώντας τους κωδικούς εξόδου 1 και 2 για σφάλματα επεξεργαστής εργασίας είναι ασαφής. Μπορείτε να αλλάξετε αυτούς τους κωδικούς σφάλματος επεξεργαστής εργασίας για να τους κωδικούς χαρακτηριστικό εξόδου με την επεξεργασία περιπτώσεις εξαίρεσης στο αρχείο Program.cs.

Όλες τις πληροφορίες που επιστρέφονται από εξαιρέσεις είναι γραμμένο σε αρχεία stdout.txt και stderr.txt. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα Χειρισμός σφάλματος, στην τεκμηρίωση της δέσμης.

### <a name="client-considerations"></a>Ζητήματα του υπολογιστή-πελάτη

**Χώρος αποθήκευσης διαπιστευτηρίων**

Εάν ο επεξεργαστής εργασίας σας χρησιμοποιεί χώρο αποθήκευσης αντικειμένων blob του Azure για να παραμένει εξόδους, για παράδειγμα χρησιμοποιώντας τη βιβλιοθήκη Βοήθειας συμβάσεις αρχείο, στη συνέχεια, που χρειάζεται πρόσβαση σε *είτε* στο cloud αποθήκευσης λογαριασμό διαπιστευτήρια *ή* μια διεύθυνση URL κοντέινερ blob που περιλαμβάνει μια υπογραφή κοινόχρηστη πρόσβαση (συσχετισμών Ασφαλείας). Το πρότυπο περιλαμβάνει υποστήριξη για την παροχή διαπιστευτηρίων μέσω κοινών μεταβλητές περιβάλλοντος. Το πρόγραμμα-πελάτη μπορούν να μεταβιβάζουν τα διαπιστευτήρια αποθήκευσης ως εξής:

```csharp
job.CommonEnvironmentSettings = new [] {
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

Το λογαριασμό χώρου αποθήκευσης είναι διαθέσιμη στην τάξη TaskProcessor μέσω του `_configuration.StorageAccount` την ιδιότητα.

Εάν προτιμάτε να χρησιμοποιήσετε μια διεύθυνση URL κοντέινερ με συσχετισμούς Ασφαλείας, μπορείτε να περάσετε αυτό επίσης μέσω μιας ρύθμισης κοινές περιβάλλον εργασίας, αλλά το πρότυπο επεξεργαστής εργασίας δεν περιλαμβάνει προς το παρόν ενσωματωμένο υποστήριξης για αυτό.

**Ρύθμιση χώρου αποθήκευσης**

Συνιστάται να ότι η εργασία manager προγράμματος-πελάτη ή εργασία Δημιουργία οποιοδήποτε κοντέινερ που απαιτούνται από εργασίες πριν από την προσθήκη των εργασιών στο έργο. Αυτό είναι υποχρεωτική εάν χρησιμοποιείτε μια διεύθυνση URL κοντέινερ με συσχετισμούς Ασφαλείας, όπως μια διεύθυνση URL δεν περιλαμβάνει το δικαίωμα δημιουργίας του κοντέινερ. Συνιστάται να ακόμα και αν περάσετε διαπιστευτήρια λογαριασμού χώρου αποθήκευσης, όπως αποθηκεύει κάθε εργασίας που χρειάζεται για να καλέσετε CloudBlobContainer.CreateIfNotExistsAsync στο κοντέινερ.

## <a name="pass-parameters-and-environment-variables"></a>Μεταβίβαση παραμέτρους και μεταβλητές περιβάλλοντος

### <a name="pass-environment-settings"></a>Μεταβίβαση ρυθμίσεων περιβάλλοντος

Ένας υπολογιστής-πελάτης να μεταφέρουν πληροφορίες στην εργασία διαχείρισης έργου με τη μορφή ρυθμίσεων περιβάλλοντος. Αυτές οι πληροφορίες, στη συνέχεια, μπορούν να χρησιμοποιηθούν από την εργασία manager κατά τη δημιουργία τις εργασίες επεξεργαστής εργασίας που θα εκτελείται ως μέρος του υπολογισμού έργου. Παραδείγματα των πληροφοριών που μπορεί να περάσει ως ρυθμίσεων περιβάλλοντος είναι:

* Όνομα και το λογαριασμό πλήκτρα λογαριασμού χώρου αποθήκευσης
* Διεύθυνση URL δέσμης λογαριασμού
* Κλειδί λογαριασμού δέσμης

Η υπηρεσία δέσμη έχει έναν απλό μηχανισμό για τη μεταβίβαση ρυθμίσεων περιβάλλοντος σε μια εργασία διαχείρισης έργου, χρησιμοποιώντας το `EnvironmentSettings` ιδιότητα στο [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].

Για παράδειγμα, για να λάβετε το `BatchClient` παρουσία για ένα λογαριασμό δέσμη, μπορείτε να περάσετε όπως μεταβλητές περιβάλλοντος από το πρόγραμμα-πελάτη κώδικα της διεύθυνσης URL και κοινόχρηστου κλειδιού διαπιστευτήρια για το λογαριασμό δέσμης. Παρομοίως, για να αποκτήσετε πρόσβαση στο λογαριασμό του χώρου αποθήκευσης που συνδέεται με το λογαριασμό δέσμη, μπορείτε να περάσετε το όνομα λογαριασμού χώρου αποθήκευσης και τον αριθμό-κλειδί λογαριασμού χώρου αποθήκευσης ως μεταβλητές περιβάλλοντος.

### <a name="pass-parameters-to-the-job-manager-template"></a>Μεταβιβάζουν τις παραμέτρους για το πρότυπο διαχείρισης έργου

Σε πολλές περιπτώσεις, είναι χρήσιμο για να μεταβιβάσετε παραμέτρους ανά εργασία manager εργασία, είτε για να ελέγξετε τη διαίρεση διαδικασία εργασία ή για να ρυθμίσετε τις παραμέτρους των εργασιών για την εργασία. Μπορείτε να το κάνετε με την αποστολή ενός αρχείου JSON με το όνομα parameters.json ως αρχείο πόρων για την εργασία manager. Οι παράμετροι, στη συνέχεια, μπορεί να γίνει διαθέσιμη στο το `JobSplitter._parameters` πεδίο στο πρότυπο με το διαχειριστή έργου.

>[AZURE.NOTE] Το πρόγραμμα χειρισμού ενσωματωμένων παραμέτρου υποστηρίζει μόνο συμβολοσειρά-συμβολοσειρά λεξικά. Εάν θέλετε να μεταβιβάζουν σύνθετες JSON τιμές ως τιμές παραμέτρων, θα χρειαστεί να περάσει αυτές ως συμβολοσειρές και ανάλυση τους στο διαχωριστή εργασία ή τροποποίηση του πλαισίου `Configuration.GetJobParameters` μέθοδο.

### <a name="pass-parameters-to-the-task-processor-template"></a>Μεταβιβάζουν τις παραμέτρους για το πρότυπο επεξεργαστής εργασίας

Μπορείτε επίσης να περάσετε παραμέτρους σε μεμονωμένες εργασίες υλοποιηθεί με τη χρήση του προτύπου επεξεργαστής εργασίας. Όπως ακριβώς με το πρότυπο διαχείρισης έργων, το πρότυπο επεξεργαστής εργασίας έχει για ένα αρχείο πόρων με το όνομα

Parameters.JSON και if εντοπίζεται το φορτώνει ως το λεξικό παραμέτρων. Υπάρχουν δύο επιλογές για τον τρόπο για να μεταβιβάσετε παραμέτρους τις εργασίες επεξεργαστής εργασίας:

* Χρησιμοποιήσετε ξανά τις παραμέτρους εργασία JSON. Αυτό λειτουργεί σωστά εάν οι παράμετροι μόνο είναι αυτά ολόκληρη την εργασία (για παράδειγμα, ένα απόδοση ύψος και πλάτος). Για να το κάνετε αυτό, όταν δημιουργείτε μια CloudTask σε διαχωριστή εργασία, Προσθήκη αναφοράς σε το αντικείμενο αρχείο πόρου parameters.json από ResourceFiles εργασία manager (`JobSplitter._jobManagerTask.ResourceFiles`) στη συλλογή ResourceFiles το CloudTask.

* Δημιουργία και αποστολή ενός εγγράφου parameters.json συγκεκριμένη εργασία ως μέρος της εκτέλεσης διαίρεσης εργασίας και αναφορά που blob στη συλλογή αρχείων πόρων της εργασίας. Αυτό είναι απαραίτητο εάν διαφορετικές εργασίες έχουν διαφορετικές παραμέτρους. Ένα παράδειγμα μπορεί να είναι ένα σενάριο απόδοση 3Δ όπου το ευρετήριο πλαισίου μεταβιβάζεται με την εργασία με την παράμετρο.

>[AZURE.NOTE] Το πρόγραμμα χειρισμού ενσωματωμένων παραμέτρου υποστηρίζει μόνο συμβολοσειρά-συμβολοσειρά λεξικά. Εάν θέλετε να μεταβιβάζουν σύνθετες JSON τιμές ως τιμές παραμέτρων, θα χρειαστεί να περάσει αυτές ως συμβολοσειρές και ανάλυση τους στον επεξεργαστή εργασίας ή να τροποποιήσετε το πλαίσιο `Configuration.GetTaskParameters` μέθοδο.

## <a name="next-steps"></a>Επόμενα βήματα

### <a name="persist-job-and-task-output-to-azure-storage"></a>Παραμένει εξόδου εργασία και εργασία με το χώρο αποθήκευσης Azure

Ένα άλλο χρήσιμο εργαλείο στην ανάπτυξη λύσης δέσμης είναι [Συμβάσεις αρχείων δέσμης Azure][nuget_package]. Χρησιμοποιήστε αυτήν .NET κλάσης τη βιβλιοθήκη (αυτήν τη στιγμή στην έκδοση preview) στις εφαρμογές σας .NET δέσμη για εύκολα αποθήκευση και ανάκτηση εξόδους εργασίας προς και από το χώρο αποθήκευσης Azure. [Εργασία παραμένει δέσμη Azure και εργασίας εξόδου](batch-task-output.md) περιέχει μια πλήρη συζήτηση σχετικά με τη βιβλιοθήκη και τη χρήση.

### <a name="batch-forum"></a>Φόρουμ δέσμης

Το [Φόρουμ δέσμη Azure] [ forum] στο MSDN είναι ένα καλό σημείο για να συζητήσετε δέσμης και να υποβάλετε ερωτήσεις σχετικά με την υπηρεσία. Κεντρικά στην επάνω από για χρήσιμες δημοσιεύσεις "ηλεκτρονικές", και δημοσιεύστε τις ερωτήσεις σας καθώς προκύπτουν ενώ δημιουργείτε τις λύσεις δέσμης.

[forum]: https://social.msdn.microsoft.com/forums/azure/en-US/home?forum=azurebatch
[net_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.jobmanagertask.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[process_exitcode]: https://msdn.microsoft.com/library/system.diagnostics.process.exitcode.aspx
[vs_gallery]: https://visualstudiogallery.msdn.microsoft.com/
[vs_gallery_templates]: https://go.microsoft.com/fwlink/?linkid=820714
[vs_find_use_ext]: https://msdn.microsoft.com/library/dd293638.aspx

[diagram01]: ./media/batch-visual-studio-templates/diagram01.png
[solution_explorer01]: ./media/batch-visual-studio-templates/solution_explorer01.png
[solution_explorer02]: ./media/batch-visual-studio-templates/solution_explorer02.png
