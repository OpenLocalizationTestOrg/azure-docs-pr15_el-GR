<properties
    pageTitle="B2C καταλόγου Azure Active Directory | Microsoft Azure"
    description="Δημιουργία εφαρμογών web, χρησιμοποιώντας την εφαρμογή Azure Active Directory του πρωτοκόλλου ελέγχου ταυτότητας OpenID σύνδεση."
    services="active-directory-b2c"
    documentationCenter=""
    authors="dstrockis"
    manager="mbaldwin"
    editor=""/>

<tags
    ms.service="active-directory-b2c"
    ms.workload="identity"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="07/22/2016"
    ms.author="dastrock"/>

# <a name="azure-active-directory-b2c-web-sign-in-with-openid-connect"></a>Azure Active Directory B2C: Web είσοδος με σύνδεση OpenID

Σύνδεση OpenID είναι ένα πρωτόκολλο ελέγχου ταυτότητας, ενσωματωμένη επάνω από το διακριτικό 2.0, που μπορούν να χρησιμοποιηθούν για να συνδεθείτε με ασφάλεια οι χρήστες σε εφαρμογές web.  Χρησιμοποιώντας την εφαρμογή B2C Azure Active Directory (Azure AD) της OpenID σύνδεση, μπορείτε να αναθέσετε εξωτερικό εγγραφής, είσοδος και άλλες δραστηριότητες διαχείρισης ταυτοτήτων αντιμετωπίσει στις εφαρμογές σας web για να Azure AD. Αυτός ο οδηγός θα σας δείξουν πώς μπορείτε να το κάνετε με τρόπο ανεξάρτητο γλώσσας. Αυτό θα περιγράφουν τον τρόπο για να στέλνετε και να λαμβάνετε μηνύματα HTTP χωρίς να χρησιμοποιήσετε οποιαδήποτε μας βιβλιοθηκών Άνοιγμα προέλευσης.

[Σύνδεση OpenID](http://openid.net/specs/openid-connect-core-1_0.html) επεκτείνει το πρωτόκολλο *εξουσιοδότησης* διακριτικό 2.0 για χρήση ως ένα πρωτόκολλο *ελέγχου ταυτότητας* . Αυτό σας επιτρέπει να εκτελέσετε καθολικής σύνδεσης με τη χρήση OAuth. Αυτό παρουσιάζει την έννοια της μια `id_token`, που είναι έναν κωδικό ασφαλείας που επιτρέπει το πρόγραμμα-πελάτη για να επαληθεύσετε την ταυτότητα του χρήστη και λάβετε προφίλ βασικές πληροφορίες σχετικά με το χρήστη.

Επειδή το επεκτείνει διακριτικό 2.0, επιτρέπει επίσης εφαρμογές για να αποκτήσετε με ασφάλεια **access_tokens**. Μπορείτε να χρησιμοποιήσετε access_tokens για πρόσβαση σε πόρους που προστατεύονται από ένα [διακομιστή εξουσιοδότησης](active-directory-b2c-reference-protocols.md#the-basics). Σας συνιστούμε να συνδεθείτε OpenID εάν δημιουργείτε μια εφαρμογή web που φιλοξενείται σε διακομιστή και πρόσβαση σε μέσω ενός προγράμματος περιήγησης. Εάν θέλετε να προσθέσετε διαχείρισης των ταυτοτήτων στις εφαρμογές του mobile ή επιφάνειας εργασίας με χρήση του Azure AD B2C, πρέπει να χρησιμοποιήσετε [διακριτικό 2.0](active-directory-b2c-reference-oauth-code.md) και όχι OpenID σύνδεση.

Azure AD B2C επεκτείνει το τυπικό πρωτόκολλο OpenID σύνδεση για να κάνετε περισσότερα από απλή ελέγχου ταυτότητας και εξουσιοδότησης. Αυτό παρουσιάζει την [**παράμετρο πολιτικής**](active-directory-b2c-reference-policies.md), που σας επιτρέπει να χρησιμοποιήσετε OpenID σύνδεση για να προσθέσετε εμπειρίες χρήστη για την εφαρμογή σας--όπως εγγραφής, είσοδος και διαχείριση προφίλ. Εδώ θα σας δείξουμε πώς μπορείτε να χρησιμοποιήσετε σύνδεση OpenID και τις πολιτικές για την υλοποίηση κάθε μία από αυτές τις εμπειρίες σε εφαρμογές web. Θα επίσης σας δείξουμε πώς μπορείτε να λάβετε access_tokens για πρόσβαση στο web APIs.

Ο παρακάτω αιτήσεις HTTP παράδειγμα θα χρησιμοποιήσει μας δείγμα καταλόγου B2C, **fabrikamb2c.onmicrosoft.com**, καθώς και μας δείγμα εφαρμογής **https://aadb2cplayground.azurewebsites.net** και τις πολιτικές. Είστε δωρεάν για να δοκιμάσετε τις αιτήσεις στον εαυτό σας χρησιμοποιώντας αυτές τις τιμές ή μπορείτε να τα αντικαταστήσετε με το δικό σας.
Μάθετε πώς μπορείτε να [λάβετε τη δική σας B2C μισθωτή, εφαρμογή, και τις πολιτικές](#use-your-own-b2c-directory).

## <a name="send-authentication-requests"></a>Αποστολή προσκλήσεων ελέγχου ταυτότητας
Όταν την εφαρμογή web της πρέπει να έλεγχο ταυτότητας του χρήστη και να εκτελεί μια πολιτική, αυτό μπορεί να κατευθύνετε το χρήστη για να το `/authorize` τελικού σημείου. Αυτό είναι το διαδραστικό τμήμα της ροής της, όπου ο χρήστης θα διαρκέσει στην πραγματικότητα ενέργεια, ανάλογα με την πολιτική.

Σε αυτήν την αίτηση, ο υπολογιστής-πελάτης υποδεικνύει τα δικαιώματα που απαιτούνται για να αποκτήσετε από το χρήστη στο το `scope` παράμετρο και την πολιτική για την εκτέλεση στο το `p` παραμέτρου. Τρία παραδείγματα παρέχονται παρακάτω (με αλλαγές γραμμών για αναγνωσιμότητα), κάθε μία με μια διαφορετική πολιτική. Για να εξοικειωθείτε με τον τρόπο λειτουργίας κάθε αίτηση, δοκιμάστε να επικολλώντας την αίτηση στο πρόγραμμα περιήγησης και την εκτέλεση του.

#### <a name="use-a-sign-in-policy"></a>Χρησιμοποιήστε μια πολιτική εισόδου

```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_sign_in
```

#### <a name="use-a-sign-up-policy"></a>Χρησιμοποιήστε μια πολιτική εγγραφής

```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_sign_up
```

#### <a name="use-an-edit-profile-policy"></a>Χρησιμοποιήστε μια πολιτική Επεξεργασία προφίλ

```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_edit_profile
```

| Παράμετρος | Απαιτείται; | Περιγραφή |
| ----------------------- | ------------------------------- | ----------------------- |
| client_id | Απαιτείται | Το Αναγνωριστικό εφαρμογής που έχουν εκχωρηθεί στην [πύλη του Azure](https://portal.azure.com/) για την εφαρμογή σας. |
| response_type | Απαιτείται | Τον τύπο απόκρισης, που πρέπει να περιλαμβάνει `id_token` για σύνδεση OpenID. Εάν η εφαρμογή web της θα πρέπει επίσης τα διακριτικά για την κλήση ενός API web, μπορείτε να χρησιμοποιήσετε `code+id_token`, όπως θα σας κάνει εδώ. |
| redirect_uri | Συνιστάται | Το redirect_uri της εφαρμογής, όπου μπορούν να αποστολής και λήψης από την εφαρμογή του ελέγχου ταυτότητας των απαντήσεων. Αυτό πρέπει να ταιριάζει ακριβώς με ένα από τα redirect_uris που καταχωρήσατε στην πύλη, με τη διαφορά ότι αυτό πρέπει να κωδικοποιηθεί ως διεύθυνση URL. |
| πεδίο εφαρμογής | Απαιτείται | Μια λίστα διαχωρισμένες με εύρους. Η τιμή μία εύρος δηλώνει να Azure AD και τα δύο από τα δικαιώματα που ζητήθηκαν. Το `openid` εύρος υποδεικνύει ένα δικαίωμα να πραγματοποιήσετε είσοδο στο χρήστη και να λάβετε δεδομένα σχετικά με το χρήστη με τη μορφή **id_tokens** (θα υπάρξουν περισσότερες δυνατότητες σε αυτό αργότερα στο άρθρο). Το `offline_access` εμβέλειας είναι προαιρετική για τις εφαρμογές web. Υποδεικνύει ότι της εφαρμογής σας θα χρειαστείτε μια **refresh_token** για μεγάλης διάρκειας πρόσβασης σε πόρους. |
| response_mode | Συνιστάται | Η μέθοδος που πρέπει να χρησιμοποιούνται για να στείλετε την προκύπτουσα authorization_code Επιστροφή στην εφαρμογή σας. Μπορεί να είναι ένα 'ερώτημα', 'form_post' ή 'τμήμα'.  για βέλτιστη ασφάλεια συνιστάται 'form_post'. |
| κατάσταση | Συνιστάται | Μια τιμή που περιλαμβάνονται στην αίτηση που θα επιστραφεί επίσης στην διακριτικού απάντηση. Μπορεί να είναι μια συμβολοσειρά οποιοδήποτε περιεχόμενο που θέλετε. Μια μοναδική τιμή που δημιούργησε τυχαία χρησιμοποιείται συνήθως για την αποτροπή επιθέσεις πλαστογράφησης διατοποθεσιακή αίτηση. Η κατάσταση χρησιμοποιείται επίσης για την κωδικοποίηση πληροφοριών σχετικά με την κατάσταση του χρήστη στην εφαρμογή πριν από την αίτηση ελέγχου ταυτότητας προέκυψε, όπως τη σελίδα που είχαν στην. |
| nonce | Απαιτείται | Μια τιμή που περιλαμβάνονται στην πρόσκληση σε (που δημιουργήθηκε από την εφαρμογή) που θα συμπεριληφθούν στο την προκύπτουσα id_token ως δήλωση. Η εφαρμογή, στη συνέχεια, να επιβεβαιώσετε αυτήν την τιμή για τον περιορισμό επιθέσεις διακριτικού αναπαραγωγής. Η τιμή είναι συνήθως μια τυχαία, μοναδικό συμβολοσειρά που μπορούν να χρησιμοποιηθούν για να προσδιορίσετε την προέλευση της αίτησης. |
| p | Απαιτείται | Η πολιτική που θα εκτελεστεί. Είναι το όνομα μιας πολιτικής που έχει δημιουργηθεί στο μισθωτή σας B2C. Η τιμή όνομα πολιτικής θα πρέπει να ξεκινούν με "b2c\_1\_". Μάθετε περισσότερα σχετικά με τις πολιτικές στο [πλαίσιο επεκτάσιμη πολιτικής](active-directory-b2c-reference-policies.md). |
| γραμμή εντολών | Προαιρετικό | Ο τύπος του αλληλεπίδραση με το χρήστη που είναι απαραίτητη. Η μόνη έγκυρη τιμή αυτήν τη στιγμή είναι "σύνδεση", η οποία επιβάλλει στο χρήστη για να εισαγάγετε τα διαπιστευτήριά τους σε αυτό το αίτημα. Καθολικής σύνδεσης δεν θα ισχύσουν. |

Σε αυτό το σημείο, ο χρήστης θα σας ζητηθεί για να ολοκληρώσετε την πολιτική ροής εργασίας. Ίσως χρειαστεί να το χρήστη πληκτρολογώντας το όνομα χρήστη και τον κωδικό πρόσβασης, είσοδο με ένα κοινωνικό ταυτότητα, εγγράφεται για τον κατάλογο ή οποιονδήποτε άλλο αριθμό βήματα, ανάλογα με τον τρόπο ορισμού της πολιτικής.

Αφού ο χρήστης ολοκληρώσει την πολιτική, Azure AD θα επιστρέψει μια απάντηση σε εφαρμογή στο του καθορισμένου `redirect_uri`, χρησιμοποιώντας τη μέθοδο που καθορίζεται από το `response_mode` παραμέτρου. Η απόκριση θα είναι ακριβώς το ίδιο για κάθε μία από τις παραπάνω περιπτώσεις, ανεξάρτητα από την πολιτική που εκτελέστηκε.

Μια επιτυχημένη απόκριση με τη χρήση `response_mode=fragment` έχει τη μορφή:

```
GET https://aadb2cplayground.azurewebsites.net/#
id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...
&state=arbitrary_data_you_can_receive_in_the_response
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| id_token | Το id_token που ζητήθηκε από την εφαρμογή. Μπορείτε να χρησιμοποιήσετε το id_token για να επαληθεύσετε την ταυτότητα του χρήστη και να ξεκινήσετε μια περίοδο λειτουργίας με το χρήστη. Περισσότερες λεπτομέρειες σχετικά με id_tokens και τα περιεχόμενά τους περιλαμβάνονται στην [αναφορά διακριτικού Azure AD B2C](active-directory-b2c-reference-tokens.md). |
| κωδικός | Το authorization_code που ζητήθηκε την εφαρμογή, εάν χρησιμοποιήσατε `response_type=code+id_token`. Η εφαρμογή μπορεί να χρησιμοποιήσει τον κωδικό εξουσιοδότησης για να ζητήσετε μια access_token για έναν πόρο προορισμού. Authorization_codes είναι πολύ μικρό χρόνο ζωής. Συνήθως, λήγουν μετά περίπου 10 λεπτά. |
| κατάσταση | Εάν μια παράμετρος κατάσταση περιλαμβάνει την αίτηση, την ίδια τιμή θα πρέπει να εμφανίζεται στην απάντηση. Η εφαρμογή θα πρέπει να βεβαιωθείτε ότι τις τιμές κατάσταση της αίτησης και της απόκρισης είναι πανομοιότυπες. |

Απαντήσεις σφάλματος μπορούν επίσης να σταλούν στον το `redirect_uri` , έτσι ώστε η εφαρμογή να τους χειριστεί σωστά:

```
GET https://aadb2cplayground.azurewebsites.net/#
error=access_denied
&error_description=the+user+canceled+the+authentication
&state=arbitrary_data_you_can_receive_in_the_response
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| Σφάλμα | Μια συμβολοσειρά κωδικό σφάλματος που μπορεί να χρησιμοποιηθεί για την ταξινόμηση των τύπων σφάλματα που προκύπτουν και μπορεί να χρησιμοποιηθεί προκειμένου να αντιμετωπίζεται σφάλματα. |
| error_description | Ένα συγκεκριμένο μήνυμα σφάλματος που μπορεί να σας βοηθήσει ο προγραμματιστής Προσδιορισμός της αρχικής αιτίας ενός σφάλματος ελέγχου ταυτότητας. |
| κατάσταση | Δείτε την πλήρη περιγραφή στον προηγούμενο πίνακα. Εάν μια παράμετρος κατάσταση περιλαμβάνει την αίτηση, την ίδια τιμή θα πρέπει να εμφανίζεται στην απάντηση. Η εφαρμογή θα πρέπει να βεβαιωθείτε ότι τις τιμές κατάσταση της αίτησης και της απόκρισης είναι πανομοιότυπες. |


## <a name="validate-the-idtoken"></a>Επικυρώστε τη id_token
Μόλις λαμβάνει μια id_token δεν είναι αρκετά για τον έλεγχο ταυτότητας χρήστη--πρέπει να επικυρώσετε τη id_token υπογραφή και επαληθεύστε την αξιώσεων στο διακριτικό σύμφωνα με τις απαιτήσεις της εφαρμογής σας. Azure AD B2C χρησιμοποιεί [Τα διακριτικά Web JSON (JWTs)](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) και κρυπτογράφηση δημόσιου κλειδιού να πραγματοποιήσετε τα διακριτικά και να επιβεβαιώσετε ότι είναι έγκυρα.

Υπάρχουν πολλές βιβλιοθήκες ανοιχτού κώδικα που είναι διαθέσιμες για την επικύρωση JWTs, ανάλογα με τη γλώσσα σας προτίμησης. Συνιστάται να Εξερεύνηση αυτές τις επιλογές αντί για εφαρμογή τη δική σας λογική επικύρωσης. Οι πληροφορίες εδώ θα είναι χρήσιμη σε κατανόηση πώς μπορείτε να χρησιμοποιήσετε σωστά αυτές τις βιβλιοθήκες.

Azure AD B2C έχει σύνδεση OpenID μετα-δεδομένων τελικού σημείου, που επιτρέπει σε μια εφαρμογή για τη λήψη πληροφοριών σχετικά με το Azure AD B2C κατά το χρόνο εκτέλεσης. Αυτές οι πληροφορίες περιλαμβάνουν τα τελικά σημεία διακριτικού περιεχομένων και διακριτικό υπογραφής πλήκτρα. Υπάρχει ένα έγγραφο μετα-δεδομένων JSON για κάθε πολιτική στο μισθωτή σας B2C. Για παράδειγμα, το έγγραφο μετα-δεδομένων για το `b2c_1_sign_in` πολιτικής στην το `fabrikamb2c.onmicrosoft.com` βρίσκεται στο:

`https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1_sign_in`

Μία από τις ιδιότητες αυτού του εγγράφου ρύθμισης παραμέτρων είναι η `jwks_uri`, των οποίων η τιμή για την ίδια πολιτική θα είναι:

`https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/discovery/v2.0/keys?p=b2c_1_sign_in`.

Στο παραγγελίας για να προσδιορίσετε την πολιτική που χρησιμοποιήθηκε στην υπογραφή ενός id_token (και από πού για τη λήψη τα μετα-δεδομένα από), έχετε δύο επιλογές. Πρώτα, περιλαμβάνει το όνομα της πολιτικής του `acr` διεκδίκηση στο το id_token. Για πληροφορίες σχετικά με τον τρόπο για την ανάλυση των απαιτήσεων από μια id_token, ανατρέξτε στο άρθρο [αναφορά διακριτικού Azure AD B2C](active-directory-b2c-reference-tokens.md). Σας άλλη επιλογή είναι να κωδικοποιείτε την πολιτική στην τιμή του `state` παραμέτρου κατά την έκδοση της αίτησης και, στη συνέχεια, αποκωδικοποιείτε για να προσδιορίσετε την πολιτική που χρησιμοποιήθηκε. Είτε η μέθοδος είναι πραγματικά.

Αφού έχετε αποκτήσατε το έγγραφο μετα-δεδομένων από το τελικό σημείο σύνδεσης OpenID μετα-δεδομένων, μπορείτε να χρησιμοποιήσετε τα δημόσια κλειδιά RSA 256 (που βρίσκονται σε αυτό το τελικό σημείο) για την επικύρωση της υπογραφής του id_token. Μπορεί να υπάρχουν πολλά κλειδιά που αναφέρονται σε αυτό το τελικό σημείο σε οποιοδήποτε σημείο δεδομένη στιγμή, κάθε που προσδιορίζεται από μια `kid`. Στην κεφαλίδα της το id_token περιέχει επίσης ένα `kid` διεκδίκηση, που δείχνει ποιο από τα πλήκτρα που χρησιμοποιήθηκε για την υπογραφή του id_token. Ανατρέξτε στο άρθρο [αναφορά διακριτικού Azure AD B2C](active-directory-b2c-reference-tokens.md) για περισσότερες πληροφορίες, συμπεριλαμβανομένων των ενοτήτων για [την επικύρωση διακριτικά](active-directory-b2c-reference-tokens.md#validating-tokens) και [σημαντικές πληροφορίες σχετικά με την είσοδο αναστροφής κλειδιού](active-directory-b2c-reference-tokens.md#validating-tokens).
<!--TODO: Improve the information on this-->

Αφού έχετε επικύρωση την υπογραφή του id_token, υπάρχουν αρκετές αξιώσεων που θα χρειαστείτε για να επαληθεύσετε, για παράδειγμα:

- Πρέπει να επαληθεύσετε το `nonce` διεκδίκηση για να αποτρέψετε επιθέσεις διακριτικού αναπαραγωγής. Η τιμή πρέπει να είναι που καθορίσατε στην αίτηση εισόδου.
- Πρέπει να επαληθεύσετε το `aud` διεκδίκηση για να βεβαιωθείτε ότι το id_token έχει εκδοθεί για την εφαρμογή σας. Η τιμή πρέπει να είναι το Αναγνωριστικό εφαρμογής της εφαρμογής.
- Πρέπει να επαληθεύσετε το `iat` και `exp` αξιώσεις για να βεβαιωθείτε ότι το id_token δεν έχει λήξει.

Υπάρχουν επίσης πολλές περισσότερες επικυρώσεων που θα πρέπει να εκτελέσετε, περιγράφεται λεπτομερώς στη την [Προδιαγραφή πυρήνα σύνδεση OpenID](http://openid.net/specs/openid-connect-core-1_0.html).  Μπορεί επίσης να θέλετε να επικυρώσετε πρόσθετες απαιτήσεις, ανάλογα με το σενάριό σας. Ορισμένες κοινές επικυρώσεων περιλαμβάνουν τα εξής:

- Διασφάλιση ότι το χρήστη/εταιρεία έχει εγγραφεί για την εφαρμογή.
- Διασφάλιση ότι ο χρήστης διαθέτει κατάλληλη εξουσιοδότηση/δικαιώματα.
- Διασφάλιση ότι παρουσιάστηκε ένα συγκεκριμένο ισχύ του ελέγχου ταυτότητας, όπως τον έλεγχο ταυτότητας πολλών παραγόντων Azure.

Για περισσότερες πληροφορίες σχετικά με τις απαιτήσεις σε μια id_token, ανατρέξτε στο άρθρο [αναφορά διακριτικού Azure AD B2C](active-directory-b2c-reference-tokens.md).

Μετά την που έχουν επικύρωση εντελώς το id_token, μπορείτε να ξεκινήσετε μια περίοδο λειτουργίας με το χρήστη και να χρησιμοποιήσετε το αξιώσεων στο το id_token για τη λήψη πληροφοριών σχετικά με το χρήστη στην εφαρμογή. Αυτές οι πληροφορίες μπορεί να χρησιμοποιηθεί για την εμφάνιση, εγγραφών, εξουσιοδότηση και ούτω καθεξής.

## <a name="get-a-token"></a>Λήψη ενός διακριτικού
Εάν όλες τις δυνατότητες που τις ανάγκες σας web app για να το κάνετε εκτέλεση πολιτικές, μπορείτε να μεταβείτε στις επόμενες ενότητες μερικά. Αυτές οι ενότητες ισχύουν μόνο για εφαρμογές που πρέπει να κάνετε κλήσεις σε μια τοποθεσία web API σε έλεγχο ταυτότητας και προστατεύονται από Azure AD B2C στο web.

Μπορούν να αποκτήσουν το authorization_code που αποκτήθηκε (με τη χρήση `response_type=code+id_token`) έναν κωδικό στον επιθυμητό πόρο με την αποστολή ενός `POST` αίτηση για να το `/token` τελικού σημείου. Προς το παρόν, το μοναδικό πόρο που μπορείτε να ζητήσετε ενός διακριτικού για είναι το API του web υποστήριξης της εφαρμογής. Η σύμβαση για την αίτηση ενός διακριτικού στον εαυτό σας είναι να χρησιμοποιήσετε την εφαρμογή υπολογιστή-πελάτη Αναγνωριστικό ως το εύρος:

```
POST fabrikamb2c.onmicrosoft.com/oauth2/v2.0/token?p=b2c_1_sign_in HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6&scope=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&redirect_uri=urn:ietf:wg:oauth:2.0:oob&client_secret=<your-application-secret>

```

| Παράμετρος | Απαιτείται; | Περιγραφή |
| ----------------------- | ------------------------------- | --------------------- |
| p | Απαιτείται | Η πολιτική που χρησιμοποιήθηκε για να αποκτήσετε τον κωδικό εξουσιοδότησης. Δεν μπορείτε να χρησιμοποιήσετε μια διαφορετική πολιτική σε αυτήν την αίτηση. Σημειώστε ότι προσθέτετε αυτή η παράμετρος στη **συμβολοσειρά ερωτήματος**, όχι στο σώμα ΔΗΜΟΣΊΕΥΣΗ. |
| client_id | Απαιτείται | Το Αναγνωριστικό εφαρμογής που έχουν εκχωρηθεί στην [πύλη του Azure](https://portal.azure.com/) για την εφαρμογή σας. |
| grant_type | Απαιτείται | Τον τύπο του εκχώρηση, που πρέπει να είναι `authorization_code` για τη ροή κώδικα εξουσιοδότησης. |
| πεδίο εφαρμογής | Συνιστάται | Μια λίστα διαχωρισμένες με εύρους. Η τιμή μία εύρος δηλώνει να Azure AD και τα δύο από τα δικαιώματα που ζητήθηκαν. Το `openid` εύρος υποδεικνύει ένα δικαίωμα να πραγματοποιήσετε είσοδο στο χρήστη και να λάβετε δεδομένα σχετικά με το χρήστη με τη μορφή **id_tokens**. Μπορεί να χρησιμοποιηθεί για να λάβετε τα διακριτικά στην τοποθεσία web του υπολογιστή στο παρασκήνιο της εφαρμογής API, το οποίο αντιπροσωπεύεται από το ίδιο Αναγνωριστικό εφαρμογής με το πρόγραμμα-πελάτη. Το `offline_access` εύρος υποδεικνύει ότι της εφαρμογής σας θα χρειαστείτε μια **refresh_token** για μεγάλης διάρκειας πρόσβασης σε πόρους. |
| κωδικός | Απαιτείται | Το authorization_code που αποκτήθηκε στο το πρώτο πόδι της ροής της. |
| redirect_uri | Απαιτείται | Το redirect_uri της εφαρμογής όπου έχετε λάβει το authorization_code. |
| client_secret | Απαιτείται | Το μυστικό της εφαρμογής που δημιουργήσατε στην [πύλη του Azure](https://portal.azure.com/). Αυτό μυστικό της εφαρμογής είναι ένα αντικείμενο σημαντικές ασφαλείας. Θα πρέπει να το αποθηκεύσετε με ασφάλεια στο διακομιστή σας. Που θα πρέπει επίσης να χειριστείτε για να περιστρέψετε το μυστικό προγράμματος-πελάτη σε περιοδική βάση. |

Επιτυχής διακριτικού απόκριση θα μοιάζει κάπως:

```
{
    "not_before": "1442340812",
    "token_type": "Bearer",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "scope": "90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access",
    "expires_in": "3600",
    "refresh_token": "AAQfQmvuDy8WtUv-sd0TBwWVQs1rC-Lfxa_NDkLqpg50Cxp5Dxj0VPF1mx2Z...",
}
```
| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| not_before | Η ώρα κατά την οποία το διακριτικό θεωρείται έγκυρη χρονική σήμανση στιγμή. |
| token_type | Την τιμή διακριτικού τύπου. Ο μόνος τύπος που υποστηρίζει το Azure AD είναι φορέα. |
| access_token | Το υπογεγραμμένο διακριτικό JWT που έχετε ζητήσει. |
| πεδίο εφαρμογής | Τα πεδία που το διακριτικό δεν είναι έγκυροι για την, που μπορούν να χρησιμοποιηθούν για προσωρινή αποθήκευση διακριτικά για μελλοντική χρήση. |
| expires_in | Το χρονικό διάστημα που το access_token είναι έγκυρο (σε δευτερόλεπτα). |
| refresh_token | Μια refresh_token OAuth 2.0. Η εφαρμογή να χρησιμοποιήσετε αυτό το διακριτικό να αποκτήσετε πρόσθετες διακριτικά αφού λήξει η τρέχουσα διακριτικού.  Refresh_tokens χρόνο διάρκειας ζωής και μπορούν να χρησιμοποιηθούν για να διατηρήσετε την πρόσβαση σε πόρους για εκτεταμένη χρονική περίοδο. Για περισσότερες λεπτομέρειες, ανατρέξτε στην [αναφορά διακριτικού B2C](active-directory-b2c-reference-tokens.md). Σημειώστε ότι πρέπει να έχετε χρησιμοποιήσει το εύρος `offline_access` στην εξουσιοδότηση και διακριτικού αιτήσεις προκειμένου να λαμβάνουν ένα refresh_token. |

Θα μοιάζει η απαντήσεις σφάλματος:

```
{
    "error": "access_denied",
    "error_description": "The user revoked access to the app.",
}
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| Σφάλμα | Μια συμβολοσειρά κωδικό σφάλματος που μπορεί να χρησιμοποιηθεί για την ταξινόμηση των τύπων σφάλματα που προκύπτουν και μπορεί να χρησιμοποιηθεί προκειμένου να αντιμετωπίζεται σφάλματα. |
| error_description | Ένα συγκεκριμένο μήνυμα σφάλματος που μπορεί να σας βοηθήσει ο προγραμματιστής Προσδιορισμός της αρχικής αιτίας ενός σφάλματος ελέγχου ταυτότητας. |

## <a name="use-the-token"></a>Χρήση του διακριτικού
Τώρα που έχετε με επιτυχία αποκτήσατε μια `access_token`, μπορείτε να χρησιμοποιήσετε το διακριτικό σε προσκλήσεις για να σας παρασκηνίου web APIs, συμπεριλαμβάνοντας με το `Authorization` κεφαλίδας:

```
GET /tasks
Host: https://mytaskwebapi.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
```

## <a name="refresh-the-token"></a>Ανανεώστε το διακριτικό
Το id_tokens είναι μικρό χρόνο ζωής. Πρέπει να ανανεώσετε τους μετά τη λήξη τους για να συνεχίσετε τη δυνατότητα πρόσβασης σε πόρους. Μπορείτε να το κάνετε υποβάλλοντας μια άλλη `POST` αίτηση για να το `/token` τελικού σημείου. Παροχή αυτήν τη στιγμή, το `refresh_token` αντί για το `code`:

```
POST fabrikamb2c.onmicrosoft.com/oauth2/v2.0/token?p=b2c_1_sign_in HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6&scope=openid offline_access&refresh_token=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&redirect_uri=urn:ietf:wg:oauth:2.0:oob&client_secret=<your-application-secret>
```

| Παράμετρος | Απαιτείται | Περιγραφή |
| ----------------------- | ------------------------------- | -------- |
| p | Απαιτείται | Η πολιτική που χρησιμοποιήθηκε για να αποκτήσετε το αρχικό refresh_token. Δεν μπορείτε να χρησιμοποιήσετε μια διαφορετική πολιτική σε αυτήν την αίτηση. Σημειώστε ότι προσθέτετε αυτή η παράμετρος στη **συμβολοσειρά ερωτήματος**, όχι στο σώμα ΔΗΜΟΣΊΕΥΣΗ. |
| client_id | Απαιτείται | Το Αναγνωριστικό εφαρμογής που έχουν εκχωρηθεί στην [πύλη του Azure](https://portal.azure.com/) για την εφαρμογή σας. |
| grant_type | Απαιτείται | Τον τύπο του εκχώρηση, που πρέπει να είναι `refresh_token` για αυτό πόδι της ροής της εξουσιοδότησης κώδικα. |
| πεδίο εφαρμογής | Συνιστάται | Μια λίστα διαχωρισμένες με εύρους. Η τιμή μία εύρος δηλώνει να Azure AD και τα δύο από τα δικαιώματα που ζητήθηκαν. Το `openid` εύρος υποδεικνύει ένα δικαίωμα να πραγματοποιήσετε είσοδο στο χρήστη και να λάβετε δεδομένα σχετικά με το χρήστη με τη μορφή **id_tokens**. Μπορεί να χρησιμοποιηθεί για να λάβετε τα διακριτικά στην τοποθεσία web του υπολογιστή στο παρασκήνιο της εφαρμογής API, το οποίο αντιπροσωπεύεται από το ίδιο Αναγνωριστικό εφαρμογής με το πρόγραμμα-πελάτη. Το `offline_access` εύρος υποδεικνύει ότι της εφαρμογής σας θα χρειαστείτε μια **refresh_token** για μεγάλης διάρκειας πρόσβασης σε πόρους. |
| redirect_uri | Συνιστάται | Το redirect_uri της εφαρμογής όπου έχετε λάβει το authorization_code. |
| refresh_token | Απαιτείται | Το αρχικό refresh_token που αποκτήθηκε στο το δεύτερο πόδι της ροής της. Σημειώστε ότι πρέπει να έχετε χρησιμοποιήσει το εύρος `offline_access` στην εξουσιοδότηση και διακριτικού αιτήσεις προκειμένου να λαμβάνουν ένα refresh_token. |
| client_secret | Απαιτείται | Το μυστικό της εφαρμογής που δημιουργήσατε στην [πύλη του Azure](https://portal.azure.com/). Αυτό μυστικό της εφαρμογής είναι ένα αντικείμενο σημαντικές ασφαλείας. Θα πρέπει να το αποθηκεύσετε με ασφάλεια στο διακομιστή σας. Που θα πρέπει επίσης να χειριστείτε για να περιστρέψετε το μυστικό προγράμματος-πελάτη σε περιοδική βάση. |

Επιτυχής διακριτικού απόκριση θα μοιάζει κάπως:

```
{
    "not_before": "1442340812",
    "token_type": "Bearer",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "scope": "90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access",
    "expires_in": "3600",
    "refresh_token": "AAQfQmvuDy8WtUv-sd0TBwWVQs1rC-Lfxa_NDkLqpg50Cxp5Dxj0VPF1mx2Z...",
}
```
| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| not_before | Η ώρα κατά την οποία το διακριτικό θεωρείται έγκυρη χρονική σήμανση στιγμή. |
| token_type | Την τιμή διακριτικού τύπου. Ο μόνος τύπος που υποστηρίζει το Azure AD είναι φορέα. |
| access_token | Το υπογεγραμμένο διακριτικό JWT που έχετε ζητήσει. |
| πεδίο εφαρμογής | Τα πεδία που το διακριτικό δεν είναι έγκυροι για την, που μπορούν να χρησιμοποιηθούν για προσωρινή αποθήκευση διακριτικά για μελλοντική χρήση. |
| expires_in | Το χρονικό διάστημα που το access_token είναι έγκυρο (σε δευτερόλεπτα). |
| refresh_token | Μια refresh_token OAuth 2.0. Η εφαρμογή να χρησιμοποιήσετε αυτό το διακριτικό να αποκτήσετε πρόσθετες διακριτικά αφού λήξει η τρέχουσα διακριτικού.  Refresh_tokens χρόνο διάρκειας ζωής και μπορούν να χρησιμοποιηθούν για να διατηρήσετε την πρόσβαση σε πόρους για εκτεταμένη χρονική περίοδο. Για περισσότερες λεπτομέρειες, ανατρέξτε στην [αναφορά διακριτικού B2C](active-directory-b2c-reference-tokens.md). |

Θα μοιάζει η απαντήσεις σφάλματος:

```
{
    "error": "access_denied",
    "error_description": "The user revoked access to the app.",
}
```

| Παράμετρος | Περιγραφή |
| ----------------------- | ------------------------------- |
| Σφάλμα | Μια συμβολοσειρά κωδικό σφάλματος που μπορεί να χρησιμοποιηθεί για την ταξινόμηση των τύπων σφάλματα που προκύπτουν και μπορεί να χρησιμοποιηθεί προκειμένου να αντιμετωπίζεται σφάλματα. |
| error_description | Ένα συγκεκριμένο μήνυμα σφάλματος που μπορεί να σας βοηθήσει ο προγραμματιστής Προσδιορισμός της αρχικής αιτίας ενός σφάλματος ελέγχου ταυτότητας. |


## <a name="send-a-sign-out-request"></a>Αποστολή πρόσκλησης sign-out

Όταν θέλετε να συνδεθείτε στο χρήστη από την εφαρμογή, δεν είναι αρκετό για να καταργήσετε την εφαρμογή cookies ή διαφορετικά end την περίοδο λειτουργίας με το χρήστη. Μπορείτε, επίσης, πρέπει να ανακατευθύνετε το χρήστη να Azure AD να αποσυνδεθείτε. Εάν μπορέσετε να το κάνετε, ο χρήστης ίσως να επαναλάβει τον έλεγχο ταυτότητας για την εφαρμογή σας χωρίς να εισαγάγετε ξανά τα διαπιστευτήριά τους. Αυτό συμβαίνει επειδή θα έχουν μια έγκυρη μόνο εισόδου στην περίοδο λειτουργίας με Azure AD.

Μπορείτε απλώς να ανακατευθύνετε το χρήστη να το `end_session_endpoint` που παρατίθεται στο ίδιο σύνδεση OpenID μετα-δεδομένων έγγραφο που περιγράφεται στην ενότητα προηγούμενες "Επικύρωση το id_token":

```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/logout?
p=b2c_1_sign_in
&post_logout_redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
```

| Παράμετρος | Απαιτείται; | Περιγραφή |
| ----------------------- | ------------------------------- | ------------ |
| p | Απαιτείται | Η πολιτική που θέλετε να χρησιμοποιήσετε για να συνδεθείτε στο χρήστη από την εφαρμογή σας. |
| post_logout_redirect_uri | Συνιστάται | Η διεύθυνση URL που θα πρέπει να ανακατευθύνονται ο χρήστης μετά την επιτυχή sign-out. Εάν δεν περιλαμβάνεται, ο χρήστης θα εμφανίζεται ένα γενικό μήνυμα με Azure AD B2C.  |

> [AZURE.NOTE]
    Ενώ που κατευθύνει το χρήστη να το `end_session_endpoint` θα καταργήσετε ορισμένα από το χρήστη μία κατάσταση καθολικής σύνδεσης με το Azure AD B2C, δεν θα Πραγματοποιήστε είσοδο στο χρήστη εκτός περιόδου λειτουργίας υπηρεσίας παροχής (IDP) κοινωνικών ταυτότητας του χρήστη. Εάν ο χρήστης επιλέγει το ίδιο IDP κατά τη διάρκεια μιας οι επόμενες εισόδου, αυτά θα είναι επαναλαμβάνεται ο έλεγχος ταυτότητας, χωρίς να εισαγάγετε τα διαπιστευτήριά τους. Εάν ένας χρήστης θέλει να αποσυνδεθείτε από την εφαρμογή σας B2C, αυτό δεν σημαίνει απαραίτητα που θέλουν να αποσυνδεθείτε από το λογαριασμό Facebook εξ ολοκλήρου. Ωστόσο, στην περίπτωση τοπικού λογαριασμούς, την περίοδο λειτουργίας του χρήστη θα τερματιστεί σωστά.

## <a name="use-your-own-b2c-tenant"></a>Χρησιμοποιήστε το δικό σας B2C μισθωτή

Εάν θέλετε να δοκιμάσετε αυτές τις αιτήσεις για τον εαυτό σας, πρέπει πρώτα να εκτελέσετε αυτά τα τρία βήματα και, στη συνέχεια, αντικαταστήστε τις τιμές παράδειγμα παραπάνω με το δικό σας:

- [Δημιουργήστε έναν μισθωτή B2C](active-directory-b2c-get-started.md)και χρησιμοποιήστε το όνομα του μισθωτή σας στις αιτήσεις.
- [Δημιουργία μιας εφαρμογής](active-directory-b2c-app-registration.md) για να αποκτήσετε ένα Αναγνωριστικό εφαρμογής και μια redirect_uri. Που θα θέλετε να συμπεριλάβετε μια **στο web app/web api** στην εφαρμογή σας και, προαιρετικά, δημιουργήστε μια **εφαρμογή μυστικό**.
- [Δημιουργία πολιτικών σας](active-directory-b2c-reference-policies.md) για να αποκτήσετε το ονόματα πολιτικής.
