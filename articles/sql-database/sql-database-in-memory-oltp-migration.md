<properties
    pageTitle="Συναλλαγής στη μνήμη βελτιώνει SQL txn επιδόσεων | Microsoft Azure"
    description="Συναλλαγής στη μνήμη υιοθετούν για βελτίωση της απόδοσης συναλλαγών σε μια υπάρχουσα βάση δεδομένων SQL."
    services="sql-database"
    documentationCenter=""
    authors="jodebrui"
    manager="jhubbard"
    editor="MightyPen"/>


<tags
    ms.service="sql-database"
    ms.workload="data-management"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/03/2016"
    ms.author="jodebrui"/>


# <a name="use-in-memory-oltp-preview-to-improve-your-application-performance-in-sql-database"></a>Χρήση της μνήμης Συναλλαγής (έκδοση preview) για να βελτιώσετε την απόδοση της εφαρμογής σε βάση δεδομένων SQL

[Στη μνήμη Συναλλαγής](sql-database-in-memory.md) μπορεί να χρησιμοποιηθεί για να βελτιώσετε την απόδοση του φόρτου εργασίας Συναλλαγής σε βάσεις δεδομένων SQL Azure [Premium](sql-database-service-tiers.md) χωρίς να αυξήσετε το επίπεδο απόδοσης.

Ακολουθήστε τα παρακάτω βήματα για να υιοθετήσουν Συναλλαγής στη μνήμη στο την υπάρχουσα βάση δεδομένων.

## <a name="step-1-ensure-your-premium-database-supports-in-memory-oltp"></a>Βήμα 1: Βεβαιωθείτε ότι η βάση δεδομένων Premium υποστηρίζει Συναλλαγής στη μνήμη

Premium βάσεις δεδομένων που δημιουργήθηκαν στο Νοέμβριο 2015 ή νεότερη έκδοση υποστηρίζει τη δυνατότητα στη μνήμη. Μπορείτε να βεβαιότητα αν η βάση δεδομένων σας Premium υποστηρίζει τη δυνατότητα στη μνήμη, εκτελώντας την ακόλουθη πρόταση Transact-SQL. Στη μνήμη υποστηρίζεται εάν το αποτέλεσμα που επιστρέφεται είναι 1 (δεν είναι 0):

```
SELECT DatabasePropertyEx(Db_Name(), 'IsXTPSupported');
```

*XTP* σημαίνει *Ακραίες επεξεργασία συναλλαγής*

Εάν πρέπει να μετακινηθούν την υπάρχουσα βάση δεδομένων σε μια νέα βάση δεδομένων V12 Premium, μπορείτε να χρησιμοποιήσετε τις εξής τεχνικές για να εξαγάγετε και, στη συνέχεια, εισαγάγετε τα δεδομένα σας.

#### <a name="export-steps"></a>Βημάτων εξαγωγής

Εξαγωγή βάσης δεδομένων παραγωγής σε μια bacpac, χρησιμοποιώντας είτε:

- Τη λειτουργικότητα [Εξαγωγή](sql-database-export.md) στην [πύλη](https://portal.azure.com/).

- Λειτουργιών της **εφαρμογής επιπέδων εξαγωγή δεδομένων** σε μια [ενημερωμένη SSMS.exe](http://msdn.microsoft.com/library/mt238290.aspx) (SQL Server Management Studio).
 1. Στην **Εξερεύνηση των αντικειμένων**, αναπτύξτε τον κόμβο **βάσεις δεδομένων** .
 2. Κάντε δεξί κλικ τον κόμβο βάση δεδομένων σας.
 3. Κάντε κλικ στην επιλογή **εργασίες** > **Εξαγωγή δεδομένων επιπέδων εφαρμογής**.
 4. Λειτουργεί στο παράθυρο του οδηγού που εμφανίζεται.


#### <a name="import-steps"></a>Εισαγωγή βήματα

Εισαγάγετε το bacpac σε μια νέα βάση δεδομένων Premium.

1. Στην Azure [πύλη](https://portal.azure.com/),
 - Μεταβείτε στο διακομιστή.
 - Ενεργοποιήστε την επιλογή [Εισαγωγή βάσης δεδομένων](sql-database-import.md) .
 - Επιλέξτε μια Premium τις τιμές σε επίπεδο.

2. Χρησιμοποιήστε SSMS για να εισαγάγετε το bacpac:
 - Στην **Εξερεύνηση των αντικειμένων**, κάντε δεξί κλικ στον κόμβο **βάσεις δεδομένων** .
 - Κάντε κλικ στην επιλογή **Εισαγωγή δεδομένων επιπέδων εφαρμογής**.
 - Λειτουργεί στο παράθυρο του οδηγού που εμφανίζεται.


## <a name="step-2-identify-objects-to-migrate-to-in-memory-oltp"></a>Βήμα 2: Προσδιορισμός αντικειμένων για τη μετεγκατάσταση στο Συναλλαγής στη μνήμη

SSMS περιλαμβάνει μια αναφορά " **Επισκόπηση" Ανάλυση απόδοσης κίνησης** που μπορείτε να εκτελέσετε σε σχέση με μια βάση δεδομένων με μια ενεργή φόρτο εργασίας. Η αναφορά προσδιορίζει πίνακες και αποθηκευμένες διαδικασίες που είναι υποψήφια για μετεγκατάσταση σε Συναλλαγής στη μνήμη.

Στο SSMS, για να δημιουργήσετε την αναφορά:
- Στην **Εξερεύνηση των αντικειμένων**, κάντε δεξιό κλικ τον κόμβο βάσης δεδομένων σας.
- Κάντε κλικ στην επιλογή **αναφορές** > **τυπικές αναφορές** > **Επισκόπηση ανάλυσης επιδόσεων συναλλαγή**.

Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Καθορισμός εάν πίνακα ή αποθηκευμένη διαδικασία πρέπει να μεταφερθούν σε Συναλλαγής στη μνήμη](http://msdn.microsoft.com/library/dn205133.aspx).


## <a name="step-3-create-a-comparable-test-database"></a>Βήμα 3: Δημιουργία βάσης δεδομένων συγκρίσιμη δοκιμής

Ας υποθέσουμε ότι η αναφορά θα δηλώνει τη βάση δεδομένων έχει έναν πίνακα που να επωφεληθείτε από τη μετατροπή ενός πίνακα Βελτιστοποίηση μνήμης. Συνιστάται να δοκιμάσετε πρώτα για να επιβεβαιώσετε την ένδειξη, δοκιμάζοντας.

Χρειάζεστε ένα αντίγραφο δοκιμή της βάσης δεδομένων παραγωγής. Η βάση δεδομένων δοκιμής πρέπει να είναι στο ίδιο επίπεδο επίπεδο υπηρεσίας ως βάση δεδομένων παραγωγής.

Για να διευκολύνετε τη δοκιμή, τροποποιήστε το δοκιμή βάσης δεδομένων ως εξής:

1. Σύνδεση στη δοκιμαστική βάση δεδομένων με χρήση SSMS.

2. Για να αποφύγετε να χρειάζεται την επιλογή με (ΣΤΙΓΜΙΌΤΥΠΟ) σε ερωτήματα, ορίστε την επιλογή βάσης δεδομένων, όπως φαίνεται στην παρακάτω T-SQL:
```
ALTER DATABASE CURRENT
    SET
        MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT = ON;
```


## <a name="step-4-migrate-tables"></a>Βήμα 4: Μετεγκατάσταση πίνακες

Πρέπει να δημιουργήσετε και να συμπληρώσετε ένα αντίγραφο Βελτιστοποίηση μνήμης του πίνακα που θέλετε να ελέγξετε. Μπορείτε να τη δημιουργήσετε χρησιμοποιώντας είτε:

- Στον Οδηγό βελτιστοποίηση εύχρηστο μνήμης στο SSMS.
- Μη αυτόματη T-SQL.


#### <a name="memory-optimization-wizard-in-ssms"></a>Οδηγός Βελτιστοποίηση μνήμης στο SSMS

Για να χρησιμοποιήσετε αυτήν την επιλογή μετεγκατάστασης:

1. Σύνδεση με τη βάση δεδομένων δοκιμής με SSMS.

2. Στην **Εξερεύνηση των αντικειμένων**, κάντε δεξί κλικ στον πίνακα και, στη συνέχεια, κάντε κλικ στην επιλογή **Σύμβουλος Βελτιστοποίηση μνήμης**.
 - Εμφανίζεται ο "Οδηγός **Σύμβουλος Βελτιστοποίηση μνήμης πίνακα** ".

3. Στον οδηγό, κάντε κλικ στην επιλογή **επικύρωση μετεγκατάστασης** (ή το κουμπί " **Επόμενο** ") για να δείτε εάν ο πίνακας έχει τις μη υποστηριζόμενες δυνατότητες που δεν υποστηρίζονται στα Βελτιστοποίηση μνήμης πίνακες. Για περισσότερες πληροφορίες, ανατρέξτε στα θέματα:
 - *Λίστα ελέγχου Βελτιστοποίηση μνήμης* σε [Σύμβουλος Βελτιστοποίηση μνήμης](http://msdn.microsoft.com/library/dn284308.aspx).
 - [Δομές transact-SQL δεν υποστηρίζεται από το Συναλλαγής στη μνήμη](http://msdn.microsoft.com/library/dn246937.aspx).
 - [Μετεγκατάσταση σε Συναλλαγής στη μνήμη](http://msdn.microsoft.com/library/dn247639.aspx).

4. Εάν ο πίνακας έχει χωρίς δυνατότητες που δεν υποστηρίζονται, ο σύμβουλος μπορεί να εκτελέσει την πραγματική σχήματος και μετεγκατάσταση δεδομένων για εσάς.


#### <a name="manual-t-sql"></a>Μη αυτόματη T-SQL

Για να χρησιμοποιήσετε αυτήν την επιλογή μετεγκατάστασης:

1. Συνδεθείτε στη βάση δεδομένων της δοκιμής, χρησιμοποιώντας SSMS (ή μια παρόμοια βοηθητικού προγράμματος).

2. Αποκτήστε την πλήρη δέσμη ενεργειών T-SQL για τον πίνακα και τα ευρετήρια.
 - Στο SSMS, κάντε δεξί κλικ τον κόμβο του πίνακα σας.
 - Κάντε κλικ στην επιλογή **δέσμης ενεργειών πίνακα ως** > **ΔΗΜΙΟΥΡΓΊΑ για να** > **νέο παράθυρο του ερωτήματος**.

3. Στο παράθυρο δέσμης ενεργειών, προσθέστε με (MEMORY_OPTIMIZED = ON) για να την πρόταση CREATE TABLE.

4. Εάν υπάρχει ένα ευρετήριο CLUSTERED, αλλάξετε σε NONCLUSTERED.

5. Μετονομασία του υπάρχοντος πίνακα με τη χρήση SP_RENAME.

6. Δημιουργήστε το νέο αντίγραφο Βελτιστοποίηση μνήμης του πίνακα, εκτελώντας το επεξεργασμένο δέσμης ενεργειών ΔΗΜΙΟΥΡΓΊΑ ΠΊΝΑΚΑ.

7. Αντιγράψτε τα δεδομένα στον πίνακα Βελτιστοποίηση μνήμης με χρήση εισαγωγή... ΕΠΙΛΈΞΤΕ * ΣΕ:
    
```
INSERT INTO <new_memory_optimized_table>
        SELECT * FROM <old_disk_based_table>;
```


## <a name="step-5-optional-migrate-stored-procedures"></a>Βήμα 5 (προαιρετικό): μετεγκατάσταση αποθηκευμένες διαδικασίες

Η δυνατότητα στη μνήμη επίσης να τροποποιήσετε μια αποθηκευμένη διαδικασία για βελτιωμένη απόδοση.


### <a name="considerations-with-natively-compiled-stored-procedures"></a>Ζητήματα με εγγενώς μεταγλωττισμένο αποθηκευμένες διαδικασίες

Μια εγγενώς μεταγλωττισμένο αποθηκευμένη διαδικασία πρέπει να έχετε τις ακόλουθες επιλογές στη το T-SQL με τον όρο FROM:

- NATIVE_COMPILATION

- SCHEMABINDING: δηλαδή πίνακες που την αποθηκευμένη διαδικασία δεν μπορούν να έχουν οι ορισμοί στήλης αλλαχθεί με οποιονδήποτε τρόπο που θα μπορούσαν να επηρεάσουν την αποθηκευμένη διαδικασία, εκτός εάν αποθέστε την αποθηκευμένη διαδικασία.


Εγγενής λειτουργικής μονάδας πρέπει να χρησιμοποιήσετε ένα μεγάλο [ΑΤΟΜΙΚΉΣ μπλοκ](http://msdn.microsoft.com/library/dn452281.aspx) για διαχείριση συναλλαγών. Δεν υπάρχει κανένα ρόλο για μια ρητή ΣΥΝΑΛΛΑΓΉ ΞΕΚΙΝΉΣΕΙ ή για ΕΠΑΝΑΦΟΡΆ ΣΥΝΑΛΛΑΓΉΣ. Εάν σας κώδικα εντοπίσει παραβίασης ενός κανόνα επιχειρήσεις, αυτό μπορεί να Τερματισμός ατομικής μπλοκ με μια πρόταση [ΕΜΦΑΝΊΣΟΥΝ](http://msdn.microsoft.com/library/ee677615.aspx) .


### <a name="typical-create-procedure-for-natively-compiled"></a>Τυπικές CREATE PROCEDURE για μεταγλωττιστεί εγγενώς

Συνήθως το SQL T για να δημιουργήσετε μια αποθηκευμένη διαδικασία εγγενώς μεταγλωττισμένο είναι παρόμοιο με το ακόλουθο πρότυπο:

```
CREATE PROCEDURE schemaname.procedurename
    @param1 type1, …
    WITH NATIVE_COMPILATION, SCHEMABINDING
    AS
        BEGIN ATOMIC WITH
            (TRANSACTION ISOLATION LEVEL = SNAPSHOT,
            LANGUAGE = N'your_language__see_sys.languages'
            )
        …
        END;
```

- Για το TRANSACTION_ISOLATION_LEVEL, ΣΤΙΓΜΙΌΤΥΠΟ είναι η πιο κοινή τιμή για την εγγενώς μεταγλωττισμένο αποθηκευμένη διαδικασία. Ωστόσο, υποστηρίζονται επίσης ένα υποσύνολο από τις άλλες τιμές:
 - ΕΠΑΝΑΛΑΜΒΑΝΌΜΕΝΗ ΑΝΆΓΝΩΣΗ
 - ΔΥΝΑΤΌΤΗΤΑ ΣΕΙΡΙΟΠΟΊΗΣΗΣ


- Η τιμή ΓΛΏΣΣΑΣ πρέπει να υπάρχει στην προβολή sys.languages.


### <a name="how-to-migrate-a-stored-procedure"></a>Πώς μπορείτε να μετεγκαταστήσετε μια αποθηκευμένη διαδικασία

Τα βήματα μετεγκατάστασης είναι:


1. Αποκτήστε τη δέσμη ενεργειών CREATE PROCEDURE στην κανονική ερμηνευθεί αποθηκευμένη διαδικασία.

2. Γράψτε ξανά την κεφαλίδα ώστε να ταιριάζει με το προηγούμενο πρότυπο.

3. Διαπίστωση αν η αποθηκευμένη διαδικασία κώδικα T SQL χρησιμοποιεί τις δυνατότητες που δεν υποστηρίζονται για εγγενώς μεταγλωττισμένο αποθηκευμένες διαδικασίες. Υλοποίηση λύσεις, εάν είναι απαραίτητο.
 - Για λεπτομέρειες, ανατρέξτε [Θέματα μετεγκατάστασης για εγγενώς μεταγλωττιστεί αποθηκευμένες διαδικασίες](http://msdn.microsoft.com/library/dn296678.aspx).

4. Μετονομάστε την παλιά αποθηκευμένη διαδικασία χρησιμοποιώντας SP_RENAME. Ή απλώς ΑΠΟΘΈΣΤΕ το.

5. Εκτελέστε σας επεξεργασμένο δέσμη ενεργειών ΔΗΜΙΟΥΡΓΊΑ ΔΙΑΔΙΚΑΣΊΑ Τ-SQL.


## <a name="step-6-run-your-workload-in-test"></a>Βήμα 6: Εκτέλεση του φόρτου εργασίας σας στο δοκιμής

Εκτελέστε ένα φόρτο εργασίας στη βάση δεδομένων της δοκιμής που είναι παρόμοιο με το φόρτο εργασίας που εκτελείται στη βάση δεδομένων της παραγωγής. Αυτό θα πρέπει να αποκαλύψετε το κέρδος απόδοσης δυνατό με τη χρήση της δυνατότητας στη μνήμη για πίνακες και αποθηκευμένες διαδικασίες.

Κύρια χαρακτηριστικά το φόρτο εργασίας είναι οι εξής:

- Αριθμός ταυτόχρονες συνδέσεις.

- Ο λόγος ανάγνωσης/εγγραφής.


Για να προσαρμόσετε και εκτελέστε το φόρτο εργασίας δοκιμής, μπορείτε να χρησιμοποιήσετε το εργαλείο εύχρηστο ostress.exe, που φαίνεται στην [παρακάτω](sql-database-in-memory.md).


Για να ελαχιστοποιήσετε την αδράνεια δικτύου, εκτελέστε το δοκιμής στην ίδια Azure γεωγραφική περιοχή όπου υπάρχει η βάση δεδομένων.


## <a name="step-7-post-implementation-monitoring"></a>Βήμα 7: Παρακολούθηση μετά την εφαρμογή

Εξετάστε το ενδεχόμενο να παρακολούθηση τα εφέ απόδοσης σας υλοποιήσεις στη μνήμη παραγωγή:

- [Οθόνη αποθήκευσης στη μνήμη](sql-database-in-memory-oltp-monitoring.md).

- [Παρακολούθηση βάση δεδομένων SQL Azure χρησιμοποιώντας δυναμική Διαχείριση προβολών](sql-database-monitoring-with-dmvs.md)


## <a name="related-links"></a>Σχετικές συνδέσεις

- [Στη μνήμη Συναλλαγής (βελτιστοποίηση στη μνήμη)](http://msdn.microsoft.com/library/dn133186.aspx)

- [Εισαγωγή στις εγγενώς μεταγλωττισμένο αποθηκευμένες διαδικασίες](http://msdn.microsoft.com/library/dn133184.aspx)

- [Συμβουλές για βελτιστοποίηση μνήμης](http://msdn.microsoft.com/library/dn284308.aspx)

