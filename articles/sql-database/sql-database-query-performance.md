<properties 
   pageTitle="Πληροφορίες για επιδόσεων ερώτημα βάσης δεδομένων Azure SQL" 
   description="Παρακολούθηση των επιδόσεων ερωτήματος προσδιορίζει τα περισσότερα ερωτήματα κατανάλωση CPU για μια βάση δεδομένων SQL Azure." 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jhubbard" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management" 
   ms.date="08/09/2016"
   ms.author="sstein"/>

# <a name="azure-sql-database-query-performance-insight"></a>Πληροφορίες για επιδόσεων ερώτημα βάσης δεδομένων Azure SQL


Διαχείριση και την απόδοση του σχεσιακές βάσεις δεδομένων της ρύθμισης είναι ενδιαφέρουσα εργασία που απαιτεί σημαντική τεχνογνωσία και την ώρα επένδυσης. Πληροφορίες για επιδόσεις ερωτήματος σάς επιτρέπει να δαπανούν λιγότερο χρόνο για αντιμετώπιση προβλημάτων απόδοσης μιας βάσης δεδομένων, παρέχοντας τα εξής:

- Περαιτέρω πληροφορίες για τις βάσεις δεδομένων κατανάλωση πόρων (DTU). 
- Τα πιο δημοφιλή ερωτήματα με μέτρηση CPU/διάρκεια εκτέλεσης, που ενδεχομένως να είναι ρυθμισμένη για βελτιωμένη απόδοση.
- Η δυνατότητα να διερευνήσουν τις λεπτομέρειες ενός ερωτήματος, δείτε το κείμενο και ιστορικό της χρήσης πόρων. 
- Ρύθμιση σχόλια που εμφανίζουν ενέργειες που εκτελούνται από [Σύμβουλος βάσης δεδομένων SQL Azure](sql-database-advisor.md) επιδόσεων  



## <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

- Πληροφορίες για επιδόσεις ερωτήματος είναι διαθέσιμη μόνο με V12 βάσης δεδομένων SQL Azure.
- Πληροφορίες για επιδόσεις ερωτημάτων απαιτεί [Ερωτήματος χώρου αποθήκευσης](https://msdn.microsoft.com/library/dn817826.aspx) είναι ενεργό στη βάση δεδομένων σας. Εάν δεν εκτελείται το ερώτημα αποθήκευσης, την πύλη σας ζητά να την ενεργοποιήσετε.

 
## <a name="permissions"></a>Δικαιώματα

Τα ακόλουθα δικαιώματα [Έλεγχος πρόσβασης βάσει ρόλων](../active-directory/role-based-access-control-configure.md) είναι απαραίτητο να χρησιμοποιήσετε πληροφορίες για επιδόσεις ερωτημάτων: 

- Απαιτούνται δικαιώματα **ανάγνωσης**, **κατόχου**, **συμβολής**, **Συμβολής DB SQL**ή **SQL Server συμβολής** για να προβάλετε τα ερωτήματα καταναλώνει επάνω πόρων και τα γραφήματα. 
- Δικαιώματα **κατόχου**, **συμβολής**, **Συμβολής DB SQL**ή **SQL Server συμβολής** απαιτούνται για να προβάλετε κείμενο ερωτήματος.



## <a name="using-query-performance-insight"></a>Χρήση ερωτήματος επιδόσεων γνώσεις

Πληροφορίες για επιδόσεις ερωτήματος είναι εύκολο για χρήση:

- Στην πύλη [Azure](https://portal.azure.com/) και βρείτε βάσης δεδομένων που θέλετε να εξετάσετε. 
  - Από το μενού αριστερή πλευρά, στην περιοχή υποστήριξης και αντιμετώπισης προβλημάτων, επιλέξτε "Πληροφορίες για επιδόσεις ερωτήματος".
- Στην πρώτη καρτέλα, εξετάστε τη λίστα των δημοφιλέστερα ερωτήματα κατανάλωση πόρων.
- Επιλέξτε ένα μεμονωμένο ερώτημα για να προβάλετε τις λεπτομέρειες.
- Ανοίξτε [Σύμβουλος βάσης δεδομένων SQL Azure](sql-database-advisor.md) και ελέγξτε εάν οποιοδήποτε συστάσεις είναι διαθέσιμες.
- Χρησιμοποιήστε τα ρυθμιστικά ή ζουμ εικονίδια για να αλλάξετε παρατηρούμενη διάστημα.

    ![Πίνακας εργαλείων επιδόσεων](./media/sql-database-query-performance/performance.png)

> [AZURE.NOTE] Μερικές ώρες των δεδομένων πρέπει να καταγραφή από Store ερωτήματος για βάση δεδομένων SQL για την παροχή ιδέες επιδόσεις του ερωτήματος. Εάν η βάση δεδομένων έχει καμία δραστηριότητα ή ερώτημα αποθήκευσης δεν ήταν ενεργό κατά μια συγκεκριμένη χρονική περίοδο, τα γραφήματα θα είναι κενή, κατά την εμφάνιση συγκεκριμένη χρονική περίοδο. Μπορείτε να ενεργοποιήσετε το χώρο αποθήκευσης ερωτήματος ανά πάσα στιγμή, εάν δεν εκτελείται.   



## <a name="review-top-cpu-consuming-queries"></a>Αναθεώρηση επάνω CPU κατανάλωση ερωτημάτων

Στην [πύλη](http://portal.azure.com) , κάντε τα εξής:

1. Μεταβείτε σε μια βάση δεδομένων SQL και κάντε κλικ στην επιλογή **όλες οι ρυθμίσεις** > **υποστήριξη + αντιμετώπιση προβλημάτων** > **πληροφορίες για επιδόσεις του ερωτήματος**. 

    ![Πληροφορίες για απόδοσης ερωτήματος][1]

    Ανοίγει την προβολή δημοφιλέστερα ερωτήματα και παρατίθενται τα πιο δημοφιλή ερωτήματα καταναλώνει CPU.

1. Κάντε κλικ στην επιλογή γύρω από το γράφημα για λεπτομέρειες.<br>Επάνω γραμμή εμφανίζει το συνολικό ποσοστό DTU για τη βάση δεδομένων, ενώ οι γραμμές εμφανίζουν CPU % που καταναλώνεται από τα επιλεγμένα ερωτήματα κατά τη διάρκεια του επιλεγμένου χρονικού διαστήματος (για παράδειγμα, εάν είναι επιλεγμένη η **τελευταία εβδομάδα** κάθε γραμμή αντιπροσωπεύει μία ημέρα).

    ![Δημοφιλέστερα ερωτήματα][2]

    Πλέγμα κάτω αντιπροσωπεύει συγκεντρωτική πληροφορίες για τα ορατά ερωτήματα.

  - Αναγνωριστικό ερωτήματος – μοναδικό αναγνωριστικό του ερωτήματος μέσα σε βάση δεδομένων.
  - CPU ανά ερωτήματος κατά τη διάρκεια παρατηρήσιμα διαστήματος (εξαρτάται από τη συνάρτηση συνάθροισης).
  - Διάρκεια ανά ερωτήματος (εξαρτάται από τη συνάρτηση συνάθροισης).
  - Συνολικός αριθμός των εκτελέσεις για ένα συγκεκριμένο ερώτημα.

    Επιλέξτε ή καταργήστε μεμονωμένα ερωτημάτων για να συμπεριλάβετε ή να εξαιρέσετε τα από το γράφημα με πλαίσια ελέγχου.

1. Εάν τα δεδομένα σας δεν είναι ενημερωμένο, κάντε κλικ στο κουμπί **Ανανέωση** .
1. Μπορείτε να χρησιμοποιήσετε ρυθμιστικά και να μεγεθύνετε κουμπιών για αλλαγή διαστήματος παρατηρήσεων και Διερεύνηση αιχμές:  ![ρυθμίσεις](./media/sql-database-query-performance/zoom.png)
1. Προαιρετικά, εάν θέλετε μια διαφορετική προβολή, μπορείτε να επιλέξετε την καρτέλα **Προσαρμογή** και να ορίσετε:
  
  - Μέτρηση (CPU, διάρκεια, πλήθος εκτέλεσης)
  - Χρονικό διάστημα (τελευταίες 24 ώρες, προηγούμενη εβδομάδα, προηγούμενος μήνας). 
  - Αριθμός ερωτημάτων.
  - Συνάρτηση συνάθροισης.

    ![ρυθμίσεις](./media/sql-database-query-performance/custom-tab.png)

## <a name="viewing-individual-query-details"></a>Προβολή λεπτομερειών μεμονωμένα ερωτήματος

Για να προβάλετε λεπτομέρειες ερωτήματος:

1. Κάντε κλικ σε οποιοδήποτε ερώτημα στη λίστα των δημοφιλέστερα ερωτήματα.

    ![λεπτομέρειες](./media/sql-database-query-performance/details.png)

1. Ανοίγει την προβολή λεπτομερειών και το πλήθος ερωτημάτων CPU κατανάλωση/διάρκεια εκτέλεσης αναλύεται μέσα στο χρόνο.
1. Κάντε κλικ στην επιλογή γύρω από το γράφημα για λεπτομέρειες.
  - Γράφημα πρώτων εμφανίζει γραμμής με το συνολικό ποσοστό DTU βάσης δεδομένων και οι γραμμές είναι CPU % που καταναλώνεται από το επιλεγμένο ερώτημα.
  - Δεύτερο γράφημα εμφανίζει συνολική διάρκεια από το επιλεγμένο ερώτημα.
  - Γράφημα κάτω εμφανίζει το συνολικό αριθμό των εκτελέσεις από το επιλεγμένο ερώτημα.
    
    ![Λεπτομέρειες ερωτήματος][3]

1. Προαιρετικά, χρησιμοποιήστε τα ρυθμιστικά, κουμπιά ζουμ ή κάντε κλικ στην επιλογή **Ρυθμίσεις** για να προσαρμόσετε τον τρόπο εμφάνισης ερωτήματος δεδομένων ή για να επιλέξετε μια διαφορετική χρονική περίοδο.

## <a name="review-top-queries-per-duration"></a>Αναθεώρηση δημοφιλέστερα ερωτήματα ανά διάρκεια

Στην πρόσφατη ενημερωμένη έκδοση του ερωτήματος επιδόσεων γνώσεις, θα σας εισάγονται δύο νέων μετρικών που μπορεί να σας βοηθήσει να αναγνωρίζετε πιθανά συνωστισμών: διάρκεια και εκτέλεσης πλήθος.<br>

Μεγάλη διάρκεια εκτέλεσης ερωτημάτων έχουν τις μεγαλύτερες δυνατότητες για το κλείδωμα πόρους περισσότερο, ο αποκλεισμός άλλων χρηστών και τον περιορισμό κλιμάκωση. Είναι επίσης η βέλτιστη υποψήφιοι για βελτιστοποίηση.<br>

Για να προσδιορίσετε μεγάλης διάρκειας ερωτημάτων:

1. Άνοιγμα καρτέλα **Προσαρμογή** στο ερώτημα επιδόσεων γνώσεις για επιλεγμένη βάση δεδομένων
1. Αλλαγή των μετρήσεων για να **διάρκεια**
1. Επιλέξτε αριθμό ερωτημάτων και παρακολούθηση χρονικού διαστήματος
1. Επιλέξτε συνάρτηση συνάθροισης
  - **Sum** προσθέτει όλα χρόνος εκτέλεσης του ερωτήματος κατά τη διάρκεια ολόκληρη παρατηρήσεων διαστήματος.
  - **Max** βρίσκει ερωτήματα ποια χρόνος εκτέλεσης ήταν μέγιστο ολόκληρη παρατηρήσεων χρονικό διάστημα.
  - **Avg** εντοπίζει μέσος χρόνος εκτέλεσης της όλα εκτελέσεις ερωτήματος και εμφάνιση που επάνω από τα παρακάτω μέσους όρους. 

    ![διάρκεια ερωτήματος][4]

## <a name="review-top-queries-per-execution-count"></a>Αναθεώρηση δημοφιλέστερα ερωτήματα ανά count εκτέλεσης

Μεγάλο αριθμό εκτελέσεις δεν μπορεί να επηρεάζουν την ίδια βάση δεδομένων και χρήση πόρων μπορεί να είναι χαμηλή, αλλά μπορεί να λάβετε γενική εφαρμογή αργή.

Σε ορισμένες περιπτώσεις, ενδέχεται να προκαλέσουν count πολύ υψηλή εκτέλεσης για την αύξηση της δικτύου μεταβάσεις. Μεταβάσεις σημαντικά επηρεάζουν τις επιδόσεις. Είναι υπόκεινται σε αδράνεια δικτύου και να λανθάνων χρόνος ροής διακομιστή. 

Για παράδειγμα, πολλές τοποθεσίες Web που βασίζονται σε δεδομένα σε μεγάλο βαθμό πρόσβαση στη βάση δεδομένων για κάθε αίτηση χρήστη. Ενώ σύνδεσης συμβάλλει, την κίνηση δικτύου αυξημένη συγκέντρωση και την επεξεργασία φόρτωσης του διακομιστή βάσης δεδομένων μπορεί να επηρεάσει αρνητικά επιδόσεων.  Γενικές συμβουλές είναι να διατηρείτε διαδρομών από μια απόλυτη ελάχιστο.

Για να προσδιορίσετε συχνά η εκτέλεση ερωτημάτων ερωτήματα ("chatty"):

1. Άνοιγμα καρτέλα **Προσαρμογή** στο ερώτημα επιδόσεων γνώσεις για επιλεγμένη βάση δεδομένων
1. Αλλαγή μετρικά να **count εκτέλεσης**
1. Επιλέξτε αριθμό ερωτημάτων και παρακολούθηση χρονικού διαστήματος

    ![Πλήθος εκτέλεσης ερωτημάτων][5]

## <a name="understanding-performance-tuning-annotations"></a>Κατανόηση της ρύθμισης επιδόσεων σχόλια 

Κατά την Εξερεύνηση του φόρτου εργασίας σας στο ερώτημα επιδόσεων γνώσεις, ίσως παρατηρήσετε εικονίδια με κατακόρυφη γραμμή επάνω από το γράφημα.<br>

Αυτά τα εικονίδια είναι σχόλια; αντιπροσωπεύουν επιδόσεων που επηρεάζουν ενέργειες που εκτελούνται από [Σύμβουλος βάσης δεδομένων SQL Azure](sql-database-advisor.md). Με κατάδειξης σχολίων, μπορείτε να λάβετε βασικές πληροφορίες σχετικά με την ενέργεια:

![σχόλιο ερωτήματος][6]

Εάν θέλετε να μάθω περισσότερα ή εφαρμόστε Σύμβουλος προτάσεων, κάντε κλικ στο εικονίδιο. Θα ανοίξει λεπτομέρειες ενέργειας. Εάν πρόκειται για μια ενεργή σύσταση μπορείτε να το εφαρμόσετε απευθείας δεν βρίσκομαι στον υπολογιστή χρησιμοποιώντας την εντολή.

![Λεπτομέρειες σχολιασμού ερωτήματος][7]

### <a name="multiple-annotations"></a>Πολλά σχόλια. ###

Είναι πιθανό ότι λόγω επίπεδο ζουμ, σχόλια που είναι κοντά μεταξύ τους, θα λάβετε συμπτυγμένες σε μία. Αυτό θα αναπαρίσταται από ειδική εικονίδιο, κάνοντας κλικ σε αυτό θα Άνοιγμα νέας blade όπου λίστα ομαδοποιημένα σχόλια θα εμφανίζονται.
Αντιστοιχίας ερωτήματα και επιδόσεων ενέργειες μπορεί να σας βοηθήσει να κατανοήσετε καλύτερα το φόρτο εργασίας. 


##  <a name="optimizing-the-query-store-configuration-for-query-performance-insight"></a>Βελτιστοποίηση τη ρύθμιση παραμέτρων ερωτήματος χώρου αποθήκευσης για πληροφορίες για απόδοσης ερωτήματος

Κατά τη χρήση του ερωτήματος επιδόσεων γνώσεις, μπορεί να αντιμετωπίσετε τα ακόλουθα μηνύματα Store ερωτήματος:

- "Ερώτημα αποθήκευσης δεν έχει ρυθμιστεί σωστά σε αυτήν τη βάση δεδομένων. Κάντε κλικ εδώ για να μάθετε περισσότερα."
- "Ερώτημα αποθήκευσης δεν έχει ρυθμιστεί σωστά σε αυτήν τη βάση δεδομένων. Κάντε κλικ εδώ για να αλλάξετε τις ρυθμίσεις". 

Αυτά τα μηνύματα εμφανίζονται συνήθως όταν Store ερωτήματος δεν είναι δυνατό να συλλέγετε νέα δεδομένα. 

Πρώτη περίπτωση συμβεί όταν ερώτημα αποθήκευσης βρίσκεται σε κατάσταση μόνο για ανάγνωση και παράμετροι έχουν ρυθμιστεί σωστά. Μπορείτε να διορθώσετε αυτό αύξηση του μεγέθους του χώρου αποθήκευσης ερωτήματος ή καταργώντας την επιλογή αποθήκευσης ερωτήματος.

![κουμπί qds][8]

Δεύτερη περίπτωση συμβεί όταν ερωτήματος χώρου αποθήκευσης είναι απενεργοποιημένη ή παράμετροι δεν έχουν ρυθμιστεί σωστά. <br>Μπορείτε να αλλάξετε την πολιτική διατήρησης και καταγραφή και να ενεργοποιήσετε ερώτημα αποθήκευσης με την εκτέλεση παρακάτω εντολές ή απευθείας από την πύλη:

![κουμπί qds][9]

### <a name="recommended-retention-and-capture-policy"></a>Συνιστάται η πολιτική διατήρησης και καταγραφή

Υπάρχουν δύο τύποι των πολιτικών διατήρησης:

- Μέγεθος με βάση – Εάν οριστεί ΑΥΤΌΜΑΤΗ αυτό θα καθαρίσετε τα δεδομένα αυτόματα όταν κοντά μέγιστο μέγεθος φτάσει.
- Βάσει χρόνου - από προεπιλογή θα σας θα τη ρυθμίσετε να 30 ημέρες, γεγονός που σημαίνει ότι, αν Store ερώτημα θα εξαντλείται ο χώρος, αυτό θα διαγράψει πληροφορίες ερωτήματος που είναι παλαιότερες από 30 ημέρες

Καταγραφή πολιτική μπορεί να οριστεί για να:

- **Όλα** – καταγράφει όλα τα ερωτήματα.
- **Αυτόματη** – σπάνια ερωτήματα και τα ερωτήματα με μη διάρκεια μεταγλώττιση και εκτέλεσης παραβλέπονται. Όρια για τη διάρκεια count, μεταγλώττισης και περιβάλλον εκτέλεσης της εκτέλεσης καθορίζονται εσωτερικά. Αυτή είναι η προεπιλεγμένη επιλογή.
- **Καμία** – ερώτημα αποθήκευσης τερματίζει την καταγραφή νέα ερωτήματα, ωστόσο στατιστικές χρόνου εκτέλεσης για ήδη τραβήξατε ερωτήματα δεν είναι ακόμη που έχουν συλλεχθεί.
    
Συνιστάται να ρύθμιση όλες τις πολιτικές ΑΥΤΌΜΑΤΗΣ και clean πολιτική για 30 ημέρες:

    ALTER DATABASE [YourDB] 
    SET QUERY_STORE (SIZE_BASED_CLEANUP_MODE = AUTO);
        
    ALTER DATABASE [YourDB] 
    SET QUERY_STORE (CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 30));
    
    ALTER DATABASE [YourDB] 
    SET QUERY_STORE (QUERY_CAPTURE_MODE = AUTO);

Αύξηση του μεγέθους του χώρου αποθήκευσης ερωτήματος. Αυτό μπορεί να πραγματοποιηθεί από τη σύνδεση σε μια βάση δεδομένων και την έκδοση των παρακάτω ερωτήματος:

    ALTER DATABASE [YourDB]
    SET QUERY_STORE (MAX_STORAGE_SIZE_MB = 1024);

Εφαρμογή αυτές τις ρυθμίσεις θα εμφανίσει κάνει ερώτημα αποθήκευσης τη συλλογή νέα ερωτήματα, ωστόσο, εάν δεν θέλετε να περιμένετε, μπορείτε να καταργήσετε χώρο αποθήκευσης του ερωτήματος. 
> [AZURE.NOTE] Εκτέλεση ερωτήματος παρακάτω θα διαγράψει όλες τις τρέχουσες πληροφορίες στο χώρο αποθήκευσης του ερωτήματος. 


    ALTER DATABASE [YourDB] SET QUERY_STORE CLEAR;


## <a name="summary"></a>Σύνοψη

Πληροφορίες για επιδόσεις ερωτήματος σάς βοηθά να κατανοήσετε την επίδραση των του φόρτου εργασίας ερωτήματος και πώς σχετίζεται με τη βάση δεδομένων κατανάλωση πόρων. Με αυτήν τη δυνατότητα, θα μάθετε περισσότερα σχετικά με την αρχή κατανάλωση ερωτήματα και να τις εντοπίζετε εύκολα αυτά για να διορθώσετε το πρόβλημα πριν θα μετατραπούν σε κάποιο πρόβλημα.




## <a name="next-steps"></a>Επόμενα βήματα

Για πρόσθετες προτάσεις σχετικά με τη βελτίωση της απόδοσης της βάσης δεδομένων SQL, κάντε κλικ στην εντολή [συστάσεις](sql-database-advisor.md) το blade **Πληροφορίες για επιδόσεις του ερωτήματος** .

![Σύμβουλος επιδόσεων](./media/sql-database-query-performance/ia.png)


<!--Image references-->
[1]: ./media/sql-database-query-performance/tile.png
[2]: ./media/sql-database-query-performance/top-queries.png
[3]: ./media/sql-database-query-performance/query-details.png
[4]: ./media/sql-database-query-performance/top-duration.png
[5]: ./media/sql-database-query-performance/top-execution.png
[6]: ./media/sql-database-query-performance/annotation.png
[7]: ./media/sql-database-query-performance/annotation-details.png
[8]: ./media/sql-database-query-performance/qds-off.png
[9]: ./media/sql-database-query-performance/qds-button.png

