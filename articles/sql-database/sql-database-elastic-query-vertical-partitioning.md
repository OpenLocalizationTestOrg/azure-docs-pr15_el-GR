<properties
    pageTitle="Ερώτημα σε βάσεις δεδομένων cloud με διαφορετικό σχήμα | Microsoft Azure"
    description="πώς μπορείτε να ρυθμίσετε ερωτήματα σταυρό-βάσης δεδομένων επάνω από τα διαμερίσματα κατακόρυφη"    
    services="sql-database"
    documentationCenter=""  
    manager="jhubbard"
    authors="torsteng"/>

<tags
    ms.service="sql-database"
    ms.workload="sql-database"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="05/27/2016"
    ms.author="torsteng" />

# <a name="query-across-cloud-databases-with-different-schemas-preview"></a>Υποβολή ερωτήματος σε βάσεις δεδομένων cloud με διαφορετικά σχήματα (έκδοση preview)

![Υποβολή ερωτήματος σε πίνακες σε διαφορετικές βάσεις δεδομένων][1]

Κατακόρυφη διαμερίσματα βάσεις δεδομένων χρησιμοποιούν διαφορετικά σύνολα πίνακες σε διαφορετικές βάσεις δεδομένων. Αυτό σημαίνει ότι το σχήμα είναι διαφορετικά σε διαφορετικές βάσεις δεδομένων. Για παράδειγμα, όλους τους πίνακες για το απόθεμα είναι σε μία βάση δεδομένων ενώ όλους τους πίνακες που σχετίζονται με την λογιστική βρίσκονται σε μια δεύτερη βάση δεδομένων. 

## <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

* Ο χρήστης πρέπει να διαθέτει δικαιώματα ΤΡΟΠΟΠΟΙΉΣΟΥΝ ΟΠΟΙΑΔΉΠΟΤΕ ΕΞΩΤΕΡΙΚΌ αρχείο ΠΡΟΈΛΕΥΣΗΣ ΔΕΔΟΜΈΝΩΝ. Αυτό το δικαίωμα περιλαμβάνεται με το δικαίωμα "ΤΡΟΠΟΠΟΊΗΣΗ βάσης ΔΕΔΟΜΈΝΩΝ".
* Απαιτούνται δικαιώματα ΤΡΟΠΟΠΟΙΉΣΟΥΝ ΟΠΟΙΑΔΉΠΟΤΕ ΕΞΩΤΕΡΙΚΌ αρχείο ΠΡΟΈΛΕΥΣΗΣ ΔΕΔΟΜΈΝΩΝ για να ανατρέξετε στην υποκείμενη προέλευση δεδομένων.

## <a name="overview"></a>Επισκόπηση

**ΣΗΜΕΊΩΣΗ**: σε αντίθεση με με οριζόντια διαμερισμάτων αυτές τις προτάσεις DDL δεν εξαρτώνται από τον ορισμό μια σειρά δεδομένων με ένα χάρτη shard μέσω της βιβλιοθήκης ελαστικότητας βάση δεδομένων προγράμματος-πελάτη.

1. [ΔΗΜΙΟΥΡΓΊΑ ΠΡΩΤΕΎΟΝΤΟΣ ΚΛΕΙΔΙΟΎ](https://msdn.microsoft.com/library/ms174382.aspx)
2. [ΔΗΜΙΟΥΡΓΊΑ ΒΆΣΗΣ ΔΕΔΟΜΈΝΩΝ ΣΤΗΝ ΕΜΒΈΛΕΙΑ ΔΙΑΠΙΣΤΕΥΤΗΡΊΩΝ](https://msdn.microsoft.com/library/mt270260.aspx)
3. [ΔΗΜΙΟΥΡΓΊΑ ΕΞΩΤΕΡΙΚΉΣ ΠΡΟΈΛΕΥΣΗΣ ΔΕΔΟΜΈΝΩΝ](https://msdn.microsoft.com/library/dn935022.aspx)
4. [ΔΗΜΙΟΥΡΓΊΑ ΕΞΩΤΕΡΙΚΌΣ ΠΊΝΑΚΑΣ](https://msdn.microsoft.com/library/dn935021.aspx) 


## <a name="create-database-scoped-master-key-and-credentials"></a>Δημιουργία βάσης δεδομένων που βρίσκονται σε πεδία πρωτεύοντος κλειδιού και τα διαπιστευτήρια 

Τα διαπιστευτήρια που χρησιμοποιείται από το ελαστικότητας ερώτημα για να συνδεθείτε με τον απομακρυσμένο βάσεις δεδομένων.  

    CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'password';
    CREATE DATABASE SCOPED CREDENTIAL <credential_name>  WITH IDENTITY = '<username>',  
    SECRET = '<password>'
    [;]
 
**Σημείωση**    Βεβαιωθείτε ότι το *<username>* δεν περιλαμβάνει οποιονδήποτε *"@servername"* επίθημα. 

## <a name="create-external-data-sources"></a>Δημιουργία εξωτερικών προελεύσεων δεδομένων

Σύνταξη:

    <External_Data_Source> ::=
    CREATE EXTERNAL DATA SOURCE <data_source_name> WITH 
               (TYPE = RDBMS,
                LOCATION = ’<fully_qualified_server_name>’,
                DATABASE_NAME = ‘<remote_database_name>’,  
                CREDENTIAL = <credential_name> 
                ) [;] 

**Σημαντικό**   Η παράμετρος ΤΎΠΟΥ πρέπει να οριστεί σε **RDBMS**. 

### <a name="example"></a>Παράδειγμα 

Το ακόλουθο παράδειγμα δείχνει τη χρήση της την πρόταση CREATE για εξωτερικές προελεύσεις δεδομένων. 

    CREATE EXTERNAL DATA SOURCE RemoteReferenceData 
    WITH 
    ( 
        TYPE=RDBMS, 
        LOCATION='myserver.database.windows.net', 
        DATABASE_NAME='ReferenceData', 
        CREDENTIAL= SqlUser 
    ); 
 
Για να ανακτήσετε τη λίστα τρέχουσα εξωτερικών προελεύσεων δεδομένων: 

    select * from sys.external_data_sources; 

### <a name="external-tables"></a>Εξωτερικοί πίνακες 

Σύνταξη:

    CREATE EXTERNAL TABLE [ database_name . [ schema_name ] . | schema_name . ] table_name  
    ( { <column_definition> } [ ,...n ])     
    { WITH ( <rdbms_external_table_options> ) } 
    )[;] 
    
    <rdbms_external_table_options> ::= 
      DATA_SOURCE = <External_Data_Source>, 
      [ SCHEMA_NAME = N'nonescaped_schema_name',] 
      [ OBJECT_NAME = N'nonescaped_object_name',] 

### <a name="example"></a>Παράδειγμα  

    CREATE EXTERNAL TABLE [dbo].[customer]( 
        [c_id] int NOT NULL, 
        [c_firstname] nvarchar(256) NULL, 
        [c_lastname] nvarchar(256) NOT NULL, 
        [street] nvarchar(256) NOT NULL, 
        [city] nvarchar(256) NOT NULL, 
        [state] nvarchar(20) NULL, 
        [country] nvarchar(50) NOT NULL, 
    ) 
    WITH 
    ( 
           DATA_SOURCE = RemoteReferenceData 
    ); 

Το παρακάτω παράδειγμα δείχνει πώς μπορείτε να ανακτήσετε τη λίστα των εξωτερικών πίνακες από την τρέχουσα βάση δεδομένων: 

    select * from sys.external_tables; 

### <a name="remarks"></a>Παρατηρήσεις

Ελαστικά ερωτήματος επεκτείνει την υπάρχουσα σύνταξη εξωτερικού πίνακα για να ορίσετε μια εξωτερική πίνακες που χρησιμοποιούν εξωτερικές προελεύσεις δεδομένων του τύπου RDBMS. Έναν ορισμό εξωτερικό πίνακα για τη δημιουργία κατακόρυφης διαμερισμάτων καλύπτει τα ακόλουθα στοιχεία: 

* **Σχήμα**: το εξωτερικό πίνακα DDL καθορίζει ένα σχήμα που να χρησιμοποιήσετε τα ερωτήματά σας. Το σχήμα που παρέχεται στην ορισμού του εξωτερικού πίνακα πρέπει να συμφωνεί με το σχήμα τους πίνακες στο η απομακρυσμένη βάση δεδομένων που είναι αποθηκευμένα τα πραγματικά δεδομένα. 

* **Απομακρυσμένη βάση δεδομένων αναφοράς**: το εξωτερικό πίνακα DDL αναφέρεται σε μια εξωτερική προέλευση δεδομένων. Εξωτερική προέλευση δεδομένων καθορίζει το όνομα του διακομιστή λογική και όνομα βάσης δεδομένων της απομακρυσμένης βάσης δεδομένων όπου αποθηκεύεται το πραγματικά δεδομένα του πίνακα. 

Χρήση εξωτερικού αρχείου προέλευσης δεδομένων, όπως περιγράφεται στην προηγούμενη ενότητα, η σύνταξη για τη δημιουργία εξωτερικών πινάκων είναι ως εξής: 

Ο όρος DATA_SOURCE Καθορίζει την εξωτερική προέλευση δεδομένων (δηλαδή η απομακρυσμένη βάση δεδομένων σε περίπτωση κατακόρυφη διαμερισμάτων) που χρησιμοποιείται για τον εξωτερικό πίνακα.  

Τους όρους SCHEMA_NAME και όνομα αντικειμένου παρέχουν τη δυνατότητα να αντιστοιχίσετε τον ορισμό του εξωτερικού πίνακα σε έναν πίνακα σε ένα διαφορετικό σχήμα απομακρυσμένη βάση δεδομένων ή σε έναν πίνακα με διαφορετικό όνομα, αντίστοιχα. Αυτό είναι χρήσιμο εάν θέλετε να ορίσετε έναν εξωτερικό πίνακα σε μια προβολή καταλόγου ή DMV σε σας απομακρυσμένη βάση δεδομένων – ή οποιαδήποτε άλλα κατάσταση, όπου το όνομα του απομακρυσμένου πίνακα έχει ήδη αναληφθεί τοπικά.  

Η ακόλουθη πρόταση DDL προσθέτει έναν υπάρχοντα ορισμό εξωτερικός πίνακας από τον τοπικό κατάλογο. Δεν επηρεάζει η απομακρυσμένη βάση δεδομένων. 

    DROP EXTERNAL TABLE [ [ schema_name ] . | schema_name. ] table_name[;]  

**Δικαιώματα για ΔΗΜΙΟΥΡΓΊΑ/ΑΠΌΘΕΣΗΣ ΕΞΩΤΕΡΙΚΌ ΠΊΝΑΚΑ**: απαιτούνται δικαιώματα ΤΡΟΠΟΠΟΙΉΣΟΥΝ ΟΠΟΙΑΔΉΠΟΤΕ ΕΞΩΤΕΡΙΚΌ αρχείο ΠΡΟΈΛΕΥΣΗΣ ΔΕΔΟΜΈΝΩΝ για το εξωτερικό πίνακα DDL που απαιτείται για να ανατρέξετε στην υποκείμενη προέλευση δεδομένων.  

## <a name="security-considerations"></a>Ζητήματα ασφαλείας
Οι χρήστες με πρόσβαση στον εξωτερικό πίνακα αυτόματα η πρόσβαση στους πίνακες απομακρυσμένης βάσης στην περιοχή τα διαπιστευτήρια που δίνεται στον ορισμό προέλευσης εξωτερικών δεδομένων. Μπορείτε προσεκτικά πρέπει να διαχειριστείτε την πρόσβαση στον εξωτερικό πίνακα για να αποφύγετε ανεπιθύμητα ανύψωση δικαιωμάτων μέσω των διαπιστευτηρίων από εξωτερική προέλευση δεδομένων. Κανονική SQL δικαιώματα μπορούν να χρησιμοποιηθούν για να ΕΚΧΩΡΉΣΕΤΕ ή να ΑΝΑΚΑΛΈΣΕΤΕ την πρόσβαση σε έναν εξωτερικό πίνακα ακριβώς σαν να ήταν μια κανονική πίνακα.  


## <a name="example-querying-vertically-partitioned-databases"></a>Παράδειγμα: υποβολή ερωτημάτων κατακόρυφα διαμερίσματα βάσεις δεδομένων 

Το ακόλουθο ερώτημα εκτελεί ένας σύνδεσμος τρεις τρόπους μεταξύ των δύο πινάκων τοπικό για παραγγελίες και γραμμές παραγγελίας και τον απομακρυσμένο πίνακα για τους πελάτες σας. Αυτό είναι ένα παράδειγμα της υπόθεσης χρήσης δεδομένων αναφοράς για ελαστικά ερώτημα: 

    SELECT      
     c_id as customer,
     c_lastname as customer_name,
     count(*) as cnt_orderline, 
     max(ol_quantity) as max_quantity,
     avg(ol_amount) as avg_amount,
     min(ol_delivery_d) as min_deliv_date
    FROM customer 
    JOIN orders 
    ON c_id = o_c_id
    JOIN  order_line 
    ON o_id = ol_o_id and o_c_id = ol_c_id
    WHERE c_id = 100


## <a name="stored-procedure-for-remote-t-sql-execution-spexecuteremote"></a>Αποθηκευμένη διαδικασία για την εκτέλεση απομακρυσμένου T-SQL: sp\_execute_remote

Ελαστικά ερωτήματος παρουσιάζει επίσης μια αποθηκευμένη διαδικασία που παρέχει άμεση πρόσβαση σε το shards. Αποθηκευμένη διαδικασία ονομάζεται [sp\_εκτέλεση \_απομακρυσμένης](https://msdn.microsoft.com/library/mt703714) και μπορεί να χρησιμοποιηθεί για την εκτέλεση απομακρυσμένου αποθηκευμένες διαδικασίες ή κώδικα T SQL σε απομακρυσμένο βάσεων δεδομένων. Χρειάζονται τις ακόλουθες παραμέτρους: 

* Όνομα της προέλευσης δεδομένων (nvarchar): το όνομα του αρχείου προέλευσης δεδομένων εξωτερικής προέλευσης του τύπου RDBMS. 
* Ερώτημα (nvarchar): το T-SQL ερωτήματος για να εκτελεστεί σε κάθε shard. 
* Δήλωση παραμέτρων (nvarchar) - Προαιρετικά: συμβολοσειρά με ορισμούς τύπου δεδομένων για τις παραμέτρους που χρησιμοποιούνται στην παράμετρο ερωτήματος (όπως sp_executesql). 
* Λίστα τιμή παραμέτρου - Προαιρετικά: διαχωρισμένες με κόμματα λίστα με τιμές παραμέτρων (όπως sp_executesql).

Το sp\_εκτέλεση\_remote χρησιμοποιεί εξωτερικό αρχείο προέλευσης δεδομένων που παρέχεται στην τις παραμέτρους κλήσης για να εκτελέσετε την δεδομένη T-SQL σε απομακρυσμένο βάσεων δεδομένων. Για να συνδεθείτε με τη βάση δεδομένων διαχείρισης shardmap και των βάσεων δεδομένων απομακρυσμένης χρησιμοποιεί τα διαπιστευτήρια από εξωτερική προέλευση δεδομένων.  

Παράδειγμα: 

    EXEC sp_execute_remote
        N'MyExtSrc',
        N'select count(w_id) as foo from warehouse' 


  
## <a name="connectivity-for-tools"></a>Σύνδεση για τα εργαλεία

Μπορείτε να χρησιμοποιήσετε κανονική συμβολοσειρές σύνδεσης του SQL Server για να συνδεθείτε σας εργαλεία ενοποίησης BI και τα δεδομένα σε βάσεις δεδομένων SQL DB διακομιστή που έχει ελαστικότητας ερωτήματος με δυνατότητα και εξωτερικοί πίνακες που ορίζονται από το. Βεβαιωθείτε ότι υποστηρίζεται SQL Server ως προέλευση δεδομένων για το εργαλείο. Στη συνέχεια, ανατρέξτε στη βάση δεδομένων ελαστικότητας ερωτήματος και το εξωτερικό πίνακες όπως οποιαδήποτε άλλα βάση δεδομένων SQL Server που θα συνδεθεί με το εργαλείο. 

## <a name="best-practices"></a>Βέλτιστες πρακτικές 
 
* Βεβαιωθείτε ότι η βάση δεδομένων του τελικού σημείου ελαστικότητας ερώτημα έχει έχει δοθεί πρόσβαση σε η απομακρυσμένη βάση δεδομένων ενεργοποιώντας πρόσβασης για τις υπηρεσίες του Azure της ρύθμισης παραμέτρων του τείχους προστασίας SQL DB. Επίσης βεβαιωθείτε ότι τα διαπιστευτήρια που παρέχονται στον ορισμό προέλευσης εξωτερικών δεδομένων μπορεί να συνδεθεί με επιτυχία στο η απομακρυσμένη βάση δεδομένων και έχει τα δικαιώματα για να αποκτήσετε πρόσβαση στον απομακρυσμένο πίνακα.  

* Ελαστικά ερωτήματος λειτουργεί καλύτερα για ερωτήματα όπου μπορεί να γίνει περισσότερες από τον υπολογισμό σε απομακρυσμένο βάσεων δεδομένων. Συνήθως, μπορείτε να λάβετε τις καλύτερες επιδόσεις ερωτημάτων με κατηγορήματα επιλεκτική φίλτρου που μπορεί να αξιολογηθεί στον απομακρυσμένο βάσεις δεδομένων ή σύνδεσμοι που μπορούν να εκτελεστούν πλήρως απομακρυσμένη βάση δεδομένων. Άλλες μοτίβα ερωτήματος μπορεί να χρειαστεί να φορτώσετε μεγάλες ποσότητες δεδομένων από η απομακρυσμένη βάση δεδομένων και ενδέχεται να είναι σωστά. 


## <a name="next-steps"></a>Επόμενα βήματα

Για να υποβάλετε ερώτημα οριζόντια διαμερίσματα βάσεων δεδομένων (γνωστό και ως sharded βάσεις δεδομένων), ανατρέξτε στο θέμα [ερωτήματα σε βάσεις δεδομένων sharded cloud (οριζόντια διαμερίσματα)](sql-database-elastic-query-horizontal-partitioning.md).

[AZURE.INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]


<!--Image references-->
[1]: ./media/sql-database-elastic-query-vertical-partitioning/verticalpartitioning.png


<!--anchors-->
