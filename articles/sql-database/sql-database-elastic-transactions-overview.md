<properties
   pageTitle="Κατανεμημένες συναλλαγές σε βάσεις δεδομένων cloud"
   description="Επισκόπηση των συναλλαγές ελαστικότητας βάσης δεδομένων με βάση δεδομένων SQL Azure"
   services="sql-database"
   documentationCenter=""
   authors="torsteng"
   manager="jhubbard"
   editor="torsteng"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="sql-database"
   ms.date="05/27/2016"
   ms.author="torsteng"/>

# <a name="distributed-transactions-across-cloud-databases"></a>Κατανεμημένες συναλλαγές σε βάσεις δεδομένων cloud

Οι συναλλαγές ελαστικότητας βάσης δεδομένων για βάση δεδομένων SQL Azure (SQL DB) σάς επιτρέπουν να εκτελέσετε συναλλαγές που εκτείνονται σε πολλές βάσεις δεδομένων στο SQL DB. Συναλλαγές ελαστικότητας βάσης δεδομένων για SQL DB είναι διαθέσιμες για εφαρμογές .NET χρησιμοποιώντας ADO .NET και ενοποίηση με την οικεία εμπειρία προγραμματισμού χρησιμοποιώντας τις κατηγορίες [System.Transaction](https://msdn.microsoft.com/library/system.transactions.aspx) . Για να μεταβείτε στη βιβλιοθήκη, ανατρέξτε στο θέμα [.NET Framework 4.6.1 (Web Installer)](https://www.microsoft.com/download/details.aspx?id=49981).

Εσωτερικής εγκατάστασης, όπως ένα σενάριο απαιτείται συνήθως εκτελεί συντονισμού συναλλαγής κατανεμημένο Microsoft (MSDTC). Επειδή το MSDTC δεν είναι διαθέσιμη για την πλατφόρμα-ως-a εφαρμογή υπηρεσίας στο Azure, η δυνατότητα για το συντονισμό κατανεμημένες συναλλαγές έχει τώρα απευθείας ενσωματωθεί στα SQL DB. Εφαρμογές μπορούν να συνδεθούν με οποιαδήποτε βάση δεδομένων SQL εκκίνηση κατανεμημένες συναλλαγές και μία από τις βάσεις δεδομένων με διαφάνεια θα συντονισμό κατανεμημένη συναλλαγή, όπως φαίνεται στην παρακάτω εικόνα. 

  ![Κατανεμημένες συναλλαγές με βάση δεδομένων SQL Azure χρησιμοποιώντας συναλλαγές ελαστικότητας βάσης δεδομένων ][1]

## <a name="common-scenarios"></a>Κοινά σενάρια

Οι συναλλαγές ελαστικότητας βάσης δεδομένων για SQL DB επιτρέπουν στις εφαρμογές για να κάνετε αλλαγές ατομικής δεδομένα που είναι αποθηκευμένα σε πολλές διαφορετικές βάσεις δεδομένων SQL. Η προεπισκόπηση εστιάζει στην πλευρά του προγράμματος-πελάτη ανάπτυξης εμπειρίες στο C# και .NET. Μια εμπειρία διακομιστή χρησιμοποιώντας την T-SQL είναι προγραμματισμένες για αργότερα.  
Οι συναλλαγές ελαστικότητας βάσης δεδομένων ως προορισμό τα ακόλουθα σενάρια:

* Εφαρμογές πολλαπλών βάσεων δεδομένων στο Azure: με αυτό το σενάριο, δεδομένων έχει κατακόρυφα διαμερίσματα σε βάσεις δεδομένων στο SQL DB τέτοια ώστε διαφορετικά είδη των δεδομένων που βρίσκονται σε διαφορετικές βάσεις δεδομένων. Ορισμένες λειτουργίες απαιτούν αλλαγές στα δεδομένα που διατηρείται σε δύο ή περισσότερες βάσεις δεδομένων. Η εφαρμογή χρησιμοποιεί συναλλαγές ελαστικότητας βάσης δεδομένων για να συντονίσετε τις αλλαγές σε βάσεις δεδομένων και να διασφαλίσετε ατομικότητα.

* Εφαρμογές sharded βάσης δεδομένων στο Azure: με αυτό το σενάριο, η σειρά δεδομένων, χρησιμοποιεί την [ελαστική βάση δεδομένων προγράμματος-πελάτη βιβλιοθήκη](sql-database-elastic-database-client-library.md) ή αυτο-υπογεγραμμένο sharding σε οριζόντια διαμερισμάτων τα δεδομένα σε πολλές βάσεις δεδομένων στο SQL DB. Μία περίπτωσης χρήσης εμφανείς είναι χρειάζεστε για να εκτελέσετε μεμονωμένες αλλαγές για μια εφαρμογή πολλών μισθωτών sharded όταν μισθωτές καλύπτουν τις αλλαγές. Για παράδειγμα σκεφτείτε μεταφοράς από ένα μισθωτή του σε μια άλλη, και οι δύο που βρίσκονται σε διαφορετικές βάσεις δεδομένων. Μια δεύτερη περίπτωση είναι λεπτομερή sharding σύμφωνα με τις ανάγκες χωρητικότητα για μια μεγάλη μισθωτή του οποίου με τη σειρά συνήθως σημαίνει ότι ορισμένες λειτουργίες ατομικής πρέπει να επεκτείνετε σε διάφορες βάσεις δεδομένων που χρησιμοποιούνται για τον ίδιο μισθωτή. Μια τρίτη περίπτωση είναι ατομικής ενημερώσεις για αναφορά δεδομένων που αναπαράγονται σε βάσεις δεδομένων. Τώρα μπορεί να είναι συντονισμός ατομικής, συναλλαγής, εργασίες κατά μήκος αυτές τις γραμμές σε βάσεις δεδομένων με χρήση της προεπισκόπησης.
Συναλλαγές της βάσης δεδομένων ελαστικότητας Χρησιμοποιήστε ολοκλήρωσης σε δύο φάσεις για να βεβαιωθείτε ότι ατομικότητα συναλλαγών σε βάσεις δεδομένων. Είναι κατάλληλες για κινήσεις που αφορούν λιγότερους από 100 βάσεις δεδομένων κάθε φορά μέσα σε μία συναλλαγή. Αυτά τα όρια δεν επιβάλλονται, αλλά ένα θα πρέπει να περιμένουν απόδοσης και τους συντελεστές επιτυχίας για συναλλαγές ελαστικότητας βάσης δεδομένων να υφίσταται όταν υπερβαίνει αυτά τα όρια.


## <a name="installation-and-migration"></a>Εγκατάσταση και μετεγκατάστασης

Οι δυνατότητες για τις συναλλαγές ελαστικότητας βάσης δεδομένων SQL DB παρέχονται μέσω ενημερώσεις για τις βιβλιοθήκες .NET System.Data.dll και System.Transactions.dll. Το DLL βεβαιωθείτε ότι χρησιμοποιείται αυτό ολοκλήρωσης σε δύο φάσεις ενδεχομένως να διασφαλίσετε ότι ατομικότητα. Για να ξεκινήσετε την ανάπτυξη εφαρμογών χρησιμοποιώντας συναλλαγές ελαστικότητας βάσης δεδομένων, εγκαταστήστε το [.NET Framework 4.6.1](https://www.microsoft.com/download/details.aspx?id=49981) ή νεότερη έκδοση. Όταν εκτελείται σε παλαιότερη έκδοση του .NET framework, συναλλαγές θα αποτύχει για να προβιβάσετε σε κατανεμημένη συναλλαγή και στρογγυλοποιείται μια εξαίρεση.

Μετά την εγκατάσταση, μπορείτε να χρησιμοποιήσετε την κατανεμημένη συναλλαγή APIs στο System.Transactions με συνδέσεις σε SQL DB. Εάν έχετε υπάρχοντα MSDTC εφαρμογές που χρησιμοποιούν αυτά τα API, απλώς εκ νέου δημιουργία τις υπάρχουσες εφαρμογές για το .NET 4.6 μετά την εγκατάσταση του 4.6.1 Framework. Εάν τα έργα σας στόχου .NET 4.6, θα χρησιμοποιείται αυτόματα το ενημερωμένο DLL από τη νέα έκδοση Framework και κατανεμημένων συναλλαγών API κλήσεις σε συνδυασμό με συνδέσεις προς SQL DB θα τώρα ολοκληρωθεί με επιτυχία.

Να θυμάστε ότι οι συναλλαγές ελαστικότητας βάσης δεδομένων δεν απαιτεί την εγκατάσταση του MSDTC. Αντί για αυτό, οι συναλλαγές ελαστικότητας βάσης δεδομένων πραγματοποιείται απευθείας και εντός SQL DB. Αυτό σημαντικά απλοποιεί σενάρια cloud δεδομένου ότι δεν χρειάζεται να χρησιμοποιήσετε κατανεμημένες συναλλαγές με SQL DB μια ανάπτυξη του MSDTC. 4 ενότητα εξηγεί με περισσότερες λεπτομέρειες τον τρόπο για να αναπτύξετε συναλλαγές ελαστικότητας βάσης δεδομένων και το απαιτούμενο .NET framework μαζί με τις εφαρμογές σας cloud για να Azure.

## <a name="development-experience"></a>Εμπειρία ανάπτυξης

### <a name="multi-database-applications"></a>Εφαρμογές πολλαπλών βάσης δεδομένων

Το παρακάτω δείγμα κώδικα χρησιμοποιεί την οικεία εμπειρία προγραμματισμού με .NET System.Transactions. Η κλάση TransactionScope δημιουργεί μια συναλλαγή περιβάλλοντος στο .NET. (Μια "συναλλαγή περιβάλλοντος" είναι ένα που βρίσκονται στο το τρέχον νήμα.) Όλες οι συνδέσεις ανοίξει εντός του TransactionScope συμμετέχουν στη συναλλαγή. Εάν συμμετάσχετε διαφορετικές βάσεις δεδομένων, η συναλλαγή αυτόματα αναβαθμίστηκε σε κατανεμημένη συναλλαγή. Το αποτέλεσμα της κίνησης ελέγχεται από τη ρύθμιση πεδίου για να ολοκληρώσετε για να υποδείξετε ότι μια ολοκλήρωση.

    using (var scope = new TransactionScope())
    {
        using (var conn1 = new SqlConnection(connStrDb1))
        {
            conn1.Open();
            SqlCommand cmd1 = conn1.CreateCommand();
            cmd1.CommandText = string.Format("insert into T1 values(1)");
            cmd1.ExecuteNonQuery();
        }

        using (var conn2 = new SqlConnection(connStrDb2))
        {
            conn2.Open();
            var cmd2 = conn2.CreateCommand();
            cmd2.CommandText = string.Format("insert into T2 values(2)");
            cmd2.ExecuteNonQuery();
        }

        scope.Complete();
    }

### <a name="sharded-database-applications"></a>Εφαρμογές sharded βάσης δεδομένων
 
Οι συναλλαγές ελαστικότητας βάσης δεδομένων για SQL DB υποστηρίζουν επίσης συντονισμό κατανεμημένες συναλλαγές όπου μπορείτε να χρησιμοποιήσετε τη μέθοδο OpenConnectionForKey της βιβλιοθήκης ελαστικότητας βάση δεδομένων προγράμματος-πελάτη για να ανοίξετε τις συνδέσεις για κλιμάκωση ανάληψη δεδομένων επίπεδο. Εξετάστε το ενδεχόμενο περιπτώσεις όπου πρέπει να εξασφαλιστεί συναλλαγών συνέπεια για αλλαγές σε πολλές διαφορετικές sharding βασικές τιμές. Συνδέσεις προς την shards φιλοξενεί τις κύριες τιμές διαφορετικές sharding είναι όπου μεσολαβούν χρησιμοποιώντας OpenConnectionForKey. Στην περίπτωση που γενικά, οι συνδέσεις μπορεί να είναι σε διαφορετική shards τέτοια ώστε ταυτόχρονα εξασφαλίζετε ότι οι συναλλαγές εγγυήσεις απαιτεί κατανεμημένη συναλλαγή. Το παρακάτω δείγμα κώδικα απεικονίζει αυτήν την προσέγγιση. Προϋποθέτει ότι μια μεταβλητή που ονομάζεται shardmap χρησιμοποιείται για να αντιπροσωπεύει μια αντιστοίχιση shard από τη βιβλιοθήκη ελαστικότητας βάση δεδομένων προγράμματος-πελάτη:

    using (var scope = new TransactionScope())
    {
        using (var conn1 = shardmap.OpenConnectionForKey(tenantId1, credentialsStr))
        {
            conn1.Open();
            SqlCommand cmd1 = conn1.CreateCommand();
            cmd1.CommandText = string.Format("insert into T1 values(1)");
            cmd1.ExecuteNonQuery();
        }
        
        using (var conn2 = shardmap.OpenConnectionForKey(tenantId2, credentialsStr))
        {
            conn2.Open();
            var cmd2 = conn2.CreateCommand();
            cmd2.CommandText = string.Format("insert into T1 values(2)");
            cmd2.ExecuteNonQuery();
        }

        scope.Complete();
    }


## <a name="net-installation-for-azure-cloud-services"></a>.NET εγκατάστασης για τις υπηρεσίες Cloud Azure

Azure παρέχει διάφορες προσφορές για τις εφαρμογές .NET του κεντρικού υπολογιστή. Μια σύγκριση των προσφορών διαφορετικό είναι διαθέσιμη στο [Azure εφαρμογής υπηρεσίας, τις υπηρεσίες Cloud, και εικονικές μηχανές σύγκρισης](../app-service-web/choose-web-site-cloud-service-vm.md). Εάν το λειτουργικό σύστημα επισκέπτη το προσφοράς είναι μικρότερη από .NET 4.6.1 που απαιτούνται για το ελαστικότητας συναλλαγές, πρέπει να αναβαθμίσετε το λειτουργικό σύστημα επισκέπτη σε 4.6.1. 

Για τις υπηρεσίες εφαρμογών Azure, αναβαθμίσεις για το λειτουργικό σύστημα επισκέπτη αυτήν τη στιγμή δεν υποστηρίζονται. Για εικονικές μηχανές Windows Azure, απλώς να συνδεθείτε με το Εικονική και εκτελέστε το πρόγραμμα εγκατάστασης για το πιο πρόσφατο .NET framework. Για τις υπηρεσίες Cloud Azure, πρέπει να περιλαμβάνουν την εγκατάσταση σε νεότερη έκδοση .NET σε τις εργασίες εκκίνησης της ανάπτυξής σας. Τις έννοιες και τα βήματα τεκμηριώνονται στο [.NET εγκατάσταση σε ρόλο υπηρεσία Cloud](../cloud-services/cloud-services-dotnet-install-dotnet.md).  

Σημειώστε ότι το πρόγραμμα εγκατάστασης για το .NET 4.6.1 μπορεί να απαιτεί περισσότερο χώρο αποθήκευσης προσωρινό κατά τη διαδικασία bootstrapping σχετικά με τις υπηρεσίες Azure cloud από το πρόγραμμα εγκατάστασης για το .NET 4.6. Για να διασφαλίσετε την επιτυχία της εγκατάστασης, πρέπει να αυξήσετε προσωρινής αποθήκευσης για την υπηρεσία Azure cloud στο αρχείο σας ServiceDefinition.csdef στην ενότητα LocalResources και τις ρυθμίσεις του περιβάλλοντος εργασίας σας εκκίνησης, όπως φαίνεται στο ακόλουθο δείγμα:

    <LocalResources>
    ...
        <LocalStorage name="TEMP" sizeInMB="5000" cleanOnRoleRecycle="false" />
        <LocalStorage name="TMP" sizeInMB="5000" cleanOnRoleRecycle="false" />
    </LocalResources>
    <Startup>
        <Task commandLine="install.cmd" executionContext="elevated" taskType="simple">
            <Environment>
        ...
                <Variable name="TEMP">
                    <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='TEMP']/@path" />
                </Variable>
                <Variable name="TMP">
                    <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='TMP']/@path" />
                </Variable>
            </Environment>
        </Task>
    </Startup>
    
## <a name="transactions-across-multiple-servers"></a>Συναλλαγές σε πολλούς διακομιστές

Συναλλαγές της βάσης δεδομένων ελαστικότητας υποστηρίζονται διαφορετική λογική στους διακομιστές της βάσης δεδομένων SQL Azure. Όταν οι συναλλαγές όρια λογική διακομιστή, τους διακομιστές που συμμετέχουν πρέπει πρώτα να να καταχωρηθούν σε μια σχέση αμοιβαία επικοινωνίας. Αφού έχει δημιουργηθεί η σχέση επικοινωνίας, οποιαδήποτε βάση δεδομένων σε οποιονδήποτε από τους δύο διακομιστές να συμμετάσχετε σε ελαστικότητας συναλλαγές με βάσεις δεδομένων από τον άλλο διακομιστή. Με συναλλαγές που εκτείνονται σε περισσότερες από δύο λογικές διακομιστές, μια σχέση επικοινωνίας πρέπει να βρίσκεται στο σημείο για κάθε ζεύγος λογική διακομιστές.

Χρησιμοποιήστε τα παρακάτω cmdlet του PowerShell για τη Διαχείριση σχέσεων επικοινωνία μεταξύ διακομιστών για συναλλαγές ελαστικότητας βάσης δεδομένων:

* **Δημιουργία AzureRmSqlServerCommunicationLink**: Χρησιμοποιήστε αυτό το cmdlet για να δημιουργήσετε μια νέα σχέση επικοινωνίας μεταξύ των δύο λογικές διακομιστές σε Azure SQL DB. Η σχέση είναι συμμετρική που σημαίνει ότι και οι δύο διακομιστές μπορούν να ξεκινήσουν συναλλαγές με τον άλλο διακομιστή.
* **Get-AzureRmSqlServerCommunicationLink**: Χρησιμοποιήστε αυτό το cmdlet για να ανακτήσετε υπάρχουσες σχέσεις επικοινωνίας και τις ιδιότητές τους.
* **Κατάργηση AzureRmSqlServerCommunicationLink**: Χρησιμοποιήστε αυτό το cmdlet για να καταργήσετε μια υπάρχουσα σχέση επικοινωνίας. 


## <a name="monitoring-transaction-status"></a>Παρακολούθηση κατάστασης συναλλαγής

Χρησιμοποιήστε δυναμική Διαχείριση προβολών (DMVs) στο SQL DB για να την οθόνη κατάσταση και την πρόοδο των συναλλαγών σε εξέλιξη ελαστικότητας βάσης δεδομένων σας. Όλα τα DMVs που σχετίζονται με συναλλαγές αυτές αφορούν κατανεμημένες συναλλαγές στο SQL DB. Μπορείτε να βρείτε στην αντίστοιχη λίστα των DMVs εδώ: [συναλλαγής σχετικές δυναμική διαχείριση προβολές και συναρτήσεις (Transact-SQL)](https://msdn.microsoft.com/library/ms178621.aspx).
 
Αυτές οι DMVs είναι ιδιαίτερα χρήσιμα:

* **sys.dm\_αντι\_active\_συναλλαγές**: Παραθέτει ενεργών συναλλαγών και την κατάστασή τους. Η στήλη UOW (μονάδα εργασίας) μπορούν να προσδιοριστούν τις συναλλαγές διαφορετικό παιδί που ανήκει στην ίδια κατανεμημένη συναλλαγή. Όλες οι συναλλαγές μέσα στην ίδια κατανεμημένη συναλλαγή φέρουν την ίδια τιμή UOW. Ανατρέξτε στην [τεκμηρίωση DMV](https://msdn.microsoft.com/library/ms174302.aspx) για περισσότερες λεπτομέρειες.
* **sys.dm\_αντι\_βάσης δεδομένων\_συναλλαγές**: παρέχει πρόσθετες πληροφορίες σχετικά με τις συναλλαγές, όπως η θέση της κίνησης στο αρχείο καταγραφής. Ανατρέξτε στην [τεκμηρίωση DMV](https://msdn.microsoft.com/library/ms186957.aspx) για περισσότερες λεπτομέρειες.
* **sys.dm\_αντι\_κλειδωμάτων**: παρέχει πληροφορίες σχετικά με τα κλειδώματα που αυτήν τη στιγμή κατέχει συναλλαγές βρίσκεται σε εξέλιξη. Ανατρέξτε στην [τεκμηρίωση DMV](https://msdn.microsoft.com/library/ms190345.aspx) για περισσότερες λεπτομέρειες.

## <a name="limitations"></a>Περιορισμοί 

Τους ακόλουθους περιορισμούς ισχύουν αυτήν τη στιγμή για τις συναλλαγές ελαστικότητας βάσης δεδομένων SQL DB:

* Υποστηρίζονται μόνο οι κινήσεις σε βάσεις δεδομένων στο SQL DB. Άλλες [X / Άνοιγμα XA](https://en.wikipedia.org/wiki/X/Open_XA) υπηρεσίες παροχής πόρων και βάσεων δεδομένων εκτός του SQL DB δεν είναι δυνατό να συμμετάσχετε σε συναλλαγές ελαστικότητας βάσης δεδομένων. Αυτό σημαίνει ότι οι συναλλαγές ελαστικότητας βάσης δεδομένων δεν είναι δυνατό να επεκτείνετε σε εσωτερικής εγκατάστασης SQL Server και βάσεις δεδομένων SQL Azure. Για κατανεμημένες συναλλαγές εσωτερικής εγκατάστασης, συνεχίσετε να χρησιμοποιείτε MSDTC. 
* Υποστηρίζονται μόνο συναλλαγές που συντονισμένη προγράμματος-πελάτη από μια εφαρμογή .NET. Υποστήριξη διακομιστή T-SQL όπως ΞΕΚΙΝΉΣΕΙ ΚΑΤΑΝΕΜΗΜΈΝΗΣ ΣΥΝΑΛΛΑΓΉΣ είναι προγραμματισμένη, αλλά δεν είναι ακόμη διαθέσιμη. 
* Υποστηρίζονται μόνο βάσεις δεδομένων σε Azure SQL DB V12.
* Συναλλαγές σε υπηρεσίες WCF δεν υποστηρίζονται. Για παράδειγμα, έχετε μια μέθοδο υπηρεσία WCF που εκτελεί μια συναλλαγή. Περικλείει την κλήση μέσα σε ένα πεδίο συναλλαγής θα αποτύχει με μια [System.ServiceModel.ProtocolException](https://msdn.microsoft.com/library/system.servicemodel.protocolexception).

## <a name="additional-resources"></a>Πρόσθετοι πόροι

Δεν έχουν ακόμα χρησιμοποιώντας δυνατότητες ελαστικότητας βάσης δεδομένων για τις εφαρμογές του Azure; Ανατρέξτε στο θέμα μας [Τεκμηρίωση χάρτη](https://azure.microsoft.com/documentation/learning-paths/sql-database-elastic-scale/). Για ερωτήσεις, λάβετε επικοινωνία μας στο [φόρουμ βάση δεδομένων SQL](http://social.msdn.microsoft.com/forums/azure/home?forum=ssdsgetstarted) και για αιτήσεις για δυνατότητες, προσθέστε τους στο [φόρουμ σχολίων βάση δεδομένων SQL](https://feedback.azure.com/forums/217321-sql-database/).

<!--Image references-->
[1]: ./media/sql-database-elastic-transactions-overview/distributed-transactions.png



