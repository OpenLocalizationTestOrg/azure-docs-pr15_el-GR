<properties 
    pageTitle="Μετακίνηση δεδομένων μεταξύ βάσεων δεδομένων cloud κλιμάκωση ανάληψης | Microsoft Azure" 
    description="Εξηγεί τον τρόπο για να χειριστείτε shards και μετακίνηση δεδομένων μέσω μια αυτο-υπηρεσία χρήση APIs ελαστικότητας βάσης δεδομένων." 
    services="sql-database" 
    documentationCenter="" 
    manager="jhubbard" 
    authors="ddove"/>

<tags 
    ms.service="sql-database" 
    ms.workload="sql-database" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="05/27/2016" 
    ms.author="ddove" />

# <a name="moving-data-between-scaled-out-cloud-databases"></a>Μετακίνηση δεδομένων μεταξύ βάσεων δεδομένων κλιμάκωση ανάληψης cloud

Εάν είστε ένα λογισμικό ως υπηρεσία προγραμματιστής και ξαφνικά την εφαρμογή σας υφίσταται πολύ μεγάλη ζήτηση, πρέπει να περιλαμβάνει την ανάπτυξη. Επομένως, μπορείτε να προσθέσετε περισσότερες βάσεις δεδομένων (shards). Πώς μπορείτε να αναδιανομή των δεδομένων με τις νέες βάσεις δεδομένων χωρίς να διακόψετε την ακεραιότητα δεδομένων; Χρησιμοποιήστε το **εργαλείο διαίρεσης συγχώνευσης** για τη μετακίνηση δεδομένων από περιορισμένη βάσεις δεδομένων με τις νέες βάσεις δεδομένων.  

Το εργαλείο διαίρεσης συγχώνευσης εκτελείται ως υπηρεσία Azure web. Ένας διαχειριστής ή προγραμματιστής χρησιμοποιεί το εργαλείο για να μετακινήσετε shardlets (δεδομένα από μια shard) ανάμεσα σε διαφορετικές βάσεις δεδομένων (shards). Το εργαλείο χρησιμοποιεί shard χάρτης διαχείρισης για να διατηρήσετε τη βάση δεδομένων της υπηρεσίας μετα-δεδομένων, και βεβαιωθείτε ότι οι αντιστοιχίσεις συνεπή.

![Επισκόπηση][1]

## <a name="download"></a>Λήψη
[Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge](http://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge/)


## <a name="documentation"></a>Τεκμηρίωση
1. [Εκμάθηση εργαλείο ελαστικότητας βάσης δεδομένων διαιρεμένης συγχώνευσης](sql-database-elastic-scale-configure-deploy-split-and-merge.md)
* [Ρύθμιση παραμέτρων ασφαλείας διαιρεμένης συγχώνευσης](sql-database-elastic-scale-split-merge-security-configuration.md)
* [Ζητήματα ασφαλείας διαιρεμένης συγχώνευσης](sql-database-elastic-scale-split-merge-security-configuration.md)
* [Διαχείριση shard χάρτη](sql-database-elastic-scale-shard-map-management.md)
* [Μετεγκατάσταση υπάρχουσες βάσεις δεδομένων με κλίμακα](sql-database-elastic-convert-to-use-elastic-tools.md)
* [Εργαλεία ελαστικότητας βάσης δεδομένων](sql-database-elastic-scale-introduction.md)
* [Ελαστικά Γλωσσάρι Εργαλεία βάσης δεδομένων](sql-database-elastic-scale-glossary.md)

## <a name="why-use-the-split-merge-tool"></a>Γιατί να χρησιμοποιήσετε το εργαλείο διαίρεσης συγχώνευσης;

**Ευελιξία**

Εφαρμογές πρέπει να απομακρύνετε τις άκρες ευελιξία πέρα από τα όρια της μία βάση δεδομένων SQL Azure DB. Χρησιμοποιήστε το εργαλείο για τη μετακίνηση δεδομένων, όπως απαιτείται για νέες βάσεις δεδομένων, διατηρώντας παράλληλα την ακεραιότητα.

**Διαίρεση για ανάπτυξη** 

Πρέπει να αυξήσετε τη συνολική χωρητικότητα για το χειρισμό την ανάπτυξης. Για να το κάνετε αυτό, δημιουργήστε πρόσθετη χωρητικότητα με sharding τα δεδομένα και με τη διανομή σε σταδιακά περισσότερες βάσεις δεδομένων, μέχρι να πληρούνται αναγκών δυναμικότητας. Αυτό είναι ένα παράδειγμα δάνεια της δυνατότητας "Διαίρεση". 

**Για να συμπτύξετε τη συγχώνευση**

Δυνατότητα πρέπει σμίκρυνση λόγω της φύσης εποχιακό μιας επιχείρησης. Το εργαλείο σάς επιτρέπει να κλίμακα προς τα κάτω για να λιγότερες μονάδες κλίμακας όταν επιβραδύνει επιχειρήσεις. Η δυνατότητα "Συγχώνευση" στην υπηρεσία διαίρεσης συγχώνευσης ελαστικότητας κλίμακα καλύπτει αυτήν την απαίτηση. 

**Διαχείριση ενεργά σημεία, μετακινώντας shardlets**

Με πολλούς μισθωτές ανά βάση δεδομένων, την κατανομή των shardlets να shards μπορεί να οδηγήσει σε χωρητικότητα συνωστισμών σε ορισμένες shards. Απαιτείται εκ νέου εκχώρηση shardlets ή μετακίνηση απασχολημένος shardlets στο νέο ή λιγότερο εκμεταλλευθεί shards. 

## <a name="concepts--key-features"></a>Έννοιες & βασικές δυνατότητες

**Υπηρεσίες που φιλοξενείται στο πελατών**

Η διαίρεση συγχώνευσης παραδίδεται ως υπηρεσία που φιλοξενείται στο πελάτη. Πρέπει να αναπτύξετε και να φιλοξενεί την υπηρεσία στη συνδρομή σας στο Microsoft Azure. Το πακέτο που μπορείτε να κάνετε λήψη από το NuGet περιέχει ένα πρότυπο ρύθμισης παραμέτρων για να ολοκληρώσετε με τις πληροφορίες για το συγκεκριμένο ανάπτυξης. Ανατρέξτε στο θέμα της [διαίρεσης συγχώνευσης πρόγραμμα εκμάθησης](sql-database-elastic-scale-configure-deploy-split-and-merge.md) για λεπτομέρειες. Εφόσον η υπηρεσία εκτελείται στο Azure τη συνδρομή σας, μπορείτε να ελέγξετε και να ρυθμίσετε τις παραμέτρους περισσότερες ασφαλείας πτυχές της υπηρεσίας. Το προεπιλεγμένο πρότυπο περιλαμβάνει τις επιλογές για να ρυθμίσετε τις παραμέτρους SSL, προγράμματος-πελάτη βασίζεται στο πιστοποιητικό ελέγχου ταυτότητας, κρυπτογράφησης για αποθηκευμένων διαπιστευτηρίων, DoS κιγκλιδώματα και περιορισμοί διευθύνσεων IP. Μπορείτε να βρείτε περισσότερες πληροφορίες σχετικά με την ασφάλεια πτυχών στο παρακάτω εγγράφου [Ρύθμιση παραμέτρων ασφαλείας διαιρεμένης συγχώνευσης](sql-database-elastic-scale-split-merge-security-configuration.md).

Η προεπιλεγμένη αναπτυχθεί υπηρεσία εκτελείται με μία εργασίας και ένα ρόλο web. Κάθε χρησιμοποιεί το μέγεθος Εικονική A1 στο Azure τις υπηρεσίες Cloud. Ενώ δεν μπορείτε να τροποποιήσετε αυτές τις ρυθμίσεις κατά την ανάπτυξη του πακέτου, θα μπορούσατε να τα αλλάξετε μετά από μια επιτυχημένη ανάπτυξη στην ενσωματωμένη υπηρεσία cloud, (μέσω της πύλης Azure). Σημειώστε ότι ο ρόλος εργασίας πρέπει να δεν είναι διαμορφωμένη για περισσότερες από μία παρουσία για τεχνικούς λόγους. 

**Ενοποίηση του χάρτη shard**

Η υπηρεσία διαίρεσης συγχώνευσης αλληλεπιδρά με το χάρτη shard της εφαρμογής. Όταν χρησιμοποιείτε την υπηρεσία διαίρεσης συγχώνευσης για τη διαίρεση ή συγχώνευση περιοχές ή για να μετακινήσετε shardlets μεταξύ shards, την υπηρεσία διατηρεί αυτόματα το χάρτη shard ενημερωμένα. Για να το κάνετε αυτό, η υπηρεσία συνδέεται με τη βάση δεδομένων διαχείρισης χάρτη shard της εφαρμογής και διατηρεί περιοχές και αντιστοιχίσεις ως αιτήσεων συγχώνευση/διαίρεση/μετακίνησης προόδου. Αυτό εξασφαλίζει ότι ο χάρτης shard παρουσιάζει πάντα μια ενημερωμένη προβολή όταν λειτουργίες διαίρεσης συγχώνευσης μετάβαση. Διαίρεση, λειτουργίες κίνηση συγχώνευση και shardlet υλοποιούνται, μετακινώντας μια δέσμη shardlets από το shard προέλευσης για να το shard προορισμού. Κατά τη διάρκεια του shardlet κίνησή λειτουργίας του shardlets υπόκεινται της τρέχουσας δέσμης επισημαίνονται ως χωρίς σύνδεση στο χάρτη shard και δεν είναι διαθέσιμες για δρομολόγηση συνδέσεις εξαρτώνται από δεδομένα χρησιμοποιώντας το **OpenConnectionForKey** API. 

**Συνδέσεις συνεπή shardlet**

Κατά την εκκίνηση κίνηση δεδομένων για μια νέα δέσμη shardlets, οποιαδήποτε δρομολόγησης συνδέσεις δεδομένων εξαρτώνται από shard-χάρτη που παρέχεται με το shard την αποθήκευση του shardlet είναι θανατωθέντων και οι επόμενες συνδέσεις από το χάρτη shard APIs με αυτές τις shardlets αποκλείονται ενώ η κυκλοφορία δεδομένων βρίσκεται σε εξέλιξη για να αποφύγετε ασυνέπειες. Συνδέσεις προς άλλες shardlets στην το ίδιο shard επίσης θα λάβετε θανατώθηκαν, αλλά θα επιτύχει ξανά αμέσως μετά την "Επανάληψη". Αφού μετακινηθεί της δέσμης, το shardlets επισημαίνονται online ξανά για το shard προορισμού και τα δεδομένα προέλευσης καταργείται από το shard προέλευσης. Η υπηρεσία, έχετε τα παρακάτω βήματα για κάθε δέσμη μέχρι να μετακινηθούν όλα shardlets. Αυτό θα οδηγήσει σε διάφορες λειτουργίες τερματισμού σύνδεσης κατά τη διάρκεια της λειτουργίας συγχώνευση/διαίρεση/μετακίνηση ολοκλήρωσης.  

**Διαχείριση shardlet διαθεσιμότητας**

Περιορισμός της σύνδεσης θανάτωση για την τρέχουσα δέσμη shardlets όπως περιγράφεται παραπάνω περιορίζει το εύρος της μη διαθεσιμότητα μία δέσμη shardlets κάθε φορά. Αυτό είναι προτιμώμενη μέσω προσέγγισης όπου την πλήρη shard θα παραμείνει εκτός σύνδεσης για όλα τα shardlets κατά τη διάρκεια μιας λειτουργίας διαίρεσης ή συγχώνευσης. Το μέγεθος του μια δέσμη, ορίζεται ως ο αριθμός των διακριτές shardlets για να μετακινήσετε τη φορά, είναι μια παράμετρος ρύθμισης παραμέτρων. Αυτό μπορεί να οριστεί για κάθε λειτουργία συγχώνευση και διαίρεση ανάλογα με τις ανάγκες διαθεσιμότητα και απόδοση της εφαρμογής. Σημειώστε ότι η περιοχή που κλειδώνεται στο χάρτη shard μπορεί να είναι μεγαλύτερο από το μέγεθος δέσμης που καθορίζεται. Αυτό συμβαίνει επειδή η υπηρεσία επιλέγει το μέγεθος της περιοχής τέτοια ώστε ο πραγματικός αριθμός των sharding κλειδιού τιμών στα δεδομένα κατά προσέγγιση αντιστοιχεί στο μέγεθος δέσμης. Αυτό είναι σημαντικό να θυμάστε ιδίως πλήκτρα sparsely συμπληρωμένη sharding. 

**Χώρος αποθήκευσης μετα-δεδομένων**

Η υπηρεσία διαίρεσης συγχώνευσης χρησιμοποιεί μια βάση δεδομένων για να διατηρήσετε την κατάστασή και να διατηρεί αρχεία καταγραφής κατά την επεξεργασία της αίτησης. Ο χρήστης δημιουργεί αυτήν τη βάση δεδομένων στην της συνδρομής και παρέχει τη συμβολοσειρά σύνδεσης για αυτό στο αρχείο ρύθμισης παραμέτρων για την ανάπτυξη της υπηρεσίας. Οι διαχειριστές από την εταιρεία του χρήστη επίσης να συνδεθείτε με αυτήν τη βάση δεδομένων για να δείτε την πρόοδο αίτηση και να εξετάσετε λεπτομερείς πληροφορίες σχετικά με τις πιθανές αποτυχίες.

**Αναγνώριση sharding**

Η υπηρεσία διαίρεσης συγχώνευσης κάνει διάκριση μεταξύ (1) sharded πίνακες, πίνακες αναφοράς (2) και (3) κανονική πίνακες. Η σημασιολογία μιας λειτουργίας συγχώνευση/διαίρεση/μετακίνηση εξαρτώνται από τον τύπο του πίνακα που χρησιμοποιείτε και ορίζεται ως εξής: 

* **Sharded πίνακες**: διαίρεση, συγχώνευση και μετακίνηση λειτουργίες μετακίνηση shardlets από προέλευση shard προορισμού. Μετά την επιτυχή ολοκλήρωση της αίτησης συνολική, αυτά τα shardlets δεν υπάρχουν πλέον στην προέλευση. Σημειώστε ότι οι πίνακες προορισμού πρέπει να υπάρχει σε shard του προορισμού και δεν πρέπει να περιέχει τα δεδομένα της περιοχής προορισμού πριν από την επεξεργασία της εργασίας. 

* **Αναφορά πίνακες**: για πίνακες αναφοράς, η διαίρεση, συγχώνευση και μετακίνηση λειτουργίες αντιγράψτε τα δεδομένα από την προέλευση του shard προορισμού. Ωστόσο, σημειώστε ότι δεν υπάρχουν αλλαγές προκύψει σε το shard προορισμού για ένα δεδομένο πίνακα εάν οποιαδήποτε γραμμή υπάρχει ήδη σε αυτόν τον πίνακα στον προορισμό. Ο πίνακας πρέπει να είναι κενά για κάθε λειτουργία Αντιγραφή πίνακα αναφοράς για να λάβετε υποβάλλονται σε επεξεργασία.

* **Πίνακες άλλο**: άλλους πίνακες μπορούν να βρίσκονται σε αρχείο προέλευσης ή προορισμού μιας λειτουργίας συγχώνευση και διαίρεση. Η υπηρεσία διαίρεσης συγχώνευσης παραβλέπει σε αυτούς τους πίνακες για τυχόν κίνηση δεδομένων ή λειτουργίες αντιγραφής. Ωστόσο, σημειώστε ότι αυτές μπορεί να παρεμποδίσει αυτές οι λειτουργίες σε περίπτωση τους περιορισμούς.

Οι πληροφορίες στην αναφορά έναντι sharded πίνακες παρέχεται από το **SchemaInfo** APIs στο χάρτη shard. Το παρακάτω παράδειγμα δείχνει τη χρήση των αυτά τα API σε μια δεδομένη shard χάρτη manager αντικείμενο smm: 

    // Create the schema annotations 
    SchemaInfo schemaInfo = new SchemaInfo(); 

    // Reference tables 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "region")); 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "nation")); 

    // Sharded tables 
    schemaInfo.Add(new ShardedTableInfo("dbo", "customer", "C_CUSTKEY")); 
    schemaInfo.Add(new ShardedTableInfo("dbo", "orders", "O_CUSTKEY")); 

    // Publish 
    smm.GetSchemaInfoCollection().Add(Configuration.ShardMapName, schemaInfo); 

Το πίνακες 'περιοχή' και 'εθνικό' ορίζονται ως αναφορά πίνακες και θα αντιγραφούν με τις λειτουργίες συγχώνευση/διαίρεση/μετακίνηση. «πελάτης» και 'Παραγγελίες' με τη σειρά ορίζονται ως sharded πίνακες. C_CUSTKEY και O_CUSTKEY χρησιμοποιηθεί ως το κλειδί sharding. 

**Ακεραιότητα αναφορών**

Η υπηρεσία διαίρεσης συγχώνευσης αναλύει εξαρτήσεις μεταξύ πινάκων και χρησιμοποιεί και πρωτεύοντα οι σχέσεις εξωτερικού κλειδιού για τις λειτουργίες για τη μετακίνηση αναφοράς πίνακες και shardlets του σταδίου. Σε γενικές γραμμές, πίνακες αναφορά αντιγράφονται πρώτα με τη σειρά εξάρτηση, στη συνέχεια, shardlets αντιγράφονται με τη σειρά τους εξαρτήσεις μέσα σε κάθε δέσμη. Αυτό είναι απαραίτητο, ώστε να FK PK περιορισμούς του shard προορισμού είναι η πραγματοποίηση κατά την άφιξη του τα νέα δεδομένα. 

**Shard χάρτη συνέπειας και ενδεχόμενες ολοκλήρωσης**

Παρουσία αποτυχίες, η υπηρεσία διαίρεσης συγχώνευσης ισχύει λειτουργίες μετά από κάθε διακοπή ρεύματος και στόχος ολοκλήρωσης σε προσκλήσεις σε εξέλιξη. Ωστόσο, μπορεί να υπάρχουν ανακτηθούν περιπτώσεις, π.χ., όταν το shard προορισμού χαθεί ή έχει παραβιαστεί επιδιορθωθεί. Σε αυτές τις περιπτώσεις, ορισμένες shardlets που έχουν πρέπει να μετακινηθούν μπορεί να συνεχίσει να βρίσκονται στην το shard προέλευσης. Η υπηρεσία εξασφαλίζει ότι οι αντιστοιχίσεις shardlet ενημερώνονται μόνο αφού τα απαραίτητα δεδομένα έχουν αντιγραφεί με επιτυχία στον προορισμό. Shardlets διαγράφονται μόνο στην προέλευση όταν όλα τα δεδομένα έχουν αντιγραφεί στον προορισμό και οι αντίστοιχες αντιστοιχίσεις έχουν ενημερωθεί με επιτυχία. Η λειτουργία διαγραφής συμβαίνει στο παρασκήνιο ενώ η περιοχή είναι ήδη online σε το shard προορισμού. Η υπηρεσία διαίρεσης συγχώνευσης εξασφαλίζει πάντα ακρίβειας από τις αντιστοιχίσεις που είναι αποθηκευμένα στο χάρτη shard.


## <a name="the-split-merge-user-interface"></a>Το περιβάλλον εργασίας χρήστη διαίρεσης συγχώνευσης

Το πακέτο διαίρεσης συγχώνευσης υπηρεσίας περιλαμβάνει ένα ρόλο εργασίας και ένα ρόλο web. Ο ρόλος web χρησιμοποιείται για να υποβάλετε αιτήσεις διαίρεσης συγχώνευσης με ένα αλληλεπιδραστικό τρόπο. Τα κύρια στοιχεία του περιβάλλοντος εργασίας χρήστη είναι οι εξής:

-    Τύπος λειτουργίας: Ο τύπος λειτουργίας είναι ένα κουμπί επιλογής που ελέγχει το είδος της εργασίας που έχει εκτελεστεί από την υπηρεσία για αυτήν την αίτηση. Μπορείτε να επιλέξετε μεταξύ της διαίρεσης και συγχώνευση και μετακίνηση σενάρια. Μπορείτε επίσης να ακυρώσετε μια λειτουργία που έχει υποβληθεί προηγουμένως. Μπορείτε να χρησιμοποιήσετε διαίρεση, να συγχωνεύσετε και να μετακίνηση αιτήσεων για περιοχή shard χάρτες. Λίστα shard χαρτών μόνο λειτουργίες μετακίνηση υποστήριξης.

-    Χάρτης shard: Στην επόμενη ενότητα των παραμέτρων αίτηση καλύπτει πληροφορίες σχετικά με το χάρτη shard και τη βάση δεδομένων φιλοξενίας χάρτη σας shard. Συγκεκριμένα, πρέπει να παρέχετε το όνομα του διακομιστή βάσης δεδομένων SQL Azure και βάση δεδομένων που φιλοξενεί το shardmap, τα διαπιστευτήρια για να συνδεθείτε με τη βάση δεδομένων χάρτη shard και τέλος το όνομα του χάρτη shard. Προς το παρόν, η λειτουργία δέχεται μόνο ένα σύνολο διαπιστευτηρίων. Αυτά τα διαπιστευτήρια πρέπει να έχετε επαρκή δικαιώματα για να πραγματοποιήσετε αλλαγές στο χάρτη shard καθώς και ως προς τα δεδομένα χρήστη σε το shards.

-    Περιοχή προέλευσης (διαίρεση και συγχώνευση): μια λειτουργία συγχώνευση και διαίρεση επεξεργάζεται μια περιοχή χρησιμοποιώντας το κλειδί κατώτερη και την ανώτερη. Για να καθορίσετε μια λειτουργία με μια μη δεσμευμένες υψηλή τιμή κλειδιού, επιλέξτε το πλαίσιο ελέγχου "Υψηλή κλειδί είναι μέγιστος αριθμός" και αφήστε κενό πεδίο υψηλή κλειδιού. Οι τιμές κλειδιού περιοχής που καθορίζετε δεν χρειάζεται να ταιριάξετε με ακρίβεια αντιστοίχισης και τα όρια στο χάρτη σας shard. Εάν δεν καθορίσετε οποιαδήποτε όρια περιοχή καθόλου την υπηρεσία θα υπολογίσει την πλησιέστερη περιοχή για εσάς αυτόματα. Μπορείτε να χρησιμοποιήσετε τη δέσμη ενεργειών GetMappings.ps1 PowerShell για να ανακτήσετε την τρέχουσα αντιστοιχίσεις σε μια δεδομένη shard αντιστοίχιση.

-    Συμπεριφορά προέλευσης διαίρεσης (διαίρεση): για λειτουργίες διαίρεσης, ορίστε το σημείο για να διαιρέσετε της περιοχής προέλευσης. Μπορείτε να το κάνετε αυτό, παρέχοντας τον αριθμό-κλειδί sharding όπου θέλετε να εκτελεστεί η διαίρεση. Χρησιμοποιήστε το κουμπί επιλογής, καθορίστε εάν θέλετε το κάτω μέρος της περιοχής (εκτός από τον αριθμό-κλειδί διαίρεσης) για να μετακινήσετε, ή εάν θέλετε το επάνω τμήμα για να μετακινήσετε (συμπεριλαμβανομένου του πλήκτρου διαίρεσης).

-    Προέλευση Shardlet (Μετακίνηση): μετακίνηση λειτουργίες είναι διαφορετικό από διαίρεση ή συγχώνευση λειτουργίες εφόσον δεν απαιτούν μια περιοχή για να περιγράψετε την προέλευση. Ένα αρχείο προέλευσης για μετακίνηση απλώς προσδιορίζεται από την τιμή του κλειδιού sharding που σκοπεύετε να μετακινήσετε.

-    Στοχεύστε Shard (διαίρεση): Αφού έχετε δώσει τις πληροφορίες στην προέλευση της λειτουργίας διαίρεσης, πρέπει να καθορίσετε πού θέλετε τα δεδομένα να αντιγραφούν, παρέχοντας το όνομα διακομιστή και βάσης δεδομένων SQL Azure Db για τον προορισμό.

-    Περιοχή προορισμού (συγχωνεύσετε): λειτουργίες συγχώνευσης μετακίνηση shardlets μια υπάρχουσα shard. Προσδιορίστε την υπάρχουσα shard, παρέχοντας τα όρια περιοχή της υπάρχουσας περιοχής που θέλετε να γίνει συγχώνευση με.

-    Μέγεθος δέσμης: Το μέγεθος δέσμης ελέγχει τον αριθμό των shardlets που θα χωρίς σύνδεση κάθε φορά κατά τη διάρκεια της κυκλοφορίας δεδομένων. Αυτή είναι μια ακέραια τιμή όπου μπορείτε να χρησιμοποιήσετε μικρότερες τιμές όταν είστε διάκριση πεζών-κεφαλαίων μεγάλη περιόδων από τη διακοπή λειτουργίας για shardlets. Μεγαλύτερες τιμές, θα αυξήσετε το χρόνο που είναι μια δεδομένη shardlet αλλά χωρίς σύνδεση ενδέχεται να βελτιώσετε τις επιδόσεις.

-    Αναγνωριστικό λειτουργίας (ακύρωση): Εάν έχετε μια λειτουργία βρίσκεται σε εξέλιξη που δεν είναι πλέον απαραίτητη, μπορείτε να ακυρώσετε τη λειτουργία, παρέχοντας το Αναγνωριστικό λειτουργίας σε αυτό το πεδίο. Μπορείτε να ανακτήσετε το Αναγνωριστικό λειτουργίας από τον πίνακα αίτηση κατάστασης (ανατρέξτε στην ενότητα 8.1) ή από το αποτέλεσμα στο πρόγραμμα περιήγησης web όπου έχετε υποβάλει την αίτηση.


## <a name="requirements-and-limitations"></a>Απαιτήσεις και περιορισμοί 

Η τρέχουσα εφαρμογή της υπηρεσίας διαίρεσης συγχώνευσης είναι υπόκεινται στα παρακάτω απαιτήσεις και περιορισμούς: 

* Το shards πρέπει να υπάρχει και έχει εγγραφεί στο χάρτη shard πριν εκτελεστεί μια λειτουργία διαίρεσης συγχώνευσης σε αυτές τις shards. 

* Η υπηρεσία δεν δημιουργεί πίνακες ή άλλα αντικείμενα βάσης δεδομένων αυτόματα ως μέρος των δραστηριοτήτων του. Αυτό σημαίνει ότι το σχήμα για όλους sharded πινάκων και των πινάκων αναφοράς πρέπει να υπάρχει σε το shard προορισμού πριν από κάθε λειτουργία συγχώνευση/διαίρεση/μετακίνηση. Sharded πίνακες ιδίως απαιτείται να είναι κενή της περιοχής όπου είναι νέο shardlets θα προστεθούν από μια λειτουργία συγχώνευση/διαίρεση/μετακίνηση. Διαφορετικά, η λειτουργία θα αποτύχει ο έλεγχος συνέπειας αρχικό στο το shard προορισμού. Επίσης, σημειώστε αυτήν την αναφορά δεδομένων αντιγράφεται μόνο αν η αναφορά πίνακας είναι κενός και ότι δεν υπάρχουν συνέπειας εγγυήσεις σχετικά με άλλες ταυτόχρονης λειτουργίες εγγραφής σε πίνακες αναφοράς. Συνιστάται να αυτό: κατά την εκτέλεση λειτουργιών συγχώνευση/διαίρεση, χωρίς άλλες λειτουργίες εγγραφής αλλαγές στους πίνακες αναφοράς.

* Η υπηρεσία που βασίζεται σε γραμμή ταυτότητας που έχει δημιουργηθεί από ένα μοναδικό ευρετήριο ή το κλειδί που περιλαμβάνει το κλειδί sharding για να βελτιώσετε τις επιδόσεις και την αξιοπιστία για μεγάλο shardlets. Αυτό σας επιτρέπει την υπηρεσία για τη μετακίνηση δεδομένων σε ένα ακόμα καλύτερο υποδιαίρεση από απλώς sharding η τιμή του κλειδιού. Αυτό σας βοηθά να μειώσετε τη μέγιστη ποσότητα χώρου καταγραφής και κλειδωμάτων που απαιτούνται κατά τη λειτουργία. Μπορείτε να δημιουργήσετε ένα μοναδικό ευρετήριο ή ένα πρωτεύον κλειδί, συμπεριλαμβανομένου του πλήκτρου sharding σε έναν δεδομένο πίνακα, εάν θέλετε να χρησιμοποιήσετε αυτόν τον πίνακα με αιτήσεων συγχώνευση/διαίρεση/μετακίνησης. Για λόγους απόδοσης, το πλήκτρο sharding πρέπει να είναι το αρχικό στήλης σε τον αριθμό-κλειδί ή το ευρετήριο.

* Κατά τη διάρκεια της επεξεργασίας αίτησης, ενδέχεται να παρουσιάσετε τόσο την προέλευση και το shard προορισμού ορισμένα δεδομένα shardlet. Αυτό είναι απαραίτητο για την προστασία από αποτυχίες κατά τη διάρκεια της κυκλοφορίας shardlet. Ενσωμάτωση της διαίρεσης-συγχώνευση με το χάρτη shard εξασφαλίζει ότι συνδέσεις στα δεδομένα εξαρτώμενα δρομολόγηση APIs χρησιμοποιώντας τη μέθοδο **OpenConnectionForKey** στο χάρτη shard δεν εμφανίζονται οποιαδήποτε χωρίς συνέπεια ενδιάμεσου μέλη. Ωστόσο, κατά τη σύνδεση με το αρχείο προέλευσης ή την shards προορισμού χωρίς τη χρήση της μεθόδου **OpenConnectionForKey** , χωρίς συνέπεια ενδιάμεσου Πολιτείες μπορεί να είναι ορατό όταν αιτήσεων συγχώνευση/διαίρεση/μετακίνησης μετάβαση. Αυτές τις συνδέσεις ενδέχεται να εμφανίζει μερική ή των διπλότυπων αποτελέσματα, ανάλογα με την ώρα ή το shard υποκείμενων τη σύνδεση. Ο περιορισμός αυτός περιλαμβάνει αυτήν τη στιγμή τις συνδέσεις που πραγματοποιήθηκαν από πολλών Shard ελαστικά κλίμακα-ερωτήματα.

* Δεν πρέπει να είναι κοινόχρηστη τη βάση δεδομένων μετα-δεδομένων για την υπηρεσία διαίρεσης συγχώνευσης μεταξύ διαφορετικούς ρόλους. Για παράδειγμα, ένα ρόλο της υπηρεσίας συγχώνευσης διαίρεση εκτελείται στο ενδιάμεσου σταδίου πρέπει να αναφέρεται σε μια βάση δεδομένων διαφορετική μετα-δεδομένα από το ρόλο παραγωγής.
 

## <a name="billing"></a>Χρέωση 

Η υπηρεσία διαίρεσης συγχώνευσης εκτελείται ως υπηρεσία cloud στη συνδρομή σας στο Microsoft Azure. Επομένως, ισχύουν χρεώσεις για τις υπηρεσίες cloud για να την παρουσία της υπηρεσίας. Εκτός εάν εκτελείτε συχνά συγχώνευση/διαίρεση/μετακίνηση λειτουργίες, σας συνιστούμε να μπορείτε να διαγράψετε την υπηρεσία cloud διαίρεσης συγχώνευσης. Που αποθηκεύει κόστους για εκτέλεση ή αναπτυχθεί παρουσιών της υπηρεσίας cloud. Μπορείτε να αναπτύξετε ξανά και να ξεκινήσετε άμεσα εκτελέσιμες ρύθμιση παραμέτρων σας κάθε φορά που πρέπει να εκτελέσετε λειτουργίες διαίρεση ή συγχώνευση. 
 
## <a name="monitoring"></a>Παρακολούθηση 
### <a name="status-tables"></a>Κατάσταση πίνακες 

Η υπηρεσία διαίρεσης συγχώνευσης παρέχει τον πίνακα **RequestStatus** στο τα μετα-δεδομένα Αποθήκευση βάσης δεδομένων για την παρακολούθηση των αιτήσεων ολοκληρωμένες και βρίσκεται σε εξέλιξη. Ο πίνακας παραθέτει μια γραμμή για κάθε αίτηση διαίρεσης συγχώνευσης που έχει υποβληθεί σε αυτήν την παρουσία της υπηρεσίας διαίρεσης συγχώνευσης. Παρέχει τις ακόλουθες πληροφορίες για κάθε αίτηση:

* **Χρονική σήμανση**: την ώρα και την ημερομηνία έναρξης της αίτησης.

* **OperationId**: GUID που προσδιορίζει με μοναδικό τρόπο την αίτηση. Αυτή η αίτηση επίσης μπορεί να χρησιμοποιηθεί για να ακυρώσετε τη λειτουργία, ενώ είναι εξακολουθεί να βρίσκεται σε εξέλιξη.

* **Κατάσταση**: την τρέχουσα κατάσταση της αίτησης. Για τις αιτήσεις βρίσκεται σε εξέλιξη, παραθέτει επίσης η τρέχουσα φάση στην οποία βρίσκεται στην πρόσκληση.

* **CancelRequest**: μια σημαία που υποδεικνύει εάν η αίτηση έχει ακυρωθεί.

* **Πρόοδος**: μια εκτίμηση ποσοστού ολοκλήρωσης για τη λειτουργία. Μια τιμή 50 υποδεικνύει ότι η λειτουργία είναι περίπου 50% ολοκλήρωσης.

* **Λεπτομέρειες**: τιμή XML που παρέχει μια πιο λεπτομερή αναφορά προόδου. Αναφορά προόδου ενημερώνεται περιοδικά όπως σύνολα γραμμών αντιγράφονται από προέλευση προορισμού. Σε περίπτωση αποτυχίες ή εξαιρέσεις, η στήλη αυτή περιλαμβάνει επίσης πιο λεπτομερείς πληροφορίες σχετικά με την αποτυχία.


### <a name="azure-diagnostics"></a>Διαγνωστικά του Azure

Η υπηρεσία διαίρεσης συγχώνευσης χρησιμοποιεί Διαγνωστικά Azure που βασίζονται σε 2,5 SDK Azure για την παρακολούθηση και διαγνωστικά. Μπορείτε να ελέγχετε τα Διαγνωστικά ρύθμισης παραμέτρων όπως εξηγείται εδώ: [Ενεργοποίηση Διαγνωστικά στις υπηρεσίες Cloud Azure και εικονικές μηχανές](../cloud-services/cloud-services-dotnet-diagnostics.md). Η λήψη του πακέτου περιλαμβάνει δύο ρυθμίσεις παραμέτρων Διαγνωστικά – μία για το ρόλο web και μία για το ρόλο εργασίας. Αυτές οι ρυθμίσεις παραμέτρων διαγνωστικών για την υπηρεσία, ακολουθήστε τις οδηγίες από [Τα θεμελιώδη στοιχεία υπηρεσία Cloud στο Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649). Περιλαμβάνει τους ορισμούς για να συνδεθείτε μετρητές επιδόσεων, αρχεία καταγραφής των υπηρεσιών IIS, αρχεία καταγραφής συμβάντων των Windows και αρχεία καταγραφής συμβάντων εφαρμογής διαίρεσης συγχώνευσης. 

## <a name="deploy-diagnostics"></a>Ανάπτυξη Διαγνωστικά 

Για να ενεργοποιήσετε την παρακολούθηση και τα Διαγνωστικά χρησιμοποιώντας τη ρύθμιση παραμέτρων διαγνωστικών για το web και εργαζόμενου τους ρόλους που παρέχεται από το πακέτο NuGet, εκτελέστε τις ακόλουθες εντολές χρησιμοποιώντας το Azure PowerShell: 

    $storage_name = "<YourAzureStorageAccount>" 
    
    $key = "<YourAzureStorageAccountKey" 
    
    $storageContext = New-AzureStorageContext -StorageAccountName $storage_name -StorageAccountKey $key  
    
    
    $config_path = "<YourFilePath>\SplitMergeWebContent.diagnostics.xml" 
    
    $service_name = "<YourCloudServiceName>" 
    
    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWeb" 
    
    
    $config_path = "<YourFilePath>\SplitMergeWorkerContent.diagnostics.xml" 
    
    $service_name = "<YourCloudServiceName>" 
    
    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWorker" 

Μπορείτε να βρείτε περισσότερες πληροφορίες σχετικά με τον τρόπο ρύθμισης παραμέτρων και ανάπτυξη των ρυθμίσεων των διαγνωστικών του εδώ: [Ενεργοποίηση Διαγνωστικά στις υπηρεσίες Cloud Azure και εικονικές μηχανές](../cloud-services/cloud-services-dotnet-diagnostics.md). 

## <a name="retrieve-diagnostics"></a>Ανάκτηση Διαγνωστικά 

Μπορείτε εύκολα να αποκτήσετε πρόσβαση σας Διαγνωστικά από την οπτική Εξερεύνηση διακομιστή Studio στο τμήμα Azure του δέντρου Εξερεύνηση Server. Ανοίξτε μια περίοδο λειτουργίας του Visual Studio και στη γραμμή μενού, κάντε κλικ στην επιλογή Προβολή και Εξερεύνηση Server. Κάντε κλικ στο εικονίδιο του Azure για να συνδεθείτε με τη συνδρομή σας στο Azure. Στη συνέχεια, μεταβείτε Azure -> χώρος αποθήκευσης -> <your storage account> -> πίνακες -> WADLogsTable. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Περιήγηση πόρων αποθήκευσης με την Εξερεύνηση διακομιστή](http://msdn.microsoft.com/library/azure/ff683677.aspx). 

![WADLogsTable][2]

Η επισήμανση στην παραπάνω εικόνα WADLogsTable περιέχει τα λεπτομερή συμβάντα από το αρχείο καταγραφής της εφαρμογής της υπηρεσίας διαίρεσης συγχώνευσης. Σημειώστε ότι η προεπιλεγμένη ρύθμιση παραμέτρων του πακέτου ληφθέντων αυτή απευθύνεται σε μια ανάπτυξη παραγωγής. Επομένως το χρονικό διάστημα στο οποίο τα αρχεία καταγραφής και μετρητές λαμβάνονται από το παρουσιών της υπηρεσίας είναι μεγάλο (5 λεπτά). Για τη δοκιμή και ανάπτυξη, μειώστε το χρονικό διάστημα, ρυθμίζοντας τις παραμέτρους Διαγνωστικά του web ή το ρόλο εργασίας για τις ανάγκες σας. Κάντε δεξί κλικ στη ο ρόλος στο Visual Studio Εξερεύνηση του Server (δείτε παραπάνω) και, στη συνέχεια, προσαρμόστε την περίοδο μεταφοράς στο παράθυρο διαλόγου για τις ρυθμίσεις παραμέτρων διαγνωστικών: 

![Ρύθμιση παραμέτρων][3]


## <a name="performance"></a>Επιδόσεων

Σε γενικές γραμμές, καλύτερη απόδοση είναι η αναμενόμενη από όσο υψηλότερη, περισσότερες performant επίπεδα υπηρεσίας σε βάση δεδομένων SQL Azure. Υψηλότερη εκχωρήσεων εισόδου/ΕΞΌΔΟΥ, CPU και μνήμης για την υψηλότερη επίπεδα υπηρεσίας επωφεληθείτε το αντίγραφο μαζικής και διαγράψτε λειτουργίες που χρησιμοποιεί η υπηρεσία διαίρεσης συγχώνευσης. Για αυτόν το λόγο, αυξήστε το επίπεδο υπηρεσιών μόνο για αυτές τις βάσεις δεδομένων για ένα καθορισμένο, περιορισμένο χρονικό διάστημα.

Η υπηρεσία εκτελεί επίσης επικύρωσης ερωτήματα ως μέρος της τις συνήθεις εργασίες. Αυτά τα ερωτήματα επικύρωσης έλεγχος για μη αναμενόμενο παρουσία των δεδομένων στην περιοχή προορισμού και βεβαιωθείτε ότι κάθε λειτουργία συγχώνευση/διαίρεση/μετακίνηση ξεκινά από μια σταθερή κατάσταση. Αυτά τα ερωτήματα όλα λειτουργούν μέσω sharding βασικές περιοχές που ορίζονται από το εύρος της λειτουργίας και το μέγεθος δέσμης που παρέχεται ως τμήμα του ορισμού της αίτησης. Αυτά τα ερωτήματα εκτέλεση καλύτερα κατά την παρουσίαση που περιέχει τον αριθμό-κλειδί sharding ως στήλη στην αρχή είναι ένα ευρετήριο. 

Επιπλέον, μια ιδιότητα τη μοναδικότητα με τον αριθμό-κλειδί sharding ως στήλη στην αρχή επιτρέπει την υπηρεσία για να χρησιμοποιήσετε μια βελτιστοποιημένη προσέγγιση που περιορίζει κατανάλωση πόρων όσον αφορά τα χώρος καταγραφής και μνήμης. Αυτή η ιδιότητα μοναδικότητας είναι απαραίτητη για να μετακινήσετε τα μεγέθη μεγάλου όγκου δεδομένων (συνήθως πάνω από 1GB). 

## <a name="how-to-upgrade"></a>Πώς μπορείτε να κάνετε αναβάθμιση

1. Ακολουθήστε τα βήματα στο θέμα [ανάπτυξη μιας υπηρεσίας διαίρεσης συγχώνευσης](sql-database-elastic-scale-configure-deploy-split-and-merge.md).
2. Αλλάξτε το αρχείο ρύθμισης παραμέτρων υπηρεσίας cloud για την ανάπτυξη διαίρεσης συγχώνευσης για να απεικονίσει τη νέα ρύθμιση παραμέτρων. Μια νέα απαιτούμενη παράμετρος είναι οι πληροφορίες σχετικά με το πιστοποιητικό που χρησιμοποιείται για την κρυπτογράφηση. Ένας εύκολος τρόπος για να το κάνετε αυτό είναι να συγκρίνετε το νέο αρχείο προτύπου ρύθμισης παραμέτρων από τη λήψη σύμφωνα με τις υπάρχουσες παραμέτρους. Βεβαιωθείτε ότι μπορείτε να προσθέσετε τις ρυθμίσεις για "DataEncryptionPrimaryCertificateThumbprint" και "DataEncryptionPrimary" για το web και το ρόλο εργασίας.
3. Πριν αναπτύξετε την ενημέρωση για Azure, βεβαιωθείτε ότι έχετε ολοκληρώσει όλες οι λειτουργίες συγχώνευσης διαίρεσης εκτελούνται τη συγκεκριμένη στιγμή. Μπορείτε εύκολα να το κάνετε κατά την υποβολή ερωτημάτων τους πίνακες RequestStatus και PendingWorkflows στη βάση δεδομένων διαιρεμένης συγχώνευσης μετα-δεδομένων για αιτήσεις βρίσκεται σε εξέλιξη.
4. Ενημέρωση του υπάρχοντος cloud υπηρεσίας για ανάπτυξη διαίρεσης συγχώνευσης στο Azure τη συνδρομή σας με το νέο πακέτο και το αρχείο ρύθμισης παραμέτρων ενημερωμένων υπηρεσίας.

Δεν χρειάζεται να παρέχετε μια νέα βάση δεδομένων μετα-δεδομένων για διαίρεση-συγχώνευση αναβάθμισης. Η νέα έκδοση θα γίνεται αυτόματα αναβάθμιση την υπάρχουσα βάση δεδομένων μετα-δεδομένων για τη νέα έκδοση. 

## <a name="best-practices--troubleshooting"></a>Βέλτιστες πρακτικές και αντιμετώπιση προβλημάτων
 
-    Ορισμός μισθωτή δοκιμής και άσκηση σας πιο σημαντικές λειτουργίες συγχώνευση/διαίρεση/μετακίνηση με το μισθωτή έλεγχο σε διάφορες shards. Βεβαιωθείτε ότι όλα μετα-δεδομένων έχει οριστεί σωστά στο χάρτη σας shard και ότι δεν παραβιάζει τις λειτουργίες περιορισμοί ή ξένα κλειδιά.
-    Διατήρηση του μισθωτή δοκιμής θέματα που σχετίζονται με μέγεθος δεδομένων επάνω από το μέγεθος του μέγιστου δεδομένων από το μεγαλύτερο μισθωτή για να βεβαιωθείτε ότι δεν αντιμετωπίζετε μέγεθος δεδομένων. Αυτό σας βοηθά να εκτιμήσετε ένα ανώτατο όριο το χρόνο που χρειάζεται για να μετακινήσετε ένα μεμονωμένο μισθωτή. 
-    Βεβαιωθείτε ότι το σχήμα επιτρέπει διαγραφές. Η υπηρεσία διαίρεσης συγχώνευσης απαιτεί τη δυνατότητα να καταργήσετε δεδομένα από την προέλευση shard όταν τα δεδομένα έχουν αντιγραφεί με επιτυχία στον προορισμό. Για παράδειγμα, η **Διαγραφή εναυσμάτων** να αποτρέψετε τη διαγραφή των δεδομένων στην προέλευση της υπηρεσίας και μπορεί να προκαλέσει λειτουργίες αποτυχία.
-    Το κλειδί sharding πρέπει να είναι στήλη αρχικά στο πρωτεύον κλειδί ή ορισμού μοναδικό ευρετήριο. Που εξασφαλίζει την καλύτερη απόδοση για τα ερωτήματα επικύρωσης διαίρεση ή συγχώνευση και για τις εργασίες κίνησή και διαγραφή πραγματικών δεδομένων που χρησιμοποιούν πάντα sharding βασικές περιοχές.
-    Collocate την υπηρεσία διαίρεσης συγχώνευσης στο κέντρο περιοχής και δεδομένων όπου βρίσκονται τις βάσεις δεδομένων. 

[AZURE.INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]



<!--Anchors-->
<!--Image references-->
[1]:./media/sql-database-elastic-scale-overview-split-and-merge/split-merge-overview.png
[2]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics.png
[3]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics-config.png
 
