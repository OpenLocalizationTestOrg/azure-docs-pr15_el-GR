<properties
    pageTitle="Αναφορά σε ολόκληρη την κλιμάκωση ανάληψης cloud βάσεις δεδομένων | Microsoft Azure"
    description="πώς μπορείτε να ρυθμίσετε ελαστικότητας ερωτήματα επάνω από τα διαμερίσματα οριζόντια"    
    services="sql-database"
    documentationCenter=""  
    manager="jhubbard"
    authors="torsteng"/>

<tags
    ms.service="sql-database"
    ms.workload="sql-database"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="05/27/2016"
    ms.author="torsteng" />

# <a name="reporting-across-scaled-out-cloud-databases-preview"></a>Αναφορά σε ολόκληρη την κλιμάκωση ανάληψης cloud βάσεων δεδομένων (έκδοση preview)

![Υποβολή ερωτήματος σε shards][1]

Sharded βάσεις δεδομένων κατανομή γραμμών σε μια κλίμακα ανάληψη δεδομένων επίπεδο. Το σχήμα είναι ίδιες σε όλες τις συμμετέχοντα βάσεις δεδομένων, γνωστό και ως οριζόντια διαμερισμάτων. Χρήση ενός ερωτήματος ελαστικά, μπορείτε να δημιουργήσετε αναφορές που εκτείνονται σε όλες τις βάσεις δεδομένων σε μια βάση δεδομένων sharded.

Για μια γρήγορη εκκίνηση, ανατρέξτε στο θέμα [αναφορά σε βάσεις δεδομένων κλιμάκωση ανάληψης cloud](sql-database-elastic-query-getting-started.md).

Για μη sharded βάσεις δεδομένων, ανατρέξτε στο θέμα [ερωτήματος σε βάσεις δεδομένων cloud με διαφορετικά σχήματα](sql-database-elastic-query-vertical-partitioning.md). 

 
## <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

* Δημιουργία χάρτη shard χρήση της βιβλιοθήκης ελαστικότητας βάση δεδομένων προγράμματος-πελάτη. ανατρέξτε στο θέμα [Χάρτης διαχείρισης Shard](sql-database-elastic-scale-shard-map-management.md). Ή χρησιμοποιήστε την εφαρμογή δείγμα [γρήγορα](sql-database-elastic-scale-get-started.md)αποτελέσματα με το εργαλεία ελαστικότητας βάσης δεδομένων.
* Εναλλακτικά, ανατρέξτε στο θέμα [μετεγκατάσταση υπάρχουσες βάσεις δεδομένων σε βάσεις δεδομένων κλιμάκωση ελέγχου](sql-database-elastic-convert-to-use-elastic-tools.md).
* Ο χρήστης πρέπει να διαθέτει δικαιώματα ΤΡΟΠΟΠΟΙΉΣΟΥΝ ΟΠΟΙΑΔΉΠΟΤΕ ΕΞΩΤΕΡΙΚΌ αρχείο ΠΡΟΈΛΕΥΣΗΣ ΔΕΔΟΜΈΝΩΝ. Αυτό το δικαίωμα περιλαμβάνεται με το δικαίωμα "ΤΡΟΠΟΠΟΊΗΣΗ βάσης ΔΕΔΟΜΈΝΩΝ".
* Απαιτούνται δικαιώματα ΤΡΟΠΟΠΟΙΉΣΟΥΝ ΟΠΟΙΑΔΉΠΟΤΕ ΕΞΩΤΕΡΙΚΌ αρχείο ΠΡΟΈΛΕΥΣΗΣ ΔΕΔΟΜΈΝΩΝ για να ανατρέξετε στην υποκείμενη προέλευση δεδομένων.

## <a name="overview"></a>Επισκόπηση

Αυτές τις προτάσεις δημιουργία η απεικόνιση μετα-δεδομένων με το επίπεδο sharded δεδομένων στη βάση δεδομένων ελαστικότητας ερωτήματος. 


1. [ΔΗΜΙΟΥΡΓΊΑ ΠΡΩΤΕΎΟΝΤΟΣ ΚΛΕΙΔΙΟΎ](https://msdn.microsoft.com/library/ms174382.aspx)
2. [ΔΗΜΙΟΥΡΓΊΑ ΒΆΣΗΣ ΔΕΔΟΜΈΝΩΝ ΣΤΗΝ ΕΜΒΈΛΕΙΑ ΔΙΑΠΙΣΤΕΥΤΗΡΊΩΝ](https://msdn.microsoft.com/library/mt270260.aspx)
3. [ΔΗΜΙΟΥΡΓΊΑ ΕΞΩΤΕΡΙΚΉΣ ΠΡΟΈΛΕΥΣΗΣ ΔΕΔΟΜΈΝΩΝ](https://msdn.microsoft.com/library/dn935022.aspx)
4. [ΔΗΜΙΟΥΡΓΊΑ ΕΞΩΤΕΡΙΚΌΣ ΠΊΝΑΚΑΣ](https://msdn.microsoft.com/library/dn935021.aspx) 

## <a name="11-create-database-scoped-master-key-and-credentials"></a>Δημιουργία βάσης δεδομένων 1.1 εύρος πρωτεύον κλειδί και τα διαπιστευτήρια 

Τα διαπιστευτήρια που χρησιμοποιείται από το ελαστικότητας ερώτημα για να συνδεθείτε με τον απομακρυσμένο βάσεις δεδομένων.  

    CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'password';
    CREATE DATABASE SCOPED CREDENTIAL <credential_name>  WITH IDENTITY = '<username>',  
    SECRET = '<password>'
    [;]
 
>[AZURE.NOTE] Βεβαιωθείτε ότι το *"\<username\>"* δεν περιλαμβάνει οποιονδήποτε *"@servername"* επίθημα. 

## <a name="12-create-external-data-sources"></a>1.2 Δημιουργία εξωτερικών προελεύσεων δεδομένων

Σύνταξη:

    <External_Data_Source> ::=    
    CREATE EXTERNAL DATA SOURCE <data_source_name> WITH                                            
            (TYPE = SHARD_MAP_MANAGER,
                    LOCATION = '<fully_qualified_server_name>',
            DATABASE_NAME = ‘<shardmap_database_name>',
            CREDENTIAL = <credential_name>, 
            SHARD_MAP_NAME = ‘<shardmapname>’ 
                   ) [;] 

### <a name="example"></a>Παράδειγμα 

    CREATE EXTERNAL DATA SOURCE MyExtSrc 
    WITH 
    ( 
        TYPE=SHARD_MAP_MANAGER,
        LOCATION='myserver.database.windows.net', 
        DATABASE_NAME='ShardMapDatabase', 
        CREDENTIAL= SMMUser, 
        SHARD_MAP_NAME='ShardMap' 
    );
 
Ανάκτηση της λίστας των τρέχουσα εξωτερικές προελεύσεις δεδομένων: 

    select * from sys.external_data_sources; 

Εξωτερική προέλευση δεδομένων αναφέρεται σε χάρτη σας shard. Ένα ερώτημα ελαστικότητας χρησιμοποιεί, στη συνέχεια, στην εξωτερική προέλευση δεδομένων και το υποκείμενο χάρτη shard απαρίθμηση τις βάσεις δεδομένων που συμμετέχουν στο επίπεδο δεδομένων. Τα ίδια διαπιστευτήρια που χρησιμοποιούνται για να διαβάσετε το χάρτη shard και για να πραγματοποιήσετε πρόσβαση στα δεδομένα του shards κατά την επεξεργασία ενός ερωτήματος ελαστικότητας. 

## <a name="13-create-external-tables"></a>1.3 Δημιουργία εξωτερικών πινάκων 
 
Σύνταξη:  

    CREATE EXTERNAL TABLE [ database_name . [ schema_name ] . | schema_name. ] table_name  
        ( { <column_definition> } [ ,...n ])     
        { WITH ( <sharded_external_table_options> ) }
    ) [;]  
    
    <sharded_external_table_options> ::= 
      DATA_SOURCE = <External_Data_Source>,       
      [ SCHEMA_NAME = N'nonescaped_schema_name',] 
      [ OBJECT_NAME = N'nonescaped_object_name',] 
      DISTRIBUTION = SHARDED(<sharding_column_name>) | REPLICATED |ROUND_ROBIN

**Παράδειγμα**

    CREATE EXTERNAL TABLE [dbo].[order_line]( 
         [ol_o_id] int NOT NULL, 
         [ol_d_id] tinyint NOT NULL,
         [ol_w_id] int NOT NULL, 
         [ol_number] tinyint NOT NULL, 
         [ol_i_id] int NOT NULL, 
         [ol_delivery_d] datetime NOT NULL, 
         [ol_amount] smallmoney NOT NULL, 
         [ol_supply_w_id] int NOT NULL, 
         [ol_quantity] smallint NOT NULL, 
         [ol_dist_info] char(24) NOT NULL 
    ) 
    
    WITH 
    ( 
        DATA_SOURCE = MyExtSrc, 
        SCHEMA_NAME = 'orders', 
        OBJECT_NAME = 'order_details', 
        DISTRIBUTION=SHARDED(ol_w_id)
    ); 

Ανάκτηση της λίστας των εξωτερικών πίνακες από την τρέχουσα βάση δεδομένων: 

    SELECT * from sys.external_tables; 

Για να απορρίψετε εξωτερικοί πίνακες:

    DROP EXTERNAL TABLE [ database_name . [ schema_name ] . | schema_name. ] table_name[;]

### <a name="remarks"></a>Παρατηρήσεις

Τα ΔΕΔΟΜΈΝΑ\_όρος ΠΡΟΈΛΕΥΣΗΣ ορίζει την εξωτερική προέλευση δεδομένων (μια αντιστοίχιση shard) που χρησιμοποιείται για τον εξωτερικό πίνακα.  

Το ΣΧΉΜΑ\_ΌΝΟΜΑ και αντικείμενο\_όρους ΌΝΟΜΑ αντιστοίχιση τον ορισμό του εξωτερικού πίνακα σε έναν πίνακα σε ένα διαφορετικό σχήμα. Εάν παραλειφθεί, το σχήμα του απομακρυσμένου αντικειμένου λαμβάνεται "dbo" και το όνομά της είναι θεωρείται ότι είναι ίδιο με το όνομα εξωτερικού πίνακα που έχει οριστεί. Αυτό είναι χρήσιμο εάν το όνομα του απομακρυσμένου πίνακα έχει ήδη χρησιμοποιηθεί στη βάση δεδομένων όπου θέλετε να δημιουργήσετε τον εξωτερικό πίνακα. Για παράδειγμα, θέλετε να ορίσετε έναν εξωτερικό πίνακα για να δείτε μια προβολή συγκεντρωτικών αποτελεσμάτων προβολών καταλόγου ή DMVs με τα δεδομένα σας με κλιμάκωση ανάληψη σειρά. Επειδή το καταλόγου προβολές και DMVs υπάρχει ήδη τοπικά, δεν μπορείτε να χρησιμοποιήσετε τα ονόματά τους για τον ορισμό του εξωτερικού πίνακα. Αντί για αυτό, χρησιμοποιήστε ένα διαφορετικό όνομα και χρησιμοποιήστε την προβολή του καταλόγου ή του DMV το όνομα του σχήματος\_ΌΝΟΜΑ ή/και αντικείμενο\_όρους ΌΝΟΜΑ. (Δείτε το παρακάτω παράδειγμα). 

Ο όρος ΔΙΑΝΟΜΉΣ Καθορίζει την κατανομή δεδομένων που χρησιμοποιούνται για αυτόν τον πίνακα. Το πρόγραμμα επεξεργασίας ερωτημάτων χρησιμοποιεί τις πληροφορίες που παρέχονται στον όρο ΔΙΑΝΟΜΉΣ για να δημιουργήσετε πιο αποδοτικό προγράμματα ερωτήματος.  

1. **SHARDED** σημαίνει δεδομένων έχει διαμερίσματα οριζόντια κατά μήκος των βάσεων δεδομένων. Το κλειδί διαμερισμού για τη διανομή δεδομένων είναι η παράμετρος **< sharding_column_name >** .
2. **Από ΑΝΑΠΑΡΑΓΩΓΉ** σημαίνει ότι υπάρχουν πανομοιότυπα αντίγραφα του πίνακα σε κάθε βάση δεδομένων. Είναι δική σας ευθύνη για να βεβαιωθείτε ότι τα αντίγραφα είναι ίδιες κατά μήκος των βάσεων δεδομένων.
3. **ROUND\_ROBIN** σημαίνει ότι ο πίνακας έχει διαμερίσματα οριζόντια χρησιμοποιώντας μια μέθοδο διανομής εξαρτάται από την εφαρμογή. 

**Αναφορά σειρά δεδομένων**: το εξωτερικό πίνακα DDL αναφέρεται σε μια εξωτερική προέλευση δεδομένων. Εξωτερική προέλευση δεδομένων καθορίζει ένα χάρτη shard που παρέχει το εξωτερικό πίνακα με τις πληροφορίες που απαιτούνται για να εντοπίσετε όλες τις βάσεις δεδομένων σας σειρά δεδομένων. 


### <a name="security-considerations"></a>Ζητήματα ασφαλείας 

Οι χρήστες με πρόσβαση στον εξωτερικό πίνακα αυτόματα η πρόσβαση στους πίνακες απομακρυσμένης βάσης στην περιοχή τα διαπιστευτήρια που δίνεται στον ορισμό προέλευσης εξωτερικών δεδομένων. Αποφύγετε ανεπιθύμητα ανύψωση δικαιωμάτων μέσω των διαπιστευτηρίων από εξωτερική προέλευση δεδομένων. Χρησιμοποιήστε GRANT ή REVOKE για έναν εξωτερικό πίνακα ακριβώς σαν να ήταν μια κανονική πίνακα.  

Αφού έχετε ορίσει το εξωτερικό αρχείο προέλευσης δεδομένων και εξωτερικών τους πίνακές σας, μπορείτε να χρησιμοποιήσετε τώρα πλήρη T-SQL μέσω εξωτερικών τους πίνακές σας.

## <a name="example-querying-horizontal-partitioned-databases"></a>Παράδειγμα: υποβολή ερωτημάτων οριζόντια διαμερίσματα βάσεις δεδομένων 

Το ακόλουθο ερώτημα εκτελεί συνδέσμου τρεις τρόπους μεταξύ αποθήκες, παραγγελίες και γραμμές παραγγελίας και χρησιμοποιεί διάφορες συγκεντρώσεις και επιλεκτική φίλτρου. Προϋποθέτει (1) οριζόντια διαμερισμού (sharding) και (2) που αποθήκες, παραγγελίες και γραμμές παραγγελίας είναι sharded από τη στήλη αναγνωριστικό αποθήκης και ότι ελαστικότητας ερωτήματος να εντοπίσετε από κοινού οι σύνδεσμοι σε το shards και να επεξεργαστεί το ακριβό τμήμα του ερωτήματος σε το shards παράλληλα. 

    select  
         w_id as warehouse,
         o_c_id as customer,
         count(*) as cnt_orderline,
         max(ol_quantity) as max_quantity,
         avg(ol_amount) as avg_amount, 
         min(ol_delivery_d) as min_deliv_date
    from warehouse 
    join orders 
    on w_id = o_w_id
    join order_line 
    on o_id = ol_o_id and o_w_id = ol_w_id 
    where w_id > 100 and w_id < 200 
    group by w_id, o_c_id 
 
## <a name="stored-procedure-for-remote-t-sql-execution-spexecuteremote"></a>Αποθηκευμένη διαδικασία για την εκτέλεση απομακρυσμένου T-SQL: sp\_execute_remote

Ελαστικά ερωτήματος παρουσιάζει επίσης μια αποθηκευμένη διαδικασία που παρέχει άμεση πρόσβαση σε το shards. Αποθηκευμένη διαδικασία ονομάζεται [sp\_εκτέλεση \_απομακρυσμένης](https://msdn.microsoft.com/library/mt703714) και μπορεί να χρησιμοποιηθεί για την εκτέλεση απομακρυσμένου αποθηκευμένες διαδικασίες ή κώδικα T SQL σε απομακρυσμένο βάσεων δεδομένων. Χρειάζονται τις ακόλουθες παραμέτρους: 

* Όνομα της προέλευσης δεδομένων (nvarchar): το όνομα του αρχείου προέλευσης δεδομένων εξωτερικής προέλευσης του τύπου RDBMS. 
* Ερώτημα (nvarchar): το T-SQL ερωτήματος για να εκτελεστεί σε κάθε shard. 
* Δήλωση παραμέτρων (nvarchar) - Προαιρετικά: συμβολοσειρά με ορισμούς τύπου δεδομένων για τις παραμέτρους που χρησιμοποιούνται στην παράμετρο ερωτήματος (όπως sp_executesql). 
* Λίστα τιμή παραμέτρου - Προαιρετικά: διαχωρισμένες με κόμματα λίστα με τιμές παραμέτρων (όπως sp_executesql).

Το sp\_εκτέλεση\_remote χρησιμοποιεί εξωτερικό αρχείο προέλευσης δεδομένων που παρέχεται στην τις παραμέτρους κλήσης για να εκτελέσετε την δεδομένη T-SQL σε απομακρυσμένο βάσεων δεδομένων. Για να συνδεθείτε με τη βάση δεδομένων διαχείρισης shardmap και των βάσεων δεδομένων απομακρυσμένης χρησιμοποιεί τα διαπιστευτήρια από εξωτερική προέλευση δεδομένων.  

Παράδειγμα: 

    EXEC sp_execute_remote
        N'MyExtSrc',
        N'select count(w_id) as foo from warehouse' 

## <a name="connectivity-for-tools"></a>Σύνδεση για τα εργαλεία  

Χρησιμοποιήστε κανονική συμβολοσειρές σύνδεσης του SQL Server για να συνδέσετε την εφαρμογή σας, τα εργαλεία ενοποίησης BI και τα δεδομένα στη βάση δεδομένων με το εξωτερικό πίνακα ορισμούς. Βεβαιωθείτε ότι υποστηρίζεται SQL Server ως προέλευση δεδομένων για το εργαλείο. Στη συνέχεια, αναφορά της ελαστικότητας ερώτημα βάσης δεδομένων όπως οποιαδήποτε άλλη βάση δεδομένων SQL Server συνδεδεμένο με το εργαλείο και χρήση εξωτερικών πίνακες από το εργαλείο ή την εφαρμογή σαν να ήταν τοπικούς πίνακες. 

## <a name="best-practices"></a>Βέλτιστες πρακτικές 

* Βεβαιωθείτε ότι η βάση δεδομένων του τελικού σημείου ελαστικότητας ερώτημα έχει έχει παραχωρηθεί πρόσβαση στη βάση δεδομένων shardmap και όλες shards μέσω του τείχους προστασίας SQL DB.  

* Επικυρώστε ή την επιβολή της κατανομής δεδομένων που ορίζονται από το εξωτερικό πίνακα. Εάν σας διανομής πραγματικά δεδομένα είναι διαφορετική από την κατανομή που καθορίζεται στον ορισμό του πίνακα, τα ερωτήματα μπορεί να δώσει μη αναμενόμενα αποτελέσματα. 

* Ελαστικά ερωτήματος αυτήν τη στιγμή δεν εκτελεί εξάλειψη shard όταν κατηγορήματα πάνω από τον αριθμό-κλειδί sharding θα επιτρέπουν να ασφαλής εξαίρεση ορισμένων shards από την επεξεργασία.

* Ελαστικά ερωτήματος λειτουργεί καλύτερα για ερωτήματα όπου μπορεί να γίνει περισσότερες από τον υπολογισμό σε το shards. Λαμβάνετε συνήθως τις καλύτερες επιδόσεις ερωτημάτων με κατηγορήματα επιλεκτική φίλτρου που μπορεί να αξιολογηθεί στον shards ή σύνδεσμοι επάνω από τα πλήκτρα διαμερισμάτων που μπορούν να εκτελεστούν με τον τρόπο διαμερίσματα με στοίχιση στην shards όλων. Άλλες μοτίβα ερωτήματος μπορεί να χρειαστεί να φορτώσετε μεγάλες ποσότητες δεδομένων από το shards στον κόμβο κεφαλής και ενδέχεται να είναι σωστά

[AZURE.INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-query-horizontal-partitioning/horizontalpartitioning.png
<!--anchors-->
