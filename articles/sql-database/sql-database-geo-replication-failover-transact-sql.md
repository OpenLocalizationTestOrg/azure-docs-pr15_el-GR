<properties 
    pageTitle="Προετοιμασία προγραμματισμένες ή μη προγραμματισμένες ανακατεύθυνσης για βάση δεδομένων SQL Azure με Transact-SQL | Microsoft Azure" 
    description="Προετοιμασία προγραμματισμένες ή μη προγραμματισμένες ανακατεύθυνσης για βάση δεδομένων SQL Azure χρησιμοποιώντας την Transact-SQL" 
    services="sql-database" 
    documentationCenter="" 
    authors="CarlRabeler" 
    manager="jhubbard" 
    editor=""/>

<tags
    ms.service="sql-database"
    ms.devlang="NA"
    ms.topic="article"
    ms.tgt_pltfrm="NA"
    ms.workload="data-management"
    ms.date="08/29/2016"
    ms.author="carlrab"/>

# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a>Προετοιμασία προγραμματισμένες ή μη προγραμματισμένες ανακατεύθυνσης για βάση δεδομένων SQL Azure με Transact-SQL


> [AZURE.SELECTOR]
- [Πύλη του Azure](sql-database-geo-replication-failover-portal.md)
- [PowerShell](sql-database-geo-replication-failover-powershell.md)
- [T-SQL](sql-database-geo-replication-failover-transact-sql.md)


Σε αυτό το άρθρο θα μάθετε πώς να ξεκινήσετε ανακατεύθυνσης για μια δευτερεύουσα βάση δεδομένων SQL χρησιμοποιώντας την Transact-SQL. Για να ρυθμίσετε τις παραμέτρους παν αναπαραγωγής, ανατρέξτε στο θέμα [Ρύθμιση παραμέτρων παν-αναπαραγωγή για βάση δεδομένων SQL Azure](sql-database-geo-replication-transact-sql.md).



Για να ξεκινήσετε το ανακατεύθυνσης, χρειάζεστε τα εξής:

- Μια σύνδεση που είναι DBManager στην κύρια, έχετε db_ownership της τοπικής βάσης δεδομένων που θα παν-αντιγραφή, και είναι DBManager οι διακομιστές συνεργάτη στο οποίο θα ρυθμίσετε παν αναπαραγωγής.
- SQL Server Management Studio (SSMS)


> [AZURE.IMPORTANT] Συνιστάται να χρησιμοποιείτε πάντα την πιο πρόσφατη έκδοση του Management Studio για να παραμείνετε συγχρονισμένοι με ενημερώσεις για το Microsoft Azure και βάση δεδομένων SQL. [Ενημέρωση SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).




## <a name="initiate-a-planned-failover-promoting-a-secondary-database-to-become-the-new-primary"></a>Προετοιμασία προγραμματισμένη ανακατεύθυνσης προώθηση δευτερεύοντα βάσης δεδομένων για να γίνει η νέα κύρια

Μπορείτε να χρησιμοποιήσετε τη δήλωση **ΤΡΟΠΟΠΟΊΗΣΗ βάσης ΔΕΔΟΜΈΝΩΝ** για να προβιβάσετε δευτερεύοντα βάσης δεδομένων για να γίνετε τη νέα κύρια βάση δεδομένων με μια προγραμματισμένη τον τρόπο, το υπάρχον πρωτεύον για να γίνετε δευτερεύον υποβιβασμός. Αυτή η πρόταση εκτελείται στην κύρια βάση δεδομένων στο διακομιστή λογική βάση δεδομένων SQL Azure, στο οποίο βρίσκεται αναπαραχθούν παν δευτερεύοντα βάσης δεδομένων που είναι που προβιβάζονται. Αυτή η λειτουργία έχει σχεδιαστεί για προγραμματισμένη ανακατεύθυνση, όπως κατά τη διάρκεια του drills DR, και απαιτεί να είναι διαθέσιμη η κύρια βάση δεδομένων.

Η εντολή εκτελεί τη ροή εργασίας παρακάτω:

1. Προσωρινή πραγματοποιεί μετακίνηση αναπαραγωγής σύγχρονη λειτουργία, προκαλεί όλες τις εκκρεμείς συναλλαγές να καταγραφούν στο δευτερεύον και αποκλεισμός όλες τις νέες συναλλαγές;

2. Αλλάζει τους ρόλους των δύο βάσεων δεδομένων σε συνεργασία με τη παν αναπαραγωγής.  

Αυτή η ακολουθία εγγυάται ότι οι δύο βάσεις δεδομένων είναι συγχρονισμένα πριν από την αλλαγή τους ρόλους και, επομένως, θα παρουσιαστεί χωρίς απώλεια δεδομένων. Υπάρχει μια σύντομη περίοδο κατά την οποία δύο βάσεις δεδομένων δεν είναι διαθέσιμες (στη διάταξη 0 έως 25 δευτερόλεπτα) ενώ οι ρόλοι έχουν αλλάξει. Εάν η κύρια βάση δεδομένων έχει πολλά δευτερεύοντα βάσεις δεδομένων, η εντολή θα αυτόματα ρυθμίσει ξανά τις παραμέτρους του άλλες secondaries για να συνδεθείτε με τη νέα κύρια.  Ολόκληρη η λειτουργία πρέπει να εκτελεί λιγότερο από ένα λεπτό για να ολοκληρωθεί σε κανονικές συνθήκες. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [ΤΡΟΠΟΠΟΊΗΣΗ βάσης ΔΕΔΟΜΈΝΩΝ (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) και [Επίπεδα υπηρεσίας](sql-database-service-tiers.md).


Χρησιμοποιήστε τα ακόλουθα βήματα για να ξεκινήσετε μια προγραμματισμένη ανακατεύθυνσης.

1. Στο Management Studio, σύνδεση με τη βάση δεδομένων SQL Azure λογική διακομιστή στον οποίο βρίσκεται αναπαραχθούν παν δευτερεύοντα βάσης δεδομένων.

2. Ανοίξτε το φάκελο βάσεις δεδομένων, αναπτύξτε το φάκελο **Βάσεων δεδομένων συστήματος** , κάντε δεξί κλικ στην **κύρια**και, στη συνέχεια, κάντε κλικ στην επιλογή **Νέο ερώτημα**.

3. Χρησιμοποιήστε την ακόλουθη πρόταση **ΤΡΟΠΟΠΟΊΗΣΗ βάσης ΔΕΔΟΜΈΝΩΝ** για να κάνετε εναλλαγή στη βάση δεδομένων δευτερεύοντα στον πρωτεύοντα ρόλο.

        ALTER DATABASE <MyDB> FAILOVER;

4. Κάντε κλικ στο κουμπί **Εκτέλεση** για να εκτελέσετε το ερώτημα.

>[AZURE.NOTE] Στην περίπτωση αυτή, είναι πιθανό ότι η λειτουργία δεν μπορεί να ολοκληρωθεί και ενδέχεται να εμφανιστεί το κολλημένη. Σε αυτήν την περίπτωση, ο χρήστης μπορεί να εκτελέσει την εντολή ανακατεύθυνσης ισχύ και αποδοχή απώλεια δεδομένων.


## <a name="initiate-an-unplanned-failover-from-the-primary-database-to-the-secondary-database"></a>Ξεκινήσετε μια μη προγραμματισμένη ανακατεύθυνσης από την κύρια βάση δεδομένων στη βάση δεδομένων του δευτερεύοντος

Μπορείτε να χρησιμοποιήσετε τη δήλωση **ΤΡΟΠΟΠΟΊΗΣΗ βάσης ΔΕΔΟΜΈΝΩΝ** για να προβιβάσετε μια δευτερεύουσα βάση δεδομένων για να γίνετε τη νέα κύρια βάση δεδομένων με μια μη προγραμματισμένη τον τρόπο, να επιβάλετε ο υποβιβασμός του το υπάρχον πρωτεύον για να γίνετε δευτερεύον κάθε φορά όταν το κύριο βάσης δεδομένων δεν είναι πλέον διαθέσιμη. Αυτή η πρόταση εκτελείται στην κύρια βάση δεδομένων στο διακομιστή λογική βάση δεδομένων SQL Azure, στο οποίο βρίσκεται αναπαραχθούν παν δευτερεύοντα βάσης δεδομένων που είναι που προβιβάζονται.

Αυτή η λειτουργία έχει σχεδιαστεί για αποκατάσταση όταν επαναφορά διαθεσιμότητα της βάσης δεδομένων είναι κρίσιμης και ορισμένες απώλεια δεδομένων είναι αποδεκτή. Όταν ενεργοποιείται εξαναγκασμένη ανακατεύθυνσης, η καθορισμένη βάση δεδομένων δευτερεύοντα γίνεται την κύρια βάση δεδομένων αμέσως και αρχίζει αποδοχή συναλλαγές εγγραφής. Μόλις η αρχική κύρια βάση δεδομένων είναι σε θέση να το συνδέσετε με αυτήν τη νέα κύρια βάση, μια προσαύξησης λαμβάνεται αρχική κύρια βάση δεδομένων και την παλιά κύρια βάση δεδομένων είναι που έχουν γίνει σε μια δευτερεύουσα βάση δεδομένων για τη νέα κύρια βάση δεδομένων. στη συνέχεια, είναι απλώς μια συγχρονισμού ρεπλίκα της νέας κύριας.

Ωστόσο, επειδή το σημείο στο χρόνο επαναφορά δεν υποστηρίζεται σε τις δευτερεύοντα βάσεις δεδομένων, εάν ο χρήστης θέλει να ανακτήσετε δεδομένα δεσμευμένου στην παλιά κύρια βάση δεδομένων που δεν είχαν έχει αντιγραφεί στη νέα κύρια βάση δεδομένων, πριν από την εμφάνιση του εξαναγκασμένη εφεδρικού, ο χρήστης θα πρέπει να συμμετάσχουν υποστήριξη για να ανακτήσετε αυτό απώλεια δεδομένων.

Εάν η κύρια βάση δεδομένων έχει πολλά δευτερεύοντα βάσεις δεδομένων, η εντολή θα αυτόματα ρυθμίσει ξανά τις παραμέτρους του άλλες secondaries για να συνδεθείτε με τη νέα κύρια.

Χρησιμοποιήστε τα ακόλουθα βήματα για να ξεκινήσετε μια μη προγραμματισμένη ανακατεύθυνσης.

1. Στο Management Studio, σύνδεση με τη βάση δεδομένων SQL Azure λογική διακομιστή στον οποίο βρίσκεται αναπαραχθούν παν δευτερεύοντα βάσης δεδομένων.

2. Ανοίξτε το φάκελο βάσεις δεδομένων, αναπτύξτε το φάκελο **Βάσεων δεδομένων συστήματος** , κάντε δεξί κλικ στην **κύρια**και, στη συνέχεια, κάντε κλικ στην επιλογή **Νέο ερώτημα**.

3. Χρησιμοποιήστε την ακόλουθη πρόταση **ΤΡΟΠΟΠΟΊΗΣΗ βάσης ΔΕΔΟΜΈΝΩΝ** για να κάνετε εναλλαγή στη βάση δεδομένων δευτερεύοντα στον πρωτεύοντα ρόλο.

        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;

4. Κάντε κλικ στο κουμπί **Εκτέλεση** για να εκτελέσετε το ερώτημα.

>[AZURE.NOTE] Εάν η εντολή εκδίδεται όταν κύριων και δευτερευουσών που online θα γίνει η παλιά κύρια τη νέα δευτερεύουσα αμέσως χωρίς συγχρονισμό δεδομένων. Εάν είναι η κύρια μπορεί να προκύψουν ολοκλήρωση συναλλαγές όταν η εντολή εκδίδεται απώλεια ορισμένων δεδομένων.



## <a name="next-steps"></a>Επόμενα βήματα   

- Μετά την ανακατεύθυνση, βεβαιωθείτε ότι έχουν ρυθμιστεί οι απαιτήσεις ελέγχου ταυτότητας για το διακομιστή και τη βάση δεδομένων στην νέα κύρια. Για λεπτομέρειες, ανατρέξτε στο θέμα [ασφαλείας βάσης δεδομένων SQL μετά την αποκατάσταση](sql-database-geo-replication-security-config.md).
- Για να μάθετε ανάκτηση μετά από μια καταστροφή χρησιμοποιώντας ενεργό παν-αναπαραγωγή, συμπεριλαμβανομένων των pre και δημοσιεύσετε αποκατάστασης βήματα και να εκτελέσετε εμφάνιση λεπτομερειών αποκατάστασης από καταστροφή, ανατρέξτε στο θέμα [Αποκατάσταση](sql-database-disaster-recovery.md)
- Για Sasha Nosov δημοσίευση ιστολογίου σχετικά με το ενεργό παν-αναπαραγωγής, ανατρέξτε στο θέμα [Ανάδειξη σε νέες δυνατότητες παν αναπαραγωγής](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)
- Για πληροφορίες σχετικά με τη σχεδίαση εφαρμογών cloud για να χρησιμοποιήσετε ενεργό παν-αναπαραγωγής, ανατρέξτε στο θέμα [Σχεδιασμός cloud εφαρμογών για αδιάκοπη χρησιμοποιώντας παν αναπαραγωγής](sql-database-designing-cloud-solutions-for-disaster-recovery.md)
- Για πληροφορίες σχετικά με τη χρήση ενεργό παν-αλληλεπίδραση με τους χώρους συγκέντρωσης ελαστικότητας βάσης δεδομένων, ανατρέξτε στο θέμα [στρατηγικές αποκατάστασης από καταστροφή ελαστικότητας χώρου συγκέντρωσης](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).
- Για μια επισκόπηση του continurity επιχειρήσεις, ανατρέξτε στο θέμα [Επισκόπηση επιχειρηματικές συνέχειας](sql-database-business-continuity.md)
