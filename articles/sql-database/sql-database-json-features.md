<properties
    pageTitle="Δυνατότητες του JSON βάσης δεδομένων SQL Azure | Microsoft Azure"
    description="Βάση δεδομένων SQL του Azure σάς επιτρέπει να ανάλυσης, ερωτήματος και μορφοποίηση δεδομένων σε σημειογραφίας αντικειμένων JavaScript (JSON) σημειογραφία."
    services="sql-database"
    documentationCenter=""
    authors="jovanpop-msft"
    manager="jhubbard"
    editor=""/>

<tags
    ms.service="sql-database"
    ms.devlang="NA"
    ms.date="08/17/2016"
    ms.author="jovanpop"
   ms.workload="NA"
    ms.topic="article"
    ms.tgt_pltfrm="NA"/>



# <a name="getting-started-with-json-features-in-azure-sql-database"></a>Γρήγορα αποτελέσματα με τις δυνατότητες JSON σε βάση δεδομένων SQL Azure

Βάση δεδομένων SQL του Azure σάς επιτρέπει να ανάλυση και ερωτήματος δεδομένων που αντιπροσωπεύονται σε μορφή σημειογραφίας αντικειμένων JavaScript [(JSON)](http://www.json.org/) και εξαγωγή σχεσιακών δεδομένων ως κείμενο JSON.

JSON είναι μια μορφή δημοφιλείς δεδομένων που χρησιμοποιείται για την ανταλλαγή δεδομένων σε Μοντέρνο web και εφαρμογές για κινητές συσκευές. JSON χρησιμοποιείται επίσης για την αποθήκευση ημι-δομημένα δεδομένα στα αρχεία καταγραφής ή σε βάσεις δεδομένων NoSQL όπως [Azure DocumentDB](https://azure.microsoft.com/services/documentdb/). Πολλές υπηρεσίες web REST αποτελέσματα που επιστράφηκαν με μορφοποίηση κειμένου JSON ή αποδέχεται δεδομένα σε μορφή JSON. Πιο Azure υπηρεσίες όπως [Azure αναζήτησης](https://azure.microsoft.com/services/search/), το [Χώρο αποθήκευσης Azure](https://azure.microsoft.com/services/storage/)και [Azure DocumentDB](https://azure.microsoft.com/services/documentdb/) έχουν τελικά σημεία ΥΠΌΛΟΙΠΟ που επιστρέφουν ή εκμετάλλευση JSON.

Βάση δεδομένων SQL του Azure σάς επιτρέπει να εύκολη εργασία με δεδομένα JSON και ενοποίηση τη βάση δεδομένων με τις υπηρεσίες σύγχρονο.

## <a name="overview"></a>Επισκόπηση

Βάση δεδομένων SQL του Azure παρέχει τις ακόλουθες συναρτήσεις για την εργασία με δεδομένα JSON:

![Συναρτήσεις JSON](./media/sql-database-json-features/image_1.png)

Εάν έχετε JSON κείμενο, μπορείτε να εξαγάγετε δεδομένα από JSON ή να επαληθεύσετε ότι JSON έχει μορφοποιηθεί σωστά, χρησιμοποιώντας τις ενσωματωμένες συναρτήσεις [JSON_VALUE](https://msdn.microsoft.com/library/dn921898.aspx), [JSON_QUERY](https://msdn.microsoft.com/library/dn921884.aspx)και [ISJSON](https://msdn.microsoft.com/library/dn921896.aspx). Η συνάρτηση [JSON_MODIFY](https://msdn.microsoft.com/library/dn921892.aspx) σάς επιτρέπει να ενημερώσετε τιμή μέσα σε κείμενο JSON. Για πιο σύνθετα υποβολή ερωτημάτων και ανάλυση, συνάρτηση [OPENJSON](https://msdn.microsoft.com/library/dn921885.aspx) να μετατρέψετε έναν πίνακα JSON αντικείμενα σε ένα σύνολο γραμμών. Οποιοδήποτε ερώτημα SQL που μπορεί να εκτελεστεί στο σύνολο αποτελεσμάτων που επιστράφηκε. Τέλος, υπάρχει ένας όρος [JSON για](https://msdn.microsoft.com/library/dn921882.aspx) που σας επιτρέπει να μορφοποιήσετε δεδομένα αποθηκευμένα σε σχεσιακή τους πίνακές σας ως κείμενο JSON.

## <a name="formatting-relational-data-in-json-format"></a>Μορφοποίηση σχεσιακών δεδομένων σε μορφή JSON
Εάν έχετε μια υπηρεσία web που λαμβάνει τα δεδομένα από τη βάση δεδομένων επιπέδου και παρέχει μια απάντηση στο JSON μορφοποίηση ή πλευρά του προγράμματος-πελάτη πλαίσια JavaScript ή βιβλιοθήκες που αποδέχεται δεδομένα σε μορφή JSON, μπορείτε να μορφοποιήσετε το περιεχόμενο της βάσης δεδομένων ως JSON απευθείας σε ένα ερώτημα SQL. Δεν είναι πλέον έχετε για να γράψετε κώδικα της εφαρμογής που μορφοποιεί αποτελέσματα από βάση δεδομένων SQL Azure ως JSON ή συμπεριλάβετε ορισμένες βιβλιοθήκη σειριοποίησης JSON για να μετατρέψετε αποτελέσματα του ερωτήματος σε μορφή πίνακα και, στη συνέχεια, σειριοποιεί αντικείμενα σε μορφή JSON. Αντί για αυτό, μπορείτε να χρησιμοποιήσετε τον όρο JSON για να μορφοποιήσετε αποτελέσματα του ερωτήματος SQL ως JSON σε βάση δεδομένων SQL Azure και να το χρησιμοποιήσετε απευθείας στην εφαρμογή σας.

Στο παρακάτω παράδειγμα, τις γραμμές από τον πίνακα Sales.Customer έχουν μορφοποιηθεί ως JSON, χρησιμοποιώντας τον όρο JSON για:

```
select CustomerName, PhoneNumber, FaxNumber
from Sales.Customers
FOR JSON PATH
```

Ο όρος για τη ΔΙΑΔΡΟΜΉ JSON μορφοποιεί τα αποτελέσματα του ερωτήματος ως κείμενο JSON. Ονόματα στηλών που χρησιμοποιούνται ως πλήκτρα, ενώ οι τιμές των κελιών δημιουργούνται ως JSON τιμές:

```
[
{"CustomerName":"Eric Torres","PhoneNumber":"(307) 555-0100","FaxNumber":"(307) 555-0101"},
{"CustomerName":"Cosmina Vlad","PhoneNumber":"(505) 555-0100","FaxNumber":"(505) 555-0101"},
{"CustomerName":"Bala Dixit","PhoneNumber":"(209) 555-0100","FaxNumber":"(209) 555-0101"}
]
```

Το σύνολο των αποτελεσμάτων είναι μορφοποιημένο ως πίνακας JSON όπου κάθε γραμμή έχει μορφοποιηθεί ως ξεχωριστό αντικείμενο JSON.

ΔΙΑΔΡΟΜΉ υποδεικνύει ότι μπορείτε να προσαρμόσετε τη μορφή εξόδου του αποτελέσματος JSON χρησιμοποιώντας σημειογραφία ψευδωνύμων στηλών. Το παρακάτω ερώτημα αλλάζει το όνομα του κλειδιού "Όνομα πελάτη" από τη μορφή εξόδου JSON και τοποθετεί αριθμών τηλεφώνου και φαξ στο αντικείμενο δευτερεύουσες "Επαφή":

```
select CustomerName as Name, PhoneNumber as [Contact.Phone], FaxNumber as [Contact.Fax]
from Sales.Customers
where CustomerID = 931
FOR JSON PATH, WITHOUT_ARRAY_WRAPPER
```

Το αποτέλεσμα αυτού του ερωτήματος μοιάζει κάπως έτσι:

```
{
    "Name":"Nada Jovanovic",
    "Contact":{
           "Phone":"(215) 555-0100",
           "Fax":"(215) 555-0101"
    }
}
```

Σε αυτό το παράδειγμα, θα σας να επιστραφεί σε ένα αντικείμενο JSON αντί για έναν πίνακα, καθορίζοντας την επιλογή [WITHOUT_ARRAY_WRAPPER](https://msdn.microsoft.com/library/mt631354.aspx) . Μπορείτε να χρησιμοποιήσετε αυτήν την επιλογή, εάν γνωρίζετε ότι επιστρέφετε σε ένα αντικείμενο ως αποτέλεσμα ερωτήματος.

Η κύρια τιμή του όρου JSON για είναι ότι σας επιτρέπει να επιστρέψετε σύνθετα ιεραρχικά δεδομένα από τη βάση δεδομένων σε μορφή ένθετα JSON αντικείμενα ή πίνακες. Το παρακάτω παράδειγμα δείχνει πώς μπορείτε να συμπεριλάβετε παραγγελιών που ανήκουν στον πελάτη ως ένθετου πίνακα παραγγελιών:

```
select CustomerName as Name, PhoneNumber as Phone, FaxNumber as Fax,
        Orders.OrderID, Orders.OrderDate, Orders.ExpectedDeliveryDate
from Sales.Customers Customer
    join Sales.Orders Orders
        on Customer.CustomerID = Orders.CustomerID
where Customer.CustomerID = 931
FOR JSON AUTO, WITHOUT_ARRAY_WRAPPER

```

Αντί να στέλνετε διαχωρισμό των ερωτημάτων για να λάβετε δεδομένα πελατών και, στη συνέχεια, να κάνετε λήψη μιας λίστας σχετικών παραγγελιών, μπορείτε να λάβετε τα απαραίτητα δεδομένα με ενός απλού ερωτήματος, όπως φαίνεται στην παρακάτω δείγματος δεδομένων εξόδου της:

```
{
  "Name":"Nada Jovanovic",
  "Phone":"(215) 555-0100",
  "Fax":"(215) 555-0101",
  "Orders":[
    {"OrderID":382,"OrderDate":"2013-01-07","ExpectedDeliveryDate":"2013-01-08"},
    {"OrderID":395,"OrderDate":"2013-01-07","ExpectedDeliveryDate":"2013-01-08"},
    {"OrderID":1657,"OrderDate":"2013-01-31","ExpectedDeliveryDate":"2013-02-01"}
]
}
```

## <a name="working-with-json-data"></a>Εργασία με δεδομένα JSON

Εάν δεν έχετε αυστηρά δομημένα δεδομένα, εάν έχετε σύνθετα δευτερεύουσες αντικείμενα, πίνακες ή ιεραρχικών δεδομένων ή εάν σας δομές δεδομένων εξελίσσονται μέσα στο χρόνο, τη μορφή JSON μπορεί να σας βοηθήσει να αναπαραστήσετε οποιαδήποτε δομή σύνθετα δεδομένα.

JSON είναι μια μορφή που περιέχουν κείμενο που μπορούν να χρησιμοποιηθούν ως οποιονδήποτε άλλο τύπο συμβολοσειράς σε βάση δεδομένων SQL Azure. Μπορείτε να στείλετε ή να αποθηκεύσετε δεδομένα JSON ως μια τυπική NVARCHAR:

```
CREATE TABLE Products (
  Id int identity primary key,
  Title nvarchar(200),
  Data nvarchar(max)
)
go
CREATE PROCEDURE InsertProduct(@title nvarchar(200), @json nvarchar(max))
AS BEGIN
    insert into Products(Title, Data)
    values(@title, @json)
END
```

Τα δεδομένα JSON που χρησιμοποιούνται σε αυτό το παράδειγμα αναπαριστάται με χρήση του τύπου NVARCHAR(MAX). JSON μπορεί να εισαχθεί σε αυτόν τον πίνακα ή να που παρέχεται ως όρισμα της αποθηκευμένης διαδικασίας χρησιμοποιώντας τυπική σύνταξη Transact-SQL, όπως φαίνεται στο ακόλουθο παράδειγμα:

```
EXEC InsertProduct 'Toy car', '{"Price":50,"Color":"White","tags":["toy","children","games"]}'
```

Οποιαδήποτε πλευρά του προγράμματος-πελάτη γλώσσα ή τη βιβλιοθήκη που λειτουργεί με συμβολοσειρά δεδομένων σε βάση δεδομένων SQL Azure λειτουργούν επίσης με δεδομένα JSON. JSON μπορούν να αποθηκευτούν σε κάθε πίνακα που υποστηρίζει τον τύπο NVARCHAR, όπως ένας πίνακας Βελτιστοποίηση μνήμης ή έκδοση συστήματος πίνακα. JSON δεν μπορεί να προκαλέσει οποιαδήποτε περιορισμού στον κώδικα πλευρά του προγράμματος-πελάτη είτε στο επίπεδο βάσης δεδομένων.

## <a name="querying-json-data"></a>Υποβολή ερωτημάτων δεδομένων JSON

Εάν έχετε δεδομένα που έχουν μορφοποιηθεί ως JSON αποθηκευμένων σε πίνακες του Azure SQL, JSON συναρτήσεις σάς επιτρέπουν να χρησιμοποιήσετε αυτά τα δεδομένα σε οποιοδήποτε ερώτημα SQL.

Συναρτήσεις JSON που είναι διαθέσιμες στο σας επιτρέπουν να βάσης δεδομένων Azure SQL διαχειρίζεστε τα δεδομένα σε μορφή JSON ως οποιονδήποτε άλλο τύπο δεδομένων SQL. Μπορείτε εύκολα να εξαγάγετε τιμές από το κείμενο JSON, και τη χρήση δεδομένων JSON σε οποιοδήποτε ερώτημα:

```
select Id, Title, JSON_VALUE(Data, '$.Color'), JSON_QUERY(Data, '$.tags')
from Products
where JSON_VALUE(Data, '$.Color') = 'White'

update Products
set Data = JSON_MODIFY(Data, '$.Price', 60)
where Id = 1
```

Η συνάρτηση JSON_VALUE εξάγει μια τιμή από το κείμενο JSON που είναι αποθηκευμένα σε της στήλης δεδομένων. Αυτή η συνάρτηση χρησιμοποιεί μια διαδρομή μοιάζει με JavaScript για να αναφέρονται σε μια τιμή σε κείμενο JSON για να εξαγάγετε. Η τιμή που έχει εξαχθεί μπορεί να χρησιμοποιηθεί σε οποιοδήποτε τμήμα του ερωτήματος SQL.

Η συνάρτηση JSON_QUERY είναι παρόμοια με JSON_VALUE. Σε αντίθεση με JSON_VALUE, αυτή η συνάρτηση εξάγει σύνθετες δευτερεύουσες αντικείμενο, όπως πίνακες ή τα αντικείμενα που τοποθετούνται στο JSON κείμενο.

Η συνάρτηση JSON_MODIFY σάς επιτρέπει να καθορίσετε τη διαδρομή της τιμής στο το κείμενο JSON που θα πρέπει να ενημερωθεί, καθώς και μια νέα τιμή που θα αντικαταστήσει την παλιά. Με αυτόν τον τρόπο μπορείτε εύκολα να ενημερώσετε JSON κείμενο χωρίς reparsing ολόκληρη τη δομή.

Επειδή το JSON είναι αποθηκευμένο σε ένα πρότυπο κείμενο, δεν υπάρχουν εγγυήσεις ότι οι τιμές που είναι αποθηκευμένα σε στήλες κειμένου έχουν μορφοποιηθεί σωστά. Μπορείτε να επαληθεύσετε ότι κειμένου που είναι αποθηκευμένα στη στήλη JSON έχει μορφοποιηθεί σωστά χρησιμοποιώντας την τυπική τους περιορισμούς ελέγχου βάση δεδομένων SQL Azure και τη συνάρτηση ISJSON:

```
ALTER TABLE Products
    ADD CONSTRAINT [Data should be formatted as JSON]
        CHECK (ISJSON(Data) > 0)
```

Εάν το κείμενο εισαγωγής έχει μορφοποιηθεί σωστά JSON, η συνάρτηση ISJSON επιστρέφει την τιμή 1. Σε κάθε εισαγωγή ή ενημέρωση της στήλης JSON, αυτός ο περιορισμός θα επαληθεύσετε ότι νέα τιμή κειμένου δεν είναι ακατάλληλη JSON.

## <a name="transforming-json-into-tabular-format"></a>Μετασχηματισμός JSON σε μορφή πίνακα

Βάση δεδομένων SQL του Azure σάς επιτρέπει επίσης να μετασχηματισμός JSON συλλογές σε πίνακα δεδομένων JSON μορφή και φόρτωση ή το ερώτημα.

OPENJSON είναι μια συνάρτηση τιμή του πίνακα που αναλύει JSON κειμένου, εντοπίζει ένας πίνακας με αντικείμενα JSON, επαναλαμβάνει τα στοιχεία του πίνακα και επιστρέφει μία γραμμή στο αποτέλεσμα εξόδου για κάθε στοιχείο του πίνακα.

![JSON σε μορφή πίνακα](./media/sql-database-json-features/image_2.png)

Στο παραπάνω παράδειγμα, θα σας να καθορίσετε πού για να εντοπίσετε τον πίνακα JSON που θα πρέπει να είναι δυνατό το άνοιγμα (στο $. Διαδρομή παραγγελίες), τι στήλες πρέπει να επιστρέφεται ως αποτέλεσμα και τη θέση για να βρείτε τις τιμές JSON που θα επιστραφεί ως κελιά.

Θα σας να μετατρέψετε έναν πίνακα JSON στο το @orders μεταβλητή σε ένα σύνολο γραμμών, ανάλυση αυτό το σύνολο αποτελεσμάτων ή εισαγωγή γραμμών σε έναν τυπικό πίνακα:

```
CREATE PROCEDURE InsertOrders(@orders nvarchar(max))
AS BEGIN

    insert into Orders(Number, Date, Customer, Quantity)
    select Number, Date, Customer, Quantity
    OPENJSON (@orders)
     WITH (
            Number varchar(200),
            Date datetime,
            Customer varchar(200),
            Quantity int
     )

END
```
Η συλλογή των παραγγελιών μορφοποίηση ως πίνακα JSON και παρέχονται ως παραμέτρου στην αποθηκευμένη διαδικασία μπορούν να αναλυθούν και που έχουν εισαχθεί σε πίνακα "Παραγγελίες".

## <a name="next-steps"></a>Επόμενα βήματα

Για να μάθετε πώς μπορείτε να ενοποιήσετε JSON στην εφαρμογή σας, ανατρέξτε στα θέματα αυτούς τους πόρους:

- [Ιστολόγιο TechNet](https://blogs.technet.microsoft.com/dataplatforminsider/2016/01/05/json-in-sql-server-2016-part-1-of-4/)
- [Τεκμηρίωση MSDN](https://msdn.microsoft.com/library/dn921897.aspx)
- [Κανάλι 9 βίντεο](https://channel9.msdn.com/Shows/Data-Exposed/SQL-Server-2016-and-JSON-Support)

Για να μάθετε σχετικά με τα διάφορα σενάρια για την ενσωμάτωση JSON στην εφαρμογή σας, ανατρέξτε στο θέμα το επιδείξεις σε αυτό [το κανάλι 9 βίντεο](https://channel9.msdn.com/Events/DataDriven/SQLServer2016/JSON-as-a-bridge-betwen-NoSQL-and-relational-worlds) ή βρείτε ένα σενάριο που ταιριάζουν με την περίπτωση χρήσης σε [καταχωρήσεις ιστολογίου JSON](http://blogs.msdn.com/b/sqlserverstorageengine/archive/tags/json/).
