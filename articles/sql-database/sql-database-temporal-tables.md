<properties
   pageTitle="Γρήγορα αποτελέσματα με το χρονικό πίνακες σε βάση δεδομένων SQL Azure | Microsoft Azure"
   description="Μάθετε πώς μπορείτε να ξεκινήσετε με τη χρήση χρονικό πινάκων σε βάση δεδομένων SQL Azure."
   services="sql-database"
   documentationCenter=""
   authors="CarlRabeler"
   manager="jhubbard"
   editor=""/>

<tags
   ms.service="sql-database"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="sql-database"
   ms.date="08/29/2016"
   ms.author="carlrab"/>

#<a name="getting-started-with-temporal-tables-in-azure-sql-database"></a>Γρήγορα αποτελέσματα με το χρονικό πίνακες σε βάση δεδομένων SQL Azure

Οι πίνακες χρονικό είναι μια νέα δυνατότητα προγραμματισμού της βάσης δεδομένων SQL Azure που σας επιτρέπει να παρακολουθείτε και να αναλύσετε το πλήρες ιστορικό αλλαγών στα δεδομένα σας, χωρίς να χρειάζεται προσαρμοσμένου κώδικα. Χρονικό πίνακες διατήρηση δεδομένων συνδέονται στενά με περιβάλλοντος χρόνου, έτσι ώστε να μετατραπούν αποθηκευμένες γεγονότα ως έγκυρο μόνο μέσα σε συγκεκριμένες περιόδου. Αυτή η ιδιότητα χρονικό πίνακες επιτρέπει για αποτελεσματική ανάλυση βάσει χρόνου και λήψη ιδεών από εξέλιξη δεδομένων.

##<a name="temporal-scenario"></a>Σενάριο χρονικό

Σε αυτό το άρθρο παρουσιάζει τα βήματα για να χρησιμοποιούν χρονικό πίνακες σε ένα σενάριο εφαρμογής. Ας υποθέσουμε ότι θέλετε να παρακολουθήσετε δραστηριότητες του χρήστη σε μια νέα τοποθεσία Web που αναπτύσσεται από την αρχή ή σε μια υπάρχουσα τοποθεσία Web που θέλετε να επεκτείνετε με ανάλυση δραστηριοτήτων χρήστη. Σε αυτό το παράδειγμα απλοποιημένη, θα σας λαμβάνεται ως δεδομένο ότι ο αριθμός των σελίδων που επισκεφθήκατε web σε μια χρονική περίοδο είναι μια ένδειξη που πρέπει να καταγράφονται και να παρακολουθούνται στη βάση δεδομένων τοποθεσίας Web που φιλοξενείται σε βάση δεδομένων SQL Azure. Ο στόχος της ιστορικού ανάλυσης δραστηριότητα του χρήστη είναι για να λάβετε δεδομένα εισόδου για να σχεδιάσετε εκ νέου τοποθεσία Web και να παρέχουν καλύτερη εμπειρία για το επισκέπτες.

Το μοντέλο βάσης δεδομένων για αυτό το σενάριο είναι πολύ απλής-μετρικό δραστηριοτήτων χρήστη αναπαριστάται με ένα πεδίο μόνο ακέραιος, **PageVisited**, και είναι καταγράφονται μαζί με βασικές πληροφορίες σχετικά με το προφίλ χρήστη. Επιπλέον, για την ανάλυση βάσει χρόνου, θα κρατήσετε μια σειρά γραμμών για κάθε χρήστη, όπου κάθε γραμμή αντιπροσωπεύει τον αριθμό των σελίδων ενός συγκεκριμένου χρήστη που επισκεφτήκατε μέσα σε μια συγκεκριμένη χρονική περίοδο.

![Σχήμα](./media/sql-database-temporal-tables/AzureTemporal1.png)

Ευτυχώς, δεν χρειάζεται να τοποθετήσετε οποιαδήποτε προσπάθειας στην εφαρμογή για να διατηρήσετε αυτές τις πληροφορίες δραστηριότητας. Με το χρονικό πίνακες, αυτή η διαδικασία είναι αυτοματοποιημένο - παρέχοντας πλήρη ευελιξία κατά τη Σχεδίαση τοποθεσιών Web και περισσότερο χρόνο για να εστιάσετε σε την ανάλυση δεδομένων ίδια. Το μόνο που έχετε να κάνετε είναι να διασφαλίσετε ότι **WebSiteInfo** πίνακας έχει ρυθμιστεί ως [χρονικό συστήματος έκδοση](https://msdn.microsoft.com/library/dn935015.aspx#Anchor_0). Παρακάτω περιγράφονται τα ακριβή βήματα για να χρησιμοποιούν χρονικό πίνακες σε αυτό το σενάριο.

##<a name="step-1-configure-tables-as-temporal"></a>Βήμα 1: Ρύθμιση παραμέτρων πίνακες ως χρονικό

Ανάλογα με το αν ξεκινώντας ανάπτυξης νέων ή αναβάθμιση υπάρχοντος εφαρμογής, θα δημιουργήσετε χρονικό πίνακες ή να τροποποιήσετε τους υπάρχοντες προσθέτοντας χρονικό χαρακτηριστικά. Σε γενικές γραμμές πεζών-κεφαλαίων, το σενάριό σας μπορεί να είναι ένα μείγμα από αυτές τις δύο επιλογές. Εκτελέστε τα παρακάτω ενέργεια χρησιμοποιώντας [SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx) (SSMS), [Εργαλεία δεδομένων του SQL Server](https://msdn.microsoft.com/library/mt204009.aspx) (SSDT) ή οποιοδήποτε άλλο εργαλείο ανάπτυξης Transact-SQL.


> [AZURE.IMPORTANT] Συνιστάται να χρησιμοποιείτε πάντα την πιο πρόσφατη έκδοση του Management Studio για να παραμείνετε συγχρονισμένοι με ενημερώσεις για το Microsoft Azure και βάση δεδομένων SQL. [Ενημέρωση SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).


###<a name="create-new-table"></a>Δημιουργία νέου πίνακα

Χρησιμοποιήστε το στοιχείο μενού περιβάλλοντος "Νέο σύστημα έκδοση πίνακα" στην Εξερεύνηση αντικείμενο SSMS για να ανοίξετε το πρόγραμμα επεξεργασίας ερωτήματος με μια δέσμη ενεργειών πρότυπο χρονικό πίνακα και, στη συνέχεια, χρησιμοποιήστε "Καθορίστε τιμές για παραμέτρους προτύπου" (Ctrl + Shift + M) για να συμπληρώσετε το πρότυπο:

![SSMSNewTable](./media/sql-database-temporal-tables/AzureTemporal2.png)

Στο SSDT, επιλέξετε το πρότυπο "Χρονικό πίνακα (σύστημα έκδοση)" κατά την προσθήκη νέων στοιχείων για το έργο βάσης δεδομένων. Που θα ανοίξετε το πρόγραμμα σχεδίασης πίνακα και σάς επιτρέπουν να καθορίσετε εύκολα τη διάταξη πίνακα:

![SSDTNewTable](./media/sql-database-temporal-tables/AzureTemporal3.png)

Μπορείτε επίσης να δημιουργία χρονικό πίνακα καθορίζοντας τις προτάσεις Transact-SQL απευθείας, όπως φαίνεται στο παρακάτω παράδειγμα. Σημειώστε ότι τα υποχρεωτικά στοιχεία του κάθε χρονικό πίνακα είναι τον ορισμό της ΠΕΡΙΌΔΟΥ και τον όρο SYSTEM_VERSIONING με μια αναφορά σε έναν άλλο πίνακα χρήστη που θα αποθηκεύσει γραμμή ιστορικού εκδόσεων:

````
CREATE TABLE WebsiteUserInfo 
(  
    [UserID] int NOT NULL PRIMARY KEY CLUSTERED 
  , [UserName] nvarchar(100) NOT NULL
  , [PagesVisited] int NOT NULL 
  , [ValidFrom] datetime2 (0) GENERATED ALWAYS AS ROW START
  , [ValidTo] datetime2 (0) GENERATED ALWAYS AS ROW END
  , PERIOD FOR SYSTEM_TIME (ValidFrom, ValidTo)
 )  
 WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE = dbo.WebsiteUserInfoHistory));
````

Όταν δημιουργείτε συστήματος έκδοση χρονικό πίνακα, δημιουργείται αυτόματα συνοδευτικές πίνακα ιστορικού με τις προεπιλεγμένες ρυθμίσεις. Το προεπιλεγμένο πίνακα ιστορικού περιέχει ένα συγκεντρωτικό ευρετήριο δέντρου B σε στήλες περιόδου (τέλος, Έναρξη) με ενεργοποιημένη συμπίεση σελίδας. Αυτή η ρύθμιση παραμέτρων είναι βέλτιστη για το μεγαλύτερο μέρος των σενάρια στα οποία έχουν χρησιμοποιηθεί χρονικό πίνακες, ειδικά για [τον έλεγχο δεδομένων](https://msdn.microsoft.com/library/mt631669.aspx#Anchor_0). 

Στη συγκεκριμένη περίπτωση, στόχος για την εκτέλεση ανάλυσης τάσης βάσει χρόνου επάνω από ένα μεγαλύτερο ιστορικού δεδομένων και με το μεγαλύτερο σύνολα δεδομένων, ώστε η επιλογή αποθήκευσης για τον πίνακα ιστορικού είναι ένα ευρετήριο ομαδοποιημένων columnstore. Μια ομαδοποιημένη columnstore παρέχει πολύ καλή συμπίεση και επιδόσεων για αναλυτικής ερωτήματα. Χρονικό πίνακες παρέχουν την ευελιξία να ρυθμίσετε τις παραμέτρους ευρετήρια στους πίνακες τρέχον και το χρονικό εντελώς ξεχωριστά. 

**Σημείωση**: ευρετήρια Columnstore διατίθενται μόνο στο επίπεδο υπηρεσίας premium.

Η ακόλουθη δέσμη ενεργειών δείχνει πώς προεπιλεγμένο ευρετήριο στον πίνακα ιστορικού μπορεί να αλλάξει σε το ομαδοποιημένων columnstore:

````
CREATE CLUSTERED COLUMNSTORE INDEX IX_WebsiteUserInfoHistory
ON dbo.WebsiteUserInfoHistory
WITH (DROP_EXISTING = ON); 
````

Χρονικό πίνακες αντιπροσωπεύονται στην Εξερεύνηση του αντικειμένου με το συγκεκριμένο εικονίδιο για ευκολότερο εντοπισμό, ενώ το πίνακα ιστορικού εμφανίζεται ως ένα θυγατρικό κόμβο.

![AlterTable](./media/sql-database-temporal-tables/AzureTemporal4.png)

###<a name="alter-existing-table-to-temporal"></a>Η πρόταση ALTER υπάρχοντα πίνακα στο χρονικό

Ας καλύπτει το εναλλακτικό σενάριο όπου ο πίνακας WebsiteUserInfo υπάρχει ήδη, αλλά δεν έχει σχεδιαστεί για να διατηρήσετε ένα ιστορικό αλλαγών. Σε αυτήν την περίπτωση, μπορείτε απλώς να επεκτείνετε τον υπάρχοντα πίνακα για να γίνετε χρονικό, όπως φαίνεται στο ακόλουθο παράδειγμα:

````
ALTER TABLE WebsiteUserInfo 
ADD 
    ValidFrom datetime2 (0) GENERATED ALWAYS AS ROW START HIDDEN  
        constraint DF_ValidFrom DEFAULT DATEADD(SECOND, -1, SYSUTCDATETIME())
    , ValidTo datetime2 (0)  GENERATED ALWAYS AS ROW END HIDDEN   
        constraint DF_ValidTo DEFAULT '9999.12.31 23:59:59.99'
    , PERIOD FOR SYSTEM_TIME (ValidFrom, ValidTo); 

ALTER TABLE WebsiteUserInfo  
SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE = dbo.WebsiteUserInfoHistory));
GO

CREATE CLUSTERED COLUMNSTORE INDEX IX_WebsiteUserInfoHistory
ON dbo.WebsiteUserInfoHistory
WITH (DROP_EXISTING = ON); 
````

##<a name="step-2-run-your-workload-regularly"></a>Βήμα 2: Εκτέλεση του φόρτου εργασίας τακτικά

Το βασικό πλεονέκτημα χρονικό πινάκων είναι ότι δεν χρειάζεται να αλλάξετε ή να προσαρμόσετε την τοποθεσία Web με οποιονδήποτε τρόπο για να εκτελέσετε παρακολούθησης αλλαγών. Μετά τη δημιουργία, χρονικό πίνακες με διαφάνεια εξακολουθούν να εμφανίζονται προηγούμενες εκδόσεις γραμμής κάθε φορά που εκτελείτε τροποποιήσεις στα δεδομένα σας. 

Για να αξιοποιήσετε αυτόματης παρακολούθησης αλλαγών για αυτό το συγκεκριμένο σενάριο, ας απλώς ενημέρωση στήλης **PagesVisited** κάθε φορά που όταν λήξει η her/his περιόδου λειτουργίας στην τοποθεσία Web του χρήστη:

````
UPDATE WebsiteUserInfo  SET [PagesVisited] = 5 
WHERE [UserID] = 1;
````

Είναι σημαντικό να παρατηρήσετε ότι το ερώτημα ενημέρωσης δεν πρέπει να γνωρίζετε την ακριβή ώρα κατά την τρέχουσα εργασία Παρουσιάστηκε ούτε πώς θα διατηρηθούν τα παλαιότερα στοιχεία για μελλοντική ανάλυση. Και τα δύο στοιχεία αντιμετωπίζονται αυτόματα από τη βάση δεδομένων SQL Azure. Το παρακάτω διάγραμμα παρουσιάζει πώς δημιουργείται ιστορικού δεδομένων σε κάθε ενημέρωση.

![TemporalArchitecture](./media/sql-database-temporal-tables/AzureTemporal5.png)

##<a name="step-3-perform-historical-data-analysis"></a>Βήμα 3: Εκτέλεση ανάλυσης δεδομένων ιστορικού

Τώρα όταν είναι ενεργοποιημένη η χρονικό συστήματος-διαχείριση εκδόσεων, ιστορικών δεδομένων ανάλυσης είναι μόνο ένα ερώτημα μακριά από το που. Σε αυτό το άρθρο, θα παρέχουμε μερικά παραδείγματα συγκεκριμένη διεύθυνση ανάλυσης σενάρια - για να μάθετε όλες τις λεπτομέρειες, εξερευνήστε διάφορες επιλογές που έχουν εισαχθεί με τον όρο [SYSTEM_TIME για](https://msdn.microsoft.com/library/dn935015.aspx#Anchor_3) .

Για να δείτε τους πρώτων 10 χρήστες σύμφωνα με τον αριθμό των σελίδων που επισκεφθήκατε web από μία ώρα πριν από, εκτελέστε αυτό το ερώτημα:

````
DECLARE @hourAgo datetime2 = DATEADD(HOUR, -1, SYSUTCDATETIME());
SELECT TOP 10 * FROM dbo.WebsiteUserInfo FOR SYSTEM_TIME AS OF @hourAgo
ORDER BY PagesVisited DESC
````

Μπορείτε εύκολα να τροποποιήσετε αυτό το ερώτημα για να αναλύσετε τις επισκέψεις τοποθεσίας από μια ημέρα, πριν από ένα μήνα ή σε οποιοδήποτε σημείο στο παρελθόν που θέλετε.

Για να εκτελέσετε βασικές στατιστικής ανάλυσης για την προηγούμενη ημέρα, χρησιμοποιήστε το παρακάτω παράδειγμα:

````
DECLARE @twoDaysAgo datetime2 = DATEADD(DAY, -2, SYSUTCDATETIME());
DECLARE @aDayAgo datetime2 = DATEADD(DAY, -1, SYSUTCDATETIME());

SELECT UserID, SUM (PagesVisited) as TotalVisitedPages, AVG (PagesVisited) as AverageVisitedPages,
MAX (PagesVisited) AS MaxVisitedPages, MIN (PagesVisited) AS MinVisitedPages,
STDEV (PagesVisited) as StDevViistedPages
FROM dbo.WebsiteUserInfo 
FOR SYSTEM_TIME BETWEEN @twoDaysAgo AND @aDayAgo
GROUP BY UserId
````

Για να αναζητήσετε δραστηριότητες από έναν συγκεκριμένο χρήστη, μέσα σε ένα χρονικό διάστημα, χρησιμοποιήστε τον όρο που περιέχονται σε:

````
DECLARE @hourAgo datetime2 = DATEADD(HOUR, -1, SYSUTCDATETIME());
DECLARE @twoHoursAgo datetime2 = DATEADD(HOUR, -2, SYSUTCDATETIME());
SELECT * FROM dbo.WebsiteUserInfo 
FOR SYSTEM_TIME CONTAINED IN (@twoHoursAgo, @hourAgo)
WHERE [UserID] = 1;
````

Απεικόνιση γραφικού είναι ιδιαίτερα χρήσιμο για χρονικό ερωτήματα όπως μπορείτε να εμφανίσετε τάσεις και μοτίβα χρήσης σε ένα διαισθητικό τρόπο πολύ εύκολα:

![TemporalGraph](./media/sql-database-temporal-tables/AzureTemporal6.png)

##<a name="evolving-table-schema"></a>Σε εξέλιξη σχήματος πίνακα

Συνήθως, θα πρέπει να αλλάξετε το σχήμα χρονικό πίνακα ενώ πραγματοποιείτε ανάπτυξη εφαρμογών. Για αυτό, απλώς εκτέλεση κανονική πρόταση ALTER TABLE προτάσεις και βάση δεδομένων SQL Azure θα σωστά μεταδοθούν αλλαγές στον πίνακα ιστορικού. Η ακόλουθη δέσμη ενεργειών δείχνει πώς μπορείτε να προσθέσετε επιπλέον χαρακτηριστικό για παρακολούθηση:

````
/*Add new column for tracking source IP address*/
ALTER TABLE dbo.WebsiteUserInfo 
ADD  [IPAddress] varchar(128) NOT NULL CONSTRAINT DF_Address DEFAULT 'N/A';
````

Ομοίως, μπορείτε να αλλάξετε ορισμού στήλης με ενεργοποιημένο το φόρτο εργασίας:

````
/*Increase the length of name column*/
ALTER TABLE dbo.WebsiteUserInfo 
    ALTER COLUMN  UserName nvarchar(256) NOT NULL;
````

Τέλος, μπορείτε να καταργήσετε μια στήλη που δεν χρειάζεστε πλέον.

````
/*Drop unnecessary column */
ALTER TABLE dbo.WebsiteUserInfo 
    DROP COLUMN TemporaryColumn; 
````
    
Εναλλακτικά, μπορείτε να χρησιμοποιήσετε πιο πρόσφατη [SSDT](https://msdn.microsoft.com/library/mt204009.aspx) για αλλαγή σχήματος χρονικό πίνακα ενώ είστε συνδεδεμένοι στη βάση δεδομένων (online λειτουργίας) ή ως τμήμα του έργου βάσης δεδομένων (λειτουργία χωρίς σύνδεση).

##<a name="controlling-retention-of-historical-data"></a>Έλεγχος διατήρησης των δεδομένων του ιστορικού

Με το σύστημα έκδοση χρονικό πίνακες, τον πίνακα ιστορικού μπορούν να αυξήσουν το μέγεθος της βάσης δεδομένων περισσότερες από κανονική πίνακες. Μεγάλη και συνεχώς αναπτυσσόμενη ιστορικού πίνακα μπορεί να γίνει κάποιο πρόβλημα και τα δύο λόγω κόστος αμιγώς χώρου αποθήκευσης, καθώς και για την επιβολή επιδόσεις φόρο στο χρονικό υποβολή ερωτημάτων. Ως εκ τούτου, ανάπτυξη πολιτικής διατήρησης δεδομένων για τη διαχείριση δεδομένων στον πίνακα ιστορικού είναι σημαντική πτυχή του σχεδιασμού και τη διαχείριση του κύκλου ζωής του κάθε χρονικό πίνακα. Με βάση δεδομένων SQL Azure, έχετε τις ακόλουθες προσεγγίσεις για τη διαχείριση του ιστορικού δεδομένα στον πίνακα χρονικό:

- [Δημιουργία πίνακα διαμερισμάτων](https://msdn.microsoft.com/library/mt637341.aspx#Anchor_2)
- [Εκκαθάριση προσαρμοσμένη δέσμη ενεργειών](https://msdn.microsoft.com/library/mt637341.aspx#Anchor_3)

##<a name="next-steps"></a>Επόμενα βήματα

Για λεπτομερείς πληροφορίες σχετικά με τους πίνακες χρονικό, ανατρέξτε στο θέμα [τεκμηρίωση MSDN](https://msdn.microsoft.com/library/dn935015.aspx).
Επισκεφθείτε 9 καναλιού για να ακούσετε μια [ιστορία επιτυχίας πελατών πραγματικό χρονικό υλοποίησης](https://channel9.msdn.com/Blogs/jsturtevant/Azure-SQL-Temporal-Tables-with-RockStep-Solutions) και να παρακολουθήσετε ένα [πραγματικό χρονικό επίδειξης](https://channel9.msdn.com/Shows/Data-Exposed/Temporal-in-SQL-Server-2016).
