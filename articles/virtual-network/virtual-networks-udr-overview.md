<properties 
   pageTitle="Τι είναι οι διαδρομές που ορίζονται από το χρήστη και την προώθηση IP;"
   description="Μάθετε πώς να χρησιμοποιείτε διαδρομές που ορίζονται από το χρήστη (UDR) και την προώθηση IP για κίνηση προς τα εμπρός σε δίκτυο εικονικού συσκευές στο Azure."
   services="virtual-network"
   documentationCenter="na"
   authors="jimdial"
   manager="carmonm"
   editor="tysonn" />
<tags 
   ms.service="virtual-network"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="03/15/2016"
   ms.author="jdial" />

# <a name="what-are-user-defined-routes-and-ip-forwarding"></a>Τι είναι οι διαδρομές που ορίζονται από το χρήστη και την προώθηση IP;
Όταν προσθέτετε εικονικές μηχανές (ΣΠΣ) σε ένα εικονικό δίκτυο (VNet) στο Azure, θα παρατηρήσετε ότι το ΣΠΣ είναι μπορούν να επικοινωνούν μεταξύ τους μέσω του δικτύου, αυτόματα. Δεν χρειάζεται να καθορίσετε μια πύλη, ακόμα και αν το ΣΠΣ βρίσκονται σε διαφορετικά δευτερεύοντα δίκτυα. Το ίδιο ισχύει για επικοινωνία από το ΣΠΣ δημόσια στο Internet και ακόμη και να τον εσωτερικής υπάρχει δίκτυο, όταν μια σύνδεση υβριδική από το Azure με το δικό σας κέντρο δεδομένων.

Αυτήν τη ροή επικοινωνίας που είναι δυνατή, επειδή Azure χρησιμοποιεί μια σειρά από δρομολογεί συστήματος για να ορίσετε τον τρόπο ροής κυκλοφορίας IP. Δρομολογεί συστήματος τον έλεγχο της ροής επικοινωνίας στα ακόλουθα σενάρια:

- Από μέσα στο ίδιο υποδίκτυο.
- Από ένα υποδίκτυο σε ένα άλλο μέσα σε ένα VNet.
- Από το ΣΠΣ στο Internet.
- Από ένα VNet σε μια άλλη VNet μέσω μιας πύλης VPN.
- Από μια VNet στο δίκτυό σας στην εσωτερική εγκατάσταση μέσω μιας πύλης VPN.

Η παρακάτω εικόνα δείχνει μια απλή εγκατάσταση με μια VNet, δύο δευτερευόντων δικτύων και μερικά ΣΠΣ, μαζί με τις διαδρομές συστήματος που επιτρέπουν ροή κυκλοφορίας IP.

![Δρομολογεί συστήματος στο Azure](./media/virtual-networks-udr-overview/Figure1.png)

Αν και τη χρήση του συστήματος δρομολογεί διευκολύνει την κίνηση αυτόματα για την ανάπτυξη, υπάρχουν περιπτώσεις στις οποίες θέλετε να ελέγξετε τη δρομολόγηση των πακέτων μέσω μια εικονική συσκευή. Μπορείτε να επομένως, δημιουργώντας δρομολογεί ορίζονται από το χρήστη που καθορίσετε την επόμενη μεταπήδηση για πακέτα ρέει προς ένα συγκεκριμένο υποδίκτυο για να μεταβείτε αντί για αυτό το εικονικό συσκευής και ενεργοποιώντας προώθησης IP για την εικονική Μηχανή εκτελείται ως εικονικού συσκευής.

Η παρακάτω εικόνα εμφανίζει ένα παράδειγμα δρομολογεί ορίζονται από το χρήστη και προώθηση IP για να επιβάλετε πακέτα που αποστέλλονται σε μία υποδικτύου από έναν άλλον για να ακολουθήσετε μια εικονική συσκευή σε τρίτο υποδίκτυο.

![Δρομολογεί συστήματος στο Azure](./media/virtual-networks-udr-overview/Figure2.png)

>[AZURE.IMPORTANT] Δρομολογεί ορίζονται από το χρήστη εφαρμόζονται μόνο για να κλείσετε ένα υποδίκτυο την κυκλοφορία. Δεν μπορείτε να δημιουργήσετε διαδρομές για να καθορίσετε τον τρόπο κίνηση τίθεται σε ένα δευτερεύον δίκτυο από το Internet, για παράδειγμα. Επίσης, η συσκευή που προωθείτε κυκλοφορία στο δεν μπορεί να είναι στο ίδιο υποδίκτυο όπου προέρχεται η κυκλοφορία. Πάντα να δημιουργήσετε ένα ξεχωριστό υποδίκτυο για συσκευές σας. 

## <a name="route-resource"></a>Δρομολόγηση πόρων
Πακέτα δρομολογούνται μέσω δικτύου TCP/IP που βασίζεται σε έναν πίνακα δρομολόγηση που ορίζεται σε κάθε κόμβο στο φυσικό δίκτυο. Ένας πίνακας δρομολόγηση είναι μια συλλογή από μεμονωμένες διαδρομές που χρησιμοποιείται για την αποφασίστε για την προώθηση πακέτων με βάση τη διεύθυνση IP προορισμού. Μια διαδρομή αποτελείται από τα εξής:

|Ιδιότητα|Περιγραφή|Περιορισμοί|Ζητήματα|
|---|---|---|---|
| Πρόθεμα διεύθυνσης | Το οποίο αφορά τη διαδρομή, όπως 10.1.0.0/16 CIDR προορισμού.|Πρέπει να είναι μια έγκυρη περιοχή CIDR που αντιπροσωπεύει τις διευθύνσεις Internet δημόσια, Azure εικονικού δικτύου ή κέντρο δεδομένων εσωτερικής εγκατάστασης.|Βεβαιωθείτε ότι το **πρόθεμα διεύθυνσης** δεν περιέχει τη διεύθυνση για την **Επόμενη διεύθυνση μεταπήδησης**, διαφορετικά πακέτα σας θα εισαγάγετε σε επανάληψη μετάβαση από το αρχείο προέλευσης στην επόμενη αναπήδηση χωρίς να φτάσει ποτέ τον προορισμό. |
| Επόμενη μεταπήδηση τύπου | Τον τύπο του Azure μεταπήδηση το πακέτο πρέπει να σταλεί. | Πρέπει να είναι μία από τις παρακάτω τιμές: <br/> **Εικονικού δικτύου**. Αντιπροσωπεύει το εικονικό τοπικό δίκτυο. Για παράδειγμα, εάν έχετε δύο δευτερευόντων δικτύων, 10.1.0.0/16 και 10.2.0.0/16 στο ίδιο δίκτυο εικονικού, τη διαδρομή για κάθε υποδίκτυο στον πίνακα δρομολόγηση θα έχει μια επόμενη τιμή άλματος *Εικονικού*δικτύου. <br/> **Η πύλη εικονικού δικτύου**. Αντιπροσωπεύει μια πύλη VPN Azure S2S. <br/> **Στο Internet**. Αντιπροσωπεύει την προεπιλεγμένη πύλη Internet που παρέχεται από την υποδομή Azure. <br/> **Εικονική συσκευή**. Αντιπροσωπεύει μια εικονική συσκευή που προσθέσατε στο δίκτυό σας Azure εικονικού. <br/> **Κανένα**. Αντιπροσωπεύει ένα μαύρο Άνοιγμα. Πακέτα προωθούνται σε ένα άνοιγμα μαύρο δεν θα προωθούνται σε όλα.| Μπορείτε να χρησιμοποιήσετε έναν τύπο **καμία** για να διακόψετε την πακέτα από ροή για μια δεδομένη προορισμού. | 
| Επόμενη διεύθυνση μεταπήδησης | Επόμενη διεύθυνση μεταπήδησης περιέχει τη διεύθυνση IP που θα πρέπει να προωθείται πακέτα. Επόμενη μεταπήδηση τιμές επιτρέπονται μόνο σε διαδρομές όπου το επόμενο τύπος μεταπήδηση είναι *Εικονικού συσκευής*.| Πρέπει να είναι μια διεύθυνση IP που είναι δυνατή η πρόσβαση στο δίκτυο του εικονικού όπου έχει εφαρμοστεί η δρομολόγηση ορίζονται από το χρήστη. | Εάν η διεύθυνση IP αντιπροσωπεύει μια Εικονική, βεβαιωθείτε ότι ενεργοποιείτε την [προώθηση IP](#IP-forwarding) στο Azure για το Εικονική. |

Στο Azure PowerShell ορισμένες από τις τιμές "NextHopType" έχουν διαφορετικά ονόματα:
- Εικονικού δικτύου είναι VnetLocal
- Εικονικό πύλη δικτύου είναι VirtualNetworkGateway
- Εικονική συσκευή είναι VirtualAppliance
- Internet είναι στο Internet
- Καμία είναι κανένα

### <a name="system-routes"></a>Δρομολογεί συστήματος
Κάθε υποδίκτυο που δημιουργήθηκε σε ένα εικονικό δίκτυο συσχετίζεται αυτόματα με έναν πίνακα δρομολόγηση που περιέχει τους παρακάτω κανόνες δρομολόγηση συστήματος:

- **Τοπική Vnet κανόνα**: Αυτός ο κανόνας δημιουργείται αυτόματα για κάθε υποδίκτυο σε ένα εικονικό δίκτυο. Καθορίζει ότι υπάρχει μια απευθείας σύνδεση μεταξύ του ΣΠΣ στο το VNet και ότι δεν υπάρχει επόμενη ενδιάμεση αναπήδηση.
- **Κανόνας εσωτερικής εγκατάστασης**: Αυτός ο κανόνας ισχύει για όλη την κυκλοφορία που προορίζονται για την περιοχή διευθύνσεων εσωτερικής εγκατάστασης και χρησιμοποιεί πύλη VPN ως προορισμό της επόμενης μεταπήδησης.
- **Κανόνα Internet**: αυτό λαβές κανόνα όλη την κυκλοφορία που προορίζονται στο δημόσιο Internet (διεύθυνση πρόθεμα 0.0.0.0/0) και χρησιμοποιεί η πύλη internet υποδομής ως την επόμενη μεταπήδηση για όλη την κυκλοφορία που προορίζονται στο Internet.

### <a name="user-defined-routes"></a>Δρομολογεί ορίζονται από το χρήστη
Για περισσότερα περιβάλλοντα που θα χρειαστείτε μόνο τις διαδρομές συστήματος ήδη που ορίζονται από το Azure. Ωστόσο, ίσως χρειαστεί να δημιουργήσετε έναν πίνακα δρομολόγηση και προσθέστε μία ή περισσότερες διαδρομές σε συγκεκριμένες περιπτώσεις, όπως:

- Επιβάλετε διοχέτευση στο Internet μέσω του δικτύου σας εσωτερικής εγκατάστασης.
- Χρήση εικονικού συσκευές στο περιβάλλον του Azure.

Στα παραπάνω σενάρια, θα πρέπει να δημιουργήσετε έναν πίνακα δρομολόγηση και προσθέστε δρομολογεί ορίζονται από το χρήστη σε αυτήν. Μπορείτε να έχετε πολλούς πίνακες δρομολόγηση και στον ίδιο πίνακα δρομολόγηση μπορεί να είναι συσχετισμένη με ένα ή περισσότερα δευτερεύοντα δίκτυα. Και κάθε υποδίκτυο μπορεί να συνδεθεί σε μια μεμονωμένη δρομολόγηση πίνακα μόνο. Όλα τα ΣΠΣ και τις υπηρεσίες cloud σε υποδίκτυο Χρησιμοποιήστε τον πίνακα δρομολόγησης που σχετίζονται με αυτό το δευτερεύον δίκτυο.

Δευτερεύοντα δίκτυα που βασίζονται σε σύστημα δρομολογεί μέχρι να δρομολόγηση πίνακα είναι συσχετισμένη με το υποδίκτυο. Όταν υπάρχει μια συσχέτιση, δρομολόγηση μπορεί να γίνει με βάση σε μεγαλύτερου πρόθεμα Match (LPM) μεταξύ των δρομολογεί ορίζονται από το χρήστη και δρομολογεί συστήματος. Εάν υπάρχουν περισσότερες από μία δρομολόγηση με το ίδιο Ταίριασμα LPM, στη συνέχεια, μια διαδρομή επιλέγεται με βάση την προέλευσή με την εξής σειρά:

1. Δρομολόγηση καθορισμένο χρήστη
1. Το πρωτόκολλο BGP δρομολόγηση (όταν χρησιμοποιείται ExpressRoute)
1. Δρομολόγηση συστήματος

Για να μάθετε πώς μπορείτε να δημιουργήσετε διαδρομές που ορίζονται από το χρήστη, ανατρέξτε στο θέμα [πώς μπορείτε να δημιουργήσετε διαδρομές και ενεργοποίηση της προώθησης IP στο Azure](virtual-network-create-udr-arm-template.md).

>[AZURE.IMPORTANT] Δρομολογεί ορίζονται από το χρήστη εφαρμόζονται μόνο σε υπηρεσίες ΣΠΣ Azure και cloud. Για παράδειγμα, εάν θέλετε να προσθέσετε ένα τείχος προστασίας εικονικού συσκευής μεταξύ σας δίκτυο εσωτερικής εγκατάστασης και του Azure, θα πρέπει να δημιουργήσετε μια διαδρομή που ορίζονται από το χρήστη για τους πίνακές σας Azure δρομολόγηση που προωθεί όλη την κυκλοφορία μεταβαίνοντας στο χώρο διευθύνσεων εσωτερικής εγκατάστασης για το εικονικό μηχάνημα. Μπορείτε επίσης να προσθέσετε μια διαδρομή που ορίζονται από το χρήστη (UDR) για να το GatewaySubnet για να προωθήσετε όλη την κυκλοφορία από εσωτερικής εγκατάστασης σε Azure μέσω εικονικών συσκευής. Αυτή είναι μια πρόσφατης προσθήκης.

### <a name="bgp-routes"></a>Δρομολογεί το πρωτόκολλο BGP
Εάν έχετε μια σύνδεση ExpressRoute μεταξύ σας δίκτυο εσωτερικής εγκατάστασης και του Azure, μπορείτε να ενεργοποιήσετε το πρωτόκολλο BGP για μεταδοθούν δρομολογεί από το δίκτυο εσωτερικής εγκατάστασης για να Azure. Αυτές οι διαδρομές πρωτόκολλο BGP που χρησιμοποιούνται με τον ίδιο τρόπο ως δρομολογεί συστήματος και δρομολογεί ορίζονται από το χρήστη σε κάθε Azure υποδίκτυο. Για περισσότερες πληροφορίες ανατρέξτε στο θέμα [Εισαγωγή ExpressRoute](../expressroute/expressroute-introduction.md).

>[AZURE.IMPORTANT] Μπορείτε να ρυθμίσετε το περιβάλλον Azure για να χρησιμοποιήσετε ισχύ διοχέτευση μέσω του δικτύου σας στην εσωτερική εγκατάσταση, δημιουργώντας μια διαδρομή καθορισμένο χρήστη για 0.0.0.0/0 υποδικτύου που χρησιμοποιεί η πύλη VPN με την επόμενη μεταπήδηση. Ωστόσο, αυτή λειτουργεί μόνο εάν χρησιμοποιείτε μια πύλη VPN, δεν ExpressRoute. Έως το πρωτόκολλο BGP εξαναγκασμένη διοχέτευση έχει ρυθμιστεί για ExpressRoute.

## <a name="ip-forwarding"></a>Προώθηση IP
Όπως περιγράφεται παραπάνω, ένα από τα κύριοι λόγοι για να δημιουργήσετε μια διαδρομή καθορισμένο χρήστη είναι να προωθεί την κυκλοφορία σε μια εικονική συσκευή. Μια εικονική συσκευή είναι τίποτε από μια Εικονική που εκτελεί μια εφαρμογή που χρησιμοποιείται για το χειρισμό κίνηση του δικτύου με κάποιον τρόπο, όπως ένα τείχος προστασίας ή μια συσκευή NAT.

Αυτό εικονικού συσκευής Εικονική πρέπει να μπορούν να λαμβάνουν εισερχόμενη κυκλοφορία που δεν απευθύνεται στον εαυτό. Για να επιτρέψετε μια Εικονική να λαμβάνει κυκλοφορία απευθύνεται σε άλλους προορισμούς, πρέπει να ενεργοποιήσετε προώθησης IP για την εικονική Μηχανή. Αυτή είναι μια Azure, όχι μια ρύθμιση στο λειτουργικό σύστημα επισκέπτη.

## <a name="next-steps"></a>Επόμενα βήματα

- Μάθετε πώς μπορείτε να [δημιουργήσετε διαδρομές στο μοντέλο ανάπτυξης διαχείρισης πόρων](virtual-network-create-udr-arm-template.md) και τα συσχετίζετε σε δευτερεύοντα δίκτυα. 
- Μάθετε πώς μπορείτε να [δημιουργήσετε διαδρομές στο μοντέλο κλασική ανάπτυξης](virtual-network-create-udr-classic-ps.md) και συνδέετε σε δευτερεύοντα δίκτυα.
