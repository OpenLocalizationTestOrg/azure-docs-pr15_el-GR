<properties 
   pageTitle="Αντιμετώπιση προβλημάτων δρομολογεί - PowerShell | Microsoft Azure"
   description="Μάθετε πώς μπορείτε να αντιμετωπίσετε δρομολογεί στο μοντέλο ανάπτυξης διαχείρισης πόρων Azure χρησιμοποιώντας το Azure PowerShell."
   services="virtual-network"
   documentationCenter="na"
   authors="AnithaAdusumilli"
   manager="narayan"
   editor=""
   tags="azure-resource-manager"
/>
<tags 
   ms.service="virtual-network"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="09/23/2016"
   ms.author="anithaa" />

# <a name="troubleshoot-routes-using-azure-powershell"></a>Αντιμετώπιση προβλημάτων με χρήση του Azure PowerShell διαδρομές

> [AZURE.SELECTOR]
- [Πύλη του Azure](virtual-network-routes-troubleshoot-portal.md)
- [PowerShell](virtual-network-routes-troubleshoot-powershell.md)

Εάν αντιμετωπίζετε προβλήματα συνδεσιμότητας δικτύου για να ή από το Azure εικονική μηχανή (Εικονική), δρομολογεί μπορεί να οι που επηρεάζουν την σας ροών κίνηση Εικονική. Σε αυτό το άρθρο παρέχει μια επισκόπηση των δυνατοτήτων Διαγνωστικά για διαδρομές για να σας βοηθήσει να αντιμετωπίσετε περαιτέρω.

Δρομολόγηση πίνακες σχετίζονται με δευτερεύοντα δίκτυα και είναι αποτελεσματικές σε όλες τις συνδέσεις δικτύου (NIC) σε αυτό το δευτερεύον δίκτυο. Οι παρακάτω τύποι δρομολογεί μπορούν να εφαρμοστούν σε κάθε διασύνδεση δικτύου:

- **Σύστημα δρομολογεί:** Από προεπιλογή, κάθε υποδίκτυο που δημιουργήθηκε σε ένα δίκτυο εικονικού Azure (VNet) έχει πίνακες δρομολόγηση συστήματος που επιτρέπουν την τοπική κυκλοφορία VNet, κίνηση στην εσωτερική εγκατάσταση μέσω VPN πύλες και την κυκλοφορία του Internet. Υπάρχουν επίσης δρομολογεί συστήματος για peered VNets.
- **Δρομολογεί το πρωτόκολλο BGP:** Μεταδοθούν σε διασυνδέσεις δικτύου μέσω ExpressRoute ή συνδέσεις VPN--τοποθεσίας. Μάθετε περισσότερα σχετικά με το πρωτόκολλο BGP τη δρομολόγηση διαβάζοντας τα άρθρα [Επισκόπηση ExpressRoute](../expressroute/expressroute-introduction.md) και [το πρωτόκολλο BGP με VPN πυλών](../vpn-gateway/vpn-gateway-bgp-overview.md) .
- **Δρομολογεί που ορίζονται από το χρήστη (UDR):** Εάν χρησιμοποιείτε συσκευές εικονικού δικτύου ή είναι υποχρεωτική διοχέτευση κυκλοφορίας για ένα δίκτυο εσωτερικής εγκατάστασης μέσω VPN τοποθεσίας σε τοποθεσία, ενδέχεται να έχετε που ορίζονται από το χρήστη δρομολογεί (UDRs) και που σχετίζεται με τον πίνακα δρομολόγηση υποδικτύου. Εάν δεν είστε εξοικειωμένοι με UDRs, διαβάστε το άρθρο [δρομολογεί που ορίζονται από το χρήστη](virtual-networks-udr-overview.md#user-defined-routes) .

Με τις διάφορες διαδρομές που μπορούν να εφαρμοστούν σε ένα περιβάλλον εργασίας δικτύου, μπορεί να είναι δύσκολο να καθορίσετε ποια δρομολογεί συγκεντρωτικών αποτελεσμάτων είναι αποτελεσματικές. Για να βοηθήσετε στην αντιμετώπιση Εικονική η συνδεσιμότητα του δικτύου, μπορείτε να προβάλετε όλες τις αποτελεσματικές διαδρομές για ένα περιβάλλον εργασίας δικτύου στο μοντέλο ανάπτυξης Azure διαχείριση πόρων.

## <a name="using-effective-routes-to-troubleshoot-vm-traffic-flow"></a>Χρήση αποτελεσματικές διαδρομές για την αντιμετώπιση προβλημάτων ροής κυκλοφορίας Εικονική

Σε αυτό το άρθρο χρησιμοποιεί το ακόλουθο σενάριο ως παράδειγμα για την απεικόνιση Τρόπος αντιμετώπισης προβλημάτων αποτελεσματικές διαδρομές για ένα περιβάλλον εργασίας δικτύου:

Μια Εικονική (*VM1*) συνδεδεμένο με το VNet (*VNet1*, πρόθεμα: 10.9.0.0/16) αποτυγχάνει για να συνδεθείτε με μια VM(VM3) σε ένα νέο peered VNet (*VNet3*, 10.10.0.0/16 πρόθεμα). Υπάρχουν χωρίς UDRs ή το πρωτόκολλο BGP δρομολογεί εφαρμόζεται σε διασύνδεση δικτύου VM1 NIC1 συνδεδεμένο με την εικονική Μηχανή, εφαρμόζονται μόνο δρομολογεί συστήματος.

Σε αυτό το άρθρο εξηγεί τον τρόπο για να προσδιορίσετε την αιτία της αποτυχίας σύνδεσης, χρησιμοποιώντας τη δυνατότητα αποτελεσματικές δρομολογεί στο μοντέλο ανάπτυξης διαχείρισης πόρων Azure.
Ενώ το παράδειγμα χρησιμοποιεί μόνο δρομολογεί συστήματος, τα ίδια βήματα μπορεί να χρησιμοποιηθεί για τον καθορισμό αποτυχίες εισερχόμενων και εξερχόμενων συνδέσεων σε οποιονδήποτε τύπο δρομολόγηση.

>[AZURE.NOTE] Εάν η Εικονική σας έχει περισσότερες από μία NIC συνημμένα, επιλέξτε αποτελεσματικές διαδρομές για κάθε έναν από το NIC για τη διάγνωση ζητημάτων συνδεσιμότητας προς και από μια Εικονική.

### <a name="view-effective-routes-for-a-virtual-machine"></a>Προβολή αποτελεσματικές διαδρομές για μια εικονική μηχανή

Για να δείτε τις διαδρομές συγκεντρωτικών αποτελεσμάτων που εφαρμόζονται σε μια Εικονική, ολοκληρώστε τα ακόλουθα βήματα:

### <a name="view-effective-routes-for-a-network-interface"></a>Προβολή αποτελεσματικών διαδρομές για ένα περιβάλλον εργασίας δικτύου

Για να δείτε τις διαδρομές συγκεντρωτικών αποτελεσμάτων που εφαρμόζονται σε ένα περιβάλλον εργασίας δικτύου, ολοκληρώστε τα ακόλουθα βήματα:

1.  Ξεκινήστε μια περίοδο λειτουργίας Azure PowerShell και να συνδεθείτε στη Azure. Εάν δεν είστε εξοικειωμένοι με το Azure PowerShell, διαβάστε το άρθρο [πώς μπορείτε να εγκαταστήσετε και να ρυθμίσετε τις παραμέτρους του PowerShell Azure](../powershell-install-configure.md) .

2.  Η παρακάτω εντολή επιστρέφει όλες οι διαδρομές που εφαρμόζεται σε ένα περιβάλλον εργασίας δικτύου με το όνομα *VM1 NIC1* στην ομάδα πόρων *RG1*.

        Get-AzureRmEffectiveRouteTable -NetworkInterfaceName VM1-NIC1 -ResourceGroupName RG1

    >[AZURE.TIP] Εάν δεν γνωρίζετε το όνομα του ένα περιβάλλον εργασίας δικτύου, πληκτρολογήστε την παρακάτω εντολή για να ανακτήσετε τα ονόματα όλων των διασυνδέσεων δικτύου σε μια group.* πόρων

        Get-AzureRmNetworkInterface -ResourceGroupName RG1 | Format-Table Name

    Το παρακάτω αποτέλεσμα μοιάζει με την έξοδο για κάθε δρομολόγηση εφαρμόζονται στο υποδίκτυο NIC είναι συνδεδεμένο σε:

        Name :
        State : Active
        AddressPrefix : {10.9.0.0/16}
        NextHopType : VNetLocal
        NextHopIpAddress : {}

        Name :
        State : Active
        AddressPrefix : {0.0.0.0/16}
        NextHopType : Internet
        NextHopIpAddress : {}

    Παρατηρήστε τα εξής στο αποτέλεσμα:
    - **Όνομα**: το όνομα της διαδρομής αποτελεσματικές μπορεί να είναι κενό, εκτός εάν καθορίζεται ρητά για διαδρομές που ορίζονται από το χρήστη. 
    - **Κατάσταση**: υποδεικνύει κατάσταση της διαδρομής αποτελεσματικές. Οι πιθανές τιμές είναι "Ενεργό" ή "Δεν είναι έγκυρο"
    - **AddressPrefixes**: Καθορίζει το πρόθεμα διεύθυνσης της διαδρομής αποτελεσματικές σε CIDR σημειογραφία. 
    - **nextHopType**: υποδεικνύει την επόμενη μεταπήδηση για τη δεδομένη διαδρομή. Πιθανές τιμές είναι *VirtualAppliance*, *Internet*, *VNetLocal*, *VNetPeering*ή *Null*. Η τιμή *Null* για **nextHopType** σε μια UDR μπορεί να υποδεικνύουν μια διαδρομή δεν είναι έγκυρη. Για παράδειγμα, εάν είναι **nextHopType** *VirtualAppliance* και το εικονικό δίκτυο συσκευής Εικονική δεν είναι σε κατάσταση παρασχεθεί εκτελείται. Εάν **nextHopType** είναι *VPNGateway* και δεν υπάρχει καμία πύλης παρασχεθεί/εκτελείται στο τη δεδομένη VNet, η διαδρομή μπορεί να είναι έγκυρες.
    - **NextHopIpAddress**: Καθορίζει τη διεύθυνση IP της επόμενης μεταπήδησης της διαδρομής αποτελεσματικές.
    
    Την ακόλουθη εντολή επιστρέφει τις διαδρομές σε μια πιο εύκολη για να προβάλετε πίνακα:

        Get-AzureRmEffectiveRouteTable -NetworkInterfaceName VM1-NIC1 -ResourceGroupName RG1 | Format-Table

    Το παρακάτω αποτέλεσμα είναι μέρος του προϊόντος που λάβατε για το σενάριο που περιγράφονται προηγουμένως:

        Name State AddressPrefix NextHopType NextHopIpAddress
        ---- ----- ------------- ----------- ----------------
        Active {10.9.0.0/16} VnetLocal {}
        Active {0.0.0.0/0} Internet {}
    

3. Δεν υπάρχει διαδρομή που εμφανίζεται το VNet *WestUS VNet3* (πρόθεμα 10.10.0.0/16)* * από *WestUS VNet1* (πρόθεμα 10.9.0.0/16) στο αποτέλεσμα του από το προηγούμενο βήμα. Όπως φαίνεται στην παρακάτω εικόνα, η σύνδεση peering VNet με το VNet *WestUS VNet3* είναι σε κατάσταση *Αποσύνδεση* .
    
    ![](./media/virtual-network-routes-troubleshoot-portal/image4.png)

    Η σύνδεση διπλής κατεύθυνσης για το διεισδύουν είναι κατεστραμμένη, που εξηγεί γιατί VM1 δεν ήταν δυνατό να συνδεθεί VM3 στο το VNet *WestUS VNet3* . Ξανά το πρόγραμμα εγκατάστασης σύνδεσης peering VNet διπλής κατεύθυνσης για *WestUS VNet1* και VNets *WestUS VNet3* . Το αποτέλεσμα που επιστρέφεται αφού δημιουργηθεί σωστά η σύνδεση peering VNet ακολουθεί:

        Name State AddressPrefix NextHopType NextHopIpAddress
        ---- ----- ------------- ----------- ----------------
        Active {10.9.0.0/16} VnetLocal {}
        Active {10.10.0.0/16} VNetPeering {}
        Active {0.0.0.0/0} Internet {}
        
    Αφού προσδιορίσετε το θέμα, μπορείτε να προσθέσετε, καταργήσετε, ή αλλάξτε δρομολογεί και δρομολόγηση πίνακες. Πληκτρολογήστε την παρακάτω εντολή για να δείτε μια λίστα με τις εντολές που χρησιμοποιούνται για να το κάνετε:

        Get-Help *-AzureRmRouteConfig

## <a name="considerations"></a>Ζητήματα

Ορισμένα πράγματα που πρέπει να λάβετε υπόψη κατά την αναθεώρηση τη λίστα των διαδρομών επιστραφεί:

- Δρομολόγηση βασίζεται σε μεγαλύτερου πρόθεμα Match (LPM) μεταξύ των UDRs, δρομολογεί το πρωτόκολλο BGP και του συστήματος. Εάν υπάρχουν περισσότερες από μία δρομολόγηση με το ίδιο Ταίριασμα LPM, στη συνέχεια, μια διαδρομή επιλέγεται με βάση την προέλευσή με την εξής σειρά:
    - Δρομολόγηση που ορίζονται από το χρήστη
    - Το πρωτόκολλο BGP δρομολόγηση
    - Δρομολόγηση του συστήματος (προεπιλογή)

    Αποτελεσματική διαδρομές, μπορείτε να δείτε μόνο αποτελεσματικών δρομολογεί που έχουν αντιστοιχία LPM που βασίζονται σε όλες τις διαδρομές διαθέσιμου. Που δείχνει πώς το δρομολογεί είναι στην πραγματικότητα που υπολογίζεται για μια δεδομένη NIC, αυτό καθιστά πολύ πιο εύκολη για την αντιμετώπιση προβλημάτων συγκεκριμένες διαδρομές που μπορεί να οι που επηρεάζουν την συνδεσιμότητας προς/από την Εικονική.

- Εάν έχετε UDRs και παραδίδετε την κυκλοφορία σε μια συσκευή εικονικού δικτύου (NVA), με *VirtualAppliance* ως **nextHopType**, βεβαιωθείτε ότι προώθηση IP είναι ενεργοποιημένο το NVA λαμβάνει την κυκλοφορία ή πακέτα χάνονται. 
- Εάν είναι ενεργοποιημένη η διοχέτευση προσαρμοσμένο, όλη την εξερχόμενη κυκλοφορία Internet θα δρομολογούνται στην εσωτερική εγκατάσταση. RDP/SSH από το Internet για να σας Εικονική ενδέχεται να μην λειτουργούν με αυτήν τη ρύθμιση, ανάλογα με τον τρόπο που το εσωτερικής χειρίζεται αυτήν την κυκλοφορία. 
  Υποχρεωτική διοχέτευση μπορεί να ενεργοποιηθεί:
    - Εάν χρησιμοποιείτε VPN-τοποθεσίας, ορίζοντας μια διαδρομή που ορίζονται από το χρήστη (UDR) με nextHopType ως πύλη VPN
    - Εάν ένα προεπιλεγμένο δρομολόγιο κοινοποιείται πάνω από το πρωτόκολλο BGP
- Για την VNet διεισδύουν κίνηση για να λειτουργήσει σωστά, πρέπει να υπάρχει μια δρομολόγηση συστήματος με **nextHopType** *VNetPeering* για περιοχή πρόθεμα του peered VNet. Εάν δεν υπάρχει η δρομολόγηση και τη σύνδεση peering VNet μοιάζει OK:
    - Περιμένετε μερικά δευτερόλεπτα και προσπαθήστε ξανά, εάν πρόκειται για μια σύνδεση που μόλις υπάρχοντα peering. Κάποιες φορές διαρκεί περισσότερο χρόνο για μεταδοθούν διαδρομές για όλες τις διασυνδέσεις δικτύου σε ένα δευτερεύον δίκτυο.
    - Ομάδα ασφαλείας δικτύου (NSG) κανόνες πιθανές οι ροές κυκλοφορίας. Για περισσότερες πληροφορίες, ανατρέξτε στο άρθρο [Αντιμετώπιση προβλημάτων με τις ομάδες ασφαλείας δικτύου](virtual-network-nsg-troubleshoot-powershell.md) .
