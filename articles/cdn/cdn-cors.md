<properties
    pageTitle="Χρήση του Azure CDN με CORS | Microsoft Azure"
    description="Μάθετε πώς να χρησιμοποιείτε το Azure περιεχομένου παράδοσης δικτύου (CDN) για να με σταυρό Origin πόρων κοινής χρήσης (CORS)."
    services="cdn"
    documentationCenter=""
    authors="camsoper"
    manager="erikre"
    editor=""/>

<tags
    ms.service="cdn"
    ms.workload="tbd"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="09/30/2016"
    ms.author="casoper"/>
    
# <a name="using-azure-cdn-with-cors"></a>Χρήση του Azure CDN με CORS     

## <a name="what-is-cors"></a>Τι είναι το CORS;

CORS (Cross Origin κοινή χρήση πόρων) είναι μια δυνατότητα HTTP που επιτρέπει σε μια εφαρμογή web εκτελείται σε ένα τομέα για να αποκτήσετε πρόσβαση σε πόρους σε άλλον τομέα. Για να μειώσετε την πιθανότητα των δεσμών ενεργειών επιθέσεις διατοποθεσιακή, όλα τα προγράμματα περιήγησης web σύγχρονο υλοποίηση ενός περιορισμού ασφαλείας γνωστό ως [ίδια προέλευση πολιτικής](http://www.w3.org/Security/wiki/Same_Origin_Policy).  Αυτό δεν επιτρέπει μιας ιστοσελίδας από κλήσης APIs σε διαφορετικό τομέα.  CORS παρέχει έναν ασφαλή τρόπο για να επιτρέψετε σε έναν τομέα (τον τομέα origin) για να καλέσετε APIs σε άλλον τομέα.
 
## <a name="how-it-works"></a>Πώς λειτουργεί
1.  Το πρόγραμμα περιήγησης στέλνει την αίτηση ΕΠΙΛΟΓΈΣ με μια κεφαλίδα **Origin** HTTP. Η τιμή του αυτή η κεφαλίδα είναι ο τομέας που λειτουργούσαν τη γονική σελίδα. Όταν μια σελίδα από https://www.contoso.com επιχειρεί να έχουν πρόσβαση σε δεδομένα του χρήστη στον τομέα fabrikam.com, θα σταλεί την ακόλουθη κεφαλίδα αίτησης στους fabrikam.com: 
    
    `Origin: https://www.contoso.com`
 
2.  Ο διακομιστής μπορεί να ανταποκριθεί με τα εξής:
    - Μια κεφαλίδα **Access-ελέγχου-επιτρέπουν-Origin** την απάντηση που υποδεικνύει ποιες τοποθεσίες origin επιτρέπονται. Για παράδειγμα:
        
        `Access-Control-Allow-Origin: https://www.contoso.com`
        
    - Σελίδα σφάλματος εάν ο διακομιστής δεν επιτρέπει την αίτηση origin σταυρού
    - Μια κεφαλίδα **Access-ελέγχου-επιτρέπουν-Origin** με ένα χαρακτήρα μπαλαντέρ που επιτρέπει σε όλους τους τομείς:
        
        `Access-Control-Allow-Origin: *`
 
Για σύνθετες αιτήσεις HTTP, υπάρχει μια "προκαταρκτικού ελέγχου" αίτηση πρώτα τη διαδικασία για να προσδιορίσετε αν έχει δικαίωμα πριν να στείλετε την πρόσκληση σε ολόκληρο.
 
## <a name="wildcard-or-single-origin-scenarios"></a>Χαρακτήρας μπαλαντέρ ή μία origin σενάρια

CORS σε Azure CDN θα λειτουργήσει αυτόματα με καμία επιπλέον ρύθμιση παραμέτρων κατά την κεφαλίδα **Access-ελέγχου-επιτρέπουν-Origin** έχει οριστεί σε μπαλαντέρ (*) ή ένα μεμονωμένο origin.  Το CDN αποθηκεύει προσωρινά την πρώτη απάντηση και οι επακόλουθες απαιτήσεις θα χρησιμοποιούν την ίδια επικεφαλίδα.
 
Εάν έχουν γίνει ήδη αιτήσεις για να το CDN πριν από τη ρύθμιση στο CORS το origin σας, θα χρειαστεί να εκκαθάριση περιεχόμενο στο περιεχόμενό σας τελικό σημείο για να φορτώσετε ξανά το περιεχόμενο με την **Access-ελέγχου-επιτρέπουν-Origin** επικεφαλίδα.
 
## <a name="multiple-origin-scenarios"></a>Πολλές origin σενάρια

Εάν χρειάζεστε για να επιτρέψετε σε μια συγκεκριμένη λίστα προελεύσεις για να επιτρέπεται για CORS, πράγματα που πρέπει να λίγο πιο περίπλοκη. Το πρόβλημα παρουσιάζεται όταν το CDN αποθηκεύει προσωρινά την κεφαλίδα **Access-ελέγχου-επιτρέπουν-Origin** για την πρώτη προέλευση CORS.  Όταν μια διαφορετική προέλευση CORS κάνει μια αίτηση οι επόμενες, το CDN θα εξυπηρετεί η στο cache επικεφαλίδα **Access-ελέγχου-επιτρέπουν-Origin** , η οποία δεν θα ταιριάζουν με.  Υπάρχουν πολλοί τρόποι για να διορθώσετε αυτό το πρόβλημα.
 
### <a name="azure-cdn-premium-from-verizon"></a>Azure CDN Premium από Verizon

Ο καλύτερος τρόπος για να ενεργοποιήσετε την αυτό είναι να χρησιμοποιήσετε **Premium CDN Azure από Verizon**, που εκθέτει ορισμένες λειτουργίες για προχωρημένους. 
 
Θα χρειαστεί να [δημιουργήσετε έναν κανόνα](cdn-rules-engine.md) για να ελέγξετε την κεφαλίδα **Origin** στην αίτηση.  Εάν πρόκειται για μια έγκυρη origin, τον κανόνα σας θα ορίσετε την κεφαλίδα **Access-ελέγχου-επιτρέπουν-Origin** με την προέλευση που παρέχεται στην πρόσκληση σε.  Εάν η προέλευση που καθορίζεται στην κεφαλίδα της **προέλευσης** δεν επιτρέπεται, τον κανόνα σας θα πρέπει να παραλείψετε την επικεφαλίδα **Access-ελέγχου-επιτρέπουν-Origin** η οποία θα έχει ως αποτέλεσμα το πρόγραμμα περιήγησης για να απορρίψετε την αίτηση. 
 
Υπάρχουν δύο τρόποι για να το κάνετε αυτό με το μηχανισμό κανόνων.  Και στις δύο περιπτώσεις, παραβλέπεται εντελώς την κεφαλίδα **Access-ελέγχου-επιτρέπουν-Origin** από το διακομιστή του αρχείου προέλευσης, το CDN κανόνες μηχανισμός διαχειρίζεται εντελώς το επιτρεπόμενο προελεύσεις CORS.

#### <a name="one-regular-expression-with-all-valid-origins"></a>Ένα κανονικό παράσταση με όλες τις έγκυρες προελεύσεις
 
Σε αυτήν την περίπτωση, θα δημιουργήσετε μια κανονική έκφραση που περιλαμβάνει όλα τα προελεύσεις που θέλετε να επιτρέψετε: 

    https?:\/\/(www\.contoso\.com|contoso\.com|www\.microsoft\.com|microsoft.com\.com)$
 
> [AZURE.TIP] **Azure CDN από Verizon** χρησιμοποιεί [Perl συμβατά κανονικές εκφράσεις](http://pcre.org/) το μηχανισμό για κανονικές εκφράσεις.  Μπορείτε να χρησιμοποιήσετε ένα εργαλείο όπως [κανονικές εκφράσεις 101](https://regex101.com/) για την επικύρωση κανονική παράστασή σας.  Σημειώστε ότι το χαρακτήρα "/" είναι έγκυροι στα κανονικές εκφράσεις και δεν χρειάζεται να είναι διαφυγής, ωστόσο, Απαλλαχτείτε από αυτό το χαρακτήρα θεωρείται βέλτιστη πρακτική και αναμένεται από ορισμένα προγράμματα επικύρωσης regex.

Αν συμφωνεί με την κανονική έκφραση, τον κανόνα σας θα αντικαταστήσει την κεφαλίδα **Access-ελέγχου-επιτρέπουν-Origin** (εάν υπάρχει) από το αρχικό με την προέλευση που έστειλε την αίτηση.  Μπορείτε επίσης να προσθέσετε επιπλέον κεφαλίδες CORS, όπως η **Access--επιτρέπουν-μεθόδων ελέγχου**.

![Παράδειγμα κανόνων με κανονική έκφραση](./media/cdn-cors/cdn-cors-regex.png)
 
#### <a name="request-header-rule-for-each-origin"></a>Πρόσκληση σε κεφαλίδα κανόνα για κάθε προέλευση.

Και όχι κανονικών παραστάσεων, μπορείτε αντί για αυτό να δημιουργήσετε έναν νέο κανόνα για κάθε προέλευση που θέλετε να επιτρέψετε χρησιμοποιώντας την **Αίτηση μπαλαντέρ κεφαλίδα** [ταιριάζει με συνθήκη](https://msdn.microsoft.com/library/mt757336.aspx#Anchor_1). Όπως και με τη μέθοδο κανονική παράσταση, το μηχανισμό κανόνων από μόνο του ορίζει τις κεφαλίδες CORS. 
  
![Παράδειγμα κανόνων χωρίς κανονικής έκφρασης](./media/cdn-cors/cdn-cors-no-regex.png)

> [AZURE.TIP] Στο παραπάνω παράδειγμα, τη χρήση του χαρακτήρα μπαλαντέρ * σας ενημερώνει για το μηχανισμό κανόνες ώστε να ταιριάζει με HTTP και HTTPS.
 
### <a name="azure-cdn-standard"></a>Τυπική Azure CDN

Σε τυπική CDN Azure προφίλ, ο μόνος μηχανισμός για να επιτρέψετε για πολλές προελεύσεις χωρίς τη χρήση της προέλευσης μπαλαντέρ είναι να χρησιμοποιήσετε [σε cache συμβολοσειρά ερωτήματος](cdn-query-string.md).  Πρέπει να ενεργοποιήσετε τη ρύθμιση συμβολοσειρά ερωτήματος για το τελικό σημείο CDN και, στη συνέχεια, χρησιμοποιήστε μια συμβολοσειρά ερωτήματος μοναδικό για αιτήσεις από κάθε επιτρεπόμενων τομέα. Αυτή η ενέργεια θα έχει ως αποτέλεσμα το CDN σε cache ένα ξεχωριστό αντικείμενο για κάθε συμβολοσειρά ερωτήματος μοναδικών τιμών. Αυτή η προσέγγιση δεν είναι ιδανική, ωστόσο, καθώς αυτό θα έχει ως αποτέλεσμα πολλά αντίγραφα του ίδιου αρχείου σε το CDN στο cache.  

