<properties
   pageTitle="Διανομή πίνακες στην αποθήκη δεδομένων του SQL | Microsoft Azure"
   description="Γρήγορα αποτελέσματα με τη διανομή πίνακες στην αποθήκη δεδομένων του SQL Azure."
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="jrowlandjones"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="08/30/2016"
   ms.author="jrj;barbkess;sonyama"/>

# <a name="distributing-tables-in-sql-data-warehouse"></a>Διανομή πίνακες στην αποθήκη δεδομένων του SQL

> [AZURE.SELECTOR]
- [Επισκόπηση][]
- [Τύποι δεδομένων][]
- [Διανομή][]
- [Ευρετήριο][]
- [Partition][]
- [Στατιστικά στοιχεία][]
- [Προσωρινό][]

Αποθήκη δεδομένων του SQL είναι μια παράλληλη μαζικά επεξεργασίας (MPP) Κατανεμημένο σύστημα βάσης δεδομένων.  Από τη διαίρεση δεδομένων και επεξεργασίας τη δυνατότητα σε πολλούς κόμβους, αποθήκη δεδομένων του SQL μπορεί να προσφέρει τεράστιες κλιμάκωση - άκρο πέρα από οποιοδήποτε μεμονωμένο σύστημα.  Επιλογή του τρόπου για τη διανομή δεδομένων σας εντός σας αποθήκη δεδομένων του SQL είναι ένας από τους πιο σημαντικές παράγοντες για την επίτευξη βέλτιστη απόδοση.   Το κλειδί για βέλτιστη απόδοση είναι Ελαχιστοποίηση κίνηση δεδομένων και με τη σειρά του πλήκτρου για την ελαχιστοποίηση κίνηση δεδομένων είναι η ενεργοποίηση της στρατηγικής δεξιά διανομής.

## <a name="understanding-data-movement"></a>Κατανόηση των δεδομένων κίνηση

Σε ένα σύστημα MPP, τα δεδομένα από κάθε πίνακα διαιρείται σε διάφορες υποκείμενα βάσεις δεδομένων.  Τα πιο βελτιστοποιημένη ερωτήματα σε ένα σύστημα MPP μπορεί να είναι πέρασε απλώς να εκτελέσει στη τις μεμονωμένες βάσεις δεδομένων κατανέμεται χωρίς αλληλεπίδραση μεταξύ των βάσεων δεδομένων.  Για παράδειγμα, ας υποθέσουμε ότι έχετε μια βάση δεδομένων με δεδομένα πωλήσεων που περιέχει δύο πίνακες, πωλήσεων και τους πελάτες.  Εάν έχετε ένα ερώτημα που πρέπει να συμμετάσχουν πωλήσεων πίνακα στον πίνακα πελατών και διαιρέστε τόσο πωλήσεων και πίνακες πελατών του από έναν αριθμό πελατών, να τοποθετείτε κάθε πελάτη σε μια ξεχωριστή βάση δεδομένων, οποιαδήποτε ερωτήματα που συμμετοχή πωλήσεων και πελάτη μπορούν να επιλυθούν μέσα σε κάθε βάση δεδομένων που δεν γνωρίζει τις άλλες βάσεις δεδομένων.  Αντίθετα, εάν διαιρείται των δεδομένων πωλήσεων κατά αριθμό παραγγελίας και τα δεδομένα πελατών σας με αριθμό πελατών, στη συνέχεια, οποιαδήποτε δεδομένη βάση δεδομένων δεν θα έχουν τα αντίστοιχα δεδομένα για κάθε πελάτη και, επομένως, αν θέλετε να συμμετάσχετε των δεδομένων πωλήσεων με δεδομένα του πελάτη, θα πρέπει να λάβετε τα δεδομένα για κάθε πελάτη από τις άλλες βάσεις δεδομένων.  Σε αυτό το δεύτερο παράδειγμα κίνηση δεδομένων θα πρέπει να προκύψουν για να μετακινήσετε τα δεδομένα πελατών για τα δεδομένα πωλήσεων, έτσι ώστε να μπορούν να συνδεθούν τους δύο πίνακες.  

Κίνηση δεδομένων δεν είναι πάντα εσφαλμένες τίποτα, μερικές φορές είναι απαραίτητο για την επίλυση ενός ερωτήματος.  Αλλά, όταν αυτό το βήμα επιπλέον μπορεί να αποφεύγονται, ομαλά το ερώτημα θα εκτελεστεί πιο γρήγορα.  Κίνηση δεδομένων προκύπτει πιο συχνά όταν είστε συνδεδεμένοι πίνακες ή συναθροίσεις εκτελούνται.  Συχνά πρέπει να κάνετε και τα δύο, ώστε να ενώ ενδέχεται να μπορείτε να βελτιστοποιήσετε για ένα σενάριο, όπως ένα σύνδεσμο, εξακολουθείτε να χρειάζεστε κίνηση δεδομένων για να σας βοηθήσουν να επιλύσετε για άλλες το σενάριο, όπως μια συγκέντρωση.  Το μυστικό είναι Κατανόηση που είναι λιγότερη εργασία.  Στις περισσότερες περιπτώσεις, τη διανομή πινάκων μεγάλων δεδομένων σε μια στήλη συνήθως ενωμένα είναι η πιο αποτελεσματική μέθοδος για τη μείωση της την κυκλοφορία περισσότερα δεδομένα.  Διανομή δεδομένα σε στήλες συνδέσμου είναι μια πολύ πιο κοινές μέθοδος για να μειώσετε την κίνηση δεδομένων από τη διανομή δεδομένα στις στήλες που περιλαμβάνονται σε μια συγκέντρωση.

## <a name="select-distribution-method"></a>Επιλέξτε τη μέθοδο διανομής

Τι συμβαίνει στο παρασκήνιο, αποθήκη δεδομένων του SQL χωρίζει τα δεδομένα σας σε 60 βάσεις δεδομένων.  Κάθε μεμονωμένη βάση δεδομένων είναι αναφέρεται ως μια **κατανομή**.  Κατά τη φόρτωση των δεδομένων σε κάθε πίνακα, έχει αποθήκη δεδομένων του SQL για να μάθετε πώς μπορείτε να διαιρέσετε τα δεδομένα σας σε αυτά τα 60 κατανομές.  

Η μέθοδος διανομής ορίζεται σε επίπεδο πίνακα και αυτήν τη στιγμή υπάρχουν δύο επιλογές:

1. **Round robin** που διανομή δεδομένων ομοιόμορφα αλλά τυχαία.
2. **Κατανεμημένο κατακερματισμός** που κατανέμει δεδομένων βάσει ο κατακερματισμός τιμές από μία στήλη

Από προεπιλογή, όταν δεν ορίσετε μια μέθοδο διανομής δεδομένων, τον πίνακα θα διανεμηθεί χρησιμοποιώντας τη μέθοδο διανομής **round robin** .  Ωστόσο, καθώς γίνονται πιο εξελιγμένη στην υλοποίηση της, θα θέλετε να μπορείτε να χρησιμοποιήσετε **κατανεμημένο κατακερματισμός** πίνακες για να ελαχιστοποιήσετε την κίνηση δεδομένων που θα με τη σειρά βελτιστοποίηση των επιδόσεων του ερωτήματος.

### <a name="round-robin-tables"></a>Οι πίνακες ROUND Robin

Χρησιμοποιώντας τη μέθοδο Round Robin από τη διανομή δεδομένων είναι πολύ πολύ πώς φαίνεται.  Κατά τη φόρτωση των δεδομένων σας, κάθε γραμμή αποστέλλεται απλώς την επόμενη κατανομή.  Αυτή η μέθοδος τη διανομή των δεδομένων θα πάντα τυχαία ομοιόμορφη κατανομή των δεδομένων πολύ σε όλα τα κατανομές.  Αυτό σημαίνει ότι υπάρχει χωρίς ταξινόμηση έτοιμοι κατά τη διαδικασία round robin που τοποθετεί τα δεδομένα σας.  Μια κατανομή round robin μερικές φορές ονομάζεται τυχαία κατακερματισμός για αυτόν το λόγο.  Με έναν πίνακα κατανέμεται round robin δεν χρειάζεται να κατανοήσετε τα δεδομένα.  Για αυτόν το λόγο, πίνακες Round Robin κάνετε συχνά καλή τη φόρτωση των προορισμών.

Από προεπιλογή, αν υπάρχει μέθοδος κατανομή, τη μέθοδο διανομής round robin θα χρησιμοποιηθεί.  Ωστόσο, ενώ οι πίνακες round robin είναι εύκολη τη χρήση, επειδή τυχαία διανομή δεδομένων μέσω του συστήματος, αυτό σημαίνει ότι το σύστημα δεν εγγυάται ποια διανομής κάθε γραμμή είναι σε.  Ως αποτέλεσμα, το σύστημα μερικές φορές πρέπει να καλέσετε μια λειτουργία κίνηση δεδομένων για να οργανώσετε καλύτερα τα δεδομένα σας πριν από το να επιλύσετε ένα ερώτημα.  Αυτό το βήμα επιπλέον μπορεί να επιβραδύνουν τα ερωτήματά σας.

Εξετάστε το ενδεχόμενο χρήσης Round Robin διανομής για τον πίνακά σας στα ακόλουθα σενάρια:

- Όταν ξεκινούν ως απλό σημείο εκκίνησης
- Εάν δεν υπάρχει εμφανή Ένωσης κλειδί
- Εάν δεν είναι καλή υποψηφίου στήλης για κατακερματισμός τη διανομή του πίνακα
- Εάν ο πίνακας δεν κοινή χρήση έναν αριθμό-κλειδί συμμετοχή σε κοινά με άλλους πίνακες
- Εάν είναι λιγότερο σημαντική από άλλα σύνδεσμοι στο ερώτημα συνένωσης
- Όταν ο πίνακας είναι ένα προσωρινό πίνακας ενδιάμεσου σταδίου

Και τα δύο από αυτά τα παραδείγματα, θα δημιουργήσετε έναν πίνακα Round Robin:

```SQL
-- Round Robin created by default
CREATE TABLE [dbo].[FactInternetSales]
(   [ProductKey]            int          NOT NULL
,   [OrderDateKey]          int          NOT NULL
,   [CustomerKey]           int          NOT NULL
,   [PromotionKey]          int          NOT NULL
,   [SalesOrderNumber]      nvarchar(20) NOT NULL
,   [OrderQuantity]         smallint     NOT NULL
,   [UnitPrice]             money        NOT NULL
,   [SalesAmount]           money        NOT NULL
)
;

-- Explicitly Created Round Robin Table
CREATE TABLE [dbo].[FactInternetSales]
(   [ProductKey]            int          NOT NULL
,   [OrderDateKey]          int          NOT NULL
,   [CustomerKey]           int          NOT NULL
,   [PromotionKey]          int          NOT NULL
,   [SalesOrderNumber]      nvarchar(20) NOT NULL
,   [OrderQuantity]         smallint     NOT NULL
,   [UnitPrice]             money        NOT NULL
,   [SalesAmount]           money        NOT NULL
)
WITH
(   CLUSTERED COLUMNSTORE INDEX
,   DISTRIBUTION = ROUND_ROBIN
)
;
```

> [AZURE.NOTE] Ενώ round robin είναι ο προεπιλεγμένος τύπος πίνακα είναι ρητή σε σας DDL θεωρείται βέλτιστη πρακτική ώστε το προθέσεων σας πίνακα διάταξης είναι σαφές σε άλλους χρήστες.

### <a name="hash-distributed-tables"></a>Ο κατακερματισμός κατανέμεται πίνακες

Χρησιμοποιώντας έναν αλγόριθμο **κατανεμημένο κατακερματισμός** για τη διανομή τους πίνακές σας να βελτιώσετε τις επιδόσεις για πολλά σενάρια, μειώνοντας κίνηση δεδομένων κατά το χρόνο ερωτήματος.  Οι πίνακες κατακερματισμός κατανεμημένο είναι οι πίνακες που χωρίζονται μεταξύ των κατανέμεται βάσεων δεδομένων χρησιμοποιώντας έναν αλγόριθμο κλειδώματος σε μία μόνο στήλη που επιλέγετε.  Η στήλη κατανομής είναι τι καθορίζει τον τρόπο διαίρεσης τα δεδομένα κατά μήκος κατανέμεται βάσεις δεδομένων σας.  Η συνάρτηση κατακερματισμός χρησιμοποιεί τη στήλη διανομής για να αντιστοιχίσετε γραμμών σε κατανομές.  Η αλγόριθμου κλειδώματος και διανομής που προκύπτει είναι ντετερμινιστική.  Που είναι πάντα θα έχει την ίδια τιμή με τον ίδιο τύπο δεδομένων για την ίδια κατανομή.    

Αυτό το παράδειγμα θα δημιουργήσει έναν πίνακα κατανεμημένο σε αναγνωριστικό:

```SQL
CREATE TABLE [dbo].[FactInternetSales]
(   [ProductKey]            int          NOT NULL
,   [OrderDateKey]          int          NOT NULL
,   [CustomerKey]           int          NOT NULL
,   [PromotionKey]          int          NOT NULL
,   [SalesOrderNumber]      nvarchar(20) NOT NULL
,   [OrderQuantity]         smallint     NOT NULL
,   [UnitPrice]             money        NOT NULL
,   [SalesAmount]           money        NOT NULL
)
WITH
(   CLUSTERED COLUMNSTORE INDEX
,  DISTRIBUTION = HASH([ProductKey])
)
;
```

## <a name="select-distribution-column"></a>Επιλογή στήλης διανομής

Όταν επιλέγετε να **διανείμετε κατακερματισμός** έναν πίνακα, θα πρέπει να επιλέξτε μια στήλη μία διανομής.  Όταν επιλέγετε μια στήλη διανομής, υπάρχουν τρία κύρια παράγοντες που πρέπει να λάβετε υπόψη σας.  

Επιλέξτε μια μεμονωμένη στήλη που θα:

1. Μην ενημερωθούν
2. Ομοιόμορφη κατανομή δεδομένων, αποφυγή δεδομένων skew
3. Ελαχιστοποίηση κίνηση δεδομένων

### <a name="select-distribution-column-which-will-not-be-updated"></a>Επιλογή στήλης διανομής που δεν θα ενημερωθούν

Κατανομή στήλες δεν είναι ενημέρωσης, επομένως, επιλέξτε μια στήλη με στατική τιμές.  Εάν μια στήλη θα πρέπει να ενημερωθεί, γενικά δεν είναι μια καλή διανομής υποψηφίου.  Εάν υπάρχει μια υπόθεση όπου πρέπει να ενημερώσετε μια στήλη διανομής, αυτό μπορεί να γίνει η διαγραφή πρώτα τη γραμμή και, στη συνέχεια, εισάγοντας μια νέα γραμμή.

### <a name="select-distribution-column-which-will-distribute-data-evenly"></a>Επιλέξτε τη στήλη διανομής που θα ομοιόμορφη κατανομή δεδομένων

Επειδή ένα Κατανεμημένο σύστημα εκτελεί μόνο το ίδιο γρήγορα με τη χαμηλότερη διανομής, είναι σημαντικό να γίνει η διαίρεση της εργασίας ομοιόμορφα κατά μήκος του κατανομές προκειμένου να επιτύχετε ισορροπημένες εκτέλεσης μέσω του συστήματος.  Ο τρόπος εργασίας χωρίζεται σε κατανεμημένο σύστημα βασίζεται σε όπου βρίσκονται τα δεδομένα για κάθε διανομής.  Αυτό καθιστά πολύ σημαντικό για να επιλέξετε τη στήλη δεξιά διανομής για τη διανομή των δεδομένων ώστε κάθε διανομής έχει ίσο εργασίας και θα διαρκέσει την ίδια ώρα για να ολοκληρώσετε το τμήμα της εργασίας.  Κατά την εργασία και διαιρείται μέσω του συστήματος, τα δεδομένα διανέμεται μεταξύ του κατανομές.  Όταν η εξισορρόπηση δεδομένων δεν είναι ομοιόμορφα, ονομάζουμε αυτή **skew δεδομένων**.  

Για να διαιρέσετε ομοιόμορφα δεδομένα και να αποφύγετε skew δεδομένων, λάβετε υπόψη τα παρακάτω κατά την επιλογή σας στήλη διανομής:

1. Επιλέξτε μια στήλη που περιέχει μια σημαντική αριθμός διακριτών τιμών.
2. Αποφύγετε τη διανομή δεδομένα σε στήλες με μερικά διακριτές τιμές. 
3. Αποφύγετε τη διανομή δεδομένα σε στήλες με υψηλή συχνότητα τιμών null.
4. Αποφύγετε τη διανομή δεδομένα σε στήλες ημερομηνίας.

Επειδή κάθε τιμή είναι κατακερματισμός για να 1 από 60 κατανομές, για να επιτύχετε κατανομή που θα θέλετε να επιλέξετε μια στήλη η οποία είναι ιδιαίτερα μοναδικό και περιέχει περισσότερες από 60 μοναδικές τιμές.  Για την απεικόνιση, εξετάστε το ενδεχόμενο υπόθεσης όπου μια στήλη περιέχει μόνο μοναδικές τιμές 40.  Εάν αυτή η στήλη έχει επιλεγεί ως το κλειδί κατανομή, τα δεδομένα για αυτόν τον πίνακα θα γη σε 40 κατανομές πολύ, διατηρώντας 20 κατανομές με χωρίς επεξεργασία για να το κάνετε και χωρίς δεδομένα.  Αντίθετα, τα άλλα 40 κατανομές να έχουν περισσότερη εργασία για να το κάνετε εάν τα δεδομένα ήταν ομοιόμορφα εκτείνεται πάνω από 60 κατανομές.  Αυτό το σενάριο είναι ένα παράδειγμα skew δεδομένων.

Στο σύστημα MPP, κάθε βήμα ερωτήματος περιμένει κατανομές όλων για να ολοκληρώσετε την κοινή χρήση της εργασίας.  Εάν μία διανομής κάνει περισσότερη εργασία από τους άλλους, στη συνέχεια, ο πόρος την κατανομή μεταξύ είναι ουσιαστικά καταλαμβάνουν απλώς αναμονή για τη διανομή απασχολημένος.  Όταν η εργασία είναι δεν ομοιόμορφα που εκτείνεται όλα κατανομές, ονομάζουμε αυτής **επεξεργασίας κλίση**.  Συνάρτηση skew επεξεργασίας θα προκαλέσει ερωτημάτων για να εκτελεστεί πιο αργά από το εάν το φόρτο εργασίας μπορεί να είναι ομοιόμορφα που εκτείνεται το κατανομές.  Skew δεδομένων, θα οδηγηθείτε σε skew επεξεργασίας.

Αποφύγετε τη διανομή ιδιαίτερα τύπο nullable της στήλης, όπως οι τιμές null θα ξεκινάτε όλες στην ίδια την κατανομή. Διανομή σε μια στήλη ημερομηνιών μπορεί να προκαλέσουν την επεξεργασία συνάρτηση skew επειδή όλα τα δεδομένα για μια δεδομένη ημερομηνία θα ξεκινάτε στην ίδια την κατανομή. Αν πολλοί χρήστες εκτελούνται τα ερωτήματα όλα τα φίλτρα, την ίδια ημερομηνία, στη συνέχεια, θα κάνοντας μόνο 1 από το 60 κατανομές όλες τις εργασίες από μια δεδομένη ημερομηνία θα μόνο σε μία διανομής. Σε αυτό το σενάριο, τα ερωτήματα πιθανώς θα εκτελεστεί πιο αργά από το εάν τα δεδομένα έχουν εξίσου κατανέμονται όλα τα κατανομές 60 φορές. 

Όταν υπάρχουν χωρίς στήλες καλή υποψηφίου, στη συνέχεια, μπορείτε να χρησιμοποιήσετε round robin ως μέθοδο διανομής.

### <a name="select-distribution-column-which-will-minimize-data-movement"></a>Επιλογή στήλης διανομής που θα ελαχιστοποιηθεί κίνηση δεδομένων

Ελαχιστοποίηση κίνηση δεδομένων, επιλέγοντας τη στήλη δεξιά κατανομής είναι μία από τις σημαντικότερες στρατηγικές για βελτιστοποίηση των επιδόσεων του σας αποθήκη δεδομένων του SQL.  Κίνηση δεδομένων προκύπτει πιο συχνά όταν είστε συνδεδεμένοι πίνακες ή συναθροίσεις εκτελούνται.  Στήλες που χρησιμοποιούνται σε `JOIN`, `GROUP BY`, `DISTINCT`, `OVER` και `HAVING` όρους όλα πραγματοποίηση για **καλή** κατακερματισμός υποψήφιοι διανομής. 

Αντιθέτως, στήλες σε το `WHERE` όρος κάντε **κάνετε** για καλή κατακερματισμός στήλη υποψήφιοι προκαλεί επεξεργασίας skew επειδή περιορίζουν ποια κατανομές συμμετοχή στο ερώτημα,.  Ένα καλό παράδειγμα μια στήλη που μπορεί να είναι ελκυστικές για τη διανομή στην, αλλά μπορεί να προκαλέσει συχνά skew αυτήν τη διαδικασία είναι μια στήλη ημερομηνιών.

Σε γενικές γραμμές, εάν έχετε δύο πινάκων μεγάλων δεδομένων συχνά που περιλαμβάνονται σε ένα σύνδεσμο, μπορείτε να αποκτήσετε τις περισσότερες επιδόσεις κατά τη διανομή και τους δύο πίνακες σε μία από τις στήλες συνδέσμου.  Εάν έχετε έναν πίνακα που είναι συνδεδεμένος ποτέ σε έναν άλλο πίνακα μεγάλο fact, στη συνέχεια, κοιτάξτε σε στήλες που είναι συχνά σε το `GROUP BY` όρος.

Υπάρχουν μερικές βασικές κριτήρια που πρέπει να πληρούνται για να αποφύγετε την κίνηση δεδομένων κατά τη διάρκεια του συνδέσμου:

1. Τους πίνακες που εμπλέκονται στην συνένωση πρέπει να είναι κατακερματισμός κατανεμημένο σε **μία** από τις στήλες που συμμετέχουν σε συνδέσμου.
2. Οι τύποι δεδομένων από τις στήλες συνδέσμου πρέπει να ταιριάζουν μεταξύ δύο πινάκων.
3. Οι στήλες πρέπει να είναι συνδεδεμένα με έναν τελεστή ισούται με.
4. Ο τύπος συνδέσμου μπορεί να μην είναι μια `CROSS JOIN`.


## <a name="troubleshooting-data-skew"></a>Αντιμετώπιση προβλημάτων δεδομένων skew

Όταν δεδομένα πίνακα κατανέμεται με τη μέθοδο διανομής κατακερματισμός υπάρχει ευκαιρία ότι ορισμένα κατανομές θα είναι ασύμμετρη να έχουν δυσανάλογη περισσότερα δεδομένα από άλλα άτομα. Συνάρτηση skew πλεονάζουσα δεδομένων μπορεί να επηρεάσει την απόδοση του ερωτήματος επειδή το τελικό αποτέλεσμα κατανέμεται ερωτήματος πρέπει να περιμένετε την πιο μεγάλη εκτελείται κατανομή για να ολοκληρώσετε. Ανάλογα με το βαθμό τη συνάρτηση skew δεδομένων ίσως χρειαστεί να προσθέστε τη διεύθυνση.

### <a name="identifying-skew"></a>Εντοπισμός συνάρτηση skew

Ένα απλό τρόπο για τον προσδιορισμό ενός πίνακα, όπως κλίση είναι να χρησιμοποιήσετε `DBCC PDW_SHOWSPACEUSED`.  Αυτή είναι μια πολύ γρήγορα και απλό τρόπο για να δείτε τον αριθμό των γραμμών του πίνακα που είναι αποθηκευμένα σε κάθε ένα από τα 60 διανομή της βάσης δεδομένων σας.  Να θυμάστε ότι για τις πιο ισορροπημένες επιδόσεις, τις γραμμές στον πίνακά σας κατανέμεται θα πρέπει να είναι ομοιόμορφα σε όλα τα κατανομές.

```sql
-- Find data skew for a distributed table
DBCC PDW_SHOWSPACEUSED('dbo.FactInternetSales');
```

Ωστόσο, εάν εκτελέσετε το ερώτημα αποθήκη δεδομένων του SQL Azure δυναμική Διαχείριση προβολών (DMV) μπορείτε να εκτελέσετε μια πιο λεπτομερή ανάλυση.  Για να ξεκινήσετε, δημιουργήστε την προβολή [dbo.vTableSizes][] προβολή χρησιμοποιώντας το SQL από το άρθρο[Επισκόπηση] [Επισκόπηση πίνακα].  Μετά τη δημιουργία της προβολής, εκτελέστε αυτό το ερώτημα για να προσδιορίσετε ποιοι πίνακες έχει περισσότερες από συνάρτηση skew δεδομένων 10%.

```sql
select *
from dbo.vTableSizes 
where two_part_name in 
    (
    select two_part_name
    from dbo.vTableSizes
    where row_count > 0
    group by two_part_name
    having min(row_count * 1.000)/max(row_count * 1.000) > .10
    )
order by two_part_name, row_count
;
```

### <a name="resolving-data-skew"></a>Επίλυση δεδομένων skew

Δεν όλα skew είναι αρκετά δικαιολογούν την επιδιόρθωση.  Σε ορισμένες περιπτώσεις, την απόδοση ενός πίνακα σε ορισμένα ερωτήματα μπορούν να αντισταθμίσουν το βλάβη skew δεδομένων.  Για να αποφασίσετε εάν θα πρέπει να επιλύσετε δεδομένων skew σε έναν πίνακα, θα πρέπει να κατανοήσετε πολύ όσο το δυνατόν σχετικά με τους όγκους δεδομένων και τα ερωτήματα σε του φόρτου εργασίας σας.   Ένας τρόπος για να δείτε την επίδραση των συνάρτηση skew είναι να χρησιμοποιήσετε τα βήματα στο άρθρο [Παρακολούθηση ερωτήματος][] για να παρακολουθούν την επίδραση των συνάρτηση skew στις επιδόσεις του ερωτήματος και συγκεκριμένα την επίδραση στα ερωτήματα πόσος χρόνος θα χρειαστεί για να ολοκληρωθεί σε τα μεμονωμένα κατανομές.

Διανομή δεδομένων είναι ένα θέμα μπορείτε να βρείτε την κατάλληλη ισορροπία μεταξύ Ελαχιστοποίηση συνάρτηση skew δεδομένων και την ελαχιστοποίηση κίνηση δεδομένων. Αυτές μπορεί να Αντίθετα στόχους και μερικές φορές που θα θέλετε να διατηρήσετε τα δεδομένα skew προκειμένου να μειώσετε κίνηση δεδομένων. Για παράδειγμα, όταν η στήλη κατανομής είναι συχνά στήλη κοινόχρηστο στο συνδέσμων και συναθροίσεις, που θα Ελαχιστοποίηση κίνηση δεδομένων. Το πλεονέκτημα της την κυκλοφορία ελάχιστους δεδομένων ενδέχεται να αντισταθμίζουν την επίδραση των δεδομένων skew χρειάζεται. 

Το τυπικό τρόπος για να επιλύσετε συνάρτηση skew δεδομένων είναι να δημιουργήστε ξανά τον πίνακα με μια στήλη διαφορετική κατανομή. Εφόσον δεν υπάρχει τρόπος για να αλλάξετε τη στήλη διανομής σε έναν υπάρχοντα πίνακα, ο τρόπος για να αλλάξετε την κατανομή των έναν πίνακα για να δημιουργήσετε ξανά με μια [] [CTAS].  Εδώ θα βρείτε δύο παραδείγματα του τρόπου επίλυση skew δεδομένων:

### <a name="example-1-re-create-the-table-with-a-new-distribution-column"></a>Παράδειγμα 1: Δημιουργήστε ξανά τον πίνακα με μια νέα στήλη διανομής

Αυτό το παράδειγμα χρησιμοποιεί [[CTAS]] για να δημιουργήσετε ξανά έναν πίνακα με μια στήλη διανομής διαφορετική κατακερματισμός. 

```sql
CREATE TABLE [dbo].[FactInternetSales_CustomerKey] 
WITH (  CLUSTERED COLUMNSTORE INDEX
     ,  DISTRIBUTION =  HASH([CustomerKey])
     ,  PARTITION       ( [OrderDateKey] RANGE RIGHT FOR VALUES (   20000101, 20010101, 20020101, 20030101
                                                                ,   20040101, 20050101, 20060101, 20070101
                                                                ,   20080101, 20090101, 20100101, 20110101
                                                                ,   20120101, 20130101, 20140101, 20150101
                                                                ,   20160101, 20170101, 20180101, 20190101
                                                                ,   20200101, 20210101, 20220101, 20230101
                                                                ,   20240101, 20250101, 20260101, 20270101
                                                                ,   20280101, 20290101
                                                                )
                        )
    )
AS
SELECT  *
FROM    [dbo].[FactInternetSales]
OPTION  (LABEL  = 'CTAS : FactInternetSales_CustomerKey')
;

--Create statistics on new table
CREATE STATISTICS [ProductKey] ON [FactInternetSales_CustomerKey] ([ProductKey]);
CREATE STATISTICS [OrderDateKey] ON [FactInternetSales_CustomerKey] ([OrderDateKey]);
CREATE STATISTICS [CustomerKey] ON [FactInternetSales_CustomerKey] ([CustomerKey]);
CREATE STATISTICS [PromotionKey] ON [FactInternetSales_CustomerKey] ([PromotionKey]);
CREATE STATISTICS [SalesOrderNumber] ON [FactInternetSales_CustomerKey] ([SalesOrderNumber]);
CREATE STATISTICS [OrderQuantity] ON [FactInternetSales_CustomerKey] ([OrderQuantity]);
CREATE STATISTICS [UnitPrice] ON [FactInternetSales_CustomerKey] ([UnitPrice]);
CREATE STATISTICS [SalesAmount] ON [FactInternetSales_CustomerKey] ([SalesAmount]);

--Rename the tables
RENAME OBJECT [dbo].[FactInternetSales] TO [FactInternetSales_ProductKey];
RENAME OBJECT [dbo].[FactInternetSales_CustomerKey] TO [FactInternetSales];
```

### <a name="example-2-re-create-the-table-using-round-robin-distribution"></a>Παράδειγμα 2: Δημιουργήστε ξανά τον πίνακα χρησιμοποιώντας κατανομή round robin

Σε αυτό το παράδειγμα χρησιμοποιεί [[CTAS]] για να δημιουργήσετε έναν πίνακα με round robin αντί για μια κατανομή κατακερματισμός ξανά. Αυτή η αλλαγή θα δημιουργήσουν ακόμα και δεδομένα κατανομής εις βάρος της κίνηση αυξημένη δεδομένων. 

```sql
CREATE TABLE [dbo].[FactInternetSales_ROUND_ROBIN] 
WITH (  CLUSTERED COLUMNSTORE INDEX
     ,  DISTRIBUTION =  ROUND_ROBIN
     ,  PARTITION       ( [OrderDateKey] RANGE RIGHT FOR VALUES (   20000101, 20010101, 20020101, 20030101
                                                                ,   20040101, 20050101, 20060101, 20070101
                                                                ,   20080101, 20090101, 20100101, 20110101
                                                                ,   20120101, 20130101, 20140101, 20150101
                                                                ,   20160101, 20170101, 20180101, 20190101
                                                                ,   20200101, 20210101, 20220101, 20230101
                                                                ,   20240101, 20250101, 20260101, 20270101
                                                                ,   20280101, 20290101
                                                                )
                        )
    )
AS
SELECT  *
FROM    [dbo].[FactInternetSales]
OPTION  (LABEL  = 'CTAS : FactInternetSales_ROUND_ROBIN')
;

--Create statistics on new table
CREATE STATISTICS [ProductKey] ON [FactInternetSales_ROUND_ROBIN] ([ProductKey]);
CREATE STATISTICS [OrderDateKey] ON [FactInternetSales_ROUND_ROBIN] ([OrderDateKey]);
CREATE STATISTICS [CustomerKey] ON [FactInternetSales_ROUND_ROBIN] ([CustomerKey]);
CREATE STATISTICS [PromotionKey] ON [FactInternetSales_ROUND_ROBIN] ([PromotionKey]);
CREATE STATISTICS [SalesOrderNumber] ON [FactInternetSales_ROUND_ROBIN] ([SalesOrderNumber]);
CREATE STATISTICS [OrderQuantity] ON [FactInternetSales_ROUND_ROBIN] ([OrderQuantity]);
CREATE STATISTICS [UnitPrice] ON [FactInternetSales_ROUND_ROBIN] ([UnitPrice]);
CREATE STATISTICS [SalesAmount] ON [FactInternetSales_ROUND_ROBIN] ([SalesAmount]);

--Rename the tables
RENAME OBJECT [dbo].[FactInternetSales] TO [FactInternetSales_HASH];
RENAME OBJECT [dbo].[FactInternetSales_ROUND_ROBIN] TO [FactInternetSales];
```

## <a name="next-steps"></a>Επόμενα βήματα

Για να μάθετε περισσότερα σχετικά με τη σχεδίαση πίνακα, ανατρέξτε στο θέμα [κατανομή][], [Index][], [διαμερίσματα][], [Τους τύπους δεδομένων][], [Στατιστικά στοιχεία][] και άρθρα[προσωρινό] [Προσωρινό πίνακες].

Για μια επισκόπηση των βέλτιστων πρακτικών, ανατρέξτε στο θέμα [Βέλτιστες πρακτικές αποθήκη δεδομένων SQL][].


<!--Image references-->

<!--Article references-->
[Επισκόπηση]: ./sql-data-warehouse-tables-overview.md
[Τύποι δεδομένων]: ./sql-data-warehouse-tables-data-types.md
[Διανομή]: ./sql-data-warehouse-tables-distribute.md
[Ευρετήριο]: ./sql-data-warehouse-tables-index.md
[Partition]: ./sql-data-warehouse-tables-partition.md
[Στατιστικά στοιχεία]: ./sql-data-warehouse-tables-statistics.md
[Προσωρινό]: ./sql-data-warehouse-tables-temporary.md
[Βέλτιστες πρακτικές αποθήκη δεδομένων SQL]: ./sql-data-warehouse-best-practices.md
[Παρακολούθηση ερωτήματος]: ./sql-data-warehouse-manage-monitor.md
[dbo.vTableSizes]: ./sql-data-warehouse-tables-overview.md#querying-table-sizes

<!--MSDN references-->
[DBCC PDW_SHOWSPACEUSED()]: https://msdn.microsoft.com/library/mt204028.aspx

<!--Other Web references-->
