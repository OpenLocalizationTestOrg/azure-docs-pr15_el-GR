<properties
   pageTitle="Δημιουργία ευρετηρίου πίνακες στην αποθήκη δεδομένων του SQL | Microsoft Azure"
   description="Γρήγορα αποτελέσματα με τη δημιουργία ευρετηρίου σε αποθήκη δεδομένων του SQL Azure πίνακα."
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="jrowlandjones"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="07/12/2016"
   ms.author="jrj;barbkess;sonyama"/>

# <a name="indexing-tables-in-sql-data-warehouse"></a>Δημιουργία ευρετηρίου πίνακες στην αποθήκη δεδομένων του SQL

> [AZURE.SELECTOR]
- [Επισκόπηση][]
- [Τύποι δεδομένων][]
- [Διανομή][]
- [Ευρετήριο][]
- [Partition][]
- [Στατιστικά στοιχεία][]
- [Προσωρινό][]

Αποθήκη δεδομένων του SQL προσφέρει πολλές επιλογές ευρετηρίου συμπεριλαμβανομένων των [ομαδοποιημένων columnstore ευρετήρια][], [τα ευρετήρια ομαδοποιημένων και μη συγκεντρωτικών ευρετηρίων][].  Επιπλέον, προσφέρει επίσης ένα ευρετήριο επιλογή γνωστό και ως [σωρού][].  Σε αυτό το άρθρο περιγράφει τα πλεονεκτήματα της κάθε τύπο ευρετηρίου, καθώς και συμβουλές για να έχετε στο περισσότερες απόδοση σας ευρετήρια. Ανατρέξτε στο θέμα [Δημιουργία πίνακα σύνταξη][] για περισσότερες λεπτομέρειες σχετικά με τον τρόπο για να δημιουργήσετε έναν πίνακα σε αποθήκη δεδομένων του SQL.

## <a name="clustered-columnstore-indexes"></a>Ομαδοποιημένη columnstore ευρετήρια

Από προεπιλογή, αποθήκη δεδομένων του SQL δημιουργεί ένα ευρετήριο ομαδοποιημένων columnstore όταν δεν υπάρχουν επιλογές ευρετηρίου που καθορίζονται σε έναν πίνακα. Ομαδοποιημένη columnstore πίνακες παρέχουν τόσο το υψηλότερο επίπεδο συμπίεσης δεδομένων, καθώς και καλύτερη συνολική απόδοση του ερωτήματος.  Οι πίνακες ομαδοποιημένων columnstore θα είναι γενικά ξεπεράσετε ομαδοποιημένων ευρετήριο ή σωρού πίνακες και συνήθως είναι η καλύτερη επιλογή για μεγάλους πίνακες.  Για αυτούς τους λόγους, ομαδοποιημένων columnstore είναι το καλύτερο σημείο για να ξεκινήσετε όταν είστε βέβαιοι για το πώς μπορείτε να δημιουργήσετε ευρετήριο τον πίνακά σας.  

Για να δημιουργήσετε έναν πίνακα ομαδοποιημένων columnstore, απλώς Καθορίστε ΣΥΓΚΕΝΤΡΩΤΙΚΌ ΕΥΡΕΤΉΡΙΟ COLUMNSTORE με τον όρο FROM ή αποχώρηση από τον όρο με:

```SQL
CREATE TABLE myTable   
  (  
    id int NOT NULL,  
    lastName varchar(20),  
    zipCode varchar(6)  
  )  
WITH ( CLUSTERED COLUMNSTORE INDEX );
```

Υπάρχουν ορισμένα σενάρια όπου ομαδοποιημένων columnstore ενδέχεται να μην είναι μια καλή επιλογή:

- Οι πίνακες Columnstore δεν υποστηρίζουν δευτερεύων ευρετήρια μη ομαδοποιημένη.  Εξετάστε το ενδεχόμενο σωρού ή πίνακες συγκεντρωτικό ευρετήριο αντί για αυτό.
- Οι πίνακες Columnstore δεν υποστηρίζουν varchar(max), nvarchar(max) και varbinary(max).  Εξετάστε το ενδεχόμενο σωρού ή συγκεντρωτικό ευρετήριο αντί για αυτό.
- Οι πίνακες Columnstore ενδέχεται να είναι λιγότερο αποτελεσματική για μεταβατικές δεδομένα.  Εξετάστε το ενδεχόμενο σωρού και ακόμη και προσωρινών πινάκων.
- Μικρό πίνακες με λιγότερο από 100 εκατομμύρια γραμμές.  Εξετάστε το ενδεχόμενο σωρού πίνακες.

## <a name="heap-tables"></a>Οι πίνακες σωρού

Όταν έχετε προσωρινά προορισμού δεδομένων στην αποθήκη δεδομένων του SQL, μπορεί να διαπιστώσετε ότι χρησιμοποιώντας έναν πίνακα σωρού θα κάνει η συνολική διαδικασία ταχύτερη.  Αυτό συμβαίνει επειδή φορτία να σωρών είναι ταχύτερες από στους πίνακες ευρετηρίων και σε ορισμένες περιπτώσεις, μπορεί να γίνει η ανάγνωση οι επόμενες από το cache.  Εάν γίνεται φόρτωση της δεδομένων μόνο για το στάδιο πριν από την εκτέλεση περισσότερες μετασχηματισμοί, κατά τη φόρτωση του πίνακα για να σωρού πίνακα θα είναι πολύ πιο γρήγορα από τη φόρτωση των δεδομένων σε πίνακα ομαδοποιημένων columnstore. Επιπλέον, γίνεται φόρτωση των δεδομένων σε [πίνακα προσωρινό][προσωρινό] θα επίσης φορτώσετε πολύ ταχύτερα από τη φόρτωση ενός πίνακα με το μόνιμο χώρο αποθήκευσης.  

Για πίνακες αναζήτησης μικρές, μικρότερη από 100 εκατομμύρια γραμμές, συχνά σωρού πίνακες έχει νόημα.  Ξεκινήστε σύμπλεγμα columnstore πίνακες για να επιτύχετε βέλτιστη συμπίεση όταν υπάρχει περισσότερα από 100 εκατομμύρια γραμμές.

Για να δημιουργήσετε έναν πίνακα σωρού, απλώς Καθορίστε ΣΩΡΟΎ με τον όρο FROM:

```SQL
CREATE TABLE myTable   
  (  
    id int NOT NULL,  
    lastName varchar(20),  
    zipCode varchar(6)  
  )  
WITH ( HEAP );
```

## <a name="clustered-and-nonclustered-indexes"></a>Ομαδοποιημένων και μη συγκεντρωτικό ευρετήρια

Ομαδοποιημένη ευρετήρια ενδέχεται να ξεπεράσετε ομαδοποιημένων columnstore πίνακες όταν πρέπει να ανακτηθούν γρήγορα μία γραμμή.  Για ερωτήματα όπου μία ή πολύ λίγα γραμμή αναζήτησης απαιτείται για την απόδοση με ακραίες ταχύτητα, εξετάστε το ενδεχόμενο ένα ευρετήριο συμπλέγματος ή άλλο δευτερεύοντα ευρετήριο.  Το μειονέκτημα για να χρησιμοποιήσετε ένα συγκεντρωτικό ευρετήριο είναι ότι θα επωφεληθούν μόνο τα ερωτήματα που χρησιμοποιούν ιδιαίτερα επιλεκτική φίλτρου στη στήλη συγκεντρωτικό ευρετήριο.  Για να βελτιώσετε το φίλτρο σε άλλες στήλες ένα άλλο ευρετήριο μπορούν να προστεθούν σε άλλες στήλες.  Ωστόσο, κάθε ευρετήριο που προστίθεται σε έναν πίνακα θα προσθέσετε χώρο και χρόνος επεξεργασίας στις φορτώσεις.

Για να δημιουργήσετε έναν πίνακα συγκεντρωτικό ευρετήριο, απλώς Καθορίστε ΣΥΓΚΕΝΤΡΩΤΙΚΌ ΕΥΡΕΤΉΡΙΟ με τον όρο FROM:

```SQL
CREATE TABLE myTable   
  (  
    id int NOT NULL,  
    lastName varchar(20),  
    zipCode varchar(6)  
  )  
WITH ( CLUSTERED INDEX (id) );
```

Για να προσθέσετε ένα ευρετήριο μη ομαδοποιημένη σε έναν πίνακα, απλά χρησιμοποιήστε την ακόλουθη σύνταξη:

```SQL
CREATE INDEX zipCodeIndex ON t1 (zipCode);
```

> [AZURE.NOTE] Μη συγκεντρωτικού ευρετηρίου δημιουργείται από προεπιλογή κατά τη ΔΗΜΙΟΥΡΓΊΑ ΕΥΡΕΤΗΡΊΟΥ. Επιπλέον, ένα ευρετήριο μη ομαδοποιημένη επιτρέπεται μόνο σε έναν πίνακα αποθήκευσης γραμμής (ΣΩΡΟΎ ή ΟΜΑΔΟΠΟΙΗΜΈΝΗ ΕΥΡΕΤΉΡΙΟ). Δεν επιτρέπεται η μη ομαδοποιημένων ευρετήρια επάνω σε ένα ΣΥΓΚΕΝΤΡΩΤΙΚΌ ΕΥΡΕΤΉΡΙΟ COLUMNSTORE αυτήν τη στιγμή.


## <a name="optimizing-clustered-columnstore-indexes"></a>Βελτιστοποίηση των ομαδοποιημένων columnstore ευρετήρια

Ομαδοποιημένη columnstore πίνακες οργανώνονται σε δεδομένα σε τμήματα.  Αντιμετωπίζετε τμήματος υψηλής ποιότητας είναι σημαντικό να πραγμάτωση των ερωτήματος βέλτιστη απόδοση σε έναν πίνακα columnstore.  Ποιότητα τμήματος μπορεί να μετρηθεί με τον αριθμό των γραμμών σε μια ομάδα συμπιεσμένο γραμμής.  Ποιότητα τμήματος είναι πιο βέλτιστη όπου υπάρχουν τουλάχιστον 100K γραμμές ανά γραμμή συμπιεσμένο ομάδα και να αποκτήσει στις επιδόσεις ως ο αριθμός των γραμμών ανά γραμμή ομάδα προσέγγιση 1.048.576 γραμμές, ποιο είναι το περισσότερες γραμμές μπορεί να περιέχει μια ομάδα γραμμών.

Το κάτω από την προβολή είναι δυνατό να δημιουργηθούν και να χρησιμοποιηθεί στο σύστημά σας για τον υπολογισμό του μέσου γραμμές ανά γραμμή ομαδοποίηση και να την προσδιορίσετε τα ευρετήρια columnstore κατώτερο του βέλτιστου σύμπλεγμα.  Στην τελευταία στήλη σε αυτήν την προβολή θα δημιουργήσει ως της πρότασης SQL που μπορεί να χρησιμοποιηθεί για εκ νέου δημιουργία ευρετηρίων σας.

```sql
CREATE VIEW dbo.vColumnstoreDensity
AS
SELECT
        GETDATE()                                                               AS [execution_date]
,       DB_Name()                                                               AS [database_name]
,       s.name                                                                  AS [schema_name]
,       t.name                                                                  AS [table_name]
,   COUNT(DISTINCT rg.[partition_number])                   AS [table_partition_count]
,       SUM(rg.[total_rows])                                                    AS [row_count_total]
,       SUM(rg.[total_rows])/COUNT(DISTINCT rg.[distribution_id])               AS [row_count_per_distribution_MAX]
,   CEILING ((SUM(rg.[total_rows])*1.0/COUNT(DISTINCT rg.[distribution_id]))/1048576) AS [rowgroup_per_distribution_MAX]
,       SUM(CASE WHEN rg.[State] = 0 THEN 1                   ELSE 0    END)    AS [INVISIBLE_rowgroup_count]
,       SUM(CASE WHEN rg.[State] = 0 THEN rg.[total_rows]     ELSE 0    END)    AS [INVISIBLE_rowgroup_rows]
,       MIN(CASE WHEN rg.[State] = 0 THEN rg.[total_rows]     ELSE NULL END)    AS [INVISIBLE_rowgroup_rows_MIN]
,       MAX(CASE WHEN rg.[State] = 0 THEN rg.[total_rows]     ELSE NULL END)    AS [INVISIBLE_rowgroup_rows_MAX]
,       AVG(CASE WHEN rg.[State] = 0 THEN rg.[total_rows]     ELSE NULL END)    AS [INVISIBLE_rowgroup_rows_AVG]
,       SUM(CASE WHEN rg.[State] = 1 THEN 1                   ELSE 0    END)    AS [OPEN_rowgroup_count]
,       SUM(CASE WHEN rg.[State] = 1 THEN rg.[total_rows]     ELSE 0    END)    AS [OPEN_rowgroup_rows]
,       MIN(CASE WHEN rg.[State] = 1 THEN rg.[total_rows]     ELSE NULL END)    AS [OPEN_rowgroup_rows_MIN]
,       MAX(CASE WHEN rg.[State] = 1 THEN rg.[total_rows]     ELSE NULL END)    AS [OPEN_rowgroup_rows_MAX]
,       AVG(CASE WHEN rg.[State] = 1 THEN rg.[total_rows]     ELSE NULL END)    AS [OPEN_rowgroup_rows_AVG]
,       SUM(CASE WHEN rg.[State] = 2 THEN 1                   ELSE 0    END)    AS [CLOSED_rowgroup_count]
,       SUM(CASE WHEN rg.[State] = 2 THEN rg.[total_rows]     ELSE 0    END)    AS [CLOSED_rowgroup_rows]
,       MIN(CASE WHEN rg.[State] = 2 THEN rg.[total_rows]     ELSE NULL END)    AS [CLOSED_rowgroup_rows_MIN]
,       MAX(CASE WHEN rg.[State] = 2 THEN rg.[total_rows]     ELSE NULL END)    AS [CLOSED_rowgroup_rows_MAX]
,       AVG(CASE WHEN rg.[State] = 2 THEN rg.[total_rows]     ELSE NULL END)    AS [CLOSED_rowgroup_rows_AVG]
,       SUM(CASE WHEN rg.[State] = 3 THEN 1                   ELSE 0    END)    AS [COMPRESSED_rowgroup_count]
,       SUM(CASE WHEN rg.[State] = 3 THEN rg.[total_rows]     ELSE 0    END)    AS [COMPRESSED_rowgroup_rows]
,       SUM(CASE WHEN rg.[State] = 3 THEN rg.[deleted_rows]   ELSE 0    END)    AS [COMPRESSED_rowgroup_rows_DELETED]
,       MIN(CASE WHEN rg.[State] = 3 THEN rg.[total_rows]     ELSE NULL END)    AS [COMPRESSED_rowgroup_rows_MIN]
,       MAX(CASE WHEN rg.[State] = 3 THEN rg.[total_rows]     ELSE NULL END)    AS [COMPRESSED_rowgroup_rows_MAX]
,       AVG(CASE WHEN rg.[State] = 3 THEN rg.[total_rows]     ELSE NULL END)    AS [COMPRESSED_rowgroup_rows_AVG]
,       'ALTER INDEX ALL ON ' + s.name + '.' + t.NAME + ' REBUILD;'             AS [Rebuild_Index_SQL]
FROM    sys.[pdw_nodes_column_store_row_groups] rg
JOIN    sys.[pdw_nodes_tables] nt                   ON  rg.[object_id]          = nt.[object_id]
                                                    AND rg.[pdw_node_id]        = nt.[pdw_node_id]
                                                    AND rg.[distribution_id]    = nt.[distribution_id]
JOIN    sys.[pdw_table_mappings] mp                 ON  nt.[name]               = mp.[physical_name]
JOIN    sys.[tables] t                              ON  mp.[object_id]          = t.[object_id]
JOIN    sys.[schemas] s                             ON t.[schema_id]            = s.[schema_id]
GROUP BY
        s.[name]
,       t.[name]
;
```

Τώρα που έχετε δημιουργήσει την προβολή, εκτελέστε αυτό το ερώτημα για να εντοπίσετε τους πίνακες με ομάδες γραμμής με μικρότερο του 100K γραμμών.  Φυσικά, ενδέχεται να θέλετε να αυξήσετε το μέγεθος των 100K Εάν αναζητάτε περισσότερες ποιότητα βέλτιστη τμήματος. 

```sql
SELECT  *
FROM    [dbo].[vColumnstoreDensity]
WHERE   COMPRESSED_rowgroup_rows_AVG < 100000
        OR INVISIBLE_rowgroup_rows_AVG < 100000
```

Όταν εκτελείτε το ερώτημα, μπορείτε να αρχίσετε να δείτε τα δεδομένα και να αναλύσετε τα αποτελέσματα. Αυτός ο πίνακας εξηγεί τι πρέπει να αναζητήσετε στην ομάδα ανάλυση σας γραμμής.


| Στήλη                             | Πώς μπορείτε να χρησιμοποιήσετε αυτά τα δεδομένα                                                                                                                                                                      |
| ---------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [table_partition_count]            | Εάν ο πίνακας έχει διαμερίσματα, στη συνέχεια, ενδέχεται να αναμένετε για να δείτε καταμετρά υψηλότερη ομάδα Άνοιγμα γραμμής. Κάθε διαμερίσματα στο διανομής, θεωρητικά θα μπορούσε να έχει μια ομάδα ανοιχτή γραμμή που σχετίζεται με το. Συντελεστής αυτό σε την ανάλυσή σας. Έναν μικρό πίνακα που έχει τεθεί διαμερίσματα μπορεί να βελτιστοποιηθεί, καταργώντας το διαμερισμάτων εντελώς όπως αυτό να βελτιώσει τη συμπίεση.                                                                        |
| [row_count_total]                  | Συνολικό αριθμό γραμμών για τον πίνακα. Για παράδειγμα, μπορείτε να χρησιμοποιήσετε αυτή την τιμή για τον υπολογισμό ποσοστού των γραμμών σε συμπιεσμένο κατάσταση.                                                                      |
| [row_count_per_distribution_MAX]   | Εάν όλες οι γραμμές είναι ομοιόμορφα κατανεμημένα αυτή η τιμή θα είναι ο αριθμός του προορισμού γραμμών ανά διανομής. Συγκρίνετε αυτήν την τιμή με το compressed_rowgroup_count.                                 |
| [COMPRESSED_rowgroup_rows]         | Συνολικός αριθμός των γραμμών σε μορφή columnstore για τον πίνακα.                                                                                                                                 |
| [COMPRESSED_rowgroup_rows_AVG]     | Εάν ο μέσος αριθμός γραμμών που είναι σημαντικά μικρότερη από τη μέγιστη # γραμμών για μια ομάδα γραμμής, στη συνέχεια, εξετάστε το ενδεχόμενο χρήσης CTAS ή να ΤΡΟΠΟΠΟΙΉΣΟΥΝ τις ΑΝΑΔΌΜΗΣΗ ΕΥΡΕΤΗΡΊΟΥ για να συμπιέσετε πάλι τα δεδομένα                     |
| [COMPRESSED_rowgroup_count]        | Αριθμός των ομάδων γραμμής σε μορφή columnstore. Εάν αυτός ο αριθμός είναι πολύ υψηλή σε σχέση με τον πίνακα είναι μια ένδειξη ότι η πυκνότητα columnstore είναι χαμηλή.                                  |
| [COMPRESSED_rowgroup_rows_DELETED] | Οι γραμμές διαγράφονται λογικά σε μορφή columnstore. Εάν ο αριθμός είναι υψηλή σε σχέση με το μέγεθος του πίνακα, εξετάστε το ενδεχόμενο να δημιουργείτε τα διαμερίσματα ή αναδόμηση ευρετηρίου όπως αυτό καταργεί φυσική τους. |
| [COMPRESSED_rowgroup_rows_MIN]     | Χρησιμοποιήστε αυτήν την επιλογή σε συνδυασμό με τις στήλες AVG και MAX Κατανόηση της περιοχής τιμών για τις ομάδες γραμμής στο columnstore σας. Μια μικρή τιμή πάνω από το όριο φόρτωσης (102,400 ανά partition στοιχισμένο διανομής) προτείνει ότι βελτιστοποιήσεις είναι διαθέσιμα στο η φόρτωση δεδομένων                                                                                                                                                 |
| [COMPRESSED_rowgroup_rows_MAX]     | Ως παραπάνω                                                                                                                                                                                  |
| [OPEN_rowgroup_count]              | Οι ομάδες Άνοιγμα γραμμή είναι κανονική. Ένα λογικά θα περιμένατε μία ομάδα ΆΝΟΙΓΜΑ γραμμών ανά πίνακα διανομής (60). Υπερβολικό αριθμούς προτείνει τη φόρτωση σε διαμερίσματα δεδομένων. Δύο ελέγχου του διαμερισμού στρατηγικής για να βεβαιωθείτε ότι είναι ήχου                                                                                                                                                                                                |
| [OPEN_rowgroup_rows]               | Κάθε ομάδα γραμμών μπορεί να έχει 1.048.576 γραμμές του ως έως. Χρησιμοποιήστε αυτήν την τιμή για να δείτε πώς πλήρους Άνοιγμα γραμμή είναι οι ομάδες αυτήν τη στιγμή                                                                 |
| [OPEN_rowgroup_rows_MIN]           | Άνοιγμα ομάδες υποδεικνύουν ότι τα δεδομένα είναι είτε τη ροή φόρτωση στον πίνακα ή ότι η φόρτωση προηγούμενη έχουν πάνω από υπόλοιπες γραμμές σε αυτή την ομάδα γραμμών. Χρησιμοποιήστε το MIN, MAX, Μέσοσ_όρος στήλες για να δείτε την ποσότητα των δεδομένων που είναι παρέμεινε στην ΆΝΟΙΓΜΑ γραμμή ομάδες. Για μικρές πίνακες μπορεί να είναι 100% όλων των δεδομένων! Σε αυτήν την περίπτωση ΤΡΟΠΟΠΟΙΉΣΟΥΝ ΕΥΡΕΤΗΡΊΟΥ εκ νέου ΔΗΜΙΟΥΡΓΊΑ για να επιβάλετε τα δεδομένα για να columnstore.                                                                       |
| [OPEN_rowgroup_rows_MAX]           | Ως παραπάνω                                                                                                                                                                                  |
| [OPEN_rowgroup_rows_AVG]           | Ως παραπάνω                                                                                                                                                                                  |
| [CLOSED_rowgroup_rows]             | Εξετάστε τις γραμμές ομάδα κλειστή γραμμή προς έλεγχο ασφαλείας.                                                                                                                                       |
| [CLOSED_rowgroup_count]            | Ο αριθμός των ομάδων κλειστή γραμμή πρέπει να είναι χαμηλή Εάν οποιαδήποτε εμφανίζονται καθόλου. Κλειστή γραμμή ομάδες μπορούν να μετατραπούν σε συμπιεσμένο rowg roups χρησιμοποιώντας το ΕΥΡΕΤΉΡΙΟ ΤΡΟΠΟΠΟΙΉΣΟΥΝ... ΑΝΑΔΙΟΡΓΆΝΩΣΗ εντολή. Ωστόσο, αυτό δεν απαιτείται κανονικά. Κλειστή ομάδες μετατρέπονται αυτόματα σε ομάδες γραμμής columnstore από τη διαδικασία "πλειάδας πρόγραμμα μετακίνησης" φόντο.                                                                                               |
| [CLOSED_rowgroup_rows_MIN]         | Ομάδες κλειστή γραμμή θα πρέπει να έχουν πολύ υψηλή συμπλήρωσης χρέωσης. Εάν το επιτόκιο γεμίσματος για μια ομάδα κλειστή γραμμή είναι χαμηλή, στη συνέχεια, περαιτέρω ανάλυση της το columnstore απαιτείται.                                   |
| [CLOSED_rowgroup_rows_MAX]         | Ως παραπάνω                                                                                                                                                                                  |
| [CLOSED_rowgroup_rows_AVG]         | Ως παραπάνω                                                                                                                                                                                  |
| [Rebuild_Index_SQL]         | SQL για εκ νέου δημιουργία ευρετηρίου columnstore για έναν πίνακα                                                                                                                                                     |

## <a name="causes-of-poor-columnstore-index-quality"></a>Αιτίες columnstore κακή ποιότητα ευρετηρίου

Εάν έχετε προσδιορίσει πίνακες με το τμήμα κακή ποιότητα, που θα θέλετε να προσδιορίσετε την αιτία ριζικό κατάλογο.  Ακολουθούν ορισμένες άλλες κοινές αιτίες κακής τμήμα quaility:

1. Πίεση μνήμης κατά την οποία δημιουργήθηκε ευρετήριο
2. Μεγάλο όγκο ΟΘΔ λειτουργίες
3. Μικρό ή trickle λειτουργίες φόρτωσης
4. Πάρα πολλά διαμερίσματα

Τους παρακάτω παράγοντες μπορούν να προκαλέσουν ένα ευρετήριο columnstore να έχουν σημαντικά μικρότερη από τη βέλτιστη 1 εκατομμύριο γραμμές ανά ομάδα γραμμών.  Μπορεί επίσης να προκαλέσει γραμμές για να μεταβείτε στην ομάδα γραμμής delta αντί για μια ομάδα συμπιεσμένο γραμμής. 

### <a name="memory-pressure-when-index-was-built"></a>Πίεση μνήμης κατά την οποία δημιουργήθηκε ευρετήριο

Τον αριθμό των γραμμών ανά γραμμή συμπιεσμένο ομάδα έχουν άμεση σχέση με το πλάτος της γραμμής και το ποσό της μνήμης που είναι διαθέσιμη για την επεξεργασία της ομάδας γραμμής.  Όταν οι γραμμές είναι γραμμένες σε πίνακες columnstore στην περιοχή πίεση μνήμης, μπορεί να υποστεί columnstore τμήματος ποιότητας.  Επομένως, η βέλτιστη πρακτική είναι να δώσετε την περίοδο λειτουργίας που κάνει εγγραφή columnstore ευρετήριο πίνακες η πρόσβασή σας όσο μνήμης όσο το δυνατόν.  Επειδή υπάρχει μια συσχέτιση μεταξύ μνήμης και ταυτόχρονης εκτέλεσης, οι οδηγίες για την εκχώρηση μνήμης δεξιά εξαρτάται από τα δεδομένα σε κάθε γραμμή του πίνακα, το ποσό της DWU που έχετε έχει εκχωρηθεί στο σύστημα και το ποσό της ταυτόχρονης εκτέλεσης υποδοχές μπορείτε να δώσετε στην περίοδο λειτουργίας, το οποίο γίνεται η εγγραφή δεδομένων στον πίνακά σας.  Ως βέλτιστη πρακτική, συνιστάται να ξεκινούν με xlargerc Εάν χρησιμοποιείτε DW300 ή λιγότερο, largerc Εάν χρησιμοποιείτε DW400 να DW600 και mediumrc Εάν χρησιμοποιείτε DW1000 και παραπάνω.

### <a name="high-volume-of-dml-operations"></a>Μεγάλο όγκο ΟΘΔ λειτουργίες

Μεγάλο όγκο των λειτουργιών ΟΘΔ που ενημέρωση και διαγραφή γραμμών μπορεί να προκαλέσει αναποτελεσματικότητα στο το columnstore. Αυτό ισχύει ιδίως όταν το μεγαλύτερο μέρος των γραμμών σε μια ομάδα γραμμής έχουν τροποποιηθεί.

- Διαγραφή γραμμής από μια ομάδα συμπιεσμένο γραμμή μόνο λογικά επισημαίνει τη γραμμή ως διαγραμμένο. Η γραμμή παραμένει στην ομάδα συμπιεσμένο γραμμής μέχρι αναδόμηση τα διαμερίσματα ή τον πίνακα.
- Εισαγωγής μιας γραμμής προσθέτει της γραμμής σε πίνακα του εσωτερικού rowstore που ονομάζεται ομάδα delta γραμμής. Γραμμή που έχει εισαχθεί δεν μετατρέπεται σε columnstore μέχρι την ομάδα γραμμής delta είναι πλήρης και έχει επισημανθεί ως κλειστό. Γραμμή ομάδες είναι κλειστές, μόλις φτάνουν τη μέγιστη χωρητικότητα 1.048.576 γραμμών. 
- Ενημέρωση μιας γραμμής σε μορφή columnstore υποβάλλεται σε επεξεργασία ως μια λογική delete και, στη συνέχεια, μια εισαγωγή. Γραμμή που έχει εισαχθεί μπορεί να είναι αποθηκευμένα στο χώρο αποθήκευσης delta.

Μαζικής ενημέρωσης και να την εισαγάγετε λειτουργίες που υπερβαίνουν το όριο μαζικής 102,400 γραμμών ανά partition στοιχισμένα διανομής θα εγγράφονται απευθείας με τη μορφή columnstore. Ωστόσο, υπό την προϋπόθεση ότι μια κατανομή, θα πρέπει να τροποποίηση περισσότερα από 6.144 εκατομμύρια γραμμές σε μια λειτουργία μόνο για να συμβεί αυτό. Εάν ο αριθμός των γραμμών για μια δεδομένη partition στοιχισμένος κατανομή είναι μικρότερη από 102,400, στη συνέχεια, τις γραμμές, θα μεταβείτε στο store delta και θα παραμείνει εκεί, έως ότου επαρκή γραμμές έχουν εισαχθεί ή τροποποιηθεί για να κλείσετε την ομάδα γραμμών ή αναδόμηση της το ευρετήριο.

### <a name="small-or-trickle-load-operations"></a>Μικρό ή trickle λειτουργίες φόρτωσης

Μικρό φορτώνει ότι ροής σε αποθήκη δεδομένων του SQL μερικές φορές είναι γνωστές ως trickle φορτία. Αντιπροσωπεύουν συνήθως κοντά στο σταθερό ροή δεδομένων που έχει τεθεί κατάποση από το σύστημα. Ωστόσο, όπως αυτή η ροή είναι κοντά συνεχής τον όγκο των γραμμών δεν είναι ιδιαίτερα μεγάλη. Πιο συχνά από δεν τα δεδομένα είναι σημαντικά κάτω από το όριο που απαιτείται για μια άμεση φόρτωση σε μορφή columnstore.

Σε αυτές τις περιπτώσεις, συχνά είναι καλύτερα να ξεκινάτε πρώτα τα δεδομένα στο χώρο αποθήκευσης αντικειμένων blob του Azure και αφήστε να γίνει συγκεντρώσουν πριν από τη φόρτωση. Αυτή η τεχνική συχνά είναι γνωστό ως *δέσμης για τους*.

### <a name="too-many-partitions"></a>Πάρα πολλά διαμερίσματα

Κάτι άλλο πρέπει να λάβετε υπόψη είναι οι επιπτώσεις των διαμερισμάτων σε τους πίνακές σας ομαδοποιημένων columnstore.  Πριν από την διαμερισμάτων, αποθήκη δεδομένων του SQL διαιρεί ήδη τα δεδομένα σας σε 60 βάσεις δεδομένων.  Περαιτέρω διαμερισμάτων χωρίζει τα δεδομένα σας.  Εάν διαμερισμάτων των δεδομένων σας, στη συνέχεια, θα θέλετε να λάβετε υπόψη ότι **κάθε** διαμερίσματα θα πρέπει να έχετε τουλάχιστον 1 εκατομμύριο γραμμές για να επωφεληθείτε από ένα ευρετήριο ομαδοποιημένων columnstore.  Εάν μπορείτε να δημιουργήσετε διαμερίσματα πίνακα σε 100 διαμερίσματα, στη συνέχεια, τον πίνακά σας θα πρέπει να έχει τουλάχιστον 6 δισεκατομμυρίων γραμμές για να επωφεληθείτε από ένα ευρετήριο ομαδοποιημένων columnstore (60 κατανομές *100 διαμερίσματα* 1 εκατομμύριο γραμμές). Εάν ο πίνακας 100 partition δεν έχει γραμμές 6 δισεκατομμυρίων, μειώστε τον αριθμό των διαμερισμάτων ή μπορείτε να χρησιμοποιήσετε έναν πίνακα σωρού αντί για αυτό.

Αφού τους πίνακές σας έχουν φορτωθεί με δεδομένων, ακολουθήστε τα παρακάτω βήματα για να προσδιορίσετε και εκ νέου δημιουργία πινάκων με ευρετήρια columnstore κατώτερο του βέλτιστου σύμπλεγμα.

## <a name="rebuilding-indexes-to-improve-segment-quality"></a>Φτιάχνετε ευρετήρια για να βελτιώσω την ποιότητα του τμήματος

### <a name="step-1-identify-or-create-user-which-uses-the-right-resource-class"></a>Βήμα 1: Προσδιορίστε ή δημιουργήστε χρήστη που χρησιμοποιεί την κλάση δεξιά πόρων

Ένα γρήγορο τρόπο για να βελτιώσω την ποιότητα του τμήματος αμέσως είναι να δημιουργήσετε ξανά το ευρετήριο.  Η πρόταση SQL που επιστρέφονται από την παραπάνω προβολή θα επιστρέψει μια δήλωση ΤΡΟΠΟΠΟΙΉΣΟΥΝ ΑΝΑΔΌΜΗΣΗ ΕΥΡΕΤΗΡΊΟΥ που μπορεί να χρησιμοποιηθεί για να δημιουργήσετε ξανά το ευρετήρια.  Όταν φτιάχνετε ευρετήρια σας, φροντίστε που θα εκχωρηθεί αρκετή μνήμη για την περίοδο λειτουργίας που θα δημιουργήσετε ξανά το ευρετήριο.  Για να το κάνετε αυτό, αυξήστε την κλάση πόρων του χρήστη που έχει δικαιώματα για να δημιουργήσετε ξανά το ευρετήριο σε αυτόν τον πίνακα για την προτεινόμενη ελάχιστη.  Τάξη πόρων του χρήστη για τον κάτοχο της βάσης δεδομένων δεν μπορεί να αλλάξει, επομένως εάν δεν έχετε δημιουργήσει ένα χρήστη στο σύστημα, θα πρέπει να κάνετε πρώτα.  Η ελάχιστη τιμή συνιστάται να είναι xlargerc Εάν χρησιμοποιείτε DW300 ή λιγότερο, largerc Εάν χρησιμοποιείτε DW400 να DW600 και mediumrc Εάν χρησιμοποιείτε DW1000 και παραπάνω.

Ακολουθεί ένα παράδειγμα του τρόπου για να δεσμεύσετε περισσότερη μνήμη για ένα χρήστη, αυξάνοντας την κλάση πόρων τους.  Για περισσότερες πληροφορίες σχετικά με πόρο κλάσεις και πώς μπορείτε να δημιουργήσετε έναν νέο χρήστη μπορείτε να βρείτε στη [Διαχείριση ταυτόχρονης εκτέλεσης και φόρτο εργασίας] [ Concurrency] το άρθρο.

```sql
EXEC sp_addrolemember 'xlargerc', 'LoadUser'
```

### <a name="step-2-rebuild-clustered-columnstore-indexes-with-higher-resource-class-user"></a>Βήμα 2: Εκ νέου δημιουργία ευρετηρίων ομαδοποιημένων columnstore με υψηλότερη χρήστη κλάσης πόρων
Σύνδεση με το χρήστη από το βήμα 1 (π.χ. LoadUser), που είναι τώρα χρησιμοποιώντας ανώτερης κατηγορίας πόρων, και εκτελέστε τις δηλώσεις ΤΡΟΠΟΠΟΙΉΣΟΥΝ ΕΥΡΕΤΗΡΊΟΥ.  Βεβαιωθείτε ότι αυτός ο χρήστης έχει δικαίωμα πρόταση ALTER τους πίνακες όπου αναδόμηση το ευρετήριο.  Αυτά τα παραδείγματα δείχνουν πώς μπορείτε να δημιουργήσετε ξανά το ευρετήριο ολόκληρο columnstore ή πώς μπορείτε να δημιουργήσετε εκ νέου μια μεμονωμένη διαμερίσματα. Σε μεγάλους πίνακες, είναι περισσότερες πρακτικές να ξαναδημιουργήσετε ευρετήρια ένα διαμερίσματα μία κάθε φορά.

Εναλλακτικά, αντί να δημιουργείτε το ευρετήριο, που θα μπορούσε να αντιγράψετε τον πίνακα σε ένα νέο πίνακα με χρήση [CTAS][].  Ποιον τρόπο είναι καλύτερη; Για μεγάλους όγκους δεδομένων, [CTAS][] είναι συνήθως ταχύτερα από [ΤΡΟΠΟΠΟΙΉΣΟΥΝ ΕΥΡΕΤΗΡΊΟΥ][]. Για μικρότερες όγκους δεδομένων, [ΤΡΟΠΟΠΟΙΉΣΟΥΝ το ΕΥΡΕΤΉΡΙΟ][] είναι ευκολότερο να χρησιμοποιήσετε και δεν θα απαιτούν να αλλάξετε τον πίνακα.  Για περισσότερες λεπτομέρειες σχετικά με την εκ νέου δημιουργία ευρετηρίων με CTAS, ανατρέξτε στο θέμα **Rebuilding ευρετήρια με CTAS και αλλαγή διαμερίσματα** κάτω από το στοιχείο.

```sql
-- Rebuild the entire clustered index
ALTER INDEX ALL ON [dbo].[DimProduct] REBUILD
```

```sql
-- Rebuild a single partition
ALTER INDEX ALL ON [dbo].[FactInternetSales] REBUILD Partition = 5
```

```sql
-- Rebuild a single partition with archival compression
ALTER INDEX ALL ON [dbo].[FactInternetSales] REBUILD Partition = 5 WITH (DATA_COMPRESSION = COLUMNSTORE_ARCHIVE)
```

```sql
-- Rebuild a single partition with columnstore compression
ALTER INDEX ALL ON [dbo].[FactInternetSales] REBUILD Partition = 5 WITH (DATA_COMPRESSION = COLUMNSTORE)
```

Φτιάχνετε ένα ευρετήριο σε αποθήκη δεδομένων του SQL είναι μια λειτουργία χωρίς σύνδεση.  Για περισσότερες πληροφορίες σχετικά με τα ευρετήρια φτιάχνετε, ανατρέξτε στην ενότητα ΤΡΟΠΟΠΟΊΗΣΗ ΑΝΑΔΌΜΗΣΗ ΕΥΡΕΤΗΡΊΟΥ στο [Columnstore ευρετήρια ανασυγκρότησης][] και το θέμα σύνταξη [ΤΡΟΠΟΠΟΙΉΣΟΥΝ ΕΥΡΕΤΗΡΊΟΥ][].
 
### <a name="step-3-verify-clustered-columnstore-segment-quality-has-improved"></a>Βήμα 3: Επαλήθευση βελτιώθηκε ομαδοποιημένων columnstore τμήματος ποιότητα
Επανεκτέλεση του ερωτήματος ποια προσδιορισμένο πίνακα με κακής τμήμα ποιότητας και να επαληθεύσετε ποιότητα τμήματος βελτιώθηκε.  Εάν δεν έχει αλλάξει βελτιώνει την ποιότητα του τμήματος, μπορεί να είναι ότι οι γραμμές στον πίνακά σας είναι πολύ μεγάλη.  Μπορείτε να χρησιμοποιήσετε μια ανώτερης κατηγορίας πόρων ή DWU Όταν φτιάχνετε σας ευρετήρια.

 
## <a name="rebuilding-indexes-with-ctas-and-partition-switching"></a>Φτιάχνετε ευρετήρια με CTAS και διαμερίσματα μετάβασης

Αυτό το παράδειγμα χρησιμοποιεί [CTAS][] και διαμερίσματα εναλλαγής για να δημιουργήσετε ξανά ένα διαμερίσματα πίνακα. 

```sql
-- Step 1: Select the partition of data and write it out to a new table using CTAS
CREATE TABLE [dbo].[FactInternetSales_20000101_20010101]
    WITH    (   DISTRIBUTION = HASH([ProductKey])
            ,   CLUSTERED COLUMNSTORE INDEX
            ,   PARTITION   (   [OrderDateKey] RANGE RIGHT FOR VALUES
                                (20000101,20010101
                                )
                            )
            )
AS
SELECT  *
FROM    [dbo].[FactInternetSales]
WHERE   [OrderDateKey] >= 20000101
AND     [OrderDateKey] <  20010101
;

-- Step 2: Create a SWITCH out table
CREATE TABLE dbo.FactInternetSales_20000101
    WITH    (   DISTRIBUTION = HASH(ProductKey)
            ,   CLUSTERED COLUMNSTORE INDEX
            ,   PARTITION   (   [OrderDateKey] RANGE RIGHT FOR VALUES
                                (20000101
                                )
                            )
            )
AS
SELECT *
FROM    [dbo].[FactInternetSales]
WHERE   1=2 -- Note this table will be empty

-- Step 3: Switch OUT the data 
ALTER TABLE [dbo].[FactInternetSales] SWITCH PARTITION 2 TO  [dbo].[FactInternetSales_20000101] PARTITION 2;

-- Step 4: Switch IN the rebuilt data
ALTER TABLE [dbo].[FactInternetSales_20000101_20010101] SWITCH PARTITION 2 TO  [dbo].[FactInternetSales] PARTITION 2;
```

Για περισσότερες λεπτομέρειες σχετικά με την εκ νέου δημιουργία διαμερισμάτων χρησιμοποιώντας `CTAS`, ανατρέξτε στο άρθρο [διαμερίσματα][] .

## <a name="next-steps"></a>Επόμενα βήματα

Για περισσότερες πληροφορίες, ανατρέξτε στα άρθρα σε [Επισκόπηση πίνακα][Επισκόπηση], [Τύπους δεδομένων πίνακα][Τύπους δεδομένων], [τη διανομή πίνακα][κατανομή], [διαμερισμάτων πίνακα][διαμερισμάτων], [Λαμβάνοντας υπόψη στατιστικά στοιχεία πίνακα][στατιστικών στοιχείων] και [Προσωρινό πίνακες][προσωρινό].  Για να μάθετε περισσότερα σχετικά με τις βέλτιστες πρακτικές, ανατρέξτε στο θέμα [Βέλτιστες πρακτικές αποθήκη δεδομένων SQL][].

<!--Image references-->

<!--Article references-->
[Επισκόπηση]: ./sql-data-warehouse-tables-overview.md
[Τύποι δεδομένων]: ./sql-data-warehouse-tables-data-types.md
[Διανομή]: ./sql-data-warehouse-tables-distribute.md
[Ευρετήριο]: ./sql-data-warehouse-tables-index.md
[Partition]: ./sql-data-warehouse-tables-partition.md
[Στατιστικά στοιχεία]: ./sql-data-warehouse-tables-statistics.md
[Προσωρινό]: ./sql-data-warehouse-tables-temporary.md
[Concurrency]: ./sql-data-warehouse-develop-concurrency.md
[CTAS]: ./sql-data-warehouse-develop-ctas.md
[Βέλτιστες πρακτικές αποθήκη δεδομένων SQL]: ./sql-data-warehouse-best-practices.md

<!--MSDN references-->
[Η ΠΡΌΤΑΣΗ ALTER ΕΥΡΕΤΗΡΊΟΥ]: https://msdn.microsoft.com/library/ms188388.aspx
[σωρού]: https://msdn.microsoft.com/library/hh213609.aspx
[τα ευρετήρια ομαδοποιημένων και μη συγκεντρωτικών ευρετηρίων]: https://msdn.microsoft.com/library/ms190457.aspx
[Δημιουργία πίνακα σύνταξη]: https://msdn.microsoft.com/library/mt203953.aspx
[Columnstore ευρετήρια ανασυγκρότησης]: https://msdn.microsoft.com/library/dn935013.aspx#Anchor_1
[ομαδοποιημένη columnstore ευρετήρια]: https://msdn.microsoft.com/library/gg492088.aspx

<!--Other Web references-->
