<properties
   pageTitle="Διαχείριση συγχρονισμού και φόρτο εργασίας στο αποθήκη δεδομένων του SQL | Microsoft Azure"
   description="Κατανόηση της διαχείρισης ταυτόχρονης εκτέλεσης και φόρτο εργασίας σε αποθήκη δεδομένων του SQL Azure για την ανάπτυξη λύσεων."
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="sonyam"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="09/27/2016"
   ms.author="sonyama;barbkess;jrj"/>

# <a name="concurrency-and-workload-management-in-sql-data-warehouse"></a>Διαχείριση συγχρονισμού και φόρτο εργασίας στο αποθήκη δεδομένων του SQL

Για να παρέχουν προβλέψιμα επιδόσεων σε κλίμακα, βοηθά στην αποθήκη δεδομένων SQL Microsoft Azure μπορείτε να ελέγχετε ταυτόχρονης εκτέλεσης επίπεδα και τις αναθέσεις πόρων όπως μνήμης και CPU προτεραιότητα. Σε αυτό το άρθρο σάς παρουσιάζει τις έννοιες της ταυτόχρονης εκτέλεσης και φόρτο εργασίας διαχείρισης, που εξηγεί τον τρόπο και των δύο δυνατοτήτων εφαρμόστηκαν και πώς μπορείτε να ελέγξετε τους στην αποθήκη δεδομένων σας. Διαχείριση φόρτου εργασίας αποθήκη δεδομένων του SQL προορίζεται για να σας βοηθήσει να υποστηρίζει περιβάλλοντα πολλών χρηστών. Δεν προορίζεται για φόρτους εργασίας πολλών μισθωτή.

## <a name="concurrency-limits"></a>Όρια συγχρονισμού

Αποθήκη δεδομένων του SQL επιτρέπει έως 1.024 ταυτόχρονες συνδέσεις. Όλες οι συνδέσεις 1.024 να υποβάλετε ερωτήματα ταυτόχρονα. Ωστόσο, για να βελτιστοποιήσετε μετάδοσης, αποθήκη δεδομένων του SQL μπορεί να ουρά ορισμένα ερωτήματα για να βεβαιωθείτε ότι κάθε ερώτημα λαμβάνει μια εκχώρηση ελάχιστους μνήμης. Υπηρεσία ουράς πραγματοποιείται κατά το χρόνο εκτέλεσης του ερωτήματος. Από ουράς ερωτήματα όταν έχουν συμπληρωθεί όρια ταυτόχρονης εκτέλεσης, αποθήκη δεδομένων του SQL να αυξήσετε συνολικός αριθμός, εξασφαλίζοντας ότι ενεργό ερωτήματα πρόσβαση σε πόρους εξαιρετικά απαιτείται μνήμης.  

Όρια ταυτόχρονης εκτέλεσης είναι διέπεται από δύο έννοιες: *ταυτόχρονες ερωτήματα* και *υποδοχές ταυτόχρονης εκτέλεσης*. Για ένα ερώτημα για την εκτέλεση, πρέπει να εκτελεί εντός του ορίου ταυτόχρονης εκτέλεσης του ερωτήματος και η εκχώρηση υποδιαίρεση ταυτόχρονης εκτέλεσης.

- Ταυτόχρονες ερωτήματα είναι τα ερωτήματα εκτέλεση την ίδια στιγμή. Αποθήκη δεδομένων του SQL υποστηρίζει έως 32 ταυτόχρονες ερωτήματα σχετικά με το το μεγαλύτερο μέγεθος DWU.
- Υποδοχές ταυτόχρονης εκτέλεσης εκχωρούνται με βάση DWU. Κάθε 100 DWU παρέχει 4 υποδοχές ταυτόχρονης εκτέλεσης. Για παράδειγμα, μια DW100 εκχωρεί 4 υποδοχές ταυτόχρονης εκτέλεσης και DW1000 εκχωρεί 40. Κάθε ερώτημα καταναλώνει μία ή περισσότερες ταυτόχρονης εκτέλεσης εσοχές, εξαρτάται από την [κλάση πόρων](#resource-classes) του ερωτήματος. Ερωτήματα που εκτελούνται στην τάξη πόρων smallrc κατανάλωση μία υποδοχή ταυτόχρονης εκτέλεσης. Ερωτήματα που εκτελούνται σε κλάση πόρων υψηλότερη εκμετάλλευση περισσότερες υποδοχές ταυτόχρονης εκτέλεσης.

Ο παρακάτω πίνακας περιγράφει τα όρια για ταυτόχρονες ερωτήματα και υποδοχές ταυτόχρονης εκτέλεσης με τα διάφορα μεγέθη DWU.

### <a name="concurrency-limits"></a>Όρια συγχρονισμού

|  DWU   | Max ταυτόχρονες ερωτημάτων  | Υποδοχές ταυτόχρονης εκτέλεσης έχει εκχωρηθεί |
| :----  | :---------------------: | :-------------------------: |
| DW100  |            4            |                4            |
| DW200  |            8            |                8            |
| DW300  |           12            |               12            |
| DW400  |           16            |               16            |
| DW500  |           20            |               20            |
| DW600  |           24            |               24            |
| DW1000 |           32            |               40            |
| DW1200 |           32            |               48            |
| DW1500 |           32            |               60            |
| DW2000 |           32            |               80            |
| DW3000 |           32            |              120            |
| DW6000 |           32            |              240            |

Όταν ένα από αυτά τα όρια ικανοποιείται, νέα ερωτήματα είναι στην ουρά και να εκτελούνται σε βάση εισόδου του.  Καθώς ολοκληρώνεται μια ερωτημάτων και ο αριθμός των ερωτημάτων και υποδοχές είναι μικρότερος από τα όρια, έχουν κυκλοφορήσει σε ουρά ερωτήματα. 

> [AZURE.NOTE]  *Επιλέξτε* ερωτήματα εκτέλεση αποκλειστικά στη Διαχείριση δυναμικών προβολών (DMVs) ή προβολές καταλόγου δεν είναι διέπεται από οποιοδήποτε από τα όρια ταυτόχρονης εκτέλεσης. Μπορείτε να παρακολουθήσετε το σύστημα ανεξάρτητα από τον αριθμό των ερωτήματα εκτέλεση σε αυτό.

## <a name="resource-classes"></a>Κλάσεις πόρων

Πόρος κλάδους Βοήθειας που ελέγχουν εκχώρηση μνήμης και κύκλους Επεξεργαστή που δίνεται σε ένα ερώτημα. Μπορείτε να αντιστοιχίσετε τέσσερις κατηγορίες πόρων σε ένα χρήστη με τη μορφή *ρόλους βάσης δεδομένων*. Οι κλάσεις τέσσερις πόρων είναι **smallrc**, **mediumrc**, **largerc**και **xlargerc**. Χρήστες του smallrc παρέχονται μικρότερη ποσότητα μνήμης και να επωφεληθείτε από υψηλότερη ταυτόχρονης εκτέλεσης. Αντίθετα, οι χρήστες στους οποίους έχουν ανατεθεί xlargerc έχουν μεγάλες ποσότητες μνήμης και, επομένως, λιγότερες τους ερωτημάτων μπορούν να εκτελούνται ταυτόχρονα.

Από προεπιλογή, κάθε χρήστης είναι μέλος της κλάσης μικρές πόρων, smallrc. Η διαδικασία `sp_addrolemember` χρησιμοποιείται για να αυξήσετε την κλάση πόρων, και `sp_droprolemember` χρησιμοποιείται για να μειώσετε την κλάση πόρων. Για παράδειγμα, αυτή η εντολή θα αυξήσετε την κλάση πόρων του loaduser να largerc:

```sql
EXEC sp_addrolemember 'largerc', 'loaduser'
```

Μια καλή πρακτική είναι να οριστικά αντιστοίχιση χρηστών σε ένα εκπαιδευτικό πόρων, αντί να αλλάξετε τις τάξεις τους πόρων. Για παράδειγμα, φορτία στους πίνακες ομαδοποιημένων columnstore δημιουργία ευρετηρίων υψηλότερη ποιότητα όταν έχει εκχωρηθεί περισσότερη μνήμη. Για να βεβαιωθείτε ότι η φόρτωση έχουν πρόσβαση σε υψηλότερη μνήμης, δημιουργήστε ένα χρήστη ειδικά για τη φόρτωση των δεδομένων και να αντιστοιχίσετε μόνιμα αυτόν το χρήστη για ένα εκπαιδευτικό πόρων υψηλότερη.

Υπάρχουν μερικά τύποι ερωτημάτων που δεν διαθέτουν ένα μεγαλύτερο εκχώρηση μνήμης. Το σύστημα θα Παράβλεψη την εκχώρηση πόρων κλάσης και να εκτελείτε πάντα αυτά τα ερωτήματα στην τάξη μικρές πόρων αντί για αυτό. Εάν εκτελείτε πάντα αυτά τα ερωτήματα στην τάξη μικρές πόρων, που μπορούν να εκτελούν όταν υποδοχές ταυτόχρονης εκτέλεσης είναι υπό πίεση και δεν θα καταλαμβάνουν περισσότερες υποδοχές από χρειάζεται. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Εξαιρέσεις κλάσης πόρων](#query-exceptions-to-concurrency-limits) .

Μερικά περισσότερες λεπτομέρειες σχετικά με κλάση πόρων:

- *Αλλαγή ρόλων* δικαιωμάτων είναι απαραίτητη για να αλλάξετε την κλάση πόρων του χρήστη.  
- Παρόλο που μπορείτε να προσθέσετε ένα χρήστη σε μία ή περισσότερες από τις κατηγορίες πόρων υψηλότερη, οι χρήστες θα χρειαστούν τα χαρακτηριστικά της κλάσης πόρων υψηλότερη που τους έχουν ανατεθεί. Αυτό σημαίνει ότι, εάν ένας χρήστης έχει αντιστοιχιστεί σε mediumrc και largerc, την κλάση πόρων υψηλότερη (largerc) είναι η κλάση πόρων που θα εξακολουθήσουν να ισχύουν.  
- Δεν μπορεί να αλλάξει την κλάση πόρων του χρήστης με δικαιώματα διαχειριστή συστήματος.

Για ένα αναλυτικό παράδειγμα, ανατρέξτε στο θέμα [Αλλαγή χρήστη πόρων κλάσης παράδειγμα](#changing-user-resource-class-example).

## <a name="memory-allocation"></a>Εκχώρηση μνήμης

Υπάρχουν πλεονεκτήματα και μειονεκτήματα σε αύξουσα κλάση πόρων ενός χρήστη. Αύξηση κλάση πόρων για ένα χρήστη θα σας δώσει την πρόσβασή τους ερωτήματα για περισσότερη μνήμη, τα οποία μπορεί να σημαίνει ταχύτερη εκτέλεση ερωτημάτων.  Ωστόσο, ανώτερες κατηγορίες πόρων επίσης Μειώστε τον αριθμό των ταυτόχρονες ερωτήματα που μπορεί να εκτελέσει. Αυτό είναι το συσχετισμό μεταξύ της δυνατότητας άλλων ερωτημάτων, τα οποία πρέπει επίσης εκχωρήσεις μνήμης, για να εκτελέσετε ταυτόχρονα ή εκχώρηση μεγάλες ποσότητες μνήμης σε ένα ερώτημα. Εάν ένας χρήστης έχει δοθεί υψηλή εκχωρήσεων μνήμης για ένα ερώτημα, οι άλλοι χρήστες δεν θα έχουν πρόσβαση στο ότι η ίδια μνήμη για να εκτελέσετε ένα ερώτημα.

Ο παρακάτω πίνακας αντιστοιχίζει τη μνήμη εκχωρηθεί σε κάθε διανομής από την κλάση DWU και πόρων.

### <a name="memory-allocations-per-distribution-mb"></a>Εκχωρήσεις μνήμης ανά διανομής (MB)

|  DWU   | smallrc | mediumrc | largerc | xlargerc |
| :----- | :-----: | :------: | :-----: | :------: |
| DW100  |   100   |    100   |    200  |    400   |
| DW200  |   100   |    200   |    400  |    800   |
| DW300  |   100   |    200   |    400  |    800   |
| DW400  |   100   |    400   |    800  |  1.600   |
| DW500  |   100   |    400   |    800  |  1.600   |
| DW600  |   100   |    400   |    800  |  1.600   |
| DW1000 |   100   |    800   |  1.600  |  3.200   |
| DW1200 |   100   |    800   |  1.600  |  3.200   |
| DW1500 |   100   |    800   |  1.600  |  3.200   |
| DW2000 |   100   |  1.600   |  3.200  |  6,400   |
| DW3000 |   100   |  1.600   |  3.200  |  6,400   |
| DW6000 |   100   |  3.200   |  6,400  |  12,800  |

Από τον παραπάνω πίνακα, μπορείτε να δείτε ότι ένα ερώτημα που εκτελείται σε ένα DW2000 στην τάξη πόρων xlargerc θα έχουν πρόσβαση σε 6.400 MB μνήμης μέσα σε κάθε μία από τις 60 κατανέμεται βάσεις δεδομένων.  Σε αποθήκη δεδομένων του SQL, υπάρχουν 60 κατανομές. Επομένως, για να υπολογίσετε την εκχώρηση συνολική μνήμη για ένα ερώτημα σε ένα εκπαιδευτικό δεδομένο πόρο, τις παραπάνω τιμές πρέπει να πολλαπλασιάζεται με το 60.

### <a name="memory-allocations-system-wide-gb"></a>Μνήμη εκχωρήσεις ολόκληρο το σύστημα (GB)

|  DWU   | smallrc | mediumrc | largerc | xlargerc |
| :----- | :-----: | :------: | :-----: | :------: |
| DW100  |    6    |    6     |    12   |    23    |
| DW200  |    6    |    12    |    23   |    47    |
| DW300  |    6    |    12    |    23   |    47    |
| DW400  |    6    |    23    |    47   |    94    |
| DW500  |    6    |    23    |    47   |    94    |
| DW600  |    6    |    23    |    47   |    94    |
| DW1000 |    6    |    47    |    94   |   188    |
| DW1200 |    6    |    47    |    94   |   188    |
| DW1500 |    6    |    47    |    94   |   188    |
| DW2000 |    6    |    94    |   188   |   375    |
| DW3000 |    6    |    94    |   188   |   375    |
| DW6000 |    6    |   188    |   375   |   750    |

Από αυτόν τον πίνακα εκχωρήσεις μνήμης σε ολόκληρο το σύστημα, μπορείτε να δείτε ότι ένα ερώτημα που εκτελείται σε ένα DW2000 στην τάξη xlargerc πόρου που έχει εκχωρηθεί συνολικά 375 GB μνήμης (κατανομές 6.400 MB * 60 / 1.024 για να μετατρέψετε σε GB) πάνω από το σύνολο της σας αποθήκη δεδομένων του SQL.

## <a name="concurrency-slot-consumption"></a>Κατανάλωση υποδιαίρεση ταυτόχρονης εκτέλεσης

Αποθήκη δεδομένων του SQL εκχωρεί περισσότερη μνήμη στα ερωτήματα που εκτελούνται σε ανώτερες κατηγορίες πόρων. Μνήμη είναι σταθερό πόρου.  Γι ' αυτό, η περισσότερη μνήμη που έχει εκχωρηθεί ανά ερώτημα, τα λιγότερα ταυτόχρονες ερωτήματα μπορεί να εκτελέσει. Ο παρακάτω πίνακας reiterates όλες τις προηγούμενες έννοιες σε μια ενιαία προβολή που εμφανίζει τον αριθμό των ταυτόχρονης εκτέλεσης υποδοχές διαθέσιμο από DWU και τις υποδοχές που καταναλώνεται από κάθε κατηγορία πόρων.

### <a name="allocation-and-consumption-of-concurrency-slots"></a>Εκχώρηση και κατανάλωση υποδοχές ταυτόχρονης εκτέλεσης

|  DWU   | Μέγιστος αριθμός ταυτόχρονες ερωτημάτων  | Υποδοχές ταυτόχρονης εκτέλεσης έχει εκχωρηθεί | Υποδοχές χρησιμοποιούνται από smallrc |  Υποδοχές χρησιμοποιούνται από mediumrc |  Υποδοχές χρησιμοποιούνται από largerc |  Υποδοχές χρησιμοποιούνται από xlargerc |
| :----  | :---------------------: | :-------------------------: | :-----: | :------: | :-----: | :------: |
| DW100  |            4            |                4            |    1    |     1    |    2    |    4     |
| DW200  |            8            |                8            |    1    |     2    |    4    |    8     |
| DW300  |           12            |               12            |    1    |     2    |    4    |    8     |
| DW400  |           16            |               16            |    1    |     4    |    8    |   16     |
| DW500  |           20            |               20            |    1    |     4    |    8    |   16     |
| DW600  |           24            |               24            |    1    |     4    |    8    |   16     |
| DW1000 |           32            |               40            |    1    |     8    |   16    |   32     |
| DW1200 |           32            |               48            |    1    |     8    |   16    |   32     |
| DW1500 |           32            |               60            |    1    |     8    |   16    |   32     |
| DW2000 |           32            |               80            |    1    |    16    |   32    |   64     |
| DW3000 |           32            |              120            |    1    |    16    |   32    |   64     |
| DW6000 |           32            |              240            |    1    |    32    |   64    |  128     |


Από αυτόν τον πίνακα, μπορείτε να δείτε που εκτελείται αποθήκη δεδομένων του SQL, όπως DW1000 εκχωρεί έως 32 ταυτόχρονες ερωτημάτων και ένα σύνολο από 40 υποδοχές ταυτόχρονης εκτέλεσης. Εάν εκτελείται όλους τους χρήστες στο smallrc, επειδή κάθε ερώτημα θα εκμετάλλευση 1 υποδοχή ταυτόχρονης εκτέλεσης θα επιτρέπεται 32 ταυτόχρονες ερωτήματα. Εάν εκτελείτε όλους τους χρήστες σε μια DW1000 στο mediumrc, κάθε ερώτημα θα θα εκχωρηθεί 800 MB ανά κατανομή για εκχώρηση μνήμης σύνολο των 47 GB ανά ερώτημα και ταυτόχρονης εκτέλεσης μπορεί να περιορίζεται σε 5 χρήστες (40 υποδοχές ταυτόχρονης εκτέλεσης / 8 υποδοχές ανά χρήστη mediumrc).

## <a name="query-importance"></a>Ερώτημα σπουδαιότητα

Αποθήκη δεδομένων του SQL υλοποιεί κλάσεις πόρων, χρησιμοποιώντας τις ομάδες φόρτο εργασίας. Υπάρχουν οκτώ ομάδες φόρτο εργασίας που ελέγχουν τη συμπεριφορά των κλάσεων πόρων σε τα διάφορα μεγέθη DWU συνολικά. Για οποιαδήποτε DWU, αποθήκη δεδομένων του SQL χρησιμοποιεί μόνο τέσσερις ή τις ομάδες οκτώ φόρτο εργασίας. Αυτό έχει νόημα, επειδή κάθε ομάδα φόρτο εργασίας έχει αντιστοιχιστεί σε μία από τις τέσσερις κατηγορίες πόρων: smallrc, mediumrc, largerc, ή xlargerc. Τη σπουδαιότητα του Κατανόηση των ομάδων φόρτο εργασίας είναι ότι ορισμένες από αυτές τις ομάδες φόρτο εργασίας έχουν ρυθμιστεί στην υψηλότερη *σπουδαιότητα*. Σπουδαιότητας χρησιμοποιείται για το CPU προγραμματισμού. Ερωτήματα που εκτελούνται με Υψηλή σπουδαιότητα θα λάβουν τρεις φορές περισσότερη κύκλους Επεξεργαστή από εκείνους με Μεσαίο σπουδαιότητα. Γι ' αυτό, αντιστοιχίσεις υποδιαίρεση ταυτόχρονης εκτέλεσης επίσης τον καθορισμό προτεραιότητας CPU. Όταν ένα ερώτημα καταναλώνει 16 ή περισσότερες εσοχές, εκτελείται ως υψηλής σπουδαιότητας.

Ο παρακάτω πίνακας εμφανίζει τις αντιστοιχίσεις σπουδαιότητας για κάθε ομάδα φόρτο εργασίας.

### <a name="workload-group-mappings-to-concurrency-slots-and-importance"></a>Αντιστοιχίσεις ομάδα φόρτο εργασίας σε υποδοχές ταυτόχρονης εκτέλεσης και σπουδαιότητα

| Ομάδες φόρτο εργασίας | Αντιστοίχιση υποδιαίρεση ταυτόχρονης εκτέλεσης | MB / κατανομή | Αντιστοίχιση σπουδαιότητας |
| :-------------- | :----------------------: | :---------------: | :----------------- |
| SloDWGroupC00   |            1             |         100       |       Μεσαίο       |
| SloDWGroupC01   |            2             |         200       |       Μεσαίο       |
| SloDWGroupC02   |            4             |         400       |       Μεσαίο       |
| SloDWGroupC03   |            8             |         800       |       Μεσαίο       |
| SloDWGroupC04   |           16             |       1.600       |       Υψηλή         |
| SloDWGroupC05   |           32             |       3.200       |       Υψηλή         |
| SloDWGroupC06   |           64             |       6,400       |       Υψηλή         |
| SloDWGroupC07   |          128             |      12,800       |       Υψηλή         |

Από το γράφημα **εκχώρησης και κατανάλωση υποδοχές ταυτόχρονης εκτέλεσης** , μπορείτε να δείτε ότι ένα DW500 χρησιμοποιεί 1, 4, 8 ή 16 ταυτόχρονης εκτέλεσης υποδοχές για smallrc, mediumrc, largerc και xlargerc, αντίστοιχα. Μπορείτε να δείτε αυτές τις τιμές προς τα επάνω στο προηγούμενο γράφημα για να βρείτε τη σπουδαιότητα για κάθε κατηγορία πόρων.

### <a name="dw500-mapping-of-resource-classes-to-importance"></a>DW500 αντιστοίχιση πόρων κλάσεων σπουδαιότητα

| Κλάση πόρων | Ομάδα φόρτο εργασίας | Υποδοχές ταυτόχρονης εκτέλεσης χρησιμοποιούνται | MB / κατανομή | Σπουδαιότητα |
| :------------- | :------------- | :--------------------: | :---------------: | :--------- |
| smallrc        | SloDWGroupC00  |           1            |         100       |   Μεσαίο   |
| mediumrc       | SloDWGroupC02  |           4            |         400       |   Μεσαίο   |
| largerc        | SloDWGroupC03  |           8            |         800       |   Μεσαίο   |
| xlargerc       | SloDWGroupC04  |          16            |        1.600      |   Υψηλή     |


Μπορείτε να χρησιμοποιήσετε το ακόλουθο ερώτημα DMV για να δείτε τις διαφορές στις εκχώρηση πόρων μνήμης με λεπτομέρειες από την οπτική του ο ρυθμιστής πόρων, ή για να αναλύσετε ενεργό και ιστορικό χρήσης των ομάδων φόρτο εργασίας κατά την αντιμετώπιση προβλημάτων.

```sql
WITH rg
AS
(   SELECT  
     pn.name                        AS node_name
    ,pn.[type]                      AS node_type
    ,pn.pdw_node_id                 AS node_id
    ,rp.name                        AS pool_name
    ,rp.max_memory_kb*1.0/1024              AS pool_max_mem_MB
    ,wg.name                        AS group_name
    ,wg.importance                  AS group_importance
    ,wg.request_max_memory_grant_percent        AS group_request_max_memory_grant_pcnt
    ,wg.max_dop                     AS group_max_dop
    ,wg.effective_max_dop               AS group_effective_max_dop
    ,wg.total_request_count             AS group_total_request_count
    ,wg.total_queued_request_count          AS group_total_queued_request_count
    ,wg.active_request_count                AS group_active_request_count
    ,wg.queued_request_count                AS group_queued_request_count
    FROM    sys.dm_pdw_nodes_resource_governor_workload_groups wg
    JOIN    sys.dm_pdw_nodes_resource_governor_resource_pools rp    
            ON  wg.pdw_node_id  = rp.pdw_node_id
            AND wg.pool_id      = rp.pool_id
    JOIN    sys.dm_pdw_nodes pn
            ON  wg.pdw_node_id  = pn.pdw_node_id
    WHERE   wg.name like 'SloDWGroup%'
        AND     rp.name = 'SloDWPool'
)
SELECT  pool_name
,       pool_max_mem_MB
,       group_name
,       group_importance
,       (pool_max_mem_MB/100)*group_request_max_memory_grant_pcnt AS max_memory_grant_MB
,       node_name
,       node_type
,       group_total_request_count
,       group_total_queued_request_count
,       group_active_request_count
,       group_queued_request_count
FROM    rg
ORDER BY
    node_name
,   group_request_max_memory_grant_pcnt
,   group_importance
;
```

## <a name="queries-that-honor-concurrency-limits"></a>Ερωτήματα που διατηρεί όρια ταυτόχρονης εκτέλεσης

Περισσότερα ερωτήματα είναι διέπεται από κλάσεις πόρων. Αυτά τα ερωτήματα πρέπει να χωράει μέσα σε δύο τα ταυτόχρονες ερωτήματος και ταυτόχρονης εκτέλεσης υποδιαίρεση όρια. Για να εξαιρέσετε ένα ερώτημα από το μοντέλο υποδιαίρεση ταυτόχρονης εκτέλεσης δεν μπορεί να επιλέξει ο χρήστης.

Για να επαναλαμβάνουν, τις παρακάτω προτάσεις εκτελέσει κλάσεις πόρων:

- ΕΠΙΛΈΞΤΕ ΕΙΣΑΓΩΓΉ
- ΕΝΗΜΈΡΩΣΗ
- ΔΙΑΓΡΑΦΉ
- ΕΠΙΛΈΞΤΕ (κατά την υποβολή ερωτήματος χρήστη πίνακες)
- Η ΠΡΌΤΑΣΗ ALTER ΕΚ ΝΈΟΥ ΔΗΜΙΟΥΡΓΊΑ ΕΥΡΕΤΗΡΊΟΥ
- Η ΠΡΌΤΑΣΗ ALTER ΑΝΑΔΙΟΡΓΆΝΩΣΗ ΕΥΡΕΤΗΡΊΟΥ
- Η ΠΡΌΤΑΣΗ ALTER ΕΚ ΝΈΟΥ ΔΗΜΙΟΥΡΓΊΑ ΠΊΝΑΚΑ
- ΔΗΜΙΟΥΡΓΊΑ ΕΥΡΕΤΗΡΊΟΥ
- ΔΗΜΙΟΥΡΓΊΑ ΕΥΡΕΤΗΡΊΟΥ ΟΜΑΔΟΠΟΙΗΜΈΝΩΝ COLUMNSTORE
- ΔΗΜΙΟΥΡΓΊΑ ΠΊΝΑΚΑ ΩΣ ΕΠΙΛΟΓΉ (CTAS)
- Φόρτωση δεδομένων
- Εργασίες κίνηση δεδομένων που πραγματοποιούνται από την υπηρεσία κίνηση δεδομένων (DMS)

## <a name="query-exceptions-to-concurrency-limits"></a>Εξαιρέσεις όρια ταυτόχρονης εκτέλεσης ερωτήματος

Ορισμένα ερωτήματα διατηρεί την κλάση πόρου στον οποίο έχει ανατεθεί ο χρήστης. Οι εξαιρέσεις από τα όρια ταυτόχρονης εκτέλεσης πραγματοποιούνται όταν οι πόροι μνήμης που χρειάζονται για μια συγκεκριμένη εντολή είναι χαμηλή, συχνά επειδή η εντολή είναι μια λειτουργία μετα-δεδομένων. Ο στόχος αυτές εξαιρέσεις είναι για να αποφύγετε μεγαλύτερο εκχωρήσεις μνήμης για τα ερωτήματα που θα χρειαστείτε ποτέ τους. Σε αυτές τις περιπτώσεις, η προεπιλεγμένη κλάση μικρές πόρων (smallrc) χρησιμοποιείται πάντα ανεξάρτητα από την κλάση πραγματική πόρων που έχουν εκχωρηθεί στο χρήστη. Για παράδειγμα, `CREATE LOGIN` θα εκτελούνται πάντα σε smallrc. Οι πόροι που απαιτούνται για την κάλυψη αυτή η λειτουργία είναι πολύ χαμηλή, ώστε να αυτό δεν έχει νόημα να συμπεριλάβετε στο ερώτημα στο μοντέλο υποδιαίρεση ταυτόχρονης εκτέλεσης.  Αυτά τα ερωτήματα επίσης δεν περιορίζονται από το όριο ταυτόχρονης εκτέλεσης 32 χρηστών, απεριόριστες αυτά τα ερωτήματα είναι δυνατό να εκτελεστεί προς τα επάνω για να το όριο περιόδου λειτουργίας 1.024 περιόδων λειτουργίας.

Οι παρακάτω προτάσεις διατηρεί κλάσεις πόρων:

- ΔΗΜΙΟΥΡΓΊΑ ή ΑΠΌΡΡΙΨΗ ΠΊΝΑΚΑ
- ΤΡΟΠΟΠΟΊΗΣΗ ΤΟΥ ΠΊΝΑΚΑ... ΕΝΑΛΛΑΓΉ, ΔΙΑΊΡΕΣΗ ή ΣΥΓΧΏΝΕΥΣΗ PARTITION
- Η ΠΡΌΤΑΣΗ ALTER ΑΠΕΝΕΡΓΟΠΟΊΗΣΗ ΕΥΡΕΤΗΡΊΟΥ
- ΑΠΌΘΕΣΗ ΕΥΡΕΤΗΡΊΟΥ
- ΔΗΜΙΟΥΡΓΊΑ, ΕΝΗΜΈΡΩΣΗ ή ΑΠΌΡΡΙΨΗ στατιστικά ΣΤΟΙΧΕΊΑ
- ΠΕΡΙΚΟΠΉ ΠΊΝΑΚΑ
- Η ΠΡΌΤΑΣΗ ALTER ΕΞΟΥΣΙΟΔΌΤΗΣΗΣ
- ΔΗΜΙΟΥΡΓΊΑ ΣΎΝΔΕΣΗΣ
- ΔΗΜΙΟΥΡΓΊΑ, ΤΡΟΠΟΠΟΊΗΣΗ ή DROP USER
- ΔΗΜΙΟΥΡΓΊΑ, ΤΡΟΠΟΠΟΊΗΣΗ ή ΑΠΟΘΈΣΤΕ τη ΔΙΑΔΙΚΑΣΊΑ
- ΔΗΜΙΟΥΡΓΊΑ ή ΠΡΟΒΟΛΉ ΑΠΌΘΕΣΗΣ
- ΕΙΣΑΓΆΓΕΤΕ ΤΙΜΈΣ
- ΕΠΙΛΈΞΤΕ από προβολές συστήματος και DMVs
- ΕΠΕΞΉΓΗΣΗ
- DBCC

<!--
Removed as these two are not confirmed / supported under SQLDW
- CREATE REMOTE TABLE AS SELECT
- CREATE EXTERNAL TABLE AS SELECT
- REDISTRIBUTE
-->

## <a name="change-a-user-resource-class-example"></a>Αλλαγή ένα παράδειγμα κλάσης πόρου χρήστη

1. **Δημιουργία σύνδεσης:** Ανοίξτε μια σύνδεση με την **κύρια** βάση δεδομένων στον SQL server φιλοξενίας τη βάση δεδομένων SQL Data Warehouse και εκτελεί τις παρακάτω εντολές.

    ```sql
    CREATE LOGIN newperson WITH PASSWORD = 'mypassword';
    CREATE USER newperson for LOGIN newperson;
    ```

    > [AZURE.NOTE] Είναι καλή ιδέα να δημιουργήσετε έναν χρήστη στην κύρια βάση δεδομένων για τους χρήστες αποθήκη δεδομένων του SQL Azure. Δημιουργία ενός χρήστη στο υπόδειγμα επιτρέπει στο χρήστη να συνδεθείτε με εργαλεία όπως SSMS χωρίς να καθορίσετε ένα όνομα βάσης δεδομένων.  Αυτό σας επιτρέπει επίσης να χρησιμοποιήσετε την Εξερεύνηση του αντικειμένου για να δείτε όλες τις βάσεις δεδομένων SQL server.  Για περισσότερες λεπτομέρειες σχετικά με τη δημιουργία και τη διαχείριση των χρηστών, ανατρέξτε στο θέμα [ασφαλούς μια βάση δεδομένων στην αποθήκη δεδομένων του SQL][].

2. **Δημιουργία αποθήκη δεδομένων του SQL χρήστη:** Ανοίξτε μια σύνδεση με τη βάση δεδομένων **SQL Data Warehouse** και εκτελέστε την ακόλουθη εντολή.

    ```sql
    CREATE USER newperson FOR LOGIN newperson;
    ```

3. **Εκχώρηση δικαιωμάτων:** Το παρακάτω παράδειγμα εκχωρεί `CONTROL` από τη βάση δεδομένων **SQL αποθήκη δεδομένων** . `CONTROL`βάση δεδομένων επίπεδο είναι ισοδύναμο της db_owner στον SQL Server.

    ```sql
    GRANT CONTROL ON DATABASE::MySQLDW to newperson;
    ```

4. **Αύξηση κλάση πόρων:** Χρησιμοποιήστε το ακόλουθο ερώτημα για να προσθέσετε ένα χρήστη υψηλότερα ρόλου διαχείρισης φόρτο εργασίας.

    ```sql
    EXEC sp_addrolemember 'largerc', 'newperson'
    ```

5. **Μείωση κλάση πόρων:** Χρησιμοποιήστε το ακόλουθο ερώτημα για να καταργήσετε ένα χρήστη από ένα ρόλο διαχείρισης φόρτο εργασίας.

    ```sql
    EXEC sp_droprolemember 'largerc', 'newperson';
    ```

    > [AZURE.NOTE] Δεν είναι δυνατή η κατάργηση χρήστη από smallrc.

## <a name="queued-query-detection-and-other-dmvs"></a>Ερώτημα σε ουρά ανίχνευσης και άλλες DMVs

Μπορείτε να χρησιμοποιήσετε το `sys.dm_pdw_exec_requests` DMV για να προσδιορίσετε τα ερωτήματα που αναμένουν σε ουρά ταυτόχρονης εκτέλεσης. Αναμονή για μια υποδοχή ταυτόχρονης εκτέλεσης ερωτημάτων θα έχει **ανασταλεί**η κατάσταση.

```sql
SELECT   r.[request_id]              AS Request_ID
        ,r.[status]              AS Request_Status
        ,r.[submit_time]             AS Request_SubmitTime
        ,r.[start_time]              AS Request_StartTime
        ,DATEDIFF(ms,[submit_time],[start_time]) AS Request_InitiateDuration_ms
        ,r.resource_class                         AS Request_resource_class
FROM    sys.dm_pdw_exec_requests r;
```

Ρόλοι διαχείρισης φόρτο εργασίας μπορούν να προβληθούν με `sys.database_principals`.

```sql
SELECT  ro.[name]           AS [db_role_name]
FROM    sys.database_principals ro
WHERE   ro.[type_desc]      = 'DATABASE_ROLE'
AND     ro.[is_fixed_role]  = 0;
```

Το παρακάτω ερώτημα εμφανίζει ρόλου έχει ανατεθεί κάθε χρήστη.

```sql
SELECT   r.name AS role_principal_name
        ,m.name AS member_principal_name
FROM    sys.database_role_members rm
JOIN    sys.database_principals AS r            ON rm.role_principal_id     = r.principal_id
JOIN    sys.database_principals AS m            ON rm.member_principal_id   = m.principal_id
WHERE   r.name IN ('mediumrc','largerc', 'xlargerc');
```

Αποθήκη δεδομένων του SQL περιλαμβάνει τα παρακάτω περιμένετε τύπους:

- **LocalQueriesConcurrencyResourceType**: ερωτήματα που βρίσκονται εκτός του πλαισίου υποδιαίρεση ταυτόχρονης εκτέλεσης. Ερωτήματα DMV και το σύστημα λειτουργεί όπως `SELECT @@VERSION` παραδείγματα τοπικό ερωτημάτων.
- **UserConcurrencyResourceType**: ερωτήματα που βρίσκονται μέσα σε πλαίσιο υποδιαίρεση ταυτόχρονης εκτέλεσης. Τα ερωτήματα σε σχέση με τους πίνακες τελικού χρήστη αντιπροσωπεύουν παραδείγματα που θα χρησιμοποιούν αυτόν τον τύπο πόρου.
- **DmsConcurrencyResourceType**: περιμένει που προκύπτει από λειτουργίες κίνηση δεδομένων.
- **BackupConcurrencyResourceType**: Η αναμονή υποδεικνύει ότι μια βάση δεδομένων δημιουργείται αντίγραφο ασφαλείας. Η μέγιστη τιμή για αυτόν τον τύπο πόρου είναι 1. Εάν έχουν ζητηθεί πολλά αντίγραφα ασφαλείας την ίδια στιγμή, θα ουρά τα άλλα άτομα.

Το `sys.dm_pdw_waits` DMV μπορούν να χρησιμοποιηθούν για να δείτε τους πόρους που είναι σε αναμονή μια αίτηση για.

```sql
SELECT  w.[wait_id]
,       w.[session_id]
,       w.[type]            AS Wait_type
,       w.[object_type]
,       w.[object_name]
,       w.[request_id]
,       w.[request_time]
,       w.[acquire_time]
,       w.[state]
,       w.[priority]
,   SESSION_ID()            AS Current_session
,   s.[status]          AS Session_status
,   s.[login_name]
,   s.[query_count]
,   s.[client_id]
,   s.[sql_spid]
,   r.[command]         AS Request_command
,   r.[label]
,   r.[status]          AS Request_status
,   r.[submit_time]
,   r.[start_time]
,   r.[end_compile_time]
,   r.[end_time]
,   DATEDIFF(ms,r.[submit_time],r.[start_time])     AS Request_queue_time_ms
,   DATEDIFF(ms,r.[start_time],r.[end_compile_time])    AS Request_compile_time_ms
,   DATEDIFF(ms,r.[end_compile_time],r.[end_time])      AS Request_execution_time_ms
,   r.[total_elapsed_time]
FROM    sys.dm_pdw_waits w
JOIN    sys.dm_pdw_exec_sessions s  ON w.[session_id] = s.[session_id]
JOIN    sys.dm_pdw_exec_requests r  ON w.[request_id] = r.[request_id]
WHERE   w.[session_id] <> SESSION_ID();
```

Το `sys.dm_pdw_resource_waits` DMV εμφανίζει μόνο την αναμονή πόρων που καταναλώνεται από ένα συγκεκριμένο ερώτημα. Χρόνος αναμονής πόρων μέτρα μόνο την ώρα σε αναμονή για τους πόρους που παρέχονται, σε αντίθεση με το χρόνο αναμονής σήματος, που είναι ο χρόνος που απαιτείται για το υποκείμενο SQL Server για να προγραμματίσετε το ερώτημα σε της CPU.

```sql
SELECT  [session_id]
,       [type]
,       [object_type]
,       [object_name]
,       [request_id]
,       [request_time]
,       [acquire_time]
,       DATEDIFF(ms,[request_time],[acquire_time])  AS acquire_duration_ms
,       [concurrency_slots_used]                    AS concurrency_slots_reserved
,       [resource_class]
,       [wait_id]                                   AS queue_position
FROM    sys.dm_pdw_resource_waits
WHERE   [session_id] <> SESSION_ID();
```

Το `sys.dm_pdw_wait_stats` DMV μπορούν να χρησιμοποιηθούν για την ανάλυση ιστορικά τάση του αναμονή.

```sql
SELECT  w.[pdw_node_id]
,       w.[wait_name]
,       w.[max_wait_time]
,       w.[request_count]
,       w.[signal_time]
,       w.[completed_count]
,       w.[wait_time]
FROM    sys.dm_pdw_wait_stats w;
```

## <a name="next-steps"></a>Επόμενα βήματα

Για περισσότερες πληροφορίες σχετικά με τη Διαχείριση χρηστών βάσεων δεδομένων και την ασφάλεια, ανατρέξτε στο θέμα [ασφαλούς μια βάση δεδομένων στην αποθήκη δεδομένων του SQL][]. Για περισσότερες πληροφορίες σχετικά με τον τρόπο μεγαλύτερη πόρων κλάσεις να βελτιώσω την ποιότητα του ευρετηρίου ομαδοποιημένων columnstore, ανατρέξτε στο θέμα [Rebuilding ευρετήρια για να βελτιώσω την ποιότητα του τμήματος].

<!--Image references-->

<!--Article references-->
[Ασφάλιση μιας βάσης δεδομένων σε αποθήκη δεδομένων του SQL]: ./sql-data-warehouse-overview-manage-security.md
[Φτιάχνετε ευρετήρια για να βελτιώσω την ποιότητα του τμήματος]: ./sql-data-warehouse-tables-index.md#rebuilding-indexes-to-improve-segment-quality
[Ασφάλιση μιας βάσης δεδομένων σε αποθήκη δεδομένων του SQL]: ./sql-data-warehouse-overview-manage-security.md

<!--MSDN references-->
[Managing Databases and Logins in Azure SQL Database]:https://msdn.microsoft.com/library/azure/ee336235.aspx

<!--Other Web references-->
