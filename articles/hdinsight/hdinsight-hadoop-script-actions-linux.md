<properties
    pageTitle="Δέσμη ενεργειών ανάπτυξης ενέργεια με βάσει Linux HDInsight | Microsoft Azure"
    description="Πώς μπορείτε να προσαρμόσετε συμπλεγμάτων βάσει Linux HDInsight με ενέργεια δέσμη ενεργειών. Ενέργειες δέσμης ενεργειών είναι ένας τρόπος για να προσαρμόσετε συμπλεγμάτων Azure HDInsight Καθορισμός ρυθμίσεων παραμέτρων συμπλέγματος ή εγκαθιστώντας πρόσθετες υπηρεσίες, εργαλεία ή άλλο λογισμικό στο σύμπλεγμα. "
    services="hdinsight"
    documentationCenter=""
    authors="Blackmist"
    manager="jhubbard"
    editor="cgronlun"/>

<tags
    ms.service="hdinsight"
    ms.workload="big-data"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/05/2016"
    ms.author="larryfr"/>

# <a name="script-action-development-with-hdinsight"></a>Δέσμη ενεργειών ανάπτυξης ενέργεια με το HDInsight

Ενέργειες δέσμης ενεργειών είναι ένας τρόπος για να προσαρμόσετε συμπλεγμάτων Azure HDInsight Καθορισμός ρυθμίσεων παραμέτρων συμπλέγματος ή εγκαθιστώντας πρόσθετες υπηρεσίες, εργαλεία ή άλλο λογισμικό στο σύμπλεγμα. Μπορείτε να χρησιμοποιήσετε ενέργειες δέσμης ενεργειών κατά τη δημιουργία συμπλέγματος ή σε ένα σύμπλεγμα εκτελείται.

> [AZURE.NOTE] Οι πληροφορίες σε αυτό το έγγραφο είναι συγκεκριμένη για συμπλεγμάτων βάσει Linux HDInsight. Για πληροφορίες σχετικά με τη χρήση δέσμης ενεργειών με συμπλεγμάτων που βασίζεται στα Windows, ανατρέξτε στο θέμα [Ανάπτυξη ενέργεια δέσμης ενεργειών με το HDInsight (Windows)](hdinsight-hadoop-script-actions.md).

## <a name="what-are-script-actions"></a>Τι είναι οι ενέργειες δέσμης ενεργειών;

Ενέργειες δέσμης ενεργειών είναι πάρτι δέσμες ενεργειών που εκτελεί Azure σε τους κόμβους συμπλέγματος για να κάνετε αλλαγές στη ρύθμιση παραμέτρων ή εγκατάσταση λογισμικού. Μια δέσμη ενεργειών ενέργεια εκτελείται ως ριζική και παρέχει δικαιώματα πλήρους πρόσβασης στα κόμβους συμπλέγματος.

Ενέργειες δέσμης ενεργειών μπορούν να εφαρμοστούν από τις παρακάτω μεθόδους:

| Χρησιμοποιήστε αυτήν την επιλογή για να εφαρμόσετε μια δέσμη ενεργειών... | Κατά τη διάρκεια του συμπλέγματος δημιουργίας... | Σε ένα σύμπλεγμα εκτελείται... |
| ----- |:-----:|:-----:|
| Πύλη του Azure | ✓ | ✓ |
| Azure PowerShell | ✓ | ✓ |
| Azure CLI | &nbsp; | ✓ |
| HDInsight .NET SDK | ✓ | ✓ |
| Azure προτύπου για τη διαχείριση πόρων | ✓ | &nbsp; |

Για περισσότερες πληροφορίες σχετικά με τη χρήση αυτών των μεθόδων για την εφαρμογή δέσμης ενεργειών, ανατρέξτε στο θέμα [Προσαρμογή HDInsight συμπλεγμάτων χρήση δέσμης ενεργειών](hdinsight-hadoop-customize-cluster-linux.md).

## <a name="bestPracticeScripting"></a>Βέλτιστες πρακτικές για την ανάπτυξη δεσμών ενεργειών

Όταν δημιουργείτε μια προσαρμοσμένη δέσμη ενεργειών για ένα σύμπλεγμα HDInsight, υπάρχουν αρκετές βέλτιστες πρακτικές για να λάβετε υπόψη:

- [Η έκδοση Hadoop προορισμού](#bPS1)
- [Η έκδοση του λειτουργικού Συστήματος προορισμού](#bps10)
- [Παροχή σταθερό συνδέσεις για πόρους δέσμης ενεργειών](#bPS2)
- [Χρήση προ-μεταγλωττιστεί πόρων](#bPS4)
- [Βεβαιωθείτε ότι η δέσμη ενεργειών προσαρμογής σύμπλεγμα είναι idempotent](#bPS3)
- [Βεβαιωθείτε ότι υψηλή διαθεσιμότητα της αρχιτεκτονικής συμπλέγματος](#bPS5)
- [Ρύθμιση παραμέτρων τα προσαρμοσμένα στοιχεία για να χρησιμοποιήσετε το χώρο αποθήκευσης αντικειμένων Blob του Azure](#bPS6)
- [Εγγραφή πληροφοριών σε STDOUT και STDERR](#bPS7)
- [Αποθήκευση αρχείων ως ASCII με LF τέλους γραμμής](#bps8)
- [Χρήση λογικής "Επανάληψη" για την ανάκτηση από μεταβατικές σφάλματα](#bps9)

> [AZURE.IMPORTANT] Πρέπει να ολοκληρώσετε ενέργειες δέσμης ενεργειών μέσα σε 60 λεπτά ή θα χρονικού ορίου. Κατά την προμήθεια του κόμβου, η δέσμη ενεργειών είναι εκτελέσατε ταυτόχρονα με άλλα διεργασίες εγκατάσταση και ρύθμιση παραμέτρων. Ανταγωνισμό για τους πόρους, όπως το εύρος ζώνης δικτύου ή χρόνου CPU μπορεί να προκαλέσει τη δέσμη ενεργειών για να διαρκέσει περισσότερο μέχρι να ολοκληρωθεί από ό, τι στο περιβάλλον ανάπτυξής σας.

### <a name="bPS1"></a>Η έκδοση Hadoop προορισμού

Διαφορετικές εκδόσεις του HDInsight έχουν διαφορετικές εκδόσεις των υπηρεσιών Hadoop και στοιχεία που είναι εγκατεστημένα. Εάν η δέσμη ενεργειών αναμένει μια συγκεκριμένη έκδοση από μια υπηρεσία ή ένα στοιχείο, θα πρέπει να μπορείτε να χρησιμοποιήσετε μόνο τη δέσμη ενεργειών με την έκδοση του HDInsight που περιλαμβάνει τα απαιτούμενα στοιχεία. Μπορείτε να βρείτε πληροφορίες σχετικά με το στοιχείο εκδόσεις περιλαμβάνεται με το HDInsight χρησιμοποιώντας το έγγραφο [διαχείρισης εκδόσεων στοιχείου HDInsight](hdinsight-component-versioning.md) .

###<a name="bps10"></a>Την έκδοση του λειτουργικού Συστήματος προορισμού

Βάσει Linux HDInsight είναι με βάση την κατανομή Ubuntu Linux. Διαφορετικές εκδόσεις του HDInsight που βασίζονται σε διαφορετικές εκδόσεις του Ubuntu, οι οποίες ενδέχεται να επηρεάσουν τον τρόπο συμπεριφοράς δέσμη ενεργειών σας. Για παράδειγμα, HDInsight 3.4 και παλαιότερες εκδόσεις βασίζονται στις εκδόσεις Ubuntu που χρησιμοποιούν Upstart. Έκδοση 3.5 βασίζεται σε 16.04 Ubuntu, το οποίο χρησιμοποιεί Systemd. Systemd και Upstart βασίζονται σε διαφορετικές εντολές, ώστε να πρέπει να γράφονται δέσμη ενεργειών σας για να εργαστείτε με τα δύο.

Μια άλλη σημαντική διαφορά μεταξύ HDInsight 3.4 και 3.5 είναι που `JAVA_HOME` υποδεικνύει τώρα Java 8.

Μπορείτε να ελέγξετε την έκδοση του λειτουργικού Συστήματος με τη χρήση `lsb_release`. Τα ακόλουθα τμήματα κώδικα από τη δέσμη ενεργειών εγκατάσταση απόχρωση δείχνει τον τρόπο για να προσδιορίσετε εάν εκτελείται η δέσμη ενεργειών σε Ubuntu 14 ή 16:

    OS_VERSION=$(lsb_release -sr)
    if [[ $OS_VERSION == 14* ]]; then
        echo "OS verion is $OS_VERSION. Using hue-binaries-14-04."
        HUE_TARFILE=hue-binaries-14-04.tgz
    elif [[ $OS_VERSION == 16* ]]; then
        echo "OS verion is $OS_VERSION. Using hue-binaries-16-04."
        HUE_TARFILE=hue-binaries-16-04.tgz
    fi
    ...
    if [[ $OS_VERSION == 16* ]]; then
        echo "Using systemd configuration"
        systemctl daemon-reload
        systemctl stop webwasb.service    
        systemctl start webwasb.service
    else
        echo "Using upstart configuration"
        initctl reload-configuration
        stop webwasb
        start webwasb
    fi
    ...
    if [[ $OS_VERSION == 14* ]]; then
        export JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64
    elif [[ $OS_VERSION == 16* ]]; then
        export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
    fi

Μπορείτε να βρείτε την πλήρη δέσμη ενεργειών που περιέχει αυτά τα τμήματα κώδικα στο https://hdiconfigactions.blob.core.windows.net/linuxhueconfigactionv02/install-hue-uber-v02.sh.

Για την έκδοση του Ubuntu που χρησιμοποιείται από το HDInsight, ανατρέξτε στο έγγραφο [HDInsight έκδοση του στοιχείου](hdinsight-component-versioning.md) .

Για να κατανοήσετε τις διαφορές μεταξύ Systemd και Upstart, ανατρέξτε στο θέμα [Systemd για τους χρήστες του Upstart](https://wiki.ubuntu.com/SystemdForUpstartUsers).

### <a name="bPS2"></a>Παροχή σταθερό συνδέσεις για πόρους δέσμης ενεργειών

Που θα πρέπει να βεβαιωθείτε ότι τις δέσμες ενεργειών και τους πόρους που χρησιμοποιούνται από τη δέσμη ενεργειών παραμένουν διαθέσιμα σε όλη τη διάρκεια ζωής του συμπλέγματος και ότι δεν αλλάζουν τις εκδόσεις αυτών των αρχείων στη διάρκεια. Αυτοί οι πόροι απαιτούνται εάν νέα κόμβους προστίθενται στο σύμπλεγμα κατά τη διάρκεια της κλίμακας λειτουργίες.

Η βέλτιστη πρακτική είναι να κάνετε λήψη και αρχειοθέτηση όλων των στοιχείων σε ένα λογαριασμό Azure χώρο αποθήκευσης στη συνδρομή σας.

> [AZURE.IMPORTANT] Ο λογαριασμός χώρου αποθήκευσης που χρησιμοποιείται πρέπει να είναι τον προεπιλεγμένο λογαριασμό χώρου αποθήκευσης για το σύμπλεγμα ή ένα κοντέινερ δημόσια, μόνο για ανάγνωση σε οποιονδήποτε άλλο λογαριασμό χώρου αποθήκευσης.

Για παράδειγμα, τα δείγματα που παρέχονται από τη Microsoft είναι αποθηκευμένα στο λογαριασμό [https://hdiconfigactions.blob.core.windows.net/](https://hdiconfigactions.blob.core.windows.net/) χώρου αποθήκευσης, που είναι ένα κοντέινερ δημόσια, μόνο για ανάγνωση διατηρούνται από την ομάδα HDInsight.

### <a name="bPS4"></a>Χρήση προ-μεταγλωττιστεί πόρων

Για να μειώσετε το χρόνο που χρειάζεται για να εκτελέσετε τη δέσμη ενεργειών, αποφύγετε λειτουργίες που μεταγλωττίσετε τους πόρους από πηγαίου κώδικα. Αντί για αυτό, προ-μεταγλωττίσετε τους πόρους και να αποθηκεύσετε την έκδοση δυαδικό στο χώρο αποθήκευσης αντικειμένων Blob του Azure, έτσι ώστε το γρήγορα να κάνετε λήψη στο σύμπλεγμα από τη δέσμη ενεργειών σας.

### <a name="bPS3"></a>Βεβαιωθείτε ότι η δέσμη ενεργειών προσαρμογής σύμπλεγμα είναι idempotent

Οι δέσμες ενεργειών πρέπει να είναι σχεδιασμένες για να idempotent με την έννοια ότι εάν η δέσμη ενεργειών είναι εκτελέσατε πολλές φορές, αυτό θα πρέπει να βεβαιωθείτε ότι το σύμπλεγμα επιστρέφεται στην ίδια κατάσταση κάθε φορά που το είναι εκτελέσατε.

Για παράδειγμα, εάν μια προσαρμοσμένη δέσμη ενεργειών εγκαθιστά μια εφαρμογή στο /usr/local/bin στην πρώτη εκτέλεση, στη συνέχεια, σε κάθε επόμενη εκτέλεση της δέσμης ενεργειών πρέπει να ελέγξετε εάν η εφαρμογή υπάρχει ήδη στη θέση /usr/local/bin πριν προχωρήσετε σε άλλα βήματα στη δέσμη ενεργειών.

### <a name="bPS5"></a>Βεβαιωθείτε ότι υψηλή διαθεσιμότητα της αρχιτεκτονικής συμπλέγματος

Βασίζεται στο Linux συμπλεγμάτων HDInsight παρέχει δύο κεφαλών κόμβους που είναι ενεργά μέσα στο σύμπλεγμα και οι ενέργειες είναι η δέσμη ενεργειών εκτελέστηκε για τους δύο κόμβους. Εάν τα στοιχεία που εγκαθιστάτε αναμενόταν μόνο μία κεφαλή κόμβο, πρέπει να σχεδιάσετε μια δέσμη ενεργειών που θα εγκατασταθεί το στοιχείο σε ένα από τα δύο κεφαλών κόμβους του συμπλέγματος.

> [AZURE.IMPORTANT] Προεπιλεγμένες υπηρεσίες εγκαταστήσει ως τμήμα της HDInsight είναι σχεδιασμένα ώστε να ανακατευθύνει μεταξύ τους δύο κόμβους κεφαλή εφόσον χρειάζεται, ωστόσο αυτή η λειτουργία δεν έχει επεκταθεί σε προσαρμοσμένα στοιχεία εγκαθίσταται μέσω ctions δέσμης ενεργειών. Εάν χρειάζεστε τα στοιχεία που εγκαθίστανται μέσω μιας δέσμης ενεργειών ενέργεια να είναι ιδιαίτερα διαθέσιμη, πρέπει να υλοποιήσετε το δικό σας μηχανισμός ανακατεύθυνσης που χρησιμοποιεί τους δύο κόμβους διαθέσιμη κεφαλίδας.

### <a name="bPS6"></a>Ρύθμιση παραμέτρων τα προσαρμοσμένα στοιχεία για να χρησιμοποιήσετε το χώρο αποθήκευσης αντικειμένων Blob του Azure

Στοιχεία που εγκαθιστάτε στο σύμπλεγμα ενδέχεται να έχει μια προεπιλεγμένη ρύθμιση παραμέτρων που χρησιμοποιεί χώρο αποθήκευσης στο σύστημα αρχείων κατανεμημένο Hadoop (HDFS). HDInsight χρησιμοποιεί χώρο αποθήκευσης αντικειμένων Blob Azure (WASB) ως το προεπιλεγμένο αποθήκευσης. Αυτό παρέχει ένα σύστημα συμβατό αρχείο HDFS που παραμένει δεδομένων, ακόμα και αν το σύμπλεγμα έχει διαγραφεί. Θα πρέπει να μπορείτε να ρυθμίσετε τις παραμέτρους των στοιχείων που μπορείτε να εγκαταστήσετε για να χρησιμοποιήσετε WASB αντί για HDFS.

Για παράδειγμα, τα εξής αντιγράφει το αρχείο giraph-examples.jar από το τοπικό σύστημα αρχείων σε WASB:

    hadoop fs -copyFromLocal /usr/hdp/current/giraph/giraph-examples.jar /example/jars/

### <a name="bPS7"></a>Εγγραφή πληροφοριών σε STDOUT και STDERR

Πληροφορίες που εγγράφηκαν να STDOUT και STDERR κατά την εκτέλεση της δέσμης ενεργειών είναι συνδεδεμένος και μπορούν να προβληθούν στο web Ambari περιβάλλοντος εργασίας Χρήστη.

> [AZURE.NOTE] Ambari θα είναι διαθέσιμη μόνο εάν το σύμπλεγμα δημιουργήθηκε με επιτυχία. Εάν χρησιμοποιείτε μια ενέργεια δέσμης ενεργειών κατά τη δημιουργία συμπλέγματος και δημιουργία αποτυγχάνει, στην ενότητα Αντιμετώπιση προβλημάτων [Προσαρμογή HDInsight συμπλεγμάτων με χρήση δέσμης ενεργειών](hdinsight-hadoop-customize-cluster-linux.md#troubleshooting) για άλλες μέθοδοι πρόσβασης στις πληροφορίες που καταγράφονται.

Περισσότερες βοηθητικά προγράμματα και πακέτα εγκατάστασης θα ήδη εγγραφή πληροφοριών σε STDOUT και STDERR, ωστόσο, μπορεί να θέλετε να προσθέσετε επιπλέον καταγραφής. Για να στείλετε κείμενο σε χρήση STDOUT `echo`. Για παράδειγμα:

        echo "Getting ready to install Foo"

Από προεπιλογή, `echo` θα αποσταλεί από τη συμβολοσειρά STDOUT. Για να κατευθύνουν στο STDERR, προσθέστε `>&2` πριν από την `echo`. Για παράδειγμα:

        >&2 echo "An error occurred installing Foo"

Αυτό ανακατευθύνει τις πληροφορίες που αποστέλλονται σε STDOUT (1, η οποία είναι προεπιλεγμένη επομένως δεν παρατίθεται εδώ,) σε STDERR (2). Για περισσότερες πληροφορίες σχετικά με την ανακατεύθυνση εισόδου/ΕΞΌΔΟΥ, ανατρέξτε στο θέμα [http://www.tldp.org/LDP/abs/html/io-redirection.html](http://www.tldp.org/LDP/abs/html/io-redirection.html).

Για περισσότερες πληροφορίες σχετικά με την προβολή πληροφοριών καταγράφονται από ενέργειες δέσμης ενεργειών, ανατρέξτε στο θέμα [Προσαρμογή HDInsight συμπλεγμάτων με χρήση δέσμης ενεργειών](hdinsight-hadoop-customize-cluster-linux.md#troubleshooting)

###<a name="bps8"></a>Αποθήκευση αρχείων ως ASCII με LF τέλους γραμμής

Οι δέσμες ενεργειών πάρτι πρέπει να αποθηκεύονται ως μορφή ASCII, με γραμμές τερματίζονται από LF. Εάν αρχεία αποθηκεύονται ως UTF-8, η οποία μπορεί να περιλαμβάνουν ένα σημάδι σειρά Byte στην αρχή του αρχείου ή τέλους γραμμής της CRLF, το οποίο είναι κοινό για συντάκτες των Windows, η δέσμη ενεργειών θα αποτύχει με σφάλματα παρόμοια με τα εξής:

    $'\r': command not found
    line 1: #!/usr/bin/env: No such file or directory

###<a name="bps9"></a>Χρήση λογικής "Επανάληψη" για την ανάκτηση από μεταβατικές σφάλματα

Κατά τη λήψη αρχείων, την εγκατάσταση πακέτα χρησιμοποιώντας κατάλληλη λαμβάνουν ή άλλες ενέργειες που μεταδίδουν δεδομένα μέσω του internet, η ενέργεια ενδέχεται να αποτύχει λόγω μεταβατικές κοινωνικής δικτύωσης σφαλμάτων. Για παράδειγμα, το απομακρυσμένο πόρο επικοινωνείτε με ενδέχεται να είναι σε διαδικασία ανακατεύθυνση σε έναν κόμβο δημιουργίας αντιγράφων ασφαλείας.

Για να κάνετε τη δέσμη ενεργειών σας είναι ανθεκτικά μεταβατικές σφάλματα, μπορείτε να υλοποιήσετε λογικής "Επανάληψη". Ακολουθεί ένα παράδειγμα μιας συνάρτησης που θα εκτελέσετε οποιαδήποτε εντολή που εισήχθησαν σε αυτήν και (Εάν η εντολή αποτύχει,) Επαναλάβετε έως και τρεις φορές. Αυτό θα περιμένετε δύο δευτερόλεπτα μεταξύ κάθε "Επανάληψη".

    #retry
    MAXATTEMPTS=3

    retry() {
        local -r CMD="$@"
        local -i ATTMEPTNUM=1
        local -i RETRYINTERVAL=2

        until $CMD
        do
            if (( ATTMEPTNUM == MAXATTEMPTS ))
            then
                    echo "Attempt $ATTMEPTNUM failed. no more attempts left."
                    return 1
            else
                    echo "Attempt $ATTMEPTNUM failed! Retrying in $RETRYINTERVAL seconds..."
                    sleep $(( RETRYINTERVAL ))
                    ATTMEPTNUM=$ATTMEPTNUM+1
            fi
        done
    }

Ακολουθούν παραδείγματα χρήσης αυτής της συνάρτησης.

    retry ls -ltr foo

    retry wget -O ./tmpfile.sh https://hdiconfigactions.blob.core.windows.net/linuxhueconfigactionv02/install-hue-uber-v02.sh

## <a name="helpermethods"></a>Βοηθητική εφαρμογή του μεθόδους για προσαρμοσμένων δεσμών ενεργειών

δέσμη ενεργειών ενέργεια Βοήθειας μέθοδοι είναι βοηθητικά προγράμματα που μπορείτε να χρησιμοποιήσετε κατά την εγγραφή των προσαρμοσμένων δεσμών ενεργειών. Αυτά τα ορίζονται σε [https://hdiconfigactions.blob.core.windows.net/linuxconfigactionmodulev01/HDInsightUtilities-v01.sh](https://hdiconfigactions.blob.core.windows.net/linuxconfigactionmodulev01/HDInsightUtilities-v01.sh)και μπορούν να συμπεριληφθούν στις δέσμες ενεργειών σας χρησιμοποιώντας τα εξής:

    # Import the helper method module.
    wget -O /tmp/HDInsightUtilities-v01.sh -q https://hdiconfigactions.blob.core.windows.net/linuxconfigactionmodulev01/HDInsightUtilities-v01.sh && source /tmp/HDInsightUtilities-v01.sh && rm -f /tmp/HDInsightUtilities-v01.sh

Έτσι, τα παρακάτω βοηθητικά προγράμματα διαθέσιμη για χρήση στη δέσμη ενεργειών:

| Χρήση βοηθητικού προγράμματος | Περιγραφή |
| ------------ | ----------- |
| `download_file SOURCEURL DESTFILEPATH [OVERWRITE]` | Γίνεται λήψη ενός αρχείου από τη διεύθυνση URL της προέλευσης για την καθορισμένη διαδρομή αρχείου. Από προεπιλογή, αυτό δεν θα αντικαταστήσει ένα υπάρχον αρχείο. |
| `untar_file TARFILE DESTDIR` | Εξάγει ένα αρχείο πίσσα (χρησιμοποιώντας `-xf`,) στον κατάλογο προορισμού. |
| `test_is_headnode` | Εάν εκτελέσατε σε έναν κόμβο κεφαλής συμπλέγματος, επιστρέφει την τιμή 1; Διαφορετικά, 0. |
| `test_is_datanode` | Εάν ο τρέχων κόμβος είναι έναν κόμβο δεδομένων (εργασίας), επιστρέφει ένα 1. Διαφορετικά, 0. |
| `test_is_first_datanode` | Εάν ο τρέχων κόμβος είναι ο πρώτος κόμβος δεδομένων (εργαζόμενου) (που ονομάζεται workernode0), η συνάρτηση επιστρέφει 1; Διαφορετικά, 0. |
| `get_headnodes` | Επιστρέφει το πλήρως προσδιορισμένο όνομα τομέα από το headnodes στο σύμπλεγμα. Τα ονόματα είναι οριοθετημένο με κόμματα. Μια κενή συμβολοσειρά επιστρέφεται σφάλμα. |
| `get_primary_headnode` | Λαμβάνει το πλήρως προσδιορισμένο όνομα τομέα από το κύριο headnode. Μια κενή συμβολοσειρά επιστρέφεται σφάλμα. |
| `get_secondary_headnode` | Λαμβάνει το πλήρως προσδιορισμένο όνομα τομέα από το δευτερεύοντα headnode. Μια κενή συμβολοσειρά επιστρέφεται σφάλμα. |
| `get_primary_headnode_number` | Λαμβάνει το αριθμητικό επίθημα το πρωτεύον headnode. Μια κενή συμβολοσειρά επιστρέφεται σφάλμα. |
| `get_secondary_headnode_number` | Λαμβάνει το αριθμητικό επίθεμα από το δευτερεύοντα headnode. Μια κενή συμβολοσειρά επιστρέφεται σφάλμα. |

## <a name="commonusage"></a>Κοινή χρήση μοτίβων

Αυτή η ενότητα παρέχει οδηγίες σχετικά με την εφαρμογή ορισμένα από τα κοινά μοτίβα χρήση που ενδέχεται να αντιμετωπίσετε κατά την εγγραφή των δικών σας προσαρμοσμένων δεσμών ενεργειών.

### <a name="passing-parameters-to-a-script"></a>Μεταβίβαση παραμέτρων σε μια δέσμη ενεργειών

Σε ορισμένες περιπτώσεις, δέσμη ενεργειών σας μπορεί να απαιτεί παραμέτρους. Για παράδειγμα, ίσως χρειαστεί τον κωδικό πρόσβασης διαχειριστή για το σύμπλεγμα για να ανακτήσετε πληροφορίες από το REST API Ambari.

Παράμετροι που του μεταβιβάστηκε η δέσμη ενεργειών είναι γνωστό ως _θέσης παραμέτρων_και έχουν εκχωρηθεί σε `$1` για την πρώτη παράμετρο, `$2` για το δεύτερο, και η, ώστε να. `$0`περιέχει το όνομα της δέσμης ενεργειών ίδια.

Τιμές που του μεταβιβάστηκε η δέσμη ενεργειών ως παράμετροι θα πρέπει να περικλείεται σε μονά εισαγωγικά ('), έτσι ώστε η τιμή που μεταβιβάστηκε εκλαμβάνεται ως μιας καθορισμένης τιμής και ειδική επεξεργασία δεν έχει δοθεί περιλαμβάνονται χαρακτήρες, όπως '!'.

### <a name="setting-environment-variables"></a>Ρύθμιση μεταβλητών περιβάλλοντος

Ρύθμιση μια μεταβλητή περιβάλλοντος πραγματοποιείται από τα εξής:

    VARIABLENAME=value

Όπου ΌΝΟΜΑ_ΜΕΤΑΒΛΗΤΉΣ είναι το όνομα της μεταβλητής. Για να αποκτήσετε πρόσβαση στη μεταβλητή μετά από αυτό, χρησιμοποιήστε `$VARIABLENAME`. Για παράδειγμα, για να αντιστοιχίσετε μια τιμή που παρέχεται από μια παράμετρος θέσης ως μια μεταβλητή περιβάλλοντος με το όνομα κωδικού ΠΡΌΣΒΑΣΗΣ, θα χρησιμοποιούσατε τα εξής:

    PASSWORD=$1

Στη συνέχεια, μπορούν να χρησιμοποιήσουν οι επόμενες πρόσβαση στις πληροφορίες `$PASSWORD`.

Σύνολο μέσα στη δέσμη ενεργειών μεταβλητών περιβάλλοντος που υπάρχουν μόνο εντός του πεδίου εφαρμογής της δέσμης ενεργειών. Σε ορισμένες περιπτώσεις, ίσως χρειαστεί να προσθέσετε ευρεία μεταβλητές συστήματος που θα εξακολουθούν να εμφανίζονται αφού ολοκληρωθεί η δέσμη ενεργειών. Συνήθως αυτό είναι έτσι ώστε οι χρήστες που συνδέονται στο σύμπλεγμα μέσω SSH να χρησιμοποιήσετε τα στοιχεία που εγκαθίστανται με τη δέσμη ενεργειών σας. Μπορείτε να ολοκληρώσετε αυτή, προσθέτοντας τη μεταβλητή περιβάλλοντος για να `/etc/environment`. Για παράδειγμα, προσθέτει τα ακόλουθα __HADOOP\_για ΔΙΆΣΚΕΨΗ\_DIR__:

    echo "HADOOP_CONF_DIR=/etc/hadoop/conf" | sudo tee -a /etc/environment

### <a name="access-to-locations-where-the-custom-scripts-are-stored"></a>Πρόσβαση σε τοποθεσίες όπου αποθηκεύονται τα προσαρμοσμένων δεσμών ενεργειών

Δέσμες ενεργειών που χρησιμοποιείται για να προσαρμόσετε ένα σύμπλεγμα πρέπει είτε να είναι σε τον προεπιλεγμένο λογαριασμό χώρου αποθήκευσης για το σύμπλεγμα ή, εάν σε έναν άλλο λογαριασμό χώρου αποθήκευσης, σε δημόσια κοντέινερ μόνο για ανάγνωση. Εάν η δέσμη ενεργειών αποκτά πρόσβαση σε πόρους που βρίσκονται σε κάποιο άλλο σημείο αυτά πρέπει επίσης να βρίσκονται σε μια δημόσια προσβάσιμα (τουλάχιστον δημόσια μόνο για ανάγνωση). Για παράδειγμα ίσως θέλετε να κάνετε λήψη ενός αρχείου στο σύμπλεγμα χρησιμοποιώντας `download_file`.

Αποθήκευση του αρχείου σε προσβάσιμα Azure αποθήκευσης λογαριασμού από το σύμπλεγμα (όπως τον προεπιλεγμένο λογαριασμό χώρου αποθήκευσης), παρέχει γρήγορη πρόσβαση, όπως ο χώρος αποθήκευσης αυτό είναι εντός του Azure δικτύου.

### <a name="checking-the-operating-system-version"></a>Έλεγχος έκδοση του λειτουργικού συστήματος

Διαφορετικές εκδόσεις του HDInsight που βασίζονται σε συγκεκριμένες εκδόσεις του Ubuntu. Μπορεί να υπάρχουν διαφορές μεταξύ των εκδόσεων λειτουργικό σύστημα που θα πρέπει να ελέγχετε στη δέσμη ενεργειών σας. Για παράδειγμα, ίσως χρειαστεί να εγκαταστήσετε ένα δυαδικό αρχείο που είναι συνδεδεμένη με την έκδοση του Ubuntu.

Για να ελέγξετε την έκδοση του λειτουργικού Συστήματος, χρησιμοποιήστε `lsb_release`. Για παράδειγμα, τα ακόλουθα δείχνει τον τρόπο αναφοράς αρχείου διαφορετικό πίσσα ανάλογα με την έκδοση του λειτουργικού Συστήματος:

    OS_VERSION=$(lsb_release -sr)
    if [[ $OS_VERSION == 14* ]]; then
        echo "OS verion is $OS_VERSION. Using hue-binaries-14-04."
        HUE_TARFILE=hue-binaries-14-04.tgz
    elif [[ $OS_VERSION == 16* ]]; then
        echo "OS verion is $OS_VERSION. Using hue-binaries-16-04."
        HUE_TARFILE=hue-binaries-16-04.tgz
    fi

## <a name="deployScript"></a>Λίστα ελέγχου για την ανάπτυξη μιας ενέργειας δέσμης ενεργειών

Ακολουθούν τα βήματα θα σας εκτελέσατε κατά την προετοιμασία για την ανάπτυξη αυτές τις δέσμες ενεργειών:

- Τοποθετήστε τα αρχεία που περιέχουν τις προσαρμοσμένες δέσμες ενεργειών σε μια θέση στην οποία είναι προσβάσιμη από τους κόμβους συμπλέγματος κατά την ανάπτυξη. Αυτό μπορεί να είναι οποιαδήποτε από τις προεπιλεγμένες ή επιπλέον χώρο αποθήκευσης λογαριασμούς που καθορίζεται κατά τη διάρκεια του συμπλέγματος ανάπτυξης ή οποιοδήποτε άλλο κοντέινερ δυνατότητα δημόσιας πρόσβασης χώρου αποθήκευσης.

- Προσθέστε ελέγχους σε δέσμες ενεργειών για να βεβαιωθείτε ότι εκτέλεση impotently, έτσι ώστε η δέσμη ενεργειών μπορεί να εκτελεστεί πολλές φορές στον ίδιο κόμβο.

- Χρησιμοποιήστε ένα προσωρινό αρχείο /tmp καταλόγου για να διατηρήσετε τα αρχεία λήψης που χρησιμοποιούνται από τις δέσμες ενεργειών και, στη συνέχεια, εκκαθάριση τους αφού έχουν εκτελεστεί δεσμών ενεργειών.

- Σε περίπτωση που άλλαξαν οι ρυθμίσεις επιπέδου λειτουργικό σύστημα ή τα αρχεία ρύθμισης παραμέτρων υπηρεσίας Hadoop, που μπορεί να θέλετε να επανεκκινήσετε υπηρεσίες HDInsight, ώστε να τους να σηκώστε οποιεσδήποτε ρυθμίσεις επιπέδου λειτουργικό σύστημα, όπως το σύνολο στο τις δέσμες ενεργειών μεταβλητών περιβάλλοντος.

## <a name="runScriptAction"></a>Πώς μπορείτε να εκτελέσετε μια ενέργεια δέσμης ενεργειών

Μπορείτε να χρησιμοποιήσετε ενέργειες δέσμης ενεργειών για να προσαρμόσετε HDInsight συμπλεγμάτων χρησιμοποιώντας την πύλη Azure, Azure PowerShell, πρότυπα διαχείρισης πόρων Azure (ARM) ή το .NET SDK HDInsight. Για οδηγίες, ανατρέξτε στο θέμα [πώς μπορείτε να χρησιμοποιήσετε την ενέργεια δέσμης ενεργειών](hdinsight-hadoop-customize-cluster-linux.md).

## <a name="sampleScripts"></a>Δείγματα προσαρμοσμένη δέσμη ενεργειών

Η Microsoft παρέχει δείγματα δεσμών ενεργειών για την εγκατάσταση στοιχείων σε ένα σύμπλεγμα HDInsight. Τα δείγματα δεσμών ενεργειών και οδηγίες σχετικά με τον τρόπο χρήσης τους είναι διαθέσιμες στη τις παρακάτω συνδέσεις:

- [Εγκατάσταση και χρήση απόχρωση στον HDInsight συμπλεγμάτων](hdinsight-hadoop-hue-linux.md)
- [Εγκατάσταση και χρήση R στον HDInsight Hadoop συμπλεγμάτων](hdinsight-hadoop-r-scripts-linux.md)
- [Εγκατάσταση και χρήση Solr στον HDInsight συμπλεγμάτων](hdinsight-hadoop-solr-install-linux.md)
- [Εγκατάσταση και χρήση Giraph στον HDInsight συμπλεγμάτων](hdinsight-hadoop-giraph-install-linux.md)  

> [AZURE.NOTE] Τα έγγραφα που είναι συνδεδεμένα παραπάνω αφορούν ειδικά συμπλεγμάτων που βασίζεται στο Linux HDInsight. Για μια δέσμες ενεργειών που λειτουργούν με το HDInsight που βασίζεται στα Windows, ανατρέξτε στο θέμα [Ανάπτυξη ενέργεια δέσμης ενεργειών με το HDInsight (Windows)](hdinsight-hadoop-script-actions.md) ή χρησιμοποιήστε τις συνδέσεις που είναι διαθέσιμες στο επάνω μέρος κάθε άρθρο.

##<a name="troubleshooting"></a>Αντιμετώπιση προβλημάτων

Παρακάτω παρουσιάζονται σφάλματα που μπορεί να αντιμετωπίσετε κατά τη χρήση έχετε αναπτύξει δεσμών ενεργειών:

__Error__: `$'\r': command not found`. Μερικές φορές ακολουθείται από `syntax error: unexpected end of file`.

_Αιτία_: αυτό το σφάλμα παρουσιάζεται όταν οι γραμμές σε μια δέσμη ενεργειών τελειώνει με CRLF. Συστήματα UNIX αναμενόμενο μόνο LF ως κατάληξη γραμμής.

Αυτό το πρόβλημα παρουσιάζεται πιο συχνά όταν η δέσμη ενεργειών έχει συνταχθεί σε ένα περιβάλλον των Windows, όπως CRLF είναι μια κοινή γραμμή τελειώνει για πολλά προγράμματα επεξεργασίας κειμένου στα Windows.

_Ανάλυση_: Εάν είναι μια επιλογή στο πρόγραμμα επεξεργασίας κειμένου, επιλέξτε μορφή Unix ή LF για κατάληξη γραμμής. Μπορείτε επίσης να χρησιμοποιήσετε τις παρακάτω εντολές σε ένα σύστημα Unix για να αλλάξετε το CRLF σε μια LF:

> [AZURE.NOTE] Οι ακόλουθες εντολές είναι περίπου ισοδύναμη σε που θα πρέπει να αλλάζουν τέλους γραμμής CRLF ώστε να LF. Επιλέξτε ένα με βάση τα βοηθητικά προγράμματα που είναι διαθέσιμες στο σύστημά σας.

| Εντολή | Σημειώσεις |
| ------- | ----- |
| `unix2dos -b INFILE` | Το αρχικό αρχείο θα δημιουργηθεί αντίγραφο ασφαλείας με ένα. Επέκταση BAK |
| `tr -d '\r' < INFILE > OUTFILE` | OUTFILE θα περιέχει μια έκδοση με μόνο LF καταλήξεων |
| `perl -pi -e 's/\r\n/\n/g' INFILE` | Αυτό θα, τροποποιήστε το αρχείο απευθείας χωρίς τη δημιουργία νέου αρχείου |
| ```sed 's/$'"/`echo \\\r`/" INFILE > OUTFILE``` | OUTFILE θα περιέχει μια έκδοση με μόνο καταλήξεις LF.

__Error__: `line 1: #!/usr/bin/env: No such file or directory`.

_Αιτία_: αυτό το σφάλμα παρουσιάζεται όταν η δέσμη ενεργειών έχει αποθηκευτεί ως UTF-8 με μια σειρά σήμανση Byte (Προδιαγραφή).

_Ανάλυση_: Αποθηκεύστε το αρχείο ως ASCII ή ως UTF-8 χωρίς μια Προδιαγραφή. Μπορείτε επίσης να χρησιμοποιήσετε την παρακάτω εντολή σε ένα σύστημα Linux ή Unix για να δημιουργήσετε ένα νέο αρχείο χωρίς την Προδιαγραφή:

    awk 'NR==1{sub(/^\xef\xbb\xbf/,"")}{print}' INFILE > OUTFILE

Για την παραπάνω εντολή, αντικαταστήστε __INFILE__ με το αρχείο που περιέχει την Προδιαγραφή. __OUTFILE__ πρέπει να είναι ένα νέο όνομα αρχείου, που θα περιέχει τη δέσμη ενεργειών χωρίς την Προδιαγραφή.

## <a name="seeAlso"></a>Επόμενα βήματα

* Μάθετε πώς μπορείτε να [προσαρμόσετε HDInsight συμπλεγμάτων με χρήση δέσμης ενεργειών](hdinsight-hadoop-customize-cluster-linux.md)

* Χρήση της [αναφοράς HDInsight .NET SDK](https://msdn.microsoft.com/library/mt271028.aspx) για να μάθετε περισσότερα σχετικά με τη δημιουργία εφαρμογών .NET που διαχειρίζονται HDInsight

* Χρησιμοποιήστε το [HDInsight REST API](https://msdn.microsoft.com/library/azure/mt622197.aspx) για να μάθετε πώς να χρησιμοποιείτε το ΥΠΌΛΟΙΠΟ για εκτέλεση ενεργειών διαχείρισης σε συμπλεγμάτων HDInsight.
