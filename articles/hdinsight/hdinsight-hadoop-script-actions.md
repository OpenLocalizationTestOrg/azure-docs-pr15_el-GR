<properties
    pageTitle="Δέσμη ενεργειών ανάπτυξης ενέργεια με το HDInsight | Microsoft Azure"
    description="Μάθετε πώς μπορείτε να προσαρμόσετε συμπλεγμάτων Hadoop με ενέργεια δέσμη ενεργειών. Ενέργεια δέσμη ενεργειών μπορεί να χρησιμοποιηθεί για να εγκαταστήσετε το πρόσθετο λογισμικό που εκτελείται σε ένα σύμπλεγμα Hadoop ή για να αλλάξετε τη ρύθμιση παραμέτρων για τις εφαρμογές που έχουν εγκατασταθεί σε ένα σύμπλεγμα."
    services="hdinsight"
    documentationCenter=""
    tags="azure-portal"
    authors="mumian"
    manager="jhubbard"
    editor="cgronlun"/>

<tags
    ms.service="hdinsight"
    ms.workload="big-data"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/19/2016"
    ms.author="jgao"/>

# <a name="develop-script-action-scripts-for-hdinsight-windows-based-clusters"></a>Ανάπτυξη δεσμών ενεργειών δέσμης ενεργειών για συμπλεγμάτων που βασίζεται σε HDInsight Windows

Μάθετε πώς να συντάξετε δέσμες ενεργειών δέσμης ενεργειών για HDInsight. Για πληροφορίες σχετικά με τη χρήση δέσμης ενεργειών δέσμες ενεργειών, ανατρέξτε στο θέμα [Προσαρμογή HDInsight συμπλεγμάτων με χρήση δέσμης ενεργειών](hdinsight-hadoop-customize-cluster.md). Για το ίδιο το άρθρο έχει συνταχθεί για συμπλεγμάτων βάσει Linux HDInsight, ανατρέξτε στο θέμα [Ανάπτυξη δέσμης ενεργειών δέσμες ενεργειών για HDInsight](hdinsight-hadoop-script-actions-linux.md).

> [AZURE.NOTE] Οι πληροφορίες σε αυτό το έγγραφο είναι συγκεκριμένη για συμπλεγμάτων HDInsight που βασίζεται στα Windows. Για πληροφορίες σχετικά με τη χρήση δέσμης ενεργειών με συμπλεγμάτων που βασίζεται στα Windows, ανατρέξτε στο θέμα [Ανάπτυξη ενέργεια δέσμης ενεργειών με HDInsight (Linux)](hdinsight-hadoop-script-actions-linux.md).


Ενέργεια δέσμη ενεργειών μπορεί να χρησιμοποιηθεί για να εγκαταστήσετε το πρόσθετο λογισμικό που εκτελείται σε ένα σύμπλεγμα Hadoop ή για να αλλάξετε τη ρύθμιση παραμέτρων για τις εφαρμογές που έχουν εγκατασταθεί σε ένα σύμπλεγμα. Ενέργειες δέσμης ενεργειών οι δέσμες ενεργειών που εκτελούνται σε τους κόμβους συμπλέγματος όταν συμπλεγμάτων HDInsight αναπτύσσονται και εκτελούνται μόλις κόμβους του συμπλέγματος ολοκλήρωση ρύθμισης παραμέτρων HDInsight. Μια δέσμη ενεργειών ενέργεια εκτελείται στην περιοχή δικαιώματα λογαριασμό διαχειριστή συστήματος και παρέχει πλήρη δικαιώματα πρόσβασης στους κόμβους συμπλέγματος. Κάθε σύμπλεγμα μπορεί να παρέχεται με μια λίστα ενεργειών δέσμης ενεργειών που θα εκτελεστεί με τη σειρά με την οποία καθορίζονται.

> [AZURE.NOTE] Εάν αντιμετωπίζετε το ακόλουθο μήνυμα σφάλματος:
>
>     System.Management.Automation.CommandNotFoundException; ExceptionMessage : The term 'Save-HDIFile' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
> Αυτό συμβαίνει επειδή δεν μπορείτε να συμπεριλάβετε τις μεθόδους Βοήθειας.  Ανατρέξτε στο θέμα [Βοήθειας μεθόδων για προσαρμοσμένων δεσμών ενεργειών](hdinsight-hadoop-script-actions.md#helper-methods-for-custom-scripts).

## <a name="sample-scripts"></a>Δείγμα δεσμών ενεργειών

Για τη δημιουργία συμπλεγμάτων HDInsight σε λειτουργικό σύστημα Windows, η ενέργεια δέσμης ενεργειών είναι δέσμη ενεργειών του Azure PowerShell. Ακολουθεί ένα δείγμα δέσμης ενεργειών για ρύθμιση παραμέτρων των αρχείων ρύθμισης παραμέτρων τοποθεσίας:

[AZURE.INCLUDE [upgrade-powershell](../../includes/hdinsight-use-latest-powershell.md)]

    param (
        [parameter(Mandatory)][string] $ConfigFileName,
        [parameter(Mandatory)][string] $Name,
        [parameter(Mandatory)][string] $Value,
        [parameter()][string] $Description
    )

    if (!$Description) {
        $Description = ""
    }

    $hdiConfigFiles = @{
        "hive-site.xml" = "$env:HIVE_HOME\conf\hive-site.xml";
        "core-site.xml" = "$env:HADOOP_HOME\etc\hadoop\core-site.xml";
        "hdfs-site.xml" = "$env:HADOOP_HOME\etc\hadoop\hdfs-site.xml";
        "mapred-site.xml" = "$env:HADOOP_HOME\etc\hadoop\mapred-site.xml";
        "yarn-site.xml" = "$env:HADOOP_HOME\etc\hadoop\yarn-site.xml"
    }

    if (!($hdiConfigFiles[$ConfigFileName])) {
        Write-HDILog "Unable to configure $ConfigFileName because it is not part of the HDI configuration files."
        return
    }

    [xml]$configFile = Get-Content $hdiConfigFiles[$ConfigFileName]

    $existingproperty = $configFile.configuration.property | where {$_.Name -eq $Name}

    if ($existingproperty) {
        $existingproperty.Value = $Value
        $existingproperty.Description = $Description
    } else {
        $newproperty = @($configFile.configuration.property)[0].Clone()
        $newproperty.Name = $Name
        $newproperty.Value = $Value
        $newproperty.Description = $Description
        $configFile.configuration.AppendChild($newproperty)
    }

    $configFile.Save($hdiConfigFiles[$ConfigFileName])

    Write-HDILog "$configFileName has been configured."

Η δέσμη ενεργειών σας μεταφέρει τέσσερις παραμέτρους, το όνομα του αρχείου ρύθμισης παραμέτρων, την ιδιότητα που θέλετε να τροποποιήσετε, η τιμή που θέλετε να ορίσετε, και μια περιγραφή. Για παράδειγμα:

    hive-site.xml hive.metastore.client.socket.timeout 90

Αυτές οι παράμετροι θα οριστεί η τιμή hive.metastore.client.socket.timeout 90 στο αρχείο hive site.xml.  Η προεπιλεγμένη τιμή είναι 60 δευτερόλεπτα.

Αυτήν τη δέσμη ενεργειών δείγμα μπορείτε επίσης να βρείτε στο [https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1](https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1).

HDInsight παρέχει διάφορες δέσμες ενεργειών για να εγκαταστήσετε πρόσθετα στοιχεία σε HDInsight συμπλεγμάτων:

Όνομα | Δέσμη ενεργειών
----- | -----
**Εγκατάσταση τους** | https://hdiconfigactions.blob.Core.Windows.NET/sparkconfigactionv03/spark-Installer-v03.ps1. Ανατρέξτε στο θέμα [εγκατάσταση και χρήση αυξήσετε στην συμπλεγμάτων HDInsight][hdinsight-install-spark].
**Εγκατάσταση R** | https://hdiconfigactions.blob.Core.Windows.NET/rconfigactionv02/r-Installer-v02.ps1. Ανατρέξτε στο θέμα [εγκατάσταση και χρήση R σε συμπλεγμάτων HDInsight][hdinsight-r-scripts].
**Εγκατάσταση Solr** | https://hdiconfigactions.blob.Core.Windows.NET/solrconfigactionv01/solr-Installer-v01.ps1. Ανατρέξτε στο θέμα [εγκατάσταση και χρήση συμπλεγμάτων Solr σε HDInsight](hdinsight-hadoop-solr-install.md).
- **Εγκατάσταση Giraph** | https://hdiconfigactions.blob.Core.Windows.NET/giraphconfigactionv01/giraph-Installer-v01.ps1. Ανατρέξτε στο θέμα [εγκατάσταση και χρήση συμπλεγμάτων Giraph σε HDInsight](hdinsight-hadoop-giraph-install.md).

Ενέργεια δέσμη ενεργειών μπορούν να αναπτυχθούν από την πύλη Azure, Azure PowerShell ή χρησιμοποιώντας το .NET SDK HDInsight.  Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Προσαρμογή HDInsight συμπλεγμάτων με χρήση δέσμης ενεργειών][hdinsight-cluster-customize].

> [AZURE.NOTE] Τα δείγματα δεσμών ενεργειών λειτουργούν μόνο με HDInsight σύμπλεγμα έκδοση 3.1 ή νεότερη έκδοση. Για περισσότερες πληροφορίες σχετικά με εκδόσεις σύμπλεγμα HDInsight, ανατρέξτε στο θέμα [εκδόσεις σύμπλεγμα HDInsight](hdinsight-component-versioning.md).





## <a name="helper-methods-for-custom-scripts"></a>Βοηθητική εφαρμογή του μεθόδους για προσαρμοσμένων δεσμών ενεργειών

Δέσμη ενεργειών ενέργεια Βοήθειας μέθοδοι είναι βοηθητικά προγράμματα που μπορείτε να χρησιμοποιήσετε κατά την εγγραφή των προσαρμοσμένων δεσμών ενεργειών. Αυτά τα ορίζονται σε [https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1](https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1)και μπορούν να συμπεριληφθούν στις δέσμες ενεργειών σας χρησιμοποιώντας τα εξής:

    # Download config action module from a well-known directory.
    $CONFIGACTIONURI = "https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1";
    $CONFIGACTIONMODULE = "C:\apps\dist\HDInsightUtilities.psm1";
    $webclient = New-Object System.Net.WebClient;
    $webclient.DownloadFile($CONFIGACTIONURI, $CONFIGACTIONMODULE);

    # (TIP) Import config action helper method module to make writing config action easy.
    if (Test-Path ($CONFIGACTIONMODULE))
    {
        Import-Module $CONFIGACTIONMODULE;
    }
    else
    {
        Write-Output "Failed to load HDInsightUtilities module, exiting ...";
        exit;
    }

Εδώ θα βρείτε τις μεθόδους Βοήθειας που παρέχονται από αυτήν τη δέσμη ενεργειών:

Μέθοδος Βοήθειας | Περιγραφή
-------------- | -----------
**Αποθήκευση HDIFile** | Κάντε λήψη του αρχείου από το καθορισμένο ενιαίο αναγνωριστικό πόρου (URI) σε μια θέση στον τοπικό δίσκο που σχετίζεται με τον κόμβο Εικονική Azure στους οποίους έχουν ανατεθεί στο σύμπλεγμα.
**Αναπτύξτε το στοιχείο HDIZippedFile** | Αποσυμπίεση του αρχείου σε μορφή zip.
**Κλήση HDICmdScript** | Εκτελέστε μια δέσμη ενεργειών από cmd.exe.
**HDILog εγγραφής** | Γράψτε εξόδου από την προσαρμοσμένη δέσμη ενεργειών που χρησιμοποιούνται για μια ενέργεια δέσμης ενεργειών.
**Get-υπηρεσίες** | Λάβετε μια λίστα των υπηρεσιών που εκτελούνται στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών.
**Get-υπηρεσίας** | Το όνομα της συγκεκριμένης υπηρεσίας ως είσοδο, λάβετε λεπτομερείς πληροφορίες για μια συγκεκριμένη υπηρεσία (όνομα υπηρεσίας, διεργασίας Αναγνωριστικό, κατάσταση, κ.λπ.) στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών.
**Get-HDIServices** | Λάβετε μια λίστα των υπηρεσιών HDInsight που εκτελείται στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών.
**Get-HDIService** | Με το συγκεκριμένο όνομα υπηρεσίας HDInsight ως είσοδο, λάβετε λεπτομερείς πληροφορίες για μια συγκεκριμένη υπηρεσία (όνομα υπηρεσίας, διεργασίας Αναγνωριστικό, κατάσταση, κ.λπ.) στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών.
**Get-ServicesRunning** | Λάβετε μια λίστα με τις υπηρεσίες που εκτελούνται στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών.
**Get-ServiceRunning** | Ελέγξτε εάν μια συγκεκριμένη υπηρεσία (με βάση το όνομα) εκτελείται στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών.
**Get-HDIServicesRunning** | Λάβετε μια λίστα των υπηρεσιών HDInsight που εκτελείται στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών.
**Get-HDIServiceRunning** | Ελέγξτε εάν μια συγκεκριμένη υπηρεσία HDInsight (με βάση το όνομα) εκτελείται στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών.
**Get-HDIHadoopVersion** | Αποκτήστε την έκδοση του Hadoop στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών.
**Δοκιμή IsHDIHeadNode** | Ελέγξτε αν στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών είναι μια κεφαλή κόμβο.
**Δοκιμή IsActiveHDIHeadNode** | Ελέγξτε αν στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών είναι ένα ενεργό κεφαλής κόμβο.
**Δοκιμή IsHDIDataNode** | Ελέγξτε αν στον υπολογιστή όπου εκτελείται η δέσμη ενεργειών είναι ένας κόμβος δεδομένων.
**Επεξεργασία HDIConfigFile** | Επεξεργαστείτε τα αρχεία config hive-site.xml, site.xml πυρήνα, hdfs site.xml, mapred site.xml ή νήματα site.xml.


## <a name="best-practices-for-script-development"></a>Βέλτιστες πρακτικές για την ανάπτυξη δεσμών ενεργειών

Όταν δημιουργείτε μια προσαρμοσμένη δέσμη ενεργειών για ένα σύμπλεγμα HDInsight, υπάρχουν αρκετές βέλτιστες πρακτικές για να λάβετε υπόψη:

- Έλεγχος για την έκδοση Hadoop

    Μόνο HDInsight έκδοση 3.1 (Hadoop 2.4) και επάνω από την υποστήριξη με χρήση δέσμης ενεργειών για την εγκατάσταση προσαρμοσμένα στοιχεία σε ένα σύμπλεγμα. Στην προσαρμοσμένη δέσμη ενεργειών, που πρέπει να χρησιμοποιήσετε τη μέθοδο **HDIHadoopVersion λήψη** Βοήθειας για να ελέγξετε την έκδοση Hadoop πριν να συνεχίσετε με την εκτέλεση άλλων εργασιών στη δέσμη ενεργειών.


- Παροχή σταθερό συνδέσεις για πόρους δέσμης ενεργειών

    Οι χρήστες θα πρέπει να βεβαιωθείτε ότι όλες οι δέσμες ενεργειών και άλλα αντικείμενα που χρησιμοποιούνται στο την προσαρμογή του ένα σύμπλεγμα παραμένουν διαθέσιμα σε όλη τη διάρκεια ζωής του συμπλέγματος και ότι δεν αλλάζουν τις εκδόσεις αυτών των αρχείων στη διάρκεια. Αυτοί οι πόροι απαιτούνται εάν απαιτείται η εκ νέου δημιουργία ειδώλου από τους κόμβους του συμπλέγματος. Η βέλτιστη πρακτική είναι να κάνετε λήψη και αρχειοθέτηση όλων των στοιχείων σε ένα λογαριασμό του χώρου αποθήκευσης που ελέγχει το χρήστη. Αυτό μπορεί να τον προεπιλεγμένο λογαριασμό χώρου αποθήκευσης ή οποιονδήποτε από τους επιπλέον λογαριασμούς χώρου αποθήκευσης που καθορίζεται τη στιγμή της ανάπτυξης για ένα προσαρμοσμένο σύμπλεγμα.
    Στο τους και R προσαρμόσει σύμπλεγμα δείγματα που παρέχονται στην τεκμηρίωση του, για παράδειγμα, έχουμε κάνει ένα τοπικό αντίγραφο των πόρων σε αυτόν το λογαριασμό χώρου αποθήκευσης: https://hdiconfigactions.blob.core.windows.net/.


- Βεβαιωθείτε ότι η δέσμη ενεργειών προσαρμογής σύμπλεγμα είναι idempotent

    Πρέπει να αναμένετε ότι οι κόμβοι από ένα σύμπλεγμα HDInsight θα εκ νέου τους κατά τη διάρκεια ζωής σύμπλεγμα. Η δέσμη ενεργειών προσαρμογής σύμπλεγμα εκτελείται κάθε φορά που ένα σύμπλεγμα είναι εκ νέου τους. Αυτή η δέσμη ενεργειών πρέπει να έχουν σχεδιαστεί να είναι idempotent με την έννοια ότι κατά την εκ νέου δημιουργία ειδώλου, η δέσμη ενεργειών θα πρέπει να βεβαιωθείτε ότι το σύμπλεγμα επιστρέφεται στην ίδια προσαρμοσμένη κατάσταση που ήταν στο μόνο αφού εκτελέσατε τη δέσμη ενεργειών για πρώτη φορά που δημιουργήθηκε αρχικά το σύμπλεγμα. Για παράδειγμα, εάν μια προσαρμοσμένη δέσμη ενεργειών εγκαταστήσει μια εφαρμογή στο D:\AppLocation στην πρώτη εκτέλεση, στη συνέχεια, σε κάθε επόμενη εκτέλεση, κατά την εκ νέου δημιουργία ειδώλου, η δέσμη ενεργειών πρέπει να ελέγξετε εάν η εφαρμογή υπάρχει στη θέση D:\AppLocation πριν προχωρήσετε σε άλλα βήματα στη δέσμη ενεργειών.


- Εγκατάσταση προσαρμοσμένα στοιχεία στη θέση βέλτιστη

    Όταν εκ νέου τους κόμβους συμπλέγματος, η μονάδα δίσκου πόρων C:\ και D:\ μονάδα δίσκου συστήματος μπορεί να είναι εκ νέου διαμορφωμένο, με αποτέλεσμα την απώλεια δεδομένων και τις εφαρμογές που είχε εγκατασταθεί σε αυτές τις μονάδες δίσκου. Επίσης, αυτό θα μπορούσε να συμβεί εάν έναν κόμβο Azure εικονική μηχανή (Εικονική) που είναι μέρος του συμπλέγματος μεταβαίνει προς τα κάτω και αντικαθίσταται από ένα νέο κόμβο. Μπορείτε να εγκαταστήσετε τα στοιχεία στη μονάδα δίσκου D:\ ή στη θέση C:\apps στο σύμπλεγμα. Όλες τις άλλες θέσεις στη μονάδα δίσκου C:\ είναι δεσμευμένο. Καθορίστε τη θέση όπου είναι εφαρμογές ή σε βιβλιοθήκες να έχει εγκατασταθεί στη δέσμη ενεργειών προσαρμογής σύμπλεγμα.


- Βεβαιωθείτε ότι υψηλή διαθεσιμότητα της αρχιτεκτονικής συμπλέγματος

    Το HDInsight διαθέτει μια αρχιτεκτονική ενεργό παθητικές για υψηλή διαθεσιμότητα, στις οποίες ένα κεφαλής κόμβος είναι σε ενεργή κατάσταση (όπου εκτελούνται οι υπηρεσίες HDInsight) και άλλου κεφαλής κόμβου είναι σε κατάσταση αναμονής (σε ποια HDInsight υπηρεσίες δεν εκτελούνται). Οι κόμβοι εναλλαγή ενεργό και παθητικές λειτουργίες εάν έχουν διακοπεί υπηρεσίες HDInsight. Εάν μια δέσμη ενεργειών ενέργεια χρησιμοποιείται για την εγκατάσταση υπηρεσιών σε δύο κεφαλών κόμβους για υψηλή διαθεσιμότητα, σημειώστε ότι ο μηχανισμός ανακατεύθυνσης HDInsight δεν θα μπορείτε να ανακατευθύνει αυτόματα αυτές τις υπηρεσίες εγκατασταθεί από το χρήστη. Επομένως, χρήστη-εγκατεστημένες υπηρεσίες σε κόμβους κεφαλής HDInsight που αναμένεται να είναι ιδιαίτερα διαθέσιμη πρέπει να έχουν τις δικές τους μηχανισμός ανακατεύθυνσης εάν σε λειτουργία ενεργό παθητικές ή είναι σε λειτουργία ενεργούς.

    Μια εντολή HDInsight δέσμης ενεργειών εκτελείται σε δύο κεφαλών κόμβους όταν ο ρόλος κεφαλή κόμβου καθορίζεται ως μια τιμή στην παράμετρο *ClusterRoleCollection* . Επομένως, όταν σχεδιάζετε μια προσαρμοσμένη δέσμη ενεργειών, βεβαιωθείτε ότι τη δέσμη ενεργειών σας είναι υπόψη αυτό το πρόγραμμα εγκατάστασης. Δεν θα πρέπει να αντιμετωπίσετε προβλήματα όπου τις ίδιες υπηρεσίες είναι εγκατεστημένες και αποτελέσματα και στις δύο κεφαλών κόμβο και τους στο τέλος κάθε μεταξύ τους. Επίσης, να θυμάστε ότι δεδομένων θα χαθούν κατά την εκ νέου δημιουργία ειδώλου, ώστε το λογισμικό που είναι εγκατεστημένο μέσω δέσμης ενεργειών πρέπει να είναι ανθεκτικά στις τέτοια συμβάντα. Εφαρμογές θα πρέπει να είναι έχει σχεδιαστεί για λειτουργία με ιδιαίτερα διαθέσιμα δεδομένα που είναι κατανέμεται πολλοί κόμβοι. Λάβετε υπόψη ότι όσο 1/5 από τους κόμβους σε ένα σύμπλεγμα να απεικόνιση εκ νέου την ίδια στιγμή.


- Ρύθμιση παραμέτρων τα προσαρμοσμένα στοιχεία για να χρησιμοποιήσετε το χώρο αποθήκευσης αντικειμένων Blob του Azure

    Τα προσαρμοσμένα στοιχεία που εγκαθιστάτε στον κόμβους συμπλέγματος μπορεί να έχει μια προεπιλεγμένη ρύθμιση παραμέτρων για να χρησιμοποιήσετε το χώρο αποθήκευσης στο σύστημα αρχείων κατανεμημένο Hadoop (HDFS). Θα πρέπει να αλλάξετε τη ρύθμιση παραμέτρων για να χρησιμοποιήσετε το χώρο αποθήκευσης αντικειμένων Blob του Azure αντί για αυτό. Σε ένα σύμπλεγμα εκ νέου εικόνα, το σύστημα αρχείων HDFS λαμβάνει μορφοποιημένο και θα χάσετε τα δεδομένα που είναι αποθηκευμένο εκεί. Χρήση του χώρου αποθήκευσης αντικειμένων Blob του Azure εξασφαλίζει αντί για αυτό που θα διατηρηθούν τα δεδομένα σας.

## <a name="common-usage-patterns"></a>Κοινή χρήση μοτίβων

Αυτή η ενότητα παρέχει οδηγίες σχετικά με την εφαρμογή ορισμένα από τα κοινά μοτίβα χρήση που ενδέχεται να αντιμετωπίσετε κατά την εγγραφή των δικών σας προσαρμοσμένων δεσμών ενεργειών.

### <a name="configure-environment-variables"></a>Ρύθμιση παραμέτρων μεταβλητές περιβάλλοντος

Συχνά στην ανάπτυξη δέσμης ενεργειών, θα πιστεύετε ότι χρειάζεται να ορίσετε μεταβλητές περιβάλλοντος. Για παράδειγμα, μια πιο πιθανό σενάριο είναι όταν κάνετε λήψη έναν δυαδικό αριθμό από μια εξωτερική τοποθεσία, εγκαταστήστε την σε σύμπλεγμα, και προσθέστε τη θέση από όπου έχει εγκατασταθεί για τη μεταβλητή περιβάλλοντος 'PATH'. Το παρακάτω τμήμα κώδικα δείχνει πώς μπορείτε να ορίσετε μεταβλητές περιβάλλοντος στην προσαρμοσμένη δέσμη ενεργειών.

    Write-HDILog "Starting environment variable setting at: $(Get-Date)";
    [Environment]::SetEnvironmentVariable('MDS_RUNNER_CUSTOM_CLUSTER', 'true', 'Machine');

Αυτή η πρόταση ορίζει τη μεταβλητή περιβάλλοντος **MDS_RUNNER_CUSTOM_CLUSTER** στην τιμή 'true' και επίσης ορίζει το εύρος της αυτή η μεταβλητή να ολόκληρο τον υπολογιστή. Ορισμένες φορές, είναι σημαντικό ότι έχουν οριστεί μεταβλητές περιβάλλοντος στο κατάλληλο εύρος – υπολογιστής ή χρήστης. Αναφέρεται [εδώ] [ 1] για περισσότερες πληροφορίες σχετικά με τη ρύθμιση μεταβλητές περιβάλλοντος.

### <a name="access-to-locations-where-the-custom-scripts-are-stored"></a>Πρόσβαση σε τοποθεσίες όπου αποθηκεύονται τα προσαρμοσμένων δεσμών ενεργειών

Δέσμες ενεργειών που χρησιμοποιείται για να προσαρμόσετε ένα σύμπλεγμα πρέπει είτε είναι σε τον προεπιλεγμένο λογαριασμό χώρου αποθήκευσης για το σύμπλεγμα ή σε δημόσια κοντέινερ μόνο για ανάγνωση σε οποιονδήποτε άλλο λογαριασμό χώρου αποθήκευσης. Εάν τη δέσμη ενεργειών σας αποκτά πρόσβαση σε πόρους που βρίσκονται σε κάποιο άλλο σημείο αυτά πρέπει να είναι σε ένα κοινό προσβάσιμα (τουλάχιστον δημόσια μόνο για ανάγνωση). Για παράδειγμα ενδέχεται να θέλετε να πρόσβαση σε ένα αρχείο και να το αποθηκεύσετε χρησιμοποιώντας την εντολή SaveFile HDI.

    Save-HDIFile -SrcUri 'https://somestorageaccount.blob.core.windows.net/somecontainer/some-file.jar' -DestFile 'C:\apps\dist\hadoop-2.4.0.2.1.9.0-2196\share\hadoop\mapreduce\some-file.jar'

Σε αυτό το παράδειγμα, πρέπει να βεβαιωθείτε ότι το κοντέινερ 'somecontainer' στο λογαριασμό χώρου αποθήκευσης 'somestorageaccount' είναι προσβάσιμο για το κοινό. Διαφορετικά, η δέσμη ενεργειών θα δημιουργήσει μια εξαίρεση ''δεν Εύρεση και θα αποτύχει.

### <a name="pass-parameters-to-the-add-azurermhdinsightscriptaction-cmdlet"></a>Μεταβιβάζουν τις παραμέτρους για το πρόσθετο AzureRmHDInsightScriptAction cmdlet

Για να μεταβιβάσετε πολλαπλές παραμέτρους το cmdlet Προσθήκη AzureRmHDInsightScriptAction, πρέπει να μορφοποιήσετε την τιμή συμβολοσειράς ώστε να περιέχει όλες τις παραμέτρους για τη δέσμη ενεργειών. Για παράδειγμα:

    "-CertifcateUri wasbs:///abc.pfx -CertificatePassword 123456 -InstallFolderName MyFolder"

ή

    $parameters = '-Parameters "{0};{1};{2}"' -f $CertificateName,$certUriWithSasToken,$CertificatePassword


### <a name="throw-exception-for-failed-cluster-deployment"></a>Δημιουργήστε εξαίρεση για ανάπτυξη αποτυχίας συμπλέγματος

Εάν θέλετε να λάβετε ειδοποιείστε με ακρίβεια το γεγονός ότι συμπλέγματος προσαρμογής δεν ολοκληρώθηκε με επιτυχία με τον αναμενόμενο τρόπο, είναι σημαντικό να εμφανίσουν εξαίρεση και αποτύχει η δημιουργία συμπλέγματος. Για παράδειγμα, μπορεί να θέλετε να επεξεργαστείτε ένα αρχείο, εάν υπάρχει και χειρισμού σφαλμάτων πεζών και κεφαλαίων γραμμάτων όπου δεν υπάρχει το αρχείο. Αυτό θα εξασφαλίσει ότι η δέσμη ενεργειών ομαλά έξοδο και την κατάσταση του συμπλέγματος είναι γνωστό σωστά. Το παρακάτω τμήμα κώδικα σάς παρέχει ένα παράδειγμα του τρόπου να επιτύχετε το εξής:

    If(Test-Path($SomePath)) {
        #Process file in some way
    } else {
        # File does not exist; handle error case
        # Print error message
    exit
    }

Σε αυτό το τμήμα κώδικα, εάν το αρχείο δεν υπάρχει, θα οδηγήσει σε μια κατάσταση όπου η δέσμη ενεργειών στην πραγματικότητα έξοδο ομαλά μετά από την εκτύπωση το μήνυμα σφάλματος και το σύμπλεγμα φτάσει σε κατάσταση λειτουργίας, υπό την προϋπόθεση ότι το ολοκληρώθηκε "με επιτυχία" διεργασία προσαρμογής σύμπλεγμα. Εάν θέλετε να ειδοποιείστε με ακρίβεια το γεγονός ότι συμπλέγματος προσαρμογής ουσιαστικά δεν ολοκληρώθηκε με επιτυχία με τον αναμενόμενο τρόπο λόγω ένα αρχείο που λείπει, είναι πιο κατάλληλο να εμφανίσουν εξαίρεση και αποτύχει το βήμα προσαρμογής σύμπλεγμα. Για να επιτύχετε το εξής που πρέπει να χρησιμοποιήστε το παρακάτω δείγμα τμήμα κώδικα.

    If(Test-Path($SomePath)) {
        #Process file in some way
    } else {
        # File does not exist; handle error case
        # Print error message
    throw
    }


## <a name="checklist-for-deploying-a-script-action"></a>Λίστα ελέγχου για την ανάπτυξη μιας ενέργειας δέσμης ενεργειών
Ακολουθούν τα βήματα θα σας εκτελέσατε κατά την προετοιμασία για την ανάπτυξη αυτές τις δέσμες ενεργειών:

1. Τοποθετήστε τα αρχεία που περιέχουν τις προσαρμοσμένες δέσμες ενεργειών σε μια θέση στην οποία είναι προσβάσιμη από τους κόμβους συμπλέγματος κατά την ανάπτυξη. Αυτό μπορεί να είναι οποιαδήποτε από τις προεπιλεγμένες ή επιπλέον χώρο αποθήκευσης λογαριασμούς που καθορίζεται κατά τη διάρκεια του συμπλέγματος ανάπτυξης ή οποιοδήποτε άλλο κοντέινερ δυνατότητα δημόσιας πρόσβασης χώρου αποθήκευσης.
2. Προσθέστε ελέγχους σε δέσμες ενεργειών για να βεβαιωθείτε ότι εκτελούν idempotently, έτσι ώστε η δέσμη ενεργειών μπορεί να εκτελεστεί πολλές φορές στον ίδιο κόμβο.
3. Χρησιμοποιήστε το cmdlet του Azure PowerShell **Εξόδου εγγραφής** για να εκτυπώσετε STDOUT, καθώς και STDERR. Μην χρησιμοποιείτε **Host εγγραφής**.
4. Χρήση ενός φακέλου του προσωρινού αρχείου, όπως $env: TEMP, για να διατηρήσετε το αρχείο που έχετε λάβει χρησιμοποιούνται από τις δέσμες ενεργειών και, στη συνέχεια, εκκαθάριση τους αφού έχουν εκτελεστεί δεσμών ενεργειών.
5. Εγκαταστήστε το προσαρμοσμένο λογισμικό μόνο στο D:\ ή C:\apps. Άλλες θέσεις στη μονάδα δίσκου C: δεν πρέπει να χρησιμοποιούνται ως έχουν δεσμευμένη. Σημειώστε ότι κατά την εγκατάσταση των αρχείων στη μονάδα δίσκου C: εκτός του φακέλου C:\apps ενδέχεται να οδηγήσει σε αποτυχία εγκατάστασης κατά τη διάρκεια της εκ νέου τις εικόνες του κόμβου.
6. Σε περίπτωση που άλλαξαν οι ρυθμίσεις επιπέδου λειτουργικό σύστημα ή τα αρχεία ρύθμισης παραμέτρων υπηρεσίας Hadoop, που μπορεί να θέλετε να επανεκκινήσετε υπηρεσίες HDInsight, ώστε να τους να σηκώστε οποιεσδήποτε ρυθμίσεις επιπέδου λειτουργικό σύστημα, όπως το σύνολο στο τις δέσμες ενεργειών μεταβλητών περιβάλλοντος.

## <a name="debug-custom-scripts"></a>Εντοπισμός σφαλμάτων προσαρμοσμένων δεσμών ενεργειών

Αποθηκεύονται τα αρχεία καταγραφής σφαλμάτων δέσμης ενεργειών, μαζί με άλλες εξόδου, σε τον προεπιλεγμένο λογαριασμό χώρου αποθήκευσης που έχετε καθορίσει για το σύμπλεγμα κατά τη δημιουργία του. Τα αρχεία καταγραφής είναι αποθηκευμένα σε έναν πίνακα με το όνομα *u < \cluster-name-fragment >< \time-stamp > setuplog*. Αυτά είναι συγκεντρωτική αρχεία καταγραφής που έχουν εγγραφές από όλους τους κόμβους (κεφαλής κόμβο και κόμβους εργαζόμενου) στην οποία εκτελείται η δέσμη ενεργειών του συμπλέγματος.
Ένας εύκολος τρόπος για να ελέγξετε τα αρχεία καταγραφής είναι να χρησιμοποιήσετε εργαλεία HDInsight για το Visual Studio. Για την εγκατάσταση των εργαλείων, ανατρέξτε στο θέμα [Γρήγορα αποτελέσματα με το Visual Studio Hadoop εργαλεία για HDInsight](hdinsight-hadoop-visual-studio-tools-get-started.md#install-hdinsight-tools-for-visual-studio)

**Για να ελέγξετε το αρχείο καταγραφής χρήση του Visual Studio**

1. Ανοίξτε το Visual Studio.
2. Κάντε κλικ στην επιλογή **Προβολή**και, στη συνέχεια, κάντε κλικ στην επιλογή **Εξερεύνηση Server**.
3. Κάντε δεξί κλικ "Azure", κάντε κλικ στην επιλογή σύνδεση με το **Microsoft Azure συνδρομές**και, στη συνέχεια, εισαγάγετε τα διαπιστευτήριά σας.
4. Ανάπτυξη **χώρου αποθήκευσης**, αναπτύξτε το στοιχείο ο λογαριασμός Azure χώρου αποθήκευσης που χρησιμοποιείται ως το προεπιλεγμένο σύστημα αρχείων, αναπτύξτε την επιλογή **πίνακες**και, στη συνέχεια, κάντε διπλό κλικ στο όνομα του πίνακα.


Μπορείτε να επίσης απομακρυσμένη σε κόμβους συμπλέγματος για να δείτε το τόσο STDOUT και STDERR για προσαρμοσμένων δεσμών ενεργειών. Τα αρχεία καταγραφής σε κάθε κόμβο συγκεκριμένες μόνο σε αυτόν τον κόμβο και έχετε συνδεθεί στο **C:\HDInsightLogs\DeploymentAgent.log**. Αυτά τα αρχεία καταγραφής καταγράφει όλες τις εκροές από την προσαρμοσμένη δέσμη ενεργειών. Ένα παράδειγμα απόκομμα καταγραφής για μια ενέργεια δέσμης ενεργειών τους μοιάζει κάπως έτσι:

    Microsoft.Hadoop.Deployment.Engine.CustomPowershellScriptCommand; Details : BEGIN: Invoking powershell script https://configactions.blob.core.windows.net/sparkconfigactions/spark-installer.ps1.;
    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;
    ...

    Starting Spark installation at: 09/04/2014 21:46:02 Done with Spark installation at: 09/04/2014 21:46:38;

    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;
    ...

    Microsoft.Hadoop.Deployment.Engine.CustomPowershellScriptCommand;
    Details : END: Invoking powershell script https://configactions.blob.core.windows.net/sparkconfigactions/spark-installer.ps1.;
    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;


Σε αυτό το αρχείο καταγραφής, είναι σαφές ότι η ενέργεια δέσμη ενεργειών τους έχει εκτελεστεί σε η Εικονική με το όνομα HEADNODE0 και ότι δεν υπάρχει εξαιρέσεις δημιουργήθηκαν κατά την εκτέλεση.

Σε περίπτωση που προκύψει μια αποτυχία εκτέλεσης, το αποτέλεσμα που περιγράφει αυτό θα περιέχονται επίσης σε αυτό το αρχείο καταγραφής. Οι πληροφορίες που παρέχονται σε αυτά τα αρχεία καταγραφής πρέπει να είναι χρήσιμο στις τον εντοπισμό σφαλμάτων δέσμης ενεργειών που μπορεί να προκύψουν.


## <a name="see-also"></a>Δείτε επίσης

- [Προσαρμογή συμπλεγμάτων HDInsight με χρήση δέσμης ενεργειών][hdinsight-cluster-customize]
- [Εγκατάσταση και χρήση τους σε HDInsight συμπλεγμάτων][hdinsight-install-spark]
- [Εγκατάσταση και χρήση R στον HDInsight συμπλεγμάτων][hdinsight-r-scripts]
- [Εγκατάσταση και χρήση συμπλεγμάτων Solr σε HDInsight](hdinsight-hadoop-solr-install.md).
- [Εγκατάσταση και χρήση συμπλεγμάτων Giraph σε HDInsight](hdinsight-hadoop-giraph-install.md).

[hdinsight-provision]: hdinsight-provision-clusters.md
[hdinsight-cluster-customize]: hdinsight-hadoop-customize-cluster.md
[hdinsight-install-spark]: hdinsight-hadoop-spark-install.md
[hdinsight-r-scripts]: hdinsight-hadoop-r-scripts.md
[powershell-install-configure]: install-configure-powershell.md

<!--Reference links in article-->
[1]: https://msdn.microsoft.com/library/96xafkes(v=vs.110).aspx
