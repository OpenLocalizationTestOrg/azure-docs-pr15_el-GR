<properties
   pageTitle="Χρήση Python στοιχεία σε μια τοπολογία καταιγίδας στην HDinsight | Microsoft Azure"
   description="Μάθετε πώς μπορείτε να χρησιμοποιήσετε στοιχεία Python από με καταιγίδας Apache στην Azure HDInsight. Θα μάθετε πώς μπορείτε να χρησιμοποιήσετε στοιχεία Python από δύο μια Java με βάση και Clojure βάσει καταιγίδας τοπολογίας."
   services="hdinsight"
   documentationCenter=""
   authors="Blackmist"
   manager="jhubbard"
   editor="cgronlun"/>

<tags
   ms.service="hdinsight"
   ms.devlang="python"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="big-data"
   ms.date="09/27/2016"
   ms.author="larryfr"/>

#<a name="develop-apache-storm-topologies-using-python-on-hdinsight"></a>Ανάπτυξη τοπολογίες καταιγίδας Apache χρήση Python σε HDInsight

Καταιγίδας Apache υποστηρίζει πολλές γλώσσες, ακόμα και επιτρέποντάς σας να συνδυάσετε στοιχεία από πολλές γλώσσες σε μία τοπολογίας. Σε αυτό το έγγραφο, θα μάθετε πώς να χρησιμοποιείτε στοιχεία Python στο σας Java και βάσει Clojure καταιγίδας τοπολογίες στην HDInsight.

##<a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

* Python 2.7 ή νεότερη έκδοση

* Java JDK 1.7 ή νεότερη έκδοση

* [Leiningen](http://leiningen.org/)

##<a name="storm-multi-language-support"></a>Υποστήριξη σε πολλές γλώσσες καταιγίδας

Καταιγίδας έχει σχεδιαστεί για λειτουργία με στοιχεία που έχουν δημιουργηθεί με τη χρήση οποιαδήποτε γλώσσα προγραμματισμού, ωστόσο, αυτή η ενέργεια απαιτεί ότι τα στοιχεία να κατανοήσετε τον τρόπο εργασίας με τον [ορισμό Thrift για καταιγίδας](https://github.com/apache/storm/blob/master/storm-core/src/storm.thrift). Για Python, μια λειτουργική μονάδα παρέχεται ως τμήμα του έργου καταιγίδας Apache που σας επιτρέπει να εύκολα περιβάλλοντος εργασίας με καταιγίδας. Μπορείτε να βρείτε αυτήν τη λειτουργική μονάδα στο [https://github.com/apache/storm/blob/master/storm-multilang/python/src/main/resources/resources/storm.py](https://github.com/apache/storm/blob/master/storm-multilang/python/src/main/resources/resources/storm.py).

Εφόσον καταιγίδας Apache είναι μια διαδικασία Java που εκτελείται σε η εικονική μηχανή Java (JVM), τα στοιχεία γραμμένο σε άλλες γλώσσες εκτελούνται ως υποδιεργασιών. Τα bit καταιγίδας εκτελείται στο το JVM επικοινωνεί με αυτές τις υποδιεργασιών χρησιμοποιώντας JSON τα μηνύματα που αποστέλλονται μέσω stdin/stdout. Μπορείτε να βρείτε περισσότερες λεπτομέρειες σχετικά με επικοινωνίας μεταξύ των στοιχείων στην τεκμηρίωση του [πρωτοκόλλου πολλούς lang](https://storm.apache.org/documentation/Multilang-protocol.html) .

###<a name="the-storm-module"></a>Η λειτουργική μονάδα καταιγίδας

Η λειτουργική μονάδα καταιγίδας (https://github.com/apache/storm/blob/master/storm-multilang/python/src/main/resources/resources/storm.py), παρέχει τα bit που απαιτούνται για να δημιουργήσετε στοιχεία Python που λειτουργούν με το καταιγίδας.

Αυτή η δυνατότητα παρέχει ενέργειες όπως `storm.emit` να εκπέμπει πλειάδων, και `storm.logInfo` για να γράψετε στα αρχεία καταγραφής. Να να ενθαρρύνετε τους να διαβάσετε επάνω σε αυτό το αρχείο και να κατανοήσετε τι παρέχει.

##<a name="challenges"></a>Προκλήσεις

Χρήση της λειτουργικής μονάδας __storm.py__ , μπορείτε να δημιουργήσετε spouts Python που εκμετάλλευση των δεδομένων και στοιχεία που επεξεργάζονται δεδομένα, ωστόσο, η συνολική ορισμού τοπολογία καταιγίδας που καλώδια επικοινωνίας μεταξύ των στοιχείων εξακολουθεί να έχει συνταχθεί με Java ή Clojure. Επιπλέον, εάν χρησιμοποιείτε το Java, πρέπει επίσης να δημιουργήσετε στοιχεία Java που λειτουργεί ως ένα περιβάλλον εργασίας για τα στοιχεία Python.

Επίσης, εφόσον συμπλεγμάτων καταιγίδας εκτελέσετε με κατανέμεται τρόπο, πρέπει να βεβαιωθείτε ότι κάθε λειτουργικές μονάδες που απαιτούνται από τα στοιχεία σας Python είναι διαθέσιμες σε όλους τους κόμβους εργαζόμενου στο σύμπλεγμα. Καταιγίδας δεν παρέχει οποιαδήποτε εύκολος τρόπος για να επιτύχετε αυτό για τους πόρους πολλούς lang - είτε έχετε για να συμπεριλάβετε όλες τις εξαρτήσεις ως μέρος του αρχείου βάζο για την τοπολογία ή εγκατάσταση με μη αυτόματο τρόπο εξαρτήσεις σε κάθε εργαζόμενου κόμβο του συμπλέγματος.

###<a name="java-vs-clojure-topology-definition"></a>Ορισμός τοπολογία Java έναντι Clojure

Από τις δύο μεθόδους από τον ορισμό μιας τοπολογίας, Clojure με άκρο είναι το ευκολότερος/cleanest όπως μπορείτε να το κάνετε απευθείας referenc python στοιχεία στον ορισμό της τοπολογίας. Για ορισμούς βάσει Java τοπολογία, πρέπει επίσης να ορίσετε στοιχεία Java που χειρισμού πράγματα όπως τα πεδία του πλειάδων δήλωση επιστρέφονται από τα στοιχεία Python.

Και οι δύο μέθοδοι περιγράφονται σε αυτό το έγγραφο, μαζί με παραδείγματα έργων.

##<a name="python-components-with-a-java-topology"></a>Python στοιχεία με μια τοπολογία Java

> [AZURE.NOTE] Αυτό το παράδειγμα είναι διαθέσιμη από την [https://github.com/Azure-Samples/hdinsight-python-storm-wordcount](https://github.com/Azure-Samples/hdinsight-python-storm-wordcount) στον κατάλογο __JavaTopology__ . Αυτό είναι ένα έργο με βάση Maven. Εάν είστε εξοικειωμένοι με τις Maven, ανατρέξτε στο θέμα [Ανάπτυξη Java βάσει τοπολογίες με καταιγίδας Apache στην HDInsight](hdinsight-storm-develop-java-topology.md) για περισσότερες πληροφορίες σχετικά με τη δημιουργία ενός έργου Maven για μια τοπολογία καταιγίδας.

Μια τοπολογία βάσει Java που χρησιμοποιεί Python (ή άλλα στοιχεία γλώσσας JVM,) εμφανίζεται αρχικά για να χρησιμοποιήσετε στοιχεία Java. αλλά εάν εμφανίζονται σε κάθε ένα από τα spouts/βίδες Java, θα δείτε κώδικα παρόμοιο με το εξής:

    public SplitBolt() {
        super("python", "countbolt.py");
    }

Αυτό είναι όπου Java καλεί Python και εκτελεί τη δέσμη ενεργειών που περιέχει τη λογική πραγματική κεραυνό. Το spouts/Μπουλόνια Java (για αυτό το παράδειγμα,) δηλώνουν απλώς τα πεδία της πλειάδας που θα εκπέμπει το υποκείμενο στοιχείο Python.

Τα ίδια Python τα αρχεία που είναι αποθηκευμένα σε το `/multilang/resources` καταλόγου σε αυτό το παράδειγμα. Το `/multilang` καταλόγου γίνεται αναφορά σε το __pom.xml__:

<resources>
    <resource>
        <!-- Where the Python bits are kept -->
        <directory>${basedir} / multilang</directory>
    </resource>
</resources>

Αυτό περιλαμβάνει όλα τα αρχεία του `/multilang` φακέλου σε το βάζο που θα δημιουργηθεί από αυτό το έργο.

> [AZURE.IMPORTANT] Σημειώστε ότι μόνο Καθορίζει το `/multilang` καταλόγου και δεν `/multilang/resources`. Καταιγίδας αναμένει μη JVM πόρων σε ένα `resources` καταλόγου, ώστε το είναι αναζητήσει για εσωτερικά ήδη. Διάθεση στοιχεία αυτού του φακέλου σας επιτρέπει να απλώς αναφορά κατά όνομα στον κώδικα Java. Για παράδειγμα, `super("python", "countbolt.py");`. Ένας άλλος τρόπος για να σκεφτείτε το είναι ότι καταιγίδας βλέπει το `resources` κατάλογο ως το ριζικό κατάλογο (/) κατά την πρόσβαση σε πολλούς lang πόρους.
>
> Για το έργο σε αυτό το παράδειγμα, το `storm.py` λειτουργική μονάδα περιλαμβάνει το `/multilang/resources` καταλόγου.

###<a name="build-and-run-the-project"></a>Δημιουργία και εκτέλεση του έργου

Για να εκτελέσετε αυτό το έργο τοπικά, απλώς να χρησιμοποιήσετε την παρακάτω εντολή Maven για να δημιουργήσετε και να εκτελείται σε τοπική λειτουργία:

    mvn compile exec:java -Dstorm.topology=com.microsoft.example.WordCount

Χρησιμοποιήστε το συνδυασμό πλήκτρων ctrl + c για να τερματίσετε τη διαδικασία.

Για να αναπτύξετε το έργο σε ένα σύμπλεγμα HDInsight εκτελείται καταιγίδας Apache, χρησιμοποιήστε τα ακόλουθα βήματα:

1. Δημιουργήστε ένα βάζο uber:

        mvn package

    Αυτό θα δημιουργήσει ένα αρχείο που ονομάζεται __WordCount--1.0 SNAPSHOT.jar__ στο το `/target` καταλόγου για αυτό το έργο.

2. Αποστολή του αρχείου βάζο στο σύμπλεγμα Hadoop χρησιμοποιώντας μία από τις παρακάτω μεθόδους:

    * Για __βάσει Linux__ συμπλεγμάτων HDInsight: χρήση `scp WordCount-1.0-SNAPSHOT.jar USERNAME@CLUSTERNAME-ssh.azurehdinsight.net:WordCount-1.0-SNAPSHOT.jar` για να αντιγράψετε το αρχείο βάζο στο σύμπλεγμα, αντικαθιστώντας το όνομα ΧΡΉΣΤΗ με το όνομα χρήστη SSH και CLUSTERNAME με το όνομα του συμπλέγματος HDInsight.

        Μόλις ολοκληρωθεί η αποστολή του αρχείου, συνδεθείτε με το σύμπλεγμα χρησιμοποιώντας SSH και αρχίστε να το χρησιμοποιείτε τοπολογίας`storm jar WordCount-1.0-SNAPSHOT.jar com.microsoft.example.WordCount wordcount`

    * Για συμπλεγμάτων HDInsight που __βασίζεται σε Windows__ : σύνδεση με τον πίνακα εργαλείων καταιγίδας μεταβαίνοντας στο HTTPS://CLUSTERNAME.azurehdinsight.net/ στο πρόγραμμα περιήγησης. Αντικαταστήστε το CLUSTERNAME με το όνομά σας HDInsight σύμπλεγμα και παρέχετε το όνομα διαχειριστή και τον κωδικό πρόσβασης όταν σας ζητηθεί.

        Χρησιμοποιώντας τη φόρμα, εκτελέστε τις ακόλουθες ενέργειες:

        * __Αρχείο βάζων__: Επιλέξτε __Αναζήτηση__και, στη συνέχεια, επιλέξτε το αρχείο __WordCount-1.0-SNAPSHOT.jar__
        * __Όνομα κλάσης__: Εισαγάγετε`com.microsoft.example.WordCount`
        * __Επιπλέον ρόλο__: Εισαγάγετε ένα φιλικό όνομα, όπως `wordcount` για τον προσδιορισμό της τοπολογίας

        Τέλος, επιλέξτε __Υποβολή__ για έναρξη της τοπολογίας.

> [AZURE.NOTE] Αφού ξεκινήσετε, μια τοπολογία καταιγίδας εκτελείται μέχρι τη διακοπή (θανατωθέντων.) Για να διακόψετε την τοπολογία, χρησιμοποιήστε το `storm kill TOPOLOGYNAME` εντολής από τη γραμμή εντολών (SSH περίοδο λειτουργίας σε ένα σύμπλεγμα Linux για παράδειγμα,) ή χρησιμοποιώντας το περιβάλλον εργασίας Χρήστη καταιγίδας, επιλέξτε την τοπολογία και, στη συνέχεια, κάντε κλικ στο κουμπί __τερματισμού__ .

##<a name="python-components-with-a-clojure-topology"></a>Python στοιχεία με μια τοπολογία Clojure

> [AZURE.NOTE] Αυτό το παράδειγμα είναι διαθέσιμη από την [https://github.com/Azure-Samples/hdinsight-python-storm-wordcount](https://github.com/Azure-Samples/hdinsight-python-storm-wordcount) στον κατάλογο __ClojureTopology__ .

Αυτή η τοπολογία που δημιουργήθηκε με τη χρήση [Leiningen](http://leiningen.org) για να [δημιουργήσετε ένα νέο έργο Clojure](https://github.com/technomancy/leiningen/blob/stable/doc/TUTORIAL.md#creating-a-project). Μετά από αυτό, έγιναν τις ακόλουθες τροποποιήσεις στο scaffolded έργο:

* __Project.clj__: προσθέσει εξαρτήσεις για καταιγίδας και εξαιρέσεις για τα στοιχεία που μπορεί να προκαλέσει πρόβλημα όταν αναπτυχθεί στο διακομιστή HDInsight.
* __πόροι/πόροι__: Leiningen δημιουργεί έναν προεπιλεγμένο `resources` καταλόγου, ωστόσο, εμφανίζονται τα αρχεία που είναι αποθηκευμένα εδώ για να προστεθούν στη ρίζα της το αρχείο βάζο που δημιουργήθηκε από αυτό το έργο και καταιγίδας αναμένει αρχείων σε έναν δευτερεύοντα κατάλογο με όνομα `resources`. Έτσι προστέθηκε μια δευτερεύουσα καταλόγου και τα αρχεία Python είναι αποθηκευμένα στο `resources/resources`. Κατά το χρόνο εκτέλεσης, αυτό θα αντιμετωπίζεται ως το ριζικό κατάλογο (/) για να αποκτήσετε πρόσβαση σε στοιχεία Python.
* __src/wordcount/Core.clj__: αυτό το αρχείο περιέχει τον ορισμό της τοπολογίας και γίνεται αναφορά από το αρχείο __project.clj__ . Για περισσότερες πληροφορίες σχετικά με τη χρήση Clojure για να ορίσετε μια τοπολογία καταιγίδας, ανατρέξτε στο θέμα [Clojure DSL](https://storm.apache.org/documentation/Clojure-DSL.html).

###<a name="build-and-run-the-project"></a>Δημιουργία και εκτέλεση του έργου

__Για να δημιουργήσετε και να εκτελέσετε το έργο τοπικά__, χρησιμοποιήστε την ακόλουθη εντολή:

    lein clean, run

Για να διακόψετε την τοπολογία, χρησιμοποιήστε το __Συνδυασμό πλήκτρων Ctrl + C__.

__Για να δημιουργήσετε ένα uberjar και ανάπτυξη με το HDInsight__, χρησιμοποιήστε τα ακόλουθα βήματα:

1. Δημιουργήστε ένα uberjar που περιέχει την τοπολογία και την απαιτούμενη εξαρτήσεις:

        lein uberjar

    Αυτό θα δημιουργήσει ένα νέο αρχείο με το όνομα `wordcount-1.0-SNAPSHOT.jar` στο το `target\uberjar+uberjar` καταλόγου.
    
2. Χρησιμοποιήστε μία από τις παρακάτω μεθόδους για να αναπτύξετε και να εκτελέσετε την τοπολογία σε ένα σύμπλεγμα HDInsight:

    * __Βάσει Linux HDInsight__
    
        1. Αντιγράψτε το αρχείο για να το HDInsight σύμπλεγμα κεφαλής κόμβο με χρήση `scp`. Για παράδειγμα:
        
                scp wordcount-1.0-SNAPSHOT.jar USERNAME@CLUSTERNAME-ssh.azurehdinsight.net:wordcount-1.0-SNAPSHOT.jar
                
            Αντικαταστήστε το όνομα ΧΡΉΣΤΗ με ένα χρήστη SSH για σύμπλεγμα και CLUSTERNAME με το όνομα συμπλέγματος HDInsight.
            
        2. Μόλις το αρχείο έχει αντιγραφεί στο σύμπλεγμα, χρησιμοποιήστε SSH για να συνδεθείτε με το σύμπλεγμα και να υποβάλετε την εργασία. Για πληροφορίες σχετικά με τη χρήση SSH με το HDInsight, ανατρέξτε σε ένα από τα εξής:
        
            * [Χρήση SSH με βάσει Linux HDInsight από Linux, Unix ή λειτουργικό σύστημα OS X](hdinsight-hadoop-linux-use-ssh-unix.md)
            * [Χρήση SSH με βάσει Linux HDInsight από το Windows](hdinsight-hadoop-linux-use-ssh-windows.md)
            
        3. Μόλις συνδεθεί, χρησιμοποιήστε τα ακόλουθα για να ξεκινήσετε την τοπολογία:
        
                storm jar wordcount-1.0-SNAPSHOT.jar wordcount.core wordcount
    
    * __HDInsight που βασίζεται σε Windows__
    
        1. Σύνδεση με τον πίνακα εργαλείων καταιγίδας, μεταβαίνοντας HTTPS://CLUSTERNAME.azurehdinsight.net/ στο πρόγραμμα περιήγησης. Αντικαταστήστε το CLUSTERNAME με το όνομά σας HDInsight σύμπλεγμα και παρέχετε το όνομα διαχειριστή και τον κωδικό πρόσβασης όταν σας ζητηθεί.

        2. Χρησιμοποιώντας τη φόρμα, εκτελέστε τις ακόλουθες ενέργειες:

            * __Αρχείο βάζων__: Επιλέξτε __Αναζήτηση__και, στη συνέχεια, επιλέξτε το αρχείο __wordcount-1.0-SNAPSHOT.jar__
            * __Όνομα κλάσης__: Εισαγάγετε`wordcount.core`
            * __Επιπλέον ρόλο__: Εισαγάγετε ένα φιλικό όνομα, όπως `wordcount` για τον προσδιορισμό της τοπολογίας

            Τέλος, επιλέξτε __Υποβολή__ για έναρξη της τοπολογίας.

> [AZURE.NOTE] Αφού ξεκινήσετε, μια τοπολογία καταιγίδας εκτελείται μέχρι τη διακοπή (θανατωθέντων.) Για να διακόψετε την τοπολογία, χρησιμοποιήστε το `storm kill TOPOLOGYNAME` εντολής από τη γραμμή εντολών (SSH περίοδο λειτουργίας σε ένα σύμπλεγμα Linux,) ή χρησιμοποιώντας το περιβάλλον εργασίας Χρήστη καταιγίδας, επιλέξτε την τοπολογία και, στη συνέχεια, κάντε κλικ στο κουμπί __τερματισμού__ .

##<a name="next-steps"></a>Επόμενα βήματα

Σε αυτό το έγγραφο, μάθατε πώς μπορείτε να χρησιμοποιήσετε τα στοιχεία Python από μια τοπολογία καταιγίδας. Δείτε τα ακόλουθα έγγραφα για άλλους τρόπους για να χρησιμοποιήσετε Python με HDInsight:

* [Πώς μπορείτε να χρησιμοποιήσετε Python για ροή εργασιών MapReduce](hdinsight-hadoop-streaming-python.md)
* [Πώς μπορείτε να χρησιμοποιήσετε Python χρήστη που ορίζονται από το συναρτήσεις (UDF) στο γουρούνι και ομάδας](hdinsight-python.md)
