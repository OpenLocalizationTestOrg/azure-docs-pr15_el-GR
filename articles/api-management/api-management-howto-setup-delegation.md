<properties 
    pageTitle="Πώς μπορείτε να αναθέσετε καταχώρησης και προϊόντος συνδρομή χρήστη" 
    description="Μάθετε πώς μπορείτε να αναθέσετε χρήστη καταχώρησης και προϊόντος συνδρομή σε τρίτους Azure API διαχείρισης." 
    services="api-management" 
    documentationCenter="" 
    authors="antonba" 
    manager="erikre" 
    editor=""/>

<tags 
    ms.service="api-management" 
    ms.workload="mobile" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="10/25/2016" 
    ms.author="antonba"/>

# <a name="how-to-delegate-user-registration-and-product-subscription"></a>Πώς μπορείτε να αναθέσετε καταχώρησης και προϊόντος συνδρομή χρήστη

Ανάθεση σάς επιτρέπει να χρησιμοποιήσετε την υπάρχουσα τοποθεσία Web για το χειρισμό προγραμματιστής εισόδου-στο/sign-up και συνδρομή για τα προϊόντα σε σύγκριση με χρησιμοποιώντας τις ενσωματωμένες λειτουργίες στην πύλη για προγραμματιστές. Αυτή η δυνατότητα επιτρέπει της τοποθεσίας Web για κάτοχος των δεδομένων χρήστη και να εκτελέσετε την επικύρωση από αυτά τα βήματα με προσαρμοσμένο τρόπο.

## <a name="delegate-signin-up"> </a>Προγραμματιστής αντιπροσώπευση εισόδου και εγγραφής

Για να αναθέσετε προγραμματιστής εισόδου και εγγραφής στην υπάρχουσα τοποθεσία Web σας θα πρέπει να δημιουργήσετε ένα τελικό σημείο ειδική ανάθεση στην τοποθεσία σας που λειτουργεί ως το σημείο εισόδου για κάθε τέτοια αίτηση ξεκινά από την πύλη διαχείρισης API για προγραμματιστές.

Η τελική ροή εργασίας θα είναι ως εξής:

1. Μόνο για προγραμματιστές κλικ στη σύνδεση εισόδου ή εγγραφής στην πύλη διαχείρισης API για προγραμματιστές
2. Ανακατεύθυνση προγράμματος περιήγησης για το τελικό σημείο ανάθεση
3. Τελικό σημείο ανάθεση σε επιστροφές ανακατευθύνει ή παρουσιάζει το περιβάλλον εργασίας Χρήστη που σας ρωτά χρήστη να εισόδου ή εγγραφής
4. Σε περίπτωση επιτυχίας, ο χρήστης ανακατευθύνεται πίσω API διαχείρισης για προγραμματιστές σελίδα της πύλης του αυτά αποτελέσματα από


Για να ξεκινήσετε, ας πρώτη διαχείρισης API εγκατάστασης για τη δρομολόγηση αιτήσεων μέσω του τελικού σημείου ανάθεση. Στην πύλη του publisher API διαχείρισης, κάντε κλικ στην επιλογή σχετικά με την **ασφάλεια** και, στη συνέχεια, κάντε κλικ στην καρτέλα **ανάθεση** . Επιλέξτε το πλαίσιο ελέγχου για να ενεργοποιήσετε την 'Πληρεξουσίου είσοδος & εγγραφής'.

![Ανάθεση σελίδας][api-management-delegation-signin-up]

* Αποφασίστε ποια τη διεύθυνση URL της το τελικό σημείο ειδική ανάθεση θα και πληκτρολογήστε τον στο πεδίο **διεύθυνση URL τελικού σημείου ανάθεση** . 

* Μέσα στο πεδίο **ανάθεση κλειδί ελέγχου ταυτότητας** , πληκτρολογήστε έναν μυστικό που θα χρησιμοποιηθεί για τον υπολογισμό μιας υπογραφής που παρέχονται σε εσάς για την επαλήθευση για να βεβαιωθείτε ότι η αίτηση στην πραγματικότητα που προέρχονται από το Azure API διαχείρισης. Μπορείτε να κάνετε κλικ στο κουμπί **Δημιουργία** για να έχετε API Managemnet τυχαία δημιουργούν έναν αριθμό-κλειδί για εσάς.

Τώρα, πρέπει να δημιουργήσετε το **τελικό σημείο ανάθεση**. Πρέπει να εκτελέσετε διάφορες ενέργειες:

1. Λήψη αίτησης με την εξής μορφή:

    > *{η διεύθυνση URL της σελίδας προέλευσης} http://www.yourwebsite.com/apimdelegation?operation=SignIn&returnUrl= & άλας = {συμβολοσειρά} & υπογραφής = {συμβολοσειρά}*

    Παράμετροι ερωτήματος για την περίπτωση εισόδου / εγγραφής:
    - **λειτουργία**: προσδιορίζει τι τύπο ανάθεση αίτηση είναι - μπορεί να είναι **εισόδου** μόνο σε αυτήν την περίπτωση
    - **returnUrl**: η διεύθυνση URL της σελίδας όπου ο χρήστης κάνει κλικ σε μια σύνδεση εισόδου ή εγγραφής
    - **αλατιού**: μια ειδική αλατιού συμβολοσειρά που χρησιμοποιείται για τον υπολογισμό κατακερματισμός ασφαλείας
    - **υπογραφή**: Κατακερματισμός υπολογιστεί ο κατακερματισμός υπολογισμένη ασφαλείας που θα χρησιμοποιηθεί για σύγκριση με το δικό σας

2. Βεβαιωθείτε ότι η αίτηση που προέρχονται από το Azure API διαχείρισης (προαιρετικό, αλλά συνιστάται ιδιαίτερα για την ασφάλεια)

    * Υπολογίζει μια κατακερματισμός HMAC-SHA512 από μιας συμβολοσειράς με βάση τις παραμέτρους ερωτήματος **returnUrl** και **αλάτι** ([παράδειγμα κώδικα που παρέχεται παρακάτω]):
        > HMAC (**αλατιού** + '\n' + **returnUrl**)
         
    * Συγκρίνετε ο κατακερματισμός παραπάνω υπολογιστεί η τιμή της παραμέτρου ερωτήματος **υπογραφής** . Εάν ταιριάζουν με τα δύο Κατακερματισμοί, προχωρήστε στο επόμενο βήμα, διαφορετικά απορρίψετε την αίτηση.

2. Βεβαιωθείτε ότι λαμβάνετε μια αίτηση για εισόδου/εισόδου επάνω: η παράμετρος **λειτουργία** ερωτήματος θα οριστεί σε "**Είσοδος**".

3. Παρουσίαση στο χρήστη με το περιβάλλον εργασίας Χρήστη για είσοδο ή εγγραφής

4. Εάν ο χρήστης είναι υπογραφής προς τα επάνω πρέπει να δημιουργήσετε έναν αντίστοιχο λογαριασμό για τα API διαχείρισης. [Δημιουργία ενός χρήστη] με το API διαχείρισης REST API. Όταν αυτή την περίπτωση, βεβαιωθείτε ότι μπορείτε να ορίσετε το Αναγνωριστικό χρήστη στην ίδια είναι στο χώρο αποθήκευσης του χρήστη ή σε ένα Αναγνωριστικό που μπορείτε να παρακολουθείτε από.

5. Όταν είναι επιτυχής έλεγχος ταυτότητας του χρήστη:

    * [αίτηση ενός διακριτικού καθολικής σύνδεσης (SSO)] μέσω το API διαχείρισης REST API

    * Προσάρτηση μιας παραμέτρου ερωτήματος returnUrl στη διεύθυνση URL SSO που έχετε λάβει από την κλήση API παραπάνω:
        > https://customer.portal.azure-api.net/signin-sso?token&returnUrl=/return/url π.χ. 

    * ανακατεύθυνση στο χρήστη στην παραπάνω παράγονται διεύθυνση URL

Εκτός από τη λειτουργία **εισόδου** , μπορείτε επίσης να εκτελέσετε Διαχείριση λογαριασμού, ακολουθώντας τα προηγούμενα βήματα και χρησιμοποιώντας μία από τις ακόλουθες λειτουργίες.

-   **Η Αλλαγή_κωδικού_πρόσβασης**
-   **ChangeProfile**
-   **CloseAccount**

Πρέπει να μεταβιβάσετε τις ακόλουθες παραμέτρους ερωτήματος για λειτουργίες διαχείρισης λογαριασμού.

-   **λειτουργία**: προσδιορίζει τι τύπο αίτηση ανάθεσης είναι (η Αλλαγή_κωδικού_πρόσβασης, ChangeProfile ή CloseAccount)
-   **αναγνωριστικό χρήστη**: το αναγνωριστικό χρήστη του λογαριασμού για τη Διαχείριση
-   **αλατιού**: μια ειδική αλατιού συμβολοσειρά που χρησιμοποιείται για τον υπολογισμό κατακερματισμός ασφαλείας
-   **υπογραφή**: Κατακερματισμός υπολογιστεί ο κατακερματισμός υπολογισμένη ασφαλείας που θα χρησιμοποιηθεί για σύγκριση με το δικό σας

## <a name="delegate-product-subscription"> </a>Ανάθεση συνδρομή προϊόντος

Ανάθεση συνδρομή προϊόντος λειτουργεί παρόμοια με ανάθεση χρήστη εισόδου/προς τα επάνω. Η τελική ροή εργασίας θα είναι ως εξής:

1. Προγραμματιστής επιλέγει ένα προϊόν στην πύλη για προγραμματιστές του API διαχείρισης και κάνει κλικ στο κουμπί εγγραφή
2. Ανακατεύθυνση προγράμματος περιήγησης για το τελικό σημείο ανάθεση
3. Τελικό σημείο ανάθεση εκτελεί βήματα συνδρομή απαραίτητο προϊόν - αυτό εξαρτάται από εσάς και μπορεί να ενέχει ανακατεύθυνση σε άλλη σελίδα για να ζητήσετε πληροφορίες χρέωσης, επιπλέον ερωτήσεις, ή απλώς την αποθήκευση των πληροφοριών και δεν απαιτείται οποιαδήποτε ενέργεια από το χρήστη


Για να ενεργοποιήσετε τη λειτουργία, στη σελίδα " **ανάθεση** ", κάντε κλικ στην επιλογή **πληρεξουσίου προϊόντος συνδρομής**.

Στη συνέχεια, βεβαιωθείτε ότι το τελικό σημείο ανάθεση εκτελεί τις ακόλουθες ενέργειες:


1. Λήψη αίτησης με την εξής μορφή:

    > *http://www.yourwebsite.com/apimdelegation?operation= {λειτουργία} & productId = {προϊόντος για να εγγραφείτε για} & αναγνωριστικό χρήστη = {χρήστης που κάνει αίτηση} & αλατιού = {συμβολοσειρά} & υπογραφής = {συμβολοσειρά}*

    Παράμετροι ερωτήματος για την περίπτωση συνδρομή προϊόντος:
    - **λειτουργία**: προσδιορίζει τον τύπο της αίτηση ανάθεσης. Για τη συνδρομή προϊόντος αιτήσεις οι έγκυρες επιλογές είναι:
        - "Εγγραφή": μια αίτηση για να εγγραφείτε στο χρήστη να ενός συγκεκριμένου προϊόντος με που παρέχεται Αναγνωριστικό (δείτε παρακάτω)
        - "Κατάργηση εγγραφής": μια αίτηση για να καταργήσετε την εγγραφή ενός χρήστη για ένα προϊόν
        - "Ανανέωση": ένα requst για να ανανεώσετε μια συνδρομή (π.χ. που μπορεί να λήξη)
    - **productId**: το Αναγνωριστικό του προϊόντος στο χρήστη που απαιτούνται για την εγγραφή σε
    - **αναγνωριστικό χρήστη**: το Αναγνωριστικό του χρήστη για τον οποίο γίνεται η αίτηση
    - **αλατιού**: μια ειδική αλατιού συμβολοσειρά που χρησιμοποιείται για τον υπολογισμό κατακερματισμός ασφαλείας
    - **υπογραφή**: Κατακερματισμός υπολογιστεί ο κατακερματισμός υπολογισμένη ασφαλείας που θα χρησιμοποιηθεί για σύγκριση με το δικό σας


2. Βεβαιωθείτε ότι η αίτηση που προέρχονται από το Azure API διαχείρισης (προαιρετικό, αλλά συνιστάται ιδιαίτερα για την ασφάλεια)

    * Υπολογίζει μια HMAC SHA512 από μια συμβολοσειρά με βάση τις παραμέτρους ερωτήματος **productId**, το **αναγνωριστικό χρήστη** και **αλατιού** :
        > HMAC (**αλατιού** + '\n' + **productId** + '\n' + **αναγνωριστικό χρήστη**)
         
    * Συγκρίνετε ο κατακερματισμός παραπάνω υπολογιστεί η τιμή της παραμέτρου ερωτήματος **υπογραφής** . Εάν ταιριάζουν με τα δύο Κατακερματισμοί, προχωρήστε στο επόμενο βήμα, διαφορετικά απορρίψετε την αίτηση.
    
3. Εκτελέστε οποιαδήποτε επεξεργασία συνδρομή το προϊόν με βάση τον τύπο της λειτουργίας που ζητήθηκε σε **λειτουργία** - χρέωση π.χ., περαιτέρω ερωτήσεις, κ.λπ.

4. Στην εγγραφή με επιτυχία ο χρήστης με το προϊόν στη δική σας πλευρά, εγγραφείτε στο χρήστη με το προϊόν API διαχείρισης καλώντας [Το REST API για τη συνδρομή προϊόντος].

## <a name="delegate-example-code"></a> Παράδειγμα κώδικα ##

Αυτά τα δείγματα κώδικα δείχνουν πώς μπορείτε να ακολουθήσετε το *κλειδί επικύρωσης ανάθεση*, το οποίο έχει οριστεί στην οθόνη ανάθεση από την πύλη του publisher, για να δημιουργήσετε μια HMAC που χρησιμοποιείται για την επικύρωση της υπογραφής, στη συνέχεια, επαλήθευση ότι η διάρκεια ισχύος το που μεταβιβάστηκε returnUrl. Τον ίδιο κωδικό λειτουργεί για το productId και το αναγνωριστικό χρήστη με ελαφρά τροποποίηση.

**Κώδικας C# για να δημιουργήσετε κατακερματισμός του returnUrl**

    using System.Security.Cryptography;

    string key = "delegation validation key";
    string returnUrl = "returnUrl query parameter";
    string salt = "salt query parameter";
    string signature;
    using (var encoder = new HMACSHA512(Convert.FromBase64String(key)))
    {
        signature = Convert.ToBase64String(encoder.ComputeHash(Encoding.UTF8.GetBytes(salt + "\n" + returnUrl)));
        // change to (salt + "\n" + productId + "\n" + userId) when delegating product subscription
        // compare signature to sig query parameter
    }


**Κωδικός NodeJS για τη δημιουργία κατακερματισμός του returnUrl**

    var crypto = require('crypto');
    
    var key = 'delegation validation key'; 
    var returnUrl = 'returnUrl query parameter';
    var salt = 'salt query parameter';
    
    var hmac = crypto.createHmac('sha512', new Buffer(key, 'base64'));
    var digest = hmac.update(salt + '\n' + returnUrl).digest();
    // change to (salt + "\n" + productId + "\n" + userId) when delegating product subscription
    // compare signature to sig query parameter
    
    var signature = digest.toString('base64');

## <a name="next-steps"></a>Επόμενα βήματα

Για περισσότερες πληροφορίες σχετικά με την ανάθεση, ανατρέξτε στο θέμα βίντεο που ακολουθεί.

> [AZURE.VIDEO delegating-user-authentication-and-product-subscription-to-a-3rd-party-site]

[Delegating developer sign-in and sign-up]: #delegate-signin-up
[Delegating product subscription]: #delegate-product-subscription
[Πρόσκληση ενός διακριτικού καθολικής σύνδεσης (SSO)]: http://go.microsoft.com/fwlink/?LinkId=507409
[Δημιουργία χρήστη]: http://go.microsoft.com/fwlink/?LinkId=507655#CreateUser
[καλεί το REST API για τη συνδρομή προϊόντος]: http://go.microsoft.com/fwlink/?LinkId=507655#SSO
[Next steps]: #next-steps
[παράδειγμα κώδικα που παρέχεται κάτω από το στοιχείο]: #delegate-example-code

[api-management-delegation-signin-up]: ./media/api-management-howto-setup-delegation/api-management-delegation-signin-up.png 