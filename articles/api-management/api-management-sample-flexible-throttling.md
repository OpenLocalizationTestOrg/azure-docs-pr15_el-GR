<properties
    pageTitle="Για προχωρημένους αίτηση περιορισμού Azure API διαχείρισης"
    description="Μάθετε πώς μπορείτε να δημιουργήσετε και να εφαρμόσετε ευέλικτη ορίου και πολιτικές διαχείρισης API Azure περιορισμού της ταχύτητας."
    services="api-management"
    documentationCenter=""
    authors="darrelmiller"
    manager="erikre"
    editor=""/>

<tags
    ms.service="api-management"
    ms.devlang="dotnet"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="na"
    ms.date="10/25/2016"
    ms.author="darrmi"/>


# <a name="advanced-request-throttling-with-azure-api-management"></a>Για προχωρημένους αίτηση περιορισμού Azure API διαχείρισης

Αδυναμία επιτάχυνσης εισερχόμενες αιτήσεις είναι ρόλο κλειδί της Azure API διαχείρισης. Είτε ελέγχοντας το ποσοστό αιτήσεις ή το σύνολο αιτήσεις/των δεδομένων μεταφερθεί, API διαχείρισης επιτρέπει υπηρεσίες παροχής API για την προστασία τους APIs από κατάχρηση και να δημιουργήσετε τιμή για διαφορετικά επίπεδα προϊόντος API.

## <a name="product-based-throttling"></a>Προϊόν με βάση περιορισμού
Μέχρι σήμερα, το επιτόκιο περιορισμού δυνατότητες έχουν περιορίζεται σε που έχει ρυθμιστεί για μια συγκεκριμένη συνδρομή προϊόντος (ουσιαστικά έναν αριθμό-κλειδί), που ορίζονται από το στην πύλη του publisher API διαχείρισης. Αυτό είναι χρήσιμο για την υπηρεσία παροχής API για να εφαρμόσετε όρια σε τους προγραμματιστές που έχουν εγγραφεί για να χρησιμοποιήσετε το API, ωστόσο, αυτό δεν Βοήθειας, για παράδειγμα, στα μεμονωμένα τους τελικούς χρήστες του API περιορισμού. Είναι δυνατό να για ένα χρήστη ο προγραμματιστής της εφαρμογής για να εκμετάλλευση ολόκληρου του ορίου και, στη συνέχεια, να αποτρέψετε άλλους πελάτες από τον προγραμματιστή από τη δυνατότητα να χρησιμοποιήσετε την εφαρμογή. Επίσης, πολλούς πελάτες που μπορεί να δημιουργήσουν μεγάλο όγκο των αιτήσεων μπορεί να περιορίσετε την πρόσβαση σε περιστασιακές χρήστες.

## <a name="custom-key-based-throttling"></a>Προσαρμοσμένο κλειδί βάσει περιορισμού
Οι νέες πολιτικές [επιτόκιο-όριο-από-κλειδί](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) και [ορίου-κλειδί](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) παρέχουν μια πολύ πιο ευέλικτη λύση για να ελέγχετε την κυκλοφορία. Αυτές οι νέες πολιτικές σάς επιτρέπουν να ορίσετε εκφράσεις για να προσδιορίσετε τα κλειδιά που θα χρησιμοποιηθεί για την παρακολούθηση της χρήσης κίνηση. Τον τρόπο που λειτουργεί easiest απεικονίζεται με ένα παράδειγμα. 

## <a name="ip-address-throttling"></a>Διεύθυνση IP περιορισμού
Τις παρακάτω πολιτικές περιορισμός μια διεύθυνση IP υπολογιστή-πελάτη μόνο 10 κλήσεις κάθε λεπτό, με ένα σύνολο 1.000.000 κλήσεις και 10.000 kilobyte του εύρους ζώνης ανά μήνα. 

    <rate-limit-by-key  calls="10"
              renewal-period="60"
              counter-key="@(context.Request.IpAddress)" />

    <quota-by-key calls="1000000"
              bandwidth="10000"
              renewal-period="2629800"
              counter-key="@(context.Request.IpAddress)" />

Εάν όλες οι υπολογιστές-πελάτες στο Internet χρησιμοποιήσει μια μοναδική διεύθυνση IP, αυτό μπορεί να είναι ένας αποτελεσματικός τρόπος περιορισμού χρήση ανά χρήστη. Ωστόσο, είναι αρκετά πιθανό ότι πολλοί χρήστες θα κοινής χρήσης μία δημόσια διεύθυνση IP λόγω τους την πρόσβαση στο Internet μέσω μια συσκευή NAT. Παρά αυτό, για το API που επιτρέπει την πρόσβαση χωρίς έλεγχο ταυτότητας του `IpAddress` μπορεί να είναι η καλύτερη επιλογή.

## <a name="user-identity-throttling"></a>Περιορισμού ταυτότητας χρήστη
Εάν ο τελικός χρήστης έχει ελεγχθεί η ταυτότητα, στη συνέχεια, μπορεί να δημιουργηθεί ένα πλήκτρο επιτάχυνσης βάσει των πληροφοριών που προσδιορίζει μοναδικά μια που χρήστη.

    <rate-limit-by-key calls="10"
        renewal-period="60"
        counter-key="@(context.Request.Headers.GetValueOrDefault("Authorization","").AsJwt()?.Subject)" />

Σε αυτό το παράδειγμα ενημερώνουμε εξαγάγετε κεφαλίδα εξουσιοδότησης, για να μετατρέψετε `JWT` το αντικείμενο και χρησιμοποιήστε το θέμα του διακριτικού για να προσδιορίσετε το χρήστη και να το χρησιμοποιήσετε ως ο ρυθμός τον περιορισμό του αριθμού-κλειδιού. Εάν η ταυτότητα χρήστη είναι αποθηκευμένο στο το `JWT` ως ένα από το άλλο, στη συνέχεια, ισχυρίζεται ότι η τιμή θα μπορούσαν να χρησιμοποιηθούν στη θέση.

## <a name="combined-policies"></a>Συνολικό πολιτικές
Παρόλο που οι νέες πολιτικές επιτάχυνσης παρέχει περισσότερο έλεγχο από τις υπάρχουσες πολιτικές επιτάχυνσης, εξακολουθεί να υπάρχει τιμή συνδυασμός δύο δυνατότητες. Περιορισμού από τη συνδρομή αριθμό-κλειδί προϊόντος ([το όριο Ρυθμός κλήσεων από τη συνδρομή](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRate) και [Ορισμός ορίου χρήσης από τη συνδρομή](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuota)) είναι ένας εξαιρετικός τρόπος για να ενεργοποιήσετε την monetizing των API κατά τη φόρτιση με βάση τα επίπεδα χρήση. Το finer κοκκώδης ελέγχου αδυναμία επιτάχυνσης από το χρήστη είναι συμπληρωματική και αποτρέπει τη συμπεριφορά του χρήστη να μειωθεί η εμπειρία ενός άλλου. 

## <a name="client-driven-throttling"></a>Πρόγραμμα-πελάτη βάσει περιορισμού
Όταν το πλήκτρο επιτάχυνσης ορίζεται χρησιμοποιώντας μια [πολιτική παράσταση](https://msdn.microsoft.com/library/azure/dn910913.aspx), στη συνέχεια, είναι η υπηρεσία παροχής API που επιλέγοντας πώς το περιορισμού έχει εύρος. Ωστόσο, ο προγραμματιστής μπορεί να θέλετε να ελέγξετε πώς αυτές χαρακτηρισμός όριο τις δικές τους πελάτες. Αυτό θα μπορούσε να είναι ενεργοποιημένη από την υπηρεσία παροχής API, εισάγοντας μια προσαρμοσμένη κεφαλίδα για να επιτρέπεται ο προγραμματιστής εφαρμογή προγράμματος-πελάτη για να επικοινωνήσετε το κλειδί για το API.

    <rate-limit-by-key calls="100"
              renewal-period="60"
              counter-key="@(request.Headers.GetValueOrDefault("Rate-Key",""))"/>

Αυτή η δυνατότητα επιτρέπει ο προγραμματιστής εφαρμογή προγράμματος-πελάτη για να επιλέξετε τον τρόπο που θέλουν να δημιουργήσετε το επιτόκιο τον περιορισμό του αριθμού-κλειδιού. Με λίγο επινοητικότητα προγραμματιστής προγράμματος-πελάτη μπορούσατε να δημιουργήσετε τις δικές τους βαθμίδες επιτόκιο εκχωρεί σύνολα πλήκτρα στους χρήστες και περιστροφή τη χρήση του κλειδιού.

## <a name="summary"></a>Σύνοψη
Azure API διαχείρισης παρέχει επιτόκιο και προσφοράς περιορισμού τόσο προστασία και προσθέστε την τιμή στην υπηρεσία σας API. Οι νέες επιτάχυνσης πολιτικές με προσαρμοσμένου πεδίου κανόνες επιτρέπουν finer κοκκώδης έλεγχο σε αυτές τις πολιτικές για να ενεργοποιήσετε τους πελάτες σας για να δημιουργήσετε εφαρμογές ακόμα καλύτερα. Τα παραδείγματα σε αυτό το άρθρο δείχνουν τη χρήση αυτών των πολιτικών νέα κατά συντελεστή κατασκευής περιορισμό αριθμών-κλειδιών με διευθύνσεις IP του υπολογιστή-πελάτη, ταυτότητα χρήστη και τις τιμές προγράμματος-πελάτη που δημιουργούνται. Ωστόσο, υπάρχουν πολλά άλλα τμήματα του μηνύματος που θα μπορούσαν να χρησιμοποιηθούν όπως παράγοντα χρήστη, τμήματα διαδρομή διεύθυνσης URL, μέγεθος του μηνύματος.

## <a name="next-steps"></a>Επόμενα βήματα
Δώστε μας τα σχόλιά σας στο νήμα Disqus για αυτό το θέμα. Θα είναι ιδανική για να ενημερώνεστε για άλλες πιθανές τιμές κλειδιών που έχουν λογική επιλογή σε σενάρια σας.

## <a name="watch-a-video-overview-of-these-policies"></a>Παρακολουθήστε ένα βίντεο Επισκόπηση αυτών των πολιτικών
Για περισσότερες πληροφορίες σχετικά με τις πολιτικές [επιτόκιο όριο με κλειδί](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) και [ορίου από το κλειδί](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) που αναφέρονται σε αυτό το άρθρο, επικοινωνήστε παρακολουθήστε το βίντεο που ακολουθεί.

> [AZURE.VIDEO advanced-request-throttling-with-azure-api-management]
