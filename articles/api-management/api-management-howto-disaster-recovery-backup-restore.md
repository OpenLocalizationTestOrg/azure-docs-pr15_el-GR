<properties 
    pageTitle="Πώς μπορείτε να υλοποιήσετε αποκατάσταση χρησιμοποιώντας υπηρεσίας δημιουργίας αντιγράφων ασφαλείας και επαναφορά Azure API διαχείρισης | Microsoft Azure" 
    description="Μάθετε πώς μπορείτε να χρησιμοποιήσετε το αντίγραφο ασφαλείας και επαναφοράς για την εκτέλεση αποκατάστασης από καταστροφή Azure API διαχείρισης." 
    services="api-management" 
    documentationCenter="" 
    authors="steved0x" 
    manager="erikre" 
    editor=""/>

<tags 
    ms.service="api-management" 
    ms.workload="mobile" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="10/25/2016" 
    ms.author="sdanie"/>

# <a name="how-to-implement-disaster-recovery-using-service-backup-and-restore-in-azure-api-management"></a>Πώς μπορείτε να υλοποιήσετε αποκατάσταση χρησιμοποιώντας υπηρεσίας δημιουργίας αντιγράφων ασφαλείας και επαναφορά Azure API διαχείρισης

Με την επιλογή για να δημοσιεύσετε και να διαχειριστείτε τις APIs μέσω Azure API διαχείρισης αξιοποιείτε από πολλά ανοχή σφαλμάτων και δυνατότητες υποδομής που αλλιώς θα πρέπει να σχεδιάσετε, υλοποίηση και διαχείριση. Το Azure πλατφόρμας mitigates ένα μεγάλο κλάσμα πιθανά αποτυχιών στην σε κλάσμα του κόστους.

Για να ανακτήσετε από διαθεσιμότητα προβλήματα που επηρεάζουν την περιοχή όπου το API διαχείρισης είναι η υπηρεσία hosted πρέπει να είστε έτοιμοι να αποκαταστήσουν την υπηρεσία σε διαφορετική περιοχή οποιαδήποτε στιγμή. Ανάλογα με τη διαθεσιμότητα των στόχων και στόχος χρόνου αποκατάστασης μπορεί να θέλετε να κράτηση μιας υπηρεσίας δημιουργίας αντιγράφων ασφαλείας σε μία ή περισσότερες περιοχές και προσπαθήστε να για να διατηρήσετε τους ρύθμισης παραμέτρων και περιεχομένου σε συγχρονισμό με την υπηρεσία ενεργή. Το αντίγραφο ασφαλείας της υπηρεσίας και η δυνατότητα επαναφοράς παρέχει το μπλοκ δόμησης είναι απαραίτητο για την εφαρμογή της στρατηγικής αποκατάστασης από καταστροφή.

Αυτός ο οδηγός εμφανίζει τον τρόπο ελέγχου ταυτότητας από διαχειριστή πόρων Azure αιτήσεις και τον τρόπο δημιουργίας αντιγράφων ασφαλείας και επαναφορά το API διαχείρισης παρουσιών της υπηρεσίας.

>[AZURE.NOTE] Η διαδικασία για τη δημιουργία αντιγράφων ασφαλείας και επαναφορά μια παρουσία της υπηρεσίας διαχείρισης API για αποκατάσταση μπορεί επίσης να χρησιμοποιηθεί για την αναπαραγωγή παρουσιών της υπηρεσίας διαχείρισης API για σενάρια όπως ενδιάμεσου σταδίου.
>
>Σημειώστε ότι κάθε αντίγραφο ασφαλείας λήγει μετά από 7 ημέρες. Εάν επιχειρήσετε να επαναφέρετε ένα αντίγραφο ασφαλείας, μετά τη λήξη της περιόδου λήξης των 7 ημερών, η επαναφορά θα αποτύχει με μια `Cannot restore: backup expired` μήνυμα.

## <a name="authenticating-azure-resource-manager-requests"></a>Ζητά τον έλεγχο ταυτότητας από διαχειριστή πόρων Azure

>[AZURE.IMPORTANT] Το REST API για δημιουργία αντιγράφων ασφαλείας και επαναφορά χρησιμοποιεί διαχείριση πόρων Azure και έχει ένα διαφορετικό ελέγχου ταυτότητας μηχανισμό από τα ΥΠΌΛΟΙΠΑ API για τη Διαχείριση σας οντοτήτων API διαχείρισης. Τα βήματα σε αυτήν την ενότητα περιγράφουν τον τρόπο για τον έλεγχο ταυτότητας από διαχειριστή πόρων Azure αιτήσεις. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [πραγματοποίηση ελέγχου ταυτότητας από διαχειριστή πόρων Azure αιτήσεις](http://msdn.microsoft.com/library/azure/dn790557.aspx).

Όλες οι εργασίες που κάνετε σε πόρους με χρήση της διαχείρισης πόρων Azure πρέπει να υποβληθούν σε έλεγχο ταυτότητας με το Azure Active Directory ακολουθώντας τα παρακάτω βήματα.

-   Προσθέστε μια εφαρμογή για το μισθωτή Azure Active Directory.
-   Ορισμός δικαιωμάτων για την εφαρμογή που προσθέσατε.
-   Αποκτήστε το διακριτικό για τον έλεγχο ταυτότητας των αιτήσεων για τη διαχείριση πόρων Azure.

Το πρώτο βήμα είναι να δημιουργήσετε μια εφαρμογή του Azure Active Directory. Συνδεθείτε με την [Πύλη κλασική Azure](http://manage.windowsazure.com/) χρησιμοποιώντας τη συνδρομή που περιέχει την παρουσία της υπηρεσίας διαχείρισης API και μεταβείτε στην καρτέλα **εφαρμογές** για το προεπιλεγμένο Azure Active Directory.

>[AZURE.NOTE] Εάν δεν είναι ορατή στο λογαριασμό σας του προεπιλεγμένου καταλόγου Azure Active Directory, επικοινωνήστε με το διαχειριστή της Azure συνδρομής για να εκχωρήσετε τα απαιτούμενα δικαιώματα για το λογαριασμό σας. Για πληροφορίες σχετικά με τον εντοπισμό προεπιλεγμένου καταλόγου, ανατρέξτε στο θέμα [Εντοπισμός προεπιλεγμένου καταλόγου](../virtual-machines/virtual-machines-windows-create-aad-work-id.md#locate-your-default-directory-in-the-azure-portal).

![Δημιουργία εφαρμογής υπηρεσίας καταλόγου Azure Active Directory][api-management-add-aad-application]

Κάντε κλικ στην επιλογή **Προσθήκη**, **Προσθήκη εφαρμογής ανάπτυξη εταιρεία μου**, και επιλέξτε **εφαρμογή εγγενές πρόγραμμα-πελάτη**. Πληκτρολογήστε ένα περιγραφικό όνομα και κάντε κλικ στο βέλος Επόμενο. Εισαγάγετε μια διεύθυνση URL κράτησης θέσης, όπως `http://resources` για την **Ανακατεύθυνση URI**, καθώς αυτό είναι απαιτούμενο πεδίο, αλλά η τιμή δεν χρησιμοποιείται αργότερα. Επιλέξτε το πλαίσιο ελέγχου για να αποθηκεύσετε την εφαρμογή.

Αφού αποθηκεύσετε την εφαρμογή, κάντε κλικ στην επιλογή **Ρύθμιση παραμέτρων**, κάντε κύλιση προς τα κάτω στην ενότητα **δικαιώματα σε άλλες εφαρμογές** και κάντε κλικ στην επιλογή **Προσθήκη εφαρμογής**.

![Προσθήκη δικαιωμάτων][api-management-aad-permissions-add]

Επιλέξτε **Windows** **Azure το API διαχείρισης της υπηρεσίας** και επιλέξτε το πλαίσιο ελέγχου για να προσθέσετε την εφαρμογή.

![Προσθήκη δικαιωμάτων][api-management-aad-permissions]

Κάντε κλικ στην επιλογή **Δικαιώματα πληρεξούσιοι** δίπλα από την εφαρμογή **Windows** **Azure το API διαχείρισης της υπηρεσίας** που προστέθηκε πρόσφατα, επιλέξτε το πλαίσιο ελέγχου για τη **Διαχείριση υπηρεσίας Azure Access (έκδοση preview)**και κάντε κλικ στην επιλογή **Αποθήκευση**.

![Προσθήκη δικαιωμάτων][api-management-aad-delegated-permissions]

Πριν από την κλήση τα API που δημιουργούν το αντίγραφο ασφαλείας και να την επαναφέρετε, είναι απαραίτητο για να λάβετε ένα διακριτικό. Το παρακάτω παράδειγμα χρησιμοποιεί το πακέτο nuget [Microsoft.IdentityModel.Clients.ActiveDirectory](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory) για να ανακτήσετε το διακριτικό.

    using Microsoft.IdentityModel.Clients.ActiveDirectory;
    using System;

    namespace GetTokenResourceManagerRequests
    {
        class Program
        {
            static void Main(string[] args)
            {
                var authenticationContext = new AuthenticationContext("https://login.windows.net/{tenant id}");
                var result = authenticationContext.AcquireToken("https://management.azure.com/", {application id}, new Uri({redirect uri});

                if (result == null) {
                    throw new InvalidOperationException("Failed to obtain the JWT token");
                }

                Console.WriteLine(result.AccessToken);

                Console.ReadLine();
            }
        }
    }

Αντικατάσταση `{tentand id}`, `{application id}`, και `{redirect uri}` χρησιμοποιώντας τις παρακάτω οδηγίες.

Αντικατάσταση `{tenant id}` με το αναγνωριστικό μισθωτή της εφαρμογής Azure Active Directory που μόλις δημιουργήσατε. Μπορείτε να αποκτήσετε πρόσβαση το αναγνωριστικό κάνοντας κλικ στην επιλογή **Προβολή τελικά σημεία**.

![Τα τελικά σημεία][api-management-aad-default-directory]

![Τα τελικά σημεία][api-management-endpoint]

Αντικατάσταση `{application id}` και `{redirect uri}` χρησιμοποιώντας το **Αναγνωριστικό υπολογιστή-πελάτη** και τη διεύθυνση URL από την ενότητα **Ανακατεύθυνση Uris** από την καρτέλα **Ρύθμιση παραμέτρων** της εφαρμογής σας Azure Active Directory. 

![Πόροι][api-management-aad-resources]

Αφού τις τιμές που έχουν καθοριστεί, το παράδειγμα κώδικα πρέπει να επιστρέψει ενός διακριτικού παρόμοιο με το παρακάτω παράδειγμα.

![Διακριτικού][api-management-arm-token]

Πριν από την κλήση τις λειτουργίες δημιουργίας αντιγράφων ασφαλείας και επαναφορά περιγράφεται στις παρακάτω ενότητες, ορίστε την κεφαλίδα αίτησης εξουσιοδότησης για την κλήση ΥΠΌΛΟΙΠΑ σας.

    request.Headers.Add(HttpRequestHeader.Authorization, "Bearer " + token);

## <a name="step1"> </a>Δημιουργία αντιγράφων ασφαλείας μιας υπηρεσίας API διαχείρισης
Για να δημιουργήσετε αντίγραφο ασφαλείας μιας API διαχείρισης υπηρεσίας ζητήματος την ακόλουθη αίτηση HTTP:

`POST https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.ApiManagement/service/{serviceName}/backup?api-version={api-version}`

όπου:

* `subscriptionId`-αναγνωριστικό της συνδρομής που περιέχει την υπηρεσία διαχείρισης API που προσπαθείτε να δημιουργίας αντιγράφων ασφαλείας
* `resourceGroupName`-μια συμβολοσειρά με τη μορφή 'Api - προεπιλογή-{υπηρεσία-περιοχή}' όπου `service-region` προσδιορίζει το Azure περιοχής όπου το API διαχείρισης υπηρεσίας που προσπαθείτε να φιλοξενείται αντίγραφο ασφαλείας, π.χ.`North-Central-US`
* `serviceName`-στο όνομα της υπηρεσίας διαχείρισης API κάνετε ένα αντίγραφο ασφαλείας της καθοριστεί κάθε φορά που δημιουργήθηκε
* `api-version`-Αντικατάσταση με`2014-02-14`

Στο σώμα της πρόσκλησης σε, καθορίστε το όνομα λογαριασμού Azure αποθήκευσης προορισμού, πλήκτρο πρόσβασης, το όνομα του κοντέινερ αντικειμένων blob και όνομα αντιγράφου ασφαλείας:

    '{  
        storageAccount : {storage account name for the backup},  
        accessKey : {access key for the account},  
        containerName : {backup container name},  
        backupName : {backup blob name}  
    }'

Ορισμός της τιμής του `Content-Type` κεφαλίδα αίτησης για να `application/json`.

Δημιουργία αντιγράφου ασφαλείας είναι μια λειτουργία μεγάλης διάρκειας που μπορεί να χρειαστούν πολλές λεπτά για να ολοκληρωθεί.  Εάν η πρόσκληση σε ολοκληρώθηκε με επιτυχία και έχει ξεκινήσει η διαδικασία δημιουργίας αντιγράφων ασφαλείας θα λάβετε μια `202 Accepted` κωδικός κατάστασης απόκρισης με ένα `Location` κεφαλίδα.  Πραγματοποίηση 'GET' αιτήσεις για τη διεύθυνση URL στο το `Location` κεφαλίδας για να βρείτε την κατάσταση της λειτουργίας. Ενώ το αντίγραφο ασφαλείας βρίσκεται σε εξέλιξη θα συνεχίσετε να λαμβάνετε έναν κωδικό κατάστασης '202 αποδεκτοί'. Ένας κωδικός απόκρισης του `200 OK` θα υποδηλώνουν επιτυχή ολοκλήρωση της λειτουργίας δημιουργίας αντιγράφων ασφαλείας.

**Σημείωση**:

- **Κοντέινερ** που καθορίζεται στο σώμα αίτησης, **πρέπει να υπάρχει**.
* Ενώ αντίγραφο ασφαλείας βρίσκεται σε εξέλιξη **δεν πρέπει να προσπαθήσετε οποιαδήποτε υπηρεσία λειτουργίες διαχείρισης** όπως SKU αναβάθμιση ή να υποβιβάσετε, αλλαγή του ονόματος τομέα, κ.λπ. 
* Επαναφορά από ένα **αντίγραφο ασφαλείας είναι εγγυημένη μόνο για διάστημα 7 ημερών** από τη στιγμή της τη δημιουργία του. 
* **Χρήση δεδομένων** που χρησιμοποιούνται για τη δημιουργία αναλυτικών στοιχείων αναφορών **δεν περιλαμβάνονται** στο αντίγραφο ασφαλείας. Χρησιμοποιήστε [Azure API διαχείρισης REST API][] για να ανακτήσετε περιοδικά αναφορές ανάλυσης για προστασία.
* Τη συχνότητα με την οποία μπορείτε να εκτελέσετε υπηρεσίας δημιουργίας αντιγράφων ασφαλείας θα επηρεάσει το στόχο σημείου αποκατάστασης. Για να ελαχιστοποιήσετε το σας συμβουλεύουμε εφαρμογής τακτικής δημιουργίας αντιγράφων ασφαλείας, καθώς και εκτέλεση αντίγραφα ασφαλείας σε ζήτηση αφού κάνετε τις σημαντικές αλλαγές στην υπηρεσία σας API διαχείρισης.
* **Αλλαγές** που γίνονται στη ρύθμιση παραμέτρων υπηρεσιών (π.χ., APIs, πολιτικές, εμφάνιση πύλης για προγραμματιστές) κατά τη λειτουργία δημιουργίας αντιγράφων ασφαλείας είναι σε διαδικασία **δεν θα συμπεριληφθούν στο αντίγραφο ασφαλείας και, επομένως, θα χαθούν**.

## <a name="step2"> </a>Επαναφορά μιας υπηρεσίας API διαχείρισης
Για να επαναφέρετε ένα API διαχείρισης υπηρεσίας από ένα αντίγραφο ασφαλείας που δημιουργήσατε προηγουμένως κάνετε την ακόλουθη αίτηση HTTP:

`POST https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.ApiManagement/service/{serviceName}/restore?api-version={api-version}`

όπου:

* `subscriptionId`-αναγνωριστικό της συνδρομής που περιέχει την υπηρεσία API διαχείρισης που θέλετε να επαναφέρετε ένα αντίγραφο ασφαλείας σε
* `resourceGroupName`-μια συμβολοσειρά με τη μορφή 'Api - προεπιλογή-{υπηρεσία-περιοχή}' όπου `service-region` προσδιορίζει το Azure περιοχής όπου φιλοξενείται στην υπηρεσία API διαχείρισης που θέλετε να επαναφέρετε ένα αντίγραφο ασφαλείας σε, π.χ.`North-Central-US`
* `serviceName`-στο όνομα της υπηρεσίας που επαναφέρεται σε καθοριστεί κάθε φορά που δημιουργήθηκε API διαχείρισης
* `api-version`-Αντικατάσταση με`2014-02-14`

Στο σώμα της πρόσκλησης σε, καθορίστε τη θέση του αρχείου αντιγράφου ασφαλείας, δηλαδή όνομα λογαριασμού Azure χώρου αποθήκευσης, πλήκτρο πρόσβασης, το όνομα του κοντέινερ αντικειμένων blob και όνομα αντιγράφου ασφαλείας:

    '{  
        storageAccount : {storage account name for the backup},  
        accessKey : {access key for the account},  
        containerName : {backup container name},  
        backupName : {backup blob name}  
    }'

Ορισμός της τιμής του `Content-Type` κεφαλίδα αίτησης για να `application/json`.

Η επαναφορά είναι μια λειτουργία μεγάλης διάρκειας που ενδέχεται να χρειαστεί έως 30 ή περισσότερα λεπτά για να ολοκληρωθεί.  Εάν η πρόσκληση σε ολοκληρώθηκε με επιτυχία και έχει ξεκινήσει η διαδικασία επαναφοράς θα λάβετε μια `202 Accepted` κωδικός κατάστασης απόκρισης με ένα `Location` κεφαλίδα.  Πραγματοποίηση 'GET' αιτήσεις για τη διεύθυνση URL στο το `Location` κεφαλίδας για να βρείτε την κατάσταση της λειτουργίας. Ενώ η επαναφορά βρίσκεται σε εξέλιξη θα εξακολουθείτε να λαμβάνετε '202 αποδεκτοί' Κωδικός κατάστασης. Ένας κωδικός απόκρισης του `200 OK` θα υποδηλώνουν επιτυχή ολοκλήρωση της λειτουργίας επαναφοράς.

>[AZURE.IMPORTANT] **Το SKU** η υπηρεσία στην οποία επαναφορά σε **πρέπει να συμφωνεί με** την SKU της υπηρεσίας αντίγραφα ασφαλείας των πραγματοποιείται επαναφορά.
>
>**Αλλαγές** που γίνονται στη ρύθμιση παραμέτρων υπηρεσιών (π.χ., APIs, πολιτικές, εμφάνιση πύλης για προγραμματιστές) κατά τη διαδικασία επαναφοράς είναι σε εξέλιξη **θα μπορούσε να είναι δυνατή η αντικατάστασή**.

## <a name="next-steps"></a>Επόμενα βήματα
Δείτε το εξής ιστολόγια της Microsoft για δύο διαφορετικές αναλυτικές η διαδικασία δημιουργίας αντιγράφων ασφαλείας/επαναφοράς.

-   [Αναπαραγωγή Azure API διαχείρισης λογαριασμών](https://www.returngis.net/en/2015/06/replicate-azure-api-management-accounts/) 
    -   Σας ευχαριστούμε που να Gisela της συμμετοχής σε αυτό το άρθρο.
-   [Διαχείριση Azure API: Δημιουργία αντιγράφων ασφαλείας και επαναφορά ρύθμισης παραμέτρων](http://blogs.msdn.com/b/stuartleeks/archive/2015/04/29/azure-api-management-backing-up-and-restoring-configuration.aspx)
    -   Η προσέγγιση λεπτομερείς από Stuart δεν ταιριάζουν με την επίσημη καθοδήγηση, αλλά είναι πολύ ενδιαφέρον.

[Backup an API Management service]: #step1
[Restore an API Management service]: #step2


[Azure API διαχείρισης REST API]: http://msdn.microsoft.com/library/azure/dn781421.aspx

[api-management-add-aad-application]: ./media/api-management-howto-disaster-recovery-backup-restore/api-management-add-aad-application.png

[api-management-aad-permissions]: ./media/api-management-howto-disaster-recovery-backup-restore/api-management-aad-permissions.png
[api-management-aad-permissions-add]: ./media/api-management-howto-disaster-recovery-backup-restore/api-management-aad-permissions-add.png
[api-management-aad-delegated-permissions]: ./media/api-management-howto-disaster-recovery-backup-restore/api-management-aad-delegated-permissions.png
[api-management-aad-default-directory]: ./media/api-management-howto-disaster-recovery-backup-restore/api-management-aad-default-directory.png
[api-management-aad-resources]: ./media/api-management-howto-disaster-recovery-backup-restore/api-management-aad-resources.png
[api-management-arm-token]: ./media/api-management-howto-disaster-recovery-backup-restore/api-management-arm-token.png
[api-management-endpoint]: ./media/api-management-howto-disaster-recovery-backup-restore/api-management-endpoint.png
 
