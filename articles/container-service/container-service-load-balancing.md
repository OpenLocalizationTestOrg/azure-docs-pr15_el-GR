<properties
   pageTitle="Φόρτωση του κοντέινερ υπολοίπου σε ένα σύμπλεγμα Azure κοντέινερ υπηρεσίας | Microsoft Azure"
   description="Εξισορρόπηση του φόρτου σε πολλές κοντέινερ σε ένα σύμπλεγμα Azure κοντέινερ υπηρεσίας."
   services="container-service"
   documentationCenter=""
   authors="rgardler"
   manager="timlt"
   editor=""
   tags="acs, azure-container-service"
   keywords="Κοντέινερ, μικρής κλίμακας-υπηρεσίες, ελεγκτή Τομέα/λειτουργικό σύστημα, Azure"/>

<tags
   ms.service="container-service"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="07/11/2016"
   ms.author="rogardle"/>

# <a name="load-balance-containers-in-an-azure-container-service-cluster"></a>Κοντέινερ εξισορρόπηση φόρτου σε ένα σύμπλεγμα Azure κοντέινερ υπηρεσίας

Σε αυτό το άρθρο, θα εξερευνήσουμε πώς μπορείτε να δημιουργήσετε μια εσωτερική εξισορρόπηση φόρτου σε μια υπηρεσία κοντέινερ Azure χρησιμοποιώντας Marathon Λίβρες διαχειριζόμενων ένα κέντρο Δεδομένων/λειτουργικό σύστημα. Αυτό θα σας επιτρέψει για να κλιμακωθεί οριζόντια τις εφαρμογές σας. Αυτό θα επιτρέπουν επίσης να επωφεληθείτε από τον παράγοντα δημόσια και ιδιωτικά συμπλεγμάτων τοποθετώντας το balancers φόρτωση σε δημόσια σύμπλεγμα και τους χώρους εφαρμογή στο ιδιωτικό σύμπλεγμα.

## <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

[Ανάπτυξη μιας παρουσίας της υπηρεσίας κοντέινερ Azure](container-service-deployment.md) με τον τύπο orchestrator ελεγκτή Τομέα/λειτουργικό σύστημα και [Βεβαιωθείτε ότι το πρόγραμμα-πελάτη να συνδεθείτε με το σύμπλεγμά σας](container-service-connect.md). 

## <a name="load-balancing"></a>Εξισορρόπηση φόρτου

Υπάρχουν δύο επίπεδα εξισορρόπησης φόρτου του κοντέινερ υπηρεσιών συμπλέγματος θα μπορέσουμε να δημιουργήσουμε: 

  1. Azure εξισορρόπηση φόρτου παρέχει σημεία εισόδου δημόσια (αυτά που θα πατήσετε τελικούς χρήστες). Αυτό παρέχεται αυτόματα από υπηρεσία κοντέινερ Azure και είναι, από προεπιλογή, έχει ρυθμιστεί για την έκθεση θύρες 80 και 443 8080.
  2. Η εξισορρόπηση φόρτου Marathon (marathon-λίβρες) δρομολογεί εισερχόμενες αιτήσεις παρουσίες κοντέινερ που αυτές τις αιτήσεις εξυπηρέτησης. Όπως θα σας περιορίσετε το μέγεθος του κοντέινερ παρέχοντας μας υπηρεσίας web, marathon λίβρες δυναμικά προσαρμόζεται. Αυτό εξισορρόπηση φόρτου δεν παρέχεται από προεπιλογή στην υπηρεσία κοντέινερ, αλλά είναι πολύ εύκολη για την εγκατάσταση.

## <a name="marathon-load-balancer"></a>Marathon εξισορρόπηση φόρτου

Εξισορρόπηση φόρτου Marathon δυναμικά ρυθμίζει τις παραμέτρους ίδιο με βάση τα κοντέινερ που που έχετε αναπτύξει. Επίσης, είναι είναι ανθεκτικά στις την απώλεια ένα κοντέινερ ή παράγοντας - Εάν συμβαίνει αυτό, Apache Mesos απλώς θα γίνει επανεκκίνηση σε κάποιο άλλο σημείο στο κοντέινερ και θα προσαρμόσετε marathon λίβρες.

Για να εγκαταστήσετε τη μονάδα εξισορρόπησης φόρτου Marathon, μπορείτε να χρησιμοποιήσετε από το Κέντρο Δεδομένων/λειτουργικό σύστημα web περιβάλλοντος εργασίας Χρήστη ή τη γραμμή εντολών.

### <a name="install-marathon-lb-using-dcos-web-ui"></a>Εγκατάσταση Marathon Λίβρες χρησιμοποιώντας περιβάλλον εργασίας Χρήστη του ελεγκτή Τομέα/OS Web

  1. Κάντε κλικ στο κουμπί 'Universe'
  2. Αναζήτηση για 'Marathon-Λίβρες'
  3. Κάντε κλικ στην επιλογή "Εγκατάσταση"

![Κατά την εγκατάσταση marathon-λίβρες μέσω του περιβάλλοντος εργασίας Web ελεγκτή Τομέα/λειτουργικό σύστημα](./media/dcos/marathon-lb-install.png)

### <a name="install-marathon-lb-using-the-dcos-cli"></a>Εγκατάσταση Marathon-Λίβρες χρησιμοποιώντας το CLI ελεγκτή Τομέα/λειτουργικό σύστημα

Μετά την εγκατάσταση του ελεγκτή Τομέα/OS CLI και ταυτόχρονα εξασφαλίζετε ότι μπορείτε να συνδεθείτε με το σύμπλεγμά σας, εκτελέστε την ακόλουθη εντολή από τον υπολογιστή-πελάτη:

```bash
dcos package install marathon-lb
```

Αυτή η εντολή εγκαθιστά αυτόματα τη μονάδα εξισορρόπησης φόρτου στο σύμπλεγμα δημόσια παραγόντων.

## <a name="deploy-a-load-balanced-web-application"></a>Ανάπτυξη μιας φόρτωσης εξισορρόπηση εφαρμογής Web

Τώρα που έχουμε το πακέτο marathon λίβρες, θα σας να αναπτύξετε μια εφαρμογή του κοντέινερ που Ευχόμαστε οι να εξισορροπήσετε το φόρτο. Για αυτό το παράδειγμα θα σας θα αναπτύξετε σε διακομιστή web απλό χρησιμοποιώντας τις παρακάτω ρυθμίσεις:

```json
{
  "id": "web",
  "container": {
    "type": "DOCKER",
    "docker": {
      "image": "yeasy/simple-web",
      "network": "BRIDGE",
      "portMappings": [
        { "hostPort": 0, "containerPort": 80, "servicePort": 10000 }
      ],
      "forcePullImage":true
    }
  },
  "instances": 3,
  "cpus": 0.1,
  "mem": 65,
  "healthChecks": [{
      "protocol": "HTTP",
      "path": "/",
      "portIndex": 0,
      "timeoutSeconds": 10,
      "gracePeriodSeconds": 10,
      "intervalSeconds": 2,
      "maxConsecutiveFailures": 10
  }],
  "labels":{
    "HAPROXY_GROUP":"external",
    "HAPROXY_0_VHOST":"YOUR FQDN",
    "HAPROXY_0_MODE":"http"
  }
}

```

  * Ορίστε την τιμή της `HAProxy_0_VHOST` προς το FQDN του τη μονάδα εξισορρόπησης φόρτου για σας παράγοντες. Αυτό είναι στη φόρμα `<acsName>agents.<region>.cloudapp.azure.com`. Για παράδειγμα, εάν δημιουργήσετε ένα σύμπλεγμα κοντέινερ υπηρεσίας με το όνομα `myacs` στην περιοχή `West US`, θα ήταν το FQDN `myacsagents.westus.cloudapp.azure.com`. Μπορείτε επίσης να βρείτε αυτό αναζητώντας την εξισορρόπηση φόρτου με "παράγοντας" στο όνομά της, όταν αναζητάτε μέσω τους πόρους στην ομάδα πόρων που δημιουργήσατε για την υπηρεσία κοντέινερ στην [πύλη του Azure](https://portal.azure.com).
  * Ορίστε το servicePort σε μια θύρα > = 10.000. Αυτό προσδιορίζει την υπηρεσία που εκτελείται σε αυτό το κοντέινερ--marathon λίβρες χρησιμοποιεί αυτό να εντοπίζετε τις υπηρεσίες που αυτό θα πρέπει να εξισορροπήσετε σε.
  * Ορίστε το `HAPROXY_GROUP` ετικέτας σε "εξωτερική".
  * Ορισμός `hostPort` σε 0. Αυτό σημαίνει ότι Marathon αυθαίρετα θα εκχωρήσει μια διαθέσιμη θύρας.
  * Ορισμός `instances` στον αριθμό των παρουσιών που θέλετε να δημιουργήσετε. Μπορείτε να πάντα κλιμάκωση αυτά προς τα επάνω ή προς τα κάτω αργότερα.

Αξίζει noing ότι από προεπιλογή θα αναπτύξετε Marathon στο σύμπλεγμα ιδιωτικό, αυτό σημαίνει ότι το παραπάνω ανάπτυξης θα είναι προσβάσιμα μέσω του εξισορρόπηση φόρτου, που είναι συνήθως η συμπεριφορά που θα σας επιθυμούν.

### <a name="deploy-using-the-dcos-web-ui"></a>Ανάπτυξη χρησιμοποιώντας το περιβάλλον εργασίας Χρήστη του ελεγκτή Τομέα/OS Web

  1. Επισκεφθείτε τη σελίδα Marathon στο http://localhost/marathon (μετά τη ρύθμιση του [σωλήνα SSH](container-service-connect.md) και κάντε κλικ στην επιλογή`Create Appliction`
  2. Στο το `New Application` διαλόγου κάντε κλικ στην επιλογή `JSON Mode` στην επάνω δεξιά γωνία
  3. Επικολλήστε τα παραπάνω JSON στο πρόγραμμα επεξεργασίας
  4. Κάντε κλικ στην επιλογή`Create Appliction`

### <a name="deploy-using-the-dcos-cli"></a>Ανάπτυξη χρησιμοποιώντας το CLI ελεγκτή Τομέα/λειτουργικό σύστημα

Για να αναπτύξετε αυτήν την εφαρμογή με το Κέντρο Δεδομένων/OS CLI απλώς να αντιγράψετε τα παραπάνω JSON σε ένα αρχείο που ονομάζεται `hello-web.json`, και να εκτελέσετε:

```bash
dcos marathon app add hello-web.json
```

## <a name="azure-load-balancer"></a>Azure εξισορρόπηση φόρτου

Από προεπιλογή, Azure εξισορρόπηση φόρτου εκθέτει θύρες 80 8080 και 443. Εάν χρησιμοποιείτε ένα από αυτά τα τρία θύρες (όπως κάνουμε στο παραπάνω παράδειγμα) και, στη συνέχεια, δεν υπάρχει τίποτα που πρέπει να κάνετε. Θα πρέπει να μπορείτε να το πετύχετε τον παράγοντα εξισορρόπηση φόρτου FQDN--και κάθε φορά που κάνετε ανανέωση, θα πατήσετε ένα διακομιστές τρεις web με τον τρόπο round robin. Ωστόσο, εάν χρησιμοποιείτε μια διαφορετική θύρα, πρέπει να προσθέσετε έναν κανόνα round robin και μια δοκιμή του στην τη μονάδα εξισορρόπησης φόρτου για τη θύρα που χρησιμοποιήσατε. Μπορείτε να το κάνετε από το [Azure CLI](../xplat-cli-azure-resource-manager.md), με τις εντολές `azure network lb rule create` και `azure network lb probe create`. Μπορείτε επίσης να κάνετε αυτό με την πύλη Azure.


## <a name="additional-scenarios"></a>Πρόσθετα σενάρια

Μπορείτε να έχετε ένα σενάριο όπου μπορείτε να χρησιμοποιήσετε διαφορετικούς τομείς για την έκθεση διαφορετικές υπηρεσίες. Για παράδειγμα:

mydomain1.com -> Azure LB:80 -> marathon-lb:10001 -> mycontainer1:33292  
mydomain2.com -> Azure LB:80 -> marathon-lb:10002 -> mycontainer2:22321

Για να επιτύχετε αυτό, ανατρέξτε στο θέμα [hosts εικονική](https://mesosphere.com/blog/2015/12/04/dcos-marathon-lb/), που παρέχει κάποιο τρόπο για να συσχετίσετε τομείς σε συγκεκριμένες marathon-λίβρες διαδρομές.

Εναλλακτικά, μπορείτε να εκθέσετε διαφορετικές θύρες και να αντιστοιχίσετε ξανά τις σωστές υπηρεσία πίσω από marathon λίβρες. Για παράδειγμα:

Azure lb:80 -> marathon-lb:10001 -> mycontainer:233423  
Azure lb:8080 -> marathon-lb:1002 -> mycontainer2:33432


## <a name="next-steps"></a>Επόμενα βήματα

Ανατρέξτε στην τεκμηρίωση του ελεγκτή Τομέα/λειτουργικό σύστημα για περισσότερες ενεργοποίηση [marathon λίβρες](https://dcos.io/docs/1.7/usage/service-discovery/marathon-lb/).
