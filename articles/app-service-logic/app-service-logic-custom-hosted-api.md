<properties
    pageTitle="Κλήση μιας προσαρμοσμένης API σε εφαρμογές της λογικής"
    description="Με χρήση του προσαρμοσμένου API φιλοξενούνται σε εφαρμογής υπηρεσίας με λογική εφαρμογές"
    authors="stepsic-microsoft-com"
    manager="dwrede"
    editor=""
    services="logic-apps"
    documentationCenter=""/>

<tags
    ms.service="logic-apps"
    ms.workload="integration"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="05/31/2016"
    ms.author="stepsic"/>

# <a name="using-your-custom-api-hosted-on-app-service-with-logic-apps"></a>Με χρήση του προσαρμοσμένου API φιλοξενούνται σε εφαρμογής υπηρεσίας με λογική εφαρμογές

Παρόλο που η λογική εφαρμογές έχει μια σειρά από 40 + συνδέσεις για διάφορες υπηρεσίες, που μπορεί να θέλετε να καλέσετε στο δικό σας προσαρμοσμένο API που μπορεί να εκτελέσει το δικό σας κώδικα. Ένας από τους τρόπους πιο εύκολη και πιο μεταβλητού μεγέθους για να φιλοξενήσετε το δικό σας προσαρμοσμένο του API web είναι να χρησιμοποιήσετε εφαρμογής υπηρεσίας. Σε αυτό το άρθρο περιγράφει πώς μπορείτε να την κλήση σε οποιαδήποτε τοποθεσία web API φιλοξενούνται σε εφαρμογή το API της εφαρμογής υπηρεσίας, εφαρμογή web ή εφαρμογή για κινητές συσκευές.

Για πληροφορίες σχετικά με τη δημιουργία APIs ως έναυσμα ή ενέργεια μέσα σε λογική εφαρμογών, ανατρέξτε στο θέμα [σε αυτό το άρθρο](app-service-logic-create-api-app.md).

## <a name="deploy-your-web-app"></a>Αναπτύξτε τη εφαρμογή Web

Πρώτα, θα χρειαστεί να αναπτύξετε το API ως μια εφαρμογή Web στην εφαρμογή υπηρεσίας. Οι οδηγίες εδώ καλύπτουν βασικές ανάπτυξης: [Δημιουργία εφαρμογής web ASP.NET](../app-service-web/web-sites-dotnet-get-started.md).  Ενώ μπορείτε να καλέσετε σε οποιαδήποτε API από μια εφαρμογή λογικής, για βέλτιστη εμπειρία συνιστούμε να προσθέτετε Swagger μετα-δεδομένων για να ενσωματώσετε εύκολα με λογική εφαρμογές ενέργειες.  Μπορείτε να βρείτε λεπτομέρειες σχετικά με την [Προσθήκη swagger](../app-service-api/app-service-api-dotnet-get-started.md#use-swagger-api-metadata-and-ui).

### <a name="api-settings"></a>Ρυθμίσεις API

Με τη σειρά για τη σχεδίαση εφαρμογών λογική ανάλυση Swagger σας, είναι σημαντικό Ενεργοποίηση CORS και να ορίσετε τις ιδιότητες APIDefinition της εφαρμογής web.  Αυτό είναι πολύ εύκολη για να ορίσετε εντός της πύλης Azure.  Απλώς ανοίξτε το blade ρυθμίσεων της εφαρμογής Web, και κάτω από την ενότητα API Ορισμός το "API' στη διεύθυνση URL του αρχείου σας swagger.json (αυτό είναι συνήθως https://{name}.azurewebsites.net/swagger/docs/v1), και προσθέστε μια πολιτική CORS για ' *' για να επιτρέψετε για αιτήσεις από τις εφαρμογές λογικής σχεδίασης.

## <a name="calling-into-the-api"></a>Κλήση σε το API

Όταν εντός της πύλης εφαρμογές λογικής, εάν έχετε ορίσει CORS και τις ιδιότητες του ορισμού API θα πρέπει να μπορούν να εύκολα προσθέστε API προσαρμοσμένες ενέργειες εντός του ροής.  Στη "Σχεδίαση", μπορείτε να επιλέξετε για να αναζητήσετε τις τοποθεσίες Web συνδρομή για μια λίστα των τοποθεσιών Web με μια καθορισμένη διεύθυνση URL swagger.  Μπορείτε επίσης να χρησιμοποιήσετε το HTTP + Swagger ενέργεια για να τοποθετήστε το δείκτη σε ένα swagger και λίστα διαθέσιμων ενεργειών και εισροές.  Τέλος, μπορείτε πάντα να δημιουργήσετε μια αίτηση χρησιμοποιώντας την ενέργεια HTTP για να καλέσετε οποιαδήποτε API, ακόμα και εκείνα που δεν έχουν ή εκθέτουν ένα έγγραφο swagger.

Εάν θέλετε για την ασφάλιση του API, στη συνέχεια, υπάρχουν μερικά διαφορετικούς τρόπους για να το κάνετε:

1. Χωρίς αλλαγή κώδικα απαιτείται - Azure Active Directory μπορεί να χρησιμοποιηθεί για την προστασία σας API χωρίς να απαιτείται τυχόν αλλαγές κώδικα ή επανάληψη ανάπτυξης.
1. Επιβολή βασικού Auth, AAD Auth ή πιστοποιητικό ελέγχου ταυτότητας στον κώδικα της το API.

## <a name="securing-calls-to-your-api-without-a-code-change"></a>Ασφάλεια των κλήσεων για το API χωρίς αλλαγή κώδικα

Σε αυτήν την ενότητα, θα δημιουργήσετε δύο Azure Active Directory εφαρμογές – ένα για την εφαρμογή σας λογικής και ένα για την εφαρμογή Web.  Θα τον έλεγχο ταυτότητας κλήσεις σε εφαρμογή Web με χρήση του αρχικού υπηρεσίας (αναγνωριστικό υπολογιστή-πελάτη και μυστικό) που σχετίζεται με την εφαρμογή AAD για την εφαρμογή σας λογική. Τέλος, θα μπορείτε να συμπεριλάβετε την εφαρμογή ταυτότητας στον ορισμό σας λογικής της εφαρμογής.

### <a name="part-1-setting-up-an-application-identity-for-your-logic-app"></a>Μέρος 1: Ρύθμιση ταυτότητα εφαρμογής για την εφαρμογή σας λογικής

Αυτό είναι τι που χρησιμοποιεί την εφαρμογή λογική για τον έλεγχο ταυτότητας σε σχέση με την υπηρεσία καταλόγου active directory. Μόνο *πρέπει* να το κάνετε αυτό μία φορά για τον κατάλογο. Για παράδειγμα, μπορείτε να επιλέξετε να χρησιμοποιήσετε την ίδια ταυτότητα για όλες τις εφαρμογές σας λογικής, παρόλο που μπορείτε επίσης να δημιουργήσετε μοναδικών αναγνωριστικών ανά εφαρμογή λογικής εάν θέλετε. Μπορείτε να κάνετε αυτό το περιβάλλον εργασίας χρήστη ή να χρήση του PowerShell.

#### <a name="create-the-application-identity-using-the-azure-classic-portal"></a>Δημιουργία η ταυτότητα της εφαρμογής με την πύλη Azure κλασική

1. Μεταβείτε [στην πύλη του Azure κλασική υπηρεσίας καταλόγου Active directory](https://manage.windowsazure.com/#Workspaces/ActiveDirectoryExtension/directory) και επιλέξτε τον κατάλογο που χρησιμοποιείτε για την εφαρμογή Web
2. Κάντε κλικ στην καρτέλα **εφαρμογές**
3. Κάντε κλικ στην επιλογή **Προσθήκη** στη γραμμή εντολών στο κάτω μέρος της σελίδας
4. Δώστε ένα όνομα για να χρησιμοποιήσετε, κάντε κλικ στο βέλος επόμενη την ταυτότητά σας
5. Τοποθετήστε σε μια μοναδική συμβολοσειρά που μορφοποιούνται ως έναν τομέα στο τα δύο πλαίσια κειμένου και επιλέξτε το σημάδι ελέγχου
6. Κάντε κλικ στην καρτέλα **Ρύθμιση παραμέτρων** για αυτήν την εφαρμογή
7. Αντιγράψτε το **Αναγνωριστικό υπολογιστή-πελάτη**, θα χρησιμοποιηθεί σε εφαρμογή της λογικής
8. Στην ενότητα **πλήκτρα** , κάντε κλικ στην **επιλογή διάρκεια** και επιλέξτε έτος 1 ή 2 έτη
9. Κάντε κλικ στο κουμπί **Αποθήκευση** στο κάτω μέρος της οθόνης (ίσως χρειαστεί να περιμένετε μερικά δευτερόλεπτα)
10. Τώρα θα πρέπει να αντιγράψετε τον αριθμό-κλειδί στο πλαίσιο. Αυτό θα χρησιμοποιείται επίσης στην εφαρμογή λογικής

#### <a name="create-the-application-identity-using-powershell"></a>Δημιουργία της ταυτότητας εφαρμογών με χρήση του PowerShell
1. `Switch-AzureMode AzureResourceManager`
2. `Add-AzureAccount`
3. `New-AzureADApplication -DisplayName "MyLogicAppID" -HomePage "http://someranddomain.tld" -IdentifierUris "http://someranddomain.tld" -Password "Pass@word1!"`
4. Φροντίστε να αντιγράψετε το **Αναγνωριστικό μισθωτή**, το **Αναγνωριστικό εφαρμογής** και τον κωδικό πρόσβασης που χρησιμοποιήσατε

### <a name="part-2-protect-your-web-app-with-an-aad-app-identity"></a>Μέρος 2: Προστασία του Web App με μια ταυτότητα εφαρμογής AAD

Εάν έχετε ήδη αναπτύξει το την εφαρμογή Web της απλώς μπορείτε να την ενεργοποιήσετε στην πύλη. Διαφορετικά, μπορείτε να κάνετε ενεργοποίηση της εξουσιοδότησης μέρος του την ανάπτυξη manager Azure πόρων.

#### <a name="enable-authorization-in-the-azure-portal"></a>Ενεργοποίηση της εξουσιοδότησης στην πύλη του Azure

1. Μεταβείτε στην εφαρμογή Web και κάντε κλικ στις **Ρυθμίσεις** στη γραμμή εντολών.
2. Κάντε κλικ στην επιλογή **Εξουσιοδότησης/ελέγχου ταυτότητας**.
3. **Ενεργοποίηση.**

Σε αυτό το σημείο, μια εφαρμογή δημιουργείται αυτόματα για εσάς. Χρειάζεστε Αναγνωριστικό υπολογιστή-πελάτη του αυτής της εφαρμογής για το τμήμα 3, έτσι θα πρέπει να:

1. Μεταβείτε στην [υπηρεσία καταλόγου Active directory στην πύλη του Azure κλασική](https://manage.windowsazure.com/#Workspaces/ActiveDirectoryExtension/directory) και επιλέξτε τον κατάλογο.
2. Αναζήτηση για την εφαρμογή στο πλαίσιο αναζήτησης
3. Κάντε κλικ επάνω της στη λίστα
4. Κάντε κλικ στην καρτέλα **Ρύθμιση παραμέτρων**
5. Θα πρέπει να δείτε το **Αναγνωριστικό υπολογιστή-πελάτη**

#### <a name="deploying-your-web-app-using-an-arm-template"></a>Για την ανάπτυξη του Web App χρησιμοποιώντας ένα πρότυπο ARM

Αρχικά, πρέπει να δημιουργήσετε μια εφαρμογή για την εφαρμογή Web σας. Αυτό πρέπει να είναι διαφορετική από την εφαρμογή που χρησιμοποιείται για την εφαρμογή σας λογική. Ξεκινήστε κάνοντας ακολουθώντας τα παρακάτω βήματα παραπάνω στο μέρος 1, αλλά τώρα για την **κεντρική σελίδα** και **IdentifierUris** χρήση το πραγματικό https://**διεύθυνση URL** της εφαρμογής Web.

>[AZURE.NOTE]Κατά τη δημιουργία της εφαρμογής για την εφαρμογή Web σας, πρέπει να χρησιμοποιήσετε το [Azure κλασική πύλης προσέγγιση](https://manage.windowsazure.com/#Workspaces/ActiveDirectoryExtension/directory), όπως τα commandlet του PowerShell δεν έχετε ορίσει τα απαραίτητα δικαιώματα για να πραγματοποιήσετε τους χρήστες σε μια τοποθεσία Web.

Αφού το πρόγραμμα-πελάτη Αναγνωριστικό και Αναγνωριστικό μισθωτή, περιλαμβάνουν τα ακόλουθα ως πόρο sub του Web app στο πρότυπό σας ανάπτυξη:

```
"resources" : [
    {
        "apiVersion" : "2015-08-01",
        "name" : "web",
        "type" : "config",
        "dependsOn" : [
            "[concat('Microsoft.Web/sites/','parameters('webAppName'))]"
        ],
        "properties" : {
            "siteAuthEnabled": true,
            "siteAuthSettings": {
              "clientId": "<<clientID>>",
              "issuer": "https://sts.windows.net/<<tenantID>>/",
            }
        }
    }
]
```

Για να εκτελέσετε μια ανάπτυξη αυτόματα που αναπτύσσει μια κενή εφαρμογή Web και λογική εφαρμογής μαζί που χρησιμοποιούν AAD, κάντε κλικ στο κουμπί παρακάτω:

[![Ανάπτυξη Azure](./media/app-service-logic-custom-hosted-api/deploybutton.png)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2F201-logic-app-custom-api%2Fazuredeploy.json)

Για την πλήρη πρότυπο, ανατρέξτε στο θέμα [κλήσεις εφαρμογή λογικής σε ένα προσαρμοσμένο API φιλοξενούνται σε εφαρμογής υπηρεσίας και προστατεύονται από AAD](https://github.com/Azure/azure-quickstart-templates/blob/master/201-logic-app-custom-api/azuredeploy.json).


### <a name="part-3-populate-the-authorization-section-in-the-logic-app"></a>Μέρος 3: Συμπλήρωση στην ενότητα εξουσιοδότηση στην εφαρμογή λογικής

Στην ενότητα **εξουσιοδότηση** της ενέργειας **HTTP** :`{"tenant":"<<tenantId>>", "audience":"<<clientID from Part 2>>", "clientId":"<<clientID from Part 1>>","secret": "<<Password or Key from Part 1>>","type":"ActiveDirectoryOAuth" }`

| Στοιχείο | Περιγραφή |
|---------|-------------|
| Τύπος | Τύπος ελέγχου ταυτότητας. Για τον έλεγχο ταυτότητας ActiveDirectoryOAuth, η τιμή είναι ActiveDirectoryOAuth. |
| μισθωτή | Το αναγνωριστικό μισθωτή που χρησιμοποιούνται για τον προσδιορισμό του μισθωτή AD. |
| ακροατηρίου | Απαιτείται. Ο πόρος που πρόκειται να συνδεθείτε με. |
| clientID | Το αναγνωριστικό υπολογιστή-πελάτη για την εφαρμογή Azure AD. |
| μυστικό | Απαιτείται. Μυστικό του προγράμματος-πελάτη που ζητά το διακριτικό. |

Το παραπάνω πρότυπο έχει ήδη αυτό ρύθμιση, αλλά Εάν συντάσσετε την εφαρμογή λογικής απευθείας, θα πρέπει να συμπεριλάβετε στην ενότητα πλήρη άδεια.

## <a name="securing-your-api-in-code"></a>Ασφάλιση του API στον κώδικα

### <a name="certificate-auth"></a>Πιστοποιητικό ελέγχου ταυτότητας

Μπορείτε να χρησιμοποιήσετε πιστοποιητικά προγράμματος-πελάτη για να επικυρώσει τα εισερχόμενα αιτήματα σε εφαρμογή Web. Ανατρέξτε στο θέμα [Πώς να ρυθμίσετε τις παραμέτρους TLS αμοιβαία ελέγχου ταυτότητας για την εφαρμογή Web](../app-service-web/app-service-web-configure-tls-mutual-auth.md) για το πώς μπορείτε να ρυθμίσετε τον κωδικό.

Στην ενότητα *εξουσιοδότηση* θα πρέπει να παρέχετε: `{"type": "clientcertificate","password": "test","pfx": "long-pfx-key"}`.

| Στοιχείο | Περιγραφή |
|---------|-------------|
| Τύπος | Απαιτείται. Τύπος ελέγχου ταυτότητας. Για τα πιστοποιητικά SSL προγράμματος-πελάτη, η τιμή πρέπει να είναι ClientCertificate. |
| PFX | Απαιτείται. Κωδικοποίηση Base64 περιεχόμενα του αρχείου PFX. |
| κωδικός πρόσβασης | Απαιτείται. Ο κωδικός πρόσβασης για να αποκτήσετε πρόσβαση στο αρχείο PFX. |

### <a name="basic-auth"></a>Βασικό έλεγχο ταυτότητας

Μπορείτε να χρησιμοποιήσετε το βασικό έλεγχο ταυτότητας (π.χ., όνομα χρήστη και κωδικός πρόσβασης) για να επικυρώσει τα εισερχόμενα αιτήματα. Βασική auth είναι ένα κοινό μοτίβο και μπορείτε να το κάνετε σε οποιαδήποτε γλώσσα που μπορείτε να δημιουργήσετε την εφαρμογή σας στο.

Στην ενότητα *εξουσιοδότηση* , θα πρέπει να παρέχετε: `{"type": "basic","username": "test","password": "test"}`.

| Στοιχείο | Περιγραφή |
|---------|-------------|
| Τύπος | Απαιτείται. Τύπος ελέγχου ταυτότητας. Βασικό έλεγχο ταυτότητας, η τιμή πρέπει να είναι Basic. |
| όνομα χρήστη | Απαιτείται. Το όνομα χρήστη για τον έλεγχο ταυτότητας. |
| κωδικός πρόσβασης | Απαιτείται. Ο κωδικός πρόσβασης για τον έλεγχο ταυτότητας. |

### <a name="handle-aad-auth-in-code"></a>Λαβή AAD auth στον κώδικα

Από προεπιλογή, ο έλεγχος ταυτότητας Azure Active Directory που ενεργοποιείτε στην πύλη δεν λεπτομερή εξουσιοδότησης. Για παράδειγμα, δεν κλειδώνει το API έναν συγκεκριμένο χρήστη ή την εφαρμογή, αλλά μόνο σε ένα συγκεκριμένο μισθωτή.

Εάν θέλετε να περιορίσετε το API απλώς λογικής εφαρμογή, για παράδειγμα, στον κώδικα, μπορείτε να εξαγάγετε την επικεφαλίδα η οποία περιέχει τις JWT και ελέγξτε ποιος τον καλούντα, απορρίπτει τα αιτήματα που δεν ταιριάζουν.

Ξεκινήστε περαιτέρω, εάν θέλετε να εφαρμόσει εντελώς στο δικό σας κώδικα και δεν επωφεληθείτε της δυνατότητας πύλη, μπορείτε να διαβάσετε αυτό το άρθρο: [Χρήση υπηρεσίας καταλόγου Active Directory για τον έλεγχο ταυτότητας στο Azure εφαρμογής υπηρεσίας](../app-service-web/web-sites-authentication-authorization.md).

Εξακολουθείτε να χρειάζεστε για να ακολουθήσετε τα παραπάνω βήματα για να δημιουργήσετε μια ταυτότητα εφαρμογής για την εφαρμογή σας λογικής και να το χρησιμοποιήσετε για να καλέσετε το API.
