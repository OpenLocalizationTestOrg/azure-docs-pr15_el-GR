<properties 
    pageTitle="Δημιουργήστε ένα API για εφαρμογές λογικής" 
    description="Δημιουργία ενός προσαρμοσμένου API για χρήση με λογική εφαρμογών" 
    authors="jeffhollan" 
    manager="dwrede" 
    editor="" 
    services="logic-apps" 
    documentationCenter=""/>

<tags
    ms.service="logic-apps"
    ms.workload="integration"
    ms.tgt_pltfrm="na"
    ms.devlang="na" 
    ms.topic="article"
    ms.date="10/18/2016"
    ms.author="jehollan"/>
    
# <a name="creating-a-custom-api-to-use-with-logic-apps"></a>Δημιουργία ενός προσαρμοσμένου API για χρήση με λογική εφαρμογών

Εάν θέλετε να επεκτείνετε την πλατφόρμα λογικής εφαρμογών, υπάρχουν πολλοί τρόποι που μπορείτε να καλέσετε σε API ή συστήματα που δεν είναι διαθέσιμα ως ένα από τα πολλές γραμμές σύνδεσης εκτός του πλαισίου.  Έναν από αυτούς τους τρόπους για να δημιουργήσετε μια εφαρμογή API μπορείτε να καλέσετε από μέσα σε μια ροή εργασίας λογική εφαρμογής.

## <a name="helpful-tools"></a>Χρήσιμα εργαλεία

Για το API για να λειτουργούν καλύτερα με λογική εφαρμογών, συνιστάται να Δημιουργία εγγράφου [swagger](http://swagger.io) που περιγράφει με λεπτομέρεια τις υποστηριζόμενες λειτουργίες και τις παραμέτρους για το API.  Υπάρχουν πολλές βιβλιοθήκες (όπως [Swashbuckle](https://github.com/domaindrivendev/Swashbuckle)) που δημιουργεί αυτόματα το swagger για εσάς.  Μπορείτε επίσης να χρησιμοποιήσετε [TRex](https://github.com/nihaue/TRex) για να σχολιάσετε το swagger ώστε να λειτουργεί καλά με εφαρμογές λογικής (Εμφάνιση ονόματα, τύποι ιδιοτήτων, κ.λπ.).  Για ορισμένα δείγματα API εφαρμογών που έχει σχεδιαστεί για εφαρμογές λογικής, φροντίστε να αναλάβετε τον έλεγχο μας [GitHub αποθετήριο δεδομένων](http://github.com/logicappsio) ή του [ιστολογίου](http://aka.ms/logicappsblog).

## <a name="actions"></a>Ενέργειες

Η βασική ενέργεια για μια εφαρμογή λογικής είναι ένα ελεγκτή που θα αποδεχτείτε μια αίτηση HTTP και να επιστρέψετε μια απάντηση (συνήθως 200).  Ωστόσο υπάρχουν διάφορα μοτίβα που μπορείτε να ακολουθήσετε για να επεκτείνετε ενέργειες με βάση τις ανάγκες σας.

Από προεπιλογή ο μηχανισμός λογικής εφαρμογή θα χρονικού ορίου αίτησης μετά από 1 λεπτό.  Ωστόσο, μπορείτε να έχετε το API εκτελέσει στη ενέργειες που διαρκούν περισσότερο και έχετε το μηχανισμό αναμονή για την ολοκλήρωση, ακολουθώντας μια ασύγχρονης ή webhook μοτίβο λεπτομερώς πιο κάτω.

Για τυπικές ενέργειες, απλώς Γράψτε μια μέθοδο αίτηση HTTP με το API που εκτίθεται μέσω swagger.  Μπορείτε να δείτε δείγματα εφαρμογών API που λειτουργούν με λογική εφαρμογών σε μας [GitHub αποθετήριο](https://github.com/logicappsio).  Παρακάτω θα βρείτε τρόπους για την ολοκλήρωση κοινά μοτίβα με μια προσαρμοσμένη γραμμή σύνδεσης.

### <a name="long-running-actions---async-pattern"></a>Μεγάλης διάρκειας ενέργειες - μοτίβο ασύγχρονης

Όταν εκτελείτε ένα μεγάλο βήμα ή μια εργασία, το πρώτο πράγμα που πρέπει να κάνετε είναι βεβαιωθείτε ότι ο μηχανισμός γνωρίζει έχετε έληξε. Πρέπει επίσης να επικοινωνήσετε με το μηχανισμό πώς θα ξέρω όταν τελειώσετε με την εργασία και, τέλος, πρέπει να επιστρέψει σχετικών δεδομένων για το μηχανισμό, ώστε να μπορεί να συνεχίσει με τη ροή εργασίας. Μπορείτε να το ολοκληρώσετε μέσω API, ακολουθώντας τα παρακάτω ροής. Αυτά τα βήματα είναι από το σημείο προβολή του προσαρμοσμένου API:

1. Όταν λάβει μια αίτηση, επιστρέψτε αμέσως απόκριση (πριν από την εργασία να ολοκληρωθεί). Αυτή η απόκριση θα είναι μια `202 ACCEPTED` απάντηση, επιτρέποντας στα το μηχανισμό γνωρίζετε λάβατε τα δεδομένα, αποδέχτηκε το φορτίο λήψης και είναι τώρα επεξεργασίας. Η απόκριση 202 πρέπει να περιέχει τις παρακάτω κεφαλίδες: 
 * `location`κεφαλίδα (απαιτείται): Αυτή είναι μια απόλυτη διαδρομή στις εφαρμογές λογικής διεύθυνσης URL να χρησιμοποιήσετε για να ελέγξετε την κατάσταση της εργασίας.
 * `retry-after`(προαιρετικά, θα προεπιλεγμένη έως 20 για ενέργειες). Πρόκειται για τον αριθμό των δευτερολέπτων αναμονής πριν από την σταθμοσκόπησης τη διεύθυνση URL της κεφαλίδας θέση για να ελέγξετε την κατάσταση το μηχανισμό.

2. Όταν έχει επιλεγεί ένα κατάστασης εργασίας, εκτελέστε τα εξής: 
 * Εάν η εργασία έχει ολοκληρωθεί: επιστρέφουν μια `200 OK` απάντηση, με το φορτίο απόκρισης.
 * Εάν η εργασία επεξεργάζεται ακόμα: επιστρέφουν μια άλλη `202 ACCEPTED` απάντηση, με την ίδια κεφαλίδες ως στην αρχική απάντηση

Αυτό το μοτίβο σάς επιτρέπει να εκτελέσετε πολύ μεγάλο εργασίες μέσα σε ένα νήμα του προσαρμοσμένου σας API, αλλά διατήρηση μια ενεργή σύνδεση ενεργών με το μηχανισμό λογικής εφαρμογών, ώστε να δεν το χρονικό όριο ή συνεχίστε πριν ολοκληρωθεί η εργασία. Κατά την προσθήκη αυτό σε εφαρμογή της λογικής, είναι σημαντικό να λάβετε υπόψη, δεν χρειάζεται κάνετε τίποτα στον ορισμό σας για την εφαρμογή λογικής για να συνεχίσετε να ψηφοφορία και να ελέγξετε την κατάσταση. Μόλις το μηχανισμό βλέπει 202 απόκριση ΑΠΟΔΕΚΤΟΊ με κεφαλίδα έγκυρη θέση, θα εκτελέσει το μοτίβο ασύγχρονης και θα εξακολουθήσει να ψηφοφορία κεφαλίδα θέση μέχρι να επιστραφεί μια μη 202.

Μπορείτε να δείτε ένα δείγμα αυτό το μοτίβο στο GitHub [εδώ](https://github.com/jeffhollan/LogicAppsAsyncResponseSample)

### <a name="webhook-actions"></a>Ενέργειες Webhook

Κατά τη ροή εργασίας σας, μπορείτε να έχετε την εφαρμογή λογικής παύση και περιμένετε "Επιστροφή κλήσης" για να συνεχίσετε.  Αυτήν την επιστροφή κλήσης είναι η μορφή μια ΔΗΜΟΣΊΕΥΣΗ HTTP.  Για να εφαρμόσετε αυτό το μοτίβο, πρέπει να παρέχει δύο τελικά σημεία στον ελεγκτή σας: εγγραφή και να καταργήσετε τη συνδρομή σας.

Στην 'εγγραφή', η εφαρμογή λογικής θα δημιουργήσετε και να καταχωρήσετε μια διεύθυνση URL επιστροφής κλήσης που μπορεί να αποθηκεύσει το API και επιστροφής κλήσης με ετοιμότητα ως μια ΔΗΜΟΣΊΕΥΣΗ HTTP.  Οποιοδήποτε περιεχόμενο/κεφαλίδες θα περάσουν στην εφαρμογή λογικής και μπορεί να χρησιμοποιηθεί μέσα το υπόλοιπο της ροής εργασίας.  Ο μηχανισμός λογικής εφαρμογή θα κλήση του σημείου εγγραφή σε εκτέλεσης μόλις το επισκέψεις αυτό το βήμα.

Εάν η εκτέλεση ακυρώθηκε, ο μηχανισμός λογικής εφαρμογή θα πραγματοποίηση κλήσης στο τελικό σημείο 'Κατάργηση εγγραφής'.  Το API στη συνέχεια, μπορούν να καταργήσουν τη διεύθυνση URL επιστροφής κλήσης ανάλογα με τις ανάγκες.

Αυτήν τη στιγμή στη σχεδίαση εφαρμογής λογικής δεν υποστηρίζει εντοπισμός ένα τελικό σημείο webhook έως swagger, ώστε να χρησιμοποιήσετε αυτόν τον τύπο ενέργειας που πρέπει να προσθέσετε την ενέργεια "Webhook" και να καθορίσετε τη διεύθυνση URL, των κεφαλίδων και σώμα της αίτησής σας.  Μπορείτε να χρησιμοποιήσετε το `@listCallbackUrl()` συνάρτηση ροής εργασίας σε οποιαδήποτε από αυτά τα πεδία, όπως απαιτείται για τη μεταβίβαση στη διεύθυνση URL επιστροφής κλήσης.

Μπορείτε να δείτε ένα δείγμα ένα μοτίβο webhook στο GitHub [εδώ](https://github.com/jeffhollan/LogicAppTriggersExample/blob/master/LogicAppTriggers/Controllers/WebhookTriggerController.cs)

## <a name="triggers"></a>Εναυσμάτων

Εκτός από τις ενέργειες, μπορείτε να έχετε το προσαρμοσμένο act API ως έναυσμα σε μια εφαρμογή λογικής.  Υπάρχουν δύο μοτίβα που μπορείτε να ακολουθήσετε κάτω από το στοιχείο για να ενεργοποιήσετε μια εφαρμογή λογικής:

### <a name="polling-triggers"></a>Σταθμοσκόπησης εναυσμάτων

Εναύσματα σταθμοσκόπησης ενεργούν μοιάζει πολύ με τις παραπάνω μεγάλη ασύγχρονης εκτελούνται ενέργειες.  Ο μηχανισμός λογικής εφαρμογή θα καλούν το τελικό σημείο έναυσμα αφού παρέλθει ένα συγκεκριμένο χρονικό διάστημα (εξαρτάται από SKU, 15 δευτερολέπτων για Premium, 1 λεπτό για το πρότυπο, και 1 ώρα για δωρεάν).

Εάν υπάρχει χωρίς δεδομένα διαθέσιμη, επιστρέφει το έναυσμα ένα `202 ACCEPTED` απάντηση, με μια `location` και `retry-after` κεφαλίδα.  Ωστόσο, για εναύσματα, συνιστάται η `location` κεφαλίδας περιέχει μιας παραμέτρου ερωτήματος της `triggerState`.  Πρόκειται για κάποιο αναγνωριστικό για το API να γνωρίζετε κατά την τελευταία φορά που η εφαρμογή λογικής ενεργοποιείται.  Εάν υπάρχει δεδομένων διαθέσιμη, επιστρέφει το έναυσμα ένα `200 OK` απόκρισης, με το φορτίο περιεχομένου.  Αυτό θα εφαρμόζεται η εφαρμογή λογικής.

Για παράδειγμα, εάν να σταθμοσκόπησης για να δείτε εάν ένα αρχείο έχει διαθέσιμη, θα μπορούσε να δημιουργείτε ένα έναυσμα σταθμοσκόπησης που θα κάντε τα εξής:

* Εάν μια αίτηση ελήφθη με χωρίς triggerState το API θα επιστρέψει μια `202 ACCEPTED` με ένα `location` κεφαλίδα που έχει μια triggerState της τρέχουσας ώρας και μια `retry-after` 15.
* Εάν μια αίτηση ελήφθη με μια triggerState:
 * Ελέγξτε εάν τα αρχεία που έχουν προστεθεί μετά το triggerState ημερομηνίας/ώρας. 
  * Εάν υπάρχει 1 αρχείο, επιστρέφουν μια `200 OK` απόκρισης, με το φορτίο περιεχομένου, αύξησης το triggerState για να το DateTime του αρχείου που επιστρέφονται και να ορίσετε το `retry-after` έως 15.
  * Εάν υπάρχουν πολλά αρχεία, να μπορούν να επιστρέφουν 1 ταυτόχρονα με μια `200 OK`, αύξησης μου triggerState στο το `location` κεφαλίδα και σύνολο `retry-after` σε 0.  Αυτό θα σας επιτρέψει να το μηχανισμό γνωρίζετε είναι διαθέσιμη περισσότερα δεδομένα και θα ζητά αμέσως το στο το `location` κεφαλίδα που καθορίζεται.
  * Εάν δεν υπάρχουν διαθέσιμα αρχεία, επιστρέφουν μια `202 ACCEPTED` απόκρισης και αφήστε το `location` triggerState το ίδιο.  Ορισμός `retry-after` έως 15.

Μπορείτε να δείτε ένα δείγμα ένα έναυσμα ψηφοφορίας σε GitHub [εδώ](https://github.com/jeffhollan/LogicAppTriggersExample/tree/master/LogicAppTriggers)

### <a name="webhook-triggers"></a>Webhook εναυσμάτων

Εναύσματα Webhook ενεργούν μοιάζει πολύ με ενέργειες Webhook παραπάνω.  Ο μηχανισμός λογική εφαρμογής θα καλέσει το τελικό σημείο 'εγγραφή' κάθε φορά που ένα έναυσμα webhook προστίθεται και αποθηκεύσατε.  Το API μπορεί να καταχωρήσετε τη διεύθυνση URL webhook και καλέστε την μέσω HTTP POST, κάθε φορά που τα δεδομένα είναι διαθέσιμα.  Το φορτίο περιεχομένου και κεφαλίδες θα περάσουν στην εφαρμογή λογικής εκτέλεση.

Εάν ένα έναυσμα webhook ποτέ διαγραφεί (είτε η εφαρμογή λογικής εντελώς ή απλώς το έναυσμα webhook), ο μηχανισμός θα πραγματοποιήσω μια τηλεφωνική κλήση στη διεύθυνση URL 'Κατάργηση εγγραφής' όπου το API μπορούν να καταργήσουν τη διεύθυνση URL επιστροφής κλήσης και διακοπή τις διαδικασίες, ανάλογα με τις ανάγκες.

Αυτήν τη στιγμή στη σχεδίαση εφαρμογής λογικής δεν υποστηρίζει εντοπισμός ένα έναυσμα webhook έως swagger, ώστε να χρησιμοποιήσετε αυτόν τον τύπο ενέργειας πρέπει να προσθέσετε το έναυσμα "Webhook" και καθορίστε τη διεύθυνση URL, κεφαλίδες και σώμα της αίτησής σας.  Μπορείτε να χρησιμοποιήσετε το `@listCallbackUrl()` συνάρτηση ροής εργασίας σε οποιαδήποτε από αυτά τα πεδία, όπως απαιτείται για τη μεταβίβαση στη διεύθυνση URL επιστροφής κλήσης.

Μπορείτε να δείτε ένα δείγμα ένα έναυσμα webhook στο GitHub [εδώ](https://github.com/jeffhollan/LogicAppTriggersExample/tree/master/LogicAppTriggers)