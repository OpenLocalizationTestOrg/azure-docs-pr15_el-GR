<properties
   pageTitle="Χρήση δεσμών ενεργειών του Windows PowerShell για τη δημοσίευση για προγραμματιστές και περιβάλλοντα δοκιμής | Microsoft Azure"
   description="Μάθετε πώς να χρησιμοποιείτε δεσμών ενεργειών του Windows PowerShell από το Visual Studio να δημοσιεύσετε σε ανάπτυξη και να ελέγξετε περιβάλλοντα."
   services="visual-studio-online"
   documentationCenter="na"
   authors="TomArcher"
   manager="douge"
   editor="" />
<tags
   ms.service="multiple"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="multiple"
   ms.date="08/15/2016"
   ms.author="tarcher" />

# <a name="using-windows-powershell-scripts-to-publish-to-dev-and-test-environments"></a>Χρήση δεσμών ενεργειών του Windows PowerShell για δημοσίευση σε αποκλίσεις και να ελέγξετε περιβάλλοντα

Όταν δημιουργείτε μια εφαρμογή web στο Visual Studio, μπορείτε να δημιουργήσετε μια δέσμη ενεργειών του Windows PowerShell που μπορείτε να χρησιμοποιήσετε για να αυτοματοποιήσετε τη δημοσίευση της τοποθεσίας Web για να Azure ως μια εφαρμογή Web στην υπηρεσία εφαρμογής Azure ή μια εικονική μηχανή αργότερα. Μπορείτε να επεξεργαστείτε και να επεκτείνετε τη δέσμη ενεργειών του Windows PowerShell στο πρόγραμμα επεξεργασίας Visual Studio σύμφωνα με τις απαιτήσεις σας ή να ενοποίηση τη δέσμη ενεργειών με υπάρχουσα Δόμηση, δοκιμή και τη δημοσίευση δεσμών ενεργειών.

Χρησιμοποιώντας αυτές τις δέσμες ενεργειών, που μπορούν να προμηθεύσουν προσαρμοσμένες εκδόσεις (γνωστό και ως περιβάλλοντα ανάπτυξης και δοκιμής) της τοποθεσίας σας για προσωρινή χρήση. Για παράδειγμα, μπορεί να ορίσετε μια συγκεκριμένη έκδοση της τοποθεσίας Web σε μια εικονική μηχανή Azure ή στο ενδιάμεσου σταδίου υποδοχή σε μια τοποθεσία Web για την εκτέλεση μιας οικογένειας δοκιμής, αναπαραγάγετε ένα σφάλμα, δοκιμάστε μια προτεινόμενη αλλαγή επιδιόρθωση σφαλμάτων, δοκιμαστική έκδοση ή ρύθμιση προσαρμοσμένου περιβάλλοντος για μια επίδειξη ή παρουσίαση. Αφού δημιουργήσετε μια δέσμη ενεργειών που δημοσιεύει το έργο σας, μπορείτε να αναδημιουργήσετε πανομοιότυπα περιβάλλοντα, εκτελώντας εκ νέου τη δέσμη ενεργειών, όπως απαιτείται ή να εκτελέσετε τη δέσμη ενεργειών με τη δική σας έκδοση της εφαρμογής σας web για να δημιουργήσετε ένα προσαρμοσμένο περιβάλλον για τη δοκιμή.

## <a name="what-you-need"></a>Τι χρειάζεστε

- Azure SDK 2.3 ή νεότερη έκδοση. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Λήψη του Visual Studio](http://go.microsoft.com/fwlink/?LinkID=624384) .

Δεν χρειάζεται το Azure SDK για τη δημιουργία των δεσμών ενεργειών για τα έργα web. Αυτή η δυνατότητα είναι web έργα, δεν web ρόλους σε υπηρεσίες cloud.

- Azure PowerShell 0.7.4 ή νεότερη έκδοση. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Πώς να εγκαταστήσετε και να ρυθμίσετε τις παραμέτρους του PowerShell Azure](powershell-install-configure.md) .

- [Το Windows PowerShell 3.0](http://go.microsoft.com/?linkid=9811175) ή νεότερη έκδοση.

## <a name="additional-tools"></a>Πρόσθετα εργαλεία

Πρόσθετα εργαλεία και πόρους για την εργασία με το PowerShell στο Visual Studio για την ανάπτυξη Azure είναι διαθέσιμες. Ανατρέξτε στο θέμα [Εργαλεία του PowerShell για το Visual Studio](http://go.microsoft.com/fwlink/?LinkId=404012).

## <a name="generating-the-publish-scripts"></a>Δημιουργία των δεσμών ενεργειών δημοσίευση

Μπορείτε να δημιουργήσετε τις δέσμες ενεργειών δημοσίευση για μια εικονική μηχανή που φιλοξενεί την τοποθεσία Web, όταν δημιουργείτε ένα νέο έργο από [αυτές τις οδηγίες](./virtual-machines/virtual-machines-windows-classic-web-app-visual-studio.md). Μπορείτε επίσης να [Δημιουργία δημοσίευση δεσμών ενεργειών για τις εφαρμογές web της εφαρμογής υπηρεσίας Azure](./app-service-web/web-sites-dotnet-get-started.md).

## <a name="scripts-that-visual-studio-generates"></a>Δέσμες ενεργειών που παράγει το Visual Studio

Visual Studio δημιουργεί ένα φάκελο επιπέδου λύσης που ονομάζεται **PublishScripts** που περιέχει δύο αρχεία του Windows PowerShell, μια δέσμη ενεργειών δημοσίευση για το εικονικό μηχάνημα ή στην τοποθεσία Web και μια λειτουργική μονάδα που περιέχει συναρτήσεις που μπορείτε να χρησιμοποιήσετε με τις δέσμες ενεργειών. Visual Studio δημιουργεί επίσης ένα αρχείο σε μορφή JSON που καθορίζει τις λεπτομέρειες του έργου που αναπτύσσετε.

### <a name="windows-powershell-publish-script"></a>Windows PowerShell δημοσίευση δέσμης ενεργειών

Η δέσμη ενεργειών δημοσίευση περιέχει συγκεκριμένες δημοσίευση βήματα για την ανάπτυξη σε μια τοποθεσία Web ή μια εικονική μηχανή. Visual Studio παρέχει σύνταξη χρωματισμό για την ανάπτυξη του Windows PowerShell. Η Βοήθεια για τις συναρτήσεις είναι διαθέσιμο και ελεύθερα, μπορείτε να επεξεργαστείτε τις συναρτήσεις στη δέσμη ενεργειών να ταιριάζει με τις μεταβαλλόμενες απαιτήσεις σας.

### <a name="windows-powershell-module"></a>Λειτουργική μονάδα Windows PowerShell

Η λειτουργική μονάδα Windows PowerShell που παράγει το Visual Studio περιέχει συναρτήσεις που χρησιμοποιεί τη δέσμη ενεργειών δημοσίευση. Αυτές είναι οι συναρτήσεις Azure PowerShell και δεν πρόκειται να είναι δυνατή η τροποποίηση. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Πώς να εγκαταστήσετε και να ρυθμίσετε τις παραμέτρους του PowerShell Azure](powershell-install-configure.md) .

### <a name="json-configuration-file"></a>Αρχείο ρύθμισης παραμέτρων JSON

Το αρχείο JSON δημιουργείται στο φάκελο **ρυθμίσεις παραμέτρων** και περιέχει δεδομένα ρύθμισης παραμέτρων που καθορίζει ακριβώς τους πόρους για ανάπτυξη Azure. Το όνομα του αρχείου που παράγει το Visual Studio είναι έργο-όνομα-WAWS-dev.json εάν έχετε δημιουργήσει μια τοποθεσία Web ή έργο όνομα-Εικονική-dev.json εάν έχετε δημιουργήσει μια εικονική μηχανή. Ακολουθεί ένα παράδειγμα ενός αρχείου ρύθμισης παραμέτρων JSON που δημιουργείται όταν δημιουργείτε μια τοποθεσία Web. Οι περισσότερες από τις τιμές είναι αυτονόητα. Το όνομα της τοποθεσίας Web δημιουργείται από το Azure, ώστε να μπορεί να ταιριάζει με το όνομα του έργου.

```
{
"environmentSettings": {
"webSite": {
"name": "WebApplication26632",
"location": "West US"
},
"databases": [
{
"connectionStringName": "DefaultConnection",
"databaseName": "WebApplication26632_db",
"serverName": "YourDatabaseServerName",
"user": "sqluser2",
"password": "",
"edition": "",
"size": "",
"collation": "",
"location": "West US"
}
]
}
}
```
Όταν δημιουργείτε μια εικονική μηχανή, το αρχείο ρύθμισης παραμέτρων JSON μοιάζει με το εξής. Σημειώστε ότι μια υπηρεσία cloud δημιουργείται ως κοντέινερ για την εικονική μηχανή. Η εικονική μηχανή περιέχει τη συνήθη τελικά σημεία για το web access μέσω HTTP και HTTPS, καθώς και για το Web ανάπτυξη, η οποία σας επιτρέπει να δημοσιεύσετε την τοποθεσία Web από τον τοπικό υπολογιστή, απομακρυσμένης επιφάνειας εργασίας και του Windows PowerShell τα τελικά σημεία.

```
{
"environmentSettings": {
"cloudService": {
"name": "myusernamevm1",
"affinityGroup": "",
"location": "West US",
"virtualNetwork": "",
"subnet": "",
"availabilitySet": "",
"virtualMachine": {
"name": "myusernamevm1",
"vhdImage": "a699494373c04fc0bc8f2bb1389d6106__Win2K8R2SP1-Datacenter-201403.01-en.us-127GB.vhd",
"size": "Small",
"user": "vmuser1",
"password": "",
"enableWebDeployExtension": true,
"endpoints": [
{
"name": "Http",
"protocol": "TCP",
"publicPort": "80",
"privatePort": "80"
},
{
"name": "Https",
"protocol": "TCP",
"publicPort": "443",
"privatePort": "443"
},
{
"name": "WebDeploy",
"protocol": "TCP",
"publicPort": "8172",
"privatePort": "8172"
},
{
"name": "Remote Desktop",
"protocol": "TCP",
"publicPort": "3389",
"privatePort": "3389"
},
{
"name": "Powershell",
"protocol": "TCP",
"publicPort": "5986",
"privatePort": "5986"
}
]
}
},
"databases": [
{
"connectionStringName": "",
"databaseName": "",
"serverName": "",
"user": "",
"password": ""
}
],
"webDeployParameters": {
"iisWebApplicationName": "Default Web Site"
}
}
}
```

Μπορείτε να επεξεργαστείτε τις ρυθμίσεις παραμέτρων JSON για να αλλάξετε τι συμβαίνει όταν εκτελείτε τις δέσμες ενεργειών δημοσίευση. Το `cloudService` και `virtualMachine` απαιτούνται ενότητες, αλλά μπορείτε να διαγράψετε το `databases` ενότητας Εάν δεν τη χρειάζεστε. Οι ιδιότητες που είναι κενά στο προεπιλεγμένο αρχείο ρύθμισης παραμέτρων που παράγει το Visual Studio είναι προαιρετικό. απαιτούνται αυτές που έχουν τιμές στο προεπιλεγμένο αρχείο ρύθμισης παραμέτρων.

Εάν έχετε μια τοποθεσία Web που έχει πολλά περιβάλλοντα ανάπτυξης (γνωστό ως υποδοχές) αντί για μια τοποθεσία παραγωγής στο Azure, μπορείτε να συμπεριλάβετε το όνομα υποδιαίρεση στο όνομα της τοποθεσίας Web στο αρχείο παραμέτρων JSON. Για παράδειγμα, εάν έχετε μια τοποθεσία Web που έχει με όνομα, **η τοποθεσία μου** και μια υποδοχή για αυτό ονομάζεται **Δοκιμή** , στη συνέχεια, το URI είναι η τοποθεσία μου-test.cloudapp.net, αλλά το σωστό όνομα για να χρησιμοποιήσετε στο αρχείο παραμέτρων είναι mysite(test). Μπορείτε να εκτελέσετε μόνο αν η τοποθεσία Web και υποδοχές υπάρχουν ήδη στη συνδρομή σας. Εάν δεν υπάρχουν, δημιουργία της τοποθεσίας Web με την εκτέλεση της δέσμης ενεργειών χωρίς να καθορίσετε εσοχή, στη συνέχεια, δημιουργήστε την Υποδοχή στην [πύλη του Azure κλασική](http://go.microsoft.com/fwlink/?LinkID=213885)και στη συνέχεια να εκτελέσετε τη δέσμη ενεργειών με το όνομα της τοποθεσίας Web που έχουν τροποποιηθεί. Για περισσότερες πληροφορίες σχετικά με την ανάπτυξη υποδοχές για τις εφαρμογές web, ανατρέξτε στο θέμα [Ρύθμιση του ενδιάμεσου περιβάλλοντα για τις εφαρμογές web στο Azure εφαρμογής υπηρεσίας](./app-service-web/web-sites-staged-publishing.md).

## <a name="how-to-run-the-publish-scripts"></a>Πώς μπορείτε να εκτελέσετε τις δέσμες ενεργειών δημοσίευση

Εάν έχετε εκτελέσει ποτέ μια δέσμη ενεργειών του Windows PowerShell πριν, πρέπει πρώτα να ορίσετε την πολιτική εκτέλεσης για να ενεργοποιήσετε την εκτέλεση των δεσμών ενεργειών. Αυτή είναι μια δυνατότητα ασφαλείας για να εμποδίζει τους χρήστες να εκτελούν δέσμες ενεργειών του Windows PowerShell, εάν βρίσκονται ευπρόσβλητα από λογισμικό κακόβουλης λειτουργίας ή ιούς που αφορούν την εκτέλεση δεσμών ενεργειών.

### <a name="run-the-script"></a>Εκτελέστε τη δέσμη ενεργειών

1. Δημιουργήστε το πακέτο ανάπτυξη Web για το έργο σας. Πακέτο ανάπτυξη Web είναι μια αρχειοθήκη συμπιεσμένη (αρχείο .zip) που περιέχει τα αρχεία που θέλετε να αντιγράψετε σε τοποθεσία Web ή εικονική μηχανή. Μπορείτε να δημιουργήσετε Web ανάπτυξη πακέτων στο Visual Studio για οποιαδήποτε εφαρμογή web.

![Δημιουργία τοποθεσίας Web ανάπτυξη πακέτου](./media/vs-azure-tools-publishing-using-powershell-scripts/IC767885.png)

Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [ΔΙΑΔΙΚΑΣΙΕΣ: Δημιουργία πακέτου ανάπτυξης Web στο Visual Studio](https://msdn.microsoft.com/library/dd465323.aspx). Μπορείτε επίσης να αυτοματοποιήσετε τη δημιουργία του πακέτου ανάπτυξης Web, όπως περιγράφεται στην ενότητα **Προσαρμογή και επέκταση τις δέσμες ενεργειών δημοσίευση** αργότερα σε αυτό το θέμα.

1. Στην **Εξερεύνηση λύσεων**, ανοίξτε το μενού περιβάλλοντος για τη δέσμη ενεργειών και, στη συνέχεια, επιλέξτε **Άνοιγμα με το PowerShell ISE**.

1. Εάν αυτή είναι η πρώτη φορά που έχετε εκτελέσει δεσμών ενεργειών του Windows PowerShell σε αυτόν τον υπολογιστή, ανοίξτε ένα παράθυρο γραμμής εντολών με δικαιώματα διαχειριστή και πληκτρολογήστε την ακόλουθη εντολή:

`Set-ExecutionPolicy RemoteSigned`

1. Πραγματοποιήστε είσοδο στο Azure χρησιμοποιώντας την ακόλουθη εντολή.

`Add-AzureAccount`

Όταν σας ζητηθεί, δώστε το όνομα χρήστη και τον κωδικό πρόσβασης.

Σημειώστε ότι όταν αυτοματοποιήσετε τη δέσμη ενεργειών, δεν θα λειτουργεί αυτή η μέθοδος παρέχοντας Azure διαπιστευτήρια. Αντί για αυτό, θα πρέπει να χρησιμοποιείτε το αρχείο .publishsettings για την παροχή διαπιστευτήρια. Μία φορά μόνο, χρησιμοποιείτε την εντολή **Get-AzurePublishSettingsFile** για να κάνετε λήψη του αρχείου από το Azure και στη συνέχεια χρησιμοποιήστε **AzurePublishSettingsFile εισαγωγή** για να εισαγάγετε το αρχείο. Για λεπτομερείς οδηγίες, ανατρέξτε στο θέμα [Πώς να εγκαταστήσετε και να ρυθμίσετε τις παραμέτρους του PowerShell Azure](powershell-install-configure.md).

1. (Προαιρετικό) Εάν θέλετε να δημιουργήσετε Azure πόρους, όπως η εικονική μηχανή, βάση δεδομένων και τοποθεσία Web χωρίς να δημοσιευτεί η εφαρμογή web σας, χρησιμοποιήστε την εντολή **Δημοσίευση WebApplication.ps1** με το **-Ρύθμιση παραμέτρων** όρισμα ρύθμιση για το αρχείο ρύθμισης παραμέτρων JSON. Αυτή η γραμμή εντολών χρησιμοποιεί το αρχείο ρύθμισης παραμέτρων JSON για τον καθορισμό των πόρων που θα δημιουργήσετε. Επειδή χρησιμοποιεί τις προεπιλεγμένες ρυθμίσεις για άλλα ορίσματα της γραμμής εντολών, δημιουργεί τους πόρους, αλλά δεν δημοσιεύσετε την εφαρμογή web. Το στοιχείο – λεπτομερής επιλογή παρέχει περισσότερες πληροφορίες σχετικά με το τι συμβαίνει.

`Publish-WebApplication.ps1 -Verbose –Configuration C:\Path\WebProject-WAWS-dev.json`

1. Χρησιμοποιήστε την εντολή **Δημοσίευση WebApplication.ps1** όπως φαίνεται σε ένα από τα παρακάτω παραδείγματα για να ενεργοποιήσετε τη δέσμη ενεργειών και να δημοσιεύσετε την εφαρμογή web. Εάν χρειάζεστε για να παρακάμψετε τις προεπιλεγμένες ρυθμίσεις για οποιοδήποτε από τα άλλα ορίσματα, όπως το όνομα της συνδρομής, δημοσίευση όνομα πακέτου, διαπιστευτήρια εικονική μηχανή ή διαπιστευτήρια διακομιστή βάσης δεδομένων, μπορείτε να καθορίσετε αυτές τις παραμέτρους. Χρησιμοποιήστε το **-λεπτομερής** την επιλογή για να δείτε περισσότερες πληροφορίες σχετικά με την πρόοδο της διαδικασίας δημοσίευσης.

```
Publish-WebApplication.ps1 –Configuration C:\Path\WebProject-WAWS-dev-json `
–SubscriptionName Contoso `
-WebDeployPackage C:\Documents\Azure\ADWebApp.zip `
-DatabaseServerPassword @{Name="dbServerName";Password="adminPassword"} `
-Verbose
```

Εάν θέλετε να δημιουργήσετε μια εικονική μηχανή, η εντολή έχει τα εξής. Αυτό το παράδειγμα εμφανίζει επίσης πώς μπορείτε να καθορίσετε τα διαπιστευτήρια για πολλές βάσεις δεδομένων. Για τις εικονικές μηχανές που δημιουργείτε αυτές τις δέσμες ενεργειών, το πιστοποιητικό SSL δεν προέρχεται από αξιόπιστη αρχή ρίζας. Επομένως, πρέπει να χρησιμοποιήσετε την επιλογή **-AllowUntrusted** .

```
Publish-WebApplication.ps1 `
-Configuration C:\Path\ADVM-VM-test.json `
-SubscriptionName Contoso `
-WebDeployPackage C:\Path\ADVM.zip `
-AllowUntrusted `
-VMPassword @{name = "vmUserName"; password = "YourPasswordHere"} `
-DatabaseServerPassword @{Name="server1";Password="adminPassword1"}, @{Name="server2";Password="adminPassword2"} `
-Verbose
```

Η δέσμη ενεργειών να δημιουργήσετε βάσεις δεδομένων, αλλά δεν θα δημιουργηθεί διακομιστές βάσεων δεδομένων. Εάν θέλετε να δημιουργήσετε ένα διακομιστή βάσης δεδομένων, μπορείτε να χρησιμοποιήσετε τη συνάρτηση **Δημιουργία AzureSqlDatabaseServer** στη λειτουργική μονάδα Azure.

## <a name="customizing-and-extending-the-publish-scripts"></a>Προσαρμογή και την επέκταση τις δέσμες ενεργειών δημοσίευση

Μπορείτε να προσαρμόσετε τη δημοσίευση δέσμη ενεργειών και το αρχείο ρύθμισης παραμέτρων JSON. Οι συναρτήσεις στη λειτουργική μονάδα Windows PowerShell **AzureWebAppPublishModule.psm1** δεν πρόκειται να είναι δυνατή η τροποποίηση. Εάν θέλετε απλώς να καθορίσετε μια διαφορετική βάση δεδομένων ή να αλλάξετε ορισμένες από τις ιδιότητες του η εικονική μηχανή, επεξεργαστείτε το αρχείο ρύθμισης παραμέτρων JSON. Εάν θέλετε να επεκτείνετε τη λειτουργικότητα της δέσμης ενεργειών για την αυτοματοποίηση δημιουργία και τον έλεγχο του έργου σας, μπορείτε να υλοποιήσετε στελέχη συνάρτηση στη **Δημοσίευση WebApplication.ps1**.

Για να αυτοματοποιήσετε τη δημιουργία το έργο σας, προσθέστε κώδικα που καλεί MSBuild να `New-WebDeployPackage` όπως φαίνεται σε αυτό το παράδειγμα κώδικα. Η διαδρομή προς την εντολή MSBuild διαφέρει ανάλογα με την έκδοση του Visual Studio που έχετε εγκαταστήσει. Για να λάβετε τη σωστή διαδρομή, μπορείτε να χρησιμοποιήσετε τη συνάρτηση **Get-MSBuildCmd**, όπως φαίνεται σε αυτό το παράδειγμα.

### <a name="to-automate-building-your-project"></a>Για να αυτοματοποιήσετε τη δημιουργία έργου σας

1. Προσθήκη του `$ProjectFile` παραμέτρων στην ενότητα καθολικές παραμέτρου.

```
[Parameter(Mandatory = $false)]
  [ValidateScript({Test-Path $_ -PathType Leaf})]
  [String]
  $ProjectFile,
```

1. Αντιγράψτε τη συνάρτηση `Get-MSBuildCmd` στο αρχείο δέσμης ενεργειών του.

```
function Get-MSBuildCmd
{
        process
{

             $path =  Get-ChildItem "HKLM:\SOFTWARE\Microsoft\MSBuild\ToolsVersions\" |
                                   Sort-Object {[double]$_.PSChildName} -Descending |
                                   Select-Object -First 1 |
                                   Get-ItemProperty -Name MSBuildToolsPath |
                                   Select -ExpandProperty MSBuildToolsPath
       
            $path = (Join-Path -Path $path -ChildPath 'msbuild.exe')

        return Get-Item $path
    }
}
```

1. Αντικατάσταση `New-WebDeployPackage` με τα παρακάτω κώδικα και να αντικαταστήσετε τους χαρακτήρες κράτησης θέσης στο τη γραμμή η κατασκευή `$msbuildCmd`. Αυτός ο κώδικας είναι Visual Studio 2015. Εάν χρησιμοποιείτε το Visual Studio 2013, αλλάξτε την ιδιότητα **VisualStudioVersion** κάτω από το στοιχείο σε `12.0`.

```
function New-WebDeployPackage
{
    #Write a function to build and package your web application
      
#To build your web application, use MsBuild.exe. For help, see MSBuild Command-Line Reference at: http://go.microsoft.com/fwlink/?LinkId=391339
      
Write-VerboseWithTime 'Build-WebDeployPackage: Start'
      
$msbuildCmd = '"{0}" "{1}" /T:Rebuild;Package /P:VisualStudioVersion=14.0 /p:OutputPath="{2}\MSBuildOutputPath" /flp:logfile=msbuild.log,v=d' -f (Get-MSBuildCmd), $ProjectFile, $scriptDirectory
      
Write-VerboseWithTime ('Build-WebDeployPackage: ' + $msbuildCmd)
      
#Start execution of the build command
$job = Start-Process cmd.exe -ArgumentList('/C "' + $msbuildCmd + '"') -WindowStyle Normal -Wait -PassThru
      
if ($job.ExitCode -ne 0)
{
throw('MsBuild exited with an error. ExitCode:' + $job.ExitCode)
}

#Obtain the project name
$projectName = (Get-Item $ProjectFile).BaseName
      
#Construct the path to web deploy zip package
$DeployPackageDir =  '.\MSBuildOutputPath\_PublishedWebsites\{0}_Package\{0}.zip' -f $projectName
      
      
#Get the full path for the web deploy zip package. This is required for MSDeploy to work
$WebDeployPackage = Resolve-Path –LiteralPath $DeployPackageDir
      
Write-VerboseWithTime 'Build-WebDeployPackage: End'
      
return $WebDeployPackage
}
```

1. Καλέστε το `New-WebDeployPackage` συνάρτηση πριν από αυτήν τη γραμμή: `$Config = Read-ConfigFile $Configuration` για τις εφαρμογές web ή `$Config = Read-ConfigFile $Configuration -HasWebDeployPackage:([Bool]$WebDeployPackage)` για εικονικές μηχανές.

```
if($ProjectFile)
{
$WebDeployPackage = New-WebDeployPackage
}
```

1. Καλέστε την προσαρμοσμένη δέσμη ενεργειών από τη γραμμή εντολών, χρησιμοποιώντας διέλευση του `$Project` όρισμα, όπως το παρακάτω παράδειγμα γραμμής εντολών.

```
.\Publish-WebApplicationVM.ps1 -Configuration .\Configurations\WebApplication5-VM-dev.json `
-ProjectFile ..\WebApplication5\WebApplication5.csproj `
-VMPassword @{Name="VMUser";Password="Test.123"} `
-AllowUntrusted `
-Verbose
```

Για να αυτοματοποιήσετε δοκιμή της εφαρμογής σας, να προσθέσετε κώδικα για `Test-WebApplication`. Φροντίστε να καταργήστε τα σχόλια από τις γραμμές στη **Δημοσίευση WebApplication.ps1** όπου ονομάζονται αυτές τις συναρτήσεις. Εάν δεν μπορείτε να δώσετε μια εφαρμογή, μπορείτε να δημιουργήσετε με μη αυτόματο τρόπο το έργο σας με το Visual Studio και, στη συνέχεια, εκτελέστε τη δέσμη ενεργειών δημοσίευση για να δημοσιεύσετε στο Azure.

## <a name="publishing-function-summary"></a>Δημοσίευσης συνάρτηση σύνοψης

Για να λάβετε Βοήθεια για συναρτήσεις που μπορείτε να χρησιμοποιήσετε στη γραμμή εντολών του Windows PowerShell, χρησιμοποιήστε την εντολή `Get-Help function-name`. Η Βοήθεια περιλαμβάνει βοήθεια παραμέτρου και παραδείγματα. Το ίδιο κείμενο Βοήθειας είναι επίσης στα αρχεία προέλευσης δέσμης ενεργειών, **AzureWebAppPublishModule.psm1** και **WebApplication.ps1 δημοσίευση**. Το δέσμη ενεργειών και τη Βοήθεια έχουν μεταφραστεί στη γλώσσα της Visual Studio σας.

**AzureWebAppPublishModule**

|Όνομα συνάρτησης|Περιγραφή|
|---|---|
|Προσθήκη AzureSQLDatabase|Δημιουργεί μια νέα βάση δεδομένων Azure SQL.|
|Προσθήκη AzureSQLDatabases|Δημιουργεί βάσεις δεδομένων Azure SQL από τις τιμές στο αρχείο configuation JSON που παράγει το Visual Studio.|
|Προσθήκη AzureVM|Δημιουργεί μια εικονική μηχανή Azure και επιστρέφει τη διεύθυνση URL της την ανάπτυξη εικονική Μηχανή. Η συνάρτηση ρυθμίζει τις προϋποθέσεις και, στη συνέχεια, καλεί τη συνάρτηση **Δημιουργία AzureVM** (λειτουργική μονάδα Azure) για να δημιουργήσετε μια νέα εικονική μηχανή.|
|Προσθήκη AzureVMEndpoints|Προσθέτει νέα τελικά σημεία εισόδου σε μια εικονική μηχανή και επιστρέφει την εικονική μηχανή με το νέο τελικό σημείο.|
|Προσθήκη AzureVMStorage|Δημιουργεί ένα νέο λογαριασμό Azure χώρου αποθήκευσης στην τρέχουσα εγγραφή. Το όνομα του λογαριασμού που αρχίζει με "devtest" ακολουθούμενο από μια μοναδική αλφαριθμητική συμβολοσειρά. Η συνάρτηση επιστρέφει το όνομα του νέου λογαριασμού χώρου αποθήκευσης. Πρέπει να καθορίσετε μια θέση ή μια ομάδα συσχέτισης για το νέο λογαριασμό του χώρου αποθήκευσης.|
|Προσθήκη AzureWebsite|Δημιουργεί μια τοποθεσία Web με το καθορισμένο όνομα και τη θέση. Αυτή η συνάρτηση καλεί τη συνάρτηση **Δημιουργία AzureWebsite** στη λειτουργική μονάδα Azure. Εάν η συνδρομή δεν περιλαμβάνει ήδη μια τοποθεσία Web με το καθορισμένο όνομα, η συνάρτηση δημιουργεί την τοποθεσία Web και επιστρέφει ένα αντικείμενο τοποθεσίας Web. Διαφορετικά, επιστρέφει την `$null`.|
|Δημιουργία αντιγράφων ασφαλείας συνδρομή|Αποθηκεύει την τρέχουσα συνδρομή Azure στο το `$Script:originalSubscription` μεταβλητής στο εύρος δέσμης ενεργειών. Αυτή η συνάρτηση αποθηκεύει την τρέχουσα συνδρομή σας Azure (όπως λαμβάνεται κατά `Get-AzureSubscription -Current`) και το λογαριασμό χώρου αποθήκευσης και τη συνδρομή στην οποία έχει αλλάξει από αυτήν τη δέσμη ενεργειών (αποθηκευμένη στη μεταβλητή `$UserSpecifiedSubscription`) και το λογαριασμό χώρου αποθήκευσης, στο εύρος δέσμης ενεργειών. Με την αποθήκευση των τιμών, μπορείτε να χρησιμοποιήσετε μια συνάρτηση, όπως είναι οι `Restore-Subscription`, για να επαναφέρετε το αρχικό τρέχουσα συνδρομή και αποθήκευσης λογαριασμό στην τρέχουσα κατάσταση, εάν έχει αλλάξει την τρέχουσα κατάσταση.|
|Εύρεση AzureVM|Λαμβάνει την καθορισμένη Azure εικονική μηχανή.|
|Μορφή DevTestMessageWithTime|Τοποθετεί μπροστά από την ημερομηνία και ώρα σε ένα μήνυμα. Αυτή η συνάρτηση έχει σχεδιαστεί για μηνύματα που έχουν συνταχθεί για τις ροές σφάλματος και λεπτομερής.|
|Get-AzureSQLDatabaseConnectionString|Κωδικοποιεί μια συμβολοσειρά σύνδεσης για να συνδεθείτε με μια βάση δεδομένων Azure SQL.|
|Get-AzureVMStorage|Επιστρέφει το όνομα του πρώτου λογαριασμού χώρου αποθήκευσης με το μοτίβο ονόματος "devtest*" (με διάκριση πεζών-κεφαλαίων) στην καθορισμένη θέση ή στην ομάδα συσχέτισης. Εάν το "devtest*" λογαριασμού χώρου αποθήκευσης δεν ταιριάζουν με τη θέση ή ομάδα συσχέτισης, η συνάρτηση το παραβλέπει. Πρέπει να καθορίσετε μια θέση ή μια ομάδα συσχέτισης.|
|Get-MSDeployCmd|Επιστρέφει μια εντολή για την εκτέλεση του εργαλείου MsDeploy.exe.|
|Νέα AzureVMEnvironment|Εντοπίζει ή δημιουργεί μια εικονική μηχανή στην εγγραφή που συμφωνεί με τις τιμές στο αρχείο παραμέτρων JSON.|
|Δημοσίευση WebPackage|Χρησιμοποιεί MsDeploy.exe και web Δημοσίευση πακέτου. Αρχείο zip για την ανάπτυξη των πόρων σε μια τοποθεσία Web. Αυτή η συνάρτηση δεν παράγει κανένα αποτέλεσμα. Εάν αποτύχει η κλήση MSDeploy.exe, η συνάρτηση δημιουργεί μια εξαίρεση. Για πιο λεπτομερείς εξόδου, χρησιμοποιήστε το **-λεπτομερής** την επιλογή.|
|Δημοσίευση WebPackageToVM|Επαληθεύει τις τιμές παραμέτρων και, στη συνέχεια, καλεί τη συνάρτηση **WebPackage δημοσίευση** .|
|Ανάγνωση ConfigFile|Επικυρώσει το αρχείο ρύθμισης παραμέτρων JSON και επιστρέφει έναν πίνακα κατακερματισμός επιλεγμένες τιμές.|
|Επαναφορά συνδρομή|Επαναφέρει την τρέχουσα συνδρομή της αρχικής συνδρομής.|
|Δοκιμή AzureModule|Επιστρέφει `$true` εάν η έκδοση εγκατεστημένο λειτουργική μονάδα Azure είναι 0.7.4 ή νεότερη έκδοση. Επιστρέφει `$false` εάν τη λειτουργική μονάδα δεν είναι εγκατεστημένο ή είναι μια παλαιότερη έκδοση. Αυτή η συνάρτηση δεν έχει παραμέτρους.|
|Δοκιμή AzureModuleVersion|Επιστρέφει `$true` εάν η έκδοση του τη λειτουργική μονάδα Azure είναι 0.7.4 ή νεότερη έκδοση. Επιστρέφει `$false` εάν τη λειτουργική μονάδα δεν είναι εγκατεστημένο ή είναι μια παλαιότερη έκδοση. Αυτή η συνάρτηση δεν έχει παραμέτρους.|
|Δοκιμή HttpsUrl|Μετατρέπει τη διεύθυνση URL εισαγωγής σε ένα αντικείμενο System.Uri. Επιστρέφει `$True` εάν η διεύθυνση URL είναι απόλυτες και το σχήμα είναι https. Επιστρέφει `$false` εάν η διεύθυνση URL είναι σχετική, το σχήμα δεν είναι HTTPS ή η συμβολοσειρά εισόδου δεν μπορεί να μετατραπεί σε μια διεύθυνση URL.|
|Δοκιμή μέλους|Επιστρέφει `$true` εάν μια ιδιότητα ή μέθοδο είναι μέλος του αντικειμένου. Διαφορετικά, επιστρέφει την τιμή `$false`.|
|ErrorWithTime εγγραφής|Συντάσσει ένα μήνυμα σφάλματος το πρόθεμα της τρέχουσας ώρας. Αυτή η συνάρτηση καλεί τη συνάρτηση **Μορφή DevTestMessageWithTime** να ξεκινούν την ώρα πριν από την εγγραφή στο μήνυμα στη ροή σφάλματος.|
|HostWithTime εγγραφής|Συντάσσει ένα μήνυμα στο πρόγραμμα κεντρικού υπολογιστή (**Host εγγραφής**) το πρόθεμα της τρέχουσας ώρας. Διαφέρει το εφέ γραφής στο πρόγραμμα του κεντρικού υπολογιστή. Τα περισσότερα προγράμματα που φιλοξενούν του Windows PowerShell εγγραφή αυτά τα μηνύματα σε τυπική εξόδου.|
|VerboseWithTime εγγραφής|Συντάσσει ένα λεπτομερές μήνυμα με την τρέχουσα ώρα το πρόθεμα. Επειδή καλεί **Λεπτομερές εγγραφής**, το μήνυμα εμφανίζει μόνο όταν η δέσμη ενεργειών εκτελείται με την παράμετρο **λεπτομερές** ή όταν η προτίμηση **VerbosePreference** έχει οριστεί για να **συνεχίσετε**.|

**Δημοσίευση εφαρμογή Web**

|Όνομα συνάρτησης|Περιγραφή|
|---|---|
|Νέα AzureWebApplicationEnvironment|Δημιουργεί Azure πόρους, όπως μια τοποθεσία Web ή μια εικονική μηχανή.|
|Νέα WebDeployPackage|Αυτή η συνάρτηση δεν έχει υλοποιηθεί. Μπορείτε να προσθέσετε εντολές σε αυτήν τη συνάρτηση για να δημιουργήσετε το έργο σας.|
|Δημοσίευση AzureWebApplication|Δημοσιεύει μια εφαρμογή web για Azure.|
|Δημοσίευση εφαρμογή Web|Δημιουργεί και την ανάπτυξη εφαρμογών Web, εικονικές μηχανές, βάσεις δεδομένων SQL και λογαριασμούς χώρου αποθήκευσης για ένα έργο Visual Studio web.|
|Δοκιμή-εφαρμογή Web|Αυτή η συνάρτηση δεν έχει υλοποιηθεί. Μπορείτε να προσθέσετε εντολές σε αυτήν τη συνάρτηση για να δοκιμάσετε την εφαρμογή σας.|

## <a name="next-steps"></a>Επόμενα βήματα

Μάθετε περισσότερα σχετικά με τις δέσμες ενεργειών PowerShell διαβάζοντας [δέσμες ενεργειών με το Windows PowerShell](https://technet.microsoft.com/library/bb978526.aspx) και να δείτε άλλες δεσμών ενεργειών του Azure PowerShell στο [Κέντρο δεσμών ενεργειών](https://azure.microsoft.com/documentation/scripts/).
