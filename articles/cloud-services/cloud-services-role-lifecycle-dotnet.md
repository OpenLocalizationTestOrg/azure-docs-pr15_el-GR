<properties 
pageTitle="Χειρισμός συμβάντα κύκλου ζωής της υπηρεσίας Cloud | Microsoft Azure" 
description="Μάθετε πώς μπορείτε να χρησιμοποιήσετε τις μεθόδους κύκλου ζωής ενός ρόλου υπηρεσία στο Cloud στο .NET" 
services="cloud-services" 
documentationCenter=".net" 
authors="Thraka" 
manager="timlt" 
editor=""/>
<tags 
ms.service="cloud-services" 
ms.workload="tbd" 
ms.tgt_pltfrm="na" 
ms.devlang="na" 
ms.topic="article" 
ms.date="09/06/2016" 
ms.author="adegeo"/>

# <a name="customize-the-lifecycle-of-a-web-or-worker-role-in-net"></a>Προσαρμογή του κύκλου ζωής ενός ρόλου Web ή εργαζόμενου στο .NET

Όταν δημιουργείτε ένα ρόλο εργασίας, μπορείτε να επεκτείνετε την κλάση [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) η οποία παρέχει μεθόδους για να παρακάμψετε που σας επιτρέπουν να αποκρίνεται σε συμβάντα κύκλου ζωής. Για τους ρόλους web τάξης αυτή είναι προαιρετική, που πρέπει να χρησιμοποιήσετε για να αποκρίνεται σε συμβάντα κύκλου ζωής.

## <a name="extend-the-roleentrypoint-class"></a>Επέκταση της κλάσης RoleEntryPoint

Η κλάση [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) περιλαμβάνει μεθόδους που καλούνται από Azure όταν το **ξεκινά**, **εκτελείται**ή **διακόπτει** ένα ρόλο web ή εργασίας. Προαιρετικά, μπορείτε να παρακάμψετε τις παρακάτω μεθόδους για τη Διαχείριση ρόλων προετοιμασίας, ακολουθίες τερματισμού ρόλων ή το νήμα εκτέλεσης του ρόλου. 

Κατά την επέκταση **RoleEntryPoint**, θα πρέπει να λάβετε υπόψη τις ακόλουθες συμπεριφορές από τις μεθόδους:

-   Οι μέθοδοι [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) και [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) επιστρέφει μια τιμή boolean, ώστε να είναι δυνατό να επιστρέψει την **τιμή false** από τις παρακάτω μεθόδους.

     Εάν ο κώδικας επιστρέφει **false**, η διαδικασία ρόλο τερματίζεται απότομα, χωρίς την εκτέλεση οποιασδήποτε ακολουθίας τερματισμού ενδέχεται να έχετε στη θέση. Σε γενικές γραμμές, θα πρέπει να αποφύγετε επιστρέφει **false** από τη μέθοδο **OnStart** .
     
-   Οποιαδήποτε μη εντοπισμένη εξαίρεση μέσα σε μια υπερφόρτωσης μιας μεθόδου **RoleEntryPoint** εκλαμβάνεται ως μια ανεπίλυτη εξαίρεση.

     Εάν παρουσιάζεται μια εξαίρεση μέσα σε μία από τις μεθόδους κύκλου ζωής, Azure θα αυξήσει το συμβάν [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) και, στη συνέχεια, η διεργασία τερματίζεται. Αφού ο ρόλος σας έχει μεταφερθεί χωρίς σύνδεση, θα γίνει επανεκκίνηση από Azure. Όταν προκύπτει μια ανεπίλυτη εξαίρεση, δεν θα αυξηθεί το συμβάν [διακοπής](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) και η μέθοδος **OnStop** δεν καλείται.

Εάν ο ρόλος σας δεν ξεκινά ή είναι Ανακύκλωσης μεταξύ της την προετοιμασία, απασχολημένος, και διακοπή μελών, τον κωδικό μπορεί να είναι εμφάνιση ανεπίλυτη εξαίρεσης μέσα σε ένα από τα συμβάντα κύκλου ζωής επανεκκίνηση του το ρόλο κάθε φορά. Σε αυτήν την περίπτωση, χρησιμοποιήστε το συμβάν [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) για να προσδιορίσετε την αιτία της εξαίρεσης και να χειριστείτε σωστά. Ο ρόλος σας μπορεί να επιστρέφει επίσης από τη μέθοδο [Εκτέλεση](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) , η οποία έχει ως αποτέλεσμα το ρόλο για να ξεκινήσετε ξανά. Για περισσότερες πληροφορίες σχετικά με καταστάσεις ανάπτυξης, ανατρέξτε στο θέμα [Κοινά ζητήματα που προκαλούν ρόλων σε Ανακύκλωσης](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).

> [AZURE.NOTE] Εάν χρησιμοποιείτε τα **Εργαλεία Azure για το Microsoft Visual Studio** για να αναπτύξετε την εφαρμογή σας, τα πρότυπα του έργου ρόλο επέκταση αυτόματα την κλάση **RoleEntryPoint** για εσάς, με τα αρχεία *WebRole.cs* και *WorkerRole.cs* .

## <a name="onstart-method"></a>Μέθοδος OnStart

Η μέθοδος **OnStart** καλείται κατά την περίοδο λειτουργίας του ρόλου έφερε online με Azure. Ενώ εκτελείται ο κώδικας OnStart, την παρουσία ρόλος έχει επισημανθεί ως **απασχολημένος** και δεν υπάρχει κίνηση εξωτερικό θα κατευθύνεται σε αυτό από τη μονάδα εξισορρόπησης φόρτου. Μπορείτε να παρακάμψετε αυτήν τη μέθοδο για να εκτελέσετε εργασία προετοιμασίας, όπως την εφαρμογή προγράμματα χειρισμού συμβάντων και ξεκινώντας [Διαγνωστικά Azure](cloud-services-how-to-monitor.md).

Εάν **OnStart** επιστρέφει την **τιμή true**, η παρουσία έχει προετοιμαστεί με επιτυχία και Azure καλεί τη μέθοδο **RoleEntryPoint.Run** . Εάν το **OnStart** επιστρέφει **false**, το ρόλο τερματίζει αμέσως, χωρίς να εκτελέσετε οποιαδήποτε ακολουθίες προγραμματισμένη τερματισμού.

Το ακόλουθο παράδειγμα κώδικα δείχνει πώς μπορείτε να παρακάμψετε τη μέθοδο **OnStart** . Αυτή η μέθοδος ρυθμίζει τις παραμέτρους και ξεκινά μια οθόνη διαγνωστικών όταν η παρουσία ρόλο ξεκινά και ρυθμίζει μεταφοράς των δεδομένων καταγραφής σε ένα λογαριασμό του χώρου αποθήκευσης:

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a>Μέθοδος OnStop

Η μέθοδος **OnStop** καλείται αφού μια παρουσία ρόλος έχει ληφθεί χωρίς σύνδεση με Azure και πριν από την έξοδο από τη διαδικασία. Μπορείτε να παρακάμψετε αυτήν τη μέθοδο για να καλέσετε κώδικα που απαιτείται για την παρουσία ρόλο για σωστός τερματισμός.

> [AZURE.IMPORTANT] Κώδικας που εκτελείται στη μέθοδο **OnStop** έχει περιορισμένο χρονικό διάστημα για να ολοκληρώσετε κατά ονομάζεται για λόγους εκτός από έναν τερματισμό προετοιμασία από το χρήστη. Αφού παρέλθει αυτήν τη στιγμή, η διαδικασία τερματίζεται, έτσι θα πρέπει να βεβαιωθείτε ότι τον κωδικό στο **OnStop** μέθοδος μπορεί να εκτελέσετε γρήγορα ή επιτρέπει δεν εκτελείται ολοκλήρωσης. Η μέθοδος **OnStop** καλείται μετά το συμβάν **Διακοπή** ενεργοποιείται.


## <a name="run-method"></a>Εκτελέστε τη μέθοδο

Μπορείτε να παρακάμψετε τη μέθοδο **Εκτέλεση** για να υλοποιήσετε ένα νήμα μεγάλη διάρκεια εκτέλεσης για την παρουσία ρόλο.

Παράκαμψη της μεθόδου **Εκτέλεση** δεν είναι απαραίτητος. προεπιλεγμένη υλοποίηση ξεκινά ένα νήμα που βρίσκεται σε αναστολή λειτουργίας για πάντα. Εάν μπορείτε να παρακάμψετε τη μέθοδο **Εκτέλεση** , τον κωδικό θα πρέπει να αποκλείσετε απεριόριστο χρονικό διάστημα. Εάν η μέθοδος **Εκτέλεση** επιστρέφει, ο ρόλος είναι αυτόματα ομαλά τοποθέτησή; με άλλα λόγια, Azure παρουσιάζει το συμβάν **διακοπής** και καλεί τη μέθοδο **OnStop** , ώστε να σας ακολουθίες τερματισμού μπορεί να εκτελεστεί πριν από το ρόλο για εργασία χωρίς σύνδεση.


### <a name="implementing-the-aspnet-lifecycle-methods-for-a-web-role"></a>Εφαρμογή τις μεθόδους κύκλου ζωής ASP.NET για ένα ρόλο web

Μπορείτε να χρησιμοποιήσετε τις μεθόδους κύκλου ζωής ASP.NET, εκτός από αυτούς που παρέχεται από την κλάση **RoleEntryPoint** , για να διαχειριστείτε προετοιμασίας και τερματισμού ακολουθίες για ένα ρόλο web. Αυτό μπορεί να είναι χρήσιμο για λόγους συμβατότητας Εάν μεταφορά μια υπάρχουσα εφαρμογή ASP.NET για Azure. Οι μέθοδοι κύκλου ζωής ASP.NET ονομάζονται από μέσα τις μεθόδους **RoleEntryPoint** . Το **εφαρμογής\_Έναρξη** μέθοδος καλείται αφού ολοκληρωθεί η μέθοδος **RoleEntryPoint.OnStart** . Το **εφαρμογής\_τέλος** μέθοδος καλείται πριν από την κλήση της μεθόδου **RoleEntryPoint.OnStop** .

## <a name="next-steps"></a>Επόμενα βήματα
Μάθετε πώς μπορείτε να [δημιουργήσετε ένα πακέτο υπηρεσία cloud](cloud-services-model-and-package.md).