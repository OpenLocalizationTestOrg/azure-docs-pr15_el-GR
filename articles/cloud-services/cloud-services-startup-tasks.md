<properties 
pageTitle="Εκτέλεση εργασιών εκκίνησης στις υπηρεσίες Azure Cloud | Microsoft Azure" 
description="Εργασίες εκκίνησης να προετοιμάσετε το περιβάλλον σας υπηρεσία cloud για την εφαρμογή σας. Αυτό σας μαθαίνει πώς λειτουργούν οι εργασίες εκκίνησης και πώς μπορείτε να τους" 
services="cloud-services" 
documentationCenter="" 
authors="Thraka" 
manager="timlt" 
editor=""/>
<tags 
ms.service="cloud-services" 
ms.workload="tbd" 
ms.tgt_pltfrm="na" 
ms.devlang="na" 
ms.topic="article" 
ms.date="09/06/2016" 
ms.author="adegeo"/>



# <a name="how-to-configure-and-run-startup-tasks-for-a-cloud-service"></a>Πώς μπορείτε να ρυθμίσετε τις παραμέτρους και να εκτελέσετε εργασίες εκκίνησης για μια υπηρεσία στο cloud

Μπορείτε να χρησιμοποιήσετε εργασίες εκκίνησης για την εκτέλεση λειτουργιών πριν από την εκκίνηση ένα ρόλο. Λειτουργίες που ενδέχεται να θέλετε να εκτελέσετε περιλαμβάνουν την εγκατάσταση ενός στοιχείου, καταχώρηση στοιχείων COM, τη ρύθμιση κλειδιά μητρώου ή η εκκίνηση μιας μεγάλης διάρκειας διαδικασίας.

>[AZURE.NOTE] Εργασίες εκκίνησης δεν είναι που εφαρμόζονται σε εικονικές μηχανές, μόνο σε Cloud υπηρεσίας Web και τους ρόλους εργασίας.

## <a name="how-startup-tasks-work"></a>Πώς λειτουργούν οι εργασίες εκκίνησης

Εκκίνηση εργασίες είναι ενέργειες που έχουν ληφθεί πριν ρόλους σας ξεκινούν και ορίζονται στο αρχείο [ServiceDefinition.csdef] , χρησιμοποιώντας το στοιχείο [εργασίας] μέσα στο στοιχείο [εκκίνησης] . Συνήθεις εργασίες εκκίνησης είναι αρχεία δέσμης, αλλά μπορούν να είναι επίσης Κονσόλα εφαρμογές ή δέσμη αρχεία που ξεκινούν δεσμών ενεργειών του PowerShell.

Μεταβλητές περιβάλλοντος μεταβίβαση πληροφοριών σε μια εργασία εκκίνησης και τοπικού χώρου αποθήκευσης μπορεί να χρησιμοποιηθεί για τη μεταβίβαση πληροφορίες από μια εργασία εκκίνησης. Για παράδειγμα, μια μεταβλητή περιβάλλοντος μπορεί να καθορίσει τη διαδρομή προς ένα πρόγραμμα που θέλετε να εγκαταστήσετε και μπορούν να εγγραφούν αρχείων με τον τοπικό χώρο αποθήκευσης που μπορείτε, στη συνέχεια, να διαβάσετε αργότερα με ρόλους σας.

Εργασία εκκίνησης σας μπορεί να συνδεθεί πληροφορίες και σφάλματα στον κατάλογο που καθορίζεται από τη μεταβλητή περιβάλλοντος **TEMP** . Κατά τη διάρκεια της εργασίας εκκίνησης, τη μεταβλητή περιβάλλοντος **TEMP** αναλύεται το *C:\\πόρους\\temp\\[guid]. [ όνομα ρόλου]\\RoleTemp* καταλόγου όταν εκτελείται σε στο cloud.

Εργασίες εκκίνησης μπορεί επίσης να εκτελεστεί πολλές φορές μεταξύ επανεκκίνηση του. Για παράδειγμα, την εργασία εκκίνησης θα εκτελείται κάθε φορά που το ρόλο ανακυκλώνει και ανακυκλώνει ρόλο ενδέχεται να μην πάντα περιλαμβάνουν επανεκκίνηση. Εργασίες εκκίνησης πρέπει να γράφονται με τον τρόπο που σας επιτρέπει να εκτελέσετε περισσότερες από μία φορές χωρίς προβλήματα.

Εργασίες εκκίνησης πρέπει να τελειώνει με ένα **επίπεδο σφαλμάτων** (ή κωδικό εξόδου) 0 για τη διαδικασία εκκίνησης για να ολοκληρωθεί. Εάν μια εργασία εκκίνησης τελειώνει με μια μη μηδενική **επίπεδο σφαλμάτων**, δεν θα ξεκινήσει το ρόλο.


## <a name="role-startup-order"></a>Σειρά εκκίνησης ρόλων

Η ακόλουθη λίστα παραθέτει τη διαδικασία εκκίνησης ρόλος στο Azure:

1. Η παρουσία έχει επισημανθεί ως **Έναρξη** και δεν λαμβάνει την κυκλοφορία.

2. Όλες οι εργασίες εκκίνησης εκτελούνται σύμφωνα με τους χαρακτηριστικό **Τύπος εργασίας** .
    - Οι **απλές** εργασίες εκτελούνται συγχρονισμένα, μία κάθε φορά.
    - Οι εργασίες **φόντου** και **πρώτου πλάνου** ξεκινούν ασύγχρονα, παράλληλα με την εργασία εκκίνησης.  
       
    > [AZURE.WARNING] Των υπηρεσιών IIS ενδέχεται να μην είναι πλήρως ρυθμιστεί κατά τη διάρκεια του σταδίου εργασίας εκκίνηση της διαδικασίας εκκίνησης, δεδομένων για το συγκεκριμένο ρόλο ίσως να μην είναι διαθέσιμη. Εκκίνηση εργασίες που απαιτούν δεδομένων για το συγκεκριμένο ρόλο πρέπει να χρησιμοποιήσετε [Microsoft.WindowsAzure.ServiceRuntime.RoleEntryPoint.OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx).

3. Ξεκινήσει η διεργασία κεντρικού υπολογιστή ρόλο και δημιουργείται η τοποθεσία των υπηρεσιών IIS.

4. Η μέθοδος [Microsoft.WindowsAzure.ServiceRuntime.RoleEntryPoint.OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) καλείται.

5. Η παρουσία έχει επισημανθεί ως **έτοιμοι** και κυκλοφορία δρομολογείται για να την παρουσία.

6. Η μέθοδος [Microsoft.WindowsAzure.ServiceRuntime.RoleEntryPoint.Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) καλείται.


## <a name="example-of-a-startup-task"></a>Παράδειγμα μιας εργασίας εκκίνησης

Εργασίες εκκίνησης ορίζονται στο αρχείο [ServiceDefinition.csdef] , στο στοιχείο **εργασίας** . Το χαρακτηριστικό **εντολών** Καθορίζει το όνομα και τις παραμέτρους του αρχείου δέσμης εκκίνησης ή εντολή κονσόλας, το χαρακτηριστικό **του ExecutionContext που έχει** Καθορίζει το επίπεδο δικαιωμάτων της εργασίας εκκίνησης και το χαρακτηριστικό **Τύπος εργασίας** καθορίζει τον τρόπο θα εκτελεστεί η εργασία.

Σε αυτό το παράδειγμα, μια μεταβλητή περιβάλλοντος, **MyVersionNumber**, δημιουργείται για την εργασία εκκίνησης και ορίστε την τιμή "**1.0.0.0**".

**ServiceDefinition.csdef**:

```xml
<Startup>
    <Task commandLine="Startup.cmd" executionContext="limited" taskType="simple" >
        <Environment>
            <Variable name="MyVersionNumber" value="1.0.0.0" />
        </Environment>
    </Task>
</Startup>
```

Στο παρακάτω παράδειγμα, το αρχείο δέσμης **Startup.cmd** συντάσσει στη γραμμή "την τρέχουσα έκδοση είναι 1.0.0.0" το αρχείο StartupLog.txt στον κατάλογο που καθορίζεται από τη μεταβλητή περιβάλλοντος TEMP. Το `EXIT /B 0` γραμμής εξασφαλίζει ότι η εργασία εκκίνησης τελειώνει με ένα **επίπεδο σφαλμάτων** 0.

```cmd
ECHO The current version is %MyVersionNumber% >> "%TEMP%\StartupLog.txt" 2>&1
EXIT /B 0
```

> [AZURE.NOTE] Στο Visual Studio, η ιδιότητα **αντιγράψετε σε κατάλογο αποτελεσμάτων** για το αρχείο δέσμης εκκίνησης θα πρέπει να οριστεί σε **Πάντα αντίγραφο** για να βεβαιωθείτε ότι το αρχείο δέσμης εκκίνησης έχει αναπτυχθεί σωστά στο έργο σας σε Azure (**approot\\Ανακύκλωσης** για τους ρόλους Web και **approot** για ρόλους εργαζόμενου).

## <a name="description-of-task-attributes"></a>Περιγραφή της εργασίας χαρακτηριστικά

Παρακάτω περιγράφονται τα χαρακτηριστικά του στοιχείου **εργασίας** στο αρχείο [ServiceDefinition.csdef] :

**γραμμή εντολών** - Καθορίζει τη γραμμή εντολών για την εργασία εκκίνησης:

- Η εντολή, με παραμέτρους προαιρετικό γραμμής εντολών, που ξεκινά η εργασία εκκίνησης.
- Συχνά αυτό είναι το όνομα του αρχείου ενός αρχείου δέσμης. cmd. ή .bat.
- Η εργασία είναι σε σχέση με το AppRoot\\Κάδου φάκελο για την ανάπτυξη. Μεταβλητές περιβάλλοντος δεν έχουν αναπτυχθεί στον καθορισμό τη διαδρομή και το αρχείο της εργασίας. Εάν απαιτείται περιβάλλον επέκτασης, μπορείτε να δημιουργήσετε μια δέσμη ενεργειών μικρές. cmd. που καλεί την εργασία σας εκκίνησης.
- Μπορεί να είναι μια εφαρμογή κονσόλας ή ένα αρχείο δέσμης που ξεκινά μια [δέσμη ενεργειών του PowerShell](cloud-services-startup-tasks-common.md#create-a-powershell-startup-task).

**του ExecutionContext που έχει** - Καθορίζει το επίπεδο δικαιωμάτων για την εργασία εκκίνησης. Το επίπεδο δικαιωμάτων μπορεί να περιορίζεται ή αυξημένα:

- **περιορισμένη**  
Η εργασία εκκίνησης εκτελείται με τα ίδια δικαιώματα με το ρόλο. Όταν το χαρακτηριστικό **του ExecutionContext που έχει** για το στοιχείο [χρόνου εκτέλεσης] επίσης είναι **περιορισμένος**, τότε χρησιμοποιούνται δικαιώματα χρήστη.

- **αναβαθμισμένα δικαιώματα**  
Η εργασία εκκίνησης εκτελείται με δικαιώματα διαχειριστή. Αυτό σας επιτρέπει εκκίνησης εργασίες για να εγκαταστήσετε τα προγράμματα, να κάνετε αλλαγές στη ρύθμιση παραμέτρων των υπηρεσιών IIS, να πραγματοποιήσετε αλλαγές στο μητρώο και άλλες εργασίες διαχειριστή επιπέδου, χωρίς να αυξήσετε το επίπεδο δικαιωμάτων του ρόλου ίδια.  

> [AZURE.NOTE] Το επίπεδο δικαιωμάτων εκκίνησης εργασίας δεν πρέπει να είναι το ίδιο με το ρόλο ίδια.

**Τύπος εργασίας** - καθορίζει τον τρόπο που εκτελείται μια εργασία εκκίνησης.

- **απλή**  
Εργασίες εκτελούνται συγχρονισμένα, μία κάθε φορά, με τη σειρά που καθορίζεται στο αρχείο [ServiceDefinition.csdef] . Όταν μια **απλή** λειτουργία εκκίνησης τελειώνει σε ένα **επίπεδο σφαλμάτων** 0, εκτελεστεί η επόμενη εργασία **απλό** εκκίνησης. Εάν υπάρχουν περισσότερες **απλές** εργασίες εκκίνησης για την εκτέλεση, θα ξεκινήσει το ίδιο το ρόλο.   

    > [AZURE.NOTE] Εάν η **απλή** εργασία τελειώνει με μια μη μηδενική **επίπεδο σφαλμάτων**, θα αποκλειστούν την παρουσία. Οι επόμενες **απλές** εργασίες εκκίνησης και ο ρόλος μόνη της, δεν θα ξεκινήσει.

    Για να βεβαιωθείτε ότι το αρχείο δέσμης τελειώνει με ένα **επίπεδο σφαλμάτων** 0, εκτέλεση της εντολής `EXIT /B 0` στο τέλος της διεργασίας αρχείο δέσμης.

- **φόντο**  
Εργασίες έχουν εκτελεστεί ασύγχρονα, παράλληλα με την εκκίνηση του ρόλου.

- **πρώτο πλάνο**  
Εργασίες έχουν εκτελεστεί ασύγχρονα, παράλληλα με την εκκίνηση του ρόλου. Το πλήκτρο διαφορά μεταξύ ενός **πρώτου πλάνου** και μια εργασία στο **παρασκήνιο** είναι ότι μια εργασία **πρώτου πλάνου** εμποδίζει το ρόλο από ανακύκλωσης ή τερματισμός μέχρι η εργασία έχει λήξει. Τις εργασίες **παρασκηνίου** δεν έχουν αυτόν τον περιορισμό.

## <a name="environment-variables"></a>Μεταβλητές περιβάλλοντος

Μεταβλητές περιβάλλοντος είναι ένας τρόπος για να μεταβιβάσετε πληροφορίες σε μια εργασία εκκίνησης. Για παράδειγμα, μπορείτε να τοποθετήσετε τη διαδρομή σε ένα blob που περιέχει ένα πρόγραμμα για την εγκατάσταση, ή οι αριθμοί θυρών που θα χρησιμοποιήσει ο ρόλος σας ή ρυθμίσεις για τις δυνατότητες του στοιχείου ελέγχου της εργασίας σας εκκίνησης.

Υπάρχουν δύο είδη των μεταβλητών περιβάλλοντος για τις εργασίες εκκίνησης. μεταβλητές στατικής περιβάλλοντος και μεταβλητές περιβάλλοντος που βασίζεται σε μέλη της κλάσης [RoleEnvironment] . Και τα δύο βρίσκονται στην ενότητα [περιβάλλον] του αρχείου [ServiceDefinition.csdef] και και τα δύο χρησιμοποιούν το [μεταβλητής] χαρακτηριστικό στοιχείο και το **όνομα** .

Μεταβλητές στατικής περιβάλλοντος χρησιμοποιεί το χαρακτηριστικό **value** του στοιχείου [μεταβλητών] . Το παραπάνω παράδειγμα δημιουργεί τη μεταβλητή περιβάλλοντος **MyVersionNumber** , το οποίο έχει μια στατική τιμή "**1.0.0.0**". Ένα άλλο παράδειγμα είναι να δημιουργήσετε μια μεταβλητή περιβάλλοντος **StagingOrProduction** που μπορείτε να ρυθμίσετε με μη αυτόματο τρόπο να τιμές "**ενδιάμεσου**" ή "**παραγωγή**" για την εκτέλεση ενεργειών διαφορετικό εκκίνησης με βάση την τιμή της μεταβλητής περιβάλλοντος **StagingOrProduction** .

Μεταβλητές περιβάλλοντος που βασίζεται σε μέλη της κλάσης RoleEnvironment δεν χρησιμοποιούν το χαρακτηριστικό **value** του στοιχείου [μεταβλητών] . Αντί για αυτό, το θυγατρικό στοιχείο [RoleInstanceValue] , με την κατάλληλη **XPath** τιμή του χαρακτηριστικού, που χρησιμοποιούνται για να δημιουργήσετε μια μεταβλητή περιβάλλοντος που βασίζεται σε ένα συγκεκριμένο μέλος της κλάσης [RoleEnvironment] . Μπορείτε να βρείτε τιμές για το χαρακτηριστικό **XPath** για να αποκτήσετε πρόσβαση σε διάφορες τιμές [RoleEnvironment] [εδώ](cloud-services-role-config-xpath.md).



Για παράδειγμα, για να δημιουργήσετε μια μεταβλητή περιβάλλοντος που είναι "**true**" όταν εκτελείται η παρουσία της προσομοίωσης υπολογισμού και "**false**" όταν εκτελείται στο cloud, χρησιμοποιήστε τα ακόλουθα στοιχεία [μεταβλητή] και [RoleInstanceValue] :

```xml
<Startup>
    <Task commandLine="Startup.cmd" executionContext="limited" taskType="simple">
        <Environment>
    
            <!-- Create the environment variable that informs the startup task whether it is running
                in the Compute Emulator or in the cloud. "%ComputeEmulatorRunning%"=="true" when
                running in the Compute Emulator, "%ComputeEmulatorRunning%"=="false" when running
                in the cloud. -->
    
            <Variable name="ComputeEmulatorRunning">
                <RoleInstanceValue xpath="/RoleEnvironment/Deployment/@emulated" />
            </Variable>
    
        </Environment>
    </Task>
</Startup>
```

## <a name="next-steps"></a>Επόμενα βήματα
Μάθετε πώς να εκτελείτε ορισμένες [συνηθισμένες εργασίες εκκίνησης](cloud-services-startup-tasks-common.md) με την υπηρεσία Cloud.

Το [πακέτο](cloud-services-model-and-package.md) σας υπηρεσία στο Cloud.  


[ServiceDefinition.csdef]: cloud-services-model-and-package.md#csdef
[Εργασία]: https://msdn.microsoft.com/library/azure/gg557552.aspx#Task
[Εκκίνησης]: https://msdn.microsoft.com/library/azure/gg557552.aspx#Startup
[Χρόνος εκτέλεσης]: https://msdn.microsoft.com/library/azure/gg557552.aspx#Runtime
[Περιβάλλον]: https://msdn.microsoft.com/library/azure/gg557552.aspx#Environment
[Μεταβλητή]: https://msdn.microsoft.com/library/azure/gg557552.aspx#Variable
[RoleInstanceValue]: https://msdn.microsoft.com/library/azure/gg557552.aspx#RoleInstanceValue
[RoleEnvironment]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.aspx