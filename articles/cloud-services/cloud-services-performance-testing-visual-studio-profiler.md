<properties 
    pageTitle="Δημιουργία προφίλ μια υπηρεσία Cloud τοπικά στο το προσομοίωσης υπολογισμού | Microsoft Azure" 
    services="cloud-services"
    description="Διερεύνηση θεμάτων επιδόσεων στις υπηρεσίες cloud με το Visual Studio profiler" 
    documentationCenter=""
    authors="TomArcher" 
    manager="douge" 
    editor=""
    tags="" 
    />

<tags 
    ms.service="cloud-services" 
    ms.workload="na" 
    ms.tgt_pltfrm="na" 
    ms.devlang="multiple" 
    ms.topic="article" 
    ms.date="07/30/2016" 
    ms.author="tarcher"/>

# <a name="testing-the-performance-of-a-cloud-service-locally-in-the-azure-compute-emulator-using-the-visual-studio-profiler"></a>Δοκιμή τις επιδόσεις της μια υπηρεσία Cloud τοπικά στο το Azure υπολογισμού προσομοίωσης με χρήση του Visual Studio Profiler

Διάφορα εργαλεία και τεχνικές είναι διαθέσιμες για σκοπούς δοκιμής τις επιδόσεις της υπηρεσίες cloud.
Όταν δημοσιεύετε μια υπηρεσία cloud Azure, μπορείτε να έχετε Visual Studio συλλογή δεδομένων προφίλ και, στη συνέχεια, να το ανάλυση τοπικά, όπως περιγράφεται στο θέμα [Δημιουργία προφίλ μια εφαρμογή του Azure][1].
Μπορείτε επίσης να χρησιμοποιήσετε εργαλεία διαγνωστικού ελέγχου για να παρακολουθείτε μια ποικιλία μετρητές επιδόσεων, όπως περιγράφεται στο [Χρήση μετρητών επιδόσεων στο Azure][2].
Μπορεί επίσης να θέλετε να προφίλ την εφαρμογή σας τοπικά στο το προσομοίωσης υπολογισμού πριν από την ανάπτυξή του στο cloud.

Σε αυτό το άρθρο περιγράφει τη μέθοδο δειγματοληψία CPU του προφίλ, που μπορούν να γίνουν τοπικά σε το προσομοίωσης. Δειγματοληψία CPU είναι μια μέθοδο δημιουργίας προφίλ που δεν είναι πολύ ενοχλητικές. Σε διάστημα που έχει οριστεί ως δειγματοληψία, η δημιουργία προφίλ δημιουργεί ένα στιγμιότυπο της στοίβας κλήσεων. Τα δεδομένα που συλλέγονται σε μια χρονική περίοδο, και εμφανίζονται σε μια αναφορά. Δημιουργία προφίλ αυτή η μέθοδος έχει την τάση να υποδείξετε πού σε μια εφαρμογή υπολογιστικά εντατική περισσότερες εργασίες CPU γίνεται η.  Αυτό σας δίνει τη δυνατότητα να εστιάσετε στην "συντόμευσης διαδρομή" όπου η εφαρμογή σας είναι ξοδεύετε τον περισσότερο χρόνο.



## <a name="1-configure-visual-studio-for-profiling"></a>1: ρύθμιση παραμέτρων του Visual Studio για τη δημιουργία προφίλ

Πρώτα, υπάρχουν μερικές επιλογές ρύθμισης παραμέτρων του Visual Studio που ενδέχεται να είναι χρήσιμες κατά τη δημιουργία προφίλ. Για να κάνετε νόημα των προφίλ αναφορών, θα χρειαστείτε σύμβολα (αρχεία .pdb) για την εφαρμογή και επίσης σύμβολα για βιβλιοθήκες του συστήματος. Που θα θέλετε να βεβαιωθείτε ότι μπορείτε να κάνετε αναφορά τους διακομιστές διαθέσιμη σύμβολο. Για να το κάνετε αυτό, στο μενού " **Εργαλεία** " στο Visual Studio, επιλέξτε **Επιλογές**και, στη συνέχεια, επιλέξτε **Εντοπισμός σφαλμάτων**, στη συνέχεια, **σύμβολα**. Βεβαιωθείτε ότι οι διακομιστές σύμβολο Microsoft εμφανίζεται στην περιοχή **σύμβολο θέσεις αρχείων (.pdb)**.  Μπορείτε επίσης να αναφερθείτε http://referencesource.microsoft.com/symbols, που μπορεί να έχουν επιπλέον σύμβολο αρχεία.

![Επιλογές συμβόλου][4]

Εάν θέλετε, μπορείτε να απλοποιήσετε τις αναφορές που δημιουργεί το profiler, ορίζοντας απλώς μου κώδικα. Μόλις μου κωδικό με δυνατότητα, στοίβες κλήσης συνάρτησης είναι απλοποιηθεί, ώστε να κλήσεις εντελώς εσωτερικό σε βιβλιοθήκες και το .NET Framework είναι κρυφές από τις αναφορές. Στο μενού **Εργαλεία** , επιλέξτε **Επιλογές**. Στη συνέχεια, αναπτύξτε τον κόμβο **Εργαλεία επιδόσεων** και επιλέξτε **Γενική**. Επιλέξτε το πλαίσιο ελέγχου για **Ενεργοποίηση μόνο μου κωδικό για τις αναφορές profiler**.

![Μόνο οι επιλογές μου κώδικα][17]

Μπορείτε να χρησιμοποιήσετε αυτές τις οδηγίες με ένα υπάρχον έργο ή με ένα νέο έργο.  Εάν δημιουργήσετε ένα νέο έργο για να δοκιμάσετε τις τεχνικές που περιγράφεται παρακάτω, επιλέξτε ένα έργο C# **Azure υπηρεσία Cloud** , και επιλέξτε ένα **Ρόλο Web** και ένα **Ρόλο εργαζόμενου**.

![Azure υπηρεσία Cloud έργου ρόλων][5]

Για παράδειγμα σκοπούς, προσθέστε ορισμένες κώδικα στο έργο σας που διαρκεί πολύ χρόνο και παρουσιάζει κάποιο πρόβλημα επιδόσεων εμφανή. Για παράδειγμα, προσθέστε τον ακόλουθο κώδικα σε ένα έργο ρόλο εργασίας:

    public class Concatenator
    {
        public static string Concatenate(int number)
        {
            int count;
            string s = "";
            for (count = 0; count < number; count++)
            {
                s += "\n" + count.ToString();
            }
            return s;
        }
    }

Η κλήση αυτόν τον κωδικό από τη μέθοδο RunAsync στην τάξη RoleEntryPoint προέρχεται το ρόλο του εργαζόμενου. (Αγνοήσετε την προειδοποίηση σχετικά με τη μέθοδο που εκτελείται τη σύγχρονη.)

        private async Task RunAsync(CancellationToken cancellationToken)
        {
            // TODO: Replace the following with your own logic.
            while (!cancellationToken.IsCancellationRequested)
            {
                Trace.TraceInformation("Working");
                Concatenator.Concatenate(10000);
            }
        }

Δημιουργία και εκτέλεση τοπικά την υπηρεσία cloud χωρίς τον εντοπισμό σφαλμάτων (Ctrl + F5), με τη ρύθμιση παραμέτρων λύσης Ορισμός **έκδοση**. Αυτό εξασφαλίζει ότι όλα τα αρχεία και τους φακέλους δημιουργούνται για την εκτέλεση της εφαρμογής τοπικά και εξασφαλίζει ότι όλα τα emulators έχουν ξεκινήσει. Ξεκινήστε τον υπολογισμό προσομοίωσης περιβάλλον εργασίας Χρήστη του από τη γραμμή εργασιών για να βεβαιωθείτε ότι εκτελείται ο ρόλος σας εργασίας.

## <a name="2-attach-to-a-process"></a>2: Επισύναψη σε μια διαδικασία

Αντί για δημιουργία προφίλ την εφαρμογή από την αρχική του Visual Studio 2010 IDE, πρέπει να επισυνάψετε το profiler μια διεργασία που εκτελείται. 

Για να επισυνάψετε το profiler σε μια διαδικασία, στο μενού " **ανάλυση** ", επιλέξτε **Profiler** και **Επισύναψη/αποσύνδεση**.

![Επισύναψη επιλογή προφίλ][6]

Για ένα ρόλο εργαζόμενου, βρείτε τη διαδικασία WaWorkerHost.exe.

![Διαδικασία WaWorkerHost][7]

Εάν το φάκελο του έργου σας βρίσκεται σε μια μονάδα δίσκου δικτύου, η δημιουργία προφίλ θα σας ζητήσει να δώσετε μια άλλη θέση για να αποθηκεύσετε τις αναφορές προφίλ.

 Μπορείτε επίσης να επισυνάψετε σε ένα ρόλο web, επισυνάπτοντας σε WaIISHost.exe.
Εάν υπάρχουν πολλά διαδικασιών ρόλο εργασίας στην εφαρμογή σας, πρέπει να χρησιμοποιήσετε το αναγνωριστικό διαδικασίας για να ξεχωρίζουν. Μπορείτε να υποβάλετε ερώτημα σε το αναγνωριστικό διαδικασίας μέσω προγραμματισμού κατά την πρόσβαση στο αντικείμενο διεργασία. Για παράδειγμα, εάν προσθέσετε αυτόν τον κωδικό για τη μέθοδο εκτέλεσης της κλάσης προέρχεται RoleEntryPoint σε ένα ρόλο, μπορείτε να δείτε το αρχείο καταγραφής στο τον υπολογισμό προσομοίωσης περιβάλλον εργασίας Χρήστη του να γνωρίζετε ποια διαδικασία για να συνδεθείτε με.

    var process = System.Diagnostics.Process.GetCurrentProcess();
    var message = String.Format("Process ID: {0}", process.Id);
    Trace.WriteLine(message, "Information");

Για να προβάλετε το αρχείο καταγραφής, ξεκινήστε τον υπολογισμό προσομοίωσης περιβάλλον εργασίας Χρήστη του.

![Ξεκινήστε το προσομοίωσης υπολογισμού περιβάλλοντος εργασίας Χρήστη][8]

Ανοίξτε το παράθυρο εργασίας ρόλο καταγραφής κονσόλας από τον υπολογισμό προσομοίωσης περιβάλλον εργασίας Χρήστη του, κάνοντας κλικ στη γραμμή τίτλου του παραθύρου κονσόλας. Μπορείτε να δείτε το Αναγνωριστικό της διαδικασίας στο αρχείο καταγραφής.

![Αναγνωριστικό διαδικασίας προβολής][9]

Μία έχετε επισυνάψει, ακολουθήστε τα βήματα στο περιβάλλον εργασίας Χρήστη της εφαρμογής σας (εάν χρειάζεται) για να αναπαραγάγετε το σενάριο.

Όταν θέλετε να διακόψετε τη δημιουργία προφίλ, επιλέξτε τη σύνδεση **Διακοπή δημιουργία προφίλ** .

![Διακοπή επιλογή τη δημιουργία προφίλ][10]

## <a name="3-view-performance-reports"></a>3: Προβολή αναφορών επιδόσεων

Εμφανίζεται η αναφορά απόδοσης για την εφαρμογή σας.

Σε αυτό το σημείο, η δημιουργία προφίλ διακόπτει την εκτέλεση αποθηκεύει δεδομένα σε ένα αρχείο .vsp και εμφανίζει μια αναφορά που εμφανίζει μια ανάλυση αυτών των δεδομένων.

![Αναφορά Profiler][11]


Εάν βλέπετε String.wstrcpy στη διαδρομή συντόμευσης, κάντε κλικ στο απλώς μου κώδικα για να αλλάξετε την προβολή για να εμφανίσετε μόνο κώδικα χρήστη.  Εάν βλέπετε String.Concat, δοκιμάστε να πατώντας το κουμπί Εμφάνιση όλο τον κώδικα.

Θα πρέπει να βλέπετε τη μέθοδο Concatenate και τις String.Concat καταλαμβάνει ένα μεγάλο μέρος του χρόνου εκτέλεσης.

![Ανάλυση της αναφοράς][12]

Αν έχετε προσθέσει τον κώδικα συνένωση συμβολοσειρά σε αυτό το άρθρο, θα πρέπει να βλέπετε μια προειδοποίηση στη λίστα εργασιών για αυτό. Μπορείτε επίσης να δείτε μια προειδοποίηση ότι υπάρχει υπερβολικό μέγεθος συλλογή απορριμμάτων, η οποία είναι λόγω τον αριθμό των συμβολοσειρές που δημιουργούνται και διατίθενται.

![Προειδοποιήσεις επιδόσεων][14]

## <a name="4-make-changes-and-compare-performance"></a>4: πραγματοποιήστε αλλαγές και σύγκριση επιδόσεων

Μπορείτε επίσης να συγκρίνετε τις επιδόσεις πριν και μετά την αλλαγή κώδικα.  Διακόπτετε τη διαδικασία εκτελείται και να επεξεργαστείτε τον κώδικα για να αντικαταστήσετε τη λειτουργία συνένωση συμβολοσειρά με τη χρήση του StringBuilder:

    public static string Concatenate(int number)
    {
        int count;
        System.Text.StringBuilder builder = new System.Text.StringBuilder("");
        for (count = 0; count < number; count++)
        {
             builder.Append("\n" + count.ToString());
        }
        return builder.ToString();
    }

Κάντε μια άλλη επιδόσεων εκτέλεση και, στη συνέχεια, συγκρίνετε τις επιδόσεις. Στην Εξερεύνηση επιδόσεων, αν το εκτελείται είναι στην ίδια περίοδο λειτουργίας, που μπορούν να απλώς επιλέξτε και τις δύο αναφορές, ανοίξτε το μενού συντόμευσης, και επιλέξτε **Σύγκριση αναφορών επίδοσης**. Εάν θέλετε να συγκρίνετε με έναν κύκλο σε άλλη περίοδο λειτουργίας απόδοσης, ανοίξτε το μενού **ανάλυση** και επιλέξτε **Σύγκριση αναφορών επίδοσης**. Καθορίστε και τα δύο αρχεία στο παράθυρο διαλόγου που εμφανίζεται.

![Συγκρίνετε την επιλογή αναφορών επιδόσεων][15]

Οι αναφορές επισημάνετε διαφορές μεταξύ των δύο το εκτελείται.

![Αναφορά σύγκρισης][16]

Συγχαρητήρια! Έχετε λάβατε ξεκινήσατε με το profiler.

## <a name="troubleshooting"></a>Αντιμετώπιση προβλημάτων

- Βεβαιωθείτε ότι η δημιουργία προφίλ ενός build έκδοσης και ξεκινήστε χωρίς τον εντοπισμό σφαλμάτων.

- Εάν δεν είναι ενεργοποιημένη η επιλογή "Επισύναψη/απόσπαση" στο μενού Profiler, εκτελέστε τον Οδηγό επιδόσεων.

- Χρησιμοποιήστε τον υπολογισμό προσομοίωσης περιβάλλον εργασίας Χρήστη του για να προβάλετε την κατάσταση της εφαρμογής σας. 

- Εάν έχετε προβλήματα με την εκκίνηση εφαρμογών στο το προσομοίωσης ή επισυνάπτοντας το profiler Τερματισμός προς τα κάτω, την προσομοίωσης υπολογισμού και επανεκκινήστε το. Εάν το πρόβλημα δεν επιλυθεί, δοκιμάστε να κάνετε επανεκκίνηση. Αυτό το πρόβλημα μπορεί να προκύψει εάν χρησιμοποιείτε το προσομοίωσης τον υπολογισμό σε αναστολή και κατάργηση εκτελείται αναπτύξεις.

- Εάν έχετε χρησιμοποιήσει οποιαδήποτε από τις εντολές δημιουργίας προφίλ από τη γραμμή εντολών, ιδίως τις καθολικές ρυθμίσεις, βεβαιωθείτε ότι έχει γίνει κλήση VSPerfClrEnv /globaloff και ότι έχει τερματιστεί VsPerfMon.exe.

- Εάν κατά τη δειγματοληψία, δείτε το μήνυμα "PRF0025: δεν υπάρχουν δεδομένα έχουν συλλεχθεί," Ελέγξτε ότι η διεργασία που έχουν επισυναφθεί σε έχει CPU δραστηριότητας. Εφαρμογές που δεν κάνουν οποιαδήποτε υπολογιστική εργασία δεν μπορεί να δημιουργήσουν οποιαδήποτε δεδομένα δειγματοληψία.  Επίσης, είναι πιθανό ότι η διαδικασία τερματίστηκε έχει πραγματοποιηθεί οποιαδήποτε δειγματοληψία. Ελέγξτε ότι η μέθοδος εκτέλεσης για ένα ρόλο που δημιουργία προφίλ δεν τερματιστεί.

## <a name="next-steps"></a>Επόμενα βήματα

Instrumenting Azure δυαδικά στοιχεία του προσομοίωσης δεν υποστηρίζεται στο profiler του Visual Studio, αλλά εάν θέλετε να ελέγξετε εκχώρηση μνήμης, μπορείτε να επιλέξετε αυτήν την επιλογή κατά τη δημιουργία προφίλ. Μπορείτε επίσης να επιλέξετε δημιουργία προφίλ ταυτόχρονης εκτέλεσης, που σας βοηθά να καθορίσετε εάν νήματα είναι χάνετε χρόνο κάθε για κλειδωμάτων ή το επίπεδο δημιουργία προφίλ επικοινωνίας, που σας βοηθά να παρακολουθείτε τα προβλήματα επιδόσεων κατά την αλληλεπίδραση μεταξύ βαθμίδες μιας εφαρμογής του, πιο συχνά μεταξύ η σειρά δεδομένων και ένα ρόλο εργασίας.  Μπορείτε να προβάλετε τα ερωτήματα βάσης δεδομένων που δημιουργείται από την εφαρμογή σας και να χρησιμοποιήσετε τα δεδομένα του προφίλ για να βελτιώσετε τη χρήση της βάσης δεδομένων. Για πληροφορίες σχετικά με τη δημιουργία προφίλ για το επίπεδο επικοινωνίας, ανατρέξτε στην καταχώρηση ιστολογίου [αναλυτικές οδηγίες: χρήση του Profiler αλληλεπίδραση επιπέδων στο Visual Studio ομάδας συστήματος 2010][3].



[1]: http://msdn.microsoft.com/library/azure/hh369930.aspx
[2]: http://msdn.microsoft.com/library/azure/hh411542.aspx
[3]: http://blogs.msdn.com/b/habibh/archive/2009/06/30/walkthrough-using-the-tier-interaction-profiler-in-visual-studio-team-system-2010.aspx
[4]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally09.png
[5]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally10.png
[6]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally02.png
[7]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally05.png
[8]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally010.png
[9]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally07.png
[10]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally06.png
[11]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally03.png
[12]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally011.png
[14]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally04.png 
[15]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally013.png
[16]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally012.png
[17]: ./media/cloud-services-performance-testing-visual-studio-profiler/ProfilingLocally08.png
 