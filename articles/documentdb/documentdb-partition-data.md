<properties 
    pageTitle="Δημιουργία διαμερισμάτων και κλίμακας στο Azure DocumentDB | Microsoft Azure"      
    description="Μάθετε περισσότερα σχετικά με τον τρόπο δημιουργίας διαμερισμάτων λειτουργεί στο Azure DocumentDB, πώς μπορείτε να ρυθμίσετε τις παραμέτρους διαμερισμάτων και να δημιουργήσετε διαμερίσματα πλήκτρα και πώς μπορείτε να επιλέξετε το πλήκτρο δεξιά διαμερίσματα για την εφαρμογή σας."         
    services="documentdb" 
    authors="arramac" 
    manager="jhubbard" 
    editor="monicar" 
    documentationCenter=""/> 

<tags 
    ms.service="documentdb" 
    ms.workload="data-services" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="09/20/2016" 
    ms.author="arramac"/> 

# <a name="partitioning-and-scaling-in-azure-documentdb"></a>Δημιουργία διαμερισμάτων και κλίμακας στο Azure DocumentDB
[Microsoft Azure DocumentDB](https://azure.microsoft.com/services/documentdb/) έχει σχεδιαστεί για να σας βοηθήσουν να επιτύχετε γρήγορα, προβλέψιμα επιδόσεις και την κλίμακα απρόσκοπτα μαζί με την εφαρμογή σας, καθώς αυτή αναπτύσσεται. Σε αυτό το άρθρο παρέχει μια επισκόπηση του τρόπου διαμερισμού λειτουργεί στο DocumentDB και περιγράφει πώς μπορείτε να ρυθμίσετε τις συλλογές DocumentDB για να κλιμακωθεί αποτελεσματικά τις εφαρμογές σας.

Μετά την ανάγνωση αυτό το άρθρο, θα μπορούν να απαντούν στα παρακάτω ερωτήματα:   

- Πώς λειτουργεί η διαμερισμού λειτουργούν στο Azure DocumentDB;
- Πώς γίνεται η ρύθμιση παραμέτρων διαμερισμάτων στο DocumentDB
- Τι είναι τα διαμερίσματα πλήκτρα και πώς να επιλέξω σε τον αριθμό-κλειδί δεξιά διαμερίσματα για εφαρμογή μου;

Για να ξεκινήσετε με κώδικα, κάντε λήψη του έργου από το [Δείγμα προγράμματος οδήγησης δοκιμές επιδόσεων DocumentDB](https://github.com/Azure/azure-documentdb-dotnet/tree/a2d61ddb53f8ab2a23d3ce323c77afcf5a608f52/samples/documentdb-benchmark). 

## <a name="partitioning-in-documentdb"></a>Δημιουργία διαμερισμάτων στο DocumentDB

Στο DocumentDB, μπορείτε να αποθηκεύσετε και να ερωτήματος σχήματος λιγότερο JSON έγγραφα με χρόνους σειρά χιλιοστών του δευτερολέπτου απόκρισης σε οποιαδήποτε κλίμακα. DocumentDB παρέχει κοντέινερ για την αποθήκευση των δεδομένων που ονομάζεται **συλλογών**. Συλλογές λογική πόρους και μπορούν να εκτείνονται σε μία ή περισσότερες φυσικής διαμερίσματα ή των διακομιστών. Ο αριθμός των διαμερισμάτων προσδιορίζεται από DocumentDB ανάλογα με το μέγεθος του χώρου αποθήκευσης και την προμήθεια του φακέλου απόδοση της συλλογής. Κάθε διαμερίσματα στο DocumentDB έχει ένα σταθερό μέγεθος του χώρου αποθήκευσης αντίγραφα SSD που σχετίζεται με το και αναπαράγεται για υψηλή διαθεσιμότητα. Διαμερίσματα διαχείρισης γίνεται πλήρως από Azure DocumentDB και δεν χρειάζεται να σύνθετες κώδικας σύνταξης ή να διαχειριστείτε διαμερισμάτων σας. Συλλογές DocumentDB είναι **σχεδόν απεριόριστες** όσον αφορά χώρου αποθήκευσης και απόδοση. 

Δημιουργία διαμερισμάτων είναι απόλυτα διαφανής για την εφαρμογή σας. DocumentDB υποστηρίζει Γρήγορη διαβάζει και εγγραφές, ερωτήματα SQL και LINQ, JavaScript που βασίζονται συναλλαγών λογικής, επίπεδα συνέπειας και έλεγχος πρόσβασης λεπτομερή μέσω REST API κλήσεις σε έναν πόρο ενιαία συλλογή. Η υπηρεσία χειρίζεται διανομή δεδομένων σε διαμερίσματα και δρομολόγηση ερωτήματος αιτήσεων για τα διαμερίσματα δεξιά. 

Πώς λειτουργεί αυτό; Όταν δημιουργείτε μια συλλογή στην DocumentDB, θα παρατηρήσετε ότι υπάρχει μια τιμή ρύθμισης παραμέτρων **ιδιότητα κλειδιού διαμερισμάτων** που μπορείτε να καθορίσετε. Αυτή είναι η ιδιότητα JSON (ή μια διαδρομή) μέσα σε τα έγγραφά σας που μπορούν να χρησιμοποιηθούν από DocumentDB να διανείμετε τα δεδομένα σας μεταξύ πολλών διακομιστών ή τα διαμερίσματα. DocumentDB θα κατακερματισμός της τιμής κλειδιού διαμερίσματα και χρησιμοποιήστε το διαγραμμισμένο αποτέλεσμα για να προσδιορίσετε τα διαμερίσματα με την οποία θα αποθηκευτεί το έγγραφο JSON. Όλα τα έγγραφα με το ίδιο κλειδί διαμερίσματα θα αποθηκευτούν στο ίδιο τα διαμερίσματα. 

Για παράδειγμα, εξετάστε το ενδεχόμενο μια εφαρμογή η οποία αποθηκεύει δεδομένα σχετικά με τους υπαλλήλους και των υπηρεσιών τους σε DocumentDB. Επιλέξτε ας `"department"` ως την ιδιότητα κλειδιού διαμερίσματα, προκειμένου να κλιμακωθεί δεδομένα με τμήμα. Κάθε έγγραφο στο DocumentDB πρέπει να περιέχει μια υποχρεωτική `"id"` ιδιότητα που πρέπει να είναι μοναδικός για κάθε έγγραφο με την ίδια partition τιμή κλειδιού, π.χ. `"Marketing`". Κάθε έγγραφο που είναι αποθηκευμένο σε μια συλλογή πρέπει να έχει ένα μοναδικό συνδυασμό του κλειδιού διαμερίσματα και αναγνωριστικό, π.χ. `{ "Department": "Marketing", "id": "0001" }`, `{ "Department": "Marketing", "id": "0002" }`, και `{ "Department": "Sales", "id": "0001" }`. Με άλλα λόγια, η σύνθετη ιδιότητα (αναγνωριστικό κλειδιού, διαμερίσματα) είναι το πρωτεύον κλειδί για τη συλλογή.

### <a name="partition-keys"></a>Αριθμούς-κλειδιά διαμερισμάτων
Η επιλογή του αριθμού-κλειδιού διαμερίσματα είναι μια σημαντική απόφαση που θα πρέπει να κάνετε κατά τη σχεδίαση. Πρέπει να επιλέξετε ένα όνομα ιδιότητας JSON που έχει ένα ευρύ φάσμα των τιμών και είναι πιθανό να έχουν ομοιόμορφα κατανεμημένο μοτίβα πρόσβασης. Το κλειδί διαμερίσματα έχει καθοριστεί ως μια διαδρομή JSON, π.χ. `/department` αντιπροσωπεύει το τμήμα της ιδιότητας. 

Ο παρακάτω πίνακας εμφανίζει παραδείγματα βασικών ορισμών διαμερίσματα και τις τιμές JSON αντιστοιχεί σε κάθε μία.

<table border="0" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td valign="top"><p><strong>Διαδρομή κλειδιού partition</strong></p></td>
            <td valign="top"><p><strong>Περιγραφή</strong></p></td>
        </tr>
        <tr>
            <td valign="top"><p>/Department</p></td>
            <td valign="top"><p>Αντιστοιχεί στην τιμή JSON doc.department όπου το έγγραφο είναι το έγγραφο.</p></td>
        </tr>
        <tr>
            <td valign="top"><p>όνομα/ιδιότητες /</p></td>
            <td valign="top"><p>Αντιστοιχεί στην τιμή JSON doc.properties.name όπου το έγγραφο είναι το έγγραφο (ένθετη ιδιότητα).</p></td>
        </tr>
        <tr>
            <td valign="top"><p>/ID</p></td>
            <td valign="top"><p>Αντιστοιχεί στην τιμή JSON doc.id (αναγνωριστικό και διαμερίσματα κλειδί είναι η ίδια ιδιότητα).</p></td>
        </tr>
        <tr>
            <td valign="top"><p>/ "όνομα τμήματος"</p></td>
            <td valign="top"><p>Αντιστοιχεί στην τιμή JSON doc ["όνομα τμήματος"], όπου το έγγραφο είναι το έγγραφο.</p></td>
        </tr>
    </tbody>
</table>

> [AZURE.NOTE] Η σύνταξη για τη διαδρομή του κλειδιού διαμερίσματα είναι παρόμοια με την προδιαγραφή διαδρομή για τη δημιουργία ευρετηρίου πολιτικής διαδρομές με τη διαφορά κλειδιού που αντιστοιχεί στην ιδιότητα αντί για την τιμή της διαδρομής, δηλαδή υπάρχει καμία μπαλαντέρ στο τέλος. Για παράδειγμα, θα πρέπει να καθορίσετε/τμήμα /; Για να δημιουργήσετε ευρετήριο τις τιμές στην περιοχή τμήμα, καθορίστε αλλά /department ως τον ορισμό κλειδιού διαμερίσματα. Τη διαδρομή κλειδιού partition ρητά σε ευρετήριο και δεν είναι δυνατό να εξαιρούνται από το ευρετήριο χρησιμοποιώντας δημιουργίας ευρετηρίου υπερισχύει η πολιτική.

Ας ρίξουμε μια ματιά πώς η επιλογή του αριθμού-κλειδιού partition επηρεάζει τις επιδόσεις της εφαρμογής σας.

### <a name="partitioning-and-provisioned-throughput"></a>Μετάδοσης διαμερισμού και προμήθεια του φακέλου
DocumentDB έχει σχεδιαστεί για προβλέψιμα επιδόσεων. Όταν δημιουργείτε μια συλλογή, μπορείτε να δεσμεύσετε μετάδοσης όσον αφορά τις ** [μονάδες αίτηση](documentdb-request-units.md) (RU) ανά δευτερόλεπτο**. Κάθε αίτηση έχει ανατεθεί μια τιμή μονάδας αίτηση που είναι ανάλογο προς το ποσό της πόρους συστήματος, όπως CPU και εισόδου/ΕΞΌΔΟΥ που καταναλώνεται από τη λειτουργία. Μια ανάγνωση εγγράφου 1 kB με συνέπεια περιόδου λειτουργίας καταναλώνει 1 μονάδα αίτηση. Ανάγνωσης είναι 1 RU ανεξάρτητα από τον αριθμό των στοιχείων που είναι αποθηκευμένα ή τον αριθμό των ταυτόχρονες αιτήσεις εκτελείται ταυτόχρονα. Μεγάλα έγγραφα απαιτούν μεγαλύτερη αίτηση μονάδες, ανάλογα με το μέγεθος. Εάν γνωρίζετε το μέγεθος των σας οντοτήτων και τον αριθμό των διαβάζει που χρειάζεστε για την υποστήριξη για την εφαρμογή σας, που μπορούν να προμηθεύσουν το ακριβές χρονικό μετάδοσης που απαιτείται για την εφαρμογή του Διαβάστε ανάγκες. 

Όταν DocumentDB αποθηκεύει έγγραφα, το κατανέμει τους ομοιόμορφα μεταξύ των διαμερισμάτων με βάση την τιμή του κλειδιού διαμερίσματα. Η ταχύτητα επίσης είναι ομοιόμορφα κατανεμημένα μεταξύ των τα διαθέσιμα διαμερίσματα δηλαδή τη μετάδοση ανά partition = (συνολικός αριθμός ανά συλλογή) / (αριθμός διαμερίσματα). 

>[AZURE.NOTE] Για να επιτύχετε την πλήρη μετάδοσης της συλλογής, πρέπει να επιλέξετε έναν αριθμό-κλειδί διαμερισμάτων που σας επιτρέπει να ομοιόμορφη κατανομή αιτήσεις μεταξύ ενός αριθμού διακριτών διαμερίσματα βασικών τιμών.

## <a name="single-partition-and-partitioned-collections"></a>Μία διαμερίσματα και διαμερίσματα συλλογών
DocumentDB υποστηρίζει τη δημιουργία των διαμερισμάτων μίας και διαμερίσματα συλλογών. 

- **Συλλογές Partitioned** μπορεί να εκτείνεται σε πολλαπλά διαμερίσματα και υποστήριξη πολύ μεγάλες ποσότητες χώρου αποθήκευσης και απόδοση. Πρέπει να καθορίσετε έναν αριθμό-κλειδί διαμερίσματα για τη συλλογή.
- **Συλλογές μίας διαμερίσματα** με επιλογές χαμηλότερη τιμή και τη δυνατότητα να ερωτήματος και να εκτελέσετε συναλλαγές σε όλα τα δεδομένα συλλογής. Έχουν τα όρια κλιμάκωση και αποθήκευσης από ένα μεμονωμένο διαμερίσματα. Δεν χρειάζεται να καθορίσετε ένα κλειδί διαμερίσματα για αυτές τις συλλογές. 

![Διαμερίσματα συλλογών στο DocumentDB][2] 

Για σενάρια που δεν χρειάζονται μεγάλους όγκους χώρου αποθήκευσης ή μετάδοσης, συλλογές μόνο διαμερίσματα είναι κατάλληλες. Σημειώστε ότι μίας διαμερισμάτων συλλογές έχουν κλιμάκωσης και των ορίων χώρου αποθήκευσης από ένα μεμονωμένο διαμερίσματα, π.χ. έως και 10 GB χώρου αποθήκευσης και σε έως 10.000 αίτηση μονάδες ανά δευτερόλεπτο. 

Συλλογές διαμερίσματα μπορούν να υποστηρίξουν πολύ μεγάλες ποσότητες χώρου αποθήκευσης και απόδοση. Οι προσφορές προεπιλεγμένη ωστόσο έχουν ρυθμιστεί για την αποθήκευση έως 250 GB χώρου αποθήκευσης και κλιμάκωση έως 250.000 αίτηση μονάδες ανά δευτερόλεπτο. Εάν χρειάζεστε υψηλότερη χώρου αποθήκευσης ή μετάδοσης ανά συλλογή, επικοινωνήστε με την [Υποστήριξη Azure](documentdb-increase-limits.md) να έχετε αυτές τις αυξημένη για το λογαριασμό σας.

Ο παρακάτω πίνακας παραθέτει διαφορές σε εργασία με ένα μονό διαμερισμάτων και διαμερίσματα συλλογών:

<table border="0" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td valign="top"><p></p></td>
            <td valign="top"><p><strong>Συλλογή μία Partition</strong></p></td>
            <td valign="top"><p><strong>Διαμερίσματα συλλογής</strong></p></td>
        </tr>
        <tr>
            <td valign="top"><p>Πλήκτρο partition</p></td>
            <td valign="top"><p>Κανένας</p></td>
            <td valign="top"><p>Απαιτείται</p></td>
        </tr>
        <tr>
            <td valign="top"><p>Πρωτεύον κλειδί για το έγγραφο</p></td>
            <td valign="top"><p>"αναγνωριστικό"</p></td>
            <td valign="top"><p>σύνθετο κλειδί &lt;κλειδί διαμερίσματα&gt; και το "αναγνωριστικό"</p></td>
        </tr>
        <tr>
            <td valign="top"><p>Ελάχιστο όριο χώρου αποθήκευσης</p></td>
            <td valign="top"><p>0 GB</p></td>
            <td valign="top"><p>0 GB</p></td>
        </tr>
        <tr>
            <td valign="top"><p>Μέγιστος χώρος αποθήκευσης</p></td>
            <td valign="top"><p>10 GB</p></td>
            <td valign="top"><p>Απεριόριστα (250 GB από προεπιλογή)</p></td>
        </tr>
        <tr>
            <td valign="top"><p>Ελάχιστη ταχύτητα μετάδοσης</p></td>
            <td valign="top"><p>400 αίτηση μονάδες ανά δευτερόλεπτο</p></td>
            <td valign="top"><p>10.000 αίτηση μονάδες ανά δευτερόλεπτο</p></td>
        </tr>
        <tr>
            <td valign="top"><p>Μέγιστη ταχύτητα μετάδοσης</p></td>
            <td valign="top"><p>10.000 αίτηση μονάδες ανά δευτερόλεπτο</p></td>
            <td valign="top"><p>Απεριόριστα (250.000 αίτηση μονάδες ανά δευτερόλεπτο από προεπιλογή)</p></td>
        </tr>
        <tr>
            <td valign="top"><p>Εκδόσεις API</p></td>
            <td valign="top"><p>Όλες</p></td>
            <td valign="top"><p>API 2015-12-16 και νεότερη έκδοση</p></td>
        </tr>
    </tbody>
</table>

## <a name="working-with-the-sdks"></a>Εργασία με το SDK

Azure DocumentDB προστεθεί υποστήριξη για την αυτόματη δημιουργία διαμερισμάτων με [REST API έκδοση 2015-12-16](https://msdn.microsoft.com/library/azure/dn781481.aspx). Για να δημιουργήσετε διαμερίσματα συλλογές, πρέπει να κάνετε λήψη SDK εκδόσεις 1.6.0 ή νεότερη έκδοση σε μία από τις υποστηριζόμενες πλατφόρμες SDK (.NET, Node.js, Java, Python). 

### <a name="creating-partitioned-collections"></a>Δημιουργία διαμερίσματα συλλογές

Το παρακάτω παράδειγμα εμφανίζει ένα απόκομμα .NET για να δημιουργήσετε μια συλλογή για την αποθήκευση δεδομένων τηλεμετρίας συσκευή 20.000 αίτηση μονάδων ανά δευτερόλεπτο ταχύτητα μεταγωγής. Το SDK ορίζει την τιμή OfferThroughput (που ορίζει με τη σειρά του `x-ms-offer-throughput` κεφαλίδα αίτησης στο το REST API). Εδώ μπορούμε να εγκαταστήσουμε το `/deviceId` ως το κλειδί διαμερίσματα. Η επιλογή του αριθμού-κλειδιού partition αποθηκεύεται μαζί με τα υπόλοιπα μετα-δεδομένα συλλογής, όπως το όνομα και την πολιτική δημιουργίας ευρετηρίου.

Για αυτό το δείγμα, θα σας επιλέξατε `deviceId` εφόσον γνωρίζουμε που (α) επειδή υπάρχουν πολλοί συσκευές, εγγραφών μπορούν να διανεμηθούν σε διαμερίσματα ομοιόμορφα και επιτρέποντας μας για να περιορίσετε το μέγεθος της βάσης δεδομένων για να ingest μεγάλους όγκους δεδομένων και (β) πολλές από τις αιτήσεις όπως λήψη την πιο πρόσφατη ανάγνωσης για συσκευή περιορίζονται σε ένα μεμονωμένο deviceId και μπορεί να ανακτηθεί από ένα μεμονωμένο διαμερίσματα.

    DocumentClient client = new DocumentClient(new Uri(endpoint), authKey);
    await client.CreateDatabaseAsync(new Database { Id = "db" });

    // Collection for device telemetry. Here the JSON property deviceId will be used as the partition key to 
    // spread across partitions. Configured for 10K RU/s throughput and an indexing policy that supports 
    // sorting against any number or string property.
    DocumentCollection myCollection = new DocumentCollection();
    myCollection.Id = "coll";
    myCollection.PartitionKey.Paths.Add("/deviceId");

    await client.CreateDocumentCollectionAsync(
        UriFactory.CreateDatabaseUri("db"),
        myCollection,
        new RequestOptions { OfferThroughput = 20000 });
        

> [AZURE.NOTE] Για να δημιουργήσετε διαμερίσματα συλλογές, πρέπει να καθορίσετε μια τιμή μετάδοσης μονάδων αίτηση > 10.000 ανά δευτερόλεπτο. Εφόσον μετάδοσης βρίσκεται σε πολλαπλά γραφήματα 100, αυτό πρέπει να είναι 10,100 ή νεότερη έκδοση.

Αυτή η μέθοδος κάνει μια κλήση για να DocumentDB REST API και την υπηρεσία θα προμήθεια έναν αριθμό από τα διαμερίσματα με βάση τη μετάδοση ζητήθηκε. Μπορείτε να αλλάξετε την ταχύτητα μεταγωγής μιας συλλογής καθώς εξελίσσονται οι ανάγκες των επιδόσεων. Για περισσότερες λεπτομέρειες, ανατρέξτε στο θέμα [Επιδόσεις](documentdb-performance-levels.md) .

### <a name="reading-and-writing-documents"></a>Ανάγνωση και σύνταξη εγγράφων

Τώρα, ας εισαγωγή δεδομένων σε DocumentDB. Ακολουθεί μια κλάση δείγμα που περιέχει μια συσκευή ανάγνωσης και μια κλήση σε CreateDocumentAsync για να εισαγάγετε μια νέα συσκευή ανάγνωσης σε μια συλλογή.

    public class DeviceReading
    {
        [JsonProperty("id")]
        public string Id;

        [JsonProperty("deviceId")]
        public string DeviceId;

        [JsonConverter(typeof(IsoDateTimeConverter))]
        [JsonProperty("readingTime")]
        public DateTime ReadingTime;

        [JsonProperty("metricType")]
        public string MetricType;

        [JsonProperty("unit")]
        public string Unit;

        [JsonProperty("metricValue")]
        public double MetricValue;
      }

    // Create a document. Here the partition key is extracted as "XMS-0001" based on the collection definition
    await client.CreateDocumentAsync(
        UriFactory.CreateDocumentCollectionUri("db", "coll"),
        new DeviceReading
        {
            Id = "XMS-001-FE24C",
            DeviceId = "XMS-0001",
            MetricType = "Temperature",
            MetricValue = 105.00,
            Unit = "Fahrenheit",
            ReadingTime = DateTime.UtcNow
        });


Ας Διαβάστε εγγράφου με πλήκτρο διαμερίσματα και αναγνωριστικό, ενημερώστε το και, στη συνέχεια, ως τελικό βήμα, διαγράψτε το κλειδί διαμερίσματα και αναγνωριστικό. Σημειώστε ότι τα διαβάζει περιλαμβάνει μια τιμή PartitionKey (αντίστοιχο για να το `x-ms-documentdb-partitionkey` κεφαλίδα αίτησης στο το REST API).

    // Read document. Needs the partition key and the ID to be specified
    Document result = await client.ReadDocumentAsync(
      UriFactory.CreateDocumentUri("db", "coll", "XMS-001-FE24C"), 
      new RequestOptions { PartitionKey = new PartitionKey("XMS-0001") });

    DeviceReading reading = (DeviceReading)(dynamic)result;

    // Update the document. Partition key is not required, again extracted from the document
    reading.MetricValue = 104;
    reading.ReadingTime = DateTime.UtcNow;

    await client.ReplaceDocumentAsync(
      UriFactory.CreateDocumentUri("db", "coll", "XMS-001-FE24C"), 
      reading);

    // Delete document. Needs partition key
    await client.DeleteDocumentAsync(
      UriFactory.CreateDocumentUri("db", "coll", "XMS-001-FE24C"), 
      new RequestOptions { PartitionKey = new PartitionKey("XMS-0001") });



### <a name="querying-partitioned-collections"></a>Υποβολή ερωτημάτων διαμερίσματα συλλογές

Όταν κάνετε ερώτημα δεδομένων σε διαμερίσματα συλλογές, DocumentDB δρομολογεί αυτόματα το ερώτημα για να τα διαμερίσματα αντιστοιχεί στις τιμές κλειδιού διαμερισμάτων που καθορίζεται στο φίλτρο (εάν υπάρχουν). Για παράδειγμα, αυτό το ερώτημα δρομολογείται μόνο τα διαμερίσματα που περιέχει τον αριθμό-κλειδί partition "XMS-0001".

    // Query using partition key
    IQueryable<DeviceReading> query = client.CreateDocumentQuery<DeviceReading>(
        UriFactory.CreateDocumentCollectionUri("db", "coll"))
        .Where(m => m.MetricType == "Temperature" && m.DeviceId == "XMS-0001");

Το παρακάτω ερώτημα δεν διαθέτει ένα φίλτρο για το κλειδί διαμερίσματα (DeviceId) και είναι τακτοποιούνται για όλα τα διαμερίσματα όπου εκτελείται σε σχέση με τα διαμερίσματα ευρετηρίου. Σημειώστε ότι πρέπει να καθορίσετε το EnableCrossPartitionQuery (`x-ms-documentdb-query-enablecrosspartition` στο το REST API) για να έχετε το SDK για να εκτελέσετε ένα ερώτημα σε διαμερίσματα.

    // Query across partition keys
    IQueryable<DeviceReading> crossPartitionQuery = client.CreateDocumentQuery<DeviceReading>(
        UriFactory.CreateDocumentCollectionUri("db", "coll"), 
        new FeedOptions { EnableCrossPartitionQuery = true })
        .Where(m => m.MetricType == "Temperature" && m.MetricValue > 100);

### <a name="parallel-query-execution"></a>Εκτέλεση παράλληλες ερωτήματος

Το SDK DocumentDB 1.9.0 και επάνω από την υποστήριξη παράλληλες ερωτήματος εκτέλεσης επιλογές, οι οποίες σας επιτρέπουν να εκτελέσετε χαμηλής λανθάνων χρόνος ερωτημάτων σε σχέση με διαμερίσματα συλλογές, ακόμα και όταν χρειάζεται αφής μεγάλου αριθμού τα διαμερίσματα. Για παράδειγμα, το ακόλουθο ερώτημα έχει ρυθμιστεί να εκτελείται παράλληλα σε διαμερίσματα.

    // Cross-partition Order By Queries
    IQueryable<DeviceReading> crossPartitionQuery = client.CreateDocumentQuery<DeviceReading>(
        UriFactory.CreateDocumentCollectionUri("db", "coll"), 
        new FeedOptions { EnableCrossPartitionQuery = true, MaxDegreeOfParallelism = 10, MaxBufferedItemCount = 100})
        .Where(m => m.MetricType == "Temperature" && m.MetricValue > 100)
        .OrderBy(m => m.MetricValue);

Μπορείτε να διαχειριστείτε εκτέλεσης παράλληλες ερωτήματος από τις ακόλουθες παραμέτρους της ρύθμισης:

- Με τη ρύθμιση `MaxDegreeOfParallelism`, μπορείτε να ελέγξετε το βαθμό παραλληλισμό π.χ., ο μέγιστος αριθμός των συνδέσεων δικτύου ταυτόχρονη για τα διαμερίσματα της συλλογής. Εάν ορίσετε αυτό σε -1, βαθμού παραλληλισμό γίνεται από το SDK. Εάν το `MaxDegreeOfParallelism` δεν είναι καθορισμένο ή να ορίσετε σε 0, η οποία είναι η προεπιλεγμένη τιμή, θα υπάρχει μια σύνδεση δικτύου μόνο για τα διαμερίσματα της συλλογής.
- Με τη ρύθμιση `MaxBufferedItemCount`, μπορείτε να εξισορροπήσετε ερωτήματος λανθάνων χρόνος και προγράμματος-πελάτη πλευρά τη χρήση μνήμης. Εάν παραλείψετε αυτή η παράμετρος ή να το ορίσετε σε -1, τον αριθμό των στοιχείων σε buffer κατά την εκτέλεση ενός ερωτήματος παράλληλες γίνεται από το SDK.

Δεδομένο το ίδιο μέλος της συλλογής, παράλληλες ερωτήματος θα επιστρέφουν αποτελέσματα με την ίδια σειρά όπως σειρά εκτέλεσης. Κατά την εκτέλεση ενός ερωτήματος σταυρό διαμερισμάτων που περιλαμβάνει ταξινόμηση (ORDER BY ή/και του ΕΠΆΝΩ), το SDK DocumentDB ζητήματα το ερώτημα παράλληλα σε διαμερίσματα και συγχωνεύει μερικώς ταξινομημένο έχει ως αποτέλεσμα την πλευρά του προγράμματος-πελάτη για την παραγωγή καθολικά ταξινομημένη αποτελεσμάτων.

### <a name="executing-stored-procedures"></a>Εκτέλεση αποθηκευμένων διαδικασιών

Μπορείτε επίσης να εκτελέσετε μεμονωμένες συναλλαγές έναντι εγγράφων με το ίδιο Αναγνωριστικό συσκευής, και π.χ. Εάν διατηρεί συγκεντρωτικά αποτελέσματα ή την πιο πρόσφατη κατάσταση μιας συσκευής σε ένα έγγραφο. 

    await client.ExecuteStoredProcedureAsync<DeviceReading>(
        UriFactory.CreateStoredProcedureUri("db", "coll", "SetLatestStateAcrossReadings"),
        new RequestOptions { PartitionKey = new PartitionKey("XMS-001") }, 
        "XMS-001-FE24C");

Στην επόμενη ενότητα, εξετάσουμε πώς μπορείτε να μετακινήσετε σε διαμερίσματα συλλογές από μονό διαμερισμάτων συλλογών.

<a name="migrating-from-single-partition"></a>
### <a name="migrating-from-single-partition-to-partitioned-collections"></a>Μετεγκατάσταση από μονό διαμερισμάτων σε διαμερίσματα συλλογές
Όταν μια εφαρμογή χρησιμοποιώντας μια συλλογή μίας διαμερισμάτων πρέπει υψηλότερη μετάδοσης (> 10.000 RU/s) ή μεγαλύτερες χώρος αποθήκευσης δεδομένων (> 10GB), μπορείτε να χρησιμοποιήσετε το [Εργαλείο μετεγκατάστασης DocumentDB δεδομένων](http://www.microsoft.com/downloads/details.aspx?FamilyID=cda7703a-2774-4c07-adcc-ad02ddc1a44d) για τη μετεγκατάσταση των δεδομένων από τη συλλογή μίας διαμερισμάτων σε μια συλλογή διαμερίσματα. 

Για τη μετεγκατάσταση από μια συλλογή μίας διαμερισμάτων σε μια συλλογή διαμερίσματα

1. Εξαγάγετε δεδομένα από τη συλλογή μίας διαμερισμάτων στο JSON. Για περισσότερες λεπτομέρειες, ανατρέξτε στο θέμα [Εξαγωγή σε αρχείο JSON](documentdb-import-data.md#export-to-json-file) .
2. Εισαγάγετε τα δεδομένα σε μια συλλογή διαμερίσματα που δημιουργήθηκε με έναν ορισμό κλειδιού διαμερίσματα και περισσότερα από 10.000 αίτηση μονάδες ανά δεύτερο μετάδοσης, όπως φαίνεται στο παρακάτω παράδειγμα. Για περισσότερες λεπτομέρειες, ανατρέξτε στο θέμα [Εισαγωγή για να DocumentDB](documentdb-import-data.md#DocumentDBSeqTarget) .

![Τη μετεγκατάσταση δεδομένων σε μια συλλογή Partitioned σε DocumentDB][3]  

>[AZURE.TIP] Για ταχύτερους χρόνους εισαγωγής, εξετάστε το ενδεχόμενο αύξηση του αριθμού του παράλληλες αιτήσεων σε 100 ή νεότερη έκδοση για να επωφεληθείτε από τη νεότερη έκδοση διαθέσιμη για διαμερίσματα συλλογές μετάδοσης. 

Τώρα που θα σας έχετε ολοκληρώσει τα βασικά στοιχεία, ας δούμε μερικά σημαντικά θέματα σχεδίασης κατά την εργασία με αριθμούς-κλειδιά διαμερισμάτων στο DocumentDB.

## <a name="designing-for-partitioning"></a>Σχεδίαση για τη δημιουργία διαμερισμάτων
Η επιλογή του αριθμού-κλειδιού διαμερίσματα είναι μια σημαντική απόφαση που θα πρέπει να κάνετε κατά τη σχεδίαση. Αυτή η ενότητα περιγράφει ορισμένες από το ισορροπιών που εμπλέκονται στη επιλέγοντας έναν αριθμό-κλειδί διαμερίσματα για τη συλλογή.

### <a name="partition-key-as-the-transaction-boundary"></a>Πλήκτρο διαμερίσματα ως το όριο συναλλαγής
Επιλογή σας του αριθμού-κλειδιού partition πρέπει να υπόλοιπο χρειάζεται να ενεργοποιήσετε τη χρήση των συναλλαγών σε σχέση με την απαίτηση για τη διανομή σας οντοτήτων σε πολλά διαμερίσματα κλειδιά, για να βεβαιωθείτε ότι μια λύση μεταβλητού μεγέθους. Σε ένα εξαιρετικά, μπορείτε να ορίσετε το ίδιο κλειδί διαμερίσματα για όλα τα έγγραφα, αλλά αυτό μπορεί να περιορίζει την κλιμάκωση της λύσης σας. Αντίθετα, θα μπορούσατε να αντιστοιχίσετε έναν αριθμό-κλειδί μοναδικό διαμερίσματα για κάθε έγγραφο, το οποίο θα είναι ιδιαίτερα μεταβλητού μεγέθους, αλλά θα επιτρέπουν τη χρήση συναλλαγές διασταύρωσης εγγράφου μέσω αποθηκευμένες διαδικασίες και εναύσματα. Ένας αριθμός-κλειδί ιδανική διαμερίσματα είναι ένα που σας επιτρέπει να χρησιμοποιείτε αποτελεσματικά ερωτήματα και διαθέτει αρκετό προτεραιότητα για να βεβαιωθείτε ότι η λύση είναι μεταβλητού μεγέθους. 

### <a name="avoiding-storage-and-performance-bottlenecks"></a>Αποφυγή συνωστισμών χώρου αποθήκευσης και επιδόσεων 
Είναι επίσης σημαντικό για να επιλέξετε μια ιδιότητα η οποία επιτρέπει εγγραφές να διανεμηθούν σε έναν αριθμό διακριτές τιμές. Οι αιτήσεις στο ίδιο κλειδί διαμερίσματα δεν πρέπει να υπερβαίνει την ταχύτητα μεταγωγής από ένα μεμονωμένο διαμερίσματα, και θα να επιβραδύνει. Επομένως, είναι σημαντικό για να επιλέξετε έναν αριθμό-κλειδί διαμερισμάτων που δεν έχει ως αποτέλεσμα **"ενεργά σημεία"** στην εφαρμογή σας. Το συνολικό χώρο αποθήκευσης μέγεθος για τα έγγραφα με το ίδιο κλειδί διαμερίσματα μπορεί να επίσης δεν υπερβαίνει τα 10 GB στο χώρο αποθήκευσης. 

### <a name="examples-of-good-partition-keys"></a>Παραδείγματα καλή partition κλειδιών
Ακολουθούν μερικά παραδείγματα για το πώς μπορείτε να επιλέξετε το πλήκτρο διαμερίσματα για την εφαρμογή σας:

* Εάν εφαρμογή έναν υπολογιστή στο παρασκήνιο προφίλ χρήστη, στη συνέχεια, το Αναγνωριστικό χρήστη είναι μια καλή επιλογή για το κλειδί διαμερίσματα.
* Εάν αποθηκεύετε IoT δεδομένων π.χ. κατάσταση της συσκευής, ένα Αναγνωριστικό συσκευής είναι μια καλή επιλογή για το κλειδί διαμερίσματα.
* Εάν χρησιμοποιείτε το DocumentDB για την καταγραφή της χρονολογική σειρά δεδομένων, στη συνέχεια, το Αναγνωριστικό όνομα κεντρικού υπολογιστή ή η διαδικασία είναι μια καλή επιλογή για διαμερίσματα αριθμό-κλειδί.
* Εάν έχετε μια αρχιτεκτονική πολλών μισθωτών, το Αναγνωριστικό μισθωτή είναι μια καλή επιλογή για το κλειδί διαμερίσματα.

Σημειώστε ότι σε ορισμένες περιπτώσεις χρήσης (όπως τα προφίλ χρήστη και IoT που περιγράφεται παραπάνω), το πλήκτρο διαμερίσματα μπορεί να είναι το ίδιο με το αναγνωριστικό (πλήκτρο εγγράφου). Σε άλλες όπως τα δεδομένα σειράς ώρας, ίσως έχετε έναν αριθμό-κλειδί διαμερισμάτων που διαφέρει από το αναγνωριστικό.

### <a name="partitioning-and-loggingtime-series-data"></a>Διαμερισμού και καταγραφή/ώρα-σειρά δεδομένων
Ένα από τα πιο συνηθισμένα περιπτώσεις χρήσης της DocumentDB είναι για καταγραφή και τηλεμετρίας. Είναι σημαντικό για να επιλέξετε έναν αριθμό-κλειδί καλή partition δεδομένου ότι ίσως χρειαστεί να ανάγνωσης/εγγραφής τεράστιες όγκους δεδομένων. Η επιλογή θα εξαρτώνται από την ανάγνωση και εγγραφή χρεώσεις και είδη ερωτημάτων δεν σκοπεύετε να εκτελέσετε. Ακολουθούν ορισμένες συμβουλές σχετικά με τον τρόπο για να επιλέξετε έναν αριθμό-κλειδί καλή διαμερίσματα.

- Εάν σας περίπτωσης χρήσης περιλαμβάνει ένα μικρό ρυθμό συντάσσει acculumating επάνω από ένα μεγάλο χρονικό διάστημα και πρέπει να ερωτήματος με περιοχές χρονικές σημάνσεις και τα άλλα φίλτρα, στη συνέχεια, χρησιμοποιώντας μια συνάθροιση της χρονικής σήμανσης π.χ., ημερομηνία ως έναν αριθμό-κλειδί διαμερίσματα είναι μια καλή προσέγγιση. Αυτό σας επιτρέπει να ερωτήματος επάνω από όλα τα δεδομένα για μια ημερομηνία από ένα μεμονωμένο διαμερίσματα. 
- Εάν το φόρτο εργασίας είναι χοντρό εγγραφής, η οποία είναι συνήθως χρησιμοποιείται πιο συχνά, πρέπει να χρησιμοποιήσετε έναν αριθμό-κλειδί διαμερισμάτων που δεν βασίζεται σε χρονικής σήμανσης, έτσι ώστε να DocumentDB να ομοιόμορφη κατανομή εγγραφές σε έναν αριθμό από τα διαμερίσματα. Δείτε εδώ ένα όνομα κεντρικού υπολογιστή, το Αναγνωριστικό διεργασίας, Αναγνωριστικό δραστηριότητας ή κάποια άλλη ιδιότητα με υψηλή προτεραιότητα είναι μια καλή επιλογή. 
- Ένα τρίτο προσέγγιση είναι υβριδική μία όπου έχετε πολλές συλλογές, μία για κάθε ημέρα/μήνας και το πλήκτρο διαμερίσματα είναι μια ιδιότητα λεπτομερούς όπως όνομα κεντρικού υπολογιστή. Αυτό περιλαμβάνει το όφελος που μπορείτε να ορίσετε διαφορετική επιδόσεις βάσει του χρονικού διαστήματος, π.χ., η συλλογή για τον τρέχοντα μήνα παρέχεται με υψηλότερη απόδοση καθώς εξυπηρετεί ανάγνωσης και εγγραφής, ενώ το προηγούμενους μήνες με κάτω μετάδοσης εφόσον εξυπηρετούν μόνο διαβάζει.

### <a name="partitioning-and-multi-tenancy"></a>Δημιουργία διαμερισμάτων και πολλαπλή μίσθωση
Εάν εφαρμογή μιας εφαρμογής πολλών μισθωτών χρησιμοποιώντας DocumentDB, υπάρχουν δύο κύριες τα μοτίβα για την εφαρμογή μίσθωση με DocumentDB – πλήκτρο ένα διαμερίσματα ανά μισθωτή και, στη συνέχεια, μια συλλογή ανά μισθωτή. Εδώ θα βρείτε τα πλεονεκτήματα και μειονεκτήματα για κάθε:

* Ένα πλήκτρο διαμερίσματα ανά μισθωτή: σε αυτό το μοντέλο, μισθωτές είναι collocated μέσα σε μια μεμονωμένη συλλογή. Αλλά ερωτήματα και εισάγει για έγγραφα μέσα σε ένα μεμονωμένο μισθωτή μπορεί να εκτελεστεί σε σχέση με μια μεμονωμένη διαμερίσματα. Μπορείτε επίσης να εφαρμόσετε λογικής συναλλαγών σε όλα τα έγγραφα μέσα σε ένα μισθωτή. Επειδή το πολλούς μισθωτές κάνετε κοινή χρήση μιας συλλογής, μπορείτε να αποθηκεύσετε χώρου αποθήκευσης και απόδοση κόστους, ομαδοποίηση πόρων για μισθωτές μέσα σε μια συλλογή μόνο και όχι προμήθεια επιπλέον ελεύθερο χώρο για κάθε μισθωτή. Το μειονέκτημα είναι ότι δεν έχετε απομόνωσης επιδόσεων ανά μισθωτή. Αύξηση απόδοσης/μετάδοσης ισχύουν για τη σύγκριση ολόκληρη τη συλλογή προορισμού αυξάνεται για μισθωτές.
* Μια συλλογή ανά μισθωτή: κάθε μισθωτή έχει το δικό της συλλογής. Σε αυτό το μοντέλο, μπορείτε να δεσμεύσετε επιδόσεων ανά μισθωτή. Με του DocumentDB κατανάλωση με βάση τις πληροφορίες τιμολόγησης μοντέλου, αυτό το μοντέλο είναι πιο οικονομική για εφαρμογές πολλών μισθωτή με μικρό αριθμό μισθωτές.

Μπορείτε επίσης να χρησιμοποιήσετε ένα συνδυασμό/επιπέδων την προσέγγιση που collocates μικρές μισθωτές και μετεγκαθιστά μεγαλύτερο μισθωτές τις δικές τους στη συλλογή.

## <a name="next-steps"></a>Επόμενα βήματα
Σε αυτό το άρθρο, θα σας έχετε περιγράφεται διαμερισμού πώς λειτουργεί στο Azure DocumentDB πώς μπορείτε να δημιουργήσετε διαμερίσματα συλλογές και πώς μπορείτε να επιλέξετε έναν αριθμό-κλειδί καλή διαμερίσματα για την εφαρμογή σας. 

-   Εκτέλεση κλίμακα και επιδόσεων δοκιμών με DocumentDB. Ανατρέξτε στο θέμα [επιδόσεις και την κλίμακα δοκιμών με Azure DocumentDB](documentdb-performance-testing.md) για ένα δείγμα.
-   Γρήγορα αποτελέσματα κωδικοποίησης με το [SDK](documentdb-sdk-dotnet.md) ή το [REST API](https://msdn.microsoft.com/library/azure/dn781481.aspx)
-   Μάθετε περισσότερα σχετικά με την [προμήθεια του φακέλου μετάδοση σε DocumentDB](documentdb-performance-levels.md)
-   Εάν θέλετε να προσαρμόσετε τον τρόπο εφαρμογής σας πραγματοποιεί διαμερισμάτων, μπορείτε να συνδέσετε το δικό σας διαμερισμού εφαρμογή-πελάτη. Ανατρέξτε στο θέμα [υποστήριξη διαμερισμάτων πλευρά του προγράμματος-πελάτη](documentdb-sharding.md).

[1]: ./media/documentdb-partition-data/partitioning.png
[2]: ./media/documentdb-partition-data/single-and-partitioned.png
[3]: ./media/documentdb-partition-data/documentdb-migration-partitioned-collection.png  

 
