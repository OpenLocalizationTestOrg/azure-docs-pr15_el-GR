<properties 
    pageTitle="Αίτηση μονάδων στο DocumentDB | Microsoft Azure" 
    description="Μάθετε πώς μπορείτε να κατανοήσετε, καθορίστε και εκτίμηση της αίτησης απαιτήσεις μονάδας στο DocumentDB." 
    services="documentdb" 
    authors="syamkmsft" 
    manager="jhubbard" 
    editor="mimig" 
    documentationCenter=""/>

<tags 
    ms.service="documentdb" 
    ms.workload="data-services" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="06/29/2016" 
    ms.author="syamk"/>

#<a name="request-units-in-documentdb"></a>Αίτηση μονάδων στο DocumentDB
Τώρα διαθέσιμη: DocumentDB [αίτηση μονάδας Αριθμομηχανής](https://www.documentdb.com/capacityplanner). Μάθετε περισσότερα στο [Estimating σας μετάδοσης χρειάζεται](documentdb-request-units.md#estimating-throughput-needs).

![Υπολογιστής μετάδοσης][5]

##<a name="introduction"></a>Εισαγωγή
Σε αυτό το άρθρο παρέχει μια επισκόπηση των μονάδων αίτηση στο [Microsoft Azure DocumentDB](https://azure.microsoft.com/services/documentdb/). 

Μετά την ανάγνωση αυτό το άρθρο, θα έχετε τη δυνατότητα να απαντούν στα παρακάτω ερωτήματα:  

-   Τι είναι οι μονάδες αίτηση και να ζητήσετε χρεώσεων;
-   Πώς μπορώ να καθορίσω χωρητικότητα μονάδας αίτηση για μια συλλογή;
-   Πώς να εκτιμήσετε πρέπει μονάδας αίτηση της εφαρμογής μου;
-   Τι συμβαίνει εάν να υπερβαίνει ικανότητα μονάδας αίτηση για μια συλλογή;


##<a name="request-units-and-request-charges"></a>Αίτηση μονάδες και τις χρεώσεις αίτηση
DocumentDB παρέχει γρήγορη, προβλέψιμα απόδοση με *Δέσμευση* πόρων για να ικανοποιήσετε πρέπει μετάδοσης της εφαρμογής σας.  Επειδή η εφαρμογή φόρτωση και πρόσβαση αλλαγή μοτίβα διάρκεια του χρόνου, DocumentDB σάς επιτρέπει να αυξήσετε ή να μειώσετε το δεσμευμένο μετάδοσης διαθέσιμα στην εφαρμογή σας εύκολα.

Με DocumentDB, δεσμευμένο μετάδοσης έχει καθοριστεί όσον αφορά τις μονάδες αίτηση επεξεργασίας ανά δευτερόλεπτο.  Μπορείτε να θεωρήσετε αίτηση μονάδων ως νομισματική μονάδα μετάδοσης, με την οποία μπορείτε να *δεσμεύσετε* ένα ποσό των εγγυημένη αίτηση μονάδες διαθέσιμα στην εφαρμογή σας στην ανά δευτερόλεπτο.  Κάθε λειτουργία σε DocumentDB - εγγραφή ενός εγγράφου, εκτελεί ένα ερώτημα, ενημέρωση ενός εγγράφου - καταναλώνει CPU, μνήμης και IOP Προέλευσης.  Αυτό σημαίνει ότι κάθε λειτουργίας των περιλαμβάνει *αίτηση χρέωση*, γεγονός που εκφράζεται σε *μονάδες αίτηση*.  Κατανόηση των παραγόντων που επηρεάζουν χρεώσεις μονάδας αίτηση, μαζί με τις απαιτήσεις της εφαρμογής σας μετάδοσης, σάς επιτρέπει να εκτελέσετε την εφαρμογή σας ως κόστος αποτελεσματικά όσο το δυνατόν. 

##<a name="specifying-request-unit-capacity"></a>Καθορισμός δυναμικότητα μονάδας αίτηση
Κατά τη δημιουργία μιας συλλογής DocumentDB, μπορείτε να καθορίσετε τον αριθμό των μονάδων αίτηση ανά δευτερόλεπτο (RUs) που θέλετε να προορίζεται για τη συλλογή.  Όταν δημιουργηθεί η συλλογή, την πλήρη κατανομή των RUs που καθορίζεται δεσμεύεται για χρήση της συλλογής.  Κάθε συλλογή είναι εγγυημένη αφοσιωμένη και απομονωμένες μετάδοσης χαρακτηριστικά.  

Είναι σημαντικό να λάβετε υπόψη ότι DocumentDB λειτουργεί σε ένα μοντέλο δέσμευσης. Αυτό σημαίνει ότι χρέωσης για το χρονικό μετάδοσης *δεσμευμένη* για τη συλλογή, ανεξάρτητα από τον όγκο του μετάδοσης που είναι ενεργά *χρησιμοποιούνται*.  Έχετε υπόψη σας, ωστόσο, που ως φόρτωση της εφαρμογής σας, τα δεδομένα και χρήση μοτίβα αλλαγή μπορείτε εύκολα να κλιμάκωση επάνω και κάτω το ποσό της δεσμευμένες RUs μέσω SDK DocumentDB ή με την [Πύλη Azure](https://portal.azure.com).  Για περισσότερες πληροφορίες στο μετάδοσης κλίμακας προς τα επάνω και προς τα κάτω, ανατρέξτε στο θέμα [επιδόσεις DocumentDB](documentdb-performance-levels.md).

##<a name="request-unit-considerations"></a>Αίτηση για ζητήματα μονάδας
Κατά την εκτίμηση από τον αριθμό των μονάδων αίτηση για να δεσμεύσετε για τη συλλογή DocumentDB σας, είναι σημαντικό να ακολουθήσετε τις παρακάτω μεταβλητές υπόψη:

- **Μέγεθος του εγγράφου**. Ως έγγραφο μεγέθη αύξηση των μονάδων που καταναλώθηκε ανάγνωσης ή εγγραφής, θα αυξήσετε επίσης τα δεδομένα.
- **Πλήθος ιδιοτήτων εγγράφου**. Έχει προεπιλεγμένη δημιουργίας ευρετηρίου για όλες τις ιδιότητες, τις μονάδες που καταναλώθηκε για να γράψετε ένα έγγραφο, θα αυξήσετε ως η ιδιότητα αυξάνεται count.
- **Συνέπεια δεδομένων**. Όταν χρησιμοποιείτε επίπεδα συνέπειας δεδομένων έντονη ή δεσμεύεται Staleness, επιπλέον μονάδες θα καταναλωθεί για να διαβάσετε έγγραφα.
- **Ιδιότητες με ευρετήριο**. Μια πολιτική ευρετήριο σε κάθε συλλογή καθορίζει τις ιδιότητες που έχουν καταχωρηθεί στο ευρετήριο από προεπιλογή. Μπορείτε να μειώσετε την κατανάλωση μονάδας αίτηση με περιορισμό του αριθμού των ιδιοτήτων με ευρετήριο ή ενεργοποιώντας τεμπέλη δημιουργίας ευρετηρίου.
- **Δημιουργία ευρετηρίου εγγράφου**. Από προεπιλογή κάθε έγγραφο δημιουργείται αυτόματα ένα ευρετήριο, θα εκμετάλλευση λιγότερες μονάδες αίτηση Εάν επιλέξετε να μην δημιουργήσετε ευρετήριο ορισμένα από τα έγγραφά σας.
- **Μοτίβα ερωτήματος**. Την πολυπλοκότητα του ερωτήματος επηρεάζει τον αριθμό των μονάδων αίτηση είναι που καταναλώθηκε για μια λειτουργία. Ο αριθμός των κατηγορήματα, χαρακτήρα τα κατηγορήματα, προεξοχές, αριθμός UDF και το μέγεθος του συνόλου δεδομένων προέλευσης όλα επηρεάζει το κόστος των λειτουργιών ερωτημάτων.
- **Χρήση δέσμης ενεργειών**.  Όπως συμβαίνει με τα ερωτήματα, αποθηκευμένες διαδικασίες και εναύσματα εκμετάλλευση αίτηση μονάδες με βάση την πολυπλοκότητα του τις λειτουργίες που εκτελούνται. Όπως μπορείτε να αναπτύξετε την εφαρμογή σας, έλεγχος επικεφαλίδα τόκων αίτηση για να κατανοήσετε καλύτερα πώς κάθε λειτουργίας καταναλώνει χωρητικότητα μονάδας αίτηση.

##<a name="estimating-throughput-needs"></a>Εκτίμηση αναγκών μετάδοσης
Μια μονάδα αίτηση είναι μια κανονικοποιημένη μέτρηση της πρόσκλησης σε επεξεργασία κόστος. Μια μονάδα μεμονωμένης αίτησης αντιπροσωπεύει την ικανότητα επεξεργασίας που απαιτούνται για την ανάγνωση (μέσω αυτόματης σύνδεσης ή το αναγνωριστικό) ένα μεμονωμένο έγγραφο JSON 1KB που αποτελείται από 10 ιδιότητας μοναδικές τιμές (εκτός από ιδιότητες συστήματος). Μια αίτηση για δημιουργία (εισαγωγή), να αντικαταστήσετε ή να διαγράψετε το ίδιο έγγραφο θα εκμετάλλευση περισσότερες επεξεργασία από την υπηρεσία και συνεπώς περισσότερες μονάδες αίτηση.   

> [AZURE.NOTE] Η γραμμή βάσης 1 αίτηση μονάδας για ένα έγγραφο 1KB αντιστοιχεί σε ένα απλό GET με αυτόματη σύνδεση ή το αναγνωριστικό του εγγράφου.

###<a name="use-the-request-unit-calculator"></a>Χρησιμοποιήστε την αίτηση Αριθμομηχανή μονάδας
Για να σας βοηθήσει λεπτομερές πελάτες με ακρίβεια τις εκτιμήσεις μετάδοσης, δεν υπάρχει [αίτηση μονάδας Αριθμομηχανής](https://www.documentdb.com/capacityplanner) που βασίζεται στο web για να υπολογίσετε τις απαιτήσεις μονάδας αίτηση για τυπικές λειτουργίες, συμπεριλαμβανομένων των:

- Έγγραφο δημιουργεί (εγγραφές)
- Διαβάζει εγγράφου
- Διαγραφή εγγράφου
- Οι ενημερωμένες εκδόσεις εγγράφων

Το εργαλείο περιλαμβάνει επίσης υποστήριξη για εκτίμηση ανάγκες χώρου αποθήκευσης δεδομένων με βάση τα δείγματα εγγράφων που παρέχετε.

Χρήση του εργαλείου είναι απλή:

1. Στείλτε ένα ή περισσότερα αντιπρόσωπος JSON έγγραφα.

    ![Αποστολή εγγράφων για την αίτηση Αριθμομηχανή μονάδας][2]

2. Για να εκτιμήσετε απαιτήσεις αποθήκευσης δεδομένων, εισαγάγετε τον συνολικό αριθμό των εγγράφων που σκοπεύετε να το αποθηκεύσετε.

3. Εισαγάγετε τον αριθμό των εγγράφων Δημιουργία, ανάγνωση, ενημέρωση και διαγραφή λειτουργίες που απαιτούν (με βάση ανά δευτερόλεπτο). Για να εκτιμήσετε τις χρεώσεις μονάδας αίτηση των λειτουργιών ενημέρωσης εγγράφου, στείλτε ένα αντίγραφο του εγγράφου δείγματος από το παραπάνω βήμα 1 που περιλαμβάνει το τυπικό πεδίο ενημερώσεις.  Για παράδειγμα, εάν ενημερωμένες εκδόσεις εγγράφων τροποποιήσετε συνήθως δύο ιδιότητες που ονομάζεται lastLogin και userVisits, στη συνέχεια, απλώς αντιγράψτε το δείγμα εγγράφου, ενημερώστε τις τιμές για αυτές τις δύο ιδιότητες και αποστολή του εγγράφου που αντιγράψατε.

    ![Εισαγάγετε απαιτήσεις μετάδοσης στο την αίτηση Αριθμομηχανή μονάδας][3]

4. Κάντε κλικ στην επιλογή Υπολογισμός και εξετάστε τα αποτελέσματα.

    ![Αίτηση μονάδας αποτελεσμάτων][4]

>[AZURE.NOTE]Εάν έχετε τύπους εγγράφου που θα διαφέρουν σημαντικά όσον αφορά το μέγεθος και ο αριθμός των ιδιοτήτων με ευρετήριο, στείλτε ένα δείγμα κάθε *τύπο* τυπικής εγγράφου του εργαλείου και, στη συνέχεια, τον υπολογισμό των αποτελεσμάτων.

###<a name="use-the-documentdb-request-charge-response-header"></a>Χρήση της κεφαλίδας απόκρισης DocumentDB αίτηση χρέωση
Κάθε απάντηση από την υπηρεσία DocumentDB περιλαμβάνει μια προσαρμοσμένη κεφαλίδα (x ms-αίτηση-χρέωση) που περιέχει τις μονάδες αίτηση που καταναλώθηκε για την αίτηση. Αυτή η κεφαλίδα είναι επίσης προσβάσιμο μέσω του SDK DocumentDB. Στο .NET SDK, RequestCharge είναι μια ιδιότητα του αντικειμένου ResourceResponse.  Για ερωτήματα, η Εξερεύνηση ερωτήματος DocumentDB στην πύλη του Azure παρέχει πληροφορίες χρέωση αίτηση για εκτελέστηκε ερωτήματα.

![Εξέταση χρεώσεις RU στην Εξερεύνηση του ερωτήματος][1]

Με αυτό στη γνώμη, μία μέθοδος για εκτίμηση το ποσό της δεσμευμένο μετάδοσης που απαιτούνται από την εφαρμογή σας είναι να καταγράψετε την χρέωση μονάδας αίτηση που σχετίζεται με τυπικές λειτουργίες που εκτελούνται σε σχέση με μια αντιπρόσωπος εγγράφου που χρησιμοποιείται από την εφαρμογή σας και, στη συνέχεια, ο αριθμός των λειτουργιών εκτίμηση σκοπεύετε να εκτελεί κάθε δευτερόλεπτο.  Φροντίστε να μετρήσετε και να συμπεριλάβετε τυπικές ερωτήματα και η χρήση δέσμης ενεργειών DocumentDB καθώς και.

>[AZURE.NOTE]Εάν έχετε τύπους εγγράφου που θα διαφέρουν σημαντικά όσον αφορά το μέγεθος και ο αριθμός των ιδιοτήτων με ευρετήριο, εγγραφή, στη συνέχεια, την χρέωση μονάδας αίτηση ισχύει η λειτουργία που σχετίζονται με κάθε *τύπο* τυπικής του εγγράφου.

Για παράδειγμα:

1. Εγγραφή την αίτηση χρέωση μονάδας της δημιουργίας (εισαγωγή) τυπικές εγγράφου. 
2. Εγγραφή την αίτηση χρέωση μονάδας ανάγνωσης τυπικές εγγράφου.
3. Εγγραφή την αίτηση χρέωση μονάδας ενημέρωσης τυπικές εγγράφου.
3. Εγγραφή την αίτηση χρέωση μονάδας ερωτημάτων τυπικές, κοινά εγγράφου.
4. Εγγραφή την αίτηση μονάδας χρέωση οποιαδήποτε προσαρμοσμένων δεσμών ενεργειών (αποθηκευμένες διαδικασίες, εναύσματα, συναρτήσεις που ορίζονται από το χρήστη) χρησιμοποιηθούν από την εφαρμογή
5. Ο υπολογισμός των μονάδων απαιτείται αίτηση δίνεται ο αριθμός εκτιμώμενη των λειτουργιών που σκοπεύετε να εκτελέσετε κάθε δευτερόλεπτο.

##<a name="a-request-unit-estimation-example"></a>Ένα παράδειγμα εκτίμησης μονάδας αίτηση
Εξετάστε το ακόλουθο έγγραφο ~ 1 Γνωσιακής Βάσης:

    {
     "id": "08259",
    "description": "Cereals ready-to-eat, KELLOGG, KELLOGG'S CRISPIX",
    "tags": [
        {
        "name": "cereals ready-to-eat"
        },
        {
        "name": "kellogg"
        },
        {
        "name": "kellogg's crispix"
        }
    ],
    "version": 1,
    "commonName": "Includes USDA Commodity B855",
    "manufacturerName": "Kellogg, Co.",
    "isFromSurvey": false,
    "foodGroup": "Breakfast Cereals",
    "nutrients": [
        {
        "id": "262",
        "description": "Caffeine",
        "nutritionValue": 0,
        "units": "mg"
        },
        {
        "id": "307",
        "description": "Sodium, Na",
        "nutritionValue": 611,
        "units": "mg"
        },
        {
        "id": "309",
        "description": "Zinc, Zn",
        "nutritionValue": 5.2,
        "units": "mg"
        }
    ],
    "servings": [
        {
        "amount": 1,
        "description": "cup (1 NLEA serving)",
        "weightInGrams": 29
        }
    ]
    }

>[AZURE.NOTE]Έγγραφα είναι minified στο DocumentDB, έτσι ώστε το σύστημα υπολογίζεται το μέγεθος του εγγράφου παραπάνω είναι λίγο λιγότερο από 1KB.


Ο παρακάτω πίνακας εμφανίζει κατά προσέγγιση αίτηση χρεώσεις μονάδας για τυπικές λειτουργίες σε αυτό το έγγραφο (το φορτίο μονάδας κατά προσέγγιση αίτηση προϋποθέτει ότι το επίπεδο συνέπειας λογαριασμού έχει οριστεί σε "Περίοδος λειτουργίας" και ότι όλα τα έγγραφα που είναι αυτόματα στο ευρετήριο):

Η λειτουργία|Πρόσκληση σε μονάδα χρέωση 
---|---
Δημιουργία εγγράφου|~ 15 RU 
Ανάγνωση εγγράφων|~ 1 RU
Έγγραφο ερωτήματος κατά αναγνωριστικό|~2.5 RU

Επιπλέον, αυτός ο πίνακας εμφανίζει κατά προσέγγιση αίτηση χρεώσεις μονάδας για τυπικές ερωτήματα που χρησιμοποιούνται στην εφαρμογή:

Ερώτημα|Πρόσκληση σε μονάδα χρέωση|# Επιστρέφεται εγγράφων
---|---|--- 
Επιλέξτε τροφίμων κατά αναγνωριστικό|~2.5 RU|1 
Επιλέξτε τροφίμων από τον κατασκευαστή|~ 7 RU|7
Επιλέξτε ομάδα τροφίμων και σειρά κατά βάρος|~ 70 RU|100
Επιλέξτε πρώτων 10 τροφίμων σε μια ομάδα εστίασης|~ 10 RU|10

>[AZURE.NOTE]Χρεώσεις RU ποικίλλουν ανάλογα με τον αριθμό των εγγράφων που επιστρέφονται.

Με αυτές τις πληροφορίες, θα σας μπορεί να υπολογίσει τις απαιτήσεις RU για αυτήν την εφαρμογή δεδομένου του αριθμού των λειτουργιών και ερωτήματα αναμένεται ανά δευτερόλεπτο:

Η λειτουργία/ερωτήματος|Εκτιμώμενο αριθμό ανά δευτερόλεπτο|Απαιτείται RUs 
---|---|--- 
Δημιουργία εγγράφου|10|150 
Ανάγνωση εγγράφων|100|100 
Επιλέξτε τροφίμων από τον κατασκευαστή|25|175 
Επιλέξτε κατά ομάδα εστίασης|10|700 
Επιλέξτε πρώτων 10|15|150 συνόλου|155|1275

Σε αυτήν την περίπτωση, αναμένεται μια απαίτηση μέση ταχύτητα 1,275 RU/s.  Στρογγυλοποίηση προς το πλησιέστερο 100, θα σας θα προμήθεια 1 300 RU/s για τη συλλογή του αυτής της εφαρμογής.

##<a id="RequestRateTooLarge"></a>Που υπερβαίνουν τα όρια δεσμευμένη μετάδοσης
Ανάκληση ότι κατανάλωση μονάδας αίτηση αξιολογείται ως ένα ποσοστό ανά δευτερόλεπτο. Για τις εφαρμογές που υπερβαίνουν το επιτόκιο μονάδας προμήθεια του φακέλου αίτηση για μια συλλογή, προσκλήσεις σε αυτήν τη συλλογή θα να επιβραδύνει μέχρι το επιτόκιο αποθέτει κάτω από το δεσμευμένο επίπεδο. Όταν παρουσιάζεται επιτάχυνση, στο διακομιστή preemptively θα τερματίσετε την αίτηση με RequestRateTooLargeException (κωδικός κατάστασης 429 HTTP) και να επιστρέψετε στην κεφαλίδα x-ms-"Επανάληψη"-μετά από-ms που υποδεικνύει το χρονικό διάστημα, σε χιλιοστά του δευτερολέπτου, ο χρήστης πρέπει να αναμονής πριν από την reattempting την αίτηση.

    HTTP Status 429
    Status Line: RequestRateTooLarge
    x-ms-retry-after-ms :100

Εάν χρησιμοποιείτε τα ερωτήματα .NET SDK προγράμματος-πελάτη και LINQ, στη συνέχεια, τις περισσότερες φορές ποτέ πρέπει να ασχοληθείτε με αυτή την εξαίρεση, όπως την τρέχουσα έκδοση του προγράμματος-πελάτη SDK .NET εντοπίζει ρητά αυτήν την απόκριση, τηρεί τις καθοριστεί διακομιστής "Επανάληψη"-μετά την κεφαλίδα και επαναλήψεις την αίτηση. Εκτός εάν ο λογαριασμός σας γίνεται πρόσβαση ταυτόχρονα από πολλούς υπολογιστές-πελάτες, θα ολοκληρωθεί με επιτυχία η επόμενη "Επανάληψη".

Εάν έχετε περισσότερους από έναν υπολογιστή-πελάτη αθροιστικά λειτουργικό επάνω από το επιτόκιο αίτηση, η προεπιλεγμένη συμπεριφορά "Επανάληψη" ενδέχεται να μην αρκεί και ο υπολογιστής-πελάτης θα εμφανίσουν μια DocumentClientException με κωδικό κατάστασης 429 στην εφαρμογή. Στις περιπτώσεις όπως αυτή, ίσως θέλετε να χειρισμός συμπεριφορά "Επανάληψη" και λογικής της εφαρμογής σας σφάλμα χειρισμός διαδικασίες ή αυξάνοντας τη δεσμευμένη μετάδοσης για τη συλλογή.

##<a name="next-steps"></a>Επόμενα βήματα

Για να μάθετε περισσότερα σχετικά με τη δεσμευμένη μετάδοσης με βάσεις δεδομένων Azure DocumentDB, εξερευνήστε αυτούς τους πόρους:
 
- [Τις τιμές DocumentDB](https://azure.microsoft.com/pricing/details/documentdb/)
- [Διαχείριση DocumentDB χωρητικότητα](documentdb-manage.md) 
- [Μοντελοποίηση δεδομένων στο DocumentDB](documentdb-modeling-data.md)
- [Επίπεδα επιδόσεων DocumentDB](documentdb-partition-data.md)

Για να μάθετε περισσότερα σχετικά με το DocumentDB, ανατρέξτε στην Azure DocumentDB [τεκμηρίωση](https://azure.microsoft.com/documentation/services/documentdb/). 

Για να ξεκινήσετε με κλίμακα και επιδόσεων δοκιμών με DocumentDB, ανατρέξτε στο θέμα [επιδόσεις και την κλίμακα δοκιμών με Azure DocumentDB](documentdb-performance-testing.md).


[1]: ./media/documentdb-request-units/queryexplorer.png 
[2]: ./media/documentdb-request-units/RUEstimatorUpload.png
[3]: ./media/documentdb-request-units/RUEstimatorDocuments.png
[4]: ./media/documentdb-request-units/RUEstimatorResults.png
[5]: ./media/documentdb-request-units/RUCalculator2.png
