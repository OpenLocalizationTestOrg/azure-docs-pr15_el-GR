<properties
   pageTitle="Επανάληψη γενικές οδηγίες για τη | Microsoft Azure"
   description="Οδηγίες για τη "Επανάληψη" για το χειρισμό μεταβατικές σφαλμάτων."
   services=""
   documentationCenter="na"
   authors="dragon119"
   manager="christb"
   editor=""
   tags=""/>

<tags
   ms.service="best-practice"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="07/13/2016"
   ms.author="masashin"/>

# <a name="retry-general-guidance"></a>Γενικές οδηγίες για τη επανάληψης

[AZURE.INCLUDE [pnp-header](../includes/guidance-pnp-header-include.md)]

## <a name="overview"></a>Επισκόπηση

Όλες οι εφαρμογές που επικοινωνία με υπηρεσίες απομακρυσμένης και πόρους πρέπει να είναι διάκριση πεζών-κεφαλαίων μεταβατικές σφάλματα. Αυτό συμβαίνει ειδικά για εφαρμογές που εκτελούνται στο cloud, όπου ο χαρακτήρας του περιβάλλοντος και τη σύνδεση μέσω του Internet σημαίνει αυτοί οι τύποι των σφαλμάτων είναι πιθανό να εμφανιστεί πιο συχνά. Μεταβατικές σφάλματα περιλαμβάνουν στιγμιαία απώλεια της συνδεσιμότητας δικτύου για στοιχεία και τις υπηρεσίες, το προσωρινό μη διαθεσιμότητα μιας υπηρεσίας ή χρονικών ορίων που προκύπτουν όταν μια υπηρεσία είναι απασχολημένη. Αυτά τα σφάλματα είναι συχνά Αυτόματη διόρθωση και, εάν η ενέργεια επαναλαμβάνεται μετά από ένα κατάλληλο καθυστέρηση είναι πιθανό ολοκληρωθεί με επιτυχία.

Αυτό το έγγραφο καλύπτει γενικές οδηγίες για το χειρισμό μεταβατικές σφαλμάτων. Για πληροφορίες σχετικά με το χειρισμό μεταβατικές σφάλματα όταν χρησιμοποιείτε τις υπηρεσίες Microsoft Azure, ανατρέξτε στο θέμα [οδηγίες επανάληψης Azure συγκεκριμένης υπηρεσίας](best-practices-retry-service-specific.md).

## <a name="why-do-transient-faults-occur-in-the-cloud"></a>Γιατί παρουσιάζονται σφάλματα μεταβατικές στο cloud;

Μεταβατικές σφάλματα μπορεί να προκύψουν σε οποιοδήποτε περιβάλλον, οποιαδήποτε πλατφόρμα ή λειτουργικό σύστημα και οποιοδήποτε είδος της εφαρμογής. Στις λύσεις που εκτελείται σε τοπικό, υποδομή εσωτερικής εγκατάστασης, απόδοση και διαθεσιμότητα από την εφαρμογή και τα στοιχεία είναι συνήθως διατηρούνται μέσω υλικού ακριβό και στην περιοχή-χρησιμοποιούνται συχνά πλεονασμού και στοιχεία και τους πόρους που βρίσκεται σε κάθε έναν άλλο. Ενώ με αυτόν τον τρόπο αποτυχία λιγότερο πιθανό, αυτό μπορεί να εξακολουθεί να έχει ως αποτέλεσμα μεταβατικές σφαλμάτων - και ακόμα ένα μη διαθεσιμότητα έως απρόβλεπτες συμβάντα όπως εξωτερική παροχή ενέργειας ή ζητήματα δικτύου ή άλλα σενάρια καταστροφής.

Φιλοξενίας cloud, όπως συστήματα ιδιωτικό cloud, μπορεί να προσφέρει μια μεγαλύτερη διαθεσιμότητα συνολική χρησιμοποιώντας κοινόχρηστους πόρους, πλεονασμού, αυτόματη ανακατεύθυνση και εκχώρηση πόρων δυναμική σε έναν πολύ μεγάλο αριθμό κόμβους υπολογιστικών αγαθό. Ωστόσο, ο χαρακτήρας των αυτά τα περιβάλλοντα μπορεί να σημαίνουν ότι τα σφάλματα μεταβατικές είναι πιο πιθανό να προκύψει. Υπάρχουν πολλοί λόγοι για αυτό:

* Πλήθος των πόρων σε ένα περιβάλλον cloud γίνεται κοινή χρήση και πρόσβαση σε αυτούς τους πόρους υπόκειται περιορισμού προκειμένου να προστατεύσετε τον πόρο. Ορισμένες υπηρεσίες θα αρνηθεί συνδέσεις όταν η φόρτωση αυξάνεται κατά ένα συγκεκριμένο επίπεδο ή φτάσει χρέωσης μέγιστη ταχύτητα μετάδοσης, προκειμένου να επιτρέψετε επεξεργασίας των προσκλήσεων σε υπάρχουσα και να διατηρήσετε την απόδοση της υπηρεσίας για όλους τους χρήστες. Περιορισμού σάς βοηθά να διατηρείτε την ποιότητα της υπηρεσίας για γειτόνων και άλλες μισθωτές χρησιμοποιώντας τον κοινόχρηστο πόρο.
* Περιβάλλοντα cloud δημιουργούνται χρησιμοποιώντας τεράστιες αριθμούς αγαθό υλικού μονάδες. Μπορούν παράδοση απόδοσης με δυναμικά τη διανομή η φόρτωση σε πολλές υπολογιστών μονάδων και τα στοιχεία υποδομής και παράδοση αξιοπιστία με αυτόματα ανακύκλωσης ή αντικαθιστώντας αποτυχίας μονάδες. Αυτό δυναμικής χαρακτήρας σημαίνει ότι μεταβατικές σφαλμάτων και αποτυχίες προσωρινή σύνδεση μπορεί να προκύψουν κατά καιρούς.
* Συχνά υπάρχουν περισσότερα στοιχεία υλικού, συμπεριλαμβανομένης της υποδομής δικτύου όπως δρομολογητές και φόρτωση balancers, μεταξύ της εφαρμογής και τους πόρους και τις υπηρεσίες που χρησιμοποιεί. Αυτή η πρόσθετη υποδομή μερικές φορές μπορεί να εισαγάγει λανθάνων χρόνος επιπλέον σύνδεσης και σφάλματα μεταβατικές σύνδεσης.
* Συνθήκες δικτύου μεταξύ του προγράμματος-πελάτη και του διακομιστή ενδέχεται να είναι μεταβλητή, ιδίως όταν επικοινωνίας διασταυρώνεται με το Internet. Ακόμη και σε θέσεις στην εσωτερική εγκατάσταση, φορτία πολύ μεγάλη κυκλοφορία μπορεί να επιβραδύνει επικοινωνίας και να προκαλέσει αποτυχίες περιστασιακό σύνδεσης.

## <a name="challenges"></a>Προκλήσεις
Μεταβατικές σφάλματα μπορεί να έχει μια μεγάλη επίδραση στη πιθανών διαθεσιμότητα μιας εφαρμογής του, ακόμα και αν έχει ελεγχθεί λεπτομερώς στην περιοχή όλες τις προβλεπόμενες περιπτώσεις. Για να εξασφαλίσετε ότι οι εφαρμογές που φιλοξενείται στο cloud λειτουργήσουν αξιόπιστα, πρέπει να μπορούν να απαντούν σε αυτές τις προκλήσεις παρακάτω:

* Η εφαρμογή πρέπει να έχετε τη δυνατότητα να εντοπίσει σφάλματα, όταν προκύπτουν και να προσδιορίσετε αν αυτά τα σφάλματα είναι πιθανό να είναι μεταβατικές, πιο μεγάλη διάρκειας ή αποτυχίες τερματικού. Διαφορετικά πόροι είναι πιθανό να επιστρέφουν διαφορετικές απαντήσεις, όταν παρουσιάζεται ένα σφάλμα και αυτές τις απαντήσεις επίσης μπορεί να διαφέρουν ανάλογα με το περιεχόμενο της λειτουργίας; Για παράδειγμα, η απόκριση για ένα σφάλμα κατά την ανάγνωση από χώρο αποθήκευσης μπορεί να διαφέρει από απόκριση για ένα μήνυμα σφάλματος κατά την εγγραφή στο χώρο αποθήκευσης. Πολλά τους πόρους και τις υπηρεσίες έχουν καλά τεκμηρίωση μεταβατικές αποτυχία συμβάσεις. Ωστόσο, όπου οι πληροφορίες αυτές δεν είναι διαθέσιμη, μπορεί να είναι δύσκολο να ανακαλύψετε το χαρακτήρα του σφάλματος και αν είναι πιθανό να είναι μεταβατικές.
* Η εφαρμογή πρέπει να μπορούν να επαναλάβετε τη λειτουργία εάν Καθορίζει ότι το σφάλμα είναι πιθανό να είναι μεταβατικές και παρακολούθηση των του αριθμού των φορών που έχει επαναληφθεί η λειτουργία.
* Η εφαρμογή πρέπει να χρησιμοποιήσετε μια κατάλληλη στρατηγική για το επαναλήψεις. Αυτή η στρατηγική καθορίζει πόσες φορές αυτό θα πρέπει να επαναλάβετε, την καθυστέρηση μεταξύ κάθε προσπάθειας και τις ενέργειες για να μετά από μια προσπάθεια αποτυχίας. Τον αριθμό των προσπαθειών και την καθυστέρηση ανάμεσα σε κάθε μία από τις συχνά είναι δύσκολο να προσδιορίσετε και να ποικίλλουν ανάλογα με τον τύπο του πόρου, καθώς και τις τρέχουσες συνθήκες λειτουργίας του πόρου και την ίδια την εφαρμογή.

## <a name="general-guidelines"></a>Γενικές οδηγίες
Οι παρακάτω οδηγίες θα σας βοηθήσουν να σχεδιάσετε ένα κατάλληλο μεταβατικές σφάλμα παράδοση μηχανισμό για τις εφαρμογές σας:

* **Καθορίστε εάν υπάρχει ένας μηχανισμός ενσωματωμένη "Επανάληψη":**
  * Πολλές υπηρεσίες παρέχουν μια βιβλιοθήκη SDK ή προγράμματος-πελάτη που περιέχει ένα σφάλμα μεταβατικές χειρισμός μηχανισμό. Η πολιτική "Επανάληψη" χρησιμοποιεί συνήθως προσαρμοσμένο στις απαιτήσεις της υπηρεσίας προορισμού και τη φύση. Εναλλακτικά, διασυνδέσεις ΥΠΌΛΟΙΠΑ για τις υπηρεσίες ενδέχεται να επιστρέψει πληροφορίες που είναι χρήσιμο για τον προσδιορισμό είτε ένα "Επανάληψη" είναι η κατάλληλη και πόσος χρόνος αναμονής πριν από την επόμενη προσπάθεια "Επανάληψη".
  * Χρησιμοποιήστε το μηχανισμό ενσωματωμένη "Επανάληψη" όπου είναι διαθέσιμο, εκτός εάν έχετε συγκεκριμένες και κατανοητή απαιτήσεις που σημαίνουν είναι πιο κατάλληλο μια συμπεριφορά διαφορετικό "Επανάληψη".
* **Προσδιορισμός εάν η λειτουργία είναι κατάλληλη για επανάληψη**:
  * Μπορείτε μόνο θα πρέπει να επαναλάβετε λειτουργίες όπου τα σφάλματα μεταβατικές (συνήθως που υποδεικνύεται από τη φύση του σφάλματος) και, εάν υπάρχει τουλάχιστον ορισμένες πιθανότητα ότι η λειτουργία θα είναι επιτυχής όταν reattempted. Δεν υπάρχει κανένα σημείο του reattempting λειτουργίες που υποδεικνύει μια μη έγκυρη λειτουργία όπως μια βάση δεδομένων σε ένα στοιχείο που δεν υπάρχει, η ενημερωμένη έκδοση ή προσκλήσεις σε μια υπηρεσία ή πόρου που έχει υποστεί ένα λάθος
  * Σε γενικές γραμμές, θα πρέπει να υλοποιήσετε επαναλήψεις μόνο όπου μπορεί να καθοριστεί το πλήρες επίδραση από αυτές και τις συνθήκες και είναι κατανοητή και μπορεί να επικυρωθεί. Εάν όχι, αφήστε το στον κώδικα κλήσης για την υλοποίηση επαναλήψεις. Να θυμάστε ότι τα σφάλματα που επιστρέφονται από τους πόρους και τις υπηρεσίες έξω από το στοιχείο ελέγχου μπορεί να εξελίσσεται μέσα στο χρόνο και ίσως χρειαστεί να επιστρέψουν σας λογική εντοπισμού σφαλμάτων μεταβατικές.
  * Κατά τη δημιουργία υπηρεσιών ή στοιχεία, εξετάστε το ενδεχόμενο εφαρμογής τους κωδικούς σφάλματος και τα μηνύματα που θα σας βοηθήσει προγράμματα-πελάτες καθορίζουν εάν θα πρέπει να επαναλάβετε απέτυχε λειτουργίες. Συγκεκριμένα, υποδηλώνουν εάν ο υπολογιστής-πελάτης θα πρέπει να επαναλάβετε τη λειτουργία (ίσως από επιστρέφει μια τιμή **isTransient** ) και προτείνετε μια κατάλληλη καθυστέρηση πριν από την επόμενη προσπάθεια "Επανάληψη". Εάν δημιουργείτε μια υπηρεσία web, εξετάστε το ενδεχόμενο να επιστρέφει προσαρμοσμένων σφαλμάτων που ορίζονται από το εντός του συμβόλαια. Παρόλο που ενδέχεται να μην μπορούν να διαβάσουν αυτές τις γενικής χρήσης προγράμματα-πελάτες, αυτά θα είναι χρήσιμες κατά τη δημιουργία προσαρμοσμένου προγράμματα-πελάτες.
* **Καθορίστε μια κατάλληλη των επαναλήψεων και το χρονικό διάστημα:**
  * Είναι απαραίτητο να βελτιστοποιήσετε το πλήθος των επαναλήψεων και το χρονικό διάστημα για να τον τύπο της περίπτωσης χρήσης. Εάν ξανά μια αρκετές φορές, η εφαρμογή θα είναι δυνατή η ολοκλήρωση της λειτουργίας και είναι πιθανό να αντιμετωπίσουν αποτυχία. Εάν επαναλάβετε πολλές φορές ή με πολύ σύντομο ένα χρονικό διάστημα μεταξύ προσπαθεί, την εφαρμογή ενδεχομένως να κρατήστε πόρους όπως νήματα, συνδέσεων και μνήμης για μεγάλη περιόδους, οι οποίες θα επηρεάσουν αρνητικά την εύρυθμη λειτουργία της εφαρμογής.
  * Τις κατάλληλες τιμές για το χρονικό διάστημα και τον αριθμό των προσπαθειών "Επανάληψη" εξαρτώνται από τον τύπο της λειτουργίας που επιχειρήθηκε. Για παράδειγμα, εάν η λειτουργία είναι μέρος μιας παρέμβαση του χρήστη, το χρονικό διάστημα θα πρέπει να είναι σύντομη και μόνο μερικά επαναλήψεις επιχειρήσατε να αποφύγετε τη δημιουργία χρηστών αναμονή για απάντηση (που περιέχει το ανοίξετε τις συνδέσεις και να μειώσετε διαθεσιμότητα για άλλους χρήστες). Εάν η λειτουργία είναι μέρος μια ροή εργασίας εκτελείται χρόνο ή είναι κρίσιμης σημασίας, όπου ακύρωσης και επανεκκίνηση της διαδικασίας είναι ακριβό ή χρονοβόρα, είναι κατάλληλη για να περιμένετε πλέον μεταξύ των προσπαθειών και προσπαθήστε ξανά να περισσότερες φορές.
  * Καθορισμός τα κατάλληλα χρονικά διαστήματα μεταξύ των επαναλήψεων είναι το πιο δύσκολη τμήμα της Σχεδιασμός επιτυχής στρατηγικής. Τυπικές στρατηγικές Χρησιμοποιήστε τους παρακάτω τύπους χρονικό διάστημα επανάληψης:
      * **Πίσω απενεργοποίηση εκθετική δύναμη**. Η εφαρμογή χρειάζεται να περιμένει μια σύντομη ώρα πριν από την πρώτη επανάληψη αναζήτησης και, στη συνέχεια, αυξάνοντας εκθετικά φορές μεταξύ κάθε οι επόμενες "Επανάληψη". Για παράδειγμα, αυτό μπορεί να επαναλάβετε τη λειτουργία μετά από 3 δευτερόλεπτα, 12 δευτερόλεπτα, 30 δευτερόλεπτα, και ούτω καθεξής.
      * **Τμηματική χρονικά διαστήματα**. Η εφαρμογή χρειάζεται να περιμένει μια σύντομη ώρα πριν από την πρώτη επανάληψη αναζήτησης και, στη συνέχεια, αύξηση βαθμιαία φορές μεταξύ κάθε οι επόμενες "Επανάληψη". Για παράδειγμα, αυτό μπορεί να επαναλάβετε τη λειτουργία μετά από 3 δευτερόλεπτα, 7 δευτερόλεπτα, 13 δευτερόλεπτα, και ούτω καθεξής.
      * **Τακτά χρονικά διαστήματα**. Αναμονή της εφαρμογής για το ίδιο χρονικό διάστημα μεταξύ κάθε προσπάθειας. Για παράδειγμα, αυτό μπορεί να επαναλάβετε τη λειτουργία κάθε 3 δευτερόλεπτα.
      * **Άμεση προσπαθήστε ξανά**. Μερικές φορές ένα σφάλμα μεταβατικές είναι πολύ σύντομο, ίσως οφείλεται σε ένα συμβάν, όπως μια διένεξη πακέτων δικτύου ή ένα Συλλέκτη σε ένα στοιχείο υλικού. Σε αυτήν την περίπτωση, η επανάληψη αμέσως τη λειτουργία είναι κατάλληλο επειδή το ενδέχεται να αποτύχει όταν το σφάλμα έχει καταργηθεί το χρόνο που χρειάζεται η εφαρμογή για να συγκεντρώσετε και να στείλετε την πρόσκληση σε επόμενη. Ωστόσο, πρέπει ποτέ να είναι περισσότερες από μία προσπάθεια άμεσης επανάληψης και θα πρέπει να μεταβαίνετε σε εναλλακτικές στρατηγικές, όπως όπως εκθετική πίσω Απενεργοποίηση ή εναλλακτικών ενέργειες, εάν αποτύχει η άμεση "Επανάληψη".
      * **Τυχαία ρύθμιση**. Οποιοδήποτε από τα "Επανάληψη" στρατηγικές που αναφέρονται παραπάνω ενδέχεται να περιλαμβάνουν μια τυχαία ρύθμιση για να αποτρέψετε την πολλές παρουσίες του προγράμματος-πελάτη αποστολή οι επόμενες προσπάθειες την ίδια στιγμή. Για παράδειγμα, μία παρουσία να επαναλάβετε τη λειτουργία μετά από 3 δευτερόλεπτα, 11 δευτερόλεπτα, 28 δευτερόλεπτα και ούτω καθεξής, ενώ μια άλλη παρουσία μπορεί να επαναλάβετε τη λειτουργία μετά από 4 δευτερόλεπτα, 12 δευτερόλεπτα, 26 δευτερόλεπτα, και ούτω καθεξής. Τυχαία ρύθμιση είναι μια τεχνική χρήσιμες που μπορεί να συνδυαστεί με άλλες στρατηγικές.  
  * Γενικά, χρησιμοποιήστε μια εκθετική στρατηγική πίσω απενεργοποίηση για λειτουργίες φόντο και άμεση ή κανονική διάστημα στρατηγικές "Επανάληψη" για λειτουργίες αλληλεπίδρασης. Και στις δύο περιπτώσεις, θα πρέπει να επιλέξετε την καθυστέρηση και το πλήθος των επαναλήψεων, έτσι ώστε το μέγιστο λανθάνοντα χρόνο για όλους προσπάθειες επανάληψης είναι εντός της απαίτησης λανθάνων χρόνος απαιτείται να ολοκληρωμένες.
  * Λάβετε υπόψη το συνδυασμό όλους τους παράγοντες που συνεισφέρουν του συνολικού μέγιστου χρονικού ορίου για μια λειτουργία επαναλήφθηκαν. Τους παρακάτω παράγοντες περιλαμβάνει το χρόνο που λαμβάνονται για αποτυχίας σύνδεσης για την παραγωγή απόκριση (συνήθως οριστεί από μια τιμή χρονικού ορίου στο πρόγραμμα-πελάτη) καθώς και την καθυστέρηση μεταξύ προσπάθειες επανάληψης και τον μέγιστο αριθμό των επαναλήψεων. Το σύνολο των όλες αυτές οι ώρες μπορεί να έχει ως αποτέλεσμα πολύ μεγάλες συνολική λειτουργία ώρες, ιδίως όταν χρησιμοποιώντας μια εκθετική καθυστέρηση στρατηγική όπου το διάστημα μεταξύ των επαναλήψεων μεγαλώνει γρήγορα μετά από κάθε αποτυχία. Εάν μια διαδικασία πρέπει να πληροί επιπέδου σύμβαση παροχής ένα συγκεκριμένο υπηρεσιών (SLA), ο συνολικός χρόνος λειτουργίας, συμπεριλαμβανομένων όλων των χρονικών ορίων και καθυστερήσεις, πρέπει να μέσα που καθορίζονται σε το SLA
  * Στρατηγικές Over-Aggressive "Επανάληψη", οι οποίες έχουν πολύ σύντομο χρονικά διαστήματα ή πολύ μπορεί να επαναλήψεις, μπορούν να έχουν αρνητικές συνέπειες για τον πόρο προορισμού ή την υπηρεσία. Αυτό μπορεί να εμποδίσει τον πόρο ή την υπηρεσία ανάκτηση από την κατάσταση υπερφορτωμένο και θα εξακολουθήσει να αποκλείσετε ή να αρνηθεί αιτήσεις. Αυτό έχει ως αποτέλεσμα έναν κύκλο vicious όπου αποστέλλονται περισσότερες και περισσότερες προσκλήσεις για τον πόρο ή της υπηρεσίας και συνεπώς τη δυνατότητα να ανακτήσετε περαιτέρω μειώνεται.
  * Λάβετε υπόψη το χρονικό όριο από τις λειτουργίες κατά την επιλογή τα χρονικά διαστήματα "Επανάληψη" για να αποφύγετε την εκκίνηση ενός οι επόμενες προσπάθειες αμέσως (για παράδειγμα, εάν το χρονικό όριο είναι παρόμοιο με το χρονικό διάστημα επανάληψης). Μπορείτε επίσης να εάν πρέπει να διατηρήσετε το συνολικό δυνατή περίοδος (το χρονικό όριο συν τα χρονικά διαστήματα "Επανάληψη") για να κάτω από μια συγκεκριμένη συνολικός χρόνος. Ενδέχεται να επηρεάσουν λειτουργίες που έχουν χρονικών ορίων ασυνήθιστα μικρό ή πολύ μεγάλο χρονικό διάστημα σε αναμονή και πώς μπορείτε συχνά να επαναλάβει τη λειτουργία.
  * Χρησιμοποιήστε τον τύπο του την εξαίρεση και περιέχει δεδομένα ή τους κωδικούς σφάλματος και τα μηνύματα που επιστρέφονται από την υπηρεσία, για να βελτιστοποιήσετε το χρονικό διάστημα και τον αριθμό των επαναλήψεων. Για παράδειγμα, ορισμένες εξαιρέσεις ή σφάλμα κωδικούς (όπως το HTTP κωδικός 503 υπηρεσία δεν είναι διαθέσιμη με κεφαλίδα "Επανάληψη" μετά την απάντηση) μπορεί να υποδεικνύουν πώς το σφάλμα μπορεί να διαρκέσει ή που η υπηρεσία απέτυχε και δεν θα απαντήσετε σε τυχόν οι επόμενες προσπάθειες.
* **Καλό είναι να αποφεύγετε καταπολέμησης μοτίβα**:
  * Στο τεράστιες περισσότερες περιπτώσεις, θα πρέπει να αποφύγετε υλοποιήσεις που περιλαμβάνουν διπλή επίπεδα του κώδικα "Επανάληψη". Αποφύγετε σχέδια που περιλαμβάνουν επικαλυπτόμενου μηχανισμοί "Επανάληψη" ή που υλοποίηση "Επανάληψη" σε όλα τα στάδια μιας λειτουργίας που περιλαμβάνει μια ιεραρχία των αιτήσεων, εκτός αν έχετε συγκεκριμένες απαιτήσεις αυτή τη ζήτηση. Σε αυτές τις εξαιρετικές περιπτώσεις, χρησιμοποιήστε τις πολιτικές που αποτροπή πλεονάζουσα τους αριθμούς των επαναλήψεων και περίοδοι καθυστέρηση και βεβαιωθείτε ότι μπορείτε να κατανοήσετε τις συνέπειες. Για παράδειγμα, εάν ένα στοιχείο κάνει μια αίτηση σε μια άλλη, ποια, στη συνέχεια, αποκτά πρόσβαση σε "Επανάληψη" με ένα πλήθος τριών τόσο κλήσεων θα υπάρξει υλοποίηση της υπηρεσίας προορισμού και, εννέα επανάληψης επιχειρεί συνολικά σε σχέση με την υπηρεσία. Πολλές υπηρεσίες και πόροι υλοποίηση μηχανισμό ενσωματωμένη "Επανάληψη" και θα πρέπει να εξετάσετε πώς μπορείτε να απενεργοποιήσετε ή να τροποποιήσετε αυτήν τη διαδικασία, εάν πρέπει να υλοποιήσετε επαναλήψεις σε υψηλότερο επίπεδο.
  *  Υλοποίηση ποτέ ένα μηχανισμό απεριόριστες "Επανάληψη". Αυτό είναι πιθανό να αποτρέψετε του πόρου ή της υπηρεσίας ανάκτησης από καταστάσεις υπερφόρτωσης και προκαλέσει περιορισμού και απορριφθεί συνδέσεις για να συνεχίσετε για μεγαλύτερο χρονικό. Χρησιμοποιήστε έναν ορισμένο αριθμό ή επαναλήψεις ή να υλοποιήσετε ένα μοτίβο όπως [διακόπτη κυκλώματος](http://msdn.microsoft.com/library/dn589784.aspx) για να επιτρέψετε την υπηρεσία για να ανακτήσετε.
  * Ποτέ εκτελέσετε περισσότερες από μία φορές μια άμεση "Επανάληψη".
  * Αποφύγετε τη χρήση ένα διάστημα "Επανάληψη" κανονική, ιδιαίτερα αν έχετε μεγάλο αριθμό προσπάθειες, κατά την πρόσβαση σε υπηρεσίες και πόροι στο Azure. Η βέλτιστη προσέγγιση είναι αυτό το σενάριο είναι μια εκθετική στρατηγική "Απενεργοποίηση πίσω" με μια δυνατότητα κυκλώματος πρόσφατες.
  * Αποτροπή πολλές παρουσίες του ίδιου προγράμματος-πελάτη ή πολλές παρουσίες από διαφορετικά προγράμματα-πελάτες, αποστολή επαναλήψεις τις ίδιες ώρες. Εάν αυτή είναι πιθανό να προκύψουν, Παρουσιάστε τυχαία ρύθμιση σε τα χρονικά διαστήματα "Επανάληψη".
* **Ελέγξτε το στρατηγική "Επανάληψη" και την εφαρμογή:**
  * Βεβαιωθείτε ότι ελέγχετε πλήρως υλοποίηση της στρατηγικής "Επανάληψη" στην περιοχή ως ευρεία σύνολο συνθήκες όσο το δυνατόν, ιδίως όταν είναι τόσο την εφαρμογή και το προορισμού πόρων ή τις υπηρεσίες που χρησιμοποιεί ακραίες φόρτος. Για να ελέγξετε τη συμπεριφορά κατά τις δοκιμές, μπορείτε να:
      * Εισαγωγή μεταβατικές και μη μεταβατική σφάλματα στην υπηρεσία. Για παράδειγμα, να στείλετε προσκλήσεις δεν είναι έγκυρη ή να προσθέσετε κώδικα που εντοπίζει δοκιμής αιτήσεις και απαντά με διαφορετικούς τύπους σφαλμάτων. Για ένα παράδειγμα χρησιμοποιώντας TestApi, ανατρέξτε στο θέμα [Σφάλμα εισαγωγής δοκιμών με TestApi](http://msdn.microsoft.com/magazine/ff898404.aspx) και [Εισαγωγή στις TestApi – μέρος 5: διαχειριζόμενο κώδικα σφαλμάτων εισαγωγής APIs](http://blogs.msdn.com/b/ivo_manolov/archive/2009/11/25/9928447.aspx).
      * Δημιουργήστε μια mock του πόρου ή της υπηρεσίας που επιστρέφει μια περιοχή σφαλμάτων που ενδέχεται να επιστρέψει την πραγματική υπηρεσία. Βεβαιωθείτε ότι καλύπτετε όλους τους τύπους σφάλματος που έχει σχεδιαστεί της στρατηγικής "Επανάληψη" για τον εντοπισμό.
      * Επιβάλετε μεταβατικές σφάλματα προσωρινά απενεργοποιώντας ή υπερφόρτωσης της υπηρεσίας, εάν πρόκειται για μια προσαρμοσμένη υπηρεσία που δημιουργήσατε και αναπτυχθεί (που πρέπει να, φυσικά, επιχειρήσετε να υπερφόρτωσης οποιαδήποτε κοινόχρηστους πόρους ή κοινόχρηστων υπηρεσιών εντός Azure).
      * Για το API που βασίζεται στο HTTP, εξετάστε το ενδεχόμενο χρήσης στη βιβλιοθήκη FiddlerCore του την αυτοματοποιημένη ελέγχους για να αλλάξετε το αποτέλεσμα των αιτήσεων HTTP, είτε με την προσθήκη επιπλέον απόκρισης ώρες ή αλλάζοντας την απάντηση (όπως ο κωδικός κατάστασης HTTP, κεφαλίδες, σώμα ή άλλους παράγοντες). Αυτή η δυνατότητα επιτρέπει ντετερμινιστική δοκιμή ένα υποσύνολο από τις συνθήκες αποτυχία, εάν μεταβατικές σφάλματα ή άλλους τύπους αποτυχία. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [FiddlerCore](http://www.telerik.com/fiddler/fiddlercore). Για παραδείγματα σχετικά με τον τρόπο για να χρησιμοποιήσετε τη βιβλιοθήκη, ιδιαίτερα την κλάση **HttpMangler** , εξετάστε τον [πηγαίο κώδικα για το Azure SDK χώρου αποθήκευσης](https://github.com/Azure/azure-storage-net/tree/master/Test).
      * Εκτέλεση παραγόντων υψηλή φόρτωση και ταυτόχρονες δοκιμές για να βεβαιωθείτε ότι το μηχανισμό "Επανάληψη" και στρατηγική λειτουργεί σωστά υπό αυτές τις συνθήκες, και δεν έχουν αρνητικές συνέπειες για τη λειτουργία του προγράμματος-πελάτη ή να προκαλέσει μόλυνση μεταξύ των αιτήσεων.
* **Διαχείριση ρυθμίσεων πολιτικής "Επανάληψη":**
  * Μια _Επανάληψη πολιτικής_ είναι ένας συνδυασμός όλων των στοιχείων της στρατηγικής "Επανάληψη". Ορίζει το μηχανισμό εντοπισμού που προσδιορίζει αν ένα σφάλμα είναι πιθανό να είναι μεταβατικές, ο τύπος διαστήματος για να χρησιμοποιήσετε (όπως κανονική, εκθετική πίσω-απενεργοποίηση και τυχαία ρύθμιση), τις τιμές πραγματικού διαστήματος και του αριθμού των φορών για να επαναλάβετε.
  * Επαναλήψεις πρέπει να εκτελούνται σε πολλές θέσεις μέσα ακόμα πιο απλός εφαρμογής και, σε κάθε επίπεδο πιο σύνθετες εφαρμογών. Αντί να σκληρό κωδικοποίηση τα στοιχεία του κάθε πολιτικής σε πολλές θέσεις, εξετάστε το ενδεχόμενο χρήσης ένα κεντρικό σημείο για την αποθήκευση όλων των πολιτικών. Για παράδειγμα, αποθηκεύετε τις τιμές όπως το χρονικό διάστημα και επαναλάβετε τη μέτρηση σε αρχεία ρύθμισης παραμέτρων εφαρμογής, διαβάστε τους κατά το χρόνο εκτέλεσης και μέσω προγραμματισμού Δόμηση τις πολιτικές "Επανάληψη". Αυτό διευκολύνει για να διαχειριστείτε τις ρυθμίσεις, και να τροποποιήσετε και να ρυθμίσετε με ακρίβεια τις τιμές προκειμένου να ανταποκρίνεται στις μεταβαλλόμενες απαιτήσεις και σενάρια. Ωστόσο, μπορείτε να σχεδιάσετε το σύστημα για την αποθήκευση των τιμών και όχι rereading μια ρύθμιση παραμέτρων αρχείου κάθε φορά, και βεβαιωθείτε ότι τις προεπιλεγμένες ρυθμίσεις του κατάλληλου χρησιμοποιούνται εάν δεν είναι δυνατό να δοθεί τις τιμές από τις ρυθμίσεις παραμέτρων.
  * Σε μια εφαρμογή Azure Cloud Services, εξετάστε το ενδεχόμενο να την αποθήκευση των τιμών που χρησιμοποιούνται για να δημιουργήσετε τις πολιτικές "Επανάληψη" κατά το χρόνο εκτέλεσης στο αρχείο ρύθμισης παραμέτρων της υπηρεσίας, ώστε να είναι δυνατή χωρίς να χρειάζεται να επανεκκινήσετε την εφαρμογή.
  * Εκμεταλλευτείτε ενσωματωμένα ή του προεπιλεγμένου διαθέσιμες στο πρόγραμμα-πελάτη που χρησιμοποιείτε, αλλά μόνο αν είναι κατάλληλη για το σενάριό σας APIs στρατηγικές "Επανάληψη". Αυτές οι στρατηγικές είναι συνήθως γενικής χρήσης. Σε ορισμένα σενάρια μπορούν να όλες που είναι απαραίτητη, αλλά σε άλλα σενάρια, να μην μπορούν να παρέχουν το πλήρες εύρος των επιλογών να ταιριάζει με τις συγκεκριμένες απαιτήσεις σας. Πρέπει να κατανοήσετε τον τρόπο, οι ρυθμίσεις θα επηρεάσουν την εφαρμογή σας μέσω δοκιμών για να καθορίσετε τις πιο κατάλληλες τιμές.
* **Καταγραφή και παρακολούθηση μεταβατικές και μη μεταβατική σφάλματα:**
  * Ως μέρος της στρατηγικής "Επανάληψη", συμπεριλάβετε χειρισμού εξαιρέσεων και άλλων οργάνων που συνδέεται όταν γίνονται προσπάθειες επανάληψης. Ενώ είναι μια αποτυχία περιστασιακές μεταβατικές και προσπαθήστε ξανά να αναμένεται, και δεν υποδηλώνουν αριθμών σε προβλημάτων, κανονική και αυξανόμενου των επαναλήψεων είναι συχνά μια ένδειξη ένα ζήτημα που μπορεί να προκαλέσει την αποτυχία ή προς το παρόν οι που επηρεάζουν την απόδοση της εφαρμογής και τη διαθεσιμότητα.
  * Συνδεθείτε μεταβατικές σφάλματα ως καταχωρήσεις προειδοποίησης και όχι καταχωρήσεις σφάλματος ώστε να συστημάτων παρακολούθησης δεν εντοπίζει τους ως σφάλματα εφαρμογών που μπορεί να προκαλέσει την false ειδοποιήσεις.
  * Δοκιμάστε να αποθηκεύσετε μια τιμή τις εγγραφές που υποδεικνύει εάν η επαναλήψεις έχουν προκληθούν, περιορισμού στην υπηρεσία ή με άλλους τύπους σφαλμάτων όπως αποτυχίες σύνδεσης, ώστε να μπορείτε να διαφοροποιήσετε τις κατά την ανάλυση των δεδομένων. Αύξηση του αριθμού των σφαλμάτων επιτάχυνσης είναι συχνά μια ένδειξη της σχεδίασης ελάττωμα σε της εφαρμογής ή χρειάζεστε για να μεταβείτε σε μια υπηρεσία premium που προσφέρει αποκλειστικό υλικού.  
  * Εξετάστε το ενδεχόμενο μέτρησης και καταγραφή ο συνολικός χρόνος που λαμβάνονται για τις εργασίες που περιλαμβάνουν το μηχανισμό "Επανάληψη". Αυτή είναι μια καλή ένδειξη του συνολικού εφέ μεταβατικές σφαλμάτων χρόνους απόκρισης χρήστη, διαδικασία λανθάνων χρόνος και η απόδοση των περιπτώσεων χρήσης εφαρμογής. Επίσης καταγραφής τον αριθμό των επαναλήψεων Παρουσιάστηκε προκειμένου να κατανοήσετε τους παράγοντες που πρόσθεσε το χρόνο απόκρισης.
  * Εξετάστε το ενδεχόμενο να εφαρμογής ενός τηλεμετρίας και παρακολούθησης σύστημα που μπορεί να βελτιώσετε τις ειδοποιήσεις όταν ο αριθμός και ρυθμός αποτυχιών, ο μέσος αριθμός των επαναλήψεων ή τις συνολικές ώρες που λαμβάνονται για λειτουργίες για να ολοκληρωθεί με επιτυχία, αυξάνεται.
* **Διαχείριση των λειτουργιών που συνεχώς αποτύχει:**
  * Θα υπάρχουν περιπτώσεις όπου η λειτουργία εξακολουθεί να αποτυγχάνει σε κάθε προσπάθεια, και είναι απαραίτητο να εξετάσετε τον τρόπο που θα χειριστεί αυτήν την περίπτωση:
      * Παρόλο που μια στρατηγική "Επανάληψη" θα ορίσετε τον μέγιστο αριθμό φορών που πρέπει να επαναληφθεί μια πράξη, δεν εμποδίζει την εφαρμογή επαναλαμβανόμενη ξανά, τη λειτουργία με τον ίδιο αριθμό των επαναλήψεων. Για παράδειγμα, εάν αποτύχει μια σειρά υπηρεσία επεξεργασίας με ένα λάθος που μεταφέρει οριστικά από ενέργεια, τη στρατηγική "Επανάληψη" μπορεί να εντοπίσει ένα χρονικό όριο σύνδεσης και εξετάστε το ενδεχόμενο να είναι ένα σφάλμα μεταβατικές. Ο κώδικας θα επανάληψη της λειτουργίας έναν καθορισμένο αριθμό φορών και, στη συνέχεια, δώστε προς τα επάνω. Ωστόσο, όταν μια άλλη πελατών τοποθετεί μια σειρά, η λειτουργία θα εφαρμοστούν ξανά - ακόμα και αν είναι ότι αποτυχία κάθε φορά.
      * Για να αποτρέψετε συνεχούς επαναλήψεις για τις εργασίες που συνεχώς αποτύχει, εξετάστε την εφαρμογή το [διακόπτη κυκλώματος μοτίβο](http://msdn.microsoft.com/library/dn589784.aspx). Σε αυτό το μοτίβο, εάν ο αριθμός αποτυχιών μέσα σε ένα παράθυρο του καθορισμένου χρονικού υπερβαίνει το όριο, αιτήσεις επιστρέφονται με τον καλούντα αμέσως ως σφάλματα, χωρίς να προσπαθεί να αποκτήσει πρόσβαση του πόρου αποτυχίας ή της υπηρεσίας.
      * Η εφαρμογή περιοδικά να δοκιμάσετε την υπηρεσία, σε περιοδική βάση και με πολύ μεγάλο χρονικά διαστήματα μεταξύ των αιτήσεων για τον εντοπισμό όταν θα είναι διαθέσιμο. Ένα κατάλληλο χρονικό διάστημα θα εξαρτώνται από το σενάριο, όπως την κρισιμότητα της λειτουργίας και τη φύση της υπηρεσίας, και μπορεί να είναι οτιδήποτε μεταξύ λίγα λεπτά και μερικές ώρες. Στο σημείο όπου η δοκιμή ολοκληρωθεί με επιτυχία, η εφαρμογή μπορεί να συνεχίσετε τις κανονικές λειτουργίες και μεταβιβάζουν αιτήσεις για την υπηρεσία που μόλις έχει ανακτηθεί.
      * Στο μεταξύ, ενδέχεται να είναι δυνατή η επιστροφή σε μια άλλη παρουσία της υπηρεσίας (ίσως σε μια διαφορετική κέντρο δεδομένων ή εφαρμογή), να χρησιμοποιήσετε μια παρόμοια υπηρεσία που προσφέρει συμβατά λειτουργικότητα (ίσως απλούστερο) ή να εκτελέσετε ορισμένες λειτουργίες εναλλακτικές με την Ελπίδα ότι η υπηρεσία θα γίνουν διαθέσιμες σύντομα. Για παράδειγμα, αυτό μπορεί να είναι κατάλληλη για την αποθήκευση αιτήσεων για την υπηρεσία σε ουρά ή αποθήκευση δεδομένων και την αναπαραγωγή τους αργότερα. Διαφορετικά μπορείτε ίσως να ανακατευθύνετε το χρήστη με μια εναλλακτική εμφάνιση της εφαρμογής, μειωθεί η απόδοση της εφαρμογής, αλλά εξακολουθείτε να προσφέρουν αποδεκτή λειτουργικότητα ή απλώς επιστροφής ένα μήνυμα για το χρήστη που υποδεικνύει που η εφαρμογή δεν είναι διαθέσιμη από την παρουσίαση.

* **Άλλα θέματα**
  * Όταν αποφασίζετε για τις τιμές για τον αριθμό των επαναλήψεων και τα διαστήματα "Επανάληψη" για μια πολιτική, εξετάστε το ενδεχόμενο εάν η λειτουργία στην υπηρεσία ή πόρων είναι σε λειτουργία μεγάλη διάρκεια εκτέλεσης ή πολλών βήμα. Μπορεί να είναι δύσκολο ή ακριβό να αποζημιώσει όλα τα άλλα λειτουργικές βήματα που έχετε ήδη ολοκληρώθηκε με επιτυχία όταν ένα αποτυγχάνει. Σε αυτήν την περίπτωση, σε πολύ μεγάλο χρονικό διάστημα και μεγάλο αριθμό των επαναλήψεων μπορεί να είναι αποδεκτό εφόσον δεν εμποδίζει τις άλλες λειτουργίες με κρατώντας πατημένο ή κλείδωμα σπάνιες πόρους.
  * Εξετάστε το ενδεχόμενο αν επιχειρήσετε ξανά την ίδια λειτουργία μπορεί να προκαλέσει ασυνέπειες στα δεδομένα. Εάν ορισμένα τμήματα μιας διαδικασίας πολλών βημάτων επαναλαμβάνονται και οι λειτουργίες δεν είναι idempotent, αυτό μπορεί να έχει ως αποτέλεσμα ασυνέπεια. Για παράδειγμα, μια λειτουργία που αυξάνει την τιμή, εάν επαναληφθεί, θα δημιουργήσουν ένα μη έγκυρο αποτέλεσμα. Επανάληψη μια λειτουργία που στέλνει ένα μήνυμα σε μια ουρά μπορεί να προκαλέσει ασυνέπεια στο μήνυμα πελάτη εάν αυτό δεν μπορεί να εντοπίσει διπλά μηνύματα. Για να αποτρέψετε αυτό το πρόβλημα, βεβαιωθείτε ότι μπορείτε να σχεδιάσετε κάθε βήμα ως μια λειτουργία idempotent. Για περισσότερες πληροφορίες σχετικά με το idempotency, ανατρέξτε στο θέμα [Idempotency μοτίβα](http://blog.jonathanoliver.com/2010/04/idempotency-patterns/).
  * Μπορείτε να το εύρος των λειτουργιών που θα επαναληφθεί. Για παράδειγμα, ίσως είναι ευκολότερο να υλοποιήσετε κώδικα "Επανάληψη" σε επίπεδο που περιλαμβάνει πολλές λειτουργίες οι οποίες και προσπαθήστε ξανά τις όλες εάν αποτύχει η μία. Ωστόσο, αυτή η ενέργεια ενδέχεται να οδηγήσει σε προβλήματα idempotency ή λειτουργίες επαναφοράς δεν είναι απαραίτητες.
  * Εάν επιλέξετε ένα εύρος "Επανάληψη" που περιλαμβάνει πολλές εργασίες, λάβετε υπόψη το Συνολικός λανθάνων χρόνος όλα αυτά κατά τον καθορισμό τα χρονικά διαστήματα "Επανάληψη", όταν παρακολουθώντας το χρόνο που έχετε δημιουργήσει και πριν από ανύψωση ειδοποιήσεων για αποτυχίες.
  * Εξετάστε το ενδεχόμενο πώς της στρατηγικής "Επανάληψη" μπορεί να επηρεάσει γειτόνων και άλλες μισθωτές σε μια κοινόχρηστη εφαρμογή ή κατά τη χρήση κοινόχρηστους πόρους και τις υπηρεσίες. Πολιτικές αυστηρές "Επανάληψη" μπορεί να προκαλέσει ένας αυξανόμενος αριθμός μεταβατικές σφαλμάτων για να προκύψει για αυτούς τους χρήστες και για τις εφαρμογές που κάνουν κοινή χρήση τους πόρους και τις υπηρεσίες. Παρομοίως, η εφαρμογή σας μπορεί να επηρεάζεται από τις πολιτικές "Επανάληψη" υλοποιηθεί από άλλους χρήστες των πόρων και των υπηρεσιών. Για τις εφαρμογές κρίσιμης σημασίας, ενδέχεται να αποφασίσετε να χρησιμοποιήσετε premium υπηρεσίες που δεν είναι κοινόχρηστα. Αυτό σας παρέχει πολύ μεγαλύτερο έλεγχο η φόρτωση και την επακόλουθη περιορισμού αυτών των πόρων και των υπηρεσιών, οι οποίες μπορούν να σας βοηθήσουν να πλήρης στοίχιση το πρόσθετο κόστος.

## <a name="more-information"></a>Περισσότερες πληροφορίες

* [Γενικές οδηγίες "Επανάληψη" Azure συγκεκριμένης υπηρεσίας](best-practices-retry-service-specific.md)
* [Το μπλοκ χειρισμού σφαλμάτων μεταβατικές εφαρμογής](http://msdn.microsoft.com/library/hh680934.aspx)
* [Διακόπτης κυκλώματος μοτίβου](http://msdn.microsoft.com/library/dn589784.aspx)
* [Παράγωγων μοτίβο συναλλαγής](http://msdn.microsoft.com/library/dn589804.aspx)
* [Μοτίβα Idempotency](http://blog.jonathanoliver.com/2010/04/idempotency-patterns/)
