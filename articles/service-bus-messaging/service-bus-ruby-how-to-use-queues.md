<properties
    pageTitle="Πώς μπορείτε να χρησιμοποιήσετε ουρές Bus υπηρεσίας με κείμενο φωνητικής γραφής | Microsoft Azure"
    description="Μάθετε πώς μπορείτε να χρησιμοποιήσετε ουρές Bus υπηρεσίας στο Azure. Δείγματα κώδικα γραμμένο σε κείμενο φωνητικής γραφής."
    services="service-bus"
    documentationCenter="ruby"
    authors="sethmanheim"
    manager="timlt"
    editor=""/>

<tags
    ms.service="service-bus"
    ms.workload="na"
    ms.tgt_pltfrm="na"
    ms.devlang="ruby"
    ms.topic="article"
    ms.date="10/04/2016"
    ms.author="sethm"/>

# <a name="how-to-use-service-bus-queues"></a>Πώς μπορείτε να χρησιμοποιήσετε ουρές Bus υπηρεσίας

[AZURE.INCLUDE [service-bus-selector-queues](../../includes/service-bus-selector-queues.md)]

Αυτός ο οδηγός περιγράφει τον τρόπο χρήσης της υπηρεσίας Bus ουρές. Τα δείγματα που είναι γραμμένες σε κείμενο φωνητικής γραφής και χρησιμοποιήστε το Azure Περσικό. Τα σενάρια καλύπτεται περιλαμβάνουν **τη δημιουργία ουρές, αποστολή και λήψη μηνυμάτων**και **τη διαγραφή ουρές**. Για περισσότερες πληροφορίες σχετικά με την υπηρεσία Bus ουρές, ανατρέξτε στην ενότητα [Επόμενα βήματα](#next-steps) .

## <a name="what-are-service-bus-queues"></a>Τι είναι η υπηρεσία Bus ουρές;

Υπηρεσία Bus ουρές υποστηρίζουν μοντέλου επικοινωνίας *όπου μεσολαβούν μηνυμάτων* . Με ουρές, στοιχεία μια κατανεμημένη εφαρμογή δεν επικοινωνούν απευθείας μεταξύ τους; αντί για αυτό ανταλλαγή μηνυμάτων μέσω μια ουρά, η οποία λειτουργεί ως ενδιάμεσο. Πρόγραμμα παραγωγής των μηνυμάτων (αποστολέα) παραδίδει ένα μήνυμα στην ουρά και, στη συνέχεια, συνεχίζει την επεξεργασία.
Ασύγχρονη, καταναλωτή μήνυμα (ακουστικό) Μετακινεί το μήνυμα από την ουρά και το επεξεργάζεται. Το πρόγραμμα παραγωγής των δεν πρέπει να περιμένουν για μια απάντηση από τον καταναλωτή για να συνεχίσετε να επεξεργάζονται και περαιτέρω αποστολή μηνυμάτων. Ουρές προσφέρουν **πρώτη στο, πρώτη ανάληψη FIFO** παράδοση του μηνύματος σε μία ή περισσότερες ανταγωνιστικών καταναλωτές. Αυτό σημαίνει ότι τα μηνύματα συνήθως λάβει και υποβάλλονται σε επεξεργασία από το δέκτες με τη σειρά που προστέθηκαν στην ουρά και κάθε μήνυμα είναι λάβει και να υποβάλλονται σε επεξεργασία από ένα μόνο μήνυμα καταναλωτή.

![QueueConcepts](./media/service-bus-ruby-how-to-use-queues/sb-queues-08.png)

Υπηρεσία Bus ουρές είναι μια γενικής χρήσης τεχνολογία που μπορούν να χρησιμοποιηθούν για μια μεγάλη ποικιλία σενάρια:

-   Επικοινωνία μεταξύ ρόλους web και εργαζόμενου σε μια [εφαρμογή του Azure πολλαπλών επιπέδων](service-bus-dotnet-multi-tier-app-using-service-bus-queues.md).
-   Επικοινωνία μεταξύ εφαρμογών εσωτερικής εγκατάστασης και του Azure φιλοξενούνται εφαρμογές σε μια [υβριδική λύση](service-bus-dotnet-hybrid-app-using-service-bus-relay.md).
-   Επικοινωνία μεταξύ των στοιχείων μιας εφαρμογής κατανέμεται εκτέλεση εσωτερικής εγκατάστασης σε διαφορετικές εταιρείες ή τμήματα ενός οργανισμού.

Χρήση ουρές μπορούν να σάς επιτρέπουν να κλιμακωθεί ανάληψη καλύτερα τις εφαρμογές σας, και ενεργοποιήστε περισσότερες υποστηρίζεται για την αρχιτεκτονική σας.

## <a name="create-a-namespace"></a>Δημιουργία ενός χώρου ονομάτων

Για να ξεκινήσετε να χρησιμοποιείτε ουρές Bus υπηρεσίας στο Azure, πρέπει πρώτα να δημιουργήσετε ένα χώρο ονομάτων. Ένα χώρο ονομάτων παρέχει ένα κοντέινερ πεδίου για την προσθήκη διεύθυνσης σε πόρους Bus υπηρεσίας στην εφαρμογή σας. Πρέπει να δημιουργήσετε το χώρο ονομάτων έως το περιβάλλον γραμμής εντολών επειδή το Azure πύλη δεν δημιουργεί το χώρο ονομάτων με σύνδεση ACS.

Για να δημιουργήσετε ένα χώρο ονομάτων:

1. Ανοίξτε μια κονσόλα Azure Powershell.

2. Πληκτρολογήστε την παρακάτω εντολή για να δημιουργήσετε ένα χώρο ονομάτων Bus υπηρεσίας. Δώστε τη δική σας τιμή χώρο ονομάτων και καθορίστε στην ίδια περιοχή με την εφαρμογή σας.

    ```
    New-AzureSBNamespace -Name 'yourexamplenamespace' -Location 'West US' -NamespaceType 'Messaging' -CreateACSNamespace $true

    ![Create Namespace](./media/service-bus-ruby-how-to-use-queues/showcmdcreate.png)
    ```

## <a name="obtain-management-credentials-for-the-namespace"></a>Λήψη των διαπιστευτηρίων διαχείρισης για το χώρο ονομάτων

Για να εκτελέσετε εργασίες διαχείρισης, όπως τη δημιουργία μιας ουράς σε νέο χώρο ονομάτων, πρέπει να λάβετε τα διαπιστευτήρια διαχείρισης για το χώρο ονομάτων.

Το cmdlet του PowerShell που εκτελέσατε για να δημιουργήσετε το χώρο ονομάτων bus Azure service εμφανίζει τον αριθμό-κλειδί μπορείτε να χρησιμοποιήσετε για να διαχειριστείτε το χώρο ονομάτων. Αντιγράψτε την τιμή **DefaultKey** . Παρακάτω σε αυτό το πρόγραμμα εκμάθησης, θα χρησιμοποιήσετε αυτήν την τιμή στον κώδικά σας.

![Αντιγραφή αριθμού-κλειδιού](./media/service-bus-ruby-how-to-use-queues/defaultkey.png)

> [AZURE.NOTE] Μπορείτε επίσης να βρείτε αυτό το κλειδί εάν συνδεθείτε [πύλη του Azure](https://portal.azure.com/) και μεταβείτε στις πληροφορίες σύνδεσης για το χώρο ονομάτων Bus υπηρεσίας.

## <a name="create-a-ruby-application"></a>Δημιουργία μιας εφαρμογής φωνητικής γραφής

Δημιουργία μιας εφαρμογής φωνητικής γραφής. Για οδηγίες, ανατρέξτε στο θέμα [Δημιουργία μιας εφαρμογής φωνητικής γραφής στο Azure](/develop/ruby/tutorials/web-app-with-linux-vm/).

## <a name="configure-your-application-to-use-service-bus"></a>Ρύθμιση των παραμέτρων σας εφαρμογής για να χρησιμοποιήσετε Bus υπηρεσίας

Για να χρησιμοποιήσετε Bus υπηρεσίας Azure, κάντε λήψη και χρησιμοποιήστε το πακέτο Azure φωνητικής γραφής, η οποία περιλαμβάνει ένα σύνολο βιβλιοθηκών ευκολία που επικοινωνία με τις υπηρεσίες ΥΠΌΛΟΙΠΟ του χώρου αποθήκευσης.

### <a name="use-rubygems-to-obtain-the-package"></a>Χρήση RubyGems λήψης του πακέτου

1. Χρησιμοποιήστε ένα περιβάλλον γραμμής εντολών όπως **PowerShell** (Windows), το **Terminal** (Mac) ή το **πάρτι** (Unix).

2. Πληκτρολογήστε "Περσικό azure εγκατάσταση" στο παράθυρο εντολών για να εγκαταστήσετε το περσικό και τις εξαρτήσεις.

### <a name="import-the-package"></a>Εισαγωγή του πακέτου

Χρησιμοποιώντας το πρόγραμμα επεξεργασίας κειμένου Αγαπημένα, προσθέστε τα ακόλουθα στο επάνω μέρος του αρχείου φωνητικής γραφής όπου σκοπεύετε να χρησιμοποιήσετε αποθήκευσης:

```
require "azure"
```

## <a name="set-up-an-azure-service-bus-connection"></a>Ρύθμιση σύνδεσης Bus υπηρεσίας Azure

Η λειτουργική μονάδα Azure διαβάζει τις μεταβλητές περιβάλλοντος **AZURE\_SERVICEBUS\_χώρο ΟΝΟΜΆΤΩΝ** και **AZURE\_SERVICEBUS\_ACCESS_KEY** για τις πληροφορίες που απαιτούνται για να συνδεθείτε με το χώρο ονομάτων Bus υπηρεσίας. Αν δεν έχουν οριστεί αυτές τις μεταβλητές περιβάλλοντος, πρέπει να καθορίσετε τις πληροφορίες χώρο ονομάτων πριν από τη χρήση **Azure::ServiceBusService** με τον ακόλουθο κώδικα:

```
Azure.config.sb_namespace = "<your azure service bus namespace>"
Azure.config.sb_access_key = "<your azure service bus access key>"
```

Ορίστε την τιμή χώρου ονομάτων στην τιμή που δημιουργήσατε, και όχι ολόκληρη τη διεύθυνση URL. Για παράδειγμα, χρησιμοποιήστε **"yourexamplenamespace"**, δεν "yourexamplenamespace.servicebus.windows.net".

## <a name="how-to-create-a-queue"></a>Πώς μπορείτε να δημιουργήσετε μια ουρά

Το αντικείμενο **Azure::ServiceBusService** σάς επιτρέπει να εργαστείτε με ουρές. Για να δημιουργήσετε μια ουρά, χρησιμοποιήστε τη μέθοδο **create_queue()** . Το παρακάτω παράδειγμα δημιουργεί μια ουρά ή εκτυπώνεται σφάλματα.

```
azure_service_bus_service = Azure::ServiceBusService.new
begin
  queue = azure_service_bus_service.create_queue("test-queue")
rescue
  puts $!
end
```

Μπορείτε επίσης να μεταβιβάσετε ένα αντικείμενο **Azure::ServiceBus::Queue** με πρόσθετες επιλογές, που σας επιτρέπει να παρακάμψετε τις προεπιλεγμένες ρυθμίσεις ουρά, όπως το μήνυμα διάρκεια ζωής ή ουρά μέγιστο μέγεθος. Το παρακάτω παράδειγμα δείχνει πώς μπορείτε να ορίσετε το μέγεθος του μέγιστου ουρά 5GB και την ώρα στο live σε 1 λεπτό:

```
queue = Azure::ServiceBus::Queue.new("test-queue")
queue.max_size_in_megabytes = 5120
queue.default_message_time_to_live = "PT1M"

queue = azure_service_bus_service.create_queue(queue)
```

## <a name="how-to-send-messages-to-a-queue"></a>Πώς μπορείτε να στείλετε μηνύματα σε ουρά

Για να στείλετε ένα μήνυμα σε μια υπηρεσία Bus ουρά, εφαρμογή κλήσεις το **Αποστολή\_ουρά\_message()** μέθοδος στο αντικείμενο **Azure::ServiceBusService** . Μηνύματα ουρές Bus υπηρεσία αποστολής για να (και λήψης από) είναι **Azure::ServiceBus::BrokeredMessage** αντικείμενα και έχουν ένα σύνολο τυπικές ιδιότητες (όπως είναι η **ετικέτα** και **χρόνου\_να\_live**), ένα λεξικό που χρησιμοποιείται για τη διατήρηση προσαρμοσμένη εφαρμογή συγκεκριμένες ιδιότητες, και ένα κύριο σώμα των δεδομένων αυθαίρετο εφαρμογής. Μια εφαρμογή να ορίσετε το σώμα του μηνύματος, μεταφέροντας μια τιμή συμβολοσειρά με το μήνυμα και οποιεσδήποτε τυπικές απαιτούμενες ιδιότητες θα συμπληρωθεί με προεπιλεγμένες τιμές.

Το παρακάτω παράδειγμα παρουσιάζει πώς μπορείτε να στείλετε ένα δοκιμαστικό μήνυμα στην ουρά με το όνομα "ουρά δοκιμών" Χρήση **Αποστολή\_ουρά\_message()**:

```
message = Azure::ServiceBus::BrokeredMessage.new("test queue message")
message.correlation_id = "test-correlation-id"
azure_service_bus_service.send_queue_message("test-queue", message)
```

Υπηρεσία Bus ουρές υποστηρίζουν μέγιστο μέγεθος αρχείου των 256 KB η [τυπική σειρά](service-bus-premium-messaging.md) και 1 MB στο [επίπεδο Premium](service-bus-premium-messaging.md). Την επικεφαλίδα, η οποία περιλαμβάνει τις ιδιότητες τυπικών και προσαρμοσμένων εφαρμογών, μπορεί να έχει ένα μέγιστο μέγεθος των 64 KB. Υπάρχει όριο στον αριθμό των μηνυμάτων που θα διατηρούνται σε ουρά, αλλά υπάρχει μια καπέλο το συνολικό μέγεθος των μηνυμάτων που διαθέτει μια ουρά. Αυτό το μέγεθος ουρά ορίζεται κατά τη δημιουργία, με ένα ανώτερο όριο των 5 GB.

## <a name="how-to-receive-messages-from-a-queue"></a>Πώς μπορείτε να λαμβάνετε μηνύματα από μια ουρά

Γίνεται λήψη των μηνυμάτων από μια ουρά με τη χρήση του **Λήψη\_ουρά\_message()** μέθοδος στο αντικείμενο **Azure::ServiceBusService** . Από προεπιλογή, τα μηνύματα Διαβάστε και κλειδωμένο χωρίς που έχουν διαγραφεί από την ουρά. Ωστόσο, μπορείτε να διαγράψετε τα μηνύματα από την ουρά όπως διαβάζονται, ορίζοντας την **: peek_lock** επιλογή σε **false**.

Η προεπιλεγμένη συμπεριφορά κάνει την ανάγνωση και τη διαγραφή μια λειτουργία δύο σταδίων, η οποία παρέχει επίσης τη δυνατότητα για την υποστήριξη εφαρμογών που δεν θέλετε να γίνει που λείπουν μηνύματα. Όταν Bus υπηρεσία λαμβάνει μια αίτηση, βρίσκει στο επόμενο μήνυμα να καταναλωθεί, κλειδώνει για να αποτρέψετε άλλους καταναλωτές πραγματοποιεί λήψη του και, στη συνέχεια, επιστρέφει το στην εφαρμογή. Μετά την εφαρμογή ολοκληρώσει την επεξεργασία του μηνύματος (ή αποθηκεύει αξιόπιστα για μελλοντική επεξεργασία), ολοκληρώνει δεύτερου σταδίου της διαδικασίας παραλαβής καλώντας **Διαγραφή\_ουρά\_message()** μέθοδο και παροχή το μήνυμα που θα διαγραφεί ως παράμετρο. Το **Διαγραφή\_ουρά\_message()** μέθοδο θα επισημάνετε το μήνυμα ως που καταναλώνεται και να το καταργήσετε από την ουρά.

Εάν το **: Σύνοψη\_κλείδωμα** παράμετρος έχει οριστεί σε **false**, ανάγνωσης και τη διαγραφή του μηνύματος γίνεται πιο απλός μοντέλο και λειτουργεί καλύτερα με την οποία μια εφαρμογή μπορεί να αποδεχτεί τις δεν επεξεργασία ενός μηνύματος σε περίπτωση αποτυχίας σενάρια. Για να κατανοήσετε αυτήν, εξετάστε το ενδεχόμενο να ένα σενάριο που ζητήματα της αίτησης λήψης του καταναλωτή και, στη συνέχεια, παρουσιάζει σφάλμα πριν από την επεξεργασία του. Επειδή Bus υπηρεσία θα έχουν σήμανση του μηνύματος ως που καταναλώνεται, όταν η εφαρμογή επανεκκίνηση του και αρχίζει κατανάλωση ξανά τα μηνύματα, αυτό θα έχω παραβλέψει το μήνυμα που καταναλώθηκε πριν από το σφάλμα.

Το παρακάτω παράδειγμα παρουσιάζει πώς μπορείτε να λαμβάνει και να επεξεργάζεται μηνύματα χρησιμοποιώντας το **Λήψη\_ουρά\_message()**. Το παράδειγμα πρώτα λαμβάνει και διαγράφει ένα μήνυμα με τη χρήση **: Σύνοψη\_κλείδωμα** οριστεί σε **false**, θα λαμβάνει ένα άλλο μήνυμα και, στη συνέχεια, διαγράφει το μήνυμα με χρήση **Διαγραφή\_ουρά\_message()**:

```
message = azure_service_bus_service.receive_queue_message("test-queue",
  { :peek_lock => false })
message = azure_service_bus_service.receive_queue_message("test-queue")
azure_service_bus_service.delete_queue_message(message)
```

## <a name="how-to-handle-application-crashes-and-unreadable-messages"></a>Πώς να χειριστείτε σφάλματα εφαρμογών και αναγνώσιμα μηνύματα

Υπηρεσία Bus παρέχει λειτουργικότητα που θα σας βοηθήσουν να ανακτήσετε ομαλά από σφάλματα στο εφαρμογής ή δυσκολίες επεξεργασία ενός μηνύματος. Εάν μια εφαρμογή ακουστικό είναι δυνατή η επεξεργασία του μηνύματος για κάποιο λόγο και, στη συνέχεια, να καλέσετε αυτό το **ξεκλειδώσετε\_ουρά\_message()** μέθοδος στο αντικείμενο **Azure::ServiceBusService** . Αυτό προκαλεί Bus υπηρεσίας για να ξεκλειδώσετε το μήνυμα μέσα στην ουρά και να την κάνετε διαθέσιμη θα ληφθεί ξανά, με την ίδια εφαρμογή καταναλώνει ή από άλλη εφαρμογή καταναλώνει.

Υπάρχει επίσης ένα χρονικό όριο που σχετίζεται με ένα μήνυμα κλειδωμένο μέσα στην ουρά και, εάν η εφαρμογή δεν μπορεί να επεξεργαστεί το μήνυμα πριν από την κλείδωμα λήξει το χρονικό όριο (για παράδειγμα, εάν η εφαρμογή παρουσιάζει σφάλμα), στη συνέχεια, υπηρεσία Bus καταργεί αυτόματα το μήνυμα και κάνει διαθέσιμο θα ληφθεί ξανά.

Σε περίπτωση που η εφαρμογή παρουσιάζει σφάλμα μετά την επεξεργασία του μηνύματος αλλά πριν την **Διαγραφή\_ουρά\_message()** μέθοδος καλείται και, στη συνέχεια, το μήνυμα θα είναι redelivered στην εφαρμογή κατά την επανεκκίνηση. Συχνά αυτό ονομάζεται **Τουλάχιστον μία φορά επεξεργασία**; Αυτό σημαίνει ότι κάθε μήνυμα υποβάλλεται σε επεξεργασία τουλάχιστον μία φορά, αλλά σε ορισμένες περιπτώσεις ίσως redelivered το ίδιο μήνυμα. Εάν το σενάριο δεν θέλετε να γίνει διπλότυπων επεξεργασίας, στη συνέχεια, προγραμματιστές εφαρμογών πρέπει να Προσθήκη επιπλέον λογικής σε εφαρμογή τους χειρισμού διπλότυπων μήνυμα παράδοσης. Αυτό είναι δυνατό συχνά χρησιμοποιώντας το **μήνυμα\_αναγνωριστικό** ιδιοτήτων του μηνύματος, η οποία παραμένει σταθερή κατά μήκος προσπαθειών παράδοσης.

## <a name="next-steps"></a>Επόμενα βήματα

Τώρα που μάθατε τα βασικά στοιχεία του ουρές Bus υπηρεσίας, ακολουθήστε αυτές τις συνδέσεις για να μάθετε περισσότερα.

-   Επισκόπηση των [ουρές, θέματα, και συνδρομών](service-bus-queues-topics-subscriptions.md).
-   Επισκεφθείτε το αποθετήριο [SDK Azure για το κείμενο φωνητικής γραφής](https://github.com/Azure/azure-sdk-for-ruby) στο GitHub.

Για μια σύγκριση μεταξύ Azure Service Bus ουρές αναφέρονται σε αυτό το άρθρο και ουρές Azure που περιγράφεται στο άρθρο [Πώς να χρησιμοποιείτε το χώρο αποθήκευσης ουρά από κείμενο φωνητικής γραφής](../storage/storage-ruby-how-to-use-queue-storage.md) , ανατρέξτε στο θέμα [Azure ουρές και ουρές Bus Azure Service - σύγκριση και Contrasted](service-bus-azure-and-service-bus-queues-compared-contrasted.md)
 
