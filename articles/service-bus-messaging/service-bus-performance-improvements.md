<properties 
    pageTitle="Βέλτιστες πρακτικές για τη βελτίωση της απόδοσης χρησιμοποιώντας Bus υπηρεσίας | Microsoft Azure"
    description="Περιγράφει τον τρόπο χρήσης Azure Service Bus για βελτιστοποίηση των επιδόσεων κατά την ανταλλαγή μηνυμάτων όπου μεσολαβούν."
    services="service-bus"
    documentationCenter="na"
    authors="sethmanheim"
    manager="timlt"
    editor="" /> 
<tags 
    ms.service="service-bus"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="na"
    ms.date="10/25/2016"
    ms.author="sethm" />

# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a>Βέλτιστες πρακτικές για βελτιώσεις απόδοσης χρησιμοποιώντας την ανταλλαγή μηνυμάτων Bus υπηρεσίας

Αυτό το θέμα περιγράφει τον τρόπο χρήσης του Azure Service Bus μηνυμάτων για βελτιστοποίηση των επιδόσεων κατά την ανταλλαγή μηνυμάτων όπου μεσολαβούν. Το πρώτο τμήμα του αυτό το θέμα περιγράφει τους διαφορετικούς μηχανισμούς που παρέχονται για να σας βοηθήσει να βελτιώσετε τις επιδόσεις. Το δεύτερο τμήμα παρέχει οδηγίες σχετικά με τη χρήση υπηρεσιών Bus με τον τρόπο που μπορούν να προσφέρουν τις καλύτερες επιδόσεις σε ένα σενάριο που δίνεται.

Σε αυτό το θέμα, ο όρος "Πελάτης" αναφέρεται σε οποιαδήποτε οντότητα που αποκτά πρόσβαση Bus υπηρεσίας. Ένας υπολογιστής-πελάτης μπορεί να λάβει το ρόλο του αποστολέα ή έναν παραλήπτη. Ο όρος "αποστολέα" χρησιμοποιείται για μια υπηρεσία Bus ουρά ή το θέμα προγράμματος-πελάτη που στέλνει μηνύματα σε ουρά Bus υπηρεσία ή το θέμα. Ο όρος "ακουστικό" αναφέρεται σε μια υπηρεσία Bus ουρά ή συνδρομή του προγράμματος-πελάτη που λαμβάνει μηνύματα από μια υπηρεσία Bus ουρά ή τη συνδρομή.

Αυτές οι ενότητες Παρουσιάστε πολλές έννοιες που χρησιμοποιεί Bus υπηρεσίας για να βοηθήσει ενίσχυση της απόδοσης.

## <a name="protocols"></a>Τα πρωτόκολλα

Υπηρεσία Bus επιτρέπει προγράμματα-πελάτες για αποστολή και λήψη μηνυμάτων μέσω τρία πρωτόκολλα

1. Για προχωρημένους μηνυμάτων Protocol (AMQP)

2. Υπηρεσία Bus μηνυμάτων Protocol (SBMP)

3. HTTP

AMQP και SBMP είναι πιο αποτελεσματική, επειδή διατηρούν τη σύνδεση με την υπηρεσία Bus με την προϋπόθεση ότι υπάρχει το ανταλλαγής μηνυμάτων factory. Εφαρμόζει επίσης δέσμης και prefetching. Εκτός εάν που αναφέρονται ρητά, όλο το περιεχόμενο σε αυτό το θέμα προϋποθέτει τη χρήση AMQP ή SBMP.

## <a name="reusing-factories-and-clients"></a>Επαναχρησιμοποίηση εργοστάσια και προγράμματα-πελάτες

Αντικείμενα προγράμματος-πελάτη Bus υπηρεσία, όπως [QueueClient][] ή [MessageSender][], δημιουργούνται μέσω ενός αντικειμένου [MessagingFactory][] , το οποίο παρέχει επίσης εσωτερικής διαχείρισης των συνδέσεων. Όχι, θα πρέπει να κλείσετε εργοστάσια ανταλλαγής μηνυμάτων ή ουρά, το θέμα και προγράμματα-πελάτες συνδρομή μετά την αποστολή ενός μηνύματος και, στη συνέχεια, να δημιουργήσετε ξανά τους κατά την αποστολή του επόμενου μηνύματος. Κλείσιμο ενός εργοστασίου ανταλλαγής μηνυμάτων διαγράφει τη σύνδεση με την υπηρεσία Bus υπηρεσίας και δημιουργείται μια νέα σύνδεση όταν να δημιουργείτε το factory. Τη δημιουργία μιας σύνδεσης είναι μια ακριβή λειτουργία που μπορείτε να αποφύγετε χρησιμοποιώντας εκ νέου το ίδιο εργοστασίου και τα αντικείμενα προγράμματος-πελάτη για πολλές λειτουργίες. Ασφαλής, μπορείτε να χρησιμοποιήσετε το αντικείμενο [QueueClient][] για την αποστολή μηνυμάτων από ταυτόχρονες ασύγχρονων λειτουργιών και πολλά νήματα. 

## <a name="concurrent-operations"></a>Ταυτόχρονες λειτουργίες

Εκτέλεση μιας λειτουργίας (αποστολή, λήψη, να διαγράψετε, κ.λπ.) μεταφέρει κάποιο χρονικό διάστημα. Αυτήν τη στιγμή περιλαμβάνει την επεξεργασία της λειτουργίας από την υπηρεσία Bus υπηρεσία εκτός από το λανθάνων χρόνος της αίτησης και η απάντηση. Για να αυξήσετε τον αριθμό των λειτουργιών ανά ώρα, λειτουργίες πρέπει να εκτελεί ταυτόχρονα. Μπορείτε να το κάνετε με διάφορους τρόπους:

-   **Ασύγχρονων λειτουργιών**: το πρόγραμμα-πελάτη προγραμματίζει τις εργασίες, εκτελώντας ασύγχρονων λειτουργιών. Επόμενη αίτηση ξεκινήσει πριν από την προηγούμενη αίτηση έχει ολοκληρωθεί. Ακολουθεί ένα παράδειγμα μιας λειτουργίας ασύγχρονης αποστολή:

    ```
    BrokeredMessage m1 = new BrokeredMessage(body);
    BrokeredMessage m2 = new BrokeredMessage(body);
    
    Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
      {
        Console.WriteLine("Sent message #1");
      });
    Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
      {
        Console.WriteLine("Sent message #2");
      });
    Task.WaitAll(send1, send2);
    Console.WriteLine("All messages sent");
    ```

    Αυτό είναι ένα παράδειγμα της μια ασύγχρονη λήψη λειτουργία:
    
    ```
    Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
    Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
    
    Task.WaitAll(receive1, receive2);
    Console.WriteLine("All messages received");
    
    async void ProcessReceivedMessage(Task<BrokeredMessage> t)
    {
      BrokeredMessage m = t.Result;
      Console.WriteLine("{0} received", m.Label);
      await m.CompleteAsync();
      Console.WriteLine("{0} complete", m.Label);
    }
    ```

-   **Πολλές εργοστάσια**: όλες οι υπολογιστές-πελάτες (αποστολείς εκτός από δέκτες) που δημιουργούνται από την ίδια προέλευση, κοινή χρήση μίας σύνδεσης TCP. Η μετάδοση μέγιστο μηνυμάτων περιορίζεται από τον αριθμό των λειτουργιών που μπορούν να ακολουθήσετε αυτήν τη σύνδεση TCP. Τη μετάδοση την οποία μπορείτε να αποκτήσετε με ένα μεμονωμένο εργοστασίου διαφέρει σημαντικά με ανταλλάξετε φορές TCP και το μέγεθος του μηνύματος. Για να αποκτήσετε υψηλότερες ταχύτητες μετάδοσης, πρέπει να χρησιμοποιήσετε πολλά εργοστάσια ανταλλαγής μηνυμάτων.

## <a name="receive-mode"></a>Λειτουργία λήψης

Όταν δημιουργείτε ένα πρόγραμμα-πελάτη ουρά ή της συνδρομής σας, μπορείτε να καθορίσετε μια λειτουργία παραλαβής: *Σύνοψη κλειδώματος* ή *λήψη και να διαγράψετε*. Λάβετε την προεπιλεγμένη κατάσταση λειτουργίας είναι [PeekLock][]. Όταν λειτουργεί σε αυτήν την κατάσταση λειτουργίας, ο υπολογιστής-πελάτης αποστέλλει μια αίτηση για να λάβετε ένα μήνυμα από Bus υπηρεσίας. Αφού ο υπολογιστής-πελάτης έχει λάβει το μήνυμα, στέλνει μια αίτηση για να ολοκληρώσετε το μήνυμα.

Όταν ρυθμίζετε τη λειτουργία παραλαβής να [ReceiveAndDelete][], και τα δύο βήματα συνδυάζονται σε μία μόνο αίτηση. Αυτό μειώνει τον συνολικό αριθμό των λειτουργιών, και να βελτιώσετε τη συνολική μεταγωγή μήνυμα. Το κέρδος αυτό επιδόσεων διατίθεται με ευθύνη να χάσετε τα μηνύματα.

Υπηρεσία Bus δεν υποστηρίζει συναλλαγές για λειτουργίες λαμβάνουν-και-delete. Επιπλέον, σύνοψη κλείδωμα σημασιολογία απαιτούνται για οποιοδήποτε σενάρια όπου ο υπολογιστής-πελάτης θέλει να αναβάλετε ή [νεκρού γράμματα](service-bus-dead-letter-queues.md) ένα μήνυμα.

## <a name="client-side-batching"></a>Δέσμης πλευρά του προγράμματος-πελάτη

Πλευρά του προγράμματος-πελάτη δέσμης επιτρέπει μια ουρά θέμα προγράμματος-πελάτη ή για να καθυστερήσετε την αποστολή ενός μηνύματος για ένα συγκεκριμένο χρονικό διάστημα. Εάν ο υπολογιστής-πελάτης στέλνει πρόσθετα μηνύματα κατά τη διάρκεια αυτής της χρονικής περιόδου, μεταδίδει τα μηνύματα σε μια μεμονωμένη δέσμη. Δέσμης πλευρά του προγράμματος-πελάτη προκαλεί επίσης ένα πρόγραμμα-πελάτη ουρά/συνδρομή για μαζική πολλές αιτήσεις **ολοκλήρωσης** σε μία μόνο αίτηση. Δέσμης είναι διαθέσιμη μόνο για ασύγχρονης λειτουργίες **αποστολής** και **ολοκλήρωσης** . Σύγχρονη λειτουργίες αποστέλλονται αμέσως στην υπηρεσία Bus υπηρεσίας. Δέσμης για μη προκύψουν για τη σύνοψη ή τις λειτουργίες λήψης, ούτε δέσμης προκύψει σε προγράμματα-πελάτες.

Εάν η δέσμη υπερβαίνει το μέγιστο μέγεθος του μηνύματος, το τελευταίο μήνυμα καταργείται από τη δέσμη και ο υπολογιστής-πελάτης στέλνει αμέσως τη δέσμη. Το τελευταίο μήνυμα γίνεται του πρώτου μηνύματος της επόμενης δέσμης. Από προεπιλογή, ένα πρόγραμμα-πελάτη χρησιμοποιεί ένα διάστημα δέσμης 20ms. Μπορείτε να αλλάξετε το διάστημα δέσμη, ορίζοντας την ιδιότητα [BatchFlushInterval][] πριν από τη δημιουργία του εργοστασίου ανταλλαγής μηνυμάτων. Αυτή η ρύθμιση επηρεάζει όλα τα προγράμματα-πελάτες που δημιουργούνται από αυτή η προέλευση.

Για να απενεργοποιήσετε δέσμης, ορίστε την ιδιότητα [BatchFlushInterval][] με **το TimeSpan.Zero**. Για παράδειγμα:

```
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

Δέσμης δεν επηρεάζει τον αριθμό των λειτουργιών χρεώσιμων ανταλλαγής μηνυμάτων και είναι διαθέσιμη μόνο για το πρωτόκολλο Bus υπηρεσία προγράμματος-πελάτη. Το πρωτόκολλο HTTP δεν υποστηρίζει δέσμης.

## <a name="batching-store-access"></a>Δέσμης για πρόσβαση χώρου αποθήκευσης

Για να αυξήσετε την ταχύτητα μεταγωγής μιας ουρά/θέμα/συνδρομής, υπηρεσία Bus δέσμες πολλών μηνυμάτων κατά την εγγραφή για το εσωτερικό χώρο αποθήκευσης. Εάν επιτρέπεται σε ουρά ή το θέμα, γράφετε μηνύματα στο χώρο αποθήκευσης θα είναι batched. Εάν επιτρέπεται σε ουρά ή τη συνδρομή, τη διαγραφή μηνυμάτων από το χώρο αποθήκευσης θα είναι batched. Εάν είναι ενεργοποιημένη access μαζικής αποθήκευσης για μια οντότητα, Bus υπηρεσία καθυστερεί μια λειτουργία εγγραφής store σχετικά με αυτήν την οντότητα, 20ms προς τα επάνω. Λειτουργίες επιπλέον χώρο αποθήκευσης που προκύπτουν στη διάρκεια αυτού του διαστήματος προστίθεται της δέσμης. Access μαζικής αποθήκευσης επηρεάζει μόνο τις λειτουργίες **αποστολής** και **ολοκλήρωσης** ; λήψη λειτουργίες δεν επηρεάζονται. Η πρόσβαση μαζικής αποθήκευσης είναι μια ιδιότητα σε μια οντότητα. Δέσμης πραγματοποιείται σε όλα τα οντοτήτων με δυνατότητα πρόσβασης μαζικής αποθήκευσης.

Όταν δημιουργείτε μια νέα ουρά, το θέμα ή τη συνδρομή, πρόσβαση μαζικής αποθήκευσης είναι ενεργοποιημένη από προεπιλογή. Για να απενεργοποιήσετε την πρόσβαση μαζικής αποθήκευσης, ορίστε την ιδιότητα [EnableBatchedOperations][] σε **false** πριν από τη δημιουργία της οντότητας. Για παράδειγμα:

```
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

Η access μαζικής αποθήκευσης δεν επηρεάζει τον αριθμό των λειτουργιών χρεώσιμων ανταλλαγής μηνυμάτων και είναι μια ιδιότητα ουρά, το θέμα ή τη συνδρομή. Είναι ανεξάρτητα από τη λειτουργία παραλαβής και το πρωτόκολλο που χρησιμοποιείται ανάμεσα σε ένα πρόγραμμα-πελάτη και η υπηρεσία Bus υπηρεσίας.

## <a name="prefetching"></a>Prefetching

Prefetching ενεργοποιεί το ουρά ή συνδρομή του προγράμματος-πελάτη για να φορτώσετε πρόσθετα μηνύματα από την υπηρεσία όταν κάνει μια λειτουργία παραλαβής. Ο υπολογιστής-πελάτης αποθηκεύει αυτά τα μηνύματα σε ένα τοπικό cache. Το μέγεθος του cache προσδιορίζεται από τις ιδιότητες [QueueClient.PrefetchCount][] ή [SubscriptionClient.PrefetchCount][] . Κάθε υπολογιστής-πελάτης που επιτρέπει prefetching διατηρεί το δικό του cache. Μνήμη cache δεν είναι κοινόχρηστη σε υπολογιστές-πελάτες. Εάν ο υπολογιστής-πελάτης ξεκινά μια λειτουργία λήψης και τη μνήμη cache είναι κενό, η υπηρεσία μεταδίδει μια δέσμη μηνυμάτων. Το μέγεθος της δέσμης ισούται με το μέγεθος του cache ή 256KB, όποιο από τα δύο είναι μικρότερο. Εάν ο υπολογιστής-πελάτης ξεκινά μια λειτουργία παραλαβής και το cache περιέχει ένα μήνυμα, το μήνυμα λαμβάνεται από το cache.

Όταν prefetched ένα μήνυμα, η υπηρεσία κλειδώνει prefetched μηνύματος. Με αυτόν τον τρόπο, το μήνυμα prefetched δεν μπορούν να ληφθούν από ένα διαφορετικό δέκτη. Εάν ο παραλήπτης να ολοκληρώσετε το μήνυμα πριν το κλείδωμα λήξει, το μήνυμα θα είναι διαθέσιμο σε άλλα δέκτες. Το prefetched αντίγραφο του μηνύματος παραμένει στο cache. Το ακουστικό που χρησιμοποιεί το αντίγραφο στο cache που έχει λήξει θα λάβουν μια εξαίρεση κατά την προσπάθεια για να ολοκληρώσετε αυτό το μήνυμα. Από προεπιλογή, το κλείδωμα μήνυμα λήξη μετά από 60 δευτερόλεπτα. Αυτή η τιμή μπορεί να επεκταθεί σε 5 λεπτά. Για να αποτρέψετε την κατανάλωση μηνύματα που έχουν λήξει, το μέγεθος του cache πρέπει να είναι πάντα μικρότερος από τον αριθμό των μηνυμάτων που μπορεί να χρησιμοποιηθεί από ένα πρόγραμμα-πελάτη εντός το χρονικό όριο κλειδώματος.

Όταν χρησιμοποιείτε τη λήξη προεπιλεγμένο κλείδωμα των 60 δευτερόλεπτα, μια καλή τιμή για [SubscriptionClient.PrefetchCount][] είναι 20 φορές το μέγιστο επεξεργασίας χρεώσεις όλα δέκτες του εργοστασίου. Για παράδειγμα, ενός εργοστασίου δημιουργεί 3 δέκτες και κάθε παραλήπτη να επεξεργαστεί έως και 10 μηνύματα ανά δευτερόλεπτο. Το πλήθος προφόρτωσης δεν πρέπει να υπερβαίνει 20\*3\*10 = 600. Από προεπιλογή, [QueueClient.PrefetchCount][] έχει οριστεί σε 0, γεγονός που σημαίνει ότι δεν πρόσθετα μηνύματα έχουν ληφθεί από την υπηρεσία.

Prefetching μηνύματα αυξάνεται η συνολική μεταγωγή για ουρά ή τη συνδρομή, επειδή μειώνει το συνολικό αριθμό των λειτουργιών μηνυμάτων ή μεταβάσεις. Λήψη του πρώτου μηνύματος, ωστόσο, θα χρειαστεί περισσότερος χρόνος (λόγω το μέγεθος του μηνύματος αυξημένη). Λαμβάνετε μηνύματα prefetched θα είναι ταχύτερη επειδή αυτά τα μηνύματα έχουν ήδη ληφθεί από το πρόγραμμα-πελάτη.

Είναι επιλεγμένο το time to live (TTL) την ιδιότητα ενός μηνύματος από το διακομιστή κατά τη στιγμή που ο διακομιστής στέλνει το μήνυμα στον υπολογιστή-πελάτη. Ο υπολογιστής-πελάτης δεν ελέγχει την ιδιότητα TTL του μηνύματος κατά τη λήψη του μηνύματος. Αντί για αυτό, το μήνυμα μπορεί να ληφθεί ακόμα και αν το μήνυμα TTL πέρασε ενώ το μήνυμα ήταν στο cache από το πρόγραμμα-πελάτη.

Prefetching δεν επηρεάζει τον αριθμό των λειτουργιών χρεώσιμων ανταλλαγής μηνυμάτων και είναι διαθέσιμη μόνο για το πρωτόκολλο Bus υπηρεσία προγράμματος-πελάτη. Το πρωτόκολλο HTTP δεν υποστηρίζει prefetching. Prefetching είναι διαθέσιμη για τόσο σύγχρονη και ασύγχρονης τις λειτουργίες λήψης.

## <a name="express-queues-and-topics"></a>Express ουρές και θέματα

Σύντομη οντοτήτων Ενεργοποίηση υψηλής απόδοσης και περιορισμένες λανθάνων χρόνος σενάρια. Με ρητή οντοτήτων, εάν αποστέλλεται ένα μήνυμα σε ουρά ή το θέμα, το μήνυμα δεν αμέσως αποθηκεύονται στο χώρο αποθήκευσης μηνυμάτων. Αντί για αυτό, είναι προσωρινά στη μνήμη. Εάν ένα μήνυμα παραμένει στην ουρά για περισσότερα από μερικά δευτερόλεπτα, είναι γραμμένο αυτόματα στο σταθερό χώρο αποθήκευσης, προστατεύετε, επομένως, σε σχέση με απώλεια οφείλεται σε ένα μη διαθεσιμότητα. Σύνταξη του μηνύματος σε μια μνήμη cache αυξάνει την ταχύτητα μετάδοσης και μειώνει λανθάνων χρόνος, επειδή δεν έχει πρόσβαση στο σταθερό χώρο αποθήκευσης κατά την αποστολή του μηνύματος. Τα μηνύματα που έχουν καταναλωθεί μέσα σε μερικά δευτερόλεπτα δεν εγγράφονται στο χώρο αποθήκευσης των μηνυμάτων. Το παρακάτω παράδειγμα δημιουργεί μια σύντομη θέμα.

```
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

Εάν ένα μήνυμα το οποίο περιέχει σημαντικές πληροφορίες που πρέπει να μην χαθούν αποστέλλεται σε μια σύντομη οντότητα, τον αποστολέα να επιβάλετε Bus υπηρεσία διατήρησης αμέσως το μήνυμα στο σταθερό χώρο αποθήκευσης, ορίζοντας την ιδιότητα [ForcePersistence][] στην **τιμή true**.

## <a name="use-of-partitioned-queues-or-topics"></a>Χρήση των διαμερίσματα ουρές ή θέματα

Εσωτερικά, υπηρεσία Bus χρησιμοποιεί το ίδιο κόμβο και την ανταλλαγή μηνυμάτων αποθήκευση για την επεξεργασία και αποθήκευση όλων των μηνυμάτων για μια οντότητα ανταλλαγής μηνυμάτων (ουρά ή θέμα). Διαμερίσματα ουρά ή το θέμα, από την άλλη πλευρά, κατανέμεται σε πολλές κόμβους και αποθηκεύει ανταλλαγής μηνυμάτων. Διαμερίσματα ουρές και θέματα απόδοσης όχι μόνο μια μεγαλύτερη ταχύτητα μετάδοσης από το κανονικό ουρές και θέματα, παρουσιάζουν επίσης προϊσταμένου διαθεσιμότητα. Για να δημιουργήσετε ένα διαμερίσματα οντότητα, ορίστε την ιδιότητα [EnablePartitioning][] σε **true**, όπως φαίνεται στο παρακάτω παράδειγμα. Για περισσότερες πληροφορίες σχετικά με τα διαμερίσματα οντοτήτων, ανατρέξτε στο θέμα [Δημιουργία διαμερισμάτων ανταλλαγής μηνυμάτων οντοτήτων][].

```
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a>Χρήση των πολλαπλές ουρές

Εάν δεν μπορείτε να χρησιμοποιήσετε ένα διαμερίσματα ουρά ή το θέμα ή τα αναμενόμενα φόρτωσης δεν είναι δυνατό να διαχειρίζεται μια μοναδική διαμερίσματα ουρά ή ένα θέμα, πρέπει να χρησιμοποιήσετε πολλών μηνυμάτων οντοτήτων. Κατά τη χρήση πολλών οντοτήτων, δημιουργήστε ένα αποκλειστικό πρόγραμμα-πελάτη για κάθε οντότητα, αντί να χρησιμοποιήσετε το ίδιο πρόγραμμα-πελάτη για όλους οντοτήτων.

## <a name="development--testing-features"></a>Ανάπτυξη & δοκιμών δυνατότητες

Υπηρεσία Bus περιλαμβάνει μια δυνατότητα που είναι χρησιμοποιείται ειδικά για ανάπτυξη ποια **θα πρέπει να χρησιμοποιηθεί ποτέ σε ρυθμίσεις παραμέτρων παραγωγής**.

[TopicDescription.EnableFilteringMessagesBeforePublishing](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing.aspx)
- Όταν νέα κανόνες ή φίλτρα προστίθενται στο θέμα, EnableFilteringMessagesBeforePublishing μπορεί να χρησιμοποιηθεί για να βεβαιωθείτε ότι η νέα παράσταση φίλτρου λειτουργεί όπως αναμένεται.

## <a name="scenarios"></a>Σενάρια

Οι παρακάτω ενότητες περιγράφουν τυπικές σενάρια ανταλλαγής μηνυμάτων και τις προτιμώμενες ρυθμίσεις υπηρεσίας Bus διάρθρωσης. Ταχύτητες μετάδοσης ταξινομούνται ως μικρό (λιγότερο από 1 μήνυμα/δευτερόλεπτο), εποπτεία (μήνυμα 1/δευτερόλεπτο ή μεγαλύτερη αλλά λιγότερους από 100 μηνύματα/δευτερόλεπτο) και την ανώτερη (100 μηνύματα/δεύτερο ή μεγαλύτερη). Τον αριθμό των πελατών που έχουν ταξινομηθεί ως μικρών (5 ή λιγότερους), Μέτριο (περισσότερα από 5 αλλά μικρότερη ή ίση με 20), και μεγάλο (περισσότερα από 20).

### <a name="high-throughput-queue"></a>Ουρά υψηλής ταχύτητας μετάδοσης

Στόχος: Μεγιστοποίηση της ταχύτητας μετάδοσης μιας μεμονωμένης ουράς. Ο αριθμός των αποστολέων και παραληπτών είναι μικρό.

-   Χρησιμοποιήστε ένα διαμερίσματα ουρά για καλύτερη απόδοση και διαθεσιμότητα.

-   Για να αυξήσετε το συνολικό ποσοστό Αποστολή σε ουρά, χρησιμοποιήστε πολλές εργοστάσια μήνυμα για να δημιουργήσετε αποστολείς. Για κάθε αποστολέα, χρησιμοποιήστε ασύγχρονων λειτουργιών ή πολλά νήματα.

-   Για να αυξήσετε το συνολικό ποσοστό παραλαβής από την ουρά, χρησιμοποιήστε πολλές εργοστάσια μήνυμα για να δημιουργήσετε δέκτες.

-   Χρησιμοποιήστε ασύγχρονων λειτουργιών για να επωφεληθείτε από την πλευρά του προγράμματος-πελάτη δέσμης.

-   Ορίστε το διάστημα διαδικασίας δέσμης σε 50ms για να μειώσετε τον αριθμό των Bus υπηρεσίας μετάδοση πρωτόκολλο προγράμματος-πελάτη. Εάν χρησιμοποιούνται πολλές αποστολείς, αυξήστε το διαδικασίας δέσμης για να 100ms.

-   Αφήστε με δυνατότητα πρόσβασης μαζικής αποθήκευσης. Αυξάνει το συνολικό ποσοστό την οποία μπορούν να εγγραφούν μηνύματα στην ουρά.

-   Ορισμός του πλήθους προφόρτωσης με 20 φορές το ρυθμό μέγιστο επεξεργασίας του όλα δέκτες ενός εργοστασίου. Αυτό μειώνει τον αριθμό των Bus υπηρεσίας μετάδοση πρωτόκολλο προγράμματος-πελάτη.

### <a name="multiple-high-throughput-queues"></a>Πολλαπλές ουρές υψηλής ταχύτητας μετάδοσης

Στόχος: Μεγιστοποίηση συνολική απόδοση πολλαπλές ουρές. Η ταχύτητα μετάδοσης μιας μεμονωμένα ουράς είναι μέτρια ή υψηλή.

Για να αποκτήσετε μέγιστη ταχύτητα μετάδοσης σε πολλαπλές ουρές, χρησιμοποιήστε τις ρυθμίσεις που περιγράφονται για να μεγιστοποιήσετε το μετάδοσης μιας μεμονωμένης ουράς. Επιπλέον, μπορείτε να χρησιμοποιήσετε διαφορετικά εργοστάσια για να δημιουργήσετε προγράμματα-πελάτες που στέλνετε ή λαμβάνετε από διαφορετικές ουρές.

### <a name="low-latency-queue"></a>Ουρά χαμηλής λανθάνοντος χρόνου

Στόχος: Ελαχιστοποίηση λανθάνοντος χρόνου για να ολοκληρωμένες ουρά ή το θέμα. Ο αριθμός των αποστολέων και παραληπτών είναι μικρό. Η ταχύτητα μετάδοσης της ουράς είναι μικρές ή μέτριο.

-   Χρησιμοποιήστε ένα διαμερίσματα ουρά για τη βελτίωση της διαθεσιμότητας.

-   Απενεργοποίηση δέσμης πλευρά του προγράμματος-πελάτη. Το πρόγραμμα-πελάτη αμέσως στέλνει ένα μήνυμα.

-   Απενεργοποίηση πρόσβασης μαζικής αποθήκευσης. Η υπηρεσία εγγράφει αμέσως το μήνυμα στο χώρο αποθήκευσης.

-   Εάν χρησιμοποιείτε ένα μεμονωμένο πρόγραμμα-πελάτη, ορίστε το πλήθος προφόρτωσης σε 20 ώρες την ταχύτητα επεξεργασίας του παραλήπτη. Εάν πολλά μηνύματα άφιξη στην ουρά την ίδια στιγμή, το πρωτόκολλο προγράμματος-πελάτη υπηρεσίας Bus τα μεταδίδει όλα ταυτόχρονα. Όταν ο υπολογιστής-πελάτης λαμβάνει στο επόμενο μήνυμα, αυτό το μήνυμα είναι ήδη στο τοπικό cache. Το cache πρέπει να είναι μικρές.

-   Εάν χρησιμοποιείτε πολλά προγράμματα-πελάτες, το πλήθος προφόρτωσης την τιμή 0. Με αυτόν τον τρόπο, το δεύτερο πρόγραμμα-πελάτη μπορούν να λάβετε το δεύτερο μήνυμα ενώ το πρώτο πρόγραμμα-πελάτης εξακολουθεί να επεξεργάζεται το πρώτο μήνυμα.

### <a name="queue-with-a-large-number-of-senders"></a>Ουρά με ένα μεγάλο αριθμό αποστολείς

Στόχος: Μεγιστοποίηση μετάδοσης ουρά ή το θέμα με μεγάλο αριθμό αποστολείς. Κάθε αποστολέα στέλνει μηνύματα με μέτρια χρέωσης. Ο αριθμός των δέκτες είναι μικρό.

Υπηρεσία Bus επιτρέπει μέχρι 1000 ταυτόχρονες συνδέσεις σε μια οντότητα ανταλλαγής μηνυμάτων (ή 5000 χρησιμοποιώντας AMQP). Αυτό το όριο έχει εφαρμοστεί στο επίπεδο χώρο ονομάτων και ουρές/θέματα συνδρομές έχουν φτάσει από το όριο των ταυτόχρονες συνδέσεις ανά χώρο ονομάτων. Για ουρές, αυτός ο αριθμός είναι κοινόχρηστα μεταξύ αποστολέων και παραληπτών. Εάν όλες οι συνδέσεις 1000 απαιτούνται για το αποστολείς, θα πρέπει να μπορείτε να αντικαταστήσετε ουρά με ένα θέμα και μια μεμονωμένη συνδρομή. Ένα θέμα αποδέχεται μέχρι 1000 ταυτόχρονες συνδέσεις από αποστολείς, ότι η συνδρομή αποδέχεται μια επιπλέον 1000 ταυτόχρονες συνδέσεις από δέκτες. Εάν απαιτούνται περισσότερους από 1000 ταυτόχρονες αποστολείς, οι αποστολείς πρέπει να στείλετε μηνύματα σε το πρωτόκολλο υπηρεσίας Bus μέσω του πρωτοκόλλου HTTP.

Για να μεγιστοποιήσετε μετάδοσης, κάντε τα εξής:

-   Χρησιμοποιήστε ένα διαμερίσματα ουρά για καλύτερη απόδοση και διαθεσιμότητα.

-   Αν κάθε αποστολέα βρίσκεται σε μια διαφορετική διαδικασία, χρησιμοποιήστε μόνο ένα μεμονωμένο εργοστασίου ανά διεργασία.

-   Χρησιμοποιήστε ασύγχρονων λειτουργιών για να επωφεληθείτε από την πλευρά του προγράμματος-πελάτη δέσμης.

-   Χρησιμοποιήστε την προεπιλεγμένη δέσμης για διάστημα 20ms για να μειώσετε τον αριθμό των Bus υπηρεσίας μετάδοση πρωτόκολλο προγράμματος-πελάτη.

-   Αφήστε με δυνατότητα πρόσβασης μαζικής αποθήκευσης. Αυξάνει το συνολικό ποσοστό την οποία μπορούν να εγγραφούν μηνύματα στην ουρά ή το θέμα.

-   Ορισμός του πλήθους προφόρτωσης με 20 φορές το ρυθμό μέγιστο επεξεργασίας του όλα δέκτες ενός εργοστασίου. Αυτό μειώνει τον αριθμό των Bus υπηρεσίας μετάδοση πρωτόκολλο προγράμματος-πελάτη.

### <a name="queue-with-a-large-number-of-receivers"></a>Ουρά με ένα μεγάλο αριθμό δέκτες

Στόχος: Μεγιστοποίηση το επιτόκιο παραλαβής ουρά ή τη συνδρομή με μεγάλο αριθμό δέκτες. Κάθε παραλήπτης λαμβάνει μηνύματα με έναν μέτρια χρέωση. Ο αριθμός των αποστολέων είναι μικρό.

Υπηρεσία Bus επιτρέπει μέχρι 1000 ταυτόχρονες συνδέσεις σε μια οντότητα. Εάν μια ουρά απαιτεί περισσότερους από 1000 δέκτες, που πρέπει να αντικαταστήσετε ουρά με ένα θέμα και πολλές συνδρομές. Κάθε συνδρομής μπορούν να υποστηρίξουν έως και 1000 ταυτόχρονες συνδέσεις. Εναλλακτικά, δέκτες να αποκτήσετε πρόσβαση στην ουρά μέσω του πρωτοκόλλου HTTP.

Για να μεγιστοποιήσετε μετάδοσης, κάντε τα εξής:

-   Χρησιμοποιήστε ένα διαμερίσματα ουρά για καλύτερη απόδοση και διαθεσιμότητα.

-   Αν κάθε παραλήπτη βρίσκεται σε μια διαφορετική διαδικασία, χρησιμοποιήστε μόνο ένα μεμονωμένο εργοστασίου ανά διεργασία.

-   Δέκτες να χρησιμοποιήσετε λειτουργίες σύγχρονη ή ασύγχρονη. Λαμβάνοντας υπόψη τη χρέωση μέτρια παραλαβής δέκτη μεμονωμένα, δέσμης πλευρά του προγράμματος-πελάτη για μια πρόσκληση σε πλήρη δεν επηρεάζει ακουστικό μεταγωγή.

-   Αφήστε με δυνατότητα πρόσβασης μαζικής αποθήκευσης. Αυτό μειώνει το συνολικό φορτίο της οντότητας. Μειώνει επίσης η συνολική ταχύτητα με την οποία μπορούν να εγγραφούν μηνύματα στην ουρά ή το θέμα.

-   Ορισμός του πλήθους προφόρτωσης σε μικρές τιμή (για παράδειγμα, PrefetchCount = 10). Αυτό αποτρέπει δέκτες από αδράνεια ενώ άλλα δέκτες έχουν μεγάλου αριθμού των μηνυμάτων στο cache.

### <a name="topic-with-a-small-number-of-subscriptions"></a>Το θέμα με μικρό αριθμό των συνδρομών

Στόχος: Μεγιστοποιήστε την απόδοση ενός θέματος με μικρό αριθμό των συνδρομών. Λαμβάνετε ένα μήνυμα από πολλές συνδρομές, γεγονός που σημαίνει ότι το επιτόκιο συνδυασμένο παραλαβής πάνω από όλες τις συνδρομές είναι μεγαλύτερο από την ταχύτητα αποστολής. Ο αριθμός των αποστολέων είναι μικρό. Ο αριθμός των δέκτες ανά συνδρομή είναι μικρό.

Για να μεγιστοποιήσετε μετάδοσης, κάντε τα εξής:

-   Χρησιμοποιήστε ένα διαμερίσματα θέμα για καλύτερη απόδοση και διαθεσιμότητα.

-   Για να αυξήσετε το συνολικό ποσοστό Αποστολή σε το θέμα, χρησιμοποιήστε πολλές εργοστάσια μήνυμα για να δημιουργήσετε αποστολείς. Για κάθε αποστολέα, χρησιμοποιήστε ασύγχρονων λειτουργιών ή πολλά νήματα.

-   Για να αυξήσετε το συνολικό ποσοστό παραλαβής από μια συνδρομή, χρησιμοποιήστε πολλές εργοστάσια μήνυμα για να δημιουργήσετε δέκτες. Για κάθε παραλήπτη, χρησιμοποιήστε ασύγχρονων λειτουργιών ή πολλά νήματα.

-   Χρησιμοποιήστε ασύγχρονων λειτουργιών για να επωφεληθείτε από την πλευρά του προγράμματος-πελάτη δέσμης.

-   Χρησιμοποιήστε την προεπιλεγμένη δέσμης για διάστημα 20ms για να μειώσετε τον αριθμό των Bus υπηρεσίας μετάδοση πρωτόκολλο προγράμματος-πελάτη.

-   Αφήστε με δυνατότητα πρόσβασης μαζικής αποθήκευσης. Αυξάνει το συνολικό ποσοστό στο οποίο τα μηνύματα μπορεί να έχει εγγραφεί στο θέμα.

-   Ορισμός του πλήθους προφόρτωσης με 20 φορές το ρυθμό μέγιστο επεξεργασίας του όλα δέκτες ενός εργοστασίου. Αυτό μειώνει τον αριθμό των Bus υπηρεσίας μετάδοση πρωτόκολλο προγράμματος-πελάτη.

### <a name="topic-with-a-large-number-of-subscriptions"></a>Το θέμα με μεγάλο αριθμό συνδρομών

Στόχος: Μεγιστοποιήστε την απόδοση ενός θέματος με μεγάλο αριθμό συνδρομών. Λαμβάνετε ένα μήνυμα από πολλές συνδρομές, που σημαίνει ότι ο ρυθμός συνδυασμένο παραλαβής πάνω από όλες τις συνδρομές είναι πολύ μεγαλύτερο από την ταχύτητα αποστολής. Ο αριθμός των αποστολέων είναι μικρό. Ο αριθμός των δέκτες ανά συνδρομή είναι μικρό.

Θέματα με μεγάλο αριθμό συνδρομών εκθέτουν συνήθως μια χαμηλή συνολική μεταγωγή εάν όλα τα μηνύματα δρομολογούνται σε όλες τις συνδρομές. Αυτό προκαλείται από το γεγονός ότι κάθε μήνυμα λαμβάνεται πολλές φορές και όλα τα μηνύματα που περιέχονται σε ένα θέμα και όλες τις συνδρομές αποθηκεύονται στον ίδιο χώρο αποθήκευσης. Θεωρείται ότι ο αριθμός των αποστολέων και αριθμός δέκτες ανά συνδρομή είναι μικρό. Υπηρεσία Bus υποστηρίζει έως 2.000 συνδρομές ανά θέμα.

Για να μεγιστοποιήσετε μετάδοσης, κάντε τα εξής:

-   Χρησιμοποιήστε ένα διαμερίσματα θέμα για καλύτερη απόδοση και διαθεσιμότητα.

-   Χρησιμοποιήστε ασύγχρονων λειτουργιών για να επωφεληθείτε από την πλευρά του προγράμματος-πελάτη δέσμης.

-   Χρησιμοποιήστε την προεπιλεγμένη δέσμης για διάστημα 20ms για να μειώσετε τον αριθμό των Bus υπηρεσίας μετάδοση πρωτόκολλο προγράμματος-πελάτη.

-   Αφήστε με δυνατότητα πρόσβασης μαζικής αποθήκευσης. Αυξάνει το συνολικό ποσοστό στο οποίο τα μηνύματα μπορεί να έχει εγγραφεί στο θέμα.

-   Ορίστε το πλήθος προφόρτωσης σε 20 φορές το επιτόκιο αναμενόμενο παραλαβής σε δευτερόλεπτα. Αυτό μειώνει τον αριθμό των Bus υπηρεσίας μετάδοση πρωτόκολλο προγράμματος-πελάτη.

## <a name="next-steps"></a>Επόμενα βήματα

Για να μάθετε περισσότερα σχετικά με τη βελτιστοποίηση των επιδόσεων Bus υπηρεσίας, ανατρέξτε στο θέμα [Partitioned μηνυμάτων οντοτήτων][].

  [QueueClient]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.queueclient.aspx
  [MessageSender]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagesender.aspx
  [MessagingFactory]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingfactory.aspx
  [PeekLock]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.receivemode.aspx
  [ReceiveAndDelete]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.receivemode.aspx
  [BatchFlushInterval]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval.aspx
  [EnableBatchedOperations]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations.aspx
  [QueueClient.PrefetchCount]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.queueclient.prefetchcount.aspx
  [SubscriptionClient.PrefetchCount]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.subscriptionclient.prefetchcount.aspx
  [ForcePersistence]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.forcepersistence.aspx
  [EnablePartitioning]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.queuedescription.enablepartitioning.aspx
  [Διαμερίσματα οντοτήτων ανταλλαγής μηνυμάτων]: service-bus-partitioning.md
  