<properties 
    pageTitle="Εφαρμογές υπηρεσίας Bus σε σχέση με διακοπές και καταστροφές μονωτικό | Microsoft Azure"
    description="Περιγράφει τεχνικές που μπορείτε να χρησιμοποιήσετε για την προστασία των εφαρμογών σε σχέση με μια πιθανή μη διαθεσιμότητα Bus υπηρεσίας."
    services="service-bus"
    documentationCenter="na"
    authors="sethmanheim"
    manager="timlt"
    editor="tysonn" /> 
<tags 
    ms.service="service-bus"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="na"
    ms.date="09/02/2016"
    ms.author="sethm" />

# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a>Βέλτιστες πρακτικές για μονωτικό εφαρμογές σε σχέση με την υπηρεσία Bus διακοπές και καταστροφές

Κρίσιμης σημασίας εφαρμογές πρέπει να λειτουργούν συνεχώς, ακόμα και παρουσία μη προγραμματισμένη ΡΕΥΜΑΤΟΣ ή καταστροφές. Αυτό το θέμα περιγράφει τεχνικές που μπορείτε να χρησιμοποιήσετε για την προστασία των εφαρμογών υπηρεσίας Bus σε πιθανές μη διαθεσιμότητα υπηρεσίας ή καταστροφή.

Ένα μη διαθεσιμότητα ορίζεται ως προσωρινό μη διαθεσιμότητα του Azure Bus υπηρεσίας. Τα μη διαθεσιμότητα μπορεί να επηρεάσει ορισμένα στοιχεία του Bus υπηρεσία, όπως ένα χώρο αποθήκευσης μηνυμάτων ή ακόμα και το ολόκληρο κέντρο δεδομένων. Αφού έχει καθοριστεί το πρόβλημα, υπηρεσία Bus καθίσταται διαθέσιμη ξανά. Συνήθως, μια μη διαθεσιμότητα δεν προκαλεί απώλεια μηνύματα ή άλλα δεδομένα. Παράδειγμα μιας αποτυχίας στοιχείου είναι μη διαθεσιμότητα του ένα συγκεκριμένο χώρο αποθήκευσης μηνυμάτων. Παράδειγμα μιας μη διαθεσιμότητα όλο το κέντρο δεδομένων είναι ρεύματος από το κέντρο δεδομένων ή το διακόπτη δικτύου ελαττωματική κέντρου δεδομένων. Ένα μη διαθεσιμότητα μπορεί να διαρκέσει από μερικά λεπτά για να μερικές ημέρες.

Μια καταστροφή ορίζεται ως την οριστική απώλεια Bus υπηρεσίας κλίμακα μονάδας ή κέντρου δεδομένων. Το κέντρο δεδομένων ενδέχεται να ή ενδέχεται να μην γίνεται διαθέσιμη ξανά. Συνήθως μια καταστροφή προκαλεί απώλεια ορισμένα ή όλα τα μηνύματα ή άλλα δεδομένα. Παραδείγματα καταστροφές είναι fire, κατάκλυση ή σεισμικής.

## <a name="current-architecture"></a>Τρέχουσα αρχιτεκτονική

Υπηρεσία Bus χρησιμοποιεί πολλούς χώρους αποθήκευσης ανταλλαγής μηνυμάτων για την αποθήκευση μηνυμάτων που αποστέλλονται σε ουρές ή τα θέματα. Δεν έχουν δημιουργηθεί διαμερίσματα ουρά ή το θέμα έχει αντιστοιχιστεί σε ένα χώρο αποθήκευσης μηνυμάτων. Εάν αυτός ο χώρος αποθήκευσης μηνυμάτων δεν είναι διαθέσιμη, όλες οι λειτουργίες σε αυτήν τη ουρά ή το θέμα θα αποτύχει.

Όλα οντοτήτων Bus υπηρεσία ανταλλαγής μηνυμάτων (ουρές, θέματα, αναμετάδοση) που βρίσκονται σε ένα χώρο ονομάτων υπηρεσίας, που είναι συνδεδεμένη με ένα κέντρο δεδομένων. Υπηρεσία Bus δεν δίνει τη δυνατότητα αυτόματης αναπαραγωγής παν των δεδομένων, ούτε επιτρέψετε ένα χώρο ονομάτων που εκτείνονται σε πολλές κέντρα δεδομένων.

## <a name="protecting-against-acs-outages"></a>Προστασία έναντι ACS ΡΕΥΜΑΤΟΣ

Εάν χρησιμοποιείτε τα διαπιστευτήρια ACS και ACS δεν είναι διαθέσιμη, προγράμματα-πελάτες δεν είναι πλέον να προμηθευτείτε διακριτικά. Προγράμματα-πελάτες που διαθέτουν ενός διακριτικού τη στιγμή ACS μεταβαίνει προς τα κάτω να συνεχίσετε να χρησιμοποιείτε την υπηρεσία Bus μέχρι τη λήξη τα διακριτικά. Η διάρκεια ζωής διακριτικού προεπιλογή είναι 3 ώρες.

Για να προστατευτώ από ACS ΡΕΥΜΑΤΟΣ, χρησιμοποιήστε τα διακριτικά θέσει σε κοινή χρήση Access υπογραφή (συσχετισμών Ασφαλείας). Σε αυτήν την περίπτωση, το πρόγραμμα-πελάτη πραγματοποιεί έλεγχο ταυτότητας απευθείας με την υπηρεσία Bus πραγματοποιώντας είσοδο ενός διακριτικού αυτο-minted με ένα μυστικό κλειδί. Κλήσεις ACS δεν είναι πλέον απαιτείται. Για περισσότερες πληροφορίες σχετικά με τα διακριτικά συσχετισμών Ασφαλείας, ανατρέξτε στο θέμα [Bus υπηρεσία ελέγχου ταυτότητας][].

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a>Προστασία ουρές και θέματα σε σχέση με την ανταλλαγή μηνυμάτων αποτυχιών του χώρου αποθήκευσης

Δεν έχουν δημιουργηθεί διαμερίσματα ουρά ή το θέμα έχει αντιστοιχιστεί σε ένα χώρο αποθήκευσης μηνυμάτων. Εάν αυτός ο χώρος αποθήκευσης μηνυμάτων δεν είναι διαθέσιμη, όλες οι λειτουργίες σε αυτήν τη ουρά ή το θέμα θα αποτύχει. Μια διαμερίσματα ουρά, από την άλλη πλευρά, αποτελείται από πολλά τμήματα. Κάθε τμήμα αποθηκεύονται σε ένα διαφορετικό χώρο αποθήκευσης μηνυμάτων. Κατά την αποστολή ενός μηνύματος σε διαμερίσματα ουρά ή το θέμα, υπηρεσία Bus εκχωρεί το μήνυμα σε ένα από τα τμήματα. Εάν το αντίστοιχο store ανταλλαγής μηνυμάτων δεν είναι διαθέσιμη, υπηρεσία Bus εγγράφει το μήνυμα σε ένα διαφορετικό τμήμα, εάν είναι δυνατό. Για περισσότερες πληροφορίες σχετικά με τα διαμερίσματα οντοτήτων, ανατρέξτε στο θέμα [Δημιουργία διαμερισμάτων ανταλλαγής μηνυμάτων οντοτήτων][].

## <a name="protecting-against-datacenter-outages-or-disasters"></a>Προστασία σε σχέση με το κέντρο δεδομένων διακοπές ή καταστροφές

Για να επιτρέψετε για ανακατεύθυνσης μεταξύ των δύο κέντρα δεδομένων, μπορείτε να δημιουργήσετε ένα χώρο ονομάτων υπηρεσίας Bus υπηρεσίας σε κάθε κέντρου δεδομένων. Για παράδειγμα, η υπηρεσία Bus υπηρεσίας χώρο ονομάτων **contosoPrimary.servicebus.windows.net** ενδέχεται να βρίσκονται στην περιοχή Ηνωμένες Πολιτείες Βόρεια/κεντρική και **contosoSecondary.servicebus.windows.net** ενδέχεται να βρίσκονται στην περιοχή ΜΑΣ Νότια/Central. Εάν μια υπηρεσία Bus μηνυμάτων οντότητα πρέπει να παραμείνει προσβάσιμα παρουσία μια διακοπή λειτουργίας κέντρου δεδομένων, μπορείτε να δημιουργήσετε αυτήν την οντότητα σε δύο πεδία ονομάτων.

Για περισσότερες πληροφορίες, ανατρέξτε στην ενότητα "Αποτυχία της υπηρεσίας Bus μέσα σε ένα κέντρο δεδομένων του Azure" στο [ασύγχρονης μοτίβα ανταλλαγής μηνυμάτων και υψηλή διαθεσιμότητα][].

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a>Προστασία μεταγωγής τελικά σημεία σε σχέση με το κέντρο δεδομένων διακοπές ή καταστροφές

Παν-αναπαραγωγή της τελικά σημεία μεταγωγής επιτρέπει μια υπηρεσία που εκθέτει ένα τελικό σημείο αναμετάδοσης για να είναι προσβάσιμος παρουσία ΡΕΥΜΑΤΟΣ Bus υπηρεσίας. Για να επιτύχετε παν αναπαραγωγής, της υπηρεσίας πρέπει να δημιουργήσετε δύο τελικά σημεία μεταγωγής σε διαφορετικά πεδία ονομάτων. Τα πεδία ονομάτων πρέπει να βρίσκονται σε διαφορετική κέντρα δεδομένων και τα δύο τελικά σημεία πρέπει να έχουν διαφορετικά ονόματα. Για παράδειγμα, ένα πρωτεύον τελικό σημείο είναι δυνατή η πρόσβαση στην περιοχή **contosoPrimary.servicebus.windows.net/myPrimaryService**, ενώ το αντίστοιχο δευτερεύοντα μπορούν να σας καλούν στην περιοχή **contosoSecondary.servicebus.windows.net/mySecondaryService**.

Η υπηρεσία παρακολουθεί, στη συνέχεια, τόσο τα τελικά σημεία και πρόγραμμα-πελάτη και να ενεργοποιήσετε την υπηρεσία μέσω είτε τελικού σημείου. Μια εφαρμογή προγράμματος-πελάτη τυχαία συλλογές ένα από τα αναμετάδοση ως το τελικό σημείο πρωτεύοντα και στέλνει την αίτηση στο ενεργό τελικό σημείο. Εάν η λειτουργία αποτύχει με έναν κωδικό σφάλματος, αυτό το σφάλμα υποδεικνύει ότι το τελικό σημείο μετάδοση δεν είναι διαθέσιμη. Η εφαρμογή ανοίγει ένα κανάλι στο τελικό σημείο δημιουργίας αντιγράφων ασφαλείας και reissues την αίτηση. Σε αυτό το σημείο του ενεργού και τα τελικά σημεία αντιγράφου ασφαλείας αλλαγή ρόλων: την εφαρμογή-πελάτη θεωρεί το παλιό ενεργό τελικό σημείο για να το νέο τελικό σημείο δημιουργίας αντιγράφων ασφαλείας και το παλιό τελικό σημείο δημιουργίας αντιγράφων ασφαλείας για να το νέο ενεργό τελικό σημείο. Εάν και τα δύο στείλετε ΑΠΟΤΥΧΙΑ λειτουργίες, τους ρόλους των δύο οντοτήτων παραμένουν αμετάβλητες και επιστρέφεται σφάλμα.

Το δείγμα [παν-αλληλεπίδραση με τα μηνύματα αναμετάδοση Bus υπηρεσία][] παρουσιάζει πώς μπορείτε να αναπαραγάγετε αναμετάδοση.

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a>Προστασία ουρές και θέματα σε σχέση με το κέντρο δεδομένων διακοπές ή καταστροφές

Για να επιτύχετε ανθεκτικότητα σε σχέση με διακοπές του κέντρου δεδομένων όταν χρησιμοποιείτε όπου μεσολαβούν μηνυμάτων, υπηρεσία Bus υποστηρίζει δύο προσεγγίσεις: *ενεργή* και *παθητικές* αναπαραγωγή. Για κάθε προσέγγιση, εάν μια δεδομένη ουρά ή ένα θέμα πρέπει να παραμείνει προσβάσιμα παρουσία μια διακοπή λειτουργίας κέντρου δεδομένων, μπορείτε να δημιουργήσετε το σε δύο πεδία ονομάτων. Και οι δύο οντοτήτων μπορούν να έχουν το ίδιο όνομα. Για παράδειγμα, μια κύρια ουρά είναι δυνατή η πρόσβαση στην περιοχή **contosoPrimary.servicebus.windows.net/myQueue**, ενώ το αντίστοιχο δευτερεύοντα μπορούν να σας καλούν στην περιοχή **contosoSecondary.servicebus.windows.net/myQueue**.

Εάν η εφαρμογή δεν απαιτεί μόνιμο αποστολέα-δέκτη επικοινωνίας, η εφαρμογή να υλοποιήσετε μια διαρκή ουρά πλευρά του προγράμματος-πελάτη για να αποτρέψετε την απώλεια μήνυμα και να προστατεύσει τον αποστολέα από μεταβατικές σφάλματα Bus υπηρεσίας.

## <a name="active-replication"></a>Ενεργό αναπαραγωγής

Ενεργό αναπαραγωγή χρησιμοποιεί οντοτήτων σε δύο πεδία ονομάτων για κάθε λειτουργία. Οποιοδήποτε πρόγραμμα-πελάτη που στέλνει ένα μήνυμα που στέλνει δύο αντίγραφα του ίδιου μηνύματος. Το πρώτο αντίγραφο αποστέλλεται την κύρια οντότητα (για παράδειγμα, **contosoPrimary.servicebus.windows.net/sales**) και το δεύτερο αντίγραφο του μηνύματος αποστέλλεται στη δευτερεύουσα οντότητα (για παράδειγμα, **contosoSecondary.servicebus.windows.net/sales**).

Ένας υπολογιστής-πελάτης λαμβάνει μηνύματα από τις δύο ουρές. Το ακουστικό επεξεργάζεται το πρώτο αντίγραφο του μηνύματος και το δεύτερο αντίγραφο είναι κρυφοί. Για να αποκρύψετε διπλότυπα μηνύματα, στον αποστολέα πρέπει να προσθέσετε ετικέτες σε κάθε μήνυμα με ένα μοναδικό αναγνωριστικό. Και τα δύο αντίγραφα του μηνύματος πρέπει να φέρουν ετικέτα με το ίδιο αναγνωριστικό. Μπορείτε να χρησιμοποιήσετε τις ιδιότητες [BrokeredMessage.MessageId][] ή [BrokeredMessage.Label][] ή μια προσαρμοσμένη ιδιότητα για να προσθέσετε ετικέτα του μηνύματος. Ο παραλήπτης πρέπει να διατηρείτε μια λίστα των μηνυμάτων που έχει ήδη λάβει.

Το δείγμα [παν-αλληλεπίδραση με τα μηνύματα όπου μεσολαβούν Bus υπηρεσία][] παρουσιάζει ενεργό αναπαραγωγής του μηνυμάτων οντοτήτων.

> [AZURE.NOTE] Η προσέγγιση ενεργό αναπαραγωγής διπλασιάζεται ο αριθμός των λειτουργιών, επομένως αυτή η προσέγγιση μπορεί να οδηγήσει σε υψηλότερες κόστος.

## <a name="passive-replication"></a>Παθητικές αναπαραγωγής

Σε περίπτωση σφάλματος χωρίς, παθητικές αναπαραγωγή χρησιμοποιεί μόνο ένα από τα δύο οντοτήτων ανταλλαγής μηνυμάτων. Ένας υπολογιστής-πελάτης στέλνει το μήνυμα στην ενεργή οντότητα. Εάν αποτύχει η λειτουργία στην ενεργή οντότητα με έναν κωδικό σφάλματος που υποδεικνύει το κέντρο δεδομένων που φιλοξενεί την ενεργή οντότητα ίσως να μην είναι διαθέσιμες, ο υπολογιστής-πελάτης στέλνει ένα αντίγραφο του μηνύματος στην οντότητα δημιουργίας αντιγράφων ασφαλείας. Σε αυτό το σημείο του ενεργού και των αντιγράφων ασφαλείας οντοτήτων αλλαγή ρόλων: το πρόγραμμα-πελάτης αποστολής θεωρεί ότι η παλιά ενεργή οντότητα να είναι η νέα οντότητα δημιουργίας αντιγράφων ασφαλείας και την παλιά οντότητα δημιουργίας αντιγράφων ασφαλείας είναι η νέα οντότητα ενεργό. Εάν και τα δύο στείλετε ΑΠΟΤΥΧΙΑ λειτουργίες, τους ρόλους των δύο οντοτήτων παραμένουν αμετάβλητες και επιστρέφεται σφάλμα.

Ένας υπολογιστής-πελάτης λαμβάνει μηνύματα από τις δύο ουρές. Επειδή υπάρχει ευκαιρία ότι ο παραλήπτης λαμβάνει δύο αντίγραφα του ίδιου μηνύματος, ο παραλήπτης πρέπει να αποκρύψετε διπλότυπα μηνύματα. Μπορείτε να αποκρύψετε διπλότυπες τιμές με τον ίδιο τρόπο που περιγράφεται για ενεργό αναπαραγωγής.

Σε γενικές γραμμές, παθητικές αναπαραγωγής είναι πιο οικονομικό από όσο ενεργό αναπαραγωγής, επειδή στις περισσότερες περιπτώσεις εκτελείται μόνο μία λειτουργία. Λανθάνων χρόνος, μετάδοσης και οικονομικό κόστος είναι ίδιο με το σενάριο μη αναπαραχθούν.

Όταν χρησιμοποιείτε παθητικό αναπαραγωγής, στα εξής σενάρια τα μηνύματα μπορεί να είναι χαθεί ή λάβει δύο φορές:

-   **Μήνυμα καθυστέρηση ή απώλεια**: λαμβάνεται ως δεδομένο ότι ο αποστολέας έστειλε με επιτυχία μια Μ1 μήνυμα στην κύρια ουρά και, στη συνέχεια, στην ουρά δεν είναι διαθέσιμη πριν ο παραλήπτης λαμβάνει Μ1. Ο αποστολέας στέλνει ένα μήνυμα επιβεβαίωσης m2 σε δευτερεύουσα ουρά. Εάν η κύρια ουρά είναι προσωρινά μη διαθέσιμος, ο παραλήπτης λαμβάνει Μ1 αφού ουρά θα είναι διαθέσιμο ξανά. Σε περίπτωση μια καταστροφή, ο παραλήπτης ενδέχεται να λάβετε ποτέ Μ1.

-   **Αναπαραγωγή υποδοχής**: λαμβάνεται ως δεδομένο ότι ο αποστολέας στέλνει ένα μήνυμα m στην κύρια ουρά. Υπηρεσία Bus επεξεργάζεται m με επιτυχία αλλά αποτύχει η αποστολή απόκρισης. Αφού η λειτουργία αποστολής λήγει το χρονικό όριο, ο αποστολέας στέλνει ένα πανομοιότυπο αντίγραφο της m σε δευτερεύουσα ουρά. Εάν ο παραλήπτης μπορεί να εμφανιστεί το πρώτο αντίγραφο της m πριν από την κύρια ουρά δεν είναι διαθέσιμη, ο παραλήπτης λαμβάνει και τα δύο αντίγραφα του π περίπου την ίδια στιγμή. Εάν ο παραλήπτης δεν είναι δυνατό να εμφανιστεί το πρώτο αντίγραφο της m πριν από την κύρια ουρά δεν είναι διαθέσιμη, ο παραλήπτης λαμβάνει αρχικά μόνο το δεύτερο αντίγραφο του π, αλλά, στη συνέχεια, λαμβάνει ένα δεύτερο αντίγραφο του π, όταν η κύρια ουρά θα είναι διαθέσιμο.

Το δείγμα [παν-αλληλεπίδραση με τα μηνύματα όπου μεσολαβούν Bus υπηρεσία][] παρουσιάζει παθητικές αναπαραγωγής του μηνυμάτων οντοτήτων.

## <a name="next-steps"></a>Επόμενα βήματα

Για να μάθετε περισσότερα σχετικά με την αποκατάσταση, ανατρέξτε στα εξής άρθρα:

- [Συνεχής λειτουργία βάσης δεδομένων Azure SQL][]
- [Τεχνική καθοδήγηση ανοχή του Azure][]

  [Έλεγχος ταυτότητας Bus υπηρεσίας]: service-bus-authentication-and-authorization.md
  [Διαμερίσματα οντοτήτων ανταλλαγής μηνυμάτων]: service-bus-partitioning.md
  [Ασύγχρονη μοτίβα ανταλλαγής μηνυμάτων και υψηλή διαθεσιμότητα]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
  [Παν-αλληλεπίδραση με υπηρεσία Bus αναμετάδοση μηνυμάτων]: http://code.msdn.microsoft.com/Geo-replication-with-16dbfecd
  [BrokeredMessage.MessageId]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.messageid.aspx
  [BrokeredMessage.Label]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.label.aspx
  [Παν-αλληλεπίδραση με υπηρεσία Bus όπου μεσολαβούν μηνυμάτων]: http://code.msdn.microsoft.com/Geo-replication-with-f5688664
  [Συνεχής λειτουργία βάσης δεδομένων Azure SQL]: ../sql-database/sql-database-business-continuity.md
  [Τεχνική καθοδήγηση ανοχή του Azure]: ../resiliency/resiliency-technical-guidance.md
