<properties 
    pageTitle="Υπηρεσία Bus σύζευξη πεδία ονομάτων | Microsoft Azure"
    description="Λεπτομέρειες υλοποίησης ζεύγη χώρο ονομάτων και το κόστος"
    services="service-bus"
    documentationCenter="na"
    authors="sethmanheim"
    manager="timlt"
    editor="" /> 
<tags 
    ms.service="service-bus"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="na"
    ms.date="10/04/2016"
    ms.author="sethm" />

# <a name="paired-namespace-implementation-details-and-cost-implications"></a>Σύζευξη λεπτομέρειες υλοποίησης χώρο ονομάτων και κόστους συνέπειες

Η μέθοδος [PairNamespaceAsync][] , χρησιμοποιώντας μια παρουσία [SendAvailabilityPairedNamespaceOptions][] , εκτελεί εργασίες ορατό για λογαριασμό σας. Επειδή είναι το κόστος ζητήματα κατά τη χρήση της δυνατότητας, είναι χρήσιμο να κατανοήσετε αυτές τις εργασίες, ώστε να αναμένετε τη συμπεριφορά όταν συμβαίνει αυτό. Το API πραγματοποιεί τα εξής συμπεριφορά αυτόματης για λογαριασμό σας:

-   Δημιουργία της λίστας εκκρεμοτήτων ουρές.
-   Η δημιουργία ενός αντικειμένου [MessageSender][] που ακρόασης ουρές ή τα θέματα.
-   Όταν μια οντότητα ανταλλαγής μηνυμάτων δεν είναι διαθέσιμη, στέλνει ping μηνύματα στην οντότητα σε μια προσπάθεια για τον εντοπισμό όταν αυτή η οντότητα γίνεται διαθέσιμη ξανά.
-   Προαιρετικά, δημιουργεί ενός συνόλου "αντλίες μήνυμα" που μετακίνηση μηνυμάτων από τη λίστα εκκρεμοτήτων ουρές στις πρωτεύοντος ουρές.
-   Συντεταγμένες κλεισίματος/ελαττωματική των παρουσιών [MessagingFactory][] κύριας και δευτερεύουσας.

Σε υψηλό επίπεδο, η δυνατότητα λειτουργεί ως εξής: όταν η κύρια οντότητα είναι σε καλή κατάσταση, χωρίς αλλαγή συμπεριφοράς προκύψει. Κατά τη διάρκεια [FailoverInterval][] παύσης και την κύρια οντότητα ορατή δεν επιτυχής αποστέλλει μετά από μια μη μεταβατική [MessagingException][] ή μια [TimeoutException][], παρουσιάζεται η ακόλουθη συμπεριφορά:

1.  Αποστολή λειτουργιών, για να την κύρια οντότητα είναι απενεργοποιημένες και το σύστημα κάνει ping την κύρια οντότητα μέχρι να ping που μπορεί να παραδοθεί με επιτυχία.

2.  Μια τυχαία λίστα εκκρεμοτήτων ουρά είναι επιλεγμένο.

3.  Αντικείμενα [BrokeredMessage][] δρομολογούνται στην ουρά επιλεγμένη λίστα εκκρεμοτήτων.

1.  Εάν αποτύχει μια λειτουργία αποστολή στην επιλεγμένη λίστα εκκρεμοτήτων ουρά, τα μηνύματα μεταφέρονται ουρά από την περιστροφή και μια νέα ουρά είναι επιλεγμένο. Μάθετε όλους τους αποστολείς στην παρουσία [MessagingFactory][] της αποτυχίας.

Οι παρακάτω εικόνες απεικονίζουν την ακολουθία. Πρώτα, ο αποστολέας στέλνει μηνύματα.

![Ζεύγη οι χώροι ονομάτων][0]

Περίπτωση αποτυχίας για να στείλετε την κύρια ουρά, ο αποστολέας αρχίζει να στέλνει μηνύματα σε μια ουρά τυχαία επιλεγμένη λίστα εκκρεμοτήτων. Ταυτόχρονα, ξεκινά μια εργασία ping.

![Ζεύγη οι χώροι ονομάτων][1]

Σε αυτό το σημείο τα μηνύματα εξακολουθούν να υπάρχουν στο δευτερεύον ουρά και δεν έχουν παραδοθεί στην κύρια ουρά. Όταν η κύρια ουρά είναι σε καλή κατάσταση ξανά, τουλάχιστον μία διαδικασία πρέπει να εκτελεί το syphon. Η syphon παρέχει τα μηνύματα από όλες τις διάφορες ουρές λίστας εκκρεμοτήτων στα πρόσωπα proper προορισμού (ουρές και θέματα).

![Ζεύγη οι χώροι ονομάτων][2]

Το υπόλοιπο της αυτό το θέμα περιγράφει τις συγκεκριμένες λεπτομέρειες του τρόπου λειτουργίας των αυτά τα τμήματα.

## <a name="creation-of-backlog-queues"></a>Δημιουργία της λίστας εκκρεμοτήτων ουρές

Το αντικείμενο [SendAvailabilityPairedNamespaceOptions][] που του μεταβιβάστηκε η μέθοδος [PairNamespaceAsync][] υποδεικνύει τον αριθμό των λίστας εκκρεμοτήτων ουρές που θέλετε να χρησιμοποιήσετε. Κάθε λίστα εκκρεμοτήτων, στη συνέχεια, δημιουργείται ουρά με τις ακόλουθες ιδιότητες ρητά σύνολο (όλες οι υπόλοιπες τιμές έχουν οριστεί τις προεπιλογές [QueueDescription][] ):

| Διαδρομή                                   | [πρωτεύοντα χώρο ονομάτων] / x-servicebus-μεταφορά / [ευρετήριο] όπου [ευρετήριο] είναι μια τιμή στο [0, BacklogQueueCount) |
|----------------------------------------|------------------------------------------------------------------------------------------------------|
| MaxSizeInMegabytes                     | 5120                                                                                                 |
| MaxDeliveryCount                       | σύνδεσης MaxValue                                                                                         |
| DefaultMessageTimeToLive               | TimeSpan.MaxValue                                                                                    |
| AutoDeleteOnIdle                       | TimeSpan.MaxValue                                                                                    |
| LockDuration                           | 1 λεπτό                                                                                             |
| EnableDeadLetteringOnMessageExpiration | TRUE                                                                                                 |
| EnableBatchedOperations                | TRUE                                                                                                 |

Για παράδειγμα, την πρώτη ουρά λίστας εκκρεμοτήτων δημιουργήσατε για το χώρο ονομάτων **contoso** ονομάζεται `contoso/x-servicebus-transfer/0`.

Κατά τη δημιουργία του ουρές, τον κωδικό πρώτα ελέγχει εάν υπάρχει μια τέτοια ουρά. Εάν δεν υπάρχει στην ουρά, τότε δημιουργείται ουρά. Ο κωδικός δεν εκκαθάριση ουρές "επιπλέον" λίστας εκκρεμοτήτων. Συγκεκριμένα, εάν η εφαρμογή με το χώρο ονομάτων πρωτεύοντος **contoso** αιτήσεις πέντε λίστας εκκρεμοτήτων ουρές αλλά μια λίστα εκκρεμοτήτων ουρά με τη διαδρομή `contoso/x-servicebus-transfer/7` υπάρχει, ουρά επιπλέον λίστας εκκρεμοτήτων εξακολουθούν να υπάρχουν αλλά δεν χρησιμοποιείται. Το σύστημα επιτρέπει ρητά ουρές επιπλέον λίστας εκκρεμοτήτων υπάρχει που δεν μπορεί να χρησιμοποιηθεί. Ως κάτοχος χώρο ονομάτων, είστε υπεύθυνοι για την εκκαθάριση ουρές που δεν χρησιμοποιούνται/ανεπιθύμητα λίστας εκκρεμοτήτων. Ο λόγος για αυτή την απόφαση είναι ότι Bus υπηρεσίας δεν είναι δυνατό να γνωρίζουν τι σκοπούς υπάρχουν για όλες τις ουρές στο σας ονομάτων. Επιπλέον, εάν μια ουρά υπάρχει με το όνομα που δόθηκε, αλλά δεν πληροί τη θεωρούμενη [QueueDescription][], στη συνέχεια, σας τους λόγους είναι το δικό για να αλλάξετε την προεπιλεγμένη συμπεριφορά σας. Χωρίς τις εγγυήσεις πραγματοποιούνται για τροποποιήσεις στις ουρές λίστας εκκρεμοτήτων από τον κωδικό. Φροντίστε να ελέγξετε προσεκτικά τις αλλαγές σας.

## <a name="custom-messagesender"></a>Προσαρμοσμένη MessageSender

Κατά την αποστολή, επιλέξτε όλα τα μηνύματα μέσω του εσωτερικού αντικειμένου [MessageSender][] που συμπεριφέρεται κανονικά όταν όλα τα στοιχεία λειτουργεί και ανακατευθύνει στις ουρές λίστας εκκρεμοτήτων όταν πράγματα "break." Κατά τη λήψη μιας αποτυχίας μη μεταβατική, ξεκινά χρονοδιακόπτη. Μετά την τελεία [χρονικό διάστημα][] που αποτελείται από την τιμή της ιδιότητας [FailoverInterval][] κατά τις οποίες δεν επιτυχής μηνύματα αποστέλλονται, του εφεδρικού έχει αναλάβει. Σε αυτό το σημείο, τα εξής στοιχεία συμβεί για κάθε οντότητα:

- Μια εργασία ping εκτελεί κάθε [PingPrimaryInterval][] για να ελέγξετε εάν η οντότητα είναι διαθέσιμη. Όταν ολοκληρωθεί με επιτυχία αυτήν την εργασία, όλο το κώδικα προγράμματος-πελάτη που χρησιμοποιεί η οντότητα αμέσως ξεκινά αποστολή νέων μηνυμάτων στο κύριο χώρο ονομάτων.

- Μελλοντικές αιτήσεις για να στείλετε σε αυτήν την ίδια οντότητα από οποιοδήποτε άλλο αποστολείς θα έχει ως αποτέλεσμα το [BrokeredMessage][] που στέλνεται να τροποποιηθούν θα καθίσετε σε ουρά λίστας εκκρεμοτήτων. Η τροποποίηση καταργεί ορισμένες ιδιότητες του αντικειμένου [BrokeredMessage][] και τις αποθηκεύει σε κάποιο άλλο σημείο. Οι ακόλουθες ιδιότητες είναι απενεργοποιημένο και προστίθενται στην περιοχή ένα νέο ψευδώνυμο, επιτρέποντάς Bus υπηρεσίας και το SDK για την επεξεργασία μηνυμάτων ομοιόμορφα:

| Παλιό όνομα ιδιότητας       | Νέο όνομα ιδιότητας |
|-------------------------|-------------------|
| Αναγνωριστικό περιόδου λειτουργίας               | x-ms-αναγνωριστικό περιόδου λειτουργίας    |
| Το TimeToLive              | x-ms-το timetolive   |
| ScheduledEnqueueTimeUtc | x-ms-διαδρομή         |

Η αρχική διαδρομή προορισμού αποθηκεύεται επίσης εντός του μηνύματος ως ιδιότητα με το όνομα x-ms-path. Αυτός ο σχεδιασμός επιτρέπει μηνύματα για πολλές οντοτήτων συνύπαρξη σε μία μόνο λίστα εκκρεμοτήτων ουρά. Οι ιδιότητες είναι μεταφράζεται πίσω από το syphon.

Το προσαρμοσμένο αντικείμενο [MessageSender][] μπορεί να προκύψουν ζητήματα όταν τα μηνύματα προσεγγίσετε το όριο των 256 KB και έχει αναλάβει ανακατεύθυνσης. Το προσαρμοσμένο αντικείμενο [MessageSender][] αποθηκεύει μηνύματα για όλες τις ουρές και θέματα μαζί στις ουρές λίστας εκκρεμοτήτων. Αυτό το αντικείμενο Αναμιγνύει μηνύματα από πολλά βασικά χρώματα μαζί μέσα στις ουρές λίστας εκκρεμοτήτων. Για να χειριστείτε ανάμεσα σε πολλούς υπολογιστές-πελάτες που δεν γνωρίζετε μεταξύ τους εξισορρόπησης φόρτου, το SDK συλλογών τυχαία μία λίστα εκκρεμοτήτων ουρά για κάθε [QueueClient][] ή [TopicClient][] δημιουργείτε στον κώδικα.

## <a name="pings"></a>Ping που

Ένα μήνυμα ping είναι ένα κενό [BrokeredMessage][] με την ιδιότητα [ContentType][] έχει οριστεί σε εφαρμογή/vnd.ms-servicebus-ping και [το TimeToLive][] τιμή 1 δευτερόλεπτο. Αυτή η εντολή ping έχει ένα ειδικό χαρακτηριστικό στην υπηρεσία Bus: ο διακομιστής προσφέρει ποτέ μια εντολή ping όταν οποιαδήποτε καλούντος ζητά ένα [BrokeredMessage][]. Έτσι, έχετε ποτέ για να μάθετε πώς να λαμβάνει και να παραβλέψετε αυτά τα μηνύματα. Κάθε οντότητα (μοναδικό ουρά ή θέμα) ανά παρουσία [MessagingFactory][] ανά προγράμματος-πελάτη θα είναι πραγματοποίησαν ping, όταν θεωρείται ότι είναι να μην είναι διαθέσιμη. Από προεπιλογή, αυτό συμβαίνει μία φορά ανά λεπτό. Μηνύματα ping θεωρούνται κανονική Bus υπηρεσίας μηνύματα και μπορεί να έχει ως αποτέλεσμα χρεώσεις για τα μηνύματα και το εύρος ζώνης. Μόλις οι υπολογιστές-πελάτες εντοπίσει ότι το σύστημα είναι διαθέσιμο, διακόψτε τα μηνύματα.

## <a name="the-syphon"></a>Το syphon

Τουλάχιστον μία εκτελέσιμο πρόγραμμα στην εφαρμογή θα πρέπει να ενεργά εκτελεί το syphon. Το syphon εκτελεί μια μεγάλη ψηφοφορίας λαμβάνουν που διαρκεί 15 λεπτά. Όταν είναι διαθέσιμες όλες οντοτήτων και έχετε 10 λίστας εκκρεμοτήτων ουρές, την εφαρμογή που φιλοξενεί το syphon καλεί η λειτουργία λήψης 40 ώρες ανά ώρα, 960 ωρών ανά ημέρα και 28800 φορές 30 ημέρες. Όταν το syphon ενεργά μεταφορά μηνυμάτων από τη λίστα εκκρεμοτήτων στην κύρια ουρά, κάθε μήνυμα αντιμετωπίζει τις παρακάτω χρεώσεις (τυπικές χρεώσεις για το μέγεθος του μηνύματος και το εύρος ζώνης που εφαρμόζεται σε όλα τα στάδια):

1.  Αποστολή του λίστας εκκρεμοτήτων.

2.  Έχετε λάβει από τη λίστα εκκρεμοτήτων.

3.  Αποστολή των κύριων.

4.  Έχετε λάβει από την κύρια.

## <a name="closefault-behavior"></a>Κλείσιμο/σφαλμάτων συμπεριφορά

Μέσα σε μια εφαρμογή που φιλοξενεί το syphon, μία φορά το πρωτεύον ή δευτερεύον [MessagingFactory][] σφάλματα ή είναι κλειστό χωρίς το συνεργάτη επίσης να παρουσιάσει σφάλμα/Κλείσιμο και το syphon εντοπίζει αυτήν την κατάσταση, πράξεων syphon. Εάν δεν είναι κλειστό τα άλλα [MessagingFactory][] μέσα σε 5 δευτερόλεπτα, το syphon θα βλάβης το άνοιγμα εξακολουθεί να [MessagingFactory][].

## <a name="next-steps"></a>Επόμενα βήματα

Ανατρέξτε στο θέμα [ασύγχρονης μοτίβα ανταλλαγής μηνυμάτων και υψηλής διαθεσιμότητας][] για μια λεπτομερή ανάλυση του Bus υπηρεσία ασύγχρονης μηνυμάτων. 

  [PairNamespaceAsync]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingfactory.pairnamespaceasync.aspx
  [SendAvailabilityPairedNamespaceOptions]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions.aspx
  [MessageSender]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagesender.aspx
  [MessagingFactory]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingfactory.aspx
  [FailoverInterval]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.pairednamespaceoptions.failoverinterval.aspx
  [MessagingException]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingexception.aspx
  [TimeoutException]: https://msdn.microsoft.com/library/azure/system.timeoutexception.aspx
  [BrokeredMessage]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.aspx
  [QueueDescription]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.queuedescription.aspx
  [Χρονικό διάστημα]: https://msdn.microsoft.com/library/azure/system.timespan.aspx
  [PingPrimaryInterval]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions.pingprimaryinterval.aspx
  [QueueClient]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.queueclient.aspx
  [TopicClient]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.topicclient.aspx
  [ContentType]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.contenttype.aspx
  [Το TimeToLive]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.timetolive.aspx
  [Ασύγχρονη μοτίβα ανταλλαγής μηνυμάτων και υψηλή διαθεσιμότητα]: service-bus-async-messaging.md
  [0]: ./media/service-bus-paired-namespaces/IC673405.png
  [1]: ./media/service-bus-paired-namespaces/IC673406.png
  [2]: ./media/service-bus-paired-namespaces/IC673407.png
