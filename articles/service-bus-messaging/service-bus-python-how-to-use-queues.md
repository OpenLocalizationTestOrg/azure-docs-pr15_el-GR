<properties 
    pageTitle="Πώς μπορείτε να χρησιμοποιήσετε ουρές Bus υπηρεσίας με Python | Microsoft Azure" 
    description="Μάθετε πώς μπορείτε να χρησιμοποιήσετε ουρές Azure Service Bus από Python." 
    services="service-bus" 
    documentationCenter="python" 
    authors="sethmanheim" 
    manager="timlt" 
    editor=""/>

<tags 
    ms.service="service-bus" 
    ms.workload="na" 
    ms.tgt_pltfrm="na" 
    ms.devlang="python" 
    ms.topic="article" 
    ms.date="09/21/2016" 
    ms.author="sethm;lmazuel"/>


# <a name="how-to-use-service-bus-queues"></a>Πώς μπορείτε να χρησιμοποιήσετε ουρές Bus υπηρεσίας

[AZURE.INCLUDE [service-bus-selector-queues](../../includes/service-bus-selector-queues.md)]

Σε αυτό το άρθρο περιγράφει τον τρόπο χρήσης της υπηρεσίας Bus ουρές. Τα δείγματα είναι γραμμένες σε Python και χρησιμοποιήστε το [πακέτο Python Azure Service Bus][]. Τα σενάρια καλύπτεται περιλαμβάνουν **τη δημιουργία ουρές, αποστολή και λήψη μηνυμάτων**και **τη διαγραφή ουρές**.

[AZURE.INCLUDE [howto-service-bus-queues](../../includes/howto-service-bus-queues.md)]

> [AZURE.NOTE] Για να εγκαταστήσετε Python ή το [πακέτο Python Azure Service Bus][], ανατρέξτε στον [Οδηγό εγκατάστασης Python](../python-how-to-install.md).

## <a name="create-a-queue"></a>Δημιουργία ουράς

Το αντικείμενο **ServiceBusService** σάς επιτρέπει να εργαστείτε με ουρές. Προσθέστε τον ακόλουθο κώδικα κοντά στο επάνω μέρος οποιουδήποτε αρχείου Python στην οποία θέλετε να πρόσβαση μέσω προγραμματισμού Bus υπηρεσίας:

```
from azure.servicebus import ServiceBusService, Message, Queue
```

Ο ακόλουθος κώδικας δημιουργεί ένα αντικείμενο **ServiceBusService** . Αντικατάσταση `mynamespace`, `sharedaccesskeyname`, και `sharedaccesskey` με το χώρο ονομάτων, κοινόχρηστη πρόσβαση όνομα κλειδιού υπογραφής (συσχετισμών Ασφαλείας) και τιμή.

```
bus_service = ServiceBusService(
    service_namespace='mynamespace',
    shared_access_key_name='sharedaccesskeyname',
    shared_access_key_value='sharedaccesskey')
```

Τις τιμές για το όνομα του κλειδιού συσχετισμών Ασφαλείας και τιμή μπορείτε να βρείτε τις πληροφορίες σύνδεσης [Azure κλασική πύλη][] ή στο παράθυρο Visual Studio **ιδιοτήτων** κατά την επιλογή χώρου ονομάτων Bus υπηρεσίας στην Εξερεύνηση Server (όπως φαίνεται στην προηγούμενη ενότητα).

```
bus_service.create_queue('taskqueue')
```

**create_queue** υποστηρίζει επίσης πρόσθετες επιλογές, οι οποίες σας επιτρέπουν να Παράκαμψη προεπιλεγμένων ρυθμίσεων ουρά όπως μήνυμα διάρκεια ζωής (TTL) ή ουρά μέγιστο μέγεθος. Το παρακάτω παράδειγμα ρυθμίζει το μέγεθος της μέγιστο ουρά 5GB και την τιμή TTL 1 λεπτό:

```
queue_options = Queue()
queue_options.max_size_in_megabytes = '5120'
queue_options.default_message_time_to_live = 'PT1M'

bus_service.create_queue('taskqueue', queue_options)
```

## <a name="send-messages-to-a-queue"></a>Αποστολή μηνυμάτων σε μια ουρά

Για να στείλετε ένα μήνυμα σε μια υπηρεσία Bus ουρά, οι κλήσεις σας εφαρμογή το **Αποστολή\_ουρά\_μήνυμα** μέθοδος στο αντικείμενο **ServiceBusService** .

Το παρακάτω παράδειγμα παρουσιάζει πώς μπορείτε να στείλετε ένα δοκιμαστικό μήνυμα στην ουρά με το όνομα *taskqueue χρησιμοποιώντας* **Αποστολή\_ουρά\_μήνυμα**:

```
msg = Message(b'Test Message')
bus_service.send_queue_message('taskqueue', msg)
```

Υπηρεσία Bus ουρές υποστηρίζουν μέγιστο μέγεθος αρχείου των 256 KB η [τυπική σειρά](service-bus-premium-messaging.md) και 1 MB στο [επίπεδο Premium](service-bus-premium-messaging.md). Την επικεφαλίδα, η οποία περιλαμβάνει τις ιδιότητες τυπικών και προσαρμοσμένων εφαρμογών, μπορεί να έχει ένα μέγιστο μέγεθος των 64 KB. Υπάρχει όριο στον αριθμό των μηνυμάτων που θα διατηρούνται σε ουρά, αλλά υπάρχει μια καπέλο το συνολικό μέγεθος των μηνυμάτων που διαθέτει μια ουρά. Αυτό το μέγεθος ουρά ορίζεται κατά τη δημιουργία, με ένα ανώτερο όριο των 5 GB. Για περισσότερες πληροφορίες σχετικά με τα όρια, ανατρέξτε στο θέμα [όρια Bus υπηρεσίας][].

## <a name="receive-messages-from-a-queue"></a>Λήψη μηνυμάτων από μια ουρά

Γίνεται λήψη των μηνυμάτων από μια ουρά με τη χρήση του **Λήψη\_ουρά\_μήνυμα** μέθοδος στο αντικείμενο **ServiceBusService** :

```
msg = bus_service.receive_queue_message('taskqueue', peek_lock=False)
print(msg.body)
```

Μηνύματα διαγράφονται από την ουρά όπως διαβάζονται όταν η παράμετρος **Σύνοψη\_κλείδωμα** έχει οριστεί στην **τιμή False**. Μπορείτε να διαβάσετε (σύνοψη) και να κλειδώσετε το μήνυμα χωρίς να το διαγράψετε από την ουρά, ορίζοντας την παράμετρο **Σύνοψη\_κλείδωμα** στην **τιμή True**.

Η συμπεριφορά της ανάγνωσης και τη διαγραφή του μηνύματος ως μέρος του η λειτουργία λήψης είναι απλούστερο μοντέλο και λειτουργεί καλύτερα για σενάρια στις οποίες μια εφαρμογή μπορεί να αποδεχτεί τις δεν επεξεργασία ενός μηνύματος σε περίπτωση αποτυχίας. Για να κατανοήσετε αυτήν, εξετάστε το ενδεχόμενο να ένα σενάριο που ζητήματα της αίτησης λήψης του καταναλωτή και, στη συνέχεια, παρουσιάζει σφάλμα πριν από την επεξεργασία του. Επειδή η υπηρεσία Bus θα έχουν σήμανση του μηνύματος ως που καταναλώνεται, στη συνέχεια, όταν η εφαρμογή επανεκκίνηση του και αρχίζει κατανάλωση ξανά τα μηνύματα, το θα έχετε παραβλέψει το μήνυμα που καταναλώθηκε πριν από το σφάλμα.

Εάν το **Σύνοψη\_κλείδωμα** η παράμετρος έχει οριστεί στην **τιμή True**, η λήψη γίνεται μια λειτουργία δύο στάδιο, γεγονός που επιτρέπει σε εφαρμογές υποστήριξης που δεν θέλετε να γίνει μηνύματα που λείπουν. Όταν Bus υπηρεσία λαμβάνει μια αίτηση, βρίσκει στο επόμενο μήνυμα να καταναλωθεί, κλειδώνει για να αποτρέψετε άλλους καταναλωτές πραγματοποιεί λήψη του και, στη συνέχεια, επιστρέφει το στην εφαρμογή. Μετά την εφαρμογή ολοκληρώσει την επεξεργασία του μηνύματος (ή αποθηκεύει αξιόπιστα για μελλοντική επεξεργασία), ολοκληρώνει δεύτερου σταδίου της διαδικασίας παραλαβής καλώντας τη μέθοδο **Διαγραφή** στο **μήνυμα** αντικείμενο. Η μέθοδος **Διαγραφή** θα επισημάνετε το μήνυμα ως που καταναλώνεται και να την καταργήσετε από την ουρά.

```
msg = bus_service.receive_queue_message('taskqueue', peek_lock=True)
print(msg.body)

msg.delete()
```

## <a name="how-to-handle-application-crashes-and-unreadable-messages"></a>Πώς να χειριστείτε σφάλματα εφαρμογών και αναγνώσιμα μηνύματα

Υπηρεσία Bus παρέχει λειτουργικότητα που θα σας βοηθήσουν να ανακτήσετε ομαλά από σφάλματα στο εφαρμογής ή δυσκολίες επεξεργασία ενός μηνύματος. Εάν μια εφαρμογή ακουστικό είναι δυνατή η επεξεργασία του μηνύματος για κάποιο λόγο, στη συνέχεια, το να καλέσετε τη μέθοδο **ξεκλειδώσετε** στο αντικείμενο **μηνύματος** . Αυτό θα προκαλέσει Bus υπηρεσίας για να ξεκλειδώσετε το μήνυμα μέσα στην ουρά και να την κάνετε διαθέσιμη θα ληφθεί ξανά, με την ίδια εφαρμογή καταναλώνει ή από άλλη εφαρμογή καταναλώνει.

Υπάρχει επίσης ένα χρονικό όριο που σχετίζεται με ένα μήνυμα κλειδωμένο μέσα στην ουρά και, εάν η εφαρμογή δεν μπορεί να επεξεργαστεί το μήνυμα πριν από την κλείδωμα λήξει το χρονικό όριο (π.χ., εάν η εφαρμογή παρουσιάζει σφάλμα), στη συνέχεια, υπηρεσία Bus θα ξεκλειδώσετε αυτόματα το μήνυμα και να την κάνετε διαθέσιμη θα ληφθεί ξανά.

Σε περίπτωση που η εφαρμογή παρουσιάζει σφάλμα μετά την επεξεργασία του μηνύματος, αλλά πριν από την κλήση της μεθόδου **Διαγραφή** , στη συνέχεια, το μήνυμα θα είναι redelivered στην εφαρμογή κατά την επανεκκίνηση. Συχνά αυτό ονομάζεται **Τουλάχιστον αφού επεξεργασίας**, αυτό σημαίνει ότι θα υποβληθούν τουλάχιστον μία φορά σε κάθε μήνυμα αλλά σε ορισμένες περιπτώσεις ίσως redelivered το ίδιο μήνυμα. Εάν το σενάριο δεν θέλετε να γίνει διπλότυπων επεξεργασίας, στη συνέχεια, προγραμματιστές εφαρμογών πρέπει να Προσθήκη επιπλέον λογικής σε εφαρμογή τους χειρισμού διπλότυπων μήνυμα παράδοσης. Συχνά, αυτό είναι δυνατό χρησιμοποιώντας την ιδιότητα **αναγνωριστικού μηνύματος** του μηνύματος, η οποία θα παραμένει σταθερή κατά μήκος προσπαθειών παράδοσης.

## <a name="next-steps"></a>Επόμενα βήματα

Τώρα που μάθατε τα βασικά στοιχεία του ουρές Bus υπηρεσίας, ακολουθήστε αυτές τις συνδέσεις για να μάθετε περισσότερα.

-   Ανατρέξτε στο θέμα [ουρές, θέματα, και συνδρομών][].

[Azure κλασική πύλη]: https://manage.windowsazure.com
[Πακέτο Python Azure Service Bus]: https://pypi.python.org/pypi/azure-servicebus  
[Ουρές, θέματα και συνδρομών]: service-bus-queues-topics-subscriptions.md
[Υπηρεσία Bus ορίων]: service-bus-quotas.md
 
