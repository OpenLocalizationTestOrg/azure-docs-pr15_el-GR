<properties
   pageTitle="Μονάδα εξισορρόπησης φόρτου πολλών VIPs για Azure | Microsoft Azure"
   description="Επισκόπηση των πολλών VIPs στη μονάδα εξισορρόπησης φόρτου Azure"
   services="load-balancer"
   documentationCenter="na"
   authors="chkuhtz"
   manager="narayan"
   editor=""
/>
<tags
   ms.service="load-balancer"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="08/11/2016"
   ms.author="chkuhtz"
/>

# <a name="multiple-vips-for-azure-load-balancer"></a>Μονάδα εξισορρόπησης φόρτου πολλών VIPs για Azure

Azure πρόγραμμα εξισορρόπησης φόρτου σάς επιτρέπει να φορτώσετε υπηρεσίες υπολοίπου σε πολλαπλές θύρες, πολλές διευθύνσεις IP ή και τα δύο. Μπορείτε να χρησιμοποιήσετε δημόσια και εσωτερικών φόρτωσης εξισορρόπησης ορισμών για τη φόρτωση ροών υπολοίπου σε ένα σύνολο ΣΠΣ.

Σε αυτό το άρθρο περιγράφει τα βασικά στοιχεία της αυτό δυνατότητα σημαντικές έννοιες και τους περιορισμούς. Εάν σκοπεύετε να εκθέσετε υπηρεσίες σε μία διεύθυνση IP, μπορείτε να βρείτε απλοποιημένη οδηγίες για τη [δημόσια](load-balancer-get-started-internet-portal.md) ή [εσωτερικό](load-balancer-get-started-ilb-arm-portal.md) φόρτωση εξισορρόπησης ρυθμίσεις παραμέτρων. Προσθήκη πολλών VIPs είναι αυξάνονται σε μία μόνο ρύθμιση παραμέτρων VIP. Χρησιμοποιώντας τις έννοιες σε αυτό το άρθρο, μπορείτε να αναπτύξετε μια απλοποιημένη ρύθμιση παραμέτρων οποιαδήποτε στιγμή.

Όταν ορίζετε μια μονάδα εξισορρόπησης φόρτου Azure, ένα πρόγραμμα προσκηνίου και παρασκηνίου ρύθμιση παραμέτρων συνδέονται με κανόνες. Η δοκιμή του εύρυθμης λειτουργίας στα οποία γίνεται αναφορά από τον κανόνα χρησιμοποιείται για τον καθορισμό του τρόπου με τον οποίο ροών αποστέλλονται σε έναν κόμβο στο χώρο συγκέντρωσης παρασκηνίου. Το frontend ορίζεται από μια εικονική IP (VIP), που είναι μιας πλειάδας 3 που αποτελείται από μια διεύθυνση IP (δημόσια ή εσωτερικό), ένα πρωτόκολλο μεταφοράς (UDP ή TCP) και ένας αριθμός θύρας. Μια DIP είναι μια διεύθυνση IP σε μια Azure εικονικού NIC που έχουν επισυναφθεί σε μια Εικονική στο χώρο συγκέντρωσης παρασκηνίου.

Ο παρακάτω πίνακας περιέχει ορισμένες ρυθμίσεις παραμέτρων frontend παράδειγμα:

| VIP | Διεύθυνση IP | πρωτόκολλο | θύρα |
|-----|------------|----------|------|
|1|65.52.0.1|TCP|80|
|2|65.52.0.1|TCP|_8080_|
|3|65.52.0.1|_UDP_|80|
|4|_65.52.0.2_|TCP|80|

Ο πίνακας εμφανίζει τέσσερις διαφορετικές frontends. 1 # Frontends, #2 και #3 είναι ένα μεμονωμένο VIP με πολλαπλούς κανόνες. Χρησιμοποιείται η ίδια διεύθυνση IP αλλά τη θύρα ή το πρωτόκολλο είναι διαφορετικό για κάθε πρόγραμμα προσκηνίου. Frontends #1 και #4 είναι ένα παράδειγμα πολλών VIPs, όπου το ίδιο frontend πρωτόκολλο και τη θύρα χρησιμοποιούνται ξανά σε πολλές VIPs.

Azure πρόγραμμα εξισορρόπησης φόρτου παρέχει ευελιξία στον ορισμό το κανόνες εξισορρόπησης φόρτου. Ένας κανόνας δηλώνει πώς έχει αντιστοιχιστεί μια διεύθυνση και θύρα το frontend για τη διεύθυνση προορισμού και τη θύρα στον υπολογιστή στο παρασκήνιο. Έστω παρασκηνίου θύρες χρησιμοποιούνται ξανά σε κανόνες εξαρτάται από τον τύπο του κανόνα. Κάθε τύπος κανόνα έχει συγκεκριμένες απαιτήσεις που μπορούν να επηρεάσουν σχεδίαση ρύθμισης παραμέτρων και δοκιμή του κεντρικού υπολογιστή. Υπάρχουν δύο τύποι κανόνων:

1. Ο προεπιλεγμένος κανόνας με χωρίς επαναχρησιμοποίηση θύρα παρασκηνίου
2. Ο κανόνας αιωρούμενα IP όπου χρησιμοποιούνται ξανά θύρες παρασκηνίου

Azure πρόγραμμα εξισορρόπησης φόρτου σάς επιτρέπει να συνδυάσετε και οι δύο τύποι κανόνων στο την ίδια ρύθμιση παραμέτρων εξισορρόπησης φόρτου. Η εξισορρόπηση φόρτου να τις χρησιμοποιήσετε ταυτόχρονα για μια δεδομένη Εικονική ή οποιονδήποτε συνδυασμό, με την προϋπόθεση ότι έχετε συμμορφώνεται με τους περιορισμούς του κανόνα. Τον τύπο κανόνα που επιλέγετε εξαρτάται από τις απαιτήσεις της εφαρμογής σας και την πολυπλοκότητα της υποστήριξης, ότι η ρύθμιση παραμέτρων. Θα πρέπει να αξιολογήσετε ποιοι τύποι κανόνα είναι καλύτερη για δική σας περίπτωση.

Εξετάσουμε περαιτέρω αυτά τα σενάρια, ξεκινώντας με την προεπιλεγμένη συμπεριφορά.

## <a name="rule-type-1-no-backend-port-reuse"></a>Κανόνα τύπου #1: δεν υπάρχει επαναχρησιμοποίηση θύρα παρασκηνίου

![Εικόνα MultiVIP](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

Σε αυτό το σενάριο, η VIPs frontend έχουν ρυθμιστεί ως εξής:

| VIP | Διεύθυνση IP | πρωτόκολλο | θύρα |
|-----|------------|----------|------|
|![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) 1|65.52.0.1|TCP|80|
|![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) 2|*65.52.0.2*|TCP|80|

Το DIP είναι ο προορισμός της ροής των εισερχομένων. Στο χώρο συγκέντρωσης παρασκηνίου, κάθε Εικονική εκθέτει την επιθυμητή υπηρεσία σε μια θύρα μοναδικών τιμών σε μια DIP. Αυτή η υπηρεσία είναι συσχετισμένη με το πρόγραμμα στο προσκήνιο μέσω ενός ορισμού κανόνα.

Ορισμού δύο κανόνες:

| Ο κανόνας | Frontend χάρτη | Για να το χώρο συγκέντρωσης παρασκηνίου |
|------|--------------|-----------------|
| 1 | ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) VIP1:80 | ![στον υπολογιστή στο παρασκήνιο](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) DIP1:80, ![στον υπολογιστή στο παρασκήνιο](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) DIP2:80 |
| 2 | ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) VIP2:80 | ![στον υπολογιστή στο παρασκήνιο](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) DIP1:81, ![στον υπολογιστή στο παρασκήνιο](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) DIP2:81 |

Η ολοκλήρωση αντιστοίχιση σε μονάδα εξισορρόπησης φόρτου Azure τώρα είναι η εξής:

| Ο κανόνας | Διεύθυνση VIP IP | πρωτόκολλο | θύρα | Προορισμού | θύρα |
|------|----------------|----------|------|-----|------|
|![ο κανόνας](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) 1|65.52.0.1|TCP|80|Είναι ΜΙΚΡΌΤΕΡΟΙ διεύθυνση IP|80|
|![ο κανόνας](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) 2|65.52.0.2|TCP|80|Είναι ΜΙΚΡΌΤΕΡΟΙ διεύθυνση IP|81|

Κάθε κανόνας πρέπει να δημιουργήσουν μια ροή με ένα μοναδικό συνδυασμό διεύθυνση IP προορισμού και θύρα προορισμού. Αλλάζοντας τη θύρα προορισμού της ροής της, πολλούς κανόνες να παραδώσετε ροών το ίδιο DIP σε διαφορετικές θύρες.

Εύρυθμη λειτουργία καθετήρες πάντα απευθύνονται σε το DIP από μια Εικονική. Θα πρέπει να εξασφαλίσετε που ότι σας δοκιμή του απεικονίζει την εύρυθμη λειτουργία της η Εικονική.

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a>Κανόνα τύπου #2: εκ νέου χρήση θύρας παρασκηνίου χρησιμοποιώντας το κινούμενο IP

Azure εξισορρόπηση φόρτου παρέχει την ευελιξία να χρησιμοποιήσετε εκ νέου τη θύρα frontend σε πολλές VIPs ανεξάρτητα από τον τύπο κανόνα που χρησιμοποιείται. Επιπλέον, ορισμένα σενάρια εφαρμογής προτιμάτε ή απαιτούν την ίδια θύρα θα χρησιμοποιηθεί από πολλών παρουσιών της εφαρμογής σε μια μεμονωμένη Εικονική στο χώρο συγκέντρωσης παρασκηνίου. Συνηθισμένα παραδείγματα εκ νέου χρήση θύρας περιλαμβάνουν σύμπλεγμα για υψηλή διαθεσιμότητα, δικτύου εικονικού συσκευές και εκθέσετε πολλών τελικά σημεία TLS χωρίς εκ νέου κρυπτογράφησης.

Εάν θέλετε να χρησιμοποιήσετε εκ νέου τη θύρα παρασκηνίου σε πολλούς κανόνες, πρέπει να ενεργοποιήσετε αιωρούμενα IP στον ορισμό του κανόνα.

Αιωρούμενα IP είναι ένα τμήμα του που είναι γνωστό ως άμεσο διακομιστής επιστρέψετε (DSR). DSR αποτελείται από δύο μέρη: μια τοπολογία ροής και ένα διευθύνσεων IP του συνδυασμού αντιστοίχισης. Σε ένα επίπεδο πλατφόρμας, Azure εξισορρόπηση φόρτου λειτουργεί πάντα σε μια τοπολογία ροής DSR ανεξάρτητα από το αν το κινούμενο IP είναι ενεργοποιημένο ή όχι. Αυτό σημαίνει ότι το εξερχόμενο τμήμα μιας ροής είναι πάντα σωστά επανεγγραφή ροή απευθείας προς την προέλευση.

Με το προεπιλεγμένο τύπο κανόνα, Azure εκθέτει μια παραδοσιακή φόρτωση εξισορρόπηση συνδυασμό αντιστοίχισης διευθύνσεων IP για μεγαλύτερη ευκολία στη χρήση. Ενεργοποίηση αιωρούμενα IP αλλάζει το συνδυασμό αντιστοίχισης διευθύνσεων IP για να επιτρέψετε για πρόσθετη ευελιξία, όπως περιγράφεται παρακάτω.

Το παρακάτω διάγραμμα παρουσιάζει αυτήν τη ρύθμιση παραμέτρων:

![Εικόνα MultiVIP](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

Για αυτό το σενάριο, κάθε Εικονική στο χώρο συγκέντρωσης παρασκηνίου περιλαμβάνει τρία διασυνδέσεις δικτύου:

* DIP: μια εικονική NIC που σχετίζεται με την εικονική Μηχανή (του Azure NIC πόρου)
* VIP1: βρόχος επιστροφής περιβάλλον εργασίας μέσα σε λειτουργικό σύστημα που έχει ρυθμιστεί με τη διεύθυνση IP του VIP1 επισκέπτη
* VIP2: βρόχος επιστροφής περιβάλλον εργασίας μέσα σε λειτουργικό σύστημα που έχει ρυθμιστεί με τη διεύθυνση IP του VIP2 επισκέπτη

>[AZURE.IMPORTANT] Η ρύθμιση παραμέτρων για τη λογική που εκτελείται εντός του επισκέπτη OS. Αυτή η ρύθμιση παραμέτρων δεν έχει πραγματοποιηθεί ή ελέγχονται από Azure. Χωρίς αυτήν τη ρύθμιση, οι κανόνες δεν θα λειτουργούν. Εύρυθμη λειτουργία των ορισμών δοκιμή του χρησιμοποιήστε το DIP η Εικονική αντί για τη λογική VIP. Επομένως, την υπηρεσία πρέπει να παρέχει απαντήσεις δοκιμή του σε μια θύρα DIP που αντικατοπτρίζουν την κατάσταση της υπηρεσίας που διέθετε κατά τη λογική VIP.

Ας υποθέσουμε ότι η ίδια ρύθμιση παραμέτρων frontend όπως στο προηγούμενο σενάριο:

| VIP | Διεύθυνση IP | πρωτόκολλο | θύρα |
|-----|------------|----------|------|
|![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) 1|65.52.0.1|TCP|80|
|![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) 2|*65.52.0.2*|TCP|80|

Ορισμού δύο κανόνες:

| Ο κανόνας | Frontend χάρτη | Για να το χώρο συγκέντρωσης παρασκηνίου |
|------|--------------|-----------------|
| 1 | ![ο κανόνας](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) VIP1:80 | ![στον υπολογιστή στο παρασκήνιο](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) VIP1:80 (σε VM1 και VM2) |
| 2 | ![ο κανόνας](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) VIP2:80 | ![στον υπολογιστή στο παρασκήνιο](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) VIP2:80 (σε VM1 και VM2) |

Ο παρακάτω πίνακας εμφανίζει την πλήρη αντιστοίχιση σε τη μονάδα εξισορρόπησης φόρτου:

| Ο κανόνας | Διεύθυνση VIP IP | πρωτόκολλο | θύρα | Προορισμού | θύρα |
|------|----------------|----------|------|-------------|------|
|![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) 1|65.52.0.1|TCP|80|ίδιο με VIP (65.52.0.1)|ίδιο με VIP (80)|
|![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) 2|65.52.0.2|TCP|80|ίδιο με VIP (65.52.0.2)|ίδιο με VIP (80)|

Ο προορισμός της ροής των εισερχομένων είναι η διεύθυνση VIP στο περιβάλλον εργασίας βρόχος επιστροφής σε η Εικονική. Κάθε κανόνας πρέπει να δημιουργήσουν μια ροή με ένα μοναδικό συνδυασμό διεύθυνση IP προορισμού και θύρα προορισμού. Αλλάζοντας τη διεύθυνση IP προορισμού της ροής της, εκ νέου χρήση θύρας είναι δυνατή σε το ίδιο Εικονική. Υπηρεσία εκτίθεται για τη μονάδα εξισορρόπησης φόρτου από συνδέοντας το με το VIP διεύθυνση IP και θύρα από τη διασύνδεση βρόχου αντίστοιχα.

Παρατηρήστε ότι αυτό το παράδειγμα δεν αλλάζει τη θύρα προορισμού. Παρόλο που αυτό είναι ένα σενάριο αιωρούμενα IP, Azure εξισορρόπηση φόρτου υποστηρίζει επίσης τον προσδιορισμό ενός κανόνα για να συντάξετε ξανά τη θύρα προορισμού παρασκηνίου και ώστε να είναι διαφορετική από τη θύρα προορισμού frontend.

Ο τύπος κανόνα αιωρούμενα IP είναι η βάση πολλές μοτίβα ρύθμισης παραμέτρων εξισορρόπησης φόρτου. Ένα παράδειγμα που είναι διαθέσιμη αυτήν τη στιγμή είναι η ρύθμιση παραμέτρων [SQL AlwaysOn με πολλές ακροατών](../virtual-machines/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) . Διάρκεια του χρόνου, έχουμε θα τεκμηριώσει περισσότερα από αυτά τα σενάρια.

## <a name="limitations"></a>Περιορισμοί

* Πολλές ρυθμίσεις παραμέτρων VIP υποστηρίζονται μόνο με IaaS ΣΠΣ.
* Με τον κανόνα αιωρούμενα IP, η εφαρμογή σας πρέπει να χρησιμοποιήσετε το DIP για ροές εξερχόμενων. Εάν η εφαρμογή σας συνδέεται με την διεύθυνση VIP έχει ρυθμιστεί στο περιβάλλον εργασίας βρόχος επιστροφής σε επισκέπτης λειτουργικό σύστημα, στη συνέχεια, δεν είναι διαθέσιμη για να συντάξετε ξανά τη ροή εξερχομένων SNAT και αποτυγχάνει της ροής.
* Δημόσιες διευθύνσεις IP έχουν ένα εφέ σε χρέωση. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [τις τιμές διεύθυνση IP](https://azure.microsoft.com/pricing/details/ip-addresses/)
* Ισχύουν όρια συνδρομής. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [όρια υπηρεσίας](../azure-subscription-service-limits.md#networking-limits) για λεπτομέρειες.
