<properties
  pageTitle="Φόρτωση προσαρμοσμένης καθετήρες εξισορρόπησης και παρακολούθηση κατάστασης εύρυθμης λειτουργίας | Microsoft Azure"
  description="Μάθετε πώς να χρησιμοποιείτε προσαρμοσμένο καθετήρες για Azure εξισορρόπηση φόρτου για την παρακολούθηση της παρουσίες πίσω από εξισορρόπηση φόρτου"
  services="load-balancer"
  documentationCenter="na"
  authors="sdwheeler"
  manager="carmonm"
  editor=""
  tags="azure-resource-manager"
/>
<tags
  ms.service="load-balancer"
  ms.devlang="na"
  ms.topic="article"
  ms.tgt_pltfrm="na"
  ms.workload="infrastructure-services"
  ms.date="10/24/2016"
  ms.author="sewhee" />

# <a name="understand-load-balancer-probes"></a>Κατανόηση των καθετήρες εξισορρόπησης φόρτου

Azure εξισορρόπηση φόρτου προσφέρει τη δυνατότητα να παρακολουθεί την εύρυθμη λειτουργία των παρουσιών διακομιστή χρησιμοποιώντας καθετήρες. Όταν μια δοκιμή του δεν ανταποκρίνεται, εξισορρόπηση φόρτου διακόπτει την αποστολή νέες συνδέσεις για να την παρουσία κατεστραμμένες. Δεν επηρεάζονται οι υπάρχουσες συνδέσεις, και νέες συνδέσεις αποστέλλονται σε καλή κατάσταση παρουσίες.

Ρόλοι υπηρεσία cloud (ρόλους εργασίας και web) Χρησιμοποιήστε έναν παράγοντα επισκέπτη για την παρακολούθηση δοκιμή του. TCP ή HTTP προσαρμοσμένο καθετήρες πρέπει να ρυθμιστεί κατά τη χρήση εικονικές μηχανές πίσω από εξισορρόπηση φόρτου.

## <a name="understand-probe-count-and-timeout"></a>Κατανόηση των δοκιμή του πλήθους και του χρονικού ορίου

Δοκιμή του συμπεριφορά εξαρτάται:

- Ο αριθμός των επιτυχής καθετήρες που επιτρέπουν μια παρουσία να έχει τίτλο ως προς τα επάνω.
- Ο αριθμός των αποτυχημένων καθετήρες που προκαλούν μια παρουσία για να επισημαίνονται ως προς τα κάτω.

Το χρονικό όριο και συχνότητα τιμή που έχει οριστεί σε SuccessFailCount καθορίζουν εάν μια παρουσία επιβεβαιωθεί που θα εκτελείται ή δεν εκτελείται. Στην πύλη του Azure, το χρονικό όριο έχει οριστεί σε δύο φορές την τιμή της συχνότητας.

Η ρύθμιση παραμέτρων για δοκιμή του όλων των εμφανίσεων εξισορρόπηση φόρτου για ένα τελικό σημείο (δηλαδή, ένα σύνολο εξισορρόπηση φόρτου) πρέπει να είναι η ίδια. Αυτό σημαίνει ότι δεν μπορείτε να έχετε μια διαφορετική δοκιμή του ρύθμιση παραμέτρων για κάθε παρουσία ρόλο ή εικονική μηχανή στην ίδια φιλοξενούμενη υπηρεσία για ένα συνδυασμό συγκεκριμένο τελικού σημείου. Για παράδειγμα, κάθε παρουσία πρέπει να έχετε πανομοιότυπες τοπικές θύρες και χρονικών ορίων.

>[AZURE.IMPORTANT] Μια μονάδα εξισορρόπησης φόρτου δοκιμή του χρησιμοποιεί τη διεύθυνση IP 168.63.129.16. Αυτή η δημόσια διεύθυνση IP διευκολύνει την επικοινωνία με εσωτερική πλατφόρμα πόρους για τη μεταφορά-σας-κάτοχος-IP σενάριο Azure εικονικές δικτύου. Η εικονική δημόσια διεύθυνση IP 168.63.129.16 χρησιμοποιείται σε όλες τις περιοχές και δεν θα αλλάξει. Συνιστάται να επιτρέψετε αυτήν τη διεύθυνση IP σε οποιαδήποτε πολιτικές τοπικού τείχους προστασίας. Αυτό δεν πρέπει να θεωρείται κίνδυνο ασφαλείας επειδή μόνο το εσωτερικό Azure πλατφόρμα να προέλευσης ένα μήνυμα από αυτήν τη διεύθυνση. Εάν το κάνετε αυτό, θα υπάρχει μη αναμενόμενη συμπεριφορά σε μια ποικιλία σενάρια, όπως τη ρύθμιση των παραμέτρων στην ίδια περιοχή διευθύνσεων IP του 168.63.129.16 και αντιμετωπίζετε διπλή διευθύνσεις IP.

## <a name="learn-about-the-types-of-probes"></a>Μάθετε περισσότερα σχετικά με τους τύπους των καθετήρες

### <a name="guest-agent-probe"></a>Δοκιμή του παράγοντα επισκέπτη

Αυτή η δοκιμή του είναι διαθέσιμη για τις υπηρεσίες Cloud Azure μόνο. Εξισορρόπηση φόρτου χρησιμοποιεί τον παράγοντα επισκέπτη μέσα το εικονικό υπολογιστή, και, στη συνέχεια, παρακολουθεί και απαντά με μια απόκριση HTTP 200 OK μόνο όταν η παρουσία είναι σε κατάσταση έτοιμη (δηλαδή, όχι σε μια άλλη κατάστασης όπως απασχολημένος, ανακύκλωσης ή διακοπή).

Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Ρύθμιση παραμέτρων το αρχείο ορισμού υπηρεσίας (csdef) για την εύρυθμη λειτουργία καθετήρες](https://msdn.microsoft.com/library/azure/ee758710.aspx) ή [να ξεκινήσετε τη δημιουργία μια μονάδα εξισορρόπησης φόρτου μέσω Internet για τις υπηρεσίες cloud](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a>Τι κάνει μια δοκιμή του παράγοντα επισκέπτη επισημάνετε μια παρουσία ως κατεστραμμένο;

Εάν ο παράγοντας επισκέπτη δεν ανταποκρίνεται με HTTP 200 OK, την εξισορρόπηση φόρτου επισημαίνει την παρουσία ως δεν ανταποκρίνεται και διακόπτει την αποστολή κίνηση για να την παρουσία. Η μονάδα εξισορρόπησης φόρτου εξακολουθεί να κάνετε ping την παρουσία. Εάν ο παράγοντας επισκέπτη αποκρίνεται με μια 200 HTTP, τη μονάδα εξισορρόπησης φόρτου στέλνει την κυκλοφορία σε αυτήν την παρουσία ξανά.

Όταν χρησιμοποιείτε ένα ρόλο web, τον κωδικό της τοποθεσίας Web εκτελείται συνήθως στο w3wp.exe, που δεν παρακολουθείται από το Azure παράγοντας ύφασμα ή επισκέπτη. Αυτό σημαίνει ότι αποτυχίες στο w3wp.exe (για παράδειγμα, αποκρίσεις HTTP 500) δεν θα αναφερθεί στον παράγοντα επισκέπτη, και τη μονάδα εξισορρόπησης φόρτου δεν θα αυτήν την παρουσία εκτός περιστροφής.

### <a name="http-custom-probe"></a>Δοκιμή του προσαρμοσμένου HTTP

Το προσαρμοσμένο δοκιμή του HTTP εξισορρόπηση φόρτου παρακάμπτει το προεπιλεγμένο επισκέπτη παράγοντας δοκιμή του, γεγονός που σημαίνει ότι μπορείτε να δημιουργήσετε τη δική σας προσαρμοσμένη λογική για να προσδιορίσετε την εύρυθμη λειτουργία της παρουσίας του ρόλου. Η μονάδα εξισορρόπησης φόρτου probes το τελικό σημείο κάθε 15 δευτερόλεπτα, από προεπιλογή. Η παρουσία θεωρείται στο την εναλλαγή εξισορρόπησης φόρτου εάν αποκρίνεται με μια 200 HTTP μέσα στο χρονικό (31 δευτερόλεπτα από προεπιλογή).

Αυτό μπορεί να είναι χρήσιμο αν θέλετε να εφαρμόσετε τις δικές σας λογικής για να καταργήσετε τις εμφανίσεις από εναλλαγή εξισορρόπησης φόρτου. Για παράδειγμα, μπορεί να αποφασίσετε να καταργήσετε μια παρουσία, εάν είναι παραπάνω 90% CPU και επιστρέφει μια κατάσταση μη-200. Εάν έχετε ρόλους web που χρησιμοποιούν w3wp.exe, αυτό σημαίνει επίσης λαμβάνετε αυτόματες παρακολούθησης της τοποθεσίας Web, επειδή οι αποτυχίες στον κώδικα της τοποθεσίας Web θα επιστρέψει μια κατάσταση μη-200 για τη δοκιμή του εξισορρόπησης φόρτου.

>[AZURE.NOTE] Η δοκιμή του προσαρμοσμένου HTTP υποστηρίζει σχετικές διαδρομές και μόνο του πρωτοκόλλου HTTP. HTTPS δεν υποστηρίζεται.

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a>Τι κάνει μια δοκιμή του προσαρμοσμένου HTTP επισημάνετε μια παρουσία ως κατεστραμμένο;

- Η εφαρμογή HTTP επιστρέφει έναν κωδικό απόκρισης HTTP εκτός από 200 (για παράδειγμα, 403, 404 ή 500). Αυτή είναι μια θετική επιβεβαίωση που την παρουσία της εφαρμογής πρέπει να πραγματοποιηθούν αμέσως Έξοδος από την υπηρεσία.
- Ο διακομιστής HTTP δεν ανταποκρίνεται καθόλου μετά το χρονικό όριο. Ανάλογα με την τιμή χρονικού ορίου που έχει οριστεί, αυτό μπορεί να σημαίνει που πολλών δοκιμή του αιτήσεις Μετάβαση μη διεκπεραιωθείσες πριν από τη δοκιμή του λαμβάνει έχει επισημανθεί ως δεν εκτελείται (δηλαδή, πριν από την SuccessFailCount καθετήρες αποστέλλονται).
- Ο διακομιστής κλείνει τη σύνδεση μέσω ενός επαναφορά TCP.

### <a name="tcp-custom-probe"></a>Δοκιμή του προσαρμοσμένου TCP

TCP καθετήρες ξεκινήσει μια σύνδεση, εκτελώντας μια τρεις τρόπους συγχρονισμός με την καθορισμένη θύρα.

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a>Τι κάνει μια δοκιμή του προσαρμοσμένου TCP επισημάνετε μια παρουσία ως κατεστραμμένο;

- Το TCP ο διακομιστής δεν ανταποκρίνεται καθόλου μετά το χρονικό όριο. Κατά τη δοκιμή του έχει επισημανθεί ως δεν εκτελείται εξαρτάται από τον αριθμό των αιτήσεις αποτυχίας αναζήτησης που έχουν ρυθμιστεί για να μεταβείτε αναπάντητες πριν από τη σήμανση τη δοκιμή του ως δεν εκτελείται.
- Η δοκιμή του λαμβάνει μια TCP επαναφορά από την παρουσία ρόλο.

Για περισσότερες πληροφορίες σχετικά με τη ρύθμιση των παραμέτρων ενός δοκιμή του εύρυθμης λειτουργίας HTTP ή μια δοκιμή του TCP, ανατρέξτε στο θέμα [Γρήγορα αποτελέσματα με τη δημιουργία μια μονάδα εξισορρόπησης φόρτου μέσω Internet στο διαχειριστή πόρων με χρήση του PowerShell](load-balancer-get-started-internet-arm-ps.md#create-lb-rules-nat-rules-a-probe-and-a-load-balancer).

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a>Προσθήκη άρτιο παρουσίες πίσω στο εναλλαγή εξισορρόπησης φόρτου

TCP και HTTP καθετήρες θεωρούνται σε καλή κατάσταση και επισημάνετε την παρουσία ρόλο ως άρτιο όταν:

- Η μονάδα εξισορρόπησης φόρτου λαμβάνει ένα θετικό δοκιμή του στην πρώτη εκκίνηση του Εικονική.
- Η αρίθμηση SuccessFailCount (όπως περιγράφεται παραπάνω) προσδιορίζει την τιμή του επιτυχής καθετήρες που απαιτούνται για να επισημάνετε την παρουσία ρόλο ως σε καλή κατάσταση. Εάν μια παρουσία ρόλο καταργήθηκε, τον αριθμό των επιτυχημένη, διαδοχικές καθετήρες πρέπει να ισούται με ή υπερβαίνει την αξία της SuccessFailCount για να επισημάνετε την παρουσία ρόλο ως τρέχον.

>[AZURE.NOTE] Εάν την εύρυθμη λειτουργία της παρουσίας ένα ρόλο διακυμάνσεις, την εξισορρόπηση φόρτου αναμένει πλέον πριν να θέσετε την παρουσία του ρόλου ξανά σε καλή κατάσταση. Αυτό γίνεται μέσω μιας πολιτικής για να προστατεύσετε το χρήστη και την υποδομή.

## <a name="use-log-analytics-for-load-balancer"></a>Χρήση του αρχείου καταγραφής ανάλυσης για εξισορρόπηση φόρτου

Μπορείτε να χρησιμοποιήσετε [ανάλυση καταγραφής για εξισορρόπηση φόρτου](load-balancer-monitor-log.md) για να ελέγξετε την κατάσταση εύρυθμης λειτουργίας δοκιμή του και δοκιμή του πλήθους. Καταγραφή μπορεί να χρησιμοποιηθεί με το Power BI ή Azure λειτουργικές ιδέες για την παροχή στατιστικά στοιχεία σχετικά με την κατάσταση εύρυθμης λειτουργίας εξισορρόπηση φόρτου.
