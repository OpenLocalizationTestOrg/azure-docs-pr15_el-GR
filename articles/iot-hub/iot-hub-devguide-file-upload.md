<properties
 pageTitle="Οδηγός για προγραμματιστές - Αποστολή αρχείου | Microsoft Azure"
 description="Azure Οδηγός για προγραμματιστές διανομέα IoT - αποστολή αρχείων από μια συσκευή με διανομέα IoT"
 services="iot-hub"
 documentationCenter=".net"
 authors="dominicbetts"
 manager="timlt"
 editor=""/>

<tags
 ms.service="iot-hub"
 ms.devlang="multiple"
 ms.topic="article"
 ms.tgt_pltfrm="na"
 ms.workload="na"
 ms.date="09/30/2016" 
 ms.author="dobett"/>

# <a name="upload-files-from-a-device"></a>Αποστολή αρχείων από μια συσκευή

## <a name="overview"></a>Επισκόπηση

Όπως αναφέρεται στην τα [τελικά σημεία διανομέα IoT] [ lnk-endpoints] άρθρο, συσκευές μπορούν να ξεκινήσουν αποστολών αρχείων με αποστολή ειδοποίησης μέσω ένα τελικό σημείο άμεσα προσβάσιμη από τη συσκευή (**/devices/ {deviceId} / αρχεία**).  Όταν μια συσκευή ειδοποιεί IoT διανομέα από μια ολοκληρωμένη αποστολής, διανομέα IoT δημιουργεί ειδοποιήσεων αποστολής αρχείων που μπορείτε να λάβετε μέσω ενός τελικού σημείου υπηρεσίας τοποθεσία (**/messages/servicebound/filenotifications**) ως μηνύματα.

Αντί να brokering μηνυμάτων μέσω διανομέα IoT ίδια, διανομέα IoT αντί για αυτό λειτουργεί ως μια απόσπασης συσχετισμένο λογαριασμό αποθήκευσης Azure. Μια συσκευή ζητά ενός διακριτικού χώρου αποθήκευσης από διανομέα IoT ειδικά για το αρχείο στη συσκευή θέλει να αποστείλετε. Η συσκευή χρησιμοποιεί το URI συσχετισμών Ασφαλείας για να αποστείλετε το αρχείο στο χώρο αποθήκευσης και, όταν ολοκληρωθεί η αποστολή στη συσκευή στέλνει μια ειδοποίηση ολοκλήρωσης IoT διανομέα. Ο διανομέας IoT επαληθεύει ότι το αρχείο έχει αποσταλεί και, στη συνέχεια, προσθέτει μια ειδοποίηση αποστολής αρχείου στο νέο υπηρεσίας άμεσα προσβάσιμη από αρχείο ειδοποιήσεων ανταλλαγής μηνυμάτων τελικό σημείο.

Πριν από την αποστολή αρχείου σε διανομέα IoT από μια συσκευή, πρέπει να ρυθμίσετε το διανομέα, [Συσχετίζοντας ένα χώρο αποθήκευσης Azure] [ lnk-associate-storage] λογαριασμού σε αυτήν.

Τη συσκευή σας, στη συνέχεια, να [προετοιμάσετε μια αποστολή] [ lnk-initialize] και, στη συνέχεια, [να σας ειδοποιεί διανομέα IoT] [ lnk-notify] όταν ολοκληρωθεί η αποστολή. Προαιρετικά, όταν μια συσκευή ειδοποιεί διανομέα IoT ότι έχει ολοκληρωθεί η αποστολή, η υπηρεσία μπορεί να δημιουργήσει ένα [μήνυμα ειδοποίησης][lnk-service-notification].

### <a name="when-to-use"></a>Πότε να χρησιμοποιήσετε

Χρησιμοποιήστε αυτήν τη δυνατότητα διανομέα IoT όταν πρέπει να αποστείλετε ένα αρχείο από μια συσκευή με την υπηρεσία υποστήριξης σας αντί να στέλνετε ένα μήνυμα μέσω IoT διανομέα.

## <a name="associate-an-azure-storage-account-with-iot-hub"></a>Συσχετισμός ενός λογαριασμού αποθήκευσης Azure με διανομέα IoT

Για να χρησιμοποιήσετε τη λειτουργία αποστολής αρχείου, πρέπει πρώτα να συνδέσετε ένα λογαριασμό αποθήκευσης Azure στο διανομέα IoT. Μπορείτε να το κάνετε είτε μέσω του [Azure πύλη][lnk-management-portal], ή μέσω προγραμματισμού μέσω της υπηρεσίας [παροχής πόρων διανομέα IoT APIs ΥΠΌΛΟΙΠΑ][lnk-resource-provider-apis]. Αφού έχετε που σχετίζονται αποθήκευσης Azure λογαριασμού με το Κέντρο IoT σας, η υπηρεσία επιστρέφει ένα URI συσχετισμούς Ασφαλείας σε μια συσκευή όταν η συσκευή ξεκινά μια αίτηση αποστολής αρχείων.

> [AZURE.NOTE] Το [Azure IoT διανομέα SDK] [ lnk-sdks] χειρισμού αυτόματη ανάκτηση το URI συσχετισμών Ασφαλείας και αποστολή του αρχείου που σας ειδοποιεί IoT διανομέα από μια ολοκληρωμένη αποστολή.

## <a name="initialize-a-file-upload"></a>Προετοιμασία ενός Αποστολή αρχείου

Ο διανομέας IoT διαθέτει ένα τελικό σημείο ειδικά για συσκευές για να ζητήσετε από ένα URI συσχετισμών Ασφαλείας για το χώρο αποθήκευσης για να αποστείλετε ένα αρχείο. Η συσκευή ξεκινά τη διαδικασία αποστολής αρχείου στέλνοντας μια ΔΗΜΟΣΊΕΥΣΗ στο διανομέα IoT στο `{iot hub}.azure-devices.net/devices/{deviceId}/files` με σώμα JSON παρακάτω:

```
{
    "blobName": "{name of the file for which a SAS URI will be generated}"
}
```

Ο διανομέας IoT επιστρέφει τα ακόλουθα, τα οποία χρησιμοποιεί τη συσκευή για να αποστείλετε το αρχείο:

```
{
    "correlationId": "somecorrelationid",
    "hostname": "contoso.azure-devices.net",
    "containerName": "testcontainer",
    "blobName": "test-device1/image.jpg",
    "sasToken": "1234asdfSAStoken"
}
```

### <a name="deprecated-initialize-a-file-upload-with-a-get"></a>Που έχουν καταργηθεί: προετοιμασία μια αποστολή αρχείου με μια ΛΉΨΗ

> [AZURE.NOTE] Αυτή η ενότητα περιγράφει τις λειτουργίες για το πώς μπορείτε να λαμβάνετε ένα URI συσχετισμών Ασφαλείας από διανομέα IoT. Χρησιμοποιήστε τη μέθοδο POST που περιγράφονται παραπάνω.

Ο διανομέας IoT διαθέτει δύο τελικά σημεία ΥΠΌΛΟΙΠΟ για την υποστήριξη Αποστολή αρχείου, μία για να λάβετε το URI συσχετισμών Ασφαλείας για το χώρο αποθήκευσης και το άλλο για να ενημερώσετε την ενότητα IoT της μια ολοκληρωμένη αποστολή. Η συσκευή ξεκινά τη διαδικασία αποστολής αρχείων με την αποστολή ΔΕΊΤΕ την ενότητα IoT στο `{iot hub}.azure-devices.net/devices/{deviceId}/files/{filename}`. Ο διανομέας επιστρέφει ένα URI συσχετισμών Ασφαλείας συγκεκριμένα το αρχείο να αποσταλεί και ένα Αναγνωριστικό συσχέτισης για να χρησιμοποιηθεί μόλις ολοκληρωθεί η αποστολή.

## <a name="notify-iot-hub-of-a-completed-file-upload"></a>Ειδοποιήστε IoT διανομέα από μια αποστολή αρχείου ολοκληρωμένες

Η συσκευή είναι υπεύθυνος για την αποστολή του αρχείου με το χώρο αποθήκευσης χρησιμοποιώντας το Azure SDK χώρου αποθήκευσης. Μόλις ολοκληρωθεί η αποστολή, η συσκευή αποστέλλει μια ΔΗΜΟΣΊΕΥΣΗ στο διανομέα IoT στο `{iot hub}.azure-devices.net/devices/{deviceId}/files/notifications` με σώμα JSON παρακάτω:

```
{
    "correlationId": "{correlation ID received from the initial request}",
    "isSuccess": bool,
    "statusCode": XXX,
    "statusDescription": "Description of status"
}
```

Η τιμή του `isSuccess` είναι μια δυαδική που αντιπροσωπεύει το αρχείο στάλθηκε με επιτυχία ή όχι. Ο κωδικός κατάστασης για `statusCode` είναι η κατάσταση για την αποστολή του αρχείου με το χώρο αποθήκευσης, και το `statusDescription` αντιστοιχεί το `statusCode`.

## <a name="reference-topics"></a>Αναφορά θέματα:

Τα παρακάτω θέματα αναφοράς παρέχει περισσότερες πληροφορίες σχετικά με την αποστολή αρχείων από μια συσκευή.

## <a name="file-upload-notifications"></a>Ειδοποιήσεων αποστολής αρχείου

Όταν η συσκευή αποστέλλει ένα αρχείο και ειδοποιεί διανομέα IoT ολοκλήρωσης αποστολής, την υπηρεσία προαιρετικά δημιουργεί ένα μήνυμα ειδοποίησης που περιέχει το όνομα και αποθήκευσης τη θέση του αρχείου.

Όπως περιγράφεται σε [τελικά σημεία][lnk-endpoints], διανομέα IoT προσφέρει ειδοποιήσεων αποστολής αρχείων μέσω ενός τελικού σημείου υπηρεσίας τοποθεσία (**/messages/servicebound/fileuploadnotifications**) ως μηνύματα. Η σημασιολογία παραλαβής για ειδοποιήσεις αποστολής αρχείων είναι ίδια όπως για μηνύματα cloud-σε-συσκευή και έχουν το ίδιο [μήνυμα κύκλου ζωής][lnk-lifecycle]. Κάθε μήνυμα που ανακτήθηκαν από το τελικό σημείο της ειδοποίησης αποστολής αρχείου είναι μια εγγραφή JSON με τις ακόλουθες ιδιότητες:

| Ιδιότητα | Περιγραφή |
| -------- | ----------- |
| EnqueuedTimeUtc | Σήμανση χρόνου που υποδεικνύει κατά την οποία δημιουργήθηκε η ειδοποίηση. |
| DeviceId | **DeviceId** της συσκευής που έχουν αποσταλεί στο αρχείο. |
| BlobUri | URI από το απεσταλμένο αρχείο. |
| BlobName | Όνομα του αρχείου που έχουν αποσταλεί. |
| LastUpdatedTime | Σήμανση χρόνου που υποδεικνύει πότε έγινε η τελευταία ενημέρωση του αρχείου. |
| BlobSizeInBytes | Μέγεθος το απεσταλμένο αρχείο. |

**Παράδειγμα**. Αυτό είναι ένα παράδειγμα σώμα του μηνύματος ειδοποίησης αποστολής αρχείου.

```
{
    "deviceId":"mydevice",
    "blobUri":"https://{storage account}.blob.core.windows.net/{container name}/mydevice/myfile.jpg",
    "blobName":"mydevice/myfile.jpg",
    "lastUpdatedTime":"2016-06-01T21:22:41+00:00",
    "blobSizeInBytes":1234,
    "enqueuedTimeUtc":"2016-06-01T21:22:43.7996883Z"
}
```

## <a name="file-upload-notification-configuration-options"></a>Επιλογές ρύθμισης παραμέτρων ειδοποιήσεων αποστολής αρχείου

Κάθε ενότητα IoT εκθέτει τις ακόλουθες επιλογές ρύθμισης παραμέτρων για τις ειδοποιήσεις αποστολής αρχείου:

| Ιδιότητα | Περιγραφή | Περιοχή και προεπιλεγμένη |
| -------- | ----------- | ----------------- |
| **enableFileUploadNotifications** | Ελέγχει εάν ειδοποιήσεων αποστολής αρχείου εγγράφονται στο τελικό σημείο ειδοποιήσεις αρχείου. | Bool. Προεπιλεγμένη: True. |
| **fileNotifications.ttlAsIso8601** | Προεπιλεγμένο TTL για ειδοποιήσεων αποστολής αρχείου. | ISO_8601 χρονικό διάστημα έως 48 H (ελάχιστη 1 λεπτό). Προεπιλογή: 1 ώρα. |
| **fileNotifications.lockDuration** | Κλείδωμα διάρκειας για την ουρά ειδοποιήσεων αποστολής αρχείου. | 5 έως 300 δευτερόλεπτα (ελάχιστη 5 δευτερόλεπτα). Προεπιλογή: 60 δευτερόλεπτα. |
| **fileNotifications.maxDeliveryCount** | Καταμέτρηση μέγιστο παράδοσης για το αρχείο αποστείλετε ουρά ειδοποιήσεων. | 1 έως 100. Προεπιλεγμένη: 100. |

## <a name="additional-reference-material"></a>Υλικό επιπλέον αναφοράς

Άλλα θέματα αναφοράς στον οδηγό για προγραμματιστές περιλαμβάνουν τα εξής:

- [Τα τελικά σημεία διανομέα IoT] [ lnk-endpoints] περιγράφει τα διάφορα τελικά σημεία που κάθε ενότητα IoT εκθέτει για διαχείριση χρόνου εκτέλεσης και λειτουργίες.
- [Περιορισμού και του ορίου] [ lnk-quotas] περιγράφει τα όρια που ισχύουν για την υπηρεσία IoT διανομέας και τη συμπεριφορά επιτάχυνσης να περιμένει όταν χρησιμοποιείτε την υπηρεσία.
- [SDK συσκευής και της υπηρεσίας διανομέα IoT] [ lnk-sdks] παραθέτει τα διάφορα γλώσσας SDK που μη χρήση κατά την ανάπτυξη και συσκευή και υπηρεσία εφαρμογές που αλληλεπιδρούν με IoT διανομέα.
- [Το ερώτημα γλώσσα για twins, μεθόδους και εργασίες] [ lnk-query] περιγράφει τη γλώσσα ερωτήματος που μπορείτε να χρησιμοποιήσετε για να ανακτήσετε πληροφορίες από διανομέα IoT σχετικά με τη συσκευή twins, μεθόδους και εργασίες.
- [Υποστήριξη IoT διανομέα MQTT] [ lnk-devguide-mqtt] παρέχει περισσότερες πληροφορίες σχετικά με την υποστήριξη IoT διανομέα για το πρωτόκολλο MQTT.

## <a name="next-steps"></a>Επόμενα βήματα

Τώρα έχετε μάθει πώς μπορείτε να αποστείλετε αρχεία από συσκευές που χρησιμοποιούν IoT διανομέα, μπορεί να σας ενδιαφέρουν τα παρακάτω θέματα τον οδηγό για προγραμματιστές:

- [Διαχείριση ταυτοτήτων συσκευή στο διανομέα IoT][lnk-devguide-identities]
- [Έλεγχος της πρόσβασης σε διανομέα IoT][lnk-devguide-security]
- [Χρησιμοποιήστε twins συσκευή για να συγχρονίσετε κατάσταση και ρυθμίσεις παραμέτρων][lnk-devguide-device-twins]
- [Κλήση μιας μεθόδου απευθείας σε μια συσκευή][lnk-devguide-directmethods]
- [Προγραμματισμός εργασιών σε πολλές συσκευές][lnk-devguide-jobs]

Εάν θέλετε να δοκιμάσετε μερικά από τα θέματα που περιγράφονται σε αυτό το άρθρο, μπορεί να σας ενδιαφέρουν στην παρακάτω ενότητα IoT εκμάθηση:

- [Αποστολή αρχείων από συσκευές στο cloud με το διανομέα IoT][lnk-fileupload-tutorial]

[lnk-resource-provider-apis]: https://msdn.microsoft.com/library/mt548492.aspx
[lnk-endpoints]: iot-hub-devguide-endpoints.md
[lnk-quotas]: iot-hub-devguide-quotas-throttling.md
[lnk-sdks]: iot-hub-devguide-sdks.md
[lnk-query]: iot-hub-devguide-query-language.md
[lnk-devguide-mqtt]: iot-hub-mqtt-support.md
[lnk-management-portal]: https://portal.azure.com
[lnk-fileupload-tutorial]: iot-hub-csharp-csharp-file-upload.md
[lnk-associate-storage]: iot-hub-devguide-file-upload.md#associate-an-azure-storage-account-with-iot-hub
[lnk-initialize]: iot-hub-devguide-file-upload.md#initialize-a-file-upload
[lnk-notify]: iot-hub-devguide-file-upload.md#notify-iot-hub-of-a-completed-file-upload
[lnk-service-notification]: iot-hub-devguide-file-upload.md#file-upload-notifications
[lnk-lifecycle]: iot-hub-devguide-messaging.md#message-lifecycle

[lnk-devguide-identities]: iot-hub-devguide-identity-registry.md
[lnk-devguide-security]: iot-hub-devguide-security.md
[lnk-devguide-device-twins]: iot-hub-devguide-device-twins.md
[lnk-devguide-directmethods]: iot-hub-devguide-direct-methods.md
[lnk-devguide-jobs]: iot-hub-devguide-jobs.md
