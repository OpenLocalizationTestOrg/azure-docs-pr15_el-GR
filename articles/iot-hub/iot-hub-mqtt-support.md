<properties
 pageTitle="Υποστήριξη IoT διανομέα MQTT | Microsoft Azure"
 description="Περιγραφή της MQTT υποστηρίζει σε επίπεδο διανομέα IoT"
 services="iot-hub"
 documentationCenter=".net"
 authors="kdotchkoff"
 manager="timlt"
 editor=""/>

<tags
 ms.service="iot-hub"
 ms.devlang="multiple"
 ms.topic="article"
 ms.tgt_pltfrm="na"
 ms.workload="na"
 ms.date="10/24/2016"
 ms.author="kdotchko"/>

# <a name="iot-hub-mqtt-support"></a>Υποστήριξη MQTT διανομέα IoT

Διανομέα IoT σας δίνει τη δυνατότητα να επικοινωνούν με τα τελικά σημεία συσκευή διανομέα IoT χρησιμοποιώντας το [MQTT v3.1.1] συσκευές[ lnk-mqtt-org] πρωτοκόλλου στη θύρα 8883 ή v3.1.1 MQTT μέσω πρωτοκόλλου WebSocket στη θύρα 443. Ενότητα IoT απαιτεί όλα συσκευή επικοινωνιών μέσω TLS/SSL (ως εκ τούτου, IoT διανομέα δεν υποστηρίζει μη ασφαλείς συνδέσεις μέσω της θύρας λογιστική).

## <a name="connecting-to-iot-hub"></a>Σύνδεση με το Κέντρο IoT

Μια συσκευή μπορεί να χρησιμοποιήσει το πρωτόκολλο MQTT για να συνδεθείτε με ένα διανομέα IoT είτε με τη χρήση των βιβλιοθηκών στο το [Microsoft Azure IoT SDK] [ lnk-device-sdks] ή με τη χρήση του MQTT πρωτόκολλο απευθείας.

## <a name="using-the-device-client-sdks"></a>Χρήση του προγράμματος-πελάτη συσκευή SDK

[Συσκευή προγράμματος-πελάτη SDK] [ lnk-device-sdks] αυτήν την υποστήριξη του πρωτοκόλλου MQTT είναι διαθέσιμες για Java, Node.js, C, C# και Python. Το πρόγραμμα-πελάτη συσκευή SDK Χρησιμοποιήστε τυπική διανομέα IoT συμβολοσειρά σύνδεσης για να δημιουργήσετε μια σύνδεση με ένα διανομέα IoT. Για να χρησιμοποιήσετε το πρωτόκολλο MQTT, πρέπει να οριστεί η παράμετρος πρωτόκολλο προγράμματος-πελάτη για να **MQTT**. Από προεπιλογή, το πρόγραμμα-πελάτη συσκευή SDK σύνδεση με ένα διανομέα IoT με το **CleanSession** σημαία ορίζεται σε **0** και χρήση **ποιότητας υπηρεσίας 1** για ανταλλαγή μηνυμάτων με την ενότητα IoT.

Όταν μια συσκευή είναι συνδεδεμένη με ένα διανομέα IoT, ο υπολογιστής-πελάτης συσκευή SDK παρέχουν μεθόδους που επιτρέπουν τη συσκευή για να στείλετε ένα μήνυμα και να λαμβάνετε μηνύματα από μια ενότητα IoT.

Ο παρακάτω πίνακας περιέχει συνδέσεις σε δείγματα κώδικα για κάθε γλώσσα που υποστηρίζεται και καθορίζει την παράμετρο για να χρησιμοποιήσετε για να δημιουργήσετε μια σύνδεση με χρήση του πρωτοκόλλου MQTT διανομέα IoT.

| Γλώσσα                   | Πρωτόκολλο παραμέτρου        |
| -------------------------- | ------------------------- |
| [Node.js][lnk-sample-node] | Azure-iot-συσκευή-mqtt     |
| [Java][lnk-sample-java]    | IotHubClientProtocol.MQTT |
| [C][lnk-sample-c]          | MQTT_Protocol             |
| [C#][lnk-sample-csharp]    | TransportType.Mqtt        |
| [Python][lnk-sample-python] | IoTHubTransportProvider.MQTT |

### <a name="migrating-a-device-app-from-amqp-to-mqtt"></a>Μετεγκατάσταση μια εφαρμογή για τη συσκευή από AMQP σε MQTT
Εάν χρησιμοποιείτε τον [υπολογιστή-πελάτη συσκευή SDK][lnk-device-sdks], μετάβαση από το χρησιμοποιώντας AMQP να MQTT απαιτεί την αλλαγή την παράμετρο πρωτόκολλο κατά την προετοιμασία του υπολογιστή-πελάτη, όπως αναφέρεται παραπάνω.

Όταν αυτή την περίπτωση, βεβαιωθείτε ότι για να ελέγξετε τα ακόλουθα στοιχεία:

* AMQP επιστρέφει σφάλματα για πολλές συνθήκες, ενώ MQTT τερματίζει τη σύνδεση. Έχει ως αποτέλεσμα την εξαίρεση χειρισμός λογικής ενδέχεται να απαιτεί ορισμένες αλλαγές.
* MQTT δεν υποστηρίζει τις λειτουργίες *Απόρριψη* όταν λαμβάνετε [μηνύματα C2D][lnk-messaging]. Εάν σας παρασκηνίου πρέπει να λαμβάνετε μια απάντηση από την εφαρμογή συσκευή, εξετάστε το ενδεχόμενο χρήσης [άμεσες μεθόδους][lnk-methods].

## <a name="using-the-mqtt-protocol-directly"></a>Χρήση του πρωτοκόλλου MQTT απευθείας

Εάν μια συσκευή δεν είναι δυνατό να χρησιμοποιήσετε το πρόγραμμα-πελάτη συσκευή SDK, το να εξακολουθεί να συνδεθείτε με τα τελικά σημεία δημόσια συσκευή που χρησιμοποιεί το πρωτόκολλο MQTT. Στο πακέτο **ΣΎΝΔΕΣΗ** στη συσκευή θα πρέπει να χρησιμοποιήσετε τις παρακάτω τιμές:

- Για το πεδίο **ClientId** , χρησιμοποιήστε το **deviceId**. 
- Για το πεδίο **όνομα χρήστη** , χρησιμοποιήστε `{iothubhostname}/{device_id}`, όπου {iothubhostname} είναι η πλήρης CName του διανομέα IoT.

    Για παράδειγμα, εάν το όνομα του Κέντρο IoT σας είναι **contoso.azure devices.net** και το όνομα της συσκευής σας είναι **MyDevice01**, το πλήρες πεδίο **Username** πρέπει να περιέχει `contoso.azure-devices.net/MyDevice01`.

- Για το πεδίο **κωδικού πρόσβασης** , χρησιμοποιήστε ένα διακριτικό συσχετισμών Ασφαλείας. Η μορφή για το διακριτικό συσχετισμών Ασφαλείας είναι η ίδια όπως για το HTTP και AMQP πρωτόκολλα:<br/>`SharedAccessSignature sig={signature-string}&se={expiry}&sr={URL-encoded-resourceURI}`.

    Για περισσότερες πληροφορίες σχετικά με τον τρόπο για να δημιουργήσετε τα διακριτικά συσχετισμών Ασφαλείας, ανατρέξτε στην ενότητα συσκευή του [διακριτικά ασφαλείας χρησιμοποιώντας το Κέντρο IoT][lnk-sas-tokens].
    
    Κατά τη δοκιμή, μπορείτε επίσης να χρησιμοποιήσετε την [Εξερεύνηση των συσκευών] [ lnk-device-explorer] εργαλείο για να δημιουργήσετε γρήγορα ένα διακριτικό συσχετισμών Ασφαλείας που μπορείτε να αντιγράψετε και να επικολλήσετε τον δικό σας κώδικα:
    
    1. Μεταβείτε στην καρτέλα " **Διαχείριση** " στην Εξερεύνηση των συσκευών.
    2. Κάντε κλικ στην επιλογή **Διακριτικού συσχετισμών Ασφαλείας** (επάνω δεξιά γωνία).
    3. Στην **SASTokenForm**, επιλέξτε τη συσκευή σας στο το **DeviceID** αναπτυσσόμενης λίστας. Ορίστε την **τιμή TTL**.
    4. Κάντε κλικ στην επιλογή **Δημιουργία** για να δημιουργήσετε τον κωδικό σας.
    
    Το διακριτικό συσχετισμών Ασφαλείας που παράγεται έχει αυτήν τη δομή:   `HostName={your hub name}.azure-devices.net;DeviceId=javadevice;SharedAccessSignature=SharedAccessSignature sr={your hub name}.azure-devices.net%2fdevices%2fMyDevice01&sig=vSgHBMUG.....Ntg%3d&se=1456481802`.

    Το τμήμα της αυτό το διακριτικό θα χρησιμοποιηθεί ως πεδίο **κωδικού πρόσβασης** για να συνδεθείτε χρησιμοποιώντας MQTT:   `SharedAccessSignature sr={your hub name}.azure-devices.net%2fdevices%2fyDevice01&sig=vSgHBMUG.....Ntg%3d&se=1456481802g%3d&se=1456481802`.

Για MQTT σύνδεση και αποσύνδεση πακέτα, διανομέα IoT ζητήματα συμβάντος στο κανάλι **Λειτουργίες παρακολούθησης** με πρόσθετες πληροφορίες που μπορεί να σας βοηθήσει να αντιμετωπίσετε προβλήματα συνδεσιμότητας.

### <a name="sending-messages-to-iot-hub"></a>Αποστολή μηνυμάτων σε διανομέα IoT

Μετά την πραγματοποίηση μιας σύνδεσης επιτυχής, μια συσκευή μπορεί να στείλει μηνύματα με διανομέα IoT χρησιμοποιώντας `devices/{device_id}/messages/events/` ή `devices/{device_id}/messages/events/{property_bag}` ως **Όνομα θέματος**. Το `{property_bag}` στοιχείο επιτρέπει τη συσκευή για την αποστολή μηνυμάτων με πρόσθετες ιδιότητες σε μορφή κωδικοποίηση url. Για παράδειγμα:

```
RFC 2396-encoded(<PropertyName1>)=RFC 2396-encoded(<PropertyValue1>)&RFC 2396-encoded(<PropertyName2>)=RFC 2396-encoded(<PropertyValue2>)…
```

> [AZURE.NOTE] Αυτό `{property_bag}` στοιχείο χρησιμοποιεί την ίδια κωδικοποίηση όπως για συμβολοσειρές ερωτήματος στο του πρωτοκόλλου HTTP.

Επίσης να χρησιμοποιήσετε την εφαρμογή-πελάτη συσκευή `devices/{device_id}/messages/events/{property_bag}` ως το **όνομα θέματος θα** για να ορίσετε *τα μηνύματα θα* προωθείται ως μήνυμα τηλεμετρίας.

Ενότητα IoT δεν υποστηρίζει μηνύματα ποιότητας υπηρεσίας 2. Εάν ένας υπολογιστής-πελάτης συσκευή δημοσιεύει ένα μήνυμα με **2 ποιότητας υπηρεσίας**, διανομέα IoT κλείνει τη σύνδεση δικτύου.
Ο διανομέας IoT δεν διατηρείται διατήρηση μηνύματα. Εάν μια συσκευή στέλνει ένα μήνυμα με σημαία **ΔΙΑΤΉΡΗΣΗ** οριστεί σε 1, διανομέα IoT προσθέτει το **x-επιλέξετε-διατηρούνται** ιδιότητα εφαρμογή στο μήνυμα. Σε αυτήν την περίπτωση, αντί να συνεχίζεται το μήνυμα διατήρηση, διανομέα IoT μεταβιβάζει στην εφαρμογή υπολογιστή στο παρασκήνιο.

### <a name="receiving-messages"></a>Λήψη μηνυμάτων

Για να λαμβάνετε μηνύματα από IoT διανομέα, πρέπει να εγγραφείτε μια συσκευή με χρήση `devices/{device_id}/messages/devicebound/#` ως **Φίλτρο το θέμα**. Ο χαρακτήρας μπαλαντέρ πολλών επιπέδων **#** στο θέμα φιλτράρισμα χρησιμοποιείται μόνο για να επιτρέψετε τη συσκευή για να λάβετε επιπλέον ιδιότητες στο όνομα του θέματος. Ενότητα IoT δεν επιτρέπει τη χρήση των το **#** ή **?** χαρακτήρες μπαλαντέρ για το φιλτράρισμα των δευτερευόντων θεμάτων. Επειδή το διανομέα IoT δεν είναι μια broker ανταλλαγής μηνυμάτων pub-sub γενικής χρήσης, υποστηρίζει μόνο τα ονόματα θέμα τεκμηρίωση και φίλτρα το θέμα.

Επικοινωνήστε σημείωση, ότι η συσκευή δεν θα λαμβάνετε τυχόν μηνύματα από ενότητα IoT, πριν από την έχει εγγραφεί με επιτυχία σε συσκευή συγκεκριμένες τελικό σημείο του, που αντιπροσωπεύονται από το `devices/{device_id}/messages/devicebound/#` θέμα φίλτρο. Μετά την επιτυχή συνδρομή έχει δημιουργηθεί μια συσκευή θα ξεκινήσει η λήψη cloud-σε-συσκευή μόνο τα μηνύματα που έχουν σταλεί σε αυτήν μετά την ώρα της συνδρομής. Εάν η συσκευή συνδέεται με σημαία **CleanSession** με **0**, η συνδρομή θα είναι σταθερές σε διαφορετικές περίοδοι λειτουργίας. Σε αυτήν την περίπτωση, την επόμενη φορά που συνδέεται με **CleanSession 0** στη συσκευή θα λαμβάνετε εξαιρετική μηνύματα που έχουν σταλεί σε αυτήν ενώ ήταν αποσυνδεδεμένο. Εάν η συσκευή χρησιμοποιεί σημαία **CleanSession** οριστεί σε **1** , αν αυτό δεν θα λαμβάνετε τυχόν μηνύματα από διανομέα IoT μέχρι το οποίο έχει εγγραφεί η συσκευή-τελικό σημείο του.

Ενότητα IoT παραδίδει τα μηνύματα με το **Όνομα του θέματος** `devices/{device_id}/messages/devicebound/`, ή `devices/{device_id}/messages/devicebound/{property_bag}` εάν υπάρχουν οποιεσδήποτε ιδιότητες μηνύματος. `{property_bag}`περιέχει ζεύγη κωδικοποίηση url κλειδιού/τιμής των ιδιοτήτων του μηνύματος. Η ιδιότητα τσάντα συμπεριλαμβάνονται μόνο ιδιότητες της εφαρμογής και ιδιότητες χρήστη-μπορεί να οριστεί συστήματος (όπως **αναγνωριστικού μηνύματος** ή **correlationId**). Τα ονόματα των ιδιοτήτων συστήματος έχουν το πρόθεμα **$**, ιδιότητες της εφαρμογής, χρησιμοποιήστε το αρχικό όνομα ιδιότητας με χωρίς το πρόθεμα.

Όταν ένα πρόγραμμα-πελάτη συσκευής στο οποίο έχει εγγραφεί σε ένα θέμα με το **2 ποιότητας υπηρεσίας**, διανομέα IoT εκχωρεί ανώτατο επίπεδο ποιότητας υπηρεσίας 1 στο πακέτο **SUBACK** . Μετά από αυτό, διανομέα IoT θα παράδοση μηνυμάτων στη συσκευή με χρήση του 1 ποιότητας υπηρεσίας.

### <a name="additional-considerations"></a>Επιπλέον ζητήματα

Ως τελικό πρέπει να ληφθούν υπόψη, εάν πρέπει να προσαρμόσετε τη συμπεριφορά πρωτόκολλο MQTT στην πλευρά cloud, πρέπει να εξετάσετε την [πύλη πρωτόκολλο Azure IoT] [ lnk-azure-protocol-gateway] που σας επιτρέπει να αναπτύξετε μια πύλη υψηλών επιδόσεων προσαρμοσμένο πρωτόκολλο που διασυνδέσεις απευθείας με IoT διανομέα. Η πύλη πρωτόκολλο Azure IoT σάς επιτρέπει να προσαρμόσετε το πρωτόκολλο συσκευή για να χωρέσει αναπτύξεις MQTT brownfield ή άλλα προσαρμοσμένα πρωτόκολλα. Αυτή η προσέγγιση απαιτεί, ωστόσο, που θα εκτελέσετε και λειτουργία μιας πύλης προσαρμοσμένο πρωτόκολλο.

## <a name="next-steps"></a>Επόμενα βήματα

Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [σημειώσεις στο MQTT υποστηρίζουν] [ lnk-mqtt-devguide] στον οδηγό για προγραμματιστές του Azure IoT διανομέα.

Για να μάθετε περισσότερα σχετικά με το πρωτόκολλο MQTT, ανατρέξτε στην [τεκμηρίωση MQTT][lnk-mqtt-docs].

Για να μάθετε περισσότερα σχετικά με το σχεδιασμό της ανάπτυξής σας IoT διανομέα, ανατρέξτε στα θέματα:

- [Azure πιστοποιημένων ερωτημάτων για τον κατάλογο συσκευή IoT][lnk-devices]
- [Πρόσθετα πρωτόκολλα υποστήριξης][lnk-protocols]
- [Σύγκριση με διανομείς συμβάντος][lnk-compare]
- [Κλιμάκωση HA και DR][lnk-scaling]

Για να εξερευνήσετε περαιτέρω τις δυνατότητες του IoT διανομέα, ανατρέξτε στα θέματα:

- [Οδηγός για προγραμματιστές][lnk-devguide]
- [Προσομοίωση μια συσκευή με το SDK IoT πύλης][lnk-gateway]

[lnk-device-sdks]: https://github.com/Azure/azure-iot-sdks/blob/master/readme.md
[lnk-mqtt-org]: http://mqtt.org/
[lnk-mqtt-docs]: http://mqtt.org/documentation
[lnk-sample-node]: https://github.com/Azure/azure-iot-sdks/blob/develop/node/device/samples/simple_sample_device.js
[lnk-sample-java]: https://github.com/Azure/azure-iot-sdks/blob/develop/java/device/samples/send-receive-sample/src/main/java/samples/com/microsoft/azure/iothub/SendReceive.java
[lnk-sample-c]: https://github.com/Azure/azure-iot-sdks/tree/master/c/iothub_client/samples/iothub_client_sample_mqtt
[lnk-sample-csharp]: https://github.com/Azure/azure-iot-sdks/tree/master/csharp/device/samples
[lnk-sample-python]: https://github.com/Azure/azure-iot-sdks/tree/master/python/device/samples
[lnk-device-explorer]: https://github.com/Azure/azure-iot-sdks/blob/master/tools/DeviceExplorer/readme.md
[lnk-sas-tokens]: iot-hub-devguide-security.md#using-sas-tokens-as-a-device
[lnk-mqtt-devguide]: iot-hub-devguide-messaging.md#notes-on-mqtt-support
[lnk-azure-protocol-gateway]: iot-hub-protocol-gateway.md

[lnk-devices]: https://catalog.azureiotsuite.com/
[lnk-protocols]: iot-hub-protocol-gateway.md
[lnk-compare]: iot-hub-compare-event-hubs.md
[lnk-scaling]: iot-hub-scaling.md
[lnk-devguide]: iot-hub-devguide.md
[lnk-gateway]: iot-hub-linux-gateway-sdk-simulated-device.md

[lnk-methods]: iot-hub-devguide-direct-methods.md
[lnk-messaging]: iot-hub-devguide-messaging.md
