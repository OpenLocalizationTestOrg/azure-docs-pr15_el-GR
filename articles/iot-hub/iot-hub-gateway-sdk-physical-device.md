<properties
    pageTitle="Χρήση πραγματικό συσκευής με το SDK πύλης IoT | Microsoft Azure"
    description="Azure αναλυτικές οδηγίες IoT SDK πύλης χρησιμοποιώντας μια συσκευή Τέξας οργάνων SensorTag για την αποστολή δεδομένων σε διανομέα IoT μέσω μιας πύλης που εκτελείται σε μια λειτουργική μονάδα τον υπολογισμό Edison Intel"
    services="iot-hub"
    documentationCenter=""
    authors="chipalost"
    manager="timlt"
    editor=""/>

<tags
     ms.service="iot-hub"
     ms.devlang="cpp"
     ms.topic="article"
     ms.tgt_pltfrm="na"
     ms.workload="na"
     ms.date="08/29/2016"
     ms.author="andbuc"/>


# <a name="azure-iot-gateway-sdk-beta--send-device-to-cloud-messages-with-a-real-device-using-linux"></a>Azure IoT πύλης SDK (beta) – αποστολή μηνυμάτων συσκευή-cloud με το πραγματικό συσκευές που χρησιμοποιούν το Linux

Αυτόν τον οδηγό του [δείγματος χαμηλής ενέργειας Bluetooth] [ lnk-ble-samplecode] σας δείχνει πώς μπορείτε να χρησιμοποιήσετε το [Azure IoT πύλης SDK] [ lnk-sdk] για προώθηση τηλεμετρίας συσκευής στο cloud με διανομέα IoT από μια φυσική συσκευή και πώς να δρομολογήσετε εντολές από διανομέα IoT για μια φυσική συσκευή.

Αυτή η αναλυτική παρουσίαση καλύπτει τα εξής:

* **Αρχιτεκτονική**: σημαντικές αρχιτεκτονική πληροφορίες σχετικά με το δείγμα χαμηλής ενέργειας Bluetooth.

* **Δημιουργία και εκτέλεση**: τα βήματα που απαιτούνται για να δημιουργήσετε και να εκτελέσετε το δείγμα.

## <a name="architecture"></a>Αρχιτεκτονική

Η αναλυτική παρουσίαση δείχνει πώς μπορείτε να δημιουργήσετε και να εκτελέσετε μια πύλη IoT σε μια λειτουργική Intel Edison τον υπολογισμό μονάδα που εκτελείται Linux. Η πύλη είναι ενσωματωμένη χρησιμοποιώντας το SDK IoT πύλης. Το δείγμα χρησιμοποιεί μια συσκευή SensorTag οργάνων Τέξας της ενέργειας χαμηλή Bluetooth (Μεταβλητό) για να συλλέγετε δεδομένα θερμοκρασίας.

Κατά την εκτέλεση της πύλης του:

- Συνδέεται με μια συσκευή SensorTag χρησιμοποιεί το πρωτόκολλο Bluetooth χαμηλής ενέργειας (Μεταβλητό).
- Συνδέεται με χρήση του πρωτοκόλλου HTTP διανομέα IoT.
- Προωθεί τηλεμετρίας από τη συσκευή SensorTag IoT διανομέα.
- Δρομολογεί εντολών από διανομέα IoT στη συσκευή SensorTag.

Η πύλη περιέχει τις ακόλουθες ενότητες:

- Μια *λειτουργική μονάδα Μεταβλητό* που περιβάλλοντα εργασίας με μια συσκευή Συμβατές για τη λήψη δεδομένων θερμοκρασίας από τη συσκευή και στείλτε εντολές στη συσκευή.
- Ένα *Σύννεφο Μεταβλητό συσκευή λειτουργική μονάδα* που μεταφράζει τα JSON μηνύματα που προέρχονται από το cloud στο Μεταβλητό οδηγίες για τη *λειτουργική μονάδα Μεταβλητό*.
- Μια *λειτουργική μονάδα καταγραφής* που καταγράφει όλα τα μηνύματα πύλης.
- Μια *λειτουργική μονάδα αντιστοίχισης ταυτότητας* που μεταφράζει μεταξύ Μεταβλητό συσκευή MAC διευθύνσεις και τις ταυτότητες συσκευή Azure IoT διανομέα.
- Μια *λειτουργική μονάδα διανομέα IoT* την οποία αποστέλλει δεδομένα τηλεμετρίας με ένα διανομέα IoT λαμβάνει εντολές συσκευή από μια ενότητα IoT.
- Μια *λειτουργική μονάδα Μεταβλητό εκτυπωτή* που ερμηνεύει τηλεμετρίας από τη συσκευή Μεταβλητό και να εκτυπώνει μορφοποιημένο δεδομένων στην κονσόλα για να ενεργοποιήσετε την αντιμετώπιση προβλημάτων και τον εντοπισμό σφαλμάτων.

### <a name="how-data-flows-through-the-gateway"></a>Τον τρόπο ροής δεδομένων μέσω της πύλης

Το παρακάτω διάγραμμα μπλοκ απεικονίζει τη διαδικασία ροής τηλεμετρίας αποστολή δεδομένων:

![](media/iot-hub-gateway-sdk-physical-device/gateway_ble_upload_data_flow.png)

Τα βήματα που τίθεται σε ένα στοιχείο τηλεμετρίας ταξιδεύετε από μια συσκευή Μεταβλητό σε διανομέα IoT είναι:

1. Η συσκευή Μεταβλητό δημιουργεί ένα δείγμα θερμοκρασίας και αποστέλλει μέσω Bluetooth στη λειτουργική μονάδα Μεταβλητό στο της πύλης.
2. Η λειτουργική μονάδα Μεταβλητό λαμβάνει το δείγμα και το δημοσιεύει broker μαζί με τη διεύθυνση MAC της συσκευής.
3. Η ενότητα αντιστοίχισης ταυτότητας παίρνει αυτό το μήνυμα και χρησιμοποιεί έναν εσωτερικό πίνακα για να μεταφράσετε τη διεύθυνση MAC της συσκευής σε μια ταυτότητα συσκευής IoT διανομέα (ένα Αναγνωριστικό συσκευής και κλειδί συσκευής). Στη συνέχεια, δημοσιεύει ένα νέο μήνυμα που περιέχει το δείγμα δεδομένων θερμοκρασίας, τη διεύθυνση MAC στη συσκευή, το Αναγνωριστικό συσκευής και το κλειδί συσκευής.
4. Τη λειτουργική μονάδα διανομέα IoT λαμβάνει αυτό το νέο μήνυμα (που δημιουργήθηκε από τη λειτουργική μονάδα αντιστοίχισης ταυτότητας) και το δημοσιεύει IoT διανομέα.
5. Η λειτουργική μονάδα καταγραφής καταγράφει όλα τα μηνύματα από το broker σε ένα αρχείο στο δίσκο.

Το παρακάτω διάγραμμα μπλοκ απεικονίζει τη διαδικασία ροής δεδομένων εντολή συσκευή:

![](media/iot-hub-gateway-sdk-physical-device/gateway_ble_command_data_flow.png)

1. Η λειτουργική μονάδα IoT διανομέα σταθμοσκοπεί περιοδικά την ενότητα IoT για νέα μηνύματα εντολή.
2. Όταν η λειτουργική μονάδα διανομέα IoT λαμβάνει ένα νέο μήνυμα εντολή, αυτό το δημοσιεύει broker.
3. Η ενότητα αντιστοίχισης ταυτότητας παίρνει το μήνυμα εντολή και χρησιμοποιεί έναν εσωτερικό πίνακα για να μεταφράσετε το Αναγνωριστικό συσκευής διανομέα IoT σε μια συσκευή διεύθυνση MAC. Στη συνέχεια, δημοσιεύει ένα νέο μήνυμα που περιλαμβάνει τη διεύθυνση MAC της συσκευής προορισμού στο χάρτη ιδιότητες του μηνύματος.
4. Μεταβλητό Cloud λειτουργική μονάδα συσκευής παίρνει αυτό το μήνυμα και αυτό μεταφράζεται σε την κατάλληλη οδηγία Συμβατές για τη λειτουργική μονάδα Μεταβλητό. Στη συνέχεια, δημοσιεύει ένα νέο μήνυμα.
5. Η λειτουργική μονάδα Μεταβλητό παίρνει αυτό το μήνυμα και εκτελεί την οδηγία εισόδου/εξόδου κατά την επικοινωνία με τη συσκευή Μεταβλητό.
6. Η λειτουργική μονάδα καταγραφής καταγράφει όλα τα μηνύματα από το broker σε ένα αρχείο στο δίσκο.

## <a name="prepare-your-hardware"></a>Προετοιμασία το υλικό σας

Αυτό το πρόγραμμα εκμάθησης προϋποθέτει ότι χρησιμοποιείτε μια συσκευή [SensorTag οργάνων Τέξας](http://www.ti.com/ww/en/wireless_connectivity/sensortag2015/index.html) συνδεδεμένο σε έναν πίνακα Intel Edison.

### <a name="set-up-the-edison-board"></a>Ρύθμιση στον πίνακα Edison

Πριν ξεκινήσετε, πρέπει να βεβαιωθείτε ότι μπορείτε να συνδεθείτε συσκευή Edison σας ασύρματο δίκτυο. Για να ρυθμίσετε τη συσκευή σας Edison, πρέπει να συνδέσετε με έναν κεντρικό υπολογιστή. Intel παρέχει οδηγοί για τα ακόλουθα λειτουργικά συστήματα για γρήγορα αποτελέσματα:

- [Γρήγορα αποτελέσματα με τον πίνακα Intel Edison ανάπτυξης σε Windows 64-bit][lnk-setup-win64].
- [Γρήγορα αποτελέσματα με τον πίνακα Intel Edison ανάπτυξης σε Windows 32-bit][lnk-setup-win32].
- [Γρήγορα αποτελέσματα με τον πίνακα Intel Edison ανάπτυξης στο Mac OS X][lnk-setup-osx].
- [Γρήγορα αποτελέσματα με τον πίνακα Edison Intel® σε Linux][lnk-setup-linux].

Για να ρυθμίσετε τη συσκευή σας Edison και εξοικειωθείτε με αυτό, θα πρέπει να ολοκληρώσετε όλα τα βήματα σε αυτές τις "Γρήγορα αποτελέσματα" άρθρα εκτός από το τελευταίο βήμα, "Επιλέξτε IDE", που είναι απαραίτητη για το τρέχον πρόγραμμα εκμάθησης. Στο τέλος της διαδικασίας εγκατάστασης Edison έχετε:

- Αναβοσβήνει σας Edison με το πιο πρόσφατο υλικολογισμικό.
- Σύνδεση μια σειρά από τον κεντρικό υπολογιστή για να το Edison.
- Εκτελέστε τη δέσμη ενεργειών **configure_edison** για να ορίσετε έναν κωδικό πρόσβασης και ενεργοποίηση WiFi στην Edison σας.

### <a name="enable-connectivity-to-the-sensortag-device-from-your-edison-board"></a>Ενεργοποίηση των συνδέσεων στη συσκευή SensorTag από τον πίνακα Edison

Πριν να εκτελέσετε το δείγμα, πρέπει να βεβαιωθείτε ότι ο πίνακας Edison σας να συνδεθείτε στη συσκευή SensorTag.

Πρώτα πρέπει να βεβαιωθείτε ότι το Edison να συνδεθείτε στη συσκευή SensorTag.

1. Κατάργηση του αποκλεισμού bluetooth στην το Edison και ελέγξτε ότι ο αριθμός έκδοσης είναι **5.37**.
    
    ```
    rfkill unblock bluetooth
    bluetoothctl --version
    ```

2. Εκτελέστε την εντολή **bluetoothctl** . Τώρα είστε στο κέλυφος ένα αλληλεπιδραστικό bluetooth. 

3. Πληκτρολογήστε την εντολή **power στη** δύναμη προς τα επάνω στον ελεγκτή bluetooth. Θα πρέπει να βλέπετε δεδομένα εξόδου όπως:
    
    ```
    [NEW] Controller 98:4F:EE:04:1F:DF edison [default]
    ```

4. Ενώ εξακολουθείτε να στο κέλυφος αλληλεπιδραστικών bluetooth, πληκτρολογήστε την εντολή **σάρωση σε** για να σαρώσετε για συσκευές bluetooth. Θα πρέπει να βλέπετε δεδομένα εξόδου όπως:
    
    ```
    Discovery started
    [CHG] Controller 98:4F:EE:04:1F:DF Discovering: yes
    ```

5. Εντοπίζουν τη συσκευή SensorTag πατώντας το μικρό κουμπί (την πράσινη Ένδειξη πρέπει να flash). Το Edison πρέπει να ανακαλύψετε στη συσκευή SensorTag:
    
    ```
    [NEW] Device A0:E6:F8:B5:F6:00 CC2650 SensorTag
    [CHG] Device A0:E6:F8:B5:F6:00 TxPower: 0
    [CHG] Device A0:E6:F8:B5:F6:00 RSSI: -43
    ```
    
    Σε αυτό το παράδειγμα, μπορείτε να δείτε ότι η διεύθυνση MAC της συσκευής SensorTag είναι **A0:E6:F8:B5:F6:00**.

6. Απενεργοποιήστε τη σάρωση, πληκτρολογώντας την εντολή **σάρωση απενεργοποίηση** .
    
    ```
    [CHG] Controller 98:4F:EE:04:1F:DF Discovering: no
    Discovery stopped
    ```

7. Σύνδεση με τη συσκευή σας SensorTag χρησιμοποιώντας τη διεύθυνση MAC εισάγοντας **σύνδεση \<διεύθυνση MAC >**. Σημειώστε ότι το παρακάτω δείγμα εξόδου είναι συντετμημένη μορφή:
    
    ```
    Attempting to connect to A0:E6:F8:B5:F6:00
    [CHG] Device A0:E6:F8:B5:F6:00 Connected: yes
    Connection successful
    [CHG] Device A0:E6:F8:B5:F6:00 UUIDs: 00001800-0000-1000-8000-00805f9b34fb
    ...
    [NEW] Primary Service
            /org/bluez/hci0/dev_A0_E6_F8_B5_F6_00/service000c
            Device Information
    ...
    [CHG] Device A0:E6:F8:B5:F6:00 GattServices: /org/bluez/hci0/dev_A0_E6_F8_B5_F6_00/service000c
    ...
    [CHG] Device A0:E6:F8:B5:F6:00 Name: SensorTag 2.0
    [CHG] Device A0:E6:F8:B5:F6:00 Alias: SensorTag 2.0
    [CHG] Device A0:E6:F8:B5:F6:00 Modalias: bluetooth:v000Dp0000d0110
    ```
    
    Σημείωση: Μπορείτε να παραθέσετε τα χαρακτηριστικά GATT της συσκευής ξανά, χρησιμοποιώντας την εντολή **χαρακτηριστικά λίστας** .

8. Μπορείτε να αποσυνδέσετε πλέον από τη συσκευή σας χρησιμοποιώντας την εντολή **Αποσύνδεση** και, στη συνέχεια, Έξοδος από το κέλυφος bluetooth χρησιμοποιώντας την εντολή **Έξοδος από** :
    
    ```
    Attempting to disconnect from A0:E6:F8:B5:F6:00
    Successful disconnected
    [CHG] Device A0:E6:F8:B5:F6:00 Connected: no
    ```

Τώρα είστε έτοιμοι να εκτελέσετε το δείγμα Μεταβλητό πύλης στη συσκευή σας Edison.

## <a name="run-the-ble-gateway-sample"></a>Εκτελέστε το δείγμα Μεταβλητό πύλης

Για να εκτελέσετε το δείγμα Μεταβλητό στην Edison σας, πρέπει να ολοκληρώσετε τρεις εργασίες:

- Ρύθμιση παραμέτρων δύο συσκευές δείγμα στο κέντρο IoT σας.
- Δημιουργήστε το SDK πύλης IoT στη συσκευή σας Edison.
- Ρύθμιση παραμέτρων και να εκτελέσετε το δείγμα Μεταβλητό στη συσκευή σας Edison.

Κατά την εγγραφή, το SDK πύλης IoT υποστηρίζει μόνο πυλών που χρησιμοποιούν λειτουργικές μονάδες Μεταβλητό στο Linux.

### <a name="configure-two-sample-devices-in-your-iot-hub"></a>Ρύθμιση παραμέτρων δύο συσκευές δείγμα στο κέντρο σας IoT

- [Δημιουργήστε ένα διανομέα IoT] [ lnk-create-hub] σε Azure συνδρομή σας, θα χρειαστεί το όνομα του Κέντρο σας για να ολοκληρώσετε αυτόν τον οδηγό. Εάν δεν έχετε ένα λογαριασμό, μπορείτε να δημιουργήσετε έναν [δωρεάν λογαριασμό] [ lnk-free-trial] σε λίγα λεπτά.
- Προσθέστε μια συσκευή που ονομάζεται **SensorTag_01** με το διανομέα IoT και σημειώστε το αναγνωριστικό και συσκευή κλειδί. Μπορείτε να χρησιμοποιήσετε την [Εξερεύνηση συσκευή ή από την Εξερεύνηση iothub] [ lnk-explorer-tools] εργαλεία για να προσθέσετε αυτήν τη συσκευή για να την ενότητα IoT που δημιουργήσατε στο προηγούμενο βήμα και για την ανάκτηση του κλειδιού. Θα αντιστοιχίσετε αυτήν τη συσκευή στη συσκευή SensorTag όταν ρυθμίζετε τις παραμέτρους της πύλης.

### <a name="build-the-iot-gateway-sdk-on-your-edison-device"></a>Δημιουργία του SDK πύλης IoT στη συσκευή σας Edison

Την έκδοση του **git** στην το Edsion δεν υποστηρίζει submodules. Για να κάνετε λήψη της πλήρους προέλευσης για το SDK πύλης IoT για να το Edison έχετε δύο επιλογές:

- Επιλογή #1: Κλωνοποίηση το [Azure IoT πύλης SDK] [ lnk-sdk] αποθετήριο στην Edison σας και, στη συνέχεια, κλωνοποίηση με μη αυτόματο τρόπο το αποθετήριο δεδομένων για κάθε submodule.
- Επιλογή #2: Κλωνοποίηση το [Azure IoT πύλης SDK] [ lnk-sdk] αποθετήριο δεδομένων σε υπολογιστή όπου **git** υποστηρίζει submodules και, στη συνέχεια, αντιγράψτε το αρχείο φύλαξης ολοκλήρωσης με submodules σε Edison σας.

Εάν επιλέξετε την επιλογή #2, χρησιμοποιήστε τις παρακάτω εντολές **git** η κλωνοποίηση του SDK πύλης IoT και όλα τα submodules:

```
git clone --recursive https://github.com/Azure/azure-iot-gateway-sdk.git 
git submodule update --init --recursive
```

Μπορείτε, στη συνέχεια, θα πρέπει να zip του αποθετηρίου ολόκληρη τοπική σε ένα αρχείο αρχειοθέτησης μία πριν την αντιγραφή της για να την Edison. Μπορείτε να χρησιμοποιήσετε ένα βοηθητικό πρόγραμμα όπως **pscp** , το οποίο περιλαμβάνεται με το **Putty** για να αντιγράψετε το αρχείο αρχειοθέτησης το Edison. Για παράδειγμα:

```
pscp .\gatewaysdk.zip root@192.168.0.45:/home/root
```

Όταν έχετε ένα πλήρες αντίγραφο του αποθετηρίου IoT πύλης SDK στην Edison σας, μπορείτε να δημιουργήσετε χρησιμοποιώντας την ακόλουθη εντολή από το φάκελο που περιέχει το SDK:

```
./tools/build.sh
```

### <a name="configure-and-run-the-ble-sample-on-your-edison-device"></a>Ρύθμιση παραμέτρων και να εκτελέσετε το δείγμα Μεταβλητό στη συσκευή σας Edison

Να γίνεται εκκίνηση και να εκτελέσετε το δείγμα, πρέπει να ρυθμίσετε τις παραμέτρους κάθε λειτουργική μονάδα που συμμετέχει σε της πύλης. Αυτή η ρύθμιση παραμέτρων παρέχεται σε ένα αρχείο JSON και πρέπει να ρυθμίσετε τις παραμέτρους όλες οι πέντε συμμετέχοντα λειτουργικές μονάδες. Υπάρχει ένα δείγμα αρχείου JSON που παρέχονται στο αποθετήριο που ονομάζεται **gateway_sample.json** , το οποίο μπορείτε να χρησιμοποιήσετε ως σημείο εκκίνησης για τη δημιουργία του δικού σας αρχείο ρύθμισης παραμέτρων. Αυτό το αρχείο βρίσκεται στο φάκελο **ble_gateway_hl/δείγματα/src** στο τοπικού αντιγράφου του αποθετηρίου IoT πύλης SDK.

Οι παρακάτω ενότητες περιγράφουν πώς μπορείτε να επεξεργαστείτε αυτό το αρχείο ρύθμισης παραμέτρων για το δείγμα Μεταβλητό και λαμβάνεται ως δεδομένο ότι το αρχείο φύλαξης IoT πύλης SDK είναι σε το **/home/root/azure-iot-gateway-sdk /** φάκελο στη συσκευή σας Edison. Εάν το αποθετήριο δεδομένων είναι σε κάποιο άλλο σημείο, θα πρέπει να προσαρμόσετε τις διαδρομές αντίστοιχα:

#### <a name="logger-configuration"></a>Ρύθμιση παραμέτρων καταγραφής

Υπό την προϋπόθεση ότι το αρχείο φύλαξης πύλης βρίσκεται στο φάκελο **/home/root/azure-iot-gateway-sdk /**, ρυθμίστε τις παραμέτρους της λειτουργικής μονάδας καταγραφής ως εξής:

```json
{
    "module name": "logger",
    "module path": "/home/root/azure-iot-gateway-sdk/build/modules/logger/liblogger_hl.so",
    "args":
    {
        "filename":"/home/root/gw_logger.log"
    }
}
```

#### <a name="ble-module-configuration"></a>Ρύθμιση παραμέτρων Μεταβλητό λειτουργική μονάδα

Το δείγμα ρύθμισης παραμέτρων για τη συσκευή Μεταβλητό προϋποθέτει μια συσκευή SensorTag οργάνων Τέξας. Οποιαδήποτε τυπική συσκευή Μεταβλητό που μπορεί να λειτουργήσει ως ένα περιφερειακών GATT θα πρέπει να λειτουργούν, αλλά θα πρέπει να ενημερώσετε τα αναγνωριστικά χαρακτηριστική GATT και τα δεδομένα (για οδηγίες εγγραφής). Προσθέστε τη διεύθυνση MAC της συσκευής σας SensorTag: 

```json
{
  "module name": "SensorTag",
  "module path": "/home/root/azure-iot-gateway-sdk/build/modules/ble/libble_hl.so",
  "args": {
    "controller_index": 0,
    "device_mac_address": "<<AA:BB:CC:DD:EE:FF>>",
    "instructions": [
      {
        "type": "read_once",
        "characteristic_uuid": "00002A24-0000-1000-8000-00805F9B34FB"
      },
      {
        "type": "read_once",
        "characteristic_uuid": "00002A25-0000-1000-8000-00805F9B34FB"
      },
      {
        "type": "read_once",
        "characteristic_uuid": "00002A26-0000-1000-8000-00805F9B34FB"
      },
      {
        "type": "read_once",
        "characteristic_uuid": "00002A27-0000-1000-8000-00805F9B34FB"
      },
      {
        "type": "read_once",
        "characteristic_uuid": "00002A28-0000-1000-8000-00805F9B34FB"
      },
      {
        "type": "read_once",
        "characteristic_uuid": "00002A29-0000-1000-8000-00805F9B34FB"
      },
      {
        "type": "write_at_init",
        "characteristic_uuid": "F000AA02-0451-4000-B000-000000000000",
        "data": "AQ=="
      },
      {
        "type": "read_periodic",
        "characteristic_uuid": "F000AA01-0451-4000-B000-000000000000",
        "interval_in_ms": 1000
      },
      {
        "type": "write_at_exit",
        "characteristic_uuid": "F000AA02-0451-4000-B000-000000000000",
        "data": "AA=="
      }
    ]
  }
}
```

#### <a name="iot-hub-module"></a>Λειτουργική μονάδα IoT διανομέα

Προσθέστε το όνομα του Κέντρο IoT σας. Η τιμή επίθημα είναι συνήθως **azure devices.net**:

```json
{
  "module name": "IoTHub",
  "module path": "/home/root/azure-iot-gateway-sdk/build/modules/iothub/libiothub_hl.so",
  "args": {
    "IoTHubName": "<<Azure IoT Hub Name>>",
    "IoTHubSuffix": "<<Azure IoT Hub Suffix>>",
    "Transport": "HTTP"
  }
}
```

#### <a name="identity-mapping-module-configuration"></a>Ρύθμιση παραμέτρων λειτουργικής μονάδας αντιστοίχισης ταυτότητας

Προσθέστε τη διεύθυνση MAC της συσκευής σας SensorTag και το αναγνωριστικό συσκευής και κλειδί της συσκευής **SensorTag_01** έχετε προσθέσει στο κέντρο IoT σας:

```json
{
  "module name": "mapping",
  "module path": "/home/root/azure-iot-gateway-sdk/build/modules/identitymap/libidentity_map_hl.so",
  "args": [
    {
      "macAddress": "<<AA:BB:CC:DD:EE:FF>>",
      "deviceId": "<<Azure IoT Hub Device ID>>",
      "deviceKey": "<<Azure IoT Hub Device Key>>"
    }
  ]
}
```

#### <a name="ble-printer-module-configuration"></a>Ρύθμιση παραμέτρων λειτουργικής μονάδας Μεταβλητό εκτυπωτή

```json
{
    "module name": "BLE Printer",
    "module path": "/home/root/azure-iot-gateway-sdk/build/samples/ble_gateway_hl/ble_printer/libble_printer.so",
    "args": null
}
```

#### <a name="routing-configuration"></a>Ρύθμιση παραμέτρων δρομολόγησης

Η παρακάτω ρύθμιση παραμέτρων εξασφαλίζει ότι τα εξής:
- Η λειτουργική μονάδα **καταγραφής** λαμβάνει και καταγραφή όλων των μηνυμάτων.
- Η λειτουργική μονάδα **SensorTag** στέλνει μηνύματα τόσο την **Αντιστοίχιση** και λειτουργικές μονάδες **Μεταβλητό εκτυπωτή** .
- Η λειτουργική μονάδα **αντιστοίχισης** στέλνει μηνύματα στη λειτουργική μονάδα **IoTHub** να αποστέλλονται προς τα επάνω για να το Κέντρο IoT σας.
- Η λειτουργική μονάδα **IoTHub** στέλνει μηνύματα της λειτουργικής μονάδας **αντιστοίχισης** .
- Η λειτουργική μονάδα **αντιστοίχισης** στέλνει μηνύματα τη λειτουργική μονάδα **SensorTag** .

```json
"links" : [
    {"source" : "*", "sink" : "Logger" },
    {"source" : "SensorTag", "sink" : "mapping" },
    {"source" : "SensorTag", "sink" : "BLE Printer" },
    {"source" : "mapping", "sink" : "IoTHub" },
    {"source" : "IoTHub", "sink" : "mapping" },
    {"source" : "mapping", "sink" : "SensorTag" }
  ]
```

Για να εκτελέσετε το δείγμα μπορείτε να εκτελέσετε το **ble_gateway_hl** δυαδικό διέρχεται η διαδρομή προς το αρχείο ρύθμισης παραμέτρων JSON. Αν χρησιμοποιήσατε το αρχείο **gateway_sample.json** , η εντολή που εκτελείται είναι κάπως έτσι:

```
./build/samples/ble_gateway_hl/ble_gateway_hl ./samples/ble_gateway_hl/src/gateway_sample.json
```

Ίσως χρειαστεί να πατήσετε το μικρό κουμπί στη συσκευή SensorTag για να εντοπίζουν πριν να εκτελέσετε το δείγμα.

Όταν εκτελείτε το δείγμα, μπορείτε να χρησιμοποιήσετε την [Εξερεύνηση συσκευή ή από την Εξερεύνηση iothub] [ lnk-explorer-tools] εργαλείο για την παρακολούθηση των μηνυμάτων της πύλης προωθεί από τη συσκευή SensorTag.

## <a name="send-cloud-to-device-messages"></a>Αποστολή μηνυμάτων cloud-σε-συσκευή

Η λειτουργική μονάδα Μεταβλητό υποστηρίζει επίσης αποστολή οδηγίες από την ενότητα IoT Azure στη συσκευή. Μπορείτε να χρησιμοποιήσετε την [Εξερεύνηση συσκευή διανομέα IoT Azure](https://github.com/Azure/azure-iot-sdks/blob/master/tools/DeviceExplorer/doc/how_to_use_device_explorer.md) ή η [Εξερεύνηση διανομέα IoT](https://github.com/Azure/azure-iot-sdks/tree/master/tools/iothub-explorer) για την αποστολή μηνυμάτων JSON που μεταβιβάζει τη λειτουργική μονάδα πύλης Μεταβλητό στη συσκευή Μεταβλητό. Για παράδειγμα, εάν χρησιμοποιείτε τη συσκευή SensorTag οργάνων Τέξας, στη συνέχεια, μπορείτε να στείλετε τα ακόλουθα μηνύματα JSON στη συσκευή από διανομέα IoT.

- Επαναφορά όλων LED και βομβητή (απενεργοποιήστε τις)

    ```json
    {
      "type": "write_once",
      "characteristic_uuid": "F000AA65-0451-4000-B000-000000000000",
      "data": "AA=="
    }
    ```

- Ρυθμίστε τις παραμέτρους εισόδου/εξόδου ως 'remote'

    ```json
    {
      "type": "write_once",
      "characteristic_uuid": "F000AA66-0451-4000-B000-000000000000",
      "data": "AQ=="
    }
    ```

- Ενεργοποιήστε την κόκκινη Ένδειξη

    ```json
    {
      "type": "write_once",
      "characteristic_uuid": "F000AA65-0451-4000-B000-000000000000",
      "data": "AQ=="
    }
    ```

- Ενεργοποιήστε την πράσινη Ένδειξη

    ```json
    {
      "type": "write_once",
      "characteristic_uuid": "F000AA65-0451-4000-B000-000000000000",
      "data": "Ag=="
    }
    ```

- Ενεργοποιήστε την επιλογή βομβητή

    ```json
    {
      "type": "write_once",
      "characteristic_uuid": "F000AA65-0451-4000-B000-000000000000",
      "data": "BA=="
    }
    ```

Η προεπιλεγμένη συμπεριφορά για χρήση του πρωτοκόλλου HTTP για να συνδεθείτε με το Κέντρο IoT συσκευή είναι να ελέγξετε κάθε 25 λεπτά για μια νέα εντολή. Επομένως, εάν στέλνετε πολλές ξεχωριστές εντολές πρέπει να περιμένετε 25 λεπτά για τη συσκευή για να λάβετε κάθε εντολή.

> [AZURE.NOTE] Η πύλη ελέγχει για τις νέες εντολές επίσης κάθε φορά που ξεκινά, ώστε να μπορείτε να επιβάλετε το για να επεξεργαστείτε μια εντολή Διακοπή και εκκίνηση της πύλης.

## <a name="next-steps"></a>Επόμενα βήματα

Εάν θέλετε να αποκτήσετε μια πιο σύνθετη Κατανόηση του SDK πύλης IoT και να πειραματιστείτε με ορισμένα παραδείγματα κώδικα, επισκεφθείτε τα παρακάτω προγράμματα εκμάθησης για προγραμματιστές και τους πόρους:

- [SDK Azure IoT πύλης][lnk-sdk]

Για να εξερευνήσετε περαιτέρω τις δυνατότητες του IoT διανομέα, ανατρέξτε στα θέματα:

- [Οδηγός για προγραμματιστές][lnk-devguide]

<!-- Links -->
[lnk-ble-samplecode]: https://github.com/Azure/azure-iot-gateway-sdk/blob/master/samples/ble_gateway_hl
[lnk-free-trial]: https://azure.microsoft.com/pricing/free-trial/
[lnk-explorer-tools]: https://github.com/Azure/azure-iot-sdks/blob/master/doc/manage_iot_hub.md
[lnk-setup-win64]: https://software.intel.com/get-started-edison-windows
[lnk-setup-win32]: https://software.intel.com/get-started-edison-windows-32
[lnk-setup-osx]: https://software.intel.com/get-started-edison-osx
[lnk-setup-linux]: https://software.intel.com/get-started-edison-linux
[lnk-sdk]: https://github.com/Azure/azure-iot-gateway-sdk/


[lnk-devguide]: iot-hub-devguide.md
[lnk-create-hub]: iot-hub-create-through-portal.md 
