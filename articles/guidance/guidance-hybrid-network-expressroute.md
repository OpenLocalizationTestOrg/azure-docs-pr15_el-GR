<properties
   pageTitle="Εφαρμογή ενός υβριδικού αρχιτεκτονική δικτύου με Azure ExpressRoute | Αναφορά αρχιτεκτονική | Microsoft Azure"
   description="Πώς μπορείτε να υλοποιήσετε μια αρχιτεκτονική ασφαλούς τοποθεσίας σε τοποθεσία δικτύου που εκτείνεται σε μια Azure εικονικού δικτύου και ένα δίκτυο εσωτερικής συνδεδεμένη με τη χρήση Azure ExpressRoute."
   services=""
   documentationCenter="na"
   authors="telmosampaio"
   manager="christb"
   editor=""
   tags=""/>

<tags
   ms.service="guidance"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="10/24/2016"
   ms.author="telmos"/>

# <a name="implementing-a-hybrid-network-architecture-with-azure-expressroute"></a>Εφαρμογή ενός υβριδικού αρχιτεκτονική δικτύου με Azure ExpressRoute

[AZURE.INCLUDE [pnp-header](../../includes/guidance-pnp-header-include.md)]

Σε αυτό το άρθρο περιγράφει τις βέλτιστες πρακτικές για τη σύνδεση ένα δίκτυο εσωτερικής εγκατάστασης με εικονικών δικτύων σε Azure χρησιμοποιώντας ExpressRoute. ExpressRoute συνδέσεις πραγματοποιούνται με χρήση ιδιωτικών αποκλειστικό σύνδεσης μέσω μιας εταιρείας παροχής συνδεσιμότητας τρίτων κατασκευαστών. Της ιδιωτικής σύνδεσης εκτείνεται το δίκτυο εσωτερικής εγκατάστασης στο Azure παρέχοντας πρόσβαση τις δικές σας υποδομή IaaS σε χρησιμοποιείται σε PaaS υπηρεσίες και τις υπηρεσίες του Office 365 ΑΔΑ Azure, δημόσια τελικά σημεία. Αυτό το έγγραφο εστιάζει σχετικά με τη χρήση ExpressRoute για να συνδεθείτε με ένα μεμονωμένο Azure εικονικό δίκτυο (VNet) με αυτό που ονομάζεται διεισδύουν ιδιωτικό.

> [AZURE.NOTE] Azure έχει δύο διαφορετικές ανάπτυξης μοντέλα: [Διαχείριση πόρων] [ resource-manager-overview] και κλασική. Σε αυτό το σχέδιο χρησιμοποιεί διαχείριση πόρων, η οποία η Microsoft συνιστά για νέες αναπτύξεις.

Τυπική χρήση υποθέσεις για αυτήν την αρχιτεκτονική περιλαμβάνουν τα εξής:

- Υβριδική εφαρμογές όπου είναι κατανεμημένες φόρτους εργασίας ανάμεσα σε ένα δίκτυο εσωτερικής εγκατάστασης και Azure.

- Εφαρμογές που εκτελούνται ευρείας κλίμακας, κρίσιμης σημασίας φόρτους εργασίας που απαιτούν μεγάλο βαθμό κλιμάκωση.

- Εγκαταστάσεις μεγάλης κλίμακας δημιουργίας αντιγράφων ασφαλείας και επαναφοράς για τα δεδομένα που πρέπει να είναι αποθηκευμένο εκτός τοποθεσίας.

- Χειρισμός Big Data φόρτους εργασίας.

- Χρήση Azure ως τοποθεσία αποκατάστασης.

> [AZURE.NOTE] Η [Τεχνική επισκόπηση ExpressRoute] [ expressroute-technical-overview] παρέχει μια εισαγωγή στη ExpressRoute.

## <a name="architecture-diagram"></a>Διάγραμμα αρχιτεκτονικής

Το παρακάτω διάγραμμα επισημαίνει τα σημαντικά στοιχεία σε αυτήν την αρχιτεκτονική:

> Ένα έγγραφο του Visio που περιλαμβάνει αυτό το διάγραμμα αρχιτεκτονική είναι διαθέσιμο για λήψη στο [Κέντρο λήψης αρχείων της Microsoft]το[visio-download]. Σε αυτό το διάγραμμα είναι στη σελίδα "Υβριδική network - ER".

![[0]][0]

- **Azure εικονικών δικτύων (VNets).** Κάθε VNet βρίσκεται σε μία μόνο περιοχή Azure και να φιλοξενήσετε πολλά επίπεδα εφαρμογής. Εφαρμογή βαθμίδες μπορεί να φέρουν κατά διαστήματα χρησιμοποιώντας δευτερεύοντα δίκτυα σε κάθε VNet ή/και δικτύου ομάδες ασφαλείας (NSGs). 

- **Azure δημόσιες υπηρεσίες.** Αυτά είναι Azure υπηρεσίες που μπορεί να χρησιμοποιηθεί μέσα σε μια εφαρμογή υβριδική. Αυτές τις υπηρεσίες είναι επίσης διαθέσιμες μέσω του δημόσιου Internet, αλλά πρόσβαση σε αυτά μέσω ενός κυκλώματος ExpressRoute παρέχει χαμηλής λανθάνων χρόνος και πιο προβλέψιμων επιδόσεων εφόσον δεν υπερβαίνει τα κίνηση μέσω του Internet. Συνδέσεις που εκτελούνται με τη χρήση **δημόσιων διεισδύουν**, με διευθύνσεις που έχουν είτε που ανήκουν από την εταιρεία σας ή που παρέχεται από την υπηρεσία παροχής σύνδεσης. 

- **Υπηρεσίες του Office 365.** Αυτά είναι τα διαθέσιμων εφαρμογών του Office 365 και τις υπηρεσίες που παρέχονται από τη Microsoft. Συνδέσεις που εκτελούνται, χρησιμοποιώντας το **Microsoft διεισδύουν**, με διευθύνσεις που έχουν είτε που ανήκουν από την εταιρεία σας ή που παρέχεται από την υπηρεσία παροχής σύνδεσης.

>[AZURE.NOTE] Μπορείτε επίσης να συνδεθείτε απευθείας στο Microsoft CRM Online μέσω ενός διεισδύουν της Microsoft.

- **Εταιρικό δίκτυο εσωτερικής εγκατάστασης.** Αυτό είναι ένα δίκτυο υπολογιστές και συσκευές, συνδεδεμένοι μέσω ενός ιδιωτικού δικτύου τοπικό εκτελούνται μέσα σε μια εταιρεία.

- **Τοπική άκρη δρομολογητές.** Αυτά είναι δρομολογητές που συνδέονται στο δίκτυο εσωτερικής εγκατάστασης με το κύκλωμα ελέγχονται από την υπηρεσία παροχής. Ανάλογα με τον τρόπο παρέχεται τη σύνδεσή σας, θα πρέπει να παρέχουν οι δημόσιες διευθύνσεις IP που χρησιμοποιούνται από τους δρομολογητές. 

- **Microsoft edge δρομολογητές.** Αυτά είναι δύο δρομολογητών σε μια ρύθμιση παραμέτρων ιδιαίτερα διαθέσιμη ενεργούς. Αυτοί οι δρομολογητές επιτρέπουν μια υπηρεσία παροχής σύνδεσης για να συνδέσετε τους κυκλώματα απευθείας στο κέντρο δεδομένων. Ανάλογα με τον τρόπο παρέχεται τη σύνδεσή σας, θα πρέπει να παρέχουν οι δημόσιες διευθύνσεις IP που χρησιμοποιούνται από τους δρομολογητές.

- **Κύκλωμα ExpressRoute.** Αυτό είναι ένα επίπεδο 2 ή κυκλώματος επιπέδου 3 που παρέχεται από την υπηρεσία παροχής συνδεσιμότητας αυτό το δίκτυο σύνδεσμοι το εσωτερικής εγκατάστασης με Azure μέσω του άκρου δρομολογητών. Το κύκλωμα χρησιμοποιεί την υποδομή υλικού που ελέγχονται από την υπηρεσία παροχής σύνδεσης.

- **Υπηρεσίες παροχής σύνδεσης.** Αυτές είναι εταιρείες που παρέχουν μια σύνδεση είτε χρησιμοποιώντας επιπέδου 2 ή επιπέδου 3 τη σύνδεση μεταξύ του κέντρου δεδομένων και ένα κέντρο δεδομένων του Azure.

## <a name="recommendations"></a>Συστάσεις

Azure προσφέρει πολλές διαφορετικές πόρους και τύπους πόρων, ώστε να μπορεί να είναι αυτή η αναφορά αρχιτεκτονική παρασχεθεί πολλούς διαφορετικούς τρόπους. Παρέχουμε ένα πρότυπο από διαχειριστή πόρων Azure για να εγκαταστήσετε την αρχιτεκτονική αναφοράς που ακολουθεί αυτές τις συστάσεις. Εάν επιλέξετε να δημιουργήσετε το δικό σας αρχιτεκτονική αναφορά θα πρέπει να ακολουθήσετε αυτές τις συστάσεις, εκτός αν έχετε συγκεκριμένες απαιτήσεις που σύσταση υπερβαίνει το μέγεθος.

### <a name="connectivity-providers"></a>Υπηρεσίες παροχής συνδεσιμότητας

Επιλέξτε μια κατάλληλη υπηρεσία παροχής συνδεσιμότητας ExpressRoute για την τοποθεσία σας. Για να αποκτήσετε μια λίστα συνδεσιμότητας υπηρεσιών παροχής διαθέσιμα στην τοποθεσία σας, χρησιμοποιήστε την ακόλουθη εντολή Azure PowerShell:

```powershell
Get-AzureRmExpressRouteServiceProvider
```

Υπηρεσίες παροχής συνδεσιμότητας ExpressRoute σύνδεση κέντρο δεδομένων σας στη Microsoft με τους εξής τρόπους:

- **Από κοινού βρίσκεται στο μια ανταλλαγή cloud.** Εάν βρίσκεστε από κοινού σε εγκατάσταση με μια ανταλλαγή cloud, μπορείτε να παραγγείλετε εικονικές συνδέσεις ανεξαρτήτως στο cloud της Microsoft μέσω της υπηρεσίας παροχής από κοινού θέση Ethernet exchange. Υπηρεσίες παροχής από κοινού θέση να προσφέρουν είτε επιπέδου 2 σταυρό-, ή διαχειριζόμενων Layer 3 σταυρό-συνδέσεις μεταξύ υποδομής σας στη λειτουργία θέση από κοινού και του Microsoft cloud...

- **Συνδέσεις Ethernet από σημείο σε σημείο.** Μπορείτε να συνδέσετε τα κέντρα δεδομένων/γραφεία σας εσωτερικής εγκατάστασης στο cloud της Microsoft μέσω συνδέσεων από σημείο σε σημείο Ethernet. Υπηρεσίες παροχής Ethernet από σημείο σε σημείο μπορεί να προσφέρει συνδέσεις επιπέδου 2, ή διαχείριση επιπέδου 3 συνδέσεις μεταξύ την τοποθεσία σας και στο cloud της Microsoft.

- **Οποιαδήποτε σε οποιαδήποτε δίκτυα (IPVPN).** Μπορείτε να ενοποιήσετε το WAN με το cloud της Microsoft. Υπηρεσίες παροχής IPVPN (συνήθως MPLS VPN) προσφέρουν οποιαδήποτε σε οποιαδήποτε συνδεσιμότητας μεταξύ σας γραφεία κλάδο και κέντρα δεδομένων. Cloud της Microsoft μπορούν να συνδέονται μεταξύ τους για να σας WAN ώστε να φαίνεται όπως οποιαδήποτε άλλα υποκατάστημα. WAN υπηρεσίες παροχής προσφέρουν συνήθως διαχειριζόμενων συνδεσιμότητας Layer 3.

Για περισσότερες πληροφορίες σχετικά με τις υπηρεσίες παροχής συνδεσιμότητας, ανατρέξτε στο θέμα [ExpressRoute κυκλώματα και τομείς δρομολόγησης][connectivity-providers].

### <a name="expressroute-circuit"></a>ExpressRoute κυκλώματος

Βεβαιωθείτε ότι το την εταιρεία σας ικανοποιεί τις [απαιτήσεις προαπαιτούμενες ExpressRoute] [ expressroute-prereqs] για τη σύνδεση με Azure.

Εάν έχετε κάνει ήδη, προσθέστε ένα δευτερεύον δίκτυο με το όνομα `GatewaySubnet` για να σας VNet Azure και να δημιουργήσετε μια πύλη εικονικού δικτύου ExpressRoute με την υπηρεσία πύλης VPN Azure. Για περισσότερες πληροφορίες σχετικά με αυτήν τη διαδικασία, ανατρέξτε στο θέμα [ροές εργασίας ExpressRoute για προμήθεια κυκλώματος και κυκλώματος μέλη][ExpressRoute-provisioning].

Δημιουργήστε ένα κύκλωμα ExpressRoute ως εξής:

1. Εκτελέστε την ακόλουθη εντολή PowerShell:

    ```powershell
    New-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>> -Location <<location>> -SkuTier <<sku-tier>> -SkuFamily <<sku-family>> -ServiceProviderName <<service-provider-name>> -PeeringLocation <<peering-location>> -BandwidthInMbps <<bandwidth-in-mbps>>
    ```

2. Αποστολή του `ServiceKey` για το νέο κύκλωμα στην υπηρεσία παροχής.

3. Περιμένετε για την υπηρεσία παροχής για την προμήθεια του κυκλώματος. Μπορείτε να επαληθεύσετε την κατάσταση παροχής ενός κυκλώματος, χρησιμοποιώντας την ακόλουθη εντολή PowerShell:

    ```powershell
    Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
    ```

Το `Provisioning state` πεδίο το `Service Provider` ενότητας από το αποτέλεσμα θα αλλάξει από `NotProvisioned` να `Provisioned` όταν το κύκλωμα είναι έτοιμη.

>[AZURE.NOTE]Εάν χρησιμοποιείτε μια σύνδεση επιπέδου 3, η υπηρεσία παροχής που θα πρέπει να ρυθμίσετε και να διαχειριστείτε δρομολόγησης για εσάς. Μπορείτε να παρέχετε τις πληροφορίες που απαιτούνται για να ενεργοποιήσετε την υπηρεσία παροχής για την υλοποίηση τις κατάλληλες διαδρομές.

Εάν χρησιμοποιείτε μια σύνδεση επιπέδου 2, ακολουθήστε τα παρακάτω βήματα:

1. Κράτηση δύο/30 δευτερεύοντα δίκτυα που αποτελείται από έγκυρη δημόσιες διευθύνσεις IP για κάθε τύπο διεισδύουν που θέλετε να εφαρμόσετε. Αυτά τα/30 δευτερεύοντα δίκτυα θα χρησιμοποιηθεί για την παροχή διευθύνσεις IP οι δρομολογητές που χρησιμοποιείται για το κύκλωμα. Εάν εφαρμόζετε ιδιωτικό, δημόσια και Microsoft διεισδύουν, θα χρειαστεί δευτερεύοντα δίκτυα 6 /30 με έγκυρη δημόσιων διευθύνσεων IP.     

2. Ρυθμίστε τις παραμέτρους δρομολόγησης για το κύκλωμα ExpressRoute. Πρέπει να εκτελέσετε την εντολή κάτω από κάθε τύπο διεισδύουν που θέλετε να ρυθμίσετε τις παραμέτρους (ιδιωτικό, δημόσια και Microsoft).

    >[AZURE.NOTE]Ανατρέξτε στο θέμα [Δημιουργία και τροποποίηση δρομολόγησης για ένα κύκλωμα ExpressRoute] [ configure-expressroute-routing] για λεπτομέρειες. Χρησιμοποιήστε τις παρακάτω εντολές PowerShell για να προσθέσετε ένα δίκτυο διεισδύουν για τη δρομολόγηση της κίνησης:

    ```powershell
    Set-AzureRmExpressRouteCircuitPeeringConfig -Name <<peering-name>> -Circuit <<circuit-name>> -PeeringType <<peering-type>> -PeerASN <<peer-asn>> -PrimaryPeerAddressPrefix <<primary-peer-address-prefix>> -SecondaryPeerAddressPrefix <<secondary-peer-address-prefix>> -VlanId <<vlan-id>>

    Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit <<circuit-name>>
    ```

3. Κράτηση άλλο σύνολο έγκυρη δημόσιων διευθύνσεων IP να χρησιμοποιήσετε για NAT για δημόσια και διεισδύουν Microsoft. Συνιστάται να έχετε ένα διαφορετικό σύνολο για κάθε διεισδύουν. Καθορίστε το χώρο συγκέντρωσης στην υπηρεσία παροχής σύνδεσης, ώστε να που μπορούν να ρυθμίσουν το πρωτόκολλο BGP διαφημίσεις για αυτές τις περιοχές.

[Σύνδεση σας ιδιωτικό VNet(s) στο cloud με το κύκλωμα ExpressRoute][link-vnet-to-expressroute]. Χρησιμοποιήστε τις παρακάτω εντολές του PowerShell:

```
$circuit = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
$gw = Get-AzureRmVirtualNetworkGateway -Name <<gateway-name>> -ResourceGroupName <<resource-group>>
New-AzureRmVirtualNetworkGatewayConnection -Name <<connection-name>> -ResourceGroupName <<resource-group>> -Location <<location> -VirtualNetworkGateway1 $gw -PeerId $circuit.Id -ConnectionType ExpressRoute
```

Λάβετε υπόψη τα εξής σημεία:

- ExpressRoute χρησιμοποιεί το περίγραμμα πύλης Protocol (πρωτόκολλο BGP) για την ανταλλαγή πληροφοριών δρομολόγησης μεταξύ του δικτύου και Azure.

- Μπορείτε να συνδέσετε πολλά VNets που βρίσκονται σε διαφορετικές περιοχές με το ίδιο κύκλωμα ExpressRoute με την προϋπόθεση ότι όλα VNets και το κύκλωμα ExpressRoute βρίσκονται εντός της ίδιας γεωπολιτική περιοχής.

## <a name="scalability-considerations"></a>Ζητήματα κλιμάκωση

Κυκλώματα ExpressRoute παρέχουν μια διαδρομή υψηλού εύρους ζώνης μεταξύ δικτύων. Γενικά, όσο υψηλότερη το εύρος ζώνης τόσο μεγαλύτερη το κόστος. Παρόλο που ορισμένες υπηρεσίες παροχής σας επιτρέπει να αλλάξετε το εύρος ζώνης σας, βεβαιωθείτε ότι επιλέγετε ένα αρχικό εύρους ζώνης που ξεπεραστούν όρια τις ανάγκες σας, και παρέχει χώρο για ανάπτυξη. Σε περίπτωση που χρειάζεστε για να αυξήσετε το εύρος ζώνης στο μέλλον, που παραμένουν με δύο επιλογές.

Αυξήστε το εύρος ζώνης. Να θυμάστε ότι δεν όλες τις υπηρεσίες παροχής σάς επιτρέπουν να κάνετε που δυναμικά. Και θα πρέπει να αποφεύγετε την για να το κάνετε αυτό όσο είναι δυνατό. Αλλά, εάν είναι απαραίτητο, μετά τον έλεγχο με την υπηρεσία παροχής, εκτελέστε τις παρακάτω εντολές.

```powershell
$ckt = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
$ckt.ServiceProviderProperties.BandwidthInMbps = <<bandwidth-in-mbps>>
Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit $ckt
```

Μπορείτε να αυξήσετε το εύρος ζώνης χωρίς απώλεια σύνδεσης. Υποβάθμιση το εύρος ζώνης που θα έχει ως αποτέλεσμα στο διαταραχή συνδεσιμότητας. Πρέπει να διαγράψετε το κύκλωμα και να δημιουργήσετε ξανά με τη νέα ρύθμιση παραμέτρων.

Εάν χρησιμοποιείτε την τυπική SKU για ExpressRoute και πρέπει να κάνετε αναβάθμιση σε Premium ή να αλλάξετε που είστε σας τιμολόγησης Σχεδιασμός (με βάση τη χρήση ή απεριόριστο), εκτελέστε τις παρακάτω εντολές. Το `Sku.Tier` ιδιότητα μπορεί να είναι `Standard` ή `Premium`; το `Sku.Name` ιδιότητα μπορεί να είναι `MeteredData` ή `UnlimitedData`.

```powershell
$ckt = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>

$ckt.Sku.Tier = "Premium"
$ckt.Sku.Family = "MeteredData"
$ckt.Sku.Name = "Premium_MeteredData"

 Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit $ckt
```

>[AZURE.IMPORTANT] Βεβαιωθείτε ότι το `Sku.Name` ιδιότητα συμφωνίες το `Sku.Tier` και `Sku.Family`. Εάν αλλάξετε την οικογένεια και επίπεδο, αλλά όχι το όνομα, τη σύνδεσή σας θα απενεργοποιηθεί.

Μπορείτε να αναβαθμίσετε την SKU χωρίς να επηρεάζεται, αλλά δεν μπορείτε να μεταβείτε από το απεριόριστες τιμολόγησης σχέδιο με βάση τη χρήση. Όταν υποβάθμιση την SKU, την κατανάλωση εύρους ζώνης πρέπει να παραμείνει εντός το προεπιλεγμένο όριο από την τυπική SKU.

> [AZURE.NOTE] ExpressRoute προσφέρει δύο τιμολόγησης σχέδια για τους πελάτες, που βασίζονται σε δεδομένα μέτρησης ή απεριόριστο. Δείτε [τις πληροφορίες τιμολόγησης ExpressRoute] [ expressroute-pricing] για λεπτομέρειες. Χρεώσεις ποικίλλουν ανάλογα με το εύρος ζώνης κυκλώματος. Διαθέσιμο εύρος ζώνης πιθανώς θα διαφέρουν από υπηρεσία παροχής υπηρεσίας παροχής. Χρησιμοποιήστε το `Get-AzureRmExpressRouteServiceProvider` cmdlet για να δείτε τις υπηρεσίες παροχής διαθέσιμη στην περιοχή σας και το εύρος ζώνης που προσφέρουν.

Ένα μεμονωμένο κύκλωμα ExpressRoute μπορεί να υποστηρίξει έναν αριθμό peerings και VNet συνδέσεις. Ανατρέξτε στο θέμα [όρια ExpressRoute] [ expressroute-limits] για περισσότερες πληροφορίες.

Για μια επιπλέον χρέωση, το πρόσθετο Premium ExpressRoute παρέχει:

- Έως 10.000 δρομολογεί ανά κυκλώματος. Χωρίς πρόσθετο ExpressRoute Premium, το όριο είναι 4.000 δρομολογεί ανά κυκλώματος.

- Καθολικό συνδεσιμότητας, ενεργοποίηση ένα κύκλωμα ExpressRoute βρίσκονται οπουδήποτε στον κόσμο με πόρους πρόσβαση σε οποιαδήποτε περιοχή και όχι μόνο τις περιοχές στο το ίδιο Ήπειρο.

- Αύξηση του αριθμού των συνδέσεων VNet ανά κυκλώματος από 10 σε ένα όριο μεγαλύτερο, ανάλογα με το εύρος ζώνης του κυκλώματος.

Κυκλώματα ExpressRoute έχουν σχεδιαστεί για να επιτρέψετε καταιγισμό προσωρινό δίκτυο έως και δύο φορές το όριο εύρους ζώνης που που μεσολάβησε χωρίς πρόσθετο κόστος. Αυτό είναι δυνατό, χρησιμοποιώντας πλεονάζοντα συνδέσεις. Ωστόσο, όχι όλες τις υπηρεσίες παροχής συνδεσιμότητας υποστηρίζουν αυτήν τη δυνατότητα; Βεβαιωθείτε ότι η υπηρεσία παροχής σας συνδεσιμότητας επιτρέπει αυτήν τη δυνατότητα πριν ανάλογα με το.

## <a name="availability-considerations"></a>Ζητήματα διαθεσιμότητας

Μπορείτε να ρυθμίσετε υψηλής διαθεσιμότητας για Azure τη σύνδεσή σας με διάφορους τρόπους, ανάλογα με τον τύπο της υπηρεσίας παροχής που χρησιμοποιείτε και τον αριθμό των ExpressRoute κυκλώματα και είστε πρόθυμοι να ρυθμίσετε τις παραμέτρους συνδέσεις πύλης εικονικού δικτύου. Τα παρακάτω σημεία σύνοψη των επιλογών διαθεσιμότητα:

- ExpressRoute δεν υποστηρίζει τα πρωτόκολλα πλεονασμού δρομολογητή όπως HSRP και VRRP για την υλοποίηση της υψηλής διαθεσιμότητας. Αντί για αυτό, που χρησιμοποιεί το πρωτόκολλο BGP περιόδων λειτουργίας ανά διεισδύουν πρόσθετου ζεύγους. Για να διευκολύνετε ιδιαίτερα διαθέσιμες συνδέσεις στο δίκτυό σας, το Microsoft Azure διατάξεις που με δύο πλεονάζοντα θύρες σε δύο δρομολογητών (μέρος του άκρου της Microsoft) σε μια ρύθμιση παραμέτρων ενεργούς.

- Εάν χρησιμοποιείτε μια σύνδεση επιπέδου 2, ανάπτυξη πλεονάζοντα δρομολογητές στο δίκτυο εσωτερικής εγκατάστασης σε μια ρύθμιση παραμέτρων ενεργούς. Συνδέστε το πρωτεύον κύκλωμα σε ένα δρομολογητή και το δευτερεύοντα κύκλωμα στην άλλη. Αυτό, θα σας δώσει μια σύνδεση ιδιαίτερα διαθέσιμες και στα δύο άκρα της σύνδεσης. Αυτό είναι απαραίτητο, εάν χρειάζεστε το SLA ExpressRoute. Ανατρέξτε στο θέμα [SLA για Azure ExpressRoute] [ sla-for-expressroute] για λεπτομέρειες.

Το παρακάτω διάγραμμα εμφανίζει μια ρύθμιση παραμέτρων με δρομολογητές πλεονάζοντα εσωτερικής συνδεδεμένο με τα κυκλώματα κύριας και δευτερεύουσας. Κάθε κύκλωμα χειρίζεται την κίνηση για μια δημόσια διεισδύουν και ένα ιδιωτικό διεισδύουν (κάθε διεισδύουν έχει οριστεί ένα ζεύγος /30 διεύθυνση κενά διαστήματα, όπως περιγράφεται στην προηγούμενη ενότητα).

![[1]][1]

Εάν χρησιμοποιείτε μια σύνδεση επιπέδου 3, βεβαιωθείτε ότι παρέχει το πρωτόκολλο πλεονάζοντα BGP περιόδων λειτουργίας που χειρισμού διαθεσιμότητα για εσάς.

Εικονικό δίκτυα μπορεί να συνδεθεί με πολλές ExpressRoute κυκλώματα και κάθε κυκλώματα μπορεί να παρέχεται από τις διαφορετικές υπηρεσίες παροχής. Αυτή η στρατηγική παρέχει πρόσθετες υψηλής διαθεσιμότητας και καταστροφή δυνατότητες για ανάκτηση.

Ρύθμιση παραμέτρων μιας τοποθεσίας σε τοποθεσία VPN ως διαδρομή ανακατεύθυνσης για ExpressRoute. Αυτό ισχύει μόνο για διεισδύουν ιδιωτικό. Για τις υπηρεσίες Azure και το Office 365, στο Internet είναι η διαδρομή μόνο ανακατεύθυνσης.

Από προεπιλογή, το πρωτόκολλο BGP περιόδους λειτουργίας, χρησιμοποιήστε μια τιμή χρονικού ορίου αδράνειας 60 δευτερόλεπτα. Μόλις μια περίοδο λειτουργίας έληξε 3 φορές, η δρομολόγηση έχει επισημανθεί ως μη διαθέσιμες και όλη την κυκλοφορία ανακατευθύνεται στο υπόλοιπο δρομολογητή. Αυτό το χρονικό όριο 180 δεύτερης μπορεί να είναι πολύ μεγάλη για σημαντικές εφαρμογές. Στην περίπτωση αυτή, μπορείτε να αλλάξετε τις ρυθμίσεις το πρωτόκολλο BGP λήξης χρονικού ορίου του δρομολογητή εσωτερικής εγκατάστασης σε μικρότερη τιμή.

## <a name="manageability-considerations"></a>Ζητήματα διαχειρισιμότητα

Μπορείτε να χρησιμοποιήσετε το [Κιτ εργαλείων συνδεσιμότητας Azure (AzureCT)] [ azurect] για την παρακολούθηση της σύνδεσης μεταξύ του κέντρου δεδομένων εσωτερικής εγκατάστασης και του Azure.

## <a name="security-considerations"></a>Ζητήματα ασφαλείας

Μπορείτε να ρυθμίσετε επιλογές ασφαλείας για Azure τη σύνδεσή σας με διάφορους τρόπους, ανάλογα με τη ανησυχίες ασφάλεια και συμμόρφωση ανάγκες. Τα παρακάτω σημεία συνοψίζουν τις επιλογές ασφαλείας.

ExpressRoute λειτουργεί στο επίπεδο 3. Μπορεί να αποτραπεί απειλές στο επίπεδο εφαρμογής, χρησιμοποιώντας μια συσκευή ασφαλείας δικτύου που περιορίζει την κίνηση σε νόμιμα πόρους. Επιπλέον, ExpressRoute συνδέσεων με δημόσια διεισδύουν μόνο να ξεκίνησε από εσωτερικής εγκατάστασης. Αυτό δεν επιτρέπει σε μια υπηρεσία επικίνδυνο από την πρόσβαση και να θέτουν σε κίνδυνο δεδομένων εσωτερικής εγκατάστασης από το Internet δημόσια.

Για να μεγιστοποιήσετε ασφαλείας, προσθέστε συσκευές ασφαλείας δικτύου μεταξύ το δίκτυο εσωτερικής εγκατάστασης και η υπηρεσία παροχής δρομολογητές άκρου. Αυτό θα σας βοηθήσει να περιορίσετε το εισροής μη εξουσιοδοτημένη κίνησης από το VNet:

![[2]][2]

Για τον έλεγχο ή συμμόρφωσης σκοπούς, ίσως χρειαστεί να απαγορεύσουν άμεση πρόσβαση από στοιχεία που εκτελούνται σε VNet του στο Internet και να εφαρμόζουν [υποχρεωτική διοχέτευση][forced-tuneling]. Σε αυτήν την περίπτωση, πρέπει να γίνει ανακατεύθυνση κυκλοφορία Internet προς τα πίσω σε ένα διακομιστή μεσολάβησης εκτελείται εσωτερικής εγκατάστασης όπου μπορεί να ελεγχθεί. Αποκλεισμός μη εξουσιοδοτημένη κυκλοφορία ροή ανάληψη και το φιλτράρισμα πιθανώς κακόβουλο εισερχόμενη κυκλοφορία, μπορεί να ρυθμιστεί στο διακομιστή μεσολάβησης.

![[3]][3]

Από προεπιλογή, ΣΠΣ Azure εκθέτουν τελικά σημεία που χρησιμοποιούνται για την παροχή πρόσβασης σύνδεσης για σκοπούς διαχείρισης - RDP και απομακρυσμένο Powershell για Windows ΣΠΣ και SSH για ΣΠΣ βάσει Linux όταν αναπτυχθεί μέσω της πύλης Azure. Για να μεγιστοποιήσετε ασφαλείας, δεν ενεργοποιήσετε μια δημόσια διεύθυνση IP για το ΣΠΣ και χρησιμοποιήστε NSGs για να βεβαιωθείτε ότι αυτές οι ΣΠΣ δεν είναι δυνατότητα δημόσιας πρόσβασης. ΣΠΣ θα πρέπει να είναι διαθέσιμη μόνο με την εσωτερική διεύθυνση IP. Αυτές οι διευθύνσεις μπορεί να δημιουργηθεί προσβάσιμα μέσω του δικτύου ExpressRoute, ενεργοποίηση προσωπικού DevOps εσωτερικής εγκατάστασης για να εκτελέσετε τυχόν απαραίτητες ρύθμισης παραμέτρων ή συντήρηση.

Εάν πρέπει να παρουσιάσετε τα τελικά σημεία διαχείρισης για ΣΠΣ σε ένα εξωτερικό δίκτυο, χρησιμοποιήστε NSGs ή/και λίστες ελέγχου για να περιορίσετε την ορατότητα από αυτές τις θύρες σε μια whitelist διευθύνσεις IP ή δίκτυα πρόσβασης.

## <a name="troubleshooting-considerations"></a>Αντιμετώπιση προβλημάτων σε θέματα

Εάν αποτύχει τώρα ένα προηγουμένως λειτουργικό κύκλωμα ExpressRoute για να συνδεθείτε, δεν οποιαδήποτε ρύθμιση παραμέτρων αλλαγές στην εσωτερική εγκατάσταση ή μέσα σε σας ιδιωτικό VNet, ίσως χρειαστεί να επικοινωνήσετε με την υπηρεσία παροχής συνδεσιμότητας και εργαστείτε με αυτές για να διορθώσετε το πρόβλημα. Μπορείτε επίσης να χρησιμοποιήσετε τις παρακάτω εντολές Azure PowerShell για να εκτελέσετε ορισμένες περιορισμένο έλεγχο και να καθορίσετε πού μπορεί να υπάρχουν προβλήματα:

- Βεβαιωθείτε ότι έχει αποδοθεί το κύκλωμα:

```powershell
Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
```

Το αποτέλεσμα αυτής της εντολής εμφανίζει πολλές ιδιότητες για το κύκλωμα, συμπεριλαμβανομένων των `ProvisioningState`, `CircuitProvisioningState`, και `ServiceProviderProvisioningState` όπως φαίνεται παρακάτω.

```
ProvisioningState                : Succeeded
Sku                              : {
                                     "Name": "Standard_MeteredData",
                                     "Tier": "Standard",
                                     "Family": "MeteredData"
                                   }
CircuitProvisioningState         : Enabled
ServiceProviderProvisioningState : NotProvisioned
```

Εάν το `ProvisioningState` δεν έχει ρυθμιστεί να `Succeeded` αφού προσπαθήσατε να δημιουργήσετε ένα νέο κύκλωμα, καταργήστε το κύκλωμα χρησιμοποιώντας την παρακάτω εντολή και προσπαθήστε να δημιουργήσετε ξανά.

```powershell
Remove-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
```

Εάν η υπηρεσία παροχής είχε ήδη παρασχεθεί το κύκλωμα, και το `ProvisioningState` έχει οριστεί σε `Failed`, ή το `CircuitProvisioningState` δεν είναι `Enabled`, επικοινωνήστε με την υπηρεσία παροχής για περαιτέρω βοήθεια.

## <a name="solution-deployment"></a>Ανάπτυξη της λύσης

Εάν έχετε μια υπάρχουσα υποδομή εσωτερικής εγκατάστασης που ήδη έχει ρυθμιστεί με μια συσκευή κατάλληλο δίκτυο, μπορείτε να αναπτύξετε την αρχιτεκτονική αναφοράς, ακολουθώντας τα παρακάτω βήματα:

Εάν έχετε μια υπάρχουσα υποδομή εσωτερικής εγκατάστασης που έχει ήδη ρυθμιστεί με μια συσκευή VPN, μπορείτε να αναπτύξετε την αρχιτεκτονική αναφοράς, ακολουθώντας τα παρακάτω βήματα:

1. Κάντε δεξί κλικ στο κουμπί παρακάτω και επιλέξτε είτε "Άνοιγμα σύνδεσης σε νέα καρτέλα" ή "Άνοιγμα σύνδεσης σε νέο παράθυρο":  
[![Ανάπτυξη Azure](./media/blueprints/deploybutton.png)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fguidance-hybrid-network-er%2Fazuredeploy.json)

2. Αναμονή για τη σύνδεση για να ανοίξετε στην πύλη του Azure και, στη συνέχεια, ακολουθήστε τα παρακάτω βήματα: 
  - Το όνομα της **ομάδας πόρων** ορίζεται ήδη στο αρχείο παραμέτρων, επομένως, επιλέξτε **Δημιουργία νέου** και πληκτρολογήστε `ra-hybrid-er-rg` στο πλαίσιο κειμένου.
  - Επιλέξτε την περιοχή από τη **θέση** αναπτυσσόμενο πλαίσιο.
  - Επεξεργαστείτε το **Πρότυπο ριζικό Uri** ή πλαίσια κειμένου **Uri ριζικού παραμέτρων** .
  - Εξετάστε τους όρους και τις προϋποθέσεις και, στη συνέχεια, επιλέξτε το πλαίσιο ελέγχου **αποδέχομαι τους όρους και προϋποθέσεις που αναφέρονται παραπάνω** .
  - Κάντε κλικ στο κουμπί **αγοράς** .

3. Περιμένετε για την ανάπτυξη για να ολοκληρωθεί.

4. Κάντε δεξί κλικ στο κουμπί παρακάτω και επιλέξτε είτε "Άνοιγμα σύνδεσης σε νέα καρτέλα" ή "Άνοιγμα σύνδεσης σε νέο παράθυρο":  
[![Ανάπτυξη Azure](./media/blueprints/deploybutton.png)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fguidance-hybrid-network-er%2Fazuredeploy-expressRouteCircuit.json)

5. Αναμονή για τη σύνδεση για να ανοίξετε στην πύλη του Azure και, στη συνέχεια, ακολουθήστε τα παρακάτω βήματα: 
  - Επιλέξτε **Χρήση υπάρχοντος** στην ενότητα **ομάδα πόρων** και εισαγάγετε `ra-hybrid-er-rg` στο πλαίσιο κειμένου.
  - Επιλέξτε την περιοχή από τη **θέση** αναπτυσσόμενο πλαίσιο.
  - Επεξεργαστείτε το **Πρότυπο ρίζας Uri** ή πλαίσια κειμένου **Uri ριζικού παραμέτρων** .
  - Εξετάστε τους όρους και τις προϋποθέσεις και, στη συνέχεια, επιλέξτε το πλαίσιο ελέγχου **αποδέχομαι τους όρους και προϋποθέσεις που αναφέρονται παραπάνω** .
  - Κάντε κλικ στο κουμπί **αγοράς** .

6. Περιμένετε για την ανάπτυξη για να ολοκληρωθεί.

## <a name="next-steps"></a>Επόμενα βήματα

- Ανατρέξτε στο θέμα [εφαρμογή μια αρχιτεκτονική δικτύου ιδιαίτερα διαθέσιμο υβριδικό] [ highly-available-network-architecture] για πληροφορίες σχετικά με την αύξηση τη διαθεσιμότητα των δίκτυο υβριδική με βάση ExpressRoute με ανακατεύθυνση σε μια σύνδεση VPN.

<!-- links -->
[expressroute-technical-overview]: ../expressroute/expressroute-introduction.md
[resource-manager-overview]: ../azure-resource-manager/resource-group-overview.md
[azure-powershell]: ../powershell-azure-resource-manager.md
[expressroute-prereqs]: ../expressroute/expressroute-prerequisites.md
[configure-expressroute-routing]: ../expressroute/expressroute-howto-routing-arm.md
[sla-for-expressroute]: https://azure.microsoft.com/support/legal/sla/expressroute/v1_0/
[link-vnet-to-expressroute]: ../expressroute/expressroute-howto-linkvnet-arm.md
[ExpressRoute-provisioning]: ../expressroute/expressroute-workflows.md
[expressroute-pricing]: https://azure.microsoft.com/pricing/details/expressroute/
[expressroute-limits]: ../azure-subscription-service-limits.md#networking-limits
[sample-script]: #sample-solution-script
[connectivity-providers]: ../expressroute/expressroute-introduction.md#how-can-i-connect-my-network-to-microsoft-using-expressroute
[azurect]: https://github.com/Azure/NetworkMonitoring/tree/master/AzureCT
[forced-tuneling]: ./guidance-iaas-ra-secure-vnet-hybrid.md
[highly-available-network-architecture]: ./guidance-hybrid-network-expressroute-vpn-failover.md
[arm-templates]: ../resource-group-authoring-templates.md
[naming-conventions]: ./guidance-naming-conventions.md
[solution-script]: https://github.com/mspnp/reference-architectures/tree/master/guidance-hybrid-network-er/Deploy-ReferenceArchitecture.ps1
[solution-script-bash]: https://github.com/mspnp/reference-architectures/tree/master/guidance-hybrid-network-er/deploy-reference-architecture.sh
[vnet-parameters]: https://github.com/mspnp/reference-architectures/tree/master/guidance-hybrid-network-er/parameters/virtualNetwork.parameters.json
[virtualnetworkgateway-parameters]: https://github.com/mspnp/reference-architectures/tree/master/guidance-hybrid-network-er/parameters/virtualNetworkGateway.parameters.json
[visio-download]: http://download.microsoft.com/download/1/5/6/1569703C-0A82-4A9C-8334-F13D0DF2F472/RAs.vsdx
[er-circuit-parameters]: https://github.com/mspnp/reference-architectures/tree/master/guidance-hybrid-network-er/parameters/expressRouteCircuit.parameters.json
[azure-powershell-download]: https://azure.microsoft.com/documentation/articles/powershell-install-configure/
[azure-cli]: https://azure.microsoft.com/documentation/articles/xplat-cli-install/
[0]: ./media/guidance-hybrid-network-expressroute/figure1.png "Αρχιτεκτονική δικτύου υβριδική χρησιμοποιώντας Azure ExpressRoute"
[1]: ./media/guidance-hybrid-network-expressroute/figure2.png "Χρήση πλεονάζοντα δρομολογητές με ExpressRoute κύριας και δευτερεύουσας κυκλώματα"
[2]: ./media/guidance-hybrid-network-expressroute/figure3.png "Προσθήκη ασφάλειας συσκευών με το δίκτυο εσωτερικής εγκατάστασης"
[3]: ./media/guidance-hybrid-network-expressroute/figure4.png "Χρήση υποχρεωτική διοχέτευση για να ελέγξετε την κυκλοφορία Internet συνδεδεμένων"
[4]: ./media/guidance-hybrid-network-expressroute/figure5.png "Βρείτε το ServiceKey από ένα κύκλωμα ExpressRoute"
