<properties
   pageTitle="Azure αρχιτεκτονική αναφορά - IaaS: Δημιουργία ενός δομών πόρων της υπηρεσίας καταλόγου Active Directory στο Azure | Microsoft Azure"
   description="Τρόπος δημιουργίας ενός αξιόπιστου τομέα της υπηρεσίας καταλόγου Active Directory στο Azure."
   services="guidance,vpn-gateway,expressroute,load-balancer,virtual-network,active-directory"
   documentationCenter="na"
   authors="telmosampaio"
   manager="christb"
   editor=""
   tags="azure-resource-manager"/>

<tags
   ms.service="guidance"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="10/24/2016"
   ms.author="telmos"/>

# <a name="creating-a-active-directory-directory-services-adds-resource-forest-in-azure"></a>Δημιουργία μιας δομών πόρων υπηρεσιών καταλόγου Active Directory (ΠΡΟΣΘΈΤΕΙ) στο Azure

[AZURE.INCLUDE [pnp-RA-branding](../../includes/guidance-pnp-header-include.md)]

Αυτό το άρθρο περιγράφει πώς μπορείτε να δημιουργήσετε έναν τομέα της υπηρεσίας καταλόγου Active Directory στο Azure που είναι ξεχωριστό από, αλλά αξιόπιστη, τομέων στο σύμπλεγμα διακομιστών εσωτερικής εγκατάστασης.

> [AZURE.NOTE] Azure έχει δύο διαφορετικές ανάπτυξης μοντέλα: [Διαχείριση πόρων] [ resource-manager-overview] και κλασική. Αυτή η αρχιτεκτονική αναφορά χρησιμοποιεί διαχείριση πόρων, η οποία η Microsoft συνιστά για νέες αναπτύξεις.

Μια εταιρεία που εκτελεί Active Directory (AD) στην εσωτερική εγκατάσταση ενδέχεται να έχετε ένα σύμπλεγμα που αποτελείται από πολλούς διαφορετικούς τομείς. Για παράδειγμα, μπορείτε να δημιουργήσετε μεμονωμένους τομείς για διάφορα τμήματα ή suborganizations ή νέα τομείς ενδέχεται να έχουν προστεθεί ως αποτέλεσμα την απόκτηση ή τη συγχώνευση από άλλες εταιρείες. Μπορείτε να χρησιμοποιήσετε τους τομείς για την παροχή απομόνωσης μεταξύ λειτουργικές περιοχές που πρέπει να διατηρούνται ξεχωριστά, πιθανώς για λόγους ασφαλείας, αλλά μπορείτε να κάνετε κοινή χρήση πληροφοριών μεταξύ των τομέων, δημιουργώντας σχέσεις αξιοπιστίας.

Μια εταιρεία που χρησιμοποιεί διαφορετικούς τομείς να επωφεληθείτε από Azure κατά τη μετακίνηση ενός ή περισσότερων από αυτούς τους τομείς στο cloud. Εναλλακτικά, μια εταιρεία μπορεί να θέλετε να διατηρήσετε όλους τους πόρους cloud λογικά ξεχωριστά από αυτές τις αποθηκευμένες εσωτερικής εγκατάστασης και αποθήκευση πληροφοριών σχετικά με τους πόρους cloud στον κατάλογο τις δικές τους, σε έναν τομέα που θα διατηρούνται επίσης στο cloud.

Μπορείτε να υλοποιήσετε υπηρεσίας καταλόγου Active Directory στο Azure με διάφορους τρόπους, όπως περιγράφεται στα άρθρα [Επέκταση υπηρεσίας καταλόγου Active Directory για να Azure] [ extending-ad-to-azure] και [Εφαρμογή Azure Active Directory][implementing-aad]. Αυτό το έγγραφο εστιάζει σε ένα συγκεκριμένο σενάριο: δημιουργία έναν τομέα στο cloud που διαφέρει από οποιαδήποτε τομείς που θα διατηρούνται εσωτερικής εγκατάστασης, αλλά που μπορούν να έχουν μια σχέση αξιοπιστίας με τους τομείς εσωτερικής εγκατάστασης. 

Τυπική χρήση υποθέσεις για αυτήν την αρχιτεκτονική περιλαμβάνουν τα εξής:

- Διατήρηση διαχωρισμού ασφαλείας για τα αντικείμενα και τις ταυτότητες που θα διατηρούνται στο cloud.

- Μετεγκατάσταση μεμονωμένους τομείς από εσωτερικής εγκατάστασης στο cloud.

## <a name="architecture-diagram"></a>Διάγραμμα αρχιτεκτονικής

Το παρακάτω διάγραμμα επισημαίνει τα σημαντικά στοιχεία σε αυτήν την αρχιτεκτονική (*κάντε κλικ στην επιλογή για να μεγεθύνετε*). Για περισσότερες πληροφορίες σχετικά με τα στοιχεία ελέγχου με γκρι χρώμα, διαβάστε [εφαρμογής μια αρχιτεκτονική δικτύου ασφαλούς υβριδική στο Azure] [ implementing-a-secure-hybrid-network-architecture] και την [εφαρμογή ενός ασφαλούς υβριδική αρχιτεκτονική δικτύου με πρόσβαση στο Internet στο Azure][implementing-a-secure-hybrid-network-architecture-with-internet-access]:

[! [0]][0]

- **Δίκτυο εσωτερικής εγκατάστασης.** Το δίκτυο εσωτερικής εγκατάστασης περιέχει τη δική του AD δάσος και τομέων.

- **Οι διακομιστές AD.** Αυτά είναι ελεγκτές τομέα εφαρμογής υπηρεσίες directory (AD DS) εκτελείται ως ΣΠΣ στο cloud. Αυτοί οι διακομιστές φιλοξενήσετε ένα σύμπλεγμα δομών που περιέχει έναν ή περισσότερους τομείς, ξεχωριστά από αυτές τις βρίσκονται εσωτερικής εγκατάστασης.

- **Σχέση αξιοπιστίας μονόδρομη.** Το παράδειγμα στο διάγραμμα εμφανίζει μια μονόδρομη σχέση αξιοπιστίας από τον τομέα στο cloud για τον τομέα εσωτερικής εγκατάστασης. Αυτή η σχέση επιτρέπει στους χρήστες εσωτερικής εγκατάστασης για να αποκτήσετε πρόσβαση σε πόρους στον τομέα στο cloud, αλλά όχι το αντίστροφο. Αυτή είναι μια συνηθισμένη περίπτωση. Ωστόσο, μπορείτε να δημιουργήσετε μια αμφίδρομη αξιοπιστία εάν χρήστες cloud επίσης απαιτούν πρόσβαση στους πόρους εσωτερικής εγκατάστασης.

- **Υποδίκτυο Active Directory.** Οι διακομιστές AD DS φιλοξενούνται σε ξεχωριστό υποδίκτυο. Οι κανόνες NSG προστασία τους διακομιστές AD DS και μπορούν να παρέχουν ένα τείχος προστασίας σε σχέση με την κυκλοφορία από μη αναμενόμενο προελεύσεις.

- **Υποδίκτυο επίπεδο Web** **επιχειρήσεις επίπεδο υποδικτύου**και **υποδικτύου σειρά δεδομένων**. Αυτά τα δευτερεύοντα δίκτυα φιλοξενήσετε τους διακομιστές και τα στοιχεία που εκτελείτε εφαρμογές στο cloud. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Εκτέλεση ΣΠΣ για μια αρχιτεκτονική N-επιπέδων σε Azure][running-VMs-for-an-N-tier-architecture-on-Azure]. Οι πόροι και ΣΠΣ σε αυτό το υποδίκτυο περιέχονται εντός του τομέα cloud.

- **Azure πύλης**. Η πύλη Azure παρέχει μια σύνδεση μεταξύ του το δίκτυο εσωτερικής εγκατάστασης και του Azure VNet. Αυτό μπορεί να είναι μια [σύνδεση VPN] [ azure-vpn-gateway] ή [Azure ExpressRoute][azure-expressroute]. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [εφαρμογή μια ασφαλή υβριδική αρχιτεκτονική δικτύου στο Azure][implementing-a-secure-hybrid-network-architecture].

## <a name="recommendations"></a>Συστάσεις

Αυτή η ενότητα παρέχει μια λίστα με τις συστάσεις με βάση τα βασικά στοιχεία που απαιτούνται για την υλοποίηση τη βασική αρχιτεκτονική. Εξώφυλλο αυτές τις συστάσεις:

- ΠΡΟΣΘΈΤΕΙ ρυθμίσεις, και

- Αξιόπιστη σχέση ρύθμισης παραμέτρων.

Ενδέχεται να έχετε απαιτήσεις πρόσθετες ή διαφορετικές από εκείνες που περιγράφονται εδώ. Μπορείτε να χρησιμοποιήσετε τα στοιχεία σε αυτήν την ενότητα ως σημείο εκκίνησης για το πώς μπορείτε να προσαρμόσετε την αρχιτεκτονική για το δικό σας σύστημα εξετάζετε.

### <a name="adds-recommendations"></a>ΠΡΟΣΘΈΤΕΙ συστάσεων

Για συγκεκριμένες συστάσεις σχετικά με την εφαρμογή υπηρεσίας καταλόγου Active Directory στο cloud, ανατρέξτε στο έγγραφο [Επέκταση υπηρεσίας καταλόγου Active Directory για να Azure][extending-ad-to-azure]. Το άρθρο [οδηγίες για την ανάπτυξη του Windows Server υπηρεσίας καταλόγου Active Directory σε εικονικές μηχανές Windows Azure] [ ad-azure-guidelines] περιέχει λεπτομερείς πληροφορίες.

### <a name="trust-recommendations"></a>Αξιόπιστη συστάσεων

Οι τομείς εσωτερικής περιέχονται σε διαφορετικό δάσος από τους τομείς στο cloud. Για να ενεργοποιήσετε τον έλεγχο ταυτότητας των χρηστών εσωτερικής εγκατάστασης στο cloud, τους τομείς στο cloud πρέπει να θεωρηθεί αξιόπιστος ο τομέας σύνδεσης στο σύμπλεγμα εσωτερικής εγκατάστασης. Ομοίως, εάν το cloud παρέχει έναν τομέα σύνδεσης για τους εξωτερικούς χρήστες, μπορεί να είναι απαραίτητες για το δάσος εσωτερικής εγκατάστασης για να θεωρηθεί αξιόπιστος ο τομέας cloud.

Μπορείτε να δημιουργήσετε σχέσεις αξιοπιστίας στο επίπεδο δάσος με [τη δημιουργία σχέσεων αξιοπιστίας δάσος][creating-forest-trusts], ή στο επίπεδο του τομέα, [δημιουργώντας σχέσεις αξιοπιστίας εξωτερικών][creating-external-trusts]. Μια σχέση αξιοπιστίας επιπέδου δάσος δημιουργεί μια σχέση μεταξύ όλων των τομέων σε δύο συμπλεγμάτων δομών. Ένα επίπεδο αξιοπιστίας εξωτερικού τομέα μόνο δημιουργεί μια σχέση μεταξύ δύο καθορισμένες τομείς. Θα πρέπει να μπορείτε να δημιουργήσετε μόνο εξωτερικού τομέα επιπέδου αξιοπιστίας μεταξύ τομέων σε διαφορετικές δομές συμπλεγμάτων.

Σχέσεις αξιοπιστίας μπορεί να είναι μονής (μονόδρομη) ή διπλής κατεύθυνσης (αμφίδρομη):

- Μια μονόδρομη σχέση αξιοπιστίας επιτρέπει στους χρήστες σε έναν τομέα ή δάσος (γνωστό ως *εισερχόμενες* τομέα ή δάσος) για να αποκτήσετε πρόσβαση στους πόρους που θα διατηρούνται σε ένα άλλο ( *εξερχόμενων* τομέα ή δάσος). 

- Μια αμφίδρομη αξιοπιστία επιτρέπει στους χρήστες στον τομέα ή δάσος για να αποκτήσετε πρόσβαση σε πόρους που θα διατηρούνται στο άλλο.

Ο παρακάτω πίνακας συνοψίζει τις ρυθμίσεις παραμέτρων αξιοπιστίας για ορισμένα σενάρια απλή:

| Σενάριο | Αξιοπιστίας εσωτερικής εγκατάστασης | Σύννεφο αξιοπιστίας |
|----------|-------------------|-------------|
| Εσωτερικής εγκατάστασης χρήστες απαιτούν πρόσβαση στους πόρους στο cloud, αλλά όχι αντίστροφα | Μονόπλευρη, τα Εισερχόμενα | Μονόπλευρη, εξερχόμενων |
| Οι χρήστες στο cloud απαιτούν πρόσβαση σε πόρους που βρίσκονται στην εσωτερική εγκατάσταση, αλλά όχι αντίστροφα | Μονόπλευρη, εξερχόμενων | Μονόπλευρη, τα Εισερχόμενα |
| Οι χρήστες στο cloud και εσωτερικής εγκατάστασης απαιτεί πρόσβαση σε πόρους που θα διατηρούνται στο cloud και εσωτερικής εγκατάστασης | Αμφίδρομη, εισερχόμενων και εξερχόμενων | Αμφίδρομη, εισερχόμενων και εξερχόμενων |

## <a name="security-considerations"></a>Ζητήματα ασφαλείας

Επίπεδο αξιοπιστίας δάσος είναι μεταβατικές. Εάν δημιουργήσετε δάσος επιπέδου αξιοπιστίας μεταξύ ενός δάσος εσωτερικής εγκατάστασης και ένα σύμπλεγμα στο cloud, αυτή η σχέση αξιοπιστίας έχει επεκταθεί σε άλλους νέα τομείς που δημιουργήθηκε σε κάποιο δάσος. Εάν χρησιμοποιείτε τους τομείς για την παροχή διαχωρισμού για λόγους ασφαλείας, μπορείτε να δημιουργήσετε σχέσεις αξιοπιστίας μόνο σε επίπεδο τομέα. Επίπεδο αξιοπιστίας τομέα είναι μη μεταβατικές.

Για συγκεκριμένη AD ζητήματα ασφαλείας, ανατρέξτε στην ενότητα *ζητήματα ασφαλείας* [επέκταση]υπηρεσίας καταλόγου Active Directory για να Azure[extending-ad-to-azure].

## <a name="availability-considerations"></a>Ζητήματα διαθεσιμότητας

Υλοποίηση τουλάχιστον δύο ελεγκτές τομέα για κάθε τομέα. Αυτή η δυνατότητα επιτρέπει η αυτόματη αναπαραγωγή μεταξύ διακομιστών. Δημιουργήστε ένα διαθεσιμότητα ρύθμιση για το ΣΠΣ, ως διακομιστές AD χειρισμός κάθε τομέα. Βεβαιωθείτε ότι υπάρχουν τουλάχιστον δύο διακομιστές του συνόλου. 

Επίσης, εξετάστε το ενδεχόμενο να Προσδιορισμός έναν ή περισσότερους διακομιστές σε κάθε τομέα ως [υποδείγματα αναμονής λειτουργίες] [ standby-operations-masters] στην περίπτωση που η σύνδεση με ένα διακομιστή, ως ένα ρόλο FSMO αποτυγχάνει.

## <a name="scalability-considerations"></a>Ζητήματα κλιμάκωση

AD είναι αυτόματα κλιμακωτές για ελεγκτές τομέα που αποτελούν μέρος του ίδιου τομέα. Αιτήσεις κατανέμονται σε όλους τους ελεγκτές μέσα σε έναν τομέα. Μπορείτε να προσθέσετε έναν άλλο ελεγκτή τομέα και συγχρονίζεται αυτόματα με τον τομέα. Ρυθμίσετε μια ξεχωριστή εξισορρόπηση φόρτου για να κατευθύνουν κυκλοφορία για ελεγκτές εντός του τομέα. Βεβαιωθείτε ότι όλοι οι ελεγκτές τομέα έχουν επαρκείς πόρους μνήμης και χώρου αποθήκευσης για το χειρισμό τη βάση δεδομένων του τομέα. Κάνετε όλων ελεγκτή τομέα ΣΠΣ το ίδιο μέγεθος.

## <a name="management-and-monitoring-considerations"></a>Διαχείριση και την παρακολούθηση ζητήματα

Για πληροφορίες σχετικά με τη διαχείριση και την παρακολούθηση θέματα, ανατρέξτε στις ενότητες ισοδύναμη [επέκταση]υπηρεσίας καταλόγου Active Directory για να Azure[extending-ad-to-azure]. 

Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Παρακολούθηση υπηρεσίας καταλόγου Active Directory][monitoring_ad]. Μπορείτε να εγκαταστήσετε εργαλεία όπως το [Κέντρο συστήματα Microsoft] [ microsoft_systems_center] σε ένα διακομιστή παρακολούθησης στο δευτερεύον διαχείρισης για να εκτελέσετε αυτές τις εργασίες. 

## <a name="solution-components"></a>Στοιχεία λύσης

Δείγμα λύσης ενεργειών, [Ανάπτυξη ReferenceArchitecture.ps1][solution-script], είναι διαθέσιμο το οποίο μπορείτε να χρησιμοποιήσετε για την υλοποίηση της αρχιτεκτονικής που ακολουθεί τις συστάσεις που περιγράφονται σε αυτό το άρθρο. Αυτή η δέσμη ενεργειών χρησιμοποιεί πρότυπα διαχείρισης πόρων Azure. Τα πρότυπα που είναι διαθέσιμα ως ένα σύνολο θεμελιώδεις μπλοκ δόμησης, κάθε μία από τις οποίες εκτελεί μια συγκεκριμένη ενέργεια, όπως τη δημιουργία μιας VNet ή τη ρύθμιση των παραμέτρων ενός NSG. Ο σκοπός της δέσμης ενεργειών είναι να οργανώσετε ανάπτυξη προτύπου.

Τα πρότυπα που είναι με παραμέτρους, με τις παραμέτρους που θα διατηρούνται στα ξεχωριστά αρχεία JSON. Μπορείτε να τροποποιήσετε τις παραμέτρους σε αυτά τα αρχεία για τη ρύθμιση παραμέτρων ανάπτυξης να πληροί τις απαιτήσεις του δικού σας. Δεν χρειάζεται για την τροποποίηση των προτύπων τον εαυτό τους. Δεν θα πρέπει να αλλάξετε τα σχήματα από τα αντικείμενα στα αρχεία παραμέτρου.

Κατά την επεξεργασία των προτύπων, δημιουργία αντικειμένων που ακολουθούν τις συμβάσεις ονομασίας που περιγράφονται σε [Προτεινόμενα συμβάσεις ονομασίας παραμέτρων για τους πόρους Azure][naming-conventions].

Η λύση δείγμα δημιουργεί και ρυθμίζει τις παραμέτρους ενός περιβάλλοντος στο cloud που υλοποιεί έναν τομέα με το όνομα *treyresearch.com*. Αυτό το περιβάλλον αποτελείται από την πύλη VPN υποδικτύου και διακομιστές, DMZ, επίπεδο web, επιχειρήσεις επίπεδο και στοιχεία επιπέδων πρόσβασης δεδομένων, ΠΡΟΣΘΈΤΕΙ και Διαχείριση επιπέδων. Η λύση δείγματος και περιλαμβάνει επίσης μια προαιρετική ρύθμιση παραμέτρων για να δημιουργήσετε ένα περιβάλλον προσομοιωμένη εσωτερικής εγκατάστασης με το δικό του τομέα, *contoso.com*. Η λύση περιλαμβάνει δέσμες ενεργειών που καθορίζουν μια σχέση αξιοπιστίας σε αυτούς τους τομείς που επιτρέπει σε χρήστες εσωτερικής εγκατάστασης για να αποκτήσετε πρόσβαση σε αντικείμενα στον *treyresearch.com* τομέα στο cloud.

Οι παρακάτω ενότητες περιγράφουν τα στοιχεία του το εσωτερικής εγκατάστασης και cloud ρυθμίσεις παραμέτρων.

### <a name="on-premises-components"></a>Στοιχεία εσωτερικής εγκατάστασης

>[AZURE.NOTE] Αυτά τα στοιχεία δεν είναι το κύριο εστίαση της αρχιτεκτονικής που περιγράφονται σε αυτό το έγγραφο και παρέχονται απλώς να σας δώσει μια ευκαιρία για να ελέγξετε το περιβάλλον cloud με ασφάλεια, αντί να χρησιμοποιήσετε ένα περιβάλλον πραγματικό παραγωγής. Για αυτόν το λόγο, αυτή η ενότητα συνοψίζει μόνο τα αρχεία παραμέτρου του κλειδιού. Μπορείτε να τροποποιήσετε τις ρυθμίσεις, όπως οι διευθύνσεις IP ή τα μεγέθη των του ΣΠΣ, αλλά συνιστάται να αφήσετε πολλές από τις άλλες παραμέτρους που δεν έχουν αλλάξει.

Αυτό το περιβάλλον αποτελείται από ένα σύμπλεγμα δομών AD ο τομέας *contoso.com* . Ο τομέας περιέχει δύο ΠΡΟΣΘΈΤΕΙ διακομιστές με διευθύνσεις IP 192.168.0.4 και 192.168.0.5. Αυτά τα δύο διακομιστές επίσης να εκτελέσετε την υπηρεσία DNS. Ο λογαριασμός τοπικού διαχειριστή σε δύο VM ονομάζεται `testuser` με κωδικό πρόσβασης `AweS0me@PW`. Επιπλέον, ρυθμίζει τις παραμέτρους μιας πύλης VPN για τη σύνδεση με το VNet στο cloud. Μπορείτε να τροποποιήσετε τις ρυθμίσεις παραμέτρων με την επεξεργασία του παρακάτω JSON αρχεία που βρίσκονται σε τη [**σύνδεση παράμετροι/εντός της επιχείρησης**] [ on-premises-folder] φακέλου:

- ** [virtualNetwork.parameters.json][on-premises-vnet-parameters]**. Αυτό το αρχείο Καθορίζει το χώρο διευθύνσεων δικτύου για το περιβάλλον εσωτερικής εγκατάστασης.

- ** [virtualMachines adds.parameters.json][on-premises-virtualmachines-adds-parameters]**. Αυτό το αρχείο περιέχει τη ρύθμιση παραμέτρων για το ΣΠΣ εσωτερικής ΠΡΟΣΘΈΤΕΙ υπηρεσίες φιλοξενίας. Από προεπιλογή, δημιουργούνται δύο ΣΠΣ *Τυπική-DS3-v2* .

- ** [virtualNetworkGateway.parameters.json] [ on-premises-virtualnetworkgateway-parameters] ** και ** [connection.parameters.json][on-premises-connection-parameters]**. Αυτά τα αρχεία κρατήστε τις ρυθμίσεις για τη σύνδεση VPN με την πύλη Azure VPN στο cloud, όπως το κοινόχρηστο κλειδί θα χρησιμοποιηθεί για την προστασία κίνηση αλλαγή της πύλης.

Τα υπόλοιπα αρχεία στο φάκελο περιέχει τις πληροφορίες ρύθμισης παραμέτρων που χρησιμοποιούνται για τη δημιουργία του τομέα εσωτερικής εγκατάστασης (*contoso.com*) χρησιμοποιώντας αυτήν την υποδομή. Μπορείτε να τις χρησιμοποιήσουν για την εγκατάσταση του ΠΡΟΣΘΈΤΕΙ, ρύθμισης DNS, και να δημιουργήσετε το σύμπλεγμα εσωτερικής εγκατάστασης.

Η λύση χρησιμοποιεί επίσης την ακόλουθη δέσμη ενεργειών, με το όνομα [trust.ps1 εισερχόμενες][incoming-trust], που εκτελείται σε έναν υπολογιστή στον τομέα εσωτερικής εγκατάστασης:

```Powershell
# Run the following powershell script in ra-adtrust-onpremise-ad-vm1 (ip 192.168.0.4)

$TrustedDomainName = "contoso.com"
#$TrustedDomainDnsIpAddresses = "192.168.0.4,192.168.0.5"

$TrustingDomainName = "treyresearch.com"
$TrustingDomainDnsIpAddresses = "10.0.4.4,10.0.4.5"

$ForwardIpAddress  = $TrustingDomainDnsIpAddresses
$ForwardDomainName = $TrustingDomainName

$IpAddresses = @()
foreach($address in $ForwardIpAddress.Split(',')){
    $IpAddresses += [IPAddress]$address.Trim()
}
Add-DnsServerConditionalForwarderZone -Name "$ForwardDomainName" -ReplicationScope "Domain" -MasterServers $IpAddresses

netdom trust $TrustingDomainName /d:$TrustedDomainName /add
```

Αυτή η δέσμη ενεργειών προσθέτει τις διευθύνσεις IP των διακομιστών AD DS στο cloud (ανατρέξτε στην επόμενη ενότητα) με την τοπική υπηρεσία DNS, και, στη συνέχεια, χρησιμοποιεί το [netdom] [ netdom] εντολή για να δημιουργήσετε μια μονόδρομη εισερχόμενης αξιοπιστίας από τον τομέα στο cloud (*treyresearch.com*).

### <a name="cloud-components"></a>Στοιχεία του cloud

Αυτά τα στοιχεία φόρμας βασικού αυτής της αρχιτεκτονικής. Μπορούν εγκατάστασης της υποδομής για τον τομέα *treyresearch.com* και δημιουργήστε τις σχέσεις αξιοπιστίας με τον τομέα *contoso.com* εσωτερικής εγκατάστασης. Το [**παράμετροι/azure**] [ azure-folder] φακέλου περιέχει τα ακόλουθα αρχεία παραμέτρου για τη ρύθμιση αυτών των στοιχείων:

- ** [virtualNetwork.parameters.json][vnet-parameters]**. Αυτό το αρχείο καθορίζει δομή του VNet για το ΣΠΣ και άλλα στοιχεία του στο cloud. Περιλαμβάνει ρυθμίσεις, όπως το όνομα, διεύθυνση διάστημα, δευτερεύοντα δίκτυα και οι διευθύνσεις τους διακομιστές DNS που απαιτούνται. Οι διευθύνσεις DNS εμφανίζεται σε αυτό το παράδειγμα αναφορά στις διευθύνσεις IP του διακομιστές DNS της εσωτερικής εγκατάστασης, καθώς και τον προεπιλεγμένο διακομιστή Azure DNS. Τροποποίηση αυτές τις διευθύνσεις για αναφορά το δικό σας πρόγραμμα εγκατάστασης DNS, εάν δεν χρησιμοποιείτε το δείγμα περιβάλλον εσωτερικής εγκατάστασης:
    
    ```json
    "virtualNetworkSettings": {
      "value": {
        "name": "ra-adtrust-vnet",
        "resourceGroup": "ra-adtrust-network-rg",
        "addressPrefixes": [
          "10.0.0.0/16"
        ],
        "subnets": [
          {
            "name": "dmz-private-in",
            "addressPrefix": "10.0.0.0/27"
          },
          {
            "name": "dmz-private-out",
            "addressPrefix": "10.0.0.32/27"
          },
          {
            "name": "dmz-public-in",
            "addressPrefix": "10.0.0.64/27"
          },
          {
            "name": "dmz-public-out",
            "addressPrefix": "10.0.0.96/27"
          },
          {
            "name": "mgmt",
            "addressPrefix": "10.0.0.128/25"
          },
          {
            "name": "GatewaySubnet",
            "addressPrefix": "10.0.255.224/27"
          },
          {
            "name": "web",
            "addressPrefix": "10.0.1.0/24"
          },
          {
            "name": "biz",
            "addressPrefix": "10.0.2.0/24"
          },
          {
            "name": "data",
            "addressPrefix": "10.0.3.0/24"
          },
          {
            "name": "adds",
            "addressPrefix": "10.0.4.0/27"
          }
        ],
        "dnsServers": [
          "10.0.4.4",
          "10.0.4.5",
          "168.63.129.16"
        ]
      }
    }
    ```

- ** [virtualMachines adds.parameters.json ] [ virtualmachines-adds-parameters] **. Αυτό το αρχείο ρυθμίζει τις παραμέτρους του ΣΠΣ εκτελείται ΠΡΟΣΘΈΤΕΙ στο cloud. Η ρύθμιση παραμέτρων αποτελείται από δύο ΣΠΣ. Αλλαγή διαχείρισης όνομα χρήστη και τον κωδικό πρόσβασης στο το `virtualMachineSettings` ενότητα και, μπορείτε προαιρετικά να τροποποιήσετε το μέγεθος Εικονική ώστε να ταιριάζει με τις απαιτήσεις του τομέα:

    Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Επέκταση υπηρεσίας καταλόγου Active Directory για να Azure][extending-ad-to-azure].
    
    ```json
    "virtualMachinesSettings": {
      "value": {
        "namePrefix": "ra-adtrust-ad",
        "computerNamePrefix": "aad",
        "size": "Standard_DS3_v2",
        "osType": "Windows",
        "adminUsername": "testuser",
        "adminPassword": "AweS0me@PW",
        "osAuthenticationType": "password",
        "nics": [
          {
            "isPublic": "false",
            "subnetName": "adds",
            "privateIPAllocationMethod": "Static",
            "startingIPAddress": "10.0.4.4",
            "enableIPForwarding": false,
            "dnsServers": [
            ],
            "isPrimary": "true"
          }
        ],
        "imageReference": {
          "publisher": "MicrosoftWindowsServer",
          "offer": "WindowsServer",
          "sku": "2012-R2-Datacenter",
          "version": "latest"
        },
        "dataDisks": {
          "count": 1,
          "properties": {
            "diskSizeGB": 127,
            "caching": "None",
            "createOption": "Empty"
          }
        },
        "osDisk": {
          "caching": "ReadWrite"
        },
        "extensions": [
        ],
        "availabilitySet": {
          "useExistingAvailabilitySet": "No",
          "name": "ra-adtrust-as"
        }
      }
    },
    "virtualNetworkSettings": {
      "value": {
        "name": "ra-adtrust-vnet",
        "resourceGroup": "ra-adtrust-network-rg"
      }
    },
    "buildingBlockSettings": {
      "value": {
        "storageAccountsCount": 2,
        "vmCount": 2,
        "vmStartIndex": 1
      }
    }
    ```

- ** [Προσθήκη-προσθέτει-τομέα-controller.parameters.json][add-adds-domain-controller-parameters]**. Αυτό το αρχείο περιέχει τις ρυθμίσεις για τη δημιουργία του τομέα *treyresearch.com* που εκτείνονται σε διακομιστές ΠΡΟΣΘΈΤΕΙ. Χρησιμοποιεί προσαρμοσμένες επεκτάσεις που καθορίζει τον τομέα και να προσθέσετε τους διακομιστές ΠΡΟΣΘΈΤΕΙ σε αυτό. Εκτός εάν δημιουργήσετε πρόσθετους διακομιστές ΠΡΟΣΘΈΤΕΙ (σε αυτήν την περίπτωση που θα πρέπει να προσθέσετε το `vms` πίνακα), αλλάξτε τα ονόματά τους από την προεπιλεγμένη ή θέλετε να δημιουργήσετε έναν τομέα με διαφορετικό όνομα δεν χρειάζεται να τροποποιήσετε αυτό το αρχείο.

- ** [virtualNetworkGateway.parameters.json][virtualnetworkgateway-parameters]**. Αυτό το αρχείο περιέχει τις ρυθμίσεις που χρησιμοποιούνται για τη δημιουργία της πύλης Azure VPN στο cloud χρησιμοποιούνται για τη σύνδεση με το δίκτυο εσωτερικής εγκατάστασης. Θα πρέπει να τροποποιήσετε το `sharedKey` τιμή του ορίσματος το `connectionsSettings` την ενότητα για να συμφωνεί με εκείνη της συσκευής VPN εσωτερικής εγκατάστασης. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [εφαρμογή μια υβριδική αρχιτεκτονική δικτύου με Azure και VPN εσωτερικής][hybrid-azure-on-prem-vpn].

- ** [dmz private.parameters.json] [ dmz-private-parameters] ** και ** [dmz public.parameters.json ] [ dmz-public-parameters] **. Αυτά τα αρχεία, ρύθμιση παραμέτρων εισερχόμενου (δημόσιας) και εξερχομένων (ιδιωτικό) πλευρές του ΣΠΣ που αποτελούν το DMZ, προστασία τους διακομιστές στο cloud. Για περισσότερες πληροφορίες σχετικά με αυτά τα στοιχεία και των παραμέτρων τους, ανατρέξτε στο θέμα [εφαρμογή μια DMZ μεταξύ Azure και του Internet][implementing-a-secure-hybrid-network-architecture-with-internet-access].

- ** [loadBalancer web.parameters.json][loadBalancer-web-parameters]**, ** [loadBalancer biz.parameters.json][loadBalancer-biz-parameters]**, και ** [loadBalancer data.parameters.json][loadBalancer-data-parameters]**. Αυτά τα αρχεία παράμετροι περιέχουν οι προδιαγραφές Εικονική για τα επίπεδα πρόσβασης web, επιχειρήσεις και τα δεδομένα, και ρύθμιση παραμέτρων φόρτωσης balancers για κάθε επίπεδο. Αυτά είναι τα ΣΠΣ που φιλοξενεί τις εφαρμογές web και βάσεων δεδομένων, καθώς και να εκτελέσετε το φόρτους εργασίας του business για την εταιρεία. Το ΣΠΣ στο επίπεδο web προστίθενται στον τομέα στο cloud, χρησιμοποιώντας τις ρυθμίσεις που καθορίζονται σε το ** [web-εικονική-τομέα-join.parameters.json] [ web-vm-domain-join-parameters] ** αρχείου.

    Κάθε αρχείο περιέχει δύο σύνολα παραμέτρων. Το `virtualMachineSettings` ενότητα ορίζει το ΣΠΣ που φιλοξενεί την υπηρεσία ADFS στο cloud. Από προεπιλογή, η δέσμη ενεργειών δημιουργεί δύο από τα εξής ΣΠΣ στο ίδιο σύνολο διαθεσιμότητα. Τα παρακάτω τμήματα δείχνουν τα σχετικά τμήματα του αρχείου *loadBalancer web.parameters.json* :

    ```json
    "virtualMachinesSettings": {
      "value": {
        "namePrefix": "ra-adtrust-web",
        "computerNamePrefix": "web",
        "size": "Standard_DS1_v2",
        "osType": "windows",
        "adminUsername": "testuser",
        "adminPassword": "AweS0me@PW",
        "osAuthenticationType": "password",
        "nics": [
          {
            "isPublic": "false",
            "subnetName": "web",
            "privateIPAllocationMethod": "Dynamic",
            "isPrimary": "true",
            "enableIPForwarding": false,
            "dnsServers": [ ]
          }
        ],
        "imageReference": {
          "publisher": "MicrosoftWindowsServer",
          "offer": "WindowsServer",
          "sku": "2012-R2-Datacenter",
          "version": "latest"
        },
        "dataDisks": {
          "count": 1,
          "properties": {
            "diskSizeGB": 128,
            "caching": "None",
            "createOption": "Empty"
          }
        },
        "osDisk": {
          "caching": "ReadWrite"
        },
        "extensions": [ ],
        "availabilitySet": {
          "useExistingAvailabilitySet": "No",
          "name": "ra-adtrust-web-vm-as"
        }
      }
    },
    ...
    "buildingBlockSettings": {
      "value": {
        "storageAccountsCount": 2,
        "vmCount": 2,
        "vmStartIndex": 1
      }
    }
    ````
    Μπορείτε να τροποποιήσετε το μέγεθος και αριθμό ΣΠΣ σε κάθε επίπεδο σύμφωνα με τις απαιτήσεις σας.

    Το `loadBalancerSettings` η ενότητα παρέχει την περιγραφή της τη μονάδα εξισορρόπησης φόρτου για αυτές τις ΣΠΣ. Η μονάδα εξισορρόπησης φόρτου μεταβιβάζει κίνηση που εμφανίζεται στη θύρα 80 (HTTP) και τη θύρα 443 (HTTPS) σε ένα ή περισσότερα από τα ΣΠΣ. 

    >[AZURE.NOTE] Ο κανόνας για τη θύρα 80 χρησιμοποιεί μια σύνδεση TCP αντί για HTTP. Αυτό συμβαίνει επειδή η εγκατάσταση των υπηρεσιών IIS στο επίπεδο web έχει ρυθμιστεί ώστε να υποστηρίζει μόνο έλεγχο ταυτότητας των Windows. Ανώνυμος έλεγχος ταυτότητας είναι απενεργοποιημένη. Απόπειρα *ping* θύρα 80 μέσω σύνδεσης HTTP αποτυγχάνει με 401 σφάλματος (μη εξουσιοδοτημένη), ενώ χρησιμοποιώντας απλώς μια σύνδεση TCP εντοπίσει αν η θύρα είναι ενεργό:

    ```json
    "loadBalancerSettings": {
      "value": {
        "name": "ra-adtrust-web-lb",
        "frontendIPConfigurations": [
          {
            "name": "ra-adtrust-web-lb-fe",
            "loadBalancerType": "internal",
            "internalLoadBalancerSettings": {
              "privateIPAddress": "10.0.1.254",
              "subnetName": "web"
            }
          }
        ],
        "backendPools": [
          {
            "name": "ra-adtrust-web-lb-bep",
            "nicIndex": 0
          }
        ],
        "loadBalancingRules": [
          {
            "name": "http-rule",
            "frontendPort": 80,
            "backendPort": 80,
            "protocol": "Tcp",
            "backendPoolName": "ra-adtrust-web-lb-bep",
            "frontendIPConfigurationName": "ra-adtrust-web-lb-fe",
            "probeName": "http-probe",
            "enableFloatingIP": false
          },
          {
            "name": "https-rule",
            "frontendPort": 443,
            "backendPort": 443,
            "protocol": "Tcp",
            "backendPoolName": "ra-adtrust-web-lb-bep",
            "frontendIPConfigurationName": "ra-adtrust-web-lb-fe",
            "probeName": "https-probe",
            "enableFloatingIP": false
          }
        ],
        "probes": [
          {
            "name": "http-probe",
            "port": 80,
            "protocol": "Tcp",
            "requestPath": null
          },
          {
            "name": "https-probe",
            "port": 443,
            "protocol": "Tcp",
            "requestPath": null
          }
        ],
        "inboundNatRules": [ ]
      }
    }
    ```

- ** [virtualMachines mgmt.parameters.json][virtualMachines-mgmt-parameters]**. Αυτό το αρχείο περιέχει τη ρύθμιση παραμέτρων για τη μεταπήδηση πλαίσιο/Διαχείριση ΣΠΣ. Είναι δυνατή μόνο για να αποκτήσετε σύνδεσης και δικαιώματα διαχειριστή στον του ΣΠΣ στο web, επιχειρήσεις, και τις σειρές δεδομένων από το πλαίσιο μεταπήδησης. Από προεπιλογή, η δέσμη ενεργειών δημιουργεί ένα μεμονωμένο *Standard_DS1_v2* Εικονική, αλλά μπορείτε να τροποποιήσετε αυτό το αρχείο για να δημιουργήσετε ΣΠΣ μεγαλύτερο ή επιπλέον, εάν το φόρτο εργασίας διαχείρισης είναι πιθανό να είναι σημαντική.

Η ρύθμιση παραμέτρων χρησιμοποιεί επίσης το [εξερχόμενης trust.ps1] [ outgoing-trust] δέσμη ενεργειών που φαίνεται παρακάτω για να δημιουργήσετε μια μονόδρομη εξερχόμενων σχέση αξιοπιστίας με τον τομέα *contoso.com* :

```powershell
# prerequiste: 
# You need to first run incoming-trust.ps1 in ra-adtrust-onpremise-ad-vm1 (ip 192.168.0.4)
# Then,
# Run the following powershell script in ra-adtrust-ad-vm1 (ip 10.0.4.4)

$TrustedDomainName = "contoso.com"
$TrustedDomainDnsIpAddresses = "192.168.0.4,192.168.0.5"

#$TrustingDomainName = "treyresearch.com"
#$TrustingDomainDnsIpAddresses = "10.0.4.4,10.0.4.5"

$ForwardIpAddress  = $TrustedDomainDnsIpAddresses
$ForwardDomainName = $TrustedDomainName

$IpAddresses = @()
foreach($address in $ForwardIpAddress.Split(',')){
    $IpAddresses += [IPAddress]$address.Trim()
}
Add-DnsServerConditionalForwarderZone -Name "$ForwardDomainName" -ReplicationScope "Domain" -MasterServers $IpAddresses

#netdom trust $TrustingDomainName /d:$TrustedDomainName /add
```

Αυτή η δέσμη ενεργειών είναι παρόμοια με τη δέσμη ενεργειών *trust.ps1 εισερχομένων* που περιγράφονται παραπάνω. Προσθέτει τις διευθύνσεις IP του το εσωτερικής AD DS διακομιστές με την τοπική υπηρεσία DNS, και, στη συνέχεια, χρησιμοποιεί το [netdom] [ netdom] εντολή για να δημιουργήσετε τη σχέση αξιοπιστίας εξερχόμενα.

## <a name="solution-deployment"></a>Ανάπτυξη της λύσης

Η λύση προϋποθέτει τις ακόλουθες προϋποθέσεις:

- Έχετε μια υπάρχουσα συνδρομή Azure στο οποίο μπορείτε να δημιουργήσετε ομάδες πόρων.

- Έχετε λάβει και να εγκαταστήσει την πιο πρόσφατη δομή του Azure Powershell. Δείτε [εδώ] [ azure-powershell-download] για οδηγίες.

Για να εκτελέσετε τη δέσμη ενεργειών που αναπτύσσει τη λύση:

1. Μετακίνηση σε φάκελο εύκολη στον τοπικό σας υπολογιστή και δημιουργήστε τους παρακάτω υποφακέλους:

    - Δέσμες ενεργειών

    - Δέσμες ενεργειών/παραμέτρους

    - Δέσμες ενεργειών/παράμετροι/σύνδεση εντός της επιχείρησης

    - Παράμετροι/δέσμες ενεργειών/Azure

2. Κάντε λήψη του [Ανάπτυξη ReferenceArchitecture.ps1] [ solution-script] αρχείο στο φάκελο δέσμης ενεργειών

3. Κάντε λήψη των περιεχομένων του [παράμετροι/σύνδεση εντός επιχείρησης] [ on-premises-folder] φακέλου στο φάκελο δεσμών ενεργειών/παράμετροι/σύνδεση εντός της επιχείρησης:

4. Κάντε λήψη των περιεχομένων του [παράμετροι/azure] [ azure-folder] φακέλου στο φάκελο δεσμών ενεργειών/παράμετροι Azure.

5. Επεξεργαστείτε το αρχείο ανάπτυξη ReferenceArchitecture.ps1 στο φάκελο δεσμών ενεργειών και αλλάξτε τις ακόλουθες γραμμές για να καθορίσετε τις ομάδες πόρων που θα πρέπει να δημιουργήσει ή να χρησιμοποιούνται για τη διατήρηση των πόρων που δημιουργήθηκε από τη δέσμη ενεργειών:

    ```powershell
    # Azure Onpremise Deployments
    $onpremiseNetworkResourceGroupName = "ra-adtrust-onpremise-rg"

    # Azure ADDS Deployments
    $azureNetworkResourceGroupName = "ra-adtrust-network-rg"
    $workloadResourceGroupName = "ra-adtrust-workload-rg"
    $securityResourceGroupName = "ra-adtrust-security-rg"
    $addsResourceGroupName = "ra-adtrust-adds-rg"
    ```

6. Επεξεργαστείτε τα αρχεία παραμέτρου στο δέσμες ενεργειών/παράμετροι/σύνδεση εντός της επιχείρησης και δεσμών ενεργειών/παράμετροι Azure φακέλων. Ενημερώστε τις αναφορές ομάδα πόρων σε αυτά τα αρχεία για να ταιριάζουν με τα ονόματα των ομάδων πόρων στους οποίους έχουν ανατεθεί τις μεταβλητές στο αρχείο ReferenceArchitecture.ps1 ανάπτυξη. Ο παρακάτω πίνακας εμφανίζει ποια αρχεία παραμέτρου αναφορά ποια ομάδα πόρων. Οι ομάδες πόρων *ra-adfs-φόρτο εργασίας-rg*, *ra-adfs-ασφάλεια-rg*, *ra-adfs-προσθέτει-rg*, *ra-adfs-adfs-rg*και *ra-adfs-διακομιστή μεσολάβησης-rg* χρησιμοποιούνται μόνο στη δέσμη ενεργειών PowerShell και δεν εμφανίζονται με τα αρχεία παραμέτρου.

  	|Ομάδα πόρων|Παράμετρος αρχείων|
  	|--------------|--------------|
  	|RA-adtrust-σύνδεση εντός της επιχείρησης-rg|parameters\onpremise\connection.Parameters.JSON<br /> parameters\onpremise\virtualMachines-adds.Parameters.JSON<br />parameters\onpremise\virtualNetwork-adds-DNS.Parameters.JSON<br />parameters\onpremise\virtualNetwork.Parameters.JSON<br />parameters\onpremise\virtualNetworkGateway.Parameters.JSON<br />parameters\azure\virtualNetworkGateway.Parameters.JSON
  	|RA-adtrust-δικτύου-rg|parameters\onpremise\connection.Parameters.JSON<br />parameters\azure\dmz-Private.Parameters.JSON<br />parameters\azure\dmz-Public.Parameters.JSON<br />parameters\azure\loadBalancer-Biz.Parameters.JSON<br />parameters\azure\loadBalancer-Data.Parameters.JSON<br />parameters\azure\loadBalancer-Web.Parameters.JSON<br />parameters\azure\virtualMachines-adds.Parameters.JSON<br />parameters\azure\virtualMachines-MGMT.Parameters.JSON<br />parameters\azure\virtualNetwork-adds-DNS.Parameters.JSON<br />parameters\azure\virtualNetwork.Parameters.JSON<br />parameters\azure\virtualNetworkGateway.Parameters.JSON (*δύο φορές*)

    Επιπλέον, ορίστε τη ρύθμιση παραμέτρων για το εσωτερικής εγκατάστασης και cloud στοιχεία, όπως περιγράφεται στα [Στοιχεία λύσης] [ solution-components] ενότητας.

7. Ανοίξτε ένα παράθυρο του Azure PowerShell, μετακίνηση στο φάκελο δέσμης ενεργειών και εκτελέστε την ακόλουθη εντολή:

    ```powershell
    .\Deploy-ReferenceArchitecture.ps1 <subscription id> <location> <mode>
    ```

    Αντικατάσταση `<subscription id>` με το αναγνωριστικό Azure συνδρομής.

    Για `<location>`, καθορίστε μια περιοχή Azure, όπως `eastus` ή `westus`.

    Το `<mode>` παραμέτρου μπορεί να έχετε μία από τις ακόλουθες τιμές:

    - `Onpremise`, για να δημιουργήσετε το περιβάλλον προσομοίωση εσωτερικής εγκατάστασης.

    - `Infrastructure`, για να δημιουργήσετε την υποδομή VNet και μεταπήδηση πλαίσιο στο cloud.

    - `CreateVpn`, για να δημιουργήσετε πύλης Azure εικονικού δικτύου και συνδέστε τη με το δίκτυο εσωτερικής εγκατάστασης.

    - `AzureADDS`, για να δημιουργήσετε το ΣΠΣ, ως διακομιστές ΠΡΟΣΘΈΤΕΙ, ανάπτυξης υπηρεσίας καταλόγου Active Directory για αυτά τα ΣΠΣ και δημιουργήστε τον τομέα στο cloud.

    - `WebTier`, που δημιουργεί το web σειρά ΣΠΣ και μονάδα εξισορρόπησης φόρτου.

    - `Prepare`, που πραγματοποιεί όλες τις προηγούμενες εργασίες. **Αυτή είναι η προτεινόμενη επιλογή εάν δημιουργείτε μια εντελώς νέα ανάπτυξη και δεν έχετε μια υπάρχουσα υποδομή εσωτερικής εγκατάστασης.**

    - `Workload`Για να δημιουργήσετε το επίπεδο επιχειρήσεις και δεδομένα ΣΠΣ και φόρτωση balancers. Αυτά τα ΣΠΣ δεν περιλαμβάνονται ως τμήμα της το `Prepare` την επιλογή.

    >[AZURE.NOTE] Εάν χρησιμοποιείτε το `Prepare` την επιλογή, η δέσμη ενεργειών χρειάζεται μερικές ώρες για να ολοκληρωθεί.

8.  Εάν χρησιμοποιείτε το δείγμα ρύθμισης παραμέτρων εσωτερικής εγκατάστασης:

    1. Σύνδεση με το πλαίσιο μεταπήδηση (*ra-adtrust-διαχείρισης-vm1* στην ομάδα πόρων *ra-adtrust-ασφάλεια-rg* ). Συνδεθείτε ως *testuser* με κωδικό πρόσβασης *AweS0me@PW*.

    2.  Στο πλαίσιο μεταπήδηση ανοίξετε μια περίοδο λειτουργίας RDP στην την πρώτη εικονική Μηχανή στον τομέα *contoso.com* (τον τομέα εσωτερικής εγκατάστασης). Αυτή η Εικονική έχει τη διεύθυνση IP 192.168.0.4. Το όνομα χρήστη είναι *contoso\testuser* με κωδικό πρόσβασης *AweS0me@PW*.

    3. Κάντε λήψη του [εισερχόμενες trust.ps1] [ incoming-trust] δέσμης ενεργειών και εκτελέστε το για να δημιουργήσετε εισερχόμενες θεωρούνται αξιόπιστα από τον τομέα *treyresearch.com* .

9. Εάν χρησιμοποιείτε το δικό σας υποδομή εσωτερικής εγκατάστασης:

    1. Κάντε λήψη του [εισερχόμενες trust.ps1] [ incoming-trust] δέσμης ενεργειών.

    2. Επεξεργαστείτε τη δέσμη ενεργειών και αντικαταστήστε την τιμή από το `$TrustedDomainName` μεταβλητής με το όνομα του τομέα σας.

    3. Εκτελέστε τη δέσμη ενεργειών.

10. Από το πλαίσιο μεταπήδηση, η σύνδεση με την πρώτη Εικονική στα *treyresearch.com* τομέα (τον τομέα στο cloud). Αυτή η Εικονική έχει τη διεύθυνση IP 10.0.4.4. Το όνομα χρήστη είναι *treyresearch\testuser* με κωδικό πρόσβασης *AweS0me@PW*.

11. Κάντε λήψη του [εξερχόμενης trust.ps1] [ outgoing-trust] δέσμη ενεργειών και εκτελέστε το για να δημιουργήσετε εισερχόμενες θεωρούνται αξιόπιστα από τον τομέα *treyresearch.com* . Εάν χρησιμοποιείτε το δικό σας μηχανές εσωτερικής εγκατάστασης, στη συνέχεια, επεξεργαστείτε τη δέσμη ενεργειών πρώτα. Ορίστε το `$TrustedDomainName` μεταβλητής στο όνομα του τομέα σας στην εσωτερική εγκατάσταση, και να καθορίσετε τις διευθύνσεις IP των διακομιστών AD DS για αυτόν τον τομέα στο το `$TrustedDomainDnsIpAddresses` μεταβλητή.

12. Σε έναν υπολογιστή εσωτερικής εγκατάστασης, εκτελέστε τα βήματα που περιγράφονται στο άρθρο [Επαλήθευση μια σχέση αξιοπιστίας] [ verify-a-trust] για να προσδιορίσετε εάν η σχέση αξιοπιστίας έχει ρυθμιστεί σωστά μεταξύ τους τομείς *contoso.com* και *treyresearch.com* . Ίσως χρειαστεί να περιμένετε μερικά λεπτά αφού ολοκληρώσετε τα προηγούμενα βήματα πριν να θεωρούνται αξιόπιστα μπορεί να επικυρωθεί.

Τα υπόλοιπα προαιρετικά βήματα δείχνουν τον τρόπο για να προσδιορίσετε αν το αξιοπιστίας τομέα λειτουργεί όπως αναμένεται. Αυτά τα βήματα απαιτούν να έχετε πρόσβαση σε ανάπτυξη υπολογιστή με εγκατεστημένο το Visual Studio.

1.  Από το παράθυρο Azure PowerShell, εκτελέστε την ακόλουθη εντολή για να δημιουργήσετε το επίπεδο web, εάν δεν έχετε ορίσει το προς τα επάνω προηγουμένως (χρησιμοποιώντας το `Prepare` επιλογή):

    ```powershell
    .\Deploy-ReferenceArchitecture.ps1 <subscription id> <location> WebTier
    ```

    Αυτή η εντολή δημιουργεί την κλίμακα web και προσθέτει το ΣΠΣ στον τομέα *treyresearch.com* .

2. Χρήση του Visual Studio στον υπολογιστή ανάπτυξης, δημιουργήστε μια εφαρμογή ASP.NET Web με το όνομα *TreyResearchWebApp*. Χρησιμοποιήστε το .NET Framework 4.5.2.

3. Επιλέξτε το πρότυπο *MVC* και αλλάξτε τον έλεγχο ταυτότητας με *Τον έλεγχο ταυτότητας των Windows*. Μην δημιουργήσετε μιας εφαρμογής υπηρεσίας στο cloud.

3. Δημιουργία και εκτέλεση της εφαρμογής για να ελέγξετε τον έλεγχο ταυτότητας. Επιβεβαιώστε ότι το τρέχον όνομα χρήστη των Windows εμφανίζεται στη γραμμή μενού στο επάνω μέρος της σελίδας, προς τα δεξιά.

4. Κλείστε τον Internet Explorer.

5. Στο παράθυρο " *Εξερεύνηση λύσεων* ", κάντε δεξί κλικ στο έργο TreyResearchWebApp, κάντε κλικ στο κουμπί *Δημοσίευση*.

6. Στο παράθυρο " *Δημοσίευση Web* ", κάντε κλικ στην επιλογή *Προσαρμογή*. Δημιουργήστε ένα προσαρμοσμένο προφίλ με το όνομα *TreyResearchWebApp*.

7. Στη σελίδα *σύνδεσης* , ορίστε τη *μέθοδο δημοσίευση* στο *Σύστημα αρχείων* και καθορίστε ένα φάκελο που ονομάζεται *TreyResearchWebApp*, που βρίσκεται σε μια εύχρηστη θέση στον υπολογιστή σας στην ανάπτυξη.

8. Στη σελίδα *Ρυθμίσεις* , ορίστε τη *ρύθμιση των παραμέτρων* *έκδοση*.

9. Στη σελίδα *προεπισκόπησης* , κάντε κλικ στο κουμπί *Δημοσίευση*.

10. Σύνδεση σε κάθε Εικονική στο επίπεδο web με τη σειρά (χρησιμοποιώντας το πλαίσιο μεταπήδηση) και εκτελέστε τις ακόλουθες εργασίες. Οι διευθύνσεις IP του web επίπεδο ΣΠΣ είναι 10.0.1.4 και 10.0.1.5. Το όνομα χρήστη για δύο ΣΠΣ είναι *treyresearch\testuser* με κωδικό πρόσβασης *AweS0me@PW*:

    1. Αντιγράψτε το φάκελο *TreyResearchWebApp* και τα περιεχόμενά της από τον υπολογιστή ανάπτυξης στο φάκελο *C:\inetpub* .

    2. Χρησιμοποιώντας την Κονσόλα διαχείρισης υπηρεσιών Internet Information Services (IIS), μεταβείτε στην *τοποθεσία Web τοποθεσίες* στον υπολογιστή.

    3. Στο παράθυρο " *Ενέργειες* ", κάντε κλικ στην επιλογή *Βασικές ρυθμίσεις*, και αλλάξτε τη φυσική διαδρομή της τοποθεσίας web σε *%SystemDrive%\inetpub\TreyResearchWebApp*.

    4. Στο παράθυρο *Προβολής δυνατότητες* , κάντε διπλό κλικ *ελέγχου ταυτότητας*. Βεβαιωθείτε ότι είναι ενεργοποιημένη *Ελέγχου ταυτότητας των Windows* και *Ανώνυμος έλεγχος ταυτότητας* έχει απενεργοποιηθεί.

11. από έναν υπολογιστή εσωτερικής εγκατάστασης, ανοίξτε τον Internet Explorer και μεταβείτε στην τοποθεσία web στο http://10.0.1.254 (αυτή είναι η διεύθυνση από τη μονάδα εξισορρόπησης φόρτου επίπεδο web).

12. Στο παράθυρο διαλόγου *Ασφαλείας των Windows* , πληκτρολογήστε τα διαπιστευτήρια του χρήστη στον τομέα εσωτερικής εγκατάστασης. Καθορίστε ένα όνομα χρήστη που δεν υπάρχει στον τομέα *treyresearch* . Εάν χρησιμοποιείτε το περιβάλλον προσομοιωμένη εσωτερικής δημιουργήστε πρώτα ένα χρήστη στον τομέα *contoso* και καθορίστε τα διαπιστευτήρια αυτού του χρήστη.

13. Όταν εμφανιστεί η αρχική σελίδα, βεβαιωθείτε ότι το σωστό τομέα και το όνομα χρήστη εμφανίζεται στη γραμμή μενού στο επάνω μέρος της σελίδας, προς τα δεξιά.

## <a name="next-steps"></a>Επόμενα βήματα

- Μάθετε τις βέλτιστες πρακτικές για την [επέκταση του τομέα σας ΠΡΟΣΘΈΤΕΙ εσωτερικής εγκατάστασης στο Azure][adds-extend-domain]

- Μάθετε τις βέλτιστες πρακτικές για [τη δημιουργία μιας υποδομής ADFS] [ adfs] στο Azure.

<!-- links -->

[resource-manager-overview]: ../azure-resource-manager/resource-group-overview.md
[adfs]: ./guidance-identity-adfs.md
[adds-extend-domain]: ./guidance-identity-adds-extend-domain.md
[extending-ad-to-azure]: ./guidance-identity-adds-extend-domain.md
[implementing-aad]: ./guidance-identity-aad.md
[implementing-a-multi-tier-architecture-on-Azure]: ./guidance-compute-n-tier-vm.md
[implementing-a-secure-hybrid-network-architecture-with-internet-access]: ./guidance-iaas-ra-secure-vnet-dmz.md
[implementing-a-secure-hybrid-network-architecture]: ./guidance-iaas-ra-secure-vnet-hybrid.md
[implementing-a-hybrid-network-architecture-with-vpn]: ./guidance-hybrid-network-vpn.md
[running-VMs-for-an-N-tier-architecture-on-Azure]: ./guidance-compute-n-tier-vm.md
[azure-vpn-gateway]: https://azure.microsoft.com/documentation/articles/vpn-gateway-about-vpngateways/
[azure-expressroute]: https://azure.microsoft.com/documentation/articles/expressroute-introduction/
[ad-azure-guidelines]: https://msdn.microsoft.com/library/azure/jj156090.aspx
[standby-operations-masters]: https://technet.microsoft.com/library/cc794737(v=ws.10).aspx
[best_practices_ad_password_policy]: https://technet.microsoft.com/magazine/ff741764.aspx
[monitoring_ad]: https://msdn.microsoft.com/library/bb727046.aspx
[microsoft_systems_center]: https://www.microsoft.com/server-cloud/products/system-center-2016/
[creating-forest-trusts]: https://technet.microsoft.com/library/cc816810(v=ws.10).aspx
[creating-external-trusts]: https://technet.microsoft.com/library/cc816837(v=ws.10).aspx
[naming-conventions]: ./guidance-naming-conventions.md
[azure-powershell-download]: https://azure.microsoft.com/documentation/articles/powershell-install-configure/
[hybrid-azure-on-prem-vpn]: ./guidance-hybrid-network-vpn.md
[verify-a-trust]: https://technet.microsoft.com/library/cc753821.aspx
[netdom]: https://technet.microsoft.com/library/cc835085.aspx
[solution-script]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/Deploy-ReferenceArchitecture.ps1
[on-premises-folder]: https://github.com/mspnp/reference-architectures/tree/master/guidance-identity-adds-trust/parameters/onpremise
[on-premises-vnet-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/onpremise/virtualNetwork.parameters.json
[on-premises-virtualmachines-adds-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/onpremise/virtualMachines-adds.parameters.json
[on-premises-virtualnetworkgateway-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/onpremise/virtualNetworkGateway.parameters.json
[on-premises-connection-parameters]: https://github.com/mspnp/reference-architectures/blob/master/guidance-identity-adds-trust/parameters/onpremise/connection.parameters.json
[incoming-trust]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/extensions/incoming-trust.ps1
[outgoing-trust]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/extensions/outgoing-trust.ps1
[azure-folder]: https://github.com/mspnp/reference-architectures/tree/master/guidance-identity-adds-trust/parameters/azure
[vnet-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/virtualNetwork.parameters.json
[virtualmachines-adds-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/virtualMachines-adds.parameters.json
[add-adds-domain-controller-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/add-adds-domain-controller.parameters.json
[virtualnetworkgateway-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/virtualNetwork.parameters.json
[dmz-private-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/dmz-private.parameters.json
[dmz-public-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/dmz-public.parameters.json
[loadBalancer-web-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/loadBalancer-web.parameters.json
[loadBalancer-biz-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/loadBalancer-biz.parameters.json
[loadBalancer-data-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/loadBalancer-data.parameters.json
[virtualMachines-mgmt-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/virtualMachines-mgmt.parameters.json
[web-vm-domain-join-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-adds-trust/parameters/azure/web-vm-domain-join.parameters.json
[solution-components]: [#solution_components]
[0]: ./media/guidance-identity-aad-resource-forest/figure1.png "Ασφαλούς υβριδική αρχιτεκτονική δικτύου με διαφορετικούς τομείς AD"