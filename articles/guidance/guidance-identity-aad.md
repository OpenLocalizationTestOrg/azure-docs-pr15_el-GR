<properties
   pageTitle="Εφαρμογή καταλόγου Azure Active Directory | Microsoft Azure"
   description="Μάθετε πώς μπορείτε να εφαρμόσετε μια αρχιτεκτονική δικτύου ασφαλούς υβριδική χρησιμοποιώντας Azure Active Directory."
   services="guidance,virtual-network,active-directory"
   documentationCenter="na"
   authors="telmosampaio"
   manager="christb"
   editor=""
   tags="azure-resource-manager"/>

<tags
   ms.service="guidance"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/28/2016"
   ms.author="telmos"/>

# <a name="implementing-azure-active-directory"></a>Εφαρμογή καταλόγου Azure Active Directory

[AZURE.INCLUDE [pnp-RA-branding](../../includes/guidance-pnp-header-include.md)]

Σε αυτό το άρθρο περιγράφει τις βέλτιστες πρακτικές για την ενοποίηση τομείς Active Directory (AD) εσωτερικής εγκατάστασης και συμπλεγμάτων δομών με το Azure Active Directory για την παροχή ταυτότητας που βασίζεται στο cloud.

> [AZURE.NOTE] Azure έχει δύο διαφορετικές ανάπτυξης μοντέλα: [Διαχείριση πόρων] [ resource-manager-overview] και κλασική. Αυτή η αρχιτεκτονική αναφορά χρησιμοποιεί διαχείριση πόρων, η οποία η Microsoft συνιστά για νέες αναπτύξεις.

Μπορείτε να χρησιμοποιήσετε τις υπηρεσίες καταλόγου και ταυτότητα, όπως αυτές που παρέχονται από υπηρεσίες AD Directory (AD DS) για τον έλεγχο των ταυτοτήτων. Αυτές οι ταυτότητες μπορούν να ανήκουν σε χρήστες, υπολογιστές, εφαρμογές ή άλλοι πόροι που αποτελούν τμήμα ένα όριο ασφαλείας. Μπορείτε να φιλοξενήσετε καταλόγου και ταυτότητας υπηρεσιών εσωτερικής εγκατάστασης, αλλά σε ένα σενάριο υβριδική πού βρίσκονται τα στοιχεία μιας εφαρμογής στο Azure μπορεί να είναι πιο αποτελεσματική για να επεκτείνετε αυτή η λειτουργικότητα στο cloud. Αυτή η προσέγγιση μπορεί να σας βοηθήσει να μειώσετε την λανθάνων χρόνος που προκαλούνται από την αποστολή ελέγχου ταυτότητας και να επιστρέψετε αιτήσεις τοπικό εξουσιοδότησης από το cloud για τις υπηρεσίες καταλόγου και ταυτότητας που εκτελούνται εσωτερικής εγκατάστασης.

Azure παρέχει δύο λύσεις για την εφαρμογή υπηρεσιών καταλόγου και ταυτότητα του στο cloud:

1. Μπορείτε να χρησιμοποιήσετε το [Azure Active Directory (AAD)] [ azure-active-directory] για να δημιουργήσετε έναν τομέα AD στο cloud και να το συνδέσετε με μια εσωτερική τομέα AD. AAD σάς επιτρέπει να ρυθμίσετε τις παραμέτρους καθολικής σύνδεσης (SSO) για χρήστες που εκτελούν εφαρμογές πρόσβαση μέσω του στο cloud. AAD χρησιμοποιεί [Azure AD Connect] [ azure-ad-connect] εκτελείται εσωτερικής εγκατάστασης για την αναπαραγωγή αντικειμένων και τις ταυτότητες που θα διατηρούνται στο αποθετήριο δεδομένων εσωτερικής εγκατάστασης στο cloud.

    Μπορείτε επίσης να εφαρμόσετε AAD χωρίς να χρησιμοποιείτε έναν κατάλογο εσωτερικής εγκατάστασης. Σε αυτήν την περίπτωση, AAD λειτουργεί ως την κύρια προέλευση όλες οι πληροφορίες ταυτότητας και όχι που περιέχουν δεδομένα που έχουν αναπαραχθεί από κατάλογο εσωτερικής εγκατάστασης.

    Σημειώστε ότι ο κατάλογος στο cloud είναι **δεν** παράταση της έναν κατάλογο εσωτερικής εγκατάστασης. Αντίθετα, είναι ένα αντίγραφο που περιέχει το ίδιο αντικείμενα και τις ταυτότητες. Αλλαγές που γίνονται σε αυτά τα στοιχεία στην εσωτερική εγκατάσταση αντιγράφονται στο cloud, αλλά οι αλλαγές που έγιναν στο cloud **δεν είναι** να αναπαραχθούν ξανά για τον τομέα εσωτερικής εγκατάστασης.

    >[AZURE.NOTE] Οι εκδόσεις Azure Active Directory Premium υποστήριξη write-back από τους κωδικούς πρόσβασης των χρηστών, ενεργοποίηση τους χρήστες σας στην εσωτερική εγκατάσταση, για να εκτελέσετε επαναφορά κωδικών πρόσβασης από το χρήστη στο cloud. Αυτή είναι η μόνη πληροφορία που AAD συγχρονίζει ξανά για να τον κατάλογο εσωτερικής εγκατάστασης. Για περισσότερες πληροφορίες σχετικά με τις διαφορετικές εκδόσεις του AAD και τις δυνατότητές τους, ανατρέξτε στο θέμα [Azure Active Directory εκδόσεις][aad-editions].

2. Μπορείτε να αναπτύξετε μια Εικονική εκτελείται AD DS ως ελεγκτή τομέα στο Azure, επέκταση την υπάρχουσα υποδομή AD (συμπεριλαμβανομένων των AD DS και AD FS) από το κέντρο δεδομένων εσωτερικής εγκατάστασης. Αυτή η προσέγγιση είναι ο πιο κοινός για σενάρια όπου το δίκτυο εσωτερικής εγκατάστασης και Azure εικονικού δικτύου συνδέονται με μια σύνδεση VPN ή/και ExpressRoute. Αυτή η λύση υποστηρίζει επίσης διπλής κατεύθυνσης αναπαραγωγής που μπορείτε να κάνετε αλλαγές στο cloud και εσωτερικής εγκατάστασης, όπου και αν είναι πιο κατάλληλο.

Αυτή η αρχιτεκτονική εστιάζει σε λύση 1. Για περισσότερες πληροφορίες σχετικά με τη δεύτερη λύση, ανατρέξτε στο θέμα [Επέκταση υπηρεσίας καταλόγου Active Directory για να Azure][guidance-adds].

Τυπική χρήση υποθέσεις για αυτήν την αρχιτεκτονική περιλαμβάνουν τα εξής:

- Παροχή SSO για τους τελικούς χρήστες εκτελούν ΑΔΑ και άλλες εφαρμογές στο cloud, χρησιμοποιώντας τα ίδια διαπιστευτήρια που καθορίζουν για εφαρμογές εσωτερικής εγκατάστασης.

- Δημοσίευση στην εσωτερική εγκατάσταση εφαρμογών web μέσω του στο cloud για να παρέχετε πρόσβαση στους απομακρυσμένους χρήστες που ανήκουν στην εταιρεία σας.

- Εφαρμογή δυνατότητες από το χρήστη για τους τελικούς χρήστες, όπως η επαναφορά τους κωδικούς πρόσβασης και ανάθεση ομάδα διαχείρισης. 

    >[AZURE.NOTE] Αυτές οι δυνατότητες είναι δυνατός ο διαχειριστής μέσω της πολιτικής ομάδας.

- Περιπτώσεις όπου το δίκτυο εσωτερικής Azure εικονικού δικτύου και εφαρμογές φιλοξενίας cloud δεν συνδέονται απευθείας με τη χρήση μιας διοχέτευσης VPN ή ExpressRoute κυκλώματος.

Σημειώστε ότι AAD δεν παρέχει πλήρη λειτουργικότητα του AD. Για παράδειγμα, AAD προς το παρόν μόνο χειρίζεται τον έλεγχο ταυτότητας χρήστη και όχι τον έλεγχο ταυτότητας υπολογιστή. Ορισμένες εφαρμογές και υπηρεσίες, όπως ο SQL Server, μπορεί να απαιτεί έλεγχο ταυτότητας υπολογιστή δεν είναι κατάλληλη σε αυτή την περίπτωση αυτήν τη λύση. Επιπλέον, AAD ενδέχεται να μην είναι κατάλληλη για συστήματα όπου θα μπορούσε να μετεγκατασταθούν στοιχεία σε το όριο σε-εσωτερικής εγκατάστασης/cloud και όχι απλώς που αντιγράφεται.

> [AZURE.NOTE] Για μια αναλυτική εξήγηση του τρόπου λειτουργίας του Azure Active Directory, παρακολουθήστε [Microsoft Active Directory επεξήγηση][aad-explained].

## <a name="architecture-diagram"></a>Διάγραμμα αρχιτεκτονικής

Το παρακάτω διάγραμμα επισημαίνει τα σημαντικά στοιχεία σε αυτήν την αρχιτεκτονική. Για περισσότερες πληροφορίες σχετικά με τα στοιχεία φόρτο εργασίας στο Azure, διαβάστε [Εκτελείται ΣΠΣ για μια αρχιτεκτονική N-επιπέδων σε Azure][implementing-a-multi-tier-architecture-on-Azure]:

> [AZURE.NOTE] Για λόγους ευκολίας, αυτό το διάγραμμα μόνο εμφανίζει τις συνδέσεις απευθείας που σχετίζονται με AAD και δεν απεικονίζουν ανακατευθύνσεων πρόσκληση σε πρόγραμμα περιήγησης web ή άλλο πρωτόκολλο σχετικές κίνηση που μπορεί να προκύψουν ως μέρος της διαδικασίας Ομοσπονδία και ταυτότητα του ελέγχου ταυτότητας. Για παράδειγμα, ένας χρήστης (εσωτερικής εγκατάστασης ή remote) συνήθως αποκτά πρόσβαση σε μια εφαρμογή web μέσω ενός προγράμματος περιήγησης και της εφαρμογής web με διαφάνεια ενδέχεται να ανακατευθύνετε το πρόγραμμα περιήγησης web για τον έλεγχο ταυτότητας την αίτηση μέσω AAD. Αφού ελεγχθεί η ταυτότητά, την αίτηση μπορούν να περάσουν ξανά την εφαρμογή web μαζί με τις πληροφορίες κατάλληλο ταυτότητα.

[! [0]][0]

- **Azure Active Directory μισθωτή**. Αυτή είναι μια παρουσία του AAD που δημιουργήθηκε από την εταιρεία σας. Λειτουργεί ως μια υπηρεσία καταλόγου απλό για εφαρμογές cloud (αυτό περιέχει αντικείμενα που αντιγράψατε από το εσωτερικής AD), και παρέχει υπηρεσίες ταυτότητας.

- **Υποδίκτυο επίπεδο web**. Αυτό το υποδίκτυο διατηρήσεις ΣΠΣ που εφαρμόζουν μια προσαρμοσμένη εφαρμογή βασίζεται στο cloud που αναπτύχθηκε από την εταιρεία σας και για το οποίο AAD μπορεί να λειτουργήσει ως ένα broker ταυτότητα.

- **Εσωτερικής διακομιστή AD DS**. Πιθανό την εταιρεία σας έχει ήδη μια υπάρχουσα υπηρεσία καταλόγου, όπως AD DS. Μπορείτε να συγχρονίσετε πολλά από τα στοιχεία στον κατάλογό σας AD DS (όπως πληροφορίες χρηστών και ομάδων) με AAD, για να ενεργοποιήσετε την AAD να χρησιμοποιήσετε αυτές τις πληροφορίες για τον έλεγχο των ταυτοτήτων.

- **Διακομιστής azure AD Connect συγχρονισμού**. Αυτή είναι μια εσωτερική υπολογιστή που εκτελεί την υπηρεσία συγχρονισμού Azure AD Connect. Μπορείτε να εγκαταστήσετε αυτήν την υπηρεσία, χρησιμοποιώντας το λογισμικό Azure AD Connect. Η υπηρεσία συγχρονισμού Azure AD Connect συγχρονίζει πληροφορίες (χρήστες, ομάδες, επαφές, κ.λπ.) που θα διατηρούνται στα το εσωτερικής AD να AAD στο cloud. Για παράδειγμα, μπορείτε να προμηθεύσουν ή deprovision ομάδων και χρηστών εσωτερικής εγκατάστασης και αυτές οι αλλαγές θα μεταδοθούν σε AAD. Η υπηρεσία συγχρονισμού Azure AD Connect μεταφέρει πληροφορίες AAD μισθωτή.

    >[AZURE.NOTE] Για λόγους ασφαλείας, τους κωδικούς πρόσβασης του χρήστη δεν αποθηκεύονται απευθείας στο AAD. Αντίθετα, AAD κατέχει ο κατακερματισμός κάθε τον κωδικό πρόσβασης. Αυτό είναι αρκετό ώστε να επαληθεύσετε τον κωδικό πρόσβασης ενός χρήστη. Εάν ένας χρήστης απαιτεί επαναφορά του κωδικού πρόσβασης, αυτό πρέπει να έχει πραγματοποιηθεί στην εσωτερική εγκατάσταση και τη νέα κατακερματισμός αποστέλλονται AAD. Εκδόσεις AAD Premium περιλαμβάνει δυνατότητες που μπορεί να αυτοματοποιήσετε αυτή την εργασία για να ενεργοποιήσετε τους χρήστες να επαναφέρουν τους κωδικούς πρόσβασής τους.

## <a name="recommendations"></a>Συστάσεις

Αυτή η ενότητα συνοψίζει συστάσεις για την εφαρμογή AAD ως εξής.

- Σύνδεση AD
- Ασφάλεια

### <a name="azure-ad-connect-sync-service-recommendations"></a>Azure AD Connect συγχρονισμού υπηρεσίας συστάσεων

Συγχρονισμός αφορά την εξασφάλιση ότι οι πληροφορίες ταυτότητας χρηστών στο cloud είναι συνεπείς με αυτό που θα διατηρούνται εσωτερικής εγκατάστασης. Ο σκοπός της υπηρεσίας συγχρονισμού Azure AD Connect είναι για να διατηρήσετε τη συνέπεια σε αυτό. Τα ακόλουθα σημεία σύνοψη συστάσεις για την εφαρμογή της υπηρεσίας συγχρονισμού Azure AD Connect:

- Πριν από την εφαρμογή συγχρονισμού Azure AD Connect, θα πρέπει να προσδιορίσετε τις απαιτήσεις συγχρονισμού της εταιρείας σας (Τι θέλετε να συγχρονίσετε, από το ποια τομείς, και πόσο συχνά. Το άρθρο [Προσδιορισμός απαιτήσεις συγχρονισμού καταλόγου] [ aad-sync-requirements] περιγράφει τα σημεία που πρέπει να εξετάσετε.

- Μπορείτε να εκτελέσετε την υπηρεσία συγχρονισμού Azure AD Connect χρησιμοποιώντας μια Εικονική ή έναν υπολογιστή που φιλοξενούνται εσωτερικής εγκατάστασης. Ανάλογα με τη μεταβλητότητα των πληροφοριών στον κατάλογό σας AD, όταν τον αρχικό συγχρονισμό με AAD έχει πραγματοποιηθεί η φόρτωση την υπηρεσία συγχρονισμού του Azure AD Connect είναι πιθανό να είναι υψηλή. Χρησιμοποιώντας μια Εικονική σάς επιτρέπει να πιο εύκολα κλιμάκωση διακομιστή (οθόνη τη δραστηριότητα, όπως περιγράφεται στην ενότητα [ζητήματα παρακολούθησης](#monitoring-considerations) για να προσδιορίσετε αν αυτό είναι απαραίτητο).

- Εάν έχετε πολλούς τομείς εσωτερικής εγκατάστασης σε ένα σύμπλεγμα δομών, μπορείτε να αποθηκεύσετε και να συγχρονίσετε τις πληροφορίες για ολόκληρο το σύμπλεγμα δομών σε ένα μεμονωμένο μισθωτή AAD (αυτή είναι η προτεινόμενη προσέγγιση). Φιλτράρετε τις πληροφορίες για τις ταυτότητες που προκύπτουν σε περισσότερους από έναν τομείς, έτσι ώστε κάθε ταυτότητα εμφανίζεται μόνο μία φορά στο AAD αντί να γίνεται διπλή όπως αυτό μπορεί να οδηγήσει σε ασυνέπειες όταν γίνεται συγχρονισμός των δεδομένων. Αυτή η προσέγγιση απαιτεί υλοποίηση πολλών διακομιστών συγχρονισμού Azure AD Connect. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα το σενάριο πολλών AAD στην ενότητα [τοπολογία ζητήματα](#topology-considerations) . 

- Χρησιμοποιήστε το φιλτράρισμα για να περιορίσετε τα δεδομένα που είναι αποθηκευμένα σε AAD, μόνο που που είναι απαραίτητο. Για παράδειγμα, την εταιρεία σας δεν μπορεί να θέλετε να αποθηκεύσετε πληροφορίες σχετικά με τους λογαριασμούς ανενεργές ή μη προσωπικές στο AAD. Το φιλτράρισμα μπορεί να είναι με βάση την ομάδα, με βάση τον τομέα, βάσει OU ή βάσει χαρακτηριστικό και μπορείτε να συνδυάσετε φίλτρων για τη δημιουργία πιο σύνθετων κανόνων. Για παράδειγμα, μπορεί να επιλέξετε να συγχρονιστούν μόνο τα αντικείμενα που θα διατηρούνται σε έναν τομέα που έχουν μια συγκεκριμένη τιμή σε ένα επιλεγμένο χαρακτηριστικό. Για λεπτομερείς πληροφορίες, ανατρέξτε στο θέμα [Azure AD Connect συγχρονισμού: ρύθμιση παραμέτρων φιλτράρισμα][aad-filtering].

- Για να υλοποιήσετε υψηλής διαθεσιμότητας για την υπηρεσία συγχρονισμού AD Connect, εκτελέστε μια δευτερεύουσα διακομιστή δοκιμής. Για περισσότερες πληροφορίες, ανατρέξτε στην ενότητα [τοπολογία ζητήματα](#topology-considerations) .

### <a name="security-recommendations"></a>Συστάσεις ασφαλείας

Τα ακόλουθα στοιχεία συνοψίζουν τα κύρια ασφαλείας συστάσεις για την εφαρμογή AAD, ανάλογα με τις απαιτήσεις της εταιρείας σας:

- Διαχείριση κωδικών πρόσβασης χρηστών.

    Εάν χρησιμοποιείτε μια έκδοση premium των AAD, μπορείτε να ενεργοποιήσετε τον κωδικό πρόσβασης write-back από AAD στον κατάλογο εσωτερικής εγκατάστασης κατά την εκτέλεση μιας προσαρμοσμένης εγκατάστασης του Azure AD Connect:

    [! [9]][9]

    Αυτή η δυνατότητα επιτρέπει στους χρήστες να επαναφέρετε τις δικές τους κωδικούς πρόσβασης από εντός της πύλης Azure, αλλά θα πρέπει να ενεργοποιηθεί μόνο μετά την αναθεώρηση της εταιρείας σας πολιτική ασφαλείας τον κωδικό πρόσβασης. Για παράδειγμα, μπορείτε να περιορίσετε τους χρήστες που μπορούν να αλλάξουν τους κωδικούς πρόσβασης και μπορείτε να προσαρμόσετε την εμπειρία διαχείρισης κωδικού πρόσβασης. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Διαχείριση κωδικών πρόσβασης Προσαρμογή σύμφωνα με τις ανάγκες της εταιρείας σας][aad-password-management].

- Τη διατήρηση της προστασίας για εφαρμογές εσωτερικής εγκατάστασης που μπορεί να είναι η πρόσβαση σε εξωτερικά.

    Χρησιμοποιήστε το Azure διακομιστή μεσολάβησης εφαρμογής AD για την παροχή ελεγχόμενη πρόσβαση σε εφαρμογές web εσωτερικής εγκατάστασης από εξωτερικούς χρήστες μέσω AAD. Αυτή η προσέγγιση προστατεύει τις εφαρμογές σας, δεν εκθέτει τους απευθείας με το Internet. Μόνο οι χρήστες που έχουν έγκυρα διαπιστευτήρια στον κατάλογό σας Azure είναι σε θέση να φτάσει τις εφαρμογές σας. Για περισσότερες πληροφορίες, ανατρέξτε στο άρθρο [Ενεργοποίηση του διακομιστή μεσολάβησης εφαρμογής στην πύλη του Azure][aad-application-proxy].

- Ενεργή παρακολούθηση AAD όσον αφορά τις ενδείξεις ύποπτη δραστηριότητα.

    Εξετάστε το ενδεχόμενο χρήσης AAD Premium P2 edition, το οποίο περιλαμβάνει προστασία ταυτότητας AAD. Προστασία ταυτότητας χρησιμοποιεί αλγορίθμους προσαρμόσιμη μηχανικής εκμάθησης και λύσεις για τον εντοπισμό ανωμαλίες και συμβάντα που μπορεί να υποδεικνύουν ότι έχει παραβιαστεί μια ταυτότητα του κινδύνου. Για παράδειγμα, αυτό μπορεί να εντοπίσει ενδεχομένως ύπαρξη δραστηριότητα, όπως ακανόνιστο εισόδου δραστηριότητες, πρόσθετα εισόδου από άγνωστες προελεύσεις ή από διευθύνσεις IP με ύποπτες δραστηριότητες ή πρόσθετα εισόδου από συσκευές που ίσως να έχει. Χρήση αυτών των δεδομένων, προστασία ταυτότητας δημιουργεί αναφορές και τις ειδοποιήσεις που σας επιτρέπει να εξετάσετε τα παρακάτω συμβάντα κινδύνου και να λαμβάνουν κατάλληλο αποκατάσταση εύρυθμης λειτουργίας ή μετριασμού ενέργεια. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Προστασία ταυτότητας Active Directory Azure][aad-identity-protection].

    Μπορείτε επίσης να χρησιμοποιήσετε τη δυνατότητα δημιουργίας αναφορών του AAD στην πύλη του Azure για την παρακολούθηση της ύποπτες και άλλα σχετικά με την ασφάλεια δραστηριότητες που μεσολαβούν εντός του συστήματος. AAD μπορεί να δημιουργήσει μια σειρά από αναφορές σύνοψης:

    [! [17]][17]

    Για περισσότερες πληροφορίες σχετικά με αυτές τις αναφορές, ανατρέξτε στο θέμα [Azure Active Directory αναφοράς Οδηγός][aad-reporting-guide].

## <a name="topology-considerations"></a>Ζητήματα τοπολογίας

Εάν έχετε ενοποίηση έναν κατάλογο εσωτερικής εγκατάστασης με AAD, ρυθμίστε τις παραμέτρους Azure AD Connect για την υλοποίηση μια τοπολογία που ταιριάζει περισσότερο με τις απαιτήσεις της εταιρείας σας. Τοπολογίες που υποστηρίζει το Azure AD Connect περιλαμβάνουν τα εξής:

- **Μία δάσος, μία AAD καταλόγου**. Στην τοπολογία αυτό, μπορείτε να χρησιμοποιήσετε Azure AD Connect για να συγχρονίσετε τα αντικείμενα και ταυτότητας πληροφορίες σε έναν ή περισσότερους τομείς σε μία εσωτερικής δάσος με μία μόνο AAD μισθωτή. Αυτή είναι η προεπιλεγμένη τοπολογία υλοποιούνται από τη γρήγορη εγκατάσταση του Azure AD Connect.

    [! [1]][1]

    Μην δημιουργήσετε πολλούς διακομιστές συγχρονισμού Azure AD Connect για σύνδεση διαφορετικούς τομείς στο ίδιο δάσος εσωτερικής εγκατάστασης στον ίδιο μισθωτή AAD, εκτός και εάν χρησιμοποιείτε ένα διακομιστή συγχρονισμού Azure AD Connect ενδιάμεσου λειτουργία (ανατρέξτε στο θέμα ενδιάμεσου διακομιστή παρακάτω).

- **Πολλών συμπλεγμάτων δομών, μία AAD καταλόγου**. Χρησιμοποιήστε αυτό τοπολογία εάν έχετε περισσότερες από μία δάσος εσωτερικής εγκατάστασης. Μπορείτε να ενοποιήσετε πληροφορίες ταυτότητας, έτσι ώστε κάθε χρήστης μοναδικό αναπαριστάται μία φορά στον κατάλογο AAD, ακόμα και αν υπάρχει το ίδιο χρήστη σε περισσότερες από μία δάσος. Όλα συμπλεγμάτων δομών Χρησιμοποιήστε στον ίδιο διακομιστή συγχρονισμού Azure AD Connect. Ο διακομιστής Azure AD Connect συγχρονισμού δεν χρειάζεται να είναι μέρος του οποιονδήποτε τομέα, αλλά πρέπει να είναι προσβάσιμος από όλους συμπλεγμάτων δομών:

    [! [2]][2]

    Σε αυτό το τοπολογία, μην χρησιμοποιείτε ξεχωριστή Azure AD Connect συγχρονισμός διακομιστές για σύνδεση κάθε δάσος εσωτερικής εγκατάστασης σε έναν μεμονωμένο μισθωτή AAD. Αυτό μπορεί να έχει ως αποτέλεσμα διπλότυπες ταυτότητας πληροφορίες στο AAD εάν οι χρήστες είναι παρόντες σε περισσότερες από μία δάσος.

- **Πολλά συμπλεγμάτων δομών, τοπολογίες ξεχωριστά**. Αυτή η προσέγγιση σάς επιτρέπει να συγχώνευση πληροφοριών ταυτότητας από ξεχωριστό συμπλεγμάτων δομών σε ένα μεμονωμένο μισθωτή AAD. Αυτή η στρατηγική είναι χρήσιμη αν συνδυάζετε συμπλεγμάτων δομών από διαφορετικές εταιρείες (μετά από μια συγχώνευση ή απόκτηση, για παράδειγμα), και οι πληροφορίες ταυτότητας για κάθε χρήστη πραγματοποιείται σε μία μόνο δάσος:

    Εάν το GALs σε κάθε δάσος είναι συγχρονισμένα, στη συνέχεια, ένας χρήστης σε ένα σύμπλεγμα δομών ενδέχεται να είναι παρόντες σε μια άλλη ως επαφή. Αυτό μπορεί να συμβεί εάν, για παράδειγμα, την εταιρεία σας έχει υλοποιηθεί GALSync με Διαχείριση ταυτοτήτων Forefront 2010 ή Διαχείριση ταυτοτήτων Microsoft 2016. Σε αυτό το σενάριο, μπορείτε να καθορίσετε ότι οι χρήστες θα πρέπει να προσδιορίζεται από το χαρακτηριστικό *αλληλογραφίας* . Μπορείτε επίσης να αντιστοιχίσετε ταυτότητες χρησιμοποιώντας τα χαρακτηριστικά *ObjectSID* και *msExchMasterAccountSID* . Αυτό είναι χρήσιμο εάν έχετε ένα ή περισσότερα συμπλεγμάτων δομών πόρων με απενεργοποιημένοι λογαριασμοί.

- **Ενδιάμεσου διακομιστή**. Σε αυτήν τη ρύθμιση, μπορείτε να εκτελέσετε μια δεύτερη παρουσία του διακομιστή συγχρονισμού Azure AD Connect παράλληλα με την πρώτη. Αυτή η δομή υποστηρίζει σενάρια όπως:

    - Υψηλή διαθεσιμότητα.

    - Δοκιμή και ανάπτυξη μια νέα ρύθμιση παραμέτρων του διακομιστή συγχρονισμού Azure AD Connect.

    - Εισαγωγή νέου διακομιστή και να διακόψετε τη χρήση ένα παλιό ρύθμισης παραμέτρων. 

    Σε αυτά τα σενάρια, την παρουσία του δεύτερου εκτελείται στο *ενδιάμεσου λειτουργία*. Ο διακομιστής καταγράφει τα αντικείμενα που έχουν εισαχθεί και συγχρονισμός δεδομένων στη βάση δεδομένων του, αλλά δεν μεταβιβάζεται τα δεδομένα AAD. Μόνο όταν απενεργοποιήσετε τη λειτουργία δημιουργίας σταδίων η διακομιστή έναρξης εγγραφή δεδομένων σε AAD, καθώς και ξεκινά απόδοση κωδικού πρόσβασης εγγραφής-δημιουργεί αντίγραφο σε καταλόγους εσωτερικής εγκατάστασης ανάλογα με την περίπτωση:

    [! [4]][4]

    Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Azure AD Connect συγχρονισμού: λειτουργικές εργασίες και τα θέματα][aad-connect-sync-operational-tasks].

- **Πολλές AAD καταλόγων**. Συνιστάται να που έχετε δημιουργήσει έναν μεμονωμένο κατάλογο AAD για μια εταιρεία, αλλά μπορεί να υπάρχουν περιπτώσεις όπου πρέπει να πληροφορίες διαμερισμάτων σε ξεχωριστή AAD καταλόγων. Σε αυτήν την περίπτωση, θα πρέπει να διασφαλίσετε ότι κάθε αντικείμενο από το σύμπλεγμα εσωτερικής εμφανίζεται μόνο σε έναν κατάλογο AAD, για να αποφύγετε προβλήματα write-back συγχρονισμού και τον κωδικό πρόσβασης.

    Για να υλοποιήσετε αυτό το σενάριο, ρύθμιση παραμέτρων ξεχωριστή Azure AD Connect συγχρονισμός διακομιστές για κάθε κατάλογο AAD και χρησιμοποιήστε το φιλτράρισμα, ώστε να λειτουργεί κάθε διακομιστής Azure AD Connect συγχρονισμού σε ένα σύνολο αμοιβαία αποκλειόμενων αντικειμένων: 

    [! [5]][5]

Για περισσότερες πληροφορίες σχετικά με αυτές τις τοπολογίες, ανατρέξτε στο θέμα [τοπολογίες για Azure AD Connect][aad-topologies].

## <a name="user-sign-in-considerations"></a>Χρήστης εισόδου ζητήματα

Από προεπιλογή, η υπηρεσία AAD προϋποθέτει ότι οι χρήστες συνδέονται με την παροχή τον ίδιο κωδικό πρόσβασης που χρησιμοποιούν εσωτερικής εγκατάστασης και ο διακομιστής Azure AD Connect συγχρονισμού ρυθμίζει τις παραμέτρους συγχρονισμό κωδικού πρόσβασης μεταξύ του τομέα εσωτερικής εγκατάστασης και AAD. Για πολλές εταιρείες, αυτό είναι κατάλληλο, αλλά πρέπει να εξετάσετε τις υπάρχουσες πολιτικές και την υποδομή του οργανισμού σας. Για παράδειγμα:

- Η πολιτική ασφαλείας της εταιρείας σας, μπορεί να απαγορεύσουν συγχρονισμό Κατακερματισμοί τον κωδικό πρόσβασης στο cloud.

- Ενδέχεται να απαιτεί ότι οι χρήστες αντιμετωπίζουν απρόσκοπτη SSO (χωρίς επιπλέον τον κωδικό πρόσβασής σας ζητά) κατά την πρόσβαση στο cloud πόρους από τον τομέα συνενώνονται μηχανές του εταιρικού δικτύου.

- Εταιρεία σας ενδέχεται να έχετε ήδη ADFS ή έναν τρίτο μέρος Ομοσπονδία υπηρεσίας παροχής αναπτυχθεί. Μπορείτε να ρυθμίσετε AAD για να χρησιμοποιήσετε αυτήν την υποδομή υλοποίηση τον έλεγχο ταυτότητας και SSO και όχι με τη χρήση των πληροφοριών τον κωδικό πρόσβασης που θα διατηρούνται στο cloud.

Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Azure AD σύνδεση χρήστη εγγραφή σχετικά με τις επιλογές][aad-user-sign-in].

## <a name="azure-ad-application-proxy-considerations"></a>Azure AD εφαρμογής διακομιστή μεσολάβησης ζητήματα

Χρησιμοποιήστε Azure AD για να παρέχουν πρόσβαση σε εφαρμογές εσωτερικής εγκατάστασης.

- Έκθεση εφαρμογές web εσωτερικής εγκατάστασης με χρήση διακομιστή μεσολάβησης εφαρμογής διαχείριση γραμμών σύνδεσης από το στοιχείο Azure AD εφαρμογής διακομιστή μεσολάβησης. Η γραμμή σύνδεσης διακομιστή μεσολάβησης εφαρμογής ανοίγει μια σύνδεση εξερχομένων δικτύου με το διακομιστή μεσολάβησης εφαρμογής Azure AD. Οι απομακρυσμένοι χρήστες αιτήσεις δρομολογούνται πίσω από AAD μέσω αυτής της σύνδεσης στις εφαρμογές web. Αυτός ο μηχανισμός καταργεί την ανάγκη για να ανοίξετε θύρες εισερχομένων στο τείχος προστασίας στην εσωτερική εγκατάσταση, μειώνοντας στην επιφάνεια επίθεση που εκτίθεται από την εταιρεία σας.

Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [δημοσίευση εφαρμογών με χρήση διακομιστή μεσολάβησης Azure AD εφαρμογής][aad-application-proxy].

## <a name="object-synchronization-considerations"></a>Ζητήματα συγχρονισμού αντικειμένου

Η προεπιλεγμένη ρύθμιση παραμέτρων του Azure AD Connect συγχρονίζει αντικείμενα από τον τοπικό καταλόγου AD με βάση το σύνολο των κανόνων που καθορίζονται στο άρθρο [Azure AD Connect συγχρονισμού: Κατανόηση της προεπιλεγμένης ρύθμισης παραμέτρων][aad-connect-sync-default-rules]. Μόνο αντικείμενα τα οποία ικανοποιούν συγχρονίζονται αυτούς τους κανόνες, άλλους παραβλέπονται. Για παράδειγμα, αντικείμενα χρήστη πρέπει να έχει ένα μοναδικό *sourceAnchor* χαρακτηριστικό και πρέπει να συμπληρωθεί το χαρακτηριστικό *accounEnabled* . Αντικείμενα χρήστη που δεν έχετε ένα έγκυρο χαρακτηριστικό *sAMAccountName* ή που ξεκινούν με το κείμενο *AAD_* ή *MSOL_* δεν συγχρονίζονται. Azure AD Connect εφαρμόζει πολλούς κανόνες σε αντικείμενα χρήστη, επαφή, ομάδα, ForeignSecurityPrincipal και υπολογιστή. Εάν πρέπει να τροποποιήσετε το προεπιλεγμένο σύνολο των κανόνων, χρησιμοποιήστε το πρόγραμμα επεξεργασίας κανόνων συγχρονισμού εγκατασταθεί με το Azure AD Connect (επίσης τεκμηριώνονται σε [Azure AD Connect συγχρονισμού: Κατανόηση της προεπιλεγμένης ρύθμισης παραμέτρων][aad-connect-sync-default-rules]).

Μπορείτε να ορίσετε τα δικά σας φίλτρα για να περιορίσετε τα αντικείμενα να συγχρονιστούν με τον τομέα ή την οργανική Μονάδα. Ή υλοποίηση πιο σύνθετα προσαρμοσμένα φιλτράρισμα, όπως περιγράφεται στο [Azure AD Connect συγχρονισμού: ρύθμιση παραμέτρων φιλτράρισμα][aad-filtering].

## <a name="security-considerations"></a>Ζητήματα ασφαλείας

Χρησιμοποιήστε τον έλεγχο πρόσβασης υπό όρους για να απόρριψη αιτήσεων ελέγχου ταυτότητας από μη αναμενόμενο προελεύσεις:

- Έναυσμα [Azure έλεγχο ταυτότητας πολλών παραγόντων (MFA)] [ azure-multifactor-authentication] εάν ένας χρήστης επιχειρεί να συνδεθεί από μια μη αξιόπιστη θέση (όπως μέσω του Internet) και όχι ένα αξιόπιστο δίκτυο.

- Χρησιμοποιήστε τον τύπο της πλατφόρμας συσκευής του χρήστη (iOS, Android, Windows Mobile, Windows) για να προσδιορίσετε πολιτική πρόσβασης σε εφαρμογές και δυνατότητες.

- Καταγραφή της κατάστασης ενεργοποίηση/απενεργοποίηση των συσκευών των χρηστών και ενσωμάτωση αυτές τις πληροφορίες σε τους ελέγχους πολιτική πρόσβασης. Για παράδειγμα, εάν ένας χρήστης τηλέφωνο χαθεί ή κλοπής αυτό θα πρέπει να καταγράφονται ως απενεργοποιημένη για να αποτρέψετε που χρησιμοποιείται για να αποκτήσετε πρόσβαση.

- Ελέγχετε το επίπεδο πρόσβασης σε ένα χρήστη με βάση την ιδιότητα μέλους ομάδας. Χρήση [κανόνων δυναμική ιδιότητα μέλους AAD] [ aad-dynamic-membership-rules] για να απλοποιήσετε τη διαχείριση της ομάδας. Για μια σύντομη επισκόπηση του τρόπου λειτουργίας, ανατρέξτε στο θέμα [Εισαγωγή στις δυναμικές ιδιότητες μελών για τις ομάδες][aad-dynamic-memberships].

- Χρησιμοποιήστε πολιτικές κινδύνου υπό όρους πρόσβασης με προστασία ταυτότητας AAD για να παρέχουν πρόσθετη προστασία βάσει ασυνήθιστο εισόδου δραστηριότητες ή άλλα συμβάντα.

Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [πρόσβαση υπό όρους Azure Active Directory][aad-conditional-access].

## <a name="scalability-considerations"></a>Ζητήματα κλιμάκωση

Κλιμάκωση αντιμετωπίζεται από την υπηρεσία AAD και τη ρύθμιση παραμέτρων του διακομιστή συγχρονισμού Azure AD Connect:

- Για την υπηρεσία AAD, δεν χρειάζεται να ρυθμίσετε τις επιλογές για την υλοποίηση κλιμάκωση. Η υπηρεσία AAD υποστηρίζει κλιμάκωση βάση αντίγραφα. AAD υλοποιεί μια μεμονωμένη κύρια ρεπλίκα, ποια λαβές λειτουργίες εγγραφής, και πολλά αντίγραφα δευτερεύοντα μόνο για ανάγνωση. AAD ανακατευθύνει με διαφάνεια Επιχειρήθηκε εγγραφών που έγιναν σε σχέση με δευτερεύοντα αντίγραφα στην κύρια ρεπλίκα. AAD παρέχει ενδεχόμενη συνέπειας. Όλες οι αλλαγές που έγιναν στην κύρια ρεπλίκα μεταβιβάζονται για τη δευτερεύουσα αντίγραφα. Καθώς οι περισσότερες λειτουργίες σε σχέση με AAD είναι διαβάζει και όχι εγγραφές, αυτή η αρχιτεκτονική κλίμακες σωστά.

    Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Azure AD: Εμφάνιση σύνθετων ρυθμίσεων του καταλόγου μας παν πλεονάζοντα, ιδιαίτερα διαθέσιμη, κατανέμεται cloud][aad-scalability].

- Για το διακομιστή συγχρονισμού Azure AD Connect, θα πρέπει να προσδιορίσετε τον αριθμό αντικειμένων που είναι πιθανό να συγχρονίσετε από τον τοπικό κατάλογο. Εάν έχετε λιγότερο ιεραρχική αντικείμενα, μπορείτε να χρησιμοποιήσετε το προεπιλεγμένο λογισμικό SQL Server Express LocalDB που παρέχεται με το Azure AD Connect. Εάν έχετε ένα μεγαλύτερο αριθμό αντικειμένων, θα πρέπει να εγκαταστήσετε μια έκδοση παραγωγής του SQL Server και να εκτελέσετε μια προσαρμοσμένη εγκατάσταση από το Azure AD Connect που καθορίζει ότι πρέπει να χρησιμοποιεί μια υπάρχουσα παρουσία του SQL Server.

## <a name="availability-considerations"></a>Ζητήματα διαθεσιμότητας

Όπως με κλιμάκωση ανησυχίες, διαθεσιμότητα εκτείνεται σε την υπηρεσία AAD και τις παραμέτρους του Azure AD Connect:

- Η υπηρεσία AAD έχει σχεδιαστεί για την παροχή υψηλής διαθεσιμότητας. Δεν υπάρχουν επιλογές διαθεσιμότητας ρυθμίζονται από το χρήστη. Είναι κατανεμημένο παν και εκτελείται σε πολλά δεδομένα κέντρα Άνοιγμα όλο τον κόσμο, με την αυτοματοποιημένη ανακατεύθυνσης. Εάν ένα κέντρο δεδομένων δεν είναι διαθέσιμη, AAD διασφαλίζει ότι τα δεδομένα σας καταλόγου είναι διαθέσιμο για παρουσία πρόσβαση σε τουλάχιστον δύο περισσότερες κέντρα δεδομένων περιφερειακό επίπεδο διεσπαρμένη.

    >[AZURE.NOTE] Το SLA για τη βασική AAD και Premium υπηρεσίες εγγυήσεις τουλάχιστον 99,9% της διαθεσιμότητας. Δεν υπάρχει καμία SLA για τη δωρεάν σειρά της AAD. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [SLA για Azure Active Directory][sla-aad].

- Για να αυξήσετε τη διαθεσιμότητα του διακομιστή συγχρονισμού Azure AD Connect μπορείτε να εκτελέσετε μια δεύτερη παρουσία στο ενδιάμεσου λειτουργία, όπως περιγράφεται στην ενότητα [τοπολογία ζητήματα](#topology-considerations) . 

    Επιπλέον, εάν δεν χρησιμοποιείτε την παρουσία του SQL Server Express LocalDB που παρέχεται με το Azure AD Connect, στη συνέχεια, θα πρέπει να υψηλής διαθεσιμότητας για τον SQL Server. Σημειώστε ότι η λύση μόνο υψηλή διαθεσιμότητα υποστηρίζονται είναι σύμπλεγμα SQL. Λύσεις όπως αποτελούν πιστή αναπαράσταση και πάντα σε δεν υποστηρίζονται από το Azure AD Connect.

    Για επιπλέον ζητήματα σχετικά με τη διατήρηση τη διαθεσιμότητα των ο διακομιστής Azure AD Connect συγχρονισμού και πώς μπορείτε να ανακτήσετε μετά από μια αποτυχία, ανατρέξτε στο θέμα [Azure AD Connect συγχρονισμού: λειτουργικές εργασίες και τα θέματα - αποκατάσταση][aad-sync-disaster-recovery].

## <a name="management-considerations"></a>Ζητήματα διαχείρισης

Υπάρχουν δύο πλευρές για τη Διαχείριση AAD:

1. Διαχείριση AAD στο cloud.

2. Λαμβάνοντας υπόψη τους διακομιστές Azure AD Connect συγχρονισμού.

AAD παρέχει τις ακόλουθες επιλογές για τη Διαχείριση τομέων και καταλόγων στο cloud:

- [Λειτουργική μονάδα Azure Active Directory PowerShell][aad-powershell]. Χρησιμοποιήστε αυτήν την ενότητα, εάν πρέπει να δέσμης ενεργειών κοινές εργασίες Azure AD διαχείρισης όπως Διαχείριση χρηστών, διαχείρισης τομέα και για τη ρύθμιση παραμέτρων Καθολικής σύνδεσης.

- Blade διαχείρισης Azure AD στην πύλη του Azure. Αυτό blade παρέχει μια προβολή αλληλεπιδραστικών διαχείρισης του καταλόγου και σας επιτρέπει να ελέγχετε και να ρυθμίσετε τις παραμέτρους περισσότερες πτυχές των AAD.

    [! [10]][10]

Azure AD Connect εγκαθιστά τα ακόλουθα εργαλεία που χρησιμοποιείτε για να διατηρήσετε τις υπηρεσίες συγχρονισμού Azure AD Connect από υπολογιστές σας εσωτερικής εγκατάστασης:

- Κονσόλα Microsoft Azure Active Directory σύνδεση. Αυτό το εργαλείο σάς επιτρέπει να τροποποιήσετε τη ρύθμιση παραμέτρων του διακομιστή Azure AD Sync, προσαρμογή πώς θα γίνει συγχρονισμός, ενεργοποίηση ή απενεργοποίηση της λειτουργίας ενδιάμεσου σταδίου και εναλλαγή εισόδου λειτουργία χρήστη (μπορείτε να ενεργοποιήσετε AD FS είσοδος χρησιμοποιώντας την υποδομή σας εσωτερικής εγκατάστασης).

- Η διαχείριση της υπηρεσίας συγχρονισμού. Χρησιμοποιήστε την καρτέλα *Λειτουργίες* σε αυτό το εργαλείο για να διαχειριστείτε τη διαδικασία συγχρονισμού και εντοπισμός εάν όλα τα τμήματα της διαδικασίας απέτυχε. Μπορείτε να ενεργοποιήσετε συγχρονισμών με μη αυτόματο τρόπο χρησιμοποιώντας αυτό το εργαλείο. 

    [! [12]][12]

    Στην καρτέλα *συνδέσεις* σας επιτρέπει να ελέγχετε τις συνδέσεις για τους τομείς (εσωτερικής εγκατάστασης και στο cloud) στην οποία είναι συνδεδεμένο το μηχανισμό συγχρονισμού:

    [! [13]][13]

-  Πρόγραμμα επεξεργασίας κανόνων συγχρονισμού. Χρησιμοποιήστε αυτό το εργαλείο για να προσαρμόσετε τον τρόπο με την οποία μετατρέπονται αντικείμενα όταν αντιγράφονται ανάμεσα σε έναν κατάλογο εσωτερικής εγκατάστασης και AAD στο cloud. Αυτό το εργαλείο σάς επιτρέπει να καθορίσετε επιπλέον χαρακτηριστικά και αντικειμένων για το συγχρονισμό και φίλτρα για να καθορίσετε ποια παρουσίες θα πρέπει να ή δεν θα πρέπει να συγχρονιστούν.

    Για περισσότερες πληροφορίες, ανατρέξτε στην ενότητα πρόγραμμα επεξεργασίας κανόνων συγχρονισμού στο έγγραφο [Azure AD Connect συγχρονισμού: Κατανόηση της προεπιλεγμένης ρύθμισης παραμέτρων][aad-connect-sync-default-rules].

Στη σελίδα [Azure AD Connect συγχρονισμού: βέλτιστες πρακτικές για την αλλαγή της προεπιλεγμένης ρύθμισης παραμέτρων] [ aad-sync-best-practices] περιέχει πρόσθετες πληροφορίες και συμβουλές για τη Διαχείριση Azure AD Connect.

## <a name="monitoring-considerations"></a>Παρακολούθηση ζητήματα

Παρακολούθηση εύρυθμης λειτουργίας πραγματοποιείται χρησιμοποιώντας μια σειρά από παράγοντες εγκατεστημένο εσωτερικής εγκατάστασης:

- Azure AD Connect εγκαθιστά παράγοντας που καταγράφει πληροφορίες σχετικά με την συγχρονισμών. Χρησιμοποιήστε το Azure Active Directory σύνδεση εύρυθμης λειτουργίας blade στην πύλη του Azure για την παρακολούθηση της εύρυθμης λειτουργίας και των Azure AD Connect επιδόσεων. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Χρήση Azure AD σύνδεση εύρυθμης λειτουργίας για το συγχρονισμό με][aad-health].

- Για την παρακολούθηση της εύρυθμης λειτουργίας των τομέων AD DS και καταλόγων από το Azure, εγκαταστήστε το Azure AD σύνδεση εύρυθμης λειτουργίας για τον παράγοντα AD DS σε υπολογιστή εντός του τομέα εσωτερικής εγκατάστασης. Χρησιμοποιήστε το Azure Active Directory σύνδεση εύρυθμης λειτουργίας blade στην πύλη του Azure AD DS οθόνη. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Χρήση Azure AD σύνδεση εύρυθμης λειτουργίας με AD DS][aad-health-adds]

- Εγκαταστήστε το Azure AD σύνδεση εύρυθμης λειτουργίας για τον παράγοντα AD FS να παρακολουθεί την εύρυθμη λειτουργία της AD FS εκτελείται σε εσωτερικής εγκατάστασης και να χρησιμοποιήσετε το Azure Active Directory σύνδεση εύρυθμης λειτουργίας blade στην πύλη του Azure για την παρακολούθηση της AD DS. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Χρήση του Azure AD σύνδεση εύρυθμης λειτουργίας με AD FS][aad-health-adfs]

Για περισσότερες πληροφορίες σχετικά με την εγκατάσταση του παράγοντες AD σύνδεση εύρυθμης λειτουργίας και τις απαιτήσεις, ανατρέξτε στο θέμα [Azure AD σύνδεση εύρυθμης λειτουργίας παράγοντας εγκατάστασης][aad-agent-installation].

## <a name="sample-solution"></a>Δείγμα λύσης

Αυτή η ενότητα έγγραφα τα βήματα για τη δημιουργία μιας λύσης δείγμα που μπορείτε να χρησιμοποιήσετε για να ελέγξετε τη ρύθμιση παραμέτρων του AAD. Η λύση περιλαμβάνει τα ακόλουθα στοιχεία:

- Μια εφαρμογή web ν σειρών, σύμφωνα με τη δομή που περιγράφεται από [Εκτελείται ΣΠΣ για μια αρχιτεκτονική N-επιπέδων σε Azure][implementing-a-multi-tier-architecture-on-Azure].

- Έναν υπολογιστή-πελάτη δοκιμής. Συνιστάται να χρησιμοποιείτε ένα άλλο Εικονική για αυτόν τον υπολογιστή. Η ρύθμιση παραμέτρων για αυτό Εικονική δεν έχει σημασία, με την προϋπόθεση ότι έχετε δικαιώματα πρόσβασης διαχειριστή και μπορεί να συνδεθεί σε εφαρμογή web n επιπέδων.

- Ένα περιβάλλον προσομοιωμένη εσωτερικής εγκατάστασης που περιέχει το δικό του τομέα που δημιουργούνται χρησιμοποιώντας AD DS.

Τα σενάρια που καταδεικνύουν αυτά τα βήματα είναι τα εξής:

- Ενεργοποίηση πρόσβασης στην εφαρμογή web ν σειρών εκτελείται στο cloud σε εξωτερικούς χρήστες, με AAD παρέχει έλεγχο ταυτότητας τον κωδικό πρόσβασης.

- Ενεργοποίηση πρόσβασης στην εφαρμογή web ν σειρών εκτελείται στο cloud για τους χρήστες που χρησιμοποιούν εντός του οργανισμού, με AAD παρέχει έλεγχο ταυτότητας τον κωδικό πρόσβασης.

### <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

Τα βήματα που ακολουθούν προϋποθέτουν τις ακόλουθες προϋποθέσεις:

- Έχετε μια υπάρχουσα συνδρομή Azure στο οποίο μπορείτε να δημιουργήσετε ομάδες πόρων.

- Έχετε εγκαταστήσει το [περιβάλλον γραμμής εντολών Azure][azure-cli].

- Έχετε λάβει και να εγκαταστήσει την πιο πρόσφατη δομή. Δείτε [εδώ] [ azure-powershell-download] για οδηγίες.

- Έχετε εγκαταστήσει ένα αντίγραφο του το [makecert] [ makecert] βοηθητικού προγράμματος του υπολογιστή-πελάτη δοκιμής.

- Έχετε πρόσβαση σε έναν υπολογιστή ανάπτυξης που έχει εγκατεστημένο το Visual Studio.

### <a name="create-the-n-tier-web-application-architecture"></a>Δημιουργήστε την αρχιτεκτονική εφαρμογής web ν σειρών

1. Δημιουργήστε ένα φάκελο που ονομάζεται `Scripts` που περιέχει έναν υποφάκελο με το όνομα `Parameters`.

2. Κάντε λήψη του [Ανάπτυξη ReferenceArchitecture.ps1] [ solution-script] δέσμη ενεργειών του PowerShell στο φάκελο δεσμών ενεργειών.

3. Στο φάκελο παράμετροι, δημιουργήστε μια άλλη υποφάκελο με το όνομα των Windows.

4. Λήψη τα ακόλουθα αρχεία στο φάκελο παράμετροι/Windows:

    - [virtualNetwork.parameters.json][vnet-parameters-windows]

    - [networkSecurityGroup.parameters.json][nsg-parameters-windows]

    - [webTierParameters.json][webtier-parameters-windows]

    - [businessTierParameters.json][businesstier-parameters-windows]

    - [dataTierParameters.json][datatier-parameters-windows]

    - [managementTierParameters.json][managementtier-parameters-windows]

5. Επεξεργαστείτε το αρχείο **Ανάπτυξη ReferenceArchitecture.ps**1 στο φάκελο δεσμών ενεργειών και αλλάξτε την ακόλουθη γραμμή για να καθορίσετε την ομάδα πόρων που θα πρέπει να δημιουργήσει ή να χρησιμοποιούνται για τη διατήρηση η Εικονική και τους πόρους που έχουν δημιουργηθεί από τη δέσμη ενεργειών:

        ```powershell
        # PowerShell
        $resourceGroupName = "ra-aad-ntier-rg"
        ```

6. Επεξεργαστείτε τα ακόλουθα αρχεία στο φάκελο s **παράμετροι/παράθυρο**και ορίστε την `resourceGroup` τιμή του ορίσματος το `virtualNetworkSettings` σε κάθε ένα από αυτά τα αρχεία να είναι ίδια με την ενότητα που καθορίσατε στο αρχείο δέσμης ενεργειών **ReferenceArchitecture.ps1 ανάπτυξη** .

    - networkSecurityGroup.parameters.json

    - webTierParameters.json

    - businessTierParameters.json

    - dataTierParameters.json

    - managementTierParameters.json

7. Ανοίξτε ένα παράθυρο του Azure PowerShell, μετακίνηση στο φάκελο δέσμης ενεργειών και εκτελέστε την ακόλουθη εντολή:

        ```powershell
        .\Deploy-ReferenceArchitecture.ps1 <subscription id> <location> Windows ntier
        ```

    Αντικατάσταση **<subscription id>** με το αναγνωριστικό Azure συνδρομής.

    Για **<location>**, καθορίστε μια περιοχή Azure, όπως *eastus* ή *westus*.

8. Όταν ολοκληρωθεί η δέσμη ενεργειών, χρησιμοποιήστε την πύλη του Azure για να αποκτήσετε τη δημόσια διεύθυνση IP του τη μονάδα εξισορρόπησης φόρτου web επιπέδων (*ra-aad-ntier-web-λίβρες*):

    [! [18]][18]

9. Συνδεθείτε στο δοκιμής προγράμματος-πελάτη υπολογιστή σας (ή Εικονική) και επιβεβαιώστε ότι μπορείτε να αποκτήσετε πρόσβαση η σειρά web χρησιμοποιώντας τον Internet Explorer για να μεταβείτε στη δημόσια διεύθυνση IP της τη μονάδα εξισορρόπησης φόρτου web επιπέδων. Θα πρέπει να εμφανίζεται η προεπιλεγμένη σελίδα των υπηρεσιών IIS.

### <a name="simulate-configuration-of-a-public-web-site"></a>Προσομοίωση ρύθμιση παραμέτρων για μια δημόσια τοποθεσία web

>[AZURE.NOTE] Τα ακόλουθα βήματα προσομοιώνουν συσχετίζοντας επιπέδων το web με το www.contoso.com όνομα DNS, τροποποιώντας το αρχείο hosts του υπολογιστή-πελάτη δοκιμής. Επιπλέον, το ΣΠΣ επιπέδων web έχουν ρυθμιστεί με πιστοποιητικά αυτόματης υπογραφής και ασφαλές φιλοξενίας αρχή έκδοσης πιστοποιητικών. Πρόκειται για τον έλεγχο μόνο και **δεν πρέπει να χρησιμοποιήσετε αυτές τις τεχνικές σε ένα περιβάλλον παραγωγής**.

1. Στον υπολογιστή-πελάτη δοκιμής, επεξεργαστείτε το αρχείο **C:\Windows\System32\drivers\etc\hosts** , χρησιμοποιώντας το Σημειωματάριο και προσθέστε μια καταχώρηση που συσχετίζει το όνομα www.contoso.com με τη δημόσια διεύθυνση IP του τη μονάδα εξισορρόπησης φόρτου επιπέδων web:

        ```text
        # Copyright (c) 1993-2009 Microsoft Corp.
        #
        # This is a sample HOSTS file used by Microsoft TCP/IP for Windows.
        #
        # This file contains the mappings of IP addresses to host names. Each
        # entry should be kept on an individual line. The IP address should
        # be placed in the first column followed by the corresponding host name.
        # The IP address and the host name should be separated by at least one
        # space.
        #
        # Additionally, comments (such as these) may be inserted on individual
        # lines or following the machine name denoted by a '#' symbol.
        #
        # For example:
        #
        #      102.54.94.97     rhino.acme.com          # source server
        #       38.25.63.10     x.acme.com              # x client host
        
        # localhost name resolution is handled within DNS itself.
        #   127.0.0.1       localhost
        #   ::1             localhost
        
        52.165.38.64    www.contoso.com
        ```

2. Βεβαιωθείτε ότι μπορείτε να τώρα περιηγηθείτε στο www.contoso.com από τον υπολογιστή-πελάτη δοκιμής. Στην ίδια σελίδα των υπηρεσιών IIS προεπιλογή θα πρέπει να εμφανίζονται όπως και πριν.

3. Στον υπολογιστή-πελάτη δοκιμής, ανοίξτε μια γραμμή εντολών ως διαχειριστής και χρησιμοποιήστε το βοηθητικό πρόγραμμα makecert c
4. Δημιουργία μιας πιστοποιητικών αρχή έκδοσης πιστοποιητικών ρίζας πλαστές:

        ```
        makecert -sky exchange -pe -a sha256 -n "CN=MyFakeRootCertificateAuthority" -r -sv MyFakeRootCertificateAuthority.pvk MyFakeRootCertificateAuthority.cer -len 2048
        ```

    Βεβαιωθείτε ότι δημιουργούνται τα ακόλουθα αρχεία:

    - MyFakeRootCertificateAuthority.cer

    - MyFakeRootCertificateAuthority.pvk

4. Εκτελέστε την παρακάτω εντολή για να εγκαταστήσετε την αρχή έκδοσης πιστοποιητικών ρίζας δοκιμής:

        ```
        certutil.exe -addstore Root MyFakeRootCertificateAuthority.cer
        ```

5. Χρησιμοποιήστε την αρχή έκδοσης πιστοποιητικών δοκιμή για να δημιουργήσετε ένα πιστοποιητικό για www.contoso.com:

        ```
        makecert -sk pkey -iv MyFakeRootCertificateAuthority.pvk -a sha256 -n "CN=www.contoso.com" -ic MyFakeRootCertificateAuthority.cer -sr localmachine -ss my -sky exchange -pe
        ```

6. Εκτελέστε την εντολή **mmc** και προσθέστε το συμπληρωματικό πρόγραμμα πιστοποιητικά για το λογαριασμό υπολογιστή για τον τοπικό υπολογιστή.

7. Σε το */Certificates (τοπικό υπολογιστή) / προσωπικό/πιστοποιητικό/* αποθήκευση, εξαγωγή του πιστοποιητικού www.contoso.com με το ιδιωτικό κλειδί σε ένα αρχείο με το όνομα www.contoso.com.pfx:

    [! [20]][20]

8. Επιστρέψτε στην πύλη του Azure και να συνδεθείτε με τη σειρά διαχείρισης Εικονική (*ra-aad-ntier-διαχείρισης-vm1*). Το προεπιλεγμένο όνομα χρήστη είναι *testuser* με κωδικό πρόσβασης *AweS0me@PW*:

    [! [21]][21]
    
9. Από τη σειρά διαχείρισης Εικονική, συνδεθείτε σε καθένα από τη σειρά web ΣΠΣ με τη σειρά με το όνομα χρήστη *testuser* και τον κωδικό πρόσβασης *AweS0me@PW*, και να εκτελέσετε τις ακόλουθες εργασίες. Σημειώστε ότι το ΣΠΣ έχουν τα ιδιωτικά διευθύνσεις IP 10.0.1.4, 10.0.1.5 και 10.0.1.6:

    >[AZURE.NOTE] Η σειρά web ΣΠΣ αρκεί ιδιωτικών διευθύνσεων IP. Μπορείτε να συνδεθείτε μόνο σε αυτά χρησιμοποιώντας το επίπεδο διαχείρισης Εικονική.

    1. Αντιγράψτε τα αρχεία *www.contoso.com.pfx* και *MyFakeRootCertificateAuthority.cer* από τον υπολογιστή-πελάτη δοκιμής.
    
    2. Ανοίξτε μια γραμμή εντολών ως διαχειριστής, μετακίνηση στο φάκελο κρατώντας πατημένο τα αρχεία που αντιγράψατε και εκτελέστε τις ακόλουθες εντολές:
    
        ```
        certutil.exe -privatekey -importPFX my www.contoso.com.pfx NoExport

        certutil.exe -addstore Root MyFakeRootCertificateAuthority.cer
        ```

    3. Εκτελέστε το `mmc` εντολή, να προσθέσετε το συμπληρωματικό πρόγραμμα πιστοποιητικά για το λογαριασμό υπολογιστή για τον τοπικό υπολογιστή και βεβαιωθείτε ότι έχουν εγκατασταθεί τα ακόλουθα πιστοποιητικά:

        - Www.contoso.com \Personal\Certificates\ \Certificates (τοπικό υπολογιστή)

        - Authorities\Certificates\MyFakeRootCertificateAuthority έκδοσης πιστοποιητικών ρίζας \Trusted \Certificates (τοπικό υπολογιστή)

    4. Ξεκινήστε την Κονσόλα διαχείρισης υπηρεσιών Internet Information Services (IIS) και μεταβείτε στην *τοποθεσία Web τοποθεσίες* στον υπολογιστή.

    5. Στο παράθυρο " *Ενέργειες* ", κάντε κλικ στην επιλογή *συνδέσεις*και προσθέστε μια σύνδεση https χρησιμοποιώντας το πιστοποιητικό SSL www.contoso.com:

        [! [22]][22]

10. Επιστρέψτε στο δοκιμαστικό πρόγραμμα-πελάτη υπολογιστή και βεβαιωθείτε ότι μπορείτε τώρα να περιηγηθείτε στο https://www.contoso.com.

### <a name="create-an-azure-active-directory-tenant"></a>Δημιουργήστε ένα μισθωτή του Azure Active Directory

1. Με την πύλη Azure, δημιουργήστε ένα μισθωτή του Azure Active Directory όπως *myaadname*. onmicrosoft.com, όπου *myaadname* είναι το όνομα του καταλόγου επιλεγμένο από εσάς.

2. Προσθήκη χρήστη με το όνομα *διαχειριστή* με το ρόλο GlobalAdmin στον κατάλογο. Σημειώστε τον κωδικό πρόσβασης που δημιουργήθηκε πρόσφατα.

3. Χρήση του Internet Explorer, μεταβείτε στο https://account.activedirectory.windowsazure.com/ και συνδεθείτε ως admin@ *myaadname*. onmicrosoft.com. Αλλαγή κωδικού πρόσβασης όταν σας ζητηθεί.

### <a name="create-and-deploy-a-test-web-application"></a>Δημιουργία και ανάπτυξη μιας εφαρμογής web δοκιμής

1. Χρήση του Visual Studio στον υπολογιστή ανάπτυξης, δημιουργία μιας εφαρμογής ASP.NET Web με το όνομα ContosoWebApp1 (Χρησιμοποιήστε το .NET Framework 4.5.2):

    [! [23]][23]

2. Επιλέξτε το πρότυπο *MVC* , αλλάξτε τον έλεγχο ταυτότητας σε *εργασία και στο σχολείο τους λογαριασμούς*και καθορίστε το όνομα του μισθωτή σας AAD. Μην δημιουργήσετε μιας εφαρμογής υπηρεσίας στο cloud.

    [! [24]][24]

3. Δημιουργία και εκτέλεση της εφαρμογής για να ελέγξετε τον έλεγχο ταυτότητας. Στη σελίδα είσοδος, πληκτρολογήστε το όνομα του λογαριασμού admin@ *myaadname*. onmicrosoft.com, εισαγάγετε τον κωδικό πρόσβασης και, στη συνέχεια, κάντε κλικ στην επιλογή *Είσοδος*:

    [! [25]][25]

4. Επιβεβαιώστε ότι AAD ζητά δικαίωμα η είσοδός σας και διαβάστε το προφίλ σας και, στη συνέχεια, ξεκινά η εκτέλεση της εφαρμογής web με την ταυτότητα του διαχειριστή.

5. Κλείστε τον Internet Explorer και να επιστρέψετε στο Visual Studio.

6. Ανοίξτε το αρχείο web.config, και το `<appSettings>` ενότητας, αλλάξτε την τιμή του κλειδιού *ida: PostLogoutRedirectUri* *https://www.contoso.com:443 /*. Αποθηκεύστε το αρχείο.

7. Στο παράθυρο " *Εξερεύνηση λύσεων* ", κάντε δεξί κλικ στο έργο ContosoWebApp1, κάντε κλικ στην επιλογή *Δημοσίευση*.

8. Στο παράθυρο " *Δημοσίευση Web* ", κάντε κλικ στην επιλογή *Προσαρμογή*. Δημιουργήστε ένα προσαρμοσμένο προφίλ με το όνομα *ContosoWebApp1*.

9. Στη σελίδα *σύνδεσης* , ορίστε τη *μέθοδο δημοσίευση* στο *Σύστημα αρχείων* και καθορίστε ένα φάκελο που ονομάζεται *ContosoWebApp*, που βρίσκεται σε μια εύχρηστη θέση στον υπολογιστή σας στην ανάπτυξη.

10. Στη σελίδα *Ρυθμίσεις* , ορίστε τη *ρύθμιση των παραμέτρων* *έκδοση*.

11. Στη σελίδα *προεπισκόπησης* , κάντε κλικ στο κουμπί *Δημοσίευση*.

12. Σύνδεση σε κάθε διακομιστή web με τη σειρά (χρησιμοποιώντας το επίπεδο διαχείρισης Εικονική) και εκτελέστε τις ακόλουθες εργασίες:

    1. Αντιγράψτε το φάκελο *ContosoWebApp* και τα περιεχόμενά της από τον υπολογιστή ανάπτυξης στο φάκελο *C:\inetpub* .

    2. Χρησιμοποιώντας την Κονσόλα διαχείρισης υπηρεσιών Internet Information Services (IIS), μεταβείτε στην *τοποθεσία Web τοποθεσίες* στον υπολογιστή.

    3. Στο παράθυρο " *Ενέργειες* ", κάντε κλικ στην επιλογή *Ρυθμίσεις βάση*και αλλάξτε τη φυσική διαδρομή της τοποθεσίας web σε *%SystemDrive%\inetpub\ContosoWebApp*:

        [! [26]][26]

### <a name="publish-the-test-web-application-through-aad"></a>Δημοσίευση στην εφαρμογή web δοκιμής μέσω AAD

1. Συνδεθείτε στην πύλη του Azure και μεταβείτε στον κατάλογο AAD.

2. Στην καρτέλα *εφαρμογές* , κάντε κλικ στην εφαρμογή ContosoWebApp1.

3. Βεβαιωθείτε ότι η εφαρμογή σας έχει προστεθεί με επιτυχία στον κατάλογο και, στη συνέχεια, κάντε κλικ στην καρτέλα *Ρύθμιση ΠΑΡΑΜΈΤΡΩΝ* .

4. Αλλάξτε τη *Διεύθυνση URL ΕΙΣΌΔΟΥ ON* σε https://www.contoso.com:443 και ορίστε τη *Διεύθυνση URL ΑΠΆΝΤΗΣΗ* σε https://www.contoso.com:443 (την ίδια διεύθυνση URL).

5. Αποθηκεύστε τη ρύθμιση παραμέτρων.

6. Στον υπολογιστή-πελάτη δοκιμής, μεταβείτε σε https://www.contoso.com. Βεβαιωθείτε ότι AAD σάς ζητά τα διαπιστευτήριά σας και, στη συνέχεια, συνδεθείτε.

>[AZURE.NOTE] Αυτό είναι το τελικό σημείο για το πρώτο σενάριο: Ενεργοποίηση της πρόσβασης στην εφαρμογή web ν σειρών εκτελείται στο cloud σε εξωτερικούς χρήστες, με AAD παρέχει έλεγχο ταυτότητας τον κωδικό πρόσβασης.

### <a name="create-a-simulated-on-premises-environment-with-active-directory"></a>Δημιουργία περιβάλλοντος προσομοιωμένη εσωτερικής εγκατάστασης με την υπηρεσία καταλόγου Active Directory

Το περιβάλλον εσωτερικής εγκατάστασης περιέχει δύο ελεγκτές τομέα για το `contoso.com` τομέα και των δύο διακομιστές για τη φιλοξενία του Azure AD Connect συγχρονισμός υπηρεσίας. Οι διακομιστές για τη φιλοξενία Azure AD Connect δεν τομέα-συνδέονται.

1. Στην Εξερεύνηση αρχείων, επιστρέψτε στο φάκελο δέσμης ενεργειών που περιέχει τη δέσμη ενεργειών που χρησιμοποιούνται για τη δημιουργία της εφαρμογής web N επιπέδων.

2. Στο φάκελο παράμετροι, προσθέστε έναν άλλο φάκελο sub με το όνομα `Onpremise`.

3. Κάντε λήψη των αρχείων παρακάτω παραμέτρους/σύνδεση εντός επιχείρησης φάκελο:

    - [Προσθήκη-προσθέτει-τομέα-controller.parameters.json][add-adds-domain-controller-parameters]

    - [Δημιουργία-προσθέτει-δάσος-extension.parameters.json][create-adds-forest-extension-parameters]

    - [virtualMachines adc.parameters.json][virtualMachines-adc-parameters]

    - [virtualMachines-adc-joindomain.parameters.json][virtualMachines-adc-joindomain-parameters]

    - [virtualMachines adds.parameters.json][virtualMachines-adds-parameters]

    - [virtualNetwork.parameters.json][virtualNetwork-parameters]

    - [virtualNetwork προσθέτει dns.parameters.json][virtualNetwork-adds-dns-parameters]

5. Επεξεργαστείτε το αρχείο ανάπτυξη ReferenceArchitecture.ps1 στο φάκελο δεσμών ενεργειών και αλλάξτε την ακόλουθη γραμμή για να καθορίσετε την ομάδα πόρων που θα πρέπει να δημιουργήσει ή να χρησιμοποιούνται για τη διατήρηση η Εικονική και τους πόρους που έχουν δημιουργηθεί από τη δέσμη ενεργειών:

        ```powershell
        # PowerShell
        $resourceGroupName = "ra-aad-onpremise-rg"
        ```

6. Επεξεργαστείτε τα ακόλουθα αρχεία στο φάκελο σύνδεση παράμετροι/εντός της επιχείρησης και ορίστε την `resourceGroup` τιμή του ορίσματος το `virtualNetworkSettings` σε κάθε ένα από αυτά τα αρχεία να είναι ίδια με την ενότητα που καθορίσατε στο αρχείο δέσμης ενεργειών ReferenceArchitecture.ps1 ανάπτυξη.

    - virtualMachines adds.parameters.json

    - virtualMachines adc.parameters.json

    - virtualNetwork.parameters.json

    - virtualNetwork προσθέτει dns.parameters.json

7. Ανοίξτε ένα παράθυρο του Azure PowerShell, μετακίνηση στο φάκελο δέσμης ενεργειών και εκτελέστε την ακόλουθη εντολή:

        ```powershell
        .\Deploy-ReferenceArchitecture.ps1 <subscription id> <location> Windows onpremise
        ```

    Αντικατάσταση `<subscription id>` με το αναγνωριστικό Azure συνδρομής.

    Για `<location>`, καθορίστε μια περιοχή Azure, όπως `eastus` ή `westus`.

### <a name="install-and-configure-the-azure-ad-connect-sync-service"></a>Εγκατάσταση και ρύθμιση παραμέτρων της υπηρεσίας συγχρονισμού Azure AD Connect

Η ρύθμιση παραμέτρων απεικονίζονται σε αυτά τα βήματα αποτελείται από δύο παρουσίες της υπηρεσίας συγχρονισμού Azure AD Connect. Το πρώτο είναι ενεργός κατά το δεύτερο έχει ρυθμιστεί σε λειτουργία ενδιάμεσου σταδίου για την παροχή ταχεία ανακατεύθυνσης και υψηλή διαθεσιμότητα, εάν ο πρώτος διακομιστής αποτυγχάνει.

1. Χρησιμοποιώντας την πύλη του Azure, μεταβείτε στην ομάδα πόρων κρατώντας πατημένο το ΣΠΣ για τις υπηρεσίες συγχρονισμού Azure AD Connect (*ra-aad-σύνδεση εντός της επιχείρησης-rg* από προεπιλογή) και σύνδεση με το *ra-aad-σύνδεση εντός της επιχείρησης-adc-vm1* Εικονική. Συνδεθείτε ως *testuser* με κωδικό πρόσβασης *AweS0me@PW*.

2. Κάντε λήψη του Azure AD Connect από [εδώ][aad-connect-download].

3. Εκτελέστε το πρόγραμμα εγκατάστασης του Azure AD Connect και να εκτελέσετε μια εγκατάσταση χρησιμοποιώντας την επιλογή *Προσαρμογή* .

    >[AZURE.NOTE] Δεν μπορείτε να χρησιμοποιήσετε την επιλογή *Γρήγορες ρυθμίσεις* , επειδή η Εικονική που φιλοξενεί την υπηρεσία συγχρονισμού Azure AD Connect δεν είναι τομέα.

4. Στη σελίδα *εγκατάσταση απαιτούμενων στοιχείων* , αφήστε τις ρυθμίσεις παραμέτρων προαιρετικό κενό για να αποδεχτείτε τις προεπιλεγμένες επιλογές.

5. Στη σελίδα *εισόδου του χρήστη* , επιλέξτε *Συγχρονισμό κωδικού πρόσβασης*.

6. Στη σελίδα *σύνδεση με το Azure AD* , εισαγάγετε admin@ *myaadname*. onmicrosoft.com, όπου *myaadname* είναι το όνομα του μισθωτή σας AAD. Πληκτρολογήστε τον κωδικό πρόσβασης για το λογαριασμό διαχειριστή.

7. Στη σελίδα *σύνδεση σας σε καταλόγους* , καθορίστε contoso.com για το δάσος (πληκτρολογήστε την τιμή στο επειδή δεν εμφανίζεται στην αναπτυσσόμενη λίστα), πληκτρολογήστε CONTOSO\testuser για το όνομα χρήστη, καθορίστε AweS0me@PW για τον κωδικό πρόσβασης, και, στη συνέχεια, κάντε κλικ στην επιλογή *Προσθήκη καταλόγου*.

8. Στη σελίδα *Azure AD εισόδου ρύθμισης παραμέτρων* , αποδεχτείτε την προεπιλεγμένη τιμή για το κύριο όνομα χρήστη. Επιλέξτε *Continue χωρίς οποιαδήποτε επαληθευτεί τομείς*.

    >[AZURE.NOTE] Ο κατάλογος contoso.com παρατίθενται ως *Δεν έχει επαληθευτεί*. Για να επαληθεύσετε ένα όνομα τομέα, πρέπει να δημιουργήσετε μια εγγραφή TXT για το μητρώο καταχώρησης ονομάτων τομέα. Σε αυτό το παράδειγμα, ο τομέας εσωτερικής εγκατάστασης δεν έχει καταχωρηθεί εξωτερικά. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Προσθήκη προσαρμοσμένου ονόματος τομέα για να Azure Active Directory][aad-custom-directory].

9. Στη σελίδα *τομέα και OU φιλτράρισμα* , επιλέξτε *Συγχρονισμός όλων των τομέων και OU* (προεπιλογή).

10. Στη σελίδα *προσδιορίζει μοναδικά τους χρήστες σας* , αποδεχτείτε τις προεπιλεγμένες τιμές.

11. Στη σελίδα *φίλτρα τους χρήστες και τις συσκευές* , επιλέξτε *Συγχρονισμός όλων των χρηστών και συσκευές* (προεπιλογή).

12. Στη σελίδα *προαιρετικές δυνατότητες* , επιλέξτε *αντιγραφής τον κωδικό πρόσβασης*.

13. Στη σελίδα *έτοιμο για ρύθμιση παραμέτρων* , επιλέξτε *ξεκινήσετε τη διαδικασία συγχρονισμού μετά την ολοκλήρωση της ρύθμισης παραμέτρων*, αλλά αφήστε την *Ενεργοποίηση της λειτουργίας ενδιάμεσου σταδίου* καταργηθεί η επιλογή.

14. Βεβαιωθείτε ότι ολοκληρώνει τη διαδικασία ρύθμισης παραμέτρων χωρίς σφάλματα και στη συνέχεια, κλείστε το πρόγραμμα εγκατάστασης.

15. Από την πύλη Azure, συνδεθείτε με το *ra-aad-σύνδεση εντός της επιχείρησης-adc-vm2* Εικονική. Συνδεθείτε ως *testuser* με κωδικό πρόσβασης *AweS0me@PW*.

16. Κάντε λήψη Azure AD Connect και, στη συνέχεια, εκτελέστε το πρόγραμμα εγκατάστασης.

17. Ακολουθήστε τα βήματα του οδηγού, και να απαντούν όπως περιγράφεται στα βήματα 3 έως 12.

18. Στη σελίδα *έτοιμο για ρύθμιση παραμέτρων* , επιλέξτε *Ξεκινήστε τη διαδικασία συγχρονισμού μετά την ολοκλήρωση της ρύθμισης παραμέτρων*και **επίσης να επιλέξετε** *Ενεργοποίηση της λειτουργίας ενδιάμεσου σταδίου*. Αυτό θα κάνει την υπηρεσία Azure AD Connect συγχρονισμού για να ανακτήσετε λεπτομέρειες σχετικά με τους λογαριασμούς και τα αντικείμενα από τον τομέα contoso.com και να τις αποθηκεύει στη βάση δεδομένων του, αλλά δεν μπορεί να μεταβιβάσει αυτές τις λεπτομέρειες για το μισθωτή AAD.

14. Βεβαιωθείτε ότι ολοκληρώνει τη διαδικασία ρύθμισης παραμέτρων χωρίς σφάλματα και στη συνέχεια, κλείστε το πρόγραμμα εγκατάστασης.

### <a name="test-the-aad-configuration"></a>Δοκιμή της ρύθμισης παραμέτρων AAD

1. Με την πύλη Azure, μεταβείτε στον κατάλογο AAD, ανοίξτε το blade Azure Active Directory, κάντε κλικ στην επιλογή *χρήστες και ομάδες*και, στη συνέχεια, κάντε κλικ στην επιλογή *Όλοι οι χρήστες* για να εμφανίσετε τη λίστα των χρηστών και ομάδων που συγχρονίζονται με τον κατάλογο. Θα πρέπει να δείτε τους χρήστες για τους ακόλουθους λογαριασμούς:

    - Διαχείριση (admin@ *myaadname*. onmicrosoft.com)

    - Ο λογαριασμός υπηρεσίας συγχρονισμού καταλόγου εσωτερικής εγκατάστασης (Sync_ADC1_*nnnnnnnnnnnn*@*myaadname*. onmicrosoft.com)

    - Ο λογαριασμός υπηρεσίας συγχρονισμού καταλόγου εσωτερικής εγκατάστασης (Sync_ADC2_*nnnnnnnnnnnn*@*myaadname*. onmicrosoft.com)

2. Στην πύλη του Azure, μεταβείτε στην ομάδα πόρων κρατώντας πατημένο το ΣΠΣ για τους ελεγκτές τομέα AD DS (*ra-aad-σύνδεση εντός της επιχείρησης-rg* από προεπιλογή) και σύνδεση με το *ra-aad-σύνδεση εντός της επιχείρησης-ad-vm1* Εικονική. Συνδεθείτε ως *testuser* με κωδικό πρόσβασης *AweS0me@PW*.

3. Χρήση της κονσόλας *χρήστες του Active Directory και υπολογιστές* , Προσθήκη νέου χρήστη τομέα με το όνομα Diane Tibbot, με όνομα σύνδεσης dianet@contoso.com. Καθορίστε έναν κωδικό πρόσβασης της επιλογής σας. Ορίστε το χρήστη μέλος της τοπικής ομάδας διαχειριστών (αυτό είναι μόνο, ώστε να μπορείτε να συνδεθείτε τοπικά ως αυτόν το χρήστη αργότερα - ελεγκτές τομέα είναι η μόνη μηχανές στον τομέα).

4. Μετάβαση στο *ra-aad-σύνδεση εντός της επιχείρησης-adc-vm1* Εικονική, ανοίξτε ένα παράθυρο του PowerShell και εκτελέστε τις ακόλουθες εντολές:

        ```[powershell]
        Import-Module ADSync
        Start-ADSyncSyncCycle -PolicyType Delta
        ```

    Βεβαιωθείτε ότι η εντολή επιστρέφει *την επιτυχία*.

    >[AZURE.NOTE] Αυτό το βήμα είναι απαραίτητο, επειδή από προεπιλογή η διαδικασία συγχρονισμού έχει προγραμματιστεί να εκτελεστεί σε χρονικά διαστήματα 30 λεπτών. Αυτές οι εντολές επιβάλετε συγχρονισμός αμέσως.

5. Επιστρέψτε στην πύλη του Azure, μεταβείτε σε AAD κατάλογό σας, ανοίξτε το blade Azure Active Directory, κάντε κλικ στην επιλογή *χρήστες και ομάδες*και, στη συνέχεια, κάντε κλικ στην επιλογή *Όλοι οι χρήστες*. Τώρα θα πρέπει να βλέπετε Diane Tibbot (dianet@ *myaadname*. onmicrosoft.com) εμφανίζονται στη λίστα των χρηστών.

6. Στο το blade Azure Active Directory, κάντε κλικ στην επιλογή *Εταιρικές εφαρμογές*και, στη συνέχεια, κάντε κλικ στην επιλογή *όλες τις εφαρμογές*. Κάντε κλικ στην εφαρμογή *ContosoWebApp1* και, στη συνέχεια, κάντε κλικ στην επιλογή *χρήστες και ομάδες*. Στη γραμμή εργαλείων, κάντε κλικ στην επιλογή *Προσθήκη*. Κάντε κλικ στην επιλογή *χρήστες και ομάδες*και επιλέξτε *Diane Tibbot*. Κάντε κλικ στο κουμπί *Αντιστοίχιση*.

7. Χρήση του Internet Explorer, μεταβείτε https://account.activedirectory.windowsazure.com την τοποθεσία. Συνδεθείτε ως dianet@ *myaadname*. onmicrosoft.com με τον κωδικό πρόσβασης που καθορίσατε προηγουμένως.

    >[AZURE.NOTE] Δεν κάντε κλικ στο εικονίδιο ContosoWebApp στη λίστα των εφαρμογών. AAD προσπαθεί να βρείτε την εφαρμογή web στη διεύθυνση DNS που παρατίθενται στο κοινό για www.contoso.com, που είναι διαφορετικό από τη διεύθυνση του σας εξισορρόπηση φόρτου web επιπέδων.

8. Κάντε κλικ στην καρτέλα *προφίλ* . Πρέπει να εμφανίζεται τις λεπτομέρειες του χρήστη (Εάν έχετε καθορίσει οποιαδήποτε κατά τη δημιουργία).

    >[AZURE.NOTE] Εάν κάνετε κλικ στο κουμπί *Αλλαγή κωδικού πρόσβασης*, δεν επιτρέπεται για να εκτελέσετε αυτήν την εργασία, όπως αυτή η λειτουργία πρέπει να έχει ενεργοποιηθεί από κάποιον διαχειριστή πρώτα. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [Γρήγορα αποτελέσματα με τη Διαχείριση κωδικών πρόσβασης][aad-password-management].

### <a name="enable-on-premises-users-to-run-the-application-by-using-authentication-through-aad"></a>Να επιτρέπεται στους χρήστες εσωτερικής εγκατάστασης για να εκτελέσετε την εφαρμογή με χρήση του ελέγχου ταυτότητας μέσω AAD

1. Επιστροφή στον ελεγκτή τομέα *ra-aad-σύνδεση εντός της επιχείρησης-ad-vm1* Εικονική.

2. Ανοίξτε την κονσόλα *Διαχείρισης DNS* και προσθέστε μια νέα εγγραφή κεντρικού υπολογιστή για το www.contoso.com. Καθορίστε τη δημόσια διεύθυνση IP του τη μονάδα εξισορρόπησης φόρτου web επιπέδων.

3. Αντιγράψτε το αρχείο *MyFakeRootCertificateAuthority.cer* από τον υπολογιστή-πελάτη δοκιμής (που δημιουργήσατε αρχεία σε αυτό κατά τη διαδικασία [ρύθμισης παραμέτρων προσομοίωση μιας δημόσιας τοποθεσίας web](#simulate-configuration-of-a-public-web-site)
    
4. Ανοίξτε μια γραμμή εντολών ως διαχειριστής, μετακίνηση στο φάκελο κρατώντας πατημένο το αρχείο που μόλις αντιγράψατε και εκτελέστε την ακόλουθη εντολή:

        ```
        certutil.exe -addstore Root MyFakeRootCertificateAuthority.cer
        ```

5. Χρήση του Internet Explorer, μεταβείτε https://www.contoso.com. Βεβαιωθείτε ότι εμφανίζεται το AAD σελίδα εισόδου για την εφαρμογή web ContosoWebApp1.

6. Συνδεθείτε ως dianet@ *myaadname*. onmicrosoft.com. Η εφαρμογή θα πρέπει να εκτελέσετε και η είσοδός σας σωστά.

## <a name="next-steps"></a>Επόμενα βήματα

- Μάθετε τις βέλτιστες πρακτικές για την [επέκταση του τομέα σας ΠΡΟΣΘΈΤΕΙ εσωτερικής εγκατάστασης στο Azure][adds-extend-domain]

- Μάθετε τις βέλτιστες πρακτικές για [τη δημιουργία μιας δομών πόρων ΠΡΟΣΘΈΤΕΙ] [ adds-resource-forest] στο Azure

<!-- links -->
[resource-manager-overview]: ../azure-resource-manager/resource-group-overview.md
[script]: #sample-solution-script
[implementing-a-multi-tier-architecture-on-Azure]: ./guidance-compute-n-tier-vm.md
[active-directory-domain-services]: https://technet.microsoft.com/library/dd448614.aspx
[active-directory-federation-services]: https://technet.microsoft.com/windowsserver/dd448613.aspx
[azure-active-directory]: ../active-directory-domain-services/active-directory-ds-overview.md
[azure-ad-connect]: ../active-directory/active-directory-aadconnect.md
[ad-azure-guidelines]: https://msdn.microsoft.com/library/azure/jj156090.aspx
[aad-explained]: https://youtu.be/tj_0d4tR6aM
[aad-editions]: ../active-directory/active-directory-editions.md
[guidance-adds]: ./guidance-iaas-ra-secure-vnet-ad.md
[sla-aad]: https://azure.microsoft.com/support/legal/sla/active-directory/v1_0/
[azure-multifactor-authentication]: ../multi-factor-authentication/multi-factor-authentication.md
[aad-conditional-access]: ../active-directory//active-directory-conditional-access.md
[aad-dynamic-membership-rules]: ../active-directory/active-directory-accessmanagement-groups-with-advanced-rules.md
[aad-dynamic-memberships]: https://youtu.be/Tdiz2JqCl9Q
[aad-user-sign-in]: ../active-directory/active-directory-aadconnect-user-signin.md
[aad-sync-requirements]: ../active-directory/active-directory-hybrid-identity-design-considerations-directory-sync-requirements.md
[aad-topologies]: ../active-directory/active-directory-aadconnect-topologies.md
[aad-filtering]: ../active-directory/active-directory-aadconnectsync-configure-filtering.md
[aad-scalability]: https://blogs.technet.microsoft.com/enterprisemobility/2014/09/02/azure-ad-under-the-hood-of-our-geo-redundant-highly-available-distributed-cloud-directory/
[aad-connect-sync-default-rules]: ../active-directory/active-directory-aadconnectsync-understanding-default-configuration.md
[aad-identity-protection]: ../active-directory/active-directory-identityprotection.md
[aad-password-management]: ../active-directory/active-directory-passwords-customize.md
[aad-application-proxy]: ../active-directory/active-directory-application-proxy-enable.md
[aad-connect-sync-operational-tasks]: ../active-directory/active-directory-aadconnectsync-operations.md#staging-mode
[aad-custom-domain]: ../active-directory/active-directory-add-domain.md
[aad-powershell]: https://msdn.microsoft.com/library/azure/mt757189.aspx
[aad-sync-disaster-recovery]: ../active-directory/active-directory-aadconnectsync-operations.md#disaster-recovery
[aad-sync-best-practices]: ../active-directory/active-directory-aadconnectsync-best-practices-changing-default-configuration.md
[aad-adfs]: ../active-directory/active-directory-aadconnect-get-started-custom.md#configuring-federation-with-ad-fs
[aad-health]: ../active-directory/active-directory-aadconnect-health-sync.md
[aad-health-adds]: ../active-directory/active-directory-aadconnect-health-adds.md
[aad-health-adfs]: ../active-directory/active-directory-aadconnect-health-adfs.md
[aad-agent-installation]: ../active-directory/active-directory-aadconnect-health-agent-install.md
[aad-reporting-guide]: ../active-directory/active-directory-reporting-guide.md
[azure-cli]: ../virtual-machines-command-line-tools.md
[azure-powershell-download]: ../powershell-install-configure.md
[solution-script]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/Deploy-ReferenceArchitecture.ps1
[vnet-parameters-windows]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/windows/virtualNetwork.parameters.json
[nsg-parameters-windows]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/windows/networkSecurityGroups.parameters.json
[webtier-parameters-windows]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/windows/webTier.parameters.json
[businesstier-parameters-windows]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/windows/businessTier.parameters.json
[datatier-parameters-windows]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/windows/dataTier.parameters.json
[managementtier-parameters-windows]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/windows/managementTier.parameters.json
[makecert]: https://msdn.microsoft.com/library/windows/desktop/aa386968(v=vs.85).aspx
[add-adds-domain-controller-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/onpremise/add-adds-domain-controller.parameters.json
[create-adds-forest-extension-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/onpremise/create-adds-forest-extension.parameters.json
[virtualMachines-adds-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/onpremise/virtualMachines-adds.parameters.json
[virtualNetwork-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/onpremise/virtualNetwork.parameters.json
[virtualNetwork-adds-dns-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/onpremise/virtualNetwork-adds-dns.parameters.json
[virtualMachines-adc-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/onpremise/virtualMachines-adc.parameters.json
[virtualMachines-adc-joindomain-parameters]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/guidance-identity-aad/parameters/onpremise/virtualMachines-adc-joindomain.parameters.json
[aad-connect-download]: http://www.microsoft.com/download/details.aspx?id=47594
[aad-custom-directory]: ../active-directory/active-directory-add-domain.md
[aad-password-management]: ../active-directory/active-directory-passwords-getting-started.md#enable-users-to-reset-their-azure-ad-passwords
[adds-extend-domain]: ./guidance-identity-adds-extend-domain.md
[adds-resource-forest]: ./guidance-identity-adds-resource-forest.md
[0]: ./media/guidance-identity-aad/figure1.png "Αρχιτεκτονική ταυτότητας cloud χρησιμοποιώντας Azure Active Directory"
[1]: ./media/guidance-identity-aad/figure2.png "Μία δάσος, ένας AAD καταλόγου τοπολογίας"
[2]: ./media/guidance-identity-aad/figure3.png "Πολλαπλές δομές, μία τοπολογία καταλόγου AAD"
[4]: ./media/guidance-identity-aad/figure5.png "Ενδιάμεσου τοπολογίας διακομιστών"
[5]: ./media/guidance-identity-aad/figure6.png "Πολλαπλή τοπολογία σε καταλόγους AAD"
[6]: ./media/guidance-identity-aad/figure7.png "Επιλογή μιας προσαρμοσμένης εγκατάστασης του Azure σύνδεση συγχρονισμός AD με μια συγκεκριμένη παρουσία του SQL Server"
[7]: ./media/guidance-identity-aad/figure8.png "Καθορισμός της μεθόδου SSO για είσοδος χρήστη"
[8]: ./media/guidance-identity-aad/figure9.png "Καθορισμός τομέα και OU επιλογές φιλτραρίσματος"
[9]: ./media/guidance-identity-aad/figure10.png "Ενεργοποίηση κωδικού πρόσβασης write-back"
[10]: ./media/guidance-identity-aad/figure11.png "Το Azure AD blade διαχείρισης στην πύλη"
[11]: ./media/guidance-identity-aad/figure12.png "Κονσόλα Azure AD Connect"
[12]: ./media/guidance-identity-aad/figure13.png "Στην καρτέλα λειτουργίες στη Διαχείριση υπηρεσίας συγχρονισμού"
[13]: ./media/guidance-identity-aad/figure14.png "Στην καρτέλα συνδέσεις στη Διαχείριση υπηρεσίας συγχρονισμού"
[14]: ./media/guidance-identity-aad/figure15.png "Πρόγραμμα επεξεργασίας κανόνων συγχρονισμού"
[15]: ./media/guidance-identity-aad/figure16.png "Το Azure Active Directory σύνδεση εύρυθμης λειτουργίας blade στην πύλη του Azure που εμφανίζει την κατάσταση συγχρονισμού"
[16]: ./media/guidance-identity-aad/figure17.png "Το Azure Active Directory σύνδεση εύρυθμης λειτουργίας blade στην πύλη του Azure που εμφανίζει την εύρυθμη λειτουργία AD DS"
[17]: ./media/guidance-identity-aad/figure18.png "Ασφάλεια αναφορών που είναι διαθέσιμες στην πύλη του Azure"
[18]: ./media/guidance-identity-aad/figure19.png "Πύλη του Azure επισήμανση στη δημόσια διεύθυνση IP της τη μονάδα εξισορρόπησης φόρτου web επιπέδων"
[19]: ./media/guidance-identity-aad/figure20.png "Χρήση του Internet Explorer για να μεταβείτε στη δημόσια διεύθυνση IP της τη μονάδα εξισορρόπησης φόρτου web επιπέδων"
[20]: ./media/guidance-identity-aad/figure21.png "Τα πιστοποιητικά συμπληρωματικού προγράμματος που εμφανίζει το πιστοποιητικό www.contoso.com"
[21]: ./media/guidance-identity-aad/figure22.png "Σύνδεση στο επίπεδο διαχείρισης Εικονική"
[22]: ./media/guidance-identity-aad/figure23.png "Δημιουργία τη σύνδεση HTTPS για την προεπιλεγμένη τοποθεσία web"
[23]: ./media/guidance-identity-aad/figure24.png "Δημιουργία της εφαρμογής web ContosoWebApp1"
[24]: ./media/guidance-identity-aad/figure25.png "Ρύθμιση των ιδιοτήτων ελέγχου ταυτότητας της εφαρμογής web ContosoWebApp1"
[25]: ./media/guidance-identity-aad/figure26.png "Είσοδος στο Azure AAD από την εφαρμογή web ContosoWebApp1"
[26]: ./media/guidance-identity-aad/figure27.png "Αλλαγή του φακέλου για την προεπιλεγμένη τοποθεσία web"