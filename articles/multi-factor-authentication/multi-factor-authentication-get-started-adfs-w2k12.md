<properties
    pageTitle="MFA διακομιστή με τον Windows Server 2012 R2 AD FS | Microsoft Azure"
    description="Σε αυτό το άρθρο περιγράφει πώς μπορείτε να ξεκινήσετε με έλεγχο ταυτότητας πολλών παραγόντων Azure και AD FS στον Windows Server 2012 R2."
    services="multi-factor-authentication"
    documentationCenter=""
    authors="kgremban"
    manager="femila"
    editor="yossib"/>

<tags
    ms.service="multi-factor-authentication"
    ms.workload="identity"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="get-started-article"
    ms.date="10/14/2016"
    ms.author="kgremban"/>


# <a name="secure-your-cloud-and-on-premises-resources-using-azure-multi-factor-authentication-server-with-ad-fs-in-windows-server-2012-r2"></a>Ασφαλούς τους πόρους σας cloud και εσωτερικής εγκατάστασης με χρήση διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure με AD FS στον Windows Server 2012 R2

Εάν χρησιμοποιείτε υπηρεσίες Active Directory Federation Services (AD FS) και θέλετε να ασφαλούς cloud ή πόρους στην εσωτερική εγκατάσταση, μπορείτε να ρυθμίσετε Azure διακομιστής ελέγχου ταυτότητας πολλαπλών παραγόντων για να εργαστείτε με AD FS. Αυτή η ρύθμιση παραμέτρων εκκινεί επαλήθευσης δύο βημάτων για τα τελικά σημεία υψηλής αξίας.

Σε αυτό το άρθρο, αναλύονται με χρήση διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure με AD FS στον Windows Server 2012 R2. Για περισσότερες πληροφορίες, διαβάστε σχετικά με τον τρόπο [ασφαλούς πόρους cloud και εσωτερικής εγκατάστασης με χρήση διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure με AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).

## <a name="secure-windows-server-2012-r2-ad-fs-with-azure-multi-factor-authentication-server"></a>Ασφαλούς Windows Server 2012 R2 AD FS με Server Azure έλεγχο ταυτότητας πολλών παραγόντων

Κατά την εγκατάσταση του διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure, έχετε τις εξής επιλογές:

- Εγκατάσταση του διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure τοπικά στον ίδιο διακομιστή ως AD FS
- Εγκαταστήστε τον έλεγχο ταυτότητας πολλών παραγόντων Azure προσαρμογέα τοπικά στο διακομιστή AD FS και, στη συνέχεια, εγκαταστήστε διακομιστής ελέγχου ταυτότητας πολλαπλών παραγόντων σε διαφορετικό υπολογιστή

Πριν ξεκινήσετε, λάβετε υπόψη τις ακόλουθες πληροφορίες:

- Που δεν είναι απαραίτητα για να εγκαταστήσετε το διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure στο διακομιστή AD FS. Ωστόσο, πρέπει να εγκαταστήσετε τον έλεγχο ταυτότητας πολλών παραγόντων προσαρμογέα για AD FS σε ένα Windows Server 2012 R2 που εκτελεί AD FS. Μπορείτε να εγκαταστήσετε το διακομιστή σε διαφορετικό υπολογιστή, εάν είναι μια υποστηριζόμενη έκδοση και να εγκαταστήσετε τον προσαρμογέα AD FS ξεχωριστά στο διακομιστή ομοσπονδίας AD FS. Δείτε τις ακόλουθες διαδικασίες για να μάθετε πώς μπορείτε να εγκαταστήσετε τον προσαρμογέα ξεχωριστά.

- Όταν σχεδιάστηκε τον προσαρμογέα MFA διακομιστή AD FS, αυτό ήταν αναμένεται ότι AD FS θα μπορούσε να περάσει το όνομα του τον με την κάρτα. Στη συνέχεια, το όνομα του υπολογιστή πάρτι μπορεί να χρησιμοποιηθεί ως όνομα εφαρμογής. Ωστόσο, αυτή ενεργοποιήσει δεν πρέπει να πεζών και κεφαλαίων γραμμάτων. Εάν η εταιρεία σας χρησιμοποιεί μήνυμα κειμένου ή εφαρμογή για κινητές συσκευές επαλήθευσης μεθόδων, τις συμβολοσειρές που καθορίζεται στις ρυθμίσεις εταιρείας περιέχει ένα σύμβολο κράτησης θέσης, <$ $*όνομα_εφαρμογής*>. Σε αυτό το πλαίσιο κράτησης θέσης δεν έχει αντικατασταθεί αυτόματα κατά τη χρήση του προσαρμογέα AD FS. Συνιστάται να καταργήσετε το σύμβολο κράτησης θέσης από τις κατάλληλες συμβολοσειρές κατά τη διασφάλιση AD FS.

- Το λογαριασμό που χρησιμοποιείτε για να πραγματοποιήσετε είσοδο πρέπει να έχετε δικαιώματα χρήστη για να δημιουργήσετε ομάδες ασφαλείας στην υπηρεσία καταλόγου Active Directory.

- Ο Οδηγός εγκατάστασης προσαρμογέα έλεγχο ταυτότητας πολλών παραγόντων AD FS δημιουργεί μια ομάδα ασφαλείας που ονομάζεται PhoneFactor σε διαχειριστές τμημάτων με την παρουσία της υπηρεσίας καταλόγου Active Directory. Στη συνέχεια, προσθέτει του λογαριασμού υπηρεσίας AD FS της υπηρεσίας σας Ομοσπονδία σε αυτήν την ομάδα. Συνιστάται να επαληθεύσετε του ελεγκτή τομέα που στην πραγματικότητα τη δημιουργία της ομάδας "διαχειριστές" PhoneFactor και ότι το AD FS υπηρεσίας λογαριασμός είναι μέλος της ομάδας. Εάν είναι απαραίτητο, προσθέστε με μη αυτόματο τρόπο το λογαριασμό υπηρεσίας AD FS στην ομάδα των διαχειριστών PhoneFactor στον ελεγκτή τομέα σας.

- Για πληροφορίες σχετικά με την εγκατάσταση του SDK υπηρεσίας Web με την πύλη του χρήστη, διαβάστε [για την ανάπτυξη της πύλης του χρήστη για το διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure.](multi-factor-authentication-get-started-portal.md)


### <a name="install-azure-multi-factor-authentication-server-locally-on-the-ad-fs-server"></a>Εγκατάσταση του διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure τοπικά στο διακομιστή AD FS

1. Κάντε λήψη και εγκατάσταση διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure στο διακομιστή AD FS. Για πληροφορίες εγκατάστασης, διαβάστε σχετικά με [Γρήγορα αποτελέσματα με το διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure](multi-factor-authentication-get-started-server.md).
2. Στην κονσόλα διαχείρισης διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων Azure, κάντε κλικ στο εικονίδιο **AD FS** και, στη συνέχεια, επιλέξτε τις επιλογές **Αποδοχή χρήστη εγγραφής** και **να επιτρέπεται στους χρήστες για να επιλέξετε τη μέθοδο**.
3. Επιλέξτε οποιεσδήποτε πρόσθετες επιλογές που θέλετε να καθορίσετε για την εταιρεία σας.
4. Κάντε κλικ στην επιλογή **εγκατάσταση AD FS προσαρμογέα**.
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center>
5. Εάν εμφανίζεται το παράθυρο της υπηρεσίας καταλόγου Active Directory, που σημαίνει ότι δύο πράγματα. Ο υπολογιστής σας είναι συνδεδεμένος με έναν τομέα και τη ρύθμιση παραμέτρων της υπηρεσίας καταλόγου Active Directory για την ασφάλεια των επικοινωνιών μεταξύ του προσαρμογέα AD FS και η υπηρεσία ελέγχου ταυτότητας πολλαπλών παραγόντων είναι ελλιπής. Κάντε κλικ στο κουμπί **Επόμενο** για να αυτόματα ολοκληρώσετε αυτήν τη ρύθμιση παραμέτρων, ή να επιλέξετε το **παραλείψετε αυτόματη ρύθμιση παραμέτρων της υπηρεσίας καταλόγου Active Directory και να ρυθμίσετε τις παραμέτρους με μη αυτόματο τρόπο** το πλαίσιο ελέγχου και, στη συνέχεια, κάντε κλικ στο κουμπί **Επόμενο**.
6. Εάν εμφανίζεται το windows τοπικής ομάδας, αυτό σημαίνει ότι δύο πράγματα. Ο υπολογιστής σας δεν είναι συνδεδεμένος σε έναν τομέα και τη ρύθμιση παραμέτρων της τοπικής ομάδας για την ασφάλεια των επικοινωνιών μεταξύ του προσαρμογέα AD FS και η υπηρεσία ελέγχου ταυτότητας πολλαπλών παραγόντων είναι ελλιπής. Κάντε κλικ στο κουμπί **Επόμενο** για να αυτόματα ολοκληρώσετε αυτήν τη ρύθμιση παραμέτρων, ή να επιλέξετε το **παραλείψετε αυτόματη ρύθμιση παραμέτρων της τοπικής ομάδας και να ρυθμίσετε τις παραμέτρους με μη αυτόματο τρόπο** το πλαίσιο ελέγχου και, στη συνέχεια, κάντε κλικ στο κουμπί **Επόμενο**.
7. Στον Οδηγό εγκατάστασης, κάντε κλικ στο κουμπί **Επόμενο**. Azure διακομιστής ελέγχου ταυτότητας πολλαπλών παραγόντων δημιουργεί την ομάδα διαχειριστών PhoneFactor και προσθέτει του λογαριασμού υπηρεσίας AD FS στην ομάδα των διαχειριστών PhoneFactor.
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center>
8. Στη σελίδα **Εκκίνηση προγράμματος εγκατάστασης** , κάντε κλικ στο κουμπί **Επόμενο**.
9. Στο πρόγραμμα εγκατάστασης προσαρμογέα έλεγχο ταυτότητας πολλών παραγόντων AD FS, κάντε κλικ στο κουμπί **Επόμενο**.
10. Κάντε κλικ στην επιλογή **Κλείσιμο** όταν ολοκληρωθεί η εγκατάσταση.
11. Όταν έχει εγκατασταθεί το προσαρμογέα, θα πρέπει να καταχωρήσετε με AD FS. Ανοίξτε το Windows PowerShell και εκτελέστε την ακόλουθη εντολή:<br>
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
   <center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center>
12. Για να χρησιμοποιήσετε προσαρμογέα που μόλις καταχωρημένες, επεξεργαστείτε την πολιτική καθολικός έλεγχος ταυτότητας με AD FS. Στην κονσόλα διαχείρισης της AD FS, μεταβείτε στον κόμβο **Πολιτικές ελέγχου ταυτότητας** . Στην ενότητα **Έλεγχος ταυτότητας πολλών παραγόντων** , κάντε κλικ στη σύνδεση **Επεξεργασία** δίπλα στην ενότητα **Καθολικές ρυθμίσεις** . Στο παράθυρο **Επεξεργασία καθολικού πολιτικής ελέγχου ταυτότητας** , επιλέξτε **Έλεγχος ταυτότητας πολλών παραγόντων** ως μια μέθοδο επιπλέον ελέγχου ταυτότητας και, στη συνέχεια, κάντε κλικ στο κουμπί **OK**. Τον προσαρμογέα έχει καταχωρηθεί ως WindowsAzureMultiFactorAuthentication. Επανεκκινήστε την υπηρεσία AD FS για την καταχώρηση για να τεθούν σε ισχύ.

<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center>

Σε αυτό το σημείο, διακομιστής ελέγχου ταυτότητας πολλαπλών παραγόντων έχει ρυθμιστεί ώστε να είναι μια υπηρεσία παροχής πρόσθετου ελέγχου ταυτότητας για χρήση με το AD FS.

## <a name="install-a-standalone-instance-of-the-ad-fs-adapter-by-using-the-web-service-sdk"></a>Εγκατάσταση μια μεμονωμένη παρουσία του προσαρμογέα AD FS, χρησιμοποιώντας το SDK υπηρεσίας Web
1. Εγκατάσταση του SDK υπηρεσία Web στο διακομιστή όπου εκτελείται το διακομιστή ελέγχου ταυτότητας πολλαπλών παραγόντων.
2. Αντιγράψτε τα ακόλουθα αρχεία από το \Program Files\Multi-κατάλογο παραγόντων ελέγχου ταυτότητας διακομιστή στο διακομιστή στον οποίο σκοπεύετε να εγκαταστήσετε τον προσαρμογέα AD FS:
  - MultiFactorAuthenticationAdfsAdapterSetup64.msi
  - REGISTER-MultiFactorAuthenticationAdfsAdapter.ps1
  - Κατάργηση της καταχώρησης MultiFactorAuthenticationAdfsAdapter.ps1
  - MultiFactorAuthenticationAdfsAdapter.config
3. Εκτελέστε το αρχείο εγκατάστασης MultiFactorAuthenticationAdfsAdapterSetup64.msi.
4. Στο πρόγραμμα εγκατάστασης προσαρμογέα έλεγχο ταυτότητας πολλών παραγόντων AD FS, κάντε κλικ στο κουμπί **Επόμενο** για να ξεκινήσει η εγκατάσταση.
5. Κάντε κλικ στην επιλογή **Κλείσιμο** όταν ολοκληρωθεί η εγκατάσταση.

## <a name="edit-the-multifactorauthenticationadfsadapterconfig-file"></a>Επεξεργαστείτε το αρχείο MultiFactorAuthenticationAdfsAdapter.config

Ακολουθήστε τα παρακάτω βήματα για να επεξεργαστείτε το αρχείο MultiFactorAuthenticationAdfsAdapter.config:

1. Ορίστε τον κόμβο **UseWebServiceSdk** στην **τιμή true**.  
2. Ορίστε την τιμή για το **WebServiceSdkUrl** στη διεύθυνση URL του SDK υπηρεσίας Web ελέγχου ταυτότητας πολλαπλών παραγόντων. Για παράδειγμα: *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServicesSdk/PfWsSdk.asmx*, όπου certificatename είναι το όνομα του πιστοποιητικού.  
3. Επεξεργαστείτε τη δέσμη ενεργειών Register-MultiFactorAuthenticationAdfsAdapter.ps1 με την προσθήκη *- ConfigurationFilePath &lt;διαδρομή&gt; * μέχρι το τέλος της το `Register-AdfsAuthenticationProvider` εντολή, όπου * &lt;διαδρομή&gt; * είναι η πλήρης διαδρομή προς το αρχείο MultiFactorAuthenticationAdfsAdapter.config.

### <a name="configure-the-web-service-sdk-with-a-username-and-password"></a>Ρύθμιση παραμέτρων του SDK υπηρεσίας Web με ένα όνομα χρήστη και τον κωδικό πρόσβασης

Υπάρχουν δύο επιλογές για τη ρύθμιση των παραμέτρων του SDK υπηρεσία Web. Το πρώτο είναι με ένα όνομα χρήστη και τον κωδικό πρόσβασης, η δεύτερη με ένα πιστοποιητικό προγράμματος-πελάτη. Ακολουθήστε αυτά τα βήματα για την πρώτη επιλογή ή προχωρήστε για το δεύτερο.  

1. Ορίστε την τιμή για το **WebServiceSdkUsername** σε ένα λογαριασμό που είναι μέλος της ομάδας ασφαλείας PhoneFactor Admins. Χρησιμοποιήστε το &lt;τομέα&gt;& #92; &lt;όνομα χρήστη&gt; μορφή.  
2. Ορίστε την τιμή για το **WebServiceSdkPassword** για τον κωδικό πρόσβασης λογαριασμού κατάλληλο.

### <a name="configure-the-web-service-sdk-with-a-client-certificate"></a>Ρύθμιση παραμέτρων του SDK υπηρεσίας Web με ένα πιστοποιητικό προγράμματος-πελάτη

Εάν δεν θέλετε να χρησιμοποιήσετε ένα όνομα χρήστη και τον κωδικό πρόσβασης, ακολουθήστε τα παρακάτω βήματα για να ρυθμίσετε τις παραμέτρους του SDK υπηρεσίας Web με ένα πιστοποιητικό προγράμματος-πελάτη.

1. Προμηθευτείτε ένα πιστοποιητικό προγράμματος-πελάτη από μια αρχή έκδοσης πιστοποιητικών για το διακομιστή όπου εκτελείται το SDK υπηρεσία Web. Μάθετε πώς μπορείτε να [αποκτήσετε πιστοποιητικά προγράμματος-πελάτη](https://technet.microsoft.com/library/cc770328.aspx).  
2. Εισαγάγετε το πιστοποιητικό προγράμματος-πελάτη για το χώρο αποθήκευσης προσωπικών πιστοποιητικών τοπικό υπολογιστή στο διακομιστή που εκτελείται στο SDK υπηρεσία Web. Βεβαιωθείτε ότι είναι δημόσια η αρχή έκδοσης πιστοποιητικών του πιστοποιητικού στο χώρο αποθήκευσης πιστοποιητικών αξιόπιστων πιστοποιητικών ρίζας.  
3. Εξαγάγετε τα δημόσια και ιδιωτικά κλειδιά του πιστοποιητικού προγράμματος-πελάτη σε ένα αρχείο .pfx.  
4. Εξαγάγετε το δημόσιο κλειδί σε μορφή Base64 σε ένα αρχείο .cer.  
5. Στη Διαχείριση διακομιστών, βεβαιωθείτε ότι έχει εγκατασταθεί η δυνατότητα ελέγχου ταυτότητας αντιστοίχιση πιστοποιητικού πελάτη \Web Server\Security\IIS διακομιστή Web (IIS). Εάν δεν έχει εγκατασταθεί, επιλέξτε **Προσθήκη ρόλων και δυνατότητες** για να προσθέσετε αυτήν τη δυνατότητα.  
6. Στη διαχείριση των υπηρεσιών IIS, κάντε διπλό κλικ στο **Πρόγραμμα επεξεργασίας ρύθμισης παραμέτρων** στην τοποθεσία Web που περιέχει τον κατάλογο εικονικού SDK υπηρεσία Web. Είναι σημαντικό να το κάνετε αυτό, στο επίπεδο της τοποθεσίας Web και όχι στο επίπεδο εικονικού καταλόγου.  
7. Μεταβείτε στην ενότητα **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** .  
8. Ορίστε enabled στην **τιμή true**.  
9. Ορίστε oneToOneCertificateMappingsEnabled στην **τιμή true**.  
10. Κάντε κλικ στο κουμπί **...** δίπλα στο στοιχείο oneToOneMappings και, στη συνέχεια, κάντε κλικ στη σύνδεση **Προσθήκη** .  
11. Ανοίξτε το αρχείο .cer Base64 εξαγάγατε νωρίτερα. Κατάργηση *---ΞΕΚΙΝΉΣΕΙ ΠΙΣΤΟΠΟΙΗΤΙΚΌ---* *---ΤΕΡΜΑΤΙΣΜΌΣ ΠΙΣΤΟΠΟΙΗΤΙΚΌ---*και τυχόν αλλαγές γραμμών. Αντιγράψτε τη συμβολοσειρά που προκύπτει.  
12. Ορισμός πιστοποιητικό στη συμβολοσειρά που αντιγράψατε στο προηγούμενο βήμα.  
13. Ορίστε enabled στην **τιμή true**.  
14. Ορίστε όνομα χρήστη σε ένα λογαριασμό που είναι μέλος της ομάδας "διαχειριστές" PhoneFactor ασφαλείας. Χρησιμοποιήστε το &lt;τομέα&gt;& #92; &lt;όνομα χρήστη&gt; μορφή.  
15. Ορίστε τον κωδικό πρόσβασης για τον κωδικό πρόσβασης λογαριασμού κατάλληλο και, στη συνέχεια, κλείστε τον επεξεργαστή ρύθμισης παραμέτρων.  
16. Κάντε κλικ στη σύνδεση **εφαρμογή** .  
17. Εικονικό κατάλογο SDK υπηρεσίας Web, κάντε διπλό κλικ **ελέγχου ταυτότητας**.  
18. Βεβαιωθείτε ότι απομίμησης ASP.NET και βασικό έλεγχο ταυτότητας έχουν οριστεί **ενεργοποιημένο**και ότι όλα τα άλλα στοιχεία έχουν οριστεί **απενεργοποιημένο**.  
19. Εικονικό κατάλογο SDK υπηρεσίας Web, κάντε διπλό κλικ **Ρυθμίσεις SSL**.  
20. Ρύθμιση πιστοποιητικά προγράμματος-πελάτη για **Αποδοχή**και, στη συνέχεια, κάντε κλικ στο κουμπί **εφαρμογή**.  
21. Αντιγράψτε το αρχείο .pfx εξαγάγατε προηγουμένως στο διακομιστή που εκτελεί τον προσαρμογέα AD FS.  
22. Εισαγάγετε το αρχείο .pfx στο χώρο αποθήκευσης προσωπικών πιστοποιητικών τοπικό υπολογιστή.  
23. Κάντε δεξί κλικ και επιλέξτε **Διαχείριση ιδιωτικά κλειδιά**και, στη συνέχεια, να εκχωρήσετε πρόσβαση για ανάγνωση για το λογαριασμό που χρησιμοποιήσατε για να πραγματοποιήσετε είσοδο στην υπηρεσία AD FS.  
24. Ανοίξτε το πιστοποιητικό προγράμματος-πελάτη και αντιγράψτε την αποτύπωση από την καρτέλα **Λεπτομέρειες** .  
25. Στο αρχείο MultiFactorAuthenticationAdfsAdapter.config, ορισμός **WebServiceSdkCertificateThumbprint** στη συμβολοσειρά που αντιγράψατε στο προηγούμενο βήμα.  


Τέλος, για να καταχωρήσετε τον προσαρμογέα, εκτελέστε το \Program Files\Multi-έλεγχος ταυτότητας παραγόντων Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 δέσμης ενεργειών σε PowerShell. Τον προσαρμογέα έχει καταχωρηθεί ως WindowsAzureMultiFactorAuthentication. Επανεκκινήστε την υπηρεσία AD FS για την καταχώρηση για να τεθούν σε ισχύ.

## <a name="related-topics"></a>Σχετικά θέματα

Για βοήθεια στην αντιμετώπιση προβλημάτων, ανατρέξτε στο θέμα το [Συνήθεις ερωτήσεις έλεγχο ταυτότητας πολλών παραγόντων Azure](multi-factor-authentication-faq.md)
