<properties 
    pageTitle="CENC με πολλούς DRM και έλεγχος πρόσβασης: μια αναφορά σχεδίαση και υλοποίηση Azure και Azure Media Services | Microsoft Azure" 
    description="Μάθετε περισσότερα σχετικά με τον τρόπο για να παραχώρησης πολλαπλών αδειών χρήσης του Microsoft® ομαλή ροή προγράμματος-πελάτη μεταφορά Kit." 
    services="media-services" 
    documentationCenter="" 
    authors="willzhan"  
    manager="erikre" 
    editor=""/>

<tags 
    ms.service="media-services" 
    ms.workload="media" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="09/26/2016"  
    ms.author="willzhan;kilroyh;yanmf;juliako"/>

#<a name="cenc-with-multi-drm-and-access-control-a-reference-design-and-implementation-on-azure-and-azure-media-services"></a>CENC με πολλούς DRM και έλεγχος πρόσβασης: μια αναφορά σχεδίαση και υλοποίηση Azure και Azure Media Services

##<a name="key-words"></a>Λέξεις-κλειδιά
 
Azure υπηρεσίας καταλόγου Active Directory, των υπηρεσιών Azure Media Services, Azure Media Player, δυναμική κρυπτογράφηση, άδεια χρήσης παράδοσης, PlayReady, Widevine, FairPlay, κοινά Encryption(CENC), πολλούς DRM, Axinom, ΠΑΎΛΑ, EME, MSE, διακριτικού JSON Web (JWT), αξιώσεων, σύγχρονα προγράμματα περιήγησης, κατάδειξης αριθμού-κλειδιού, συμμετρική κλειδί, ασύμμετρη αριθμού-κλειδιού, σύνδεση OpenID, X509 πιστοποιητικού. 

##<a name="in-this-article"></a>Σε αυτό το άρθρο

Σε αυτό το άρθρο, καλύπτονται τα ακόλουθα θέματα:

- [Εισαγωγή](media-services-cenc-with-multidrm-access-control.md#introduction)
    - [Επισκόπηση αυτού του άρθρου](media-services-cenc-with-multidrm-access-control.md#overview-of-this-article)
- [Σχεδίαση μιας αναφοράς](media-services-cenc-with-multidrm-access-control.md#a-reference-design)
- [Σχεδίαση αντιστοίχισης τεχνολογία για εφαρμογή](media-services-cenc-with-multidrm-access-control.md#mapping-design-to-technology-for-implementation)
- [Εφαρμογή](media-services-cenc-with-multidrm-access-control.md#implementation)
    - [Διαδικασίες υλοποίησης](media-services-cenc-with-multidrm-access-control.md#implementation-procedures)
    - [Ορισμένες υποδείξεις στην εφαρμογή](media-services-cenc-with-multidrm-access-control.md#some-gotchas-in-implementation)
- [Πρόσθετα θέματα για την εφαρμογή](media-services-cenc-with-multidrm-access-control.md#additional-topics-for-implementation)
    - [HTTP ή HTTPS](media-services-cenc-with-multidrm-access-control.md#http-or-https)
    - [Azure Active Directory είσοδο αναστροφής κλειδιού](media-services-cenc-with-multidrm-access-control.md#azure-active-directory-signing-key-rollover)
    - [Πού βρίσκεται το διακριτικό πρόσβασης;](media-services-cenc-with-multidrm-access-control.md#where-is-the-access-token)
    - [Τι γίνεται με ζωντανή ροή;](media-services-cenc-with-multidrm-access-control.md#what-about-live-streaming)
    - [Τι γίνεται με διακομιστές αδειών χρήσης εκτός των υπηρεσιών Azure Media Services;](media-services-cenc-with-multidrm-access-control.md#what-about-license-servers-outside-of-azure-media-services)
    - [Τι γίνεται εάν θέλετε να χρησιμοποιήσετε ένα προσαρμοσμένο STS;](media-services-cenc-with-multidrm-access-control.md#what-if-i-want-to-use-a-custom-sts)
- [Το ολοκληρωμένο σύστημα και έλεγχος](media-services-cenc-with-multidrm-access-control.md#the-completed-system-and-test)
    - [Σύνδεση χρήστη](media-services-cenc-with-multidrm-access-control.md#user-login)
    - [Χρήση κρυπτογραφημένης Media επεκτάσεις για PlayReady](media-services-cenc-with-multidrm-access-control.md#using-encrypted-media-extensipons-for-playready)
    - [Χρήση EME για Widevine](media-services-cenc-with-multidrm-access-control.md#using-eme-for-widevine)
    - [Οι χρήστες δεν δικαιούνται](media-services-cenc-with-multidrm-access-control.md#not-entitled-users)
    - [Εκτέλεση προσαρμοσμένης διακριτικού υπηρεσία ασφαλούς](media-services-cenc-with-multidrm-access-control.md#running-custom-secure-token-service)
- [Σύνοψη](media-services-cenc-with-multidrm-access-control.md#summary)

##<a name="introduction"></a>Εισαγωγή

Είναι γνωστό ότι είναι μια σύνθετη εργασία για να σχεδιάσετε και να δημιουργήσετε μια υποσυστήματος DRM για μια OTT ή online ροής λύση. Και είναι μια συνηθισμένη πρακτική για τελεστές/online υπηρεσίες παροχής βίντεο για να μεταβιβάζουν αυτό το τμήμα σε εξειδικευμένες DRM υπηρεσίες παροχής. Είναι ο στόχος αυτού του εγγράφου για να παρουσιάσετε μια σχεδίαση αναφοράς και την εφαρμογή του υποσυστήματος DRM σε ολοκληρωμένες στην OTT ή online ροής λύση.

Τα προγράμματα ανάγνωσης προορισμού αυτού του εγγράφου είναι οι μηχανικοί που εργάζονται στο υποσυστήματος DRM OTT ή ηλεκτρονικές ροής/πολλών-screen λύσεις ή οποιαδήποτε τους αναγνώστες σας ενδιαφέρουν υποσυστήματος DRM. Υπόθεση είναι ότι οι αναγνώστες εξοικειωμένοι με τουλάχιστον μία από τις τεχνολογίες DRM στην αγορά, όπως PlayReady, Widevine, FairPlay ή Adobe πρόσβασης.

Από το DRM, θα σας να περιλαμβάνουν CENC (κοινές κρυπτογράφηση) με πολλούς DRM. Μια κύρια τάση online ροής και OTT κλάδο είναι να χρησιμοποιήσετε CENC με πολλών-native-DRM σε διάφορες πλατφόρμες προγράμματος-πελάτη, που είναι μια shift από την προηγούμενη τάση της χρησιμοποιώντας ένα μεμονωμένο DRM και του προγράμματος-πελάτη SDK για διάφορες πλατφόρμες προγράμματος-πελάτη. Όταν χρησιμοποιείτε CENC με πολλών native DRM, PlayReady και Widevine είναι κρυπτογραφημένα ανά της προδιαγραφής [Κοινές κρυπτογράφησης (CENC ISO/IEC 23001-7)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) .

Τα πλεονεκτήματα της CENC με πολλούς DRM είναι οι εξής:

1. Μειώνει κρυπτογράφησης κόστους επειδή χρησιμοποιείται ένα μεμονωμένο κρυπτογράφησης επεξεργασίας στόχευσης διαφορετικές πλατφόρμες με τα εγγενή DRMs;
1. Μειώνει το κόστος τη Διαχείριση κρυπτογραφημένο περιουσιακών στοιχείων αφού μόνο ένα αντίγραφο κρυπτογραφημένο περιουσιακών στοιχείων είναι απαραίτητη;
1. Καταργεί το πρόγραμμα-πελάτης DRM παραχώρησης πολλαπλών αδειών χρήσης κόστος, επειδή το εγγενές πρόγραμμα-πελάτης DRM είναι συνήθως δωρεάν σε τα εγγενή πλατφόρμα.

Microsoft έχει ένα ενεργό υπεύθυνο της ΠΑΎΛΑΣ και CENC μαζί με ορισμένα προγράμματα αναπαραγωγής κύρια κλάδο. Microsoft Azure Media Services έχει παροχή τεχνικής υποστήριξης της ΠΑΎΛΑΣ και CENC. Για πρόσφατες ανακοινώσεις, ανατρέξτε στο θέμα ιστολόγια του Mingfei: [ανακοίνωση Google Widevine υπηρεσίες παράδοσης άδεια χρήσης σε υπηρεσιών Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/)και [Azure Media Services προσθέτει Google Widevine συσκευασία για την παροχή πολλούς DRM ροής](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).  

### <a name="overview-of-this-article"></a>Επισκόπηση αυτού του άρθρου

Ο στόχος αυτού του άρθρου περιλαμβάνει τα εξής:

1. Παρέχει μια σχεδίαση αναφοράς του υποσυστήματος DRM χρήση CENC με πολλούς-DRM;
1. Παρέχει μια αναφορά υλοποίηση πλατφόρμας Microsoft Azure/Azure Media Services;
1. Περιγράφει ορισμένα θέματα σχεδίαση και υλοποίηση.

Στο άρθρο, "πολλούς-DRM" καλύπτει τα εξής:

1. Microsoft PlayReady
1. Google Widevine
1. Apple FairPlay (δεν έχει ακόμα υποστηρίζεται από υπηρεσιών Azure Media Services)

Ο παρακάτω πίνακας συνοψίζει την εγγενή πλατφόρμα/εγγενή εφαρμογή και, προγραμμάτων περιήγησης που υποστηρίζονται από κάθε DRM.

**Πλατφόρμα προγράμματος-πελάτη**|**Υποστήριξη εγγενούς DRM**|**Πρόγραμμα περιήγησης/εφαρμογής**|**Μορφές ροής**
----|------|----|----
**Έξυπνη τηλεοράσεις, τελεστή STB, STB OTT**|PlayReady κυρίως, ή/και Widevine ή/και άλλα|Linux, Opera, WebKit, άλλους|Διάφορες μορφές
**Συσκευές με Windows 10 (Υπολογιστή με Windows, στην αγορά των Windows, Windows Phone, Xbox)**|PlayReady|MS άκρη/IE11/EME<br/><br/><br/>UWP|ΠΑΎΛΑ (για HLS, PlayReady δεν υποστηρίζεται)<br/><br/>ΠΑΎΛΑ, ομαλή ροή (για HLS, PlayReady δεν υποστηρίζεται) 
**Συσκευές Android (τηλέφωνο, Tablet, Τηλεόραση)**|Widevine|Chrome/EME|ΠΑΎΛΑ
**iOS (iPhone, iPad), προγράμματα-πελάτες του OS X και Τηλεοπτική Apple**|FairPlay|Safari 8 +/ EME|HLS
**Προσθήκη: Adobe Primetime**|Πρόσβαση Primetime|Προσθήκη προγράμματος περιήγησης|ΣΚΛΗΡΟΊ ΔΊΣΚΟΙ, HLS

Δεδομένων την τρέχουσα κατάσταση της ανάπτυξης για κάθε DRM, μια υπηρεσία συνήθως θέλετε για την υλοποίηση της DRMs 2 ή 3 για να βεβαιωθείτε ότι η διεύθυνση όλους τους τύπους τελικά σημεία στο τον καλύτερο τρόπο.

Υπάρχει ανταλλαγή μεταξύ την πολυπλοκότητα της λογικής υπηρεσίας και την πολυπλοκότητα στην πλευρά προγράμματος-πελάτη για την επίτευξη ένα συγκεκριμένο επίπεδο της εμπειρίας χρήστη σε τα διάφορα προγράμματα-πελάτες.

Για να κάνετε την επιλογή σας, λάβετε υπόψη τα παρακάτω στοιχεία:

- PlayReady εγγενώς έχει υλοποιηθεί σε κάθε συσκευή Windows, σε ορισμένες συσκευές Android, και μέσω SDK λογισμικού σε σχεδόν οποιαδήποτε πλατφόρμα
- Widevine εγγενώς έχει υλοποιηθεί σε κάθε συσκευή Android στο Chrome και σε ορισμένες άλλες συσκευές
- FairPlay είναι διαθέσιμη μόνο σε iOS και προγράμματα-πελάτες του Mac OS ή μέσω του iTunes.

Επομένως, θα είναι ένα τυπικό πολλούς DRM:

- Επιλογή 1: PlayReady και Widevine
- Επιλογή 2: PlayReady, Widevine και FairPlay


## <a name="a-reference-design"></a>Σχεδίαση μιας αναφοράς

Σε αυτήν την ενότητα, θα σας θα εμφανίσει ένα σχέδιο αναφοράς, το οποίο είναι είναι ανεξάρτητο τεχνολογίες που χρησιμοποιούνται για την εφαρμογή του.

Μια υποσυστήματος DRM μπορεί να περιέχει τα ακόλουθα στοιχεία:

1. Διαχείριση κλειδιών
1. Συσκευασία DRM
1. Παράδοση DRM άδειας χρήσης
1. Δικαίωμα ελέγχου
1. Έλεγχος ταυτότητας/εξουσιοδότησης
1. Πρόγραμμα αναπαραγωγής
1. Origin/CDN

Το παρακάτω διάγραμμα παρουσιάζει την υψηλού επιπέδου αλληλεπίδραση μεταξύ των στοιχείων σε μια υποσυστήματος DRM.

![Υποσυστήματος DRM με CENC](./media/media-services-cenc-with-multidrm-access-control/media-services-generic-drm-subsystem-with-cenc.png)
 
Υπάρχουν τρεις βασικές "Επίπεδα" στη σχεδίαση:

1. Επίπεδο πίσω office (σε μαύρο) το οποίο δεν είναι εκτεθειμένη εξωτερικά;
1. Επίπεδο "DMZ" (μπλε) που περιέχει όλα τα τελικά σημεία αντικριστές δημόσια;
1. Δημόσια Internet επίπεδο (ανοιχτό μπλε) που περιέχει CDN και προγράμματα αναπαραγωγής με κίνηση σε δημόσια στο Internet.
 
Θα πρέπει να υπάρχει ένα εργαλείο Διαχείριση περιεχομένου για τον έλεγχο DRM προστασίας, ανεξάρτητα από είναι στατική ή δυναμική κρυπτογράφηση. Τα δεδομένα εισόδου για την κρυπτογράφηση DRM θα πρέπει να περιλαμβάνουν τα εξής:

1. Περιεχόμενο βίντεο MBR;
1. Πλήκτρο περιεχομένου.
1. Διευθύνσεις URL απόκτηση της άδειας χρήσης.

Κατά τη διάρκεια του χρόνου αναπαραγωγής, η ροή υψηλού επιπέδου είναι:

1. Έλεγχος ταυτότητας χρήστη;
1. Εξουσιοδότηση διακριτικό δημιουργείται για το χρήστη.
1. Γίνεται λήψη των περιεχόμενο με προστασία DRM (δηλωτικό) στο πρόγραμμα αναπαραγωγής;
1. Πρόγραμμα αναπαραγωγής υποβάλλει αίτηση απόκτηση άδειας χρήσης για διακομιστές αδειών χρήσης μαζί με το πλήκτρο Αναγνωριστικό και εξουσιοδότησης διακριτικού.

Πριν από την μετακίνηση στο επόμενο θέμα, μερικές λέξεις σχετικά με τη σχεδίαση της διαχείρισης κλειδιών.

**ContentKey – παγίου**|**Σενάριο**
------|---------------------------
1-σε-1|Η πιο απλή περίπτωση. Παρέχει το υψηλότερο στοιχείο ελέγχου. Αλλά αυτό συνήθως έχει ως αποτέλεσμα το μεγαλύτερο κόστος παράδοσης άδεια χρήσης. Στο ελάχιστο μία άδεια χρήσης αίτηση είναι απαραίτητη για κάθε προστατευμένο περιουσιακών στοιχείων.
1-προς-πολλά|Μπορείτε να χρησιμοποιήσετε το ίδιο περιεχόμενο κλειδί για πολλά στοιχεία. Για παράδειγμα, για όλα τα περιουσιακά στοιχεία σε μια ομάδα λογική όπως ένα είδος ή ένα υποσύνολο του είδους (ή ταινίας γονιδίων), μπορείτε να χρησιμοποιήσετε ένα μεμονωμένο κλειδί περιεχομένου.
Πολλά-προς-1|Πολλά περιεχομένου κλειδιά απαιτούνται για κάθε πάγιο. <br/><br/>Για παράδειγμα, εάν χρειάζεται να εφαρμόσετε δυναμικής CENC προστασία με πολλούς-DRM για MPEG-ΔΙΑΚΕΚΟΜΜΈΝΗ και δυναμική κρυπτογράφηση AES 128 για HLS, χρειάζεστε δύο ξεχωριστές περιεχομένου κλειδιά, κάθε μία με το δικό της ContentKeyType. (Για το κλειδί περιεχομένου που χρησιμοποιείται για την προστασία με δυναμική CENC, θα πρέπει να ContentKeyType.CommonEncryption χρησιμοποιείται, ενώ το κλειδί περιεχομένου που χρησιμοποιείται για δυναμική κρυπτογράφηση AES 128, θα πρέπει να χρησιμοποιείται ContentKeyType.EnvelopeEncryption.)<br/><br/>Ένα άλλο παράδειγμα, CENC προστασία περιεχομένου ΠΑΎΛΑ, θεωρητικά, ένα κλειδί περιεχομένου μπορεί να χρησιμοποιηθεί για την προστασία ροή βίντεο και ένα άλλο πλήκτρο περιεχομένου για την προστασία ροή ήχου. 
Πολλά-προς - πολλά|Συνδυασμός των δύο παραπάνω σενάρια: ένα σύνολο περιεχομένου πλήκτρα που χρησιμοποιούνται για κάθε ένα από τα πολλά περιουσιακά στοιχεία στο ίδιο παγίου "ομάδα".


Ένας άλλος σημαντικός παράγοντας πρέπει να λάβετε υπόψη είναι η χρήση της μόνιμη και μη μόνιμο αδειών χρήσης.

Γιατί είναι σημαντικά τα παρακάτω ζητήματα; 

Έχουν άμεση επίδραση κόστος παράδοσης άδειας χρήσης, εάν χρησιμοποιείτε το δημόσιο cloud για την παράδοση άδεια χρήσης. Ας δούμε τις ακόλουθες δύο περιπτώσεις διαφορετική σχεδίαση για την απεικόνιση:



1. Μηνιαία συνδρομή: χρήση μόνιμη άδεια χρήσης και 1-προς-πολλά περιεχομένου αντιστοίχισης κλειδί-σε-περιουσιακών στοιχείων. Π.χ. για όλα τα παιδιά ταινίες, χρησιμοποιούμε ένα μεμονωμένο κλειδί περιεχομένου για την κρυπτογράφηση. Σε αυτήν την περίπτωση: 

    Σύνολο # αδειών χρήσης που ζητούνται για όλα τα παιδιά ταινίες/συσκευή = 1

1. Μηνιαία συνδρομή: χρήση μη μόνιμο άδεια χρήσης και αντιστοίχιση 1-σε-1 μεταξύ περιεχομένου κλειδί και περιουσιακών στοιχείων. Σε αυτήν την περίπτωση:

    Σύνολο # αδειών χρήσης που ζητούνται για όλα τα παιδιά ταινίες/συσκευή = [# ταινίες με παρακολούθηση] x [# περίοδοι λειτουργίας]

Όπως μπορείτε εύκολα να δείτε, τα δύο διάφορα σχέδια έχει ως αποτέλεσμα πολύ διαφορετικές άδειας χρήσης μοτίβα αίτηση ως εκ τούτου κόστους εάν παρέχεται υπηρεσία παράδοσης άδειας χρήσης από μια δημόσια cloud όπως υπηρεσιών Azure Media Services παράδοσης άδεια χρήσης.

## <a name="mapping-design-to-technology-for-implementation"></a>Σχεδίαση αντιστοίχισης τεχνολογία για εφαρμογή

Στη συνέχεια, θα σας αντιστοιχίστε το γενικό σχέδιο τεχνολογίες στο Microsoft Azure/Azure Media Services πλατφόρμα, καθορίζοντας την τεχνολογία που θα χρησιμοποιήσετε για κάθε μπλοκ δόμησης.

Ο παρακάτω πίνακας δείχνει την αντιστοίχιση:

**Μπλοκ δόμησης**|**Τεχνολογία**
------|-------
**Πρόγραμμα αναπαραγωγής**|[Πρόγραμμα αναπαραγωγής πολυμέσων Azure](https://azure.microsoft.com/services/media-services/media-player/)
**Υπηρεσία παροχής ταυτότητας (IDP)**|Καταλόγου Azure Active Directory
**Υπηρεσία ασφαλούς διακριτικού (STS)**|Καταλόγου Azure Active Directory
**Ροή εργασίας προστασία DRM**|Υπηρεσίες πολυμέσων Azure δυναμικής προστασίας
**Παράδοση DRM άδειας χρήσης**|1. azure Media Services παράδοσης αδειών χρήσης (PlayReady, Widevine, FairPlay), ή <br/>2. Axinom άδειας χρήσης διακομιστή, <br/>3. προσαρμοσμένο PlayReady διακομιστή αδειών χρήσης
**Προέλευση**|Υπηρεσίες πολυμέσων Azure ροής τελικού σημείου
**Διαχείριση κλειδιών**|Δεν είναι απαραίτητο για την εφαρμογή αναφοράς
**Διαχείριση περιεχομένου**|Μια εφαρμογή κονσόλας C#

Με άλλα λόγια, υπηρεσία παροχής ταυτότητας (IDP) και ασφαλούς υπηρεσίας διακριτικού (STS) θα Azure AD. Για το πρόγραμμα αναπαραγωγής, θα χρησιμοποιήσουμε [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/). Υπηρεσιών Azure Media Services και Azure Media Player υποστηρίζει ΠΑΎΛΑ και CENC με πολλούς DRM.

Το παρακάτω διάγραμμα δείχνει τη συνολική δομή και ροής με την παραπάνω αντιστοίχιση τεχνολογία.

![CENC σε αθροιστικής μέτρησης ενισχύσεων](./media/media-services-cenc-with-multidrm-access-control/media-services-cenc-subsystem-on-AMS-platform.png)

Για να ρυθμίσετε δυναμική κρυπτογράφηση CENC, το εργαλείο διαχείρισης περιεχομένου θα χρησιμοποιήσει τα εξής δεδομένα εισόδου:

1. Άνοιγμα περιεχομένου.
1. Πλήκτρο περιεχομένου από το κλειδί γενιάς/διαχείρισης;
1. Διευθύνσεις URL acquisition άδεια χρήσης;
1. Μια λίστα με πληροφορίες από το Azure AD.

Το αποτέλεσμα του εργαλείου διαχείρισης περιεχομένου θα είναι:

1. ContentKeyAuthorizationPolicy που περιέχει την προδιαγραφή στην πώς παράδοσης άδειας χρήσης επαληθεύει ενός διακριτικού JWT και DRM προδιαγραφές άδεια χρήσης;
1. AssetDeliveryPolicy που περιέχει προδιαγραφές στη ροή μορφή, προστασία DRM και διευθύνσεις URL acquisition άδεια χρήσης.

Κατά τη διάρκεια του χρόνου εκτέλεσης, η ροή είναι όπως παρακάτω:

1. Κατά τον έλεγχο ταυτότητας χρήστη, δημιουργείται ένα διακριτικό JWT;
1. Μία από τις απαιτήσεις που περιέχονται στο διακριτικό JWT είναι διεκδίκηση "ομάδες" που περιέχει το Αναγνωριστικό του αντικειμένου ομάδας του "EntitledUserGroup". Το αίτημα αυτό θα χρησιμοποιηθεί για τη μεταφορά "δικαίωμα ελέγχου".
1. Πρόγραμμα αναπαραγωγής λήψεις δηλωτικό προγράμματος-πελάτη από μια CENC προστασία περιεχομένου και "βλέπει" τα εξής:
    1. Αναγνωριστικό, κλειδιού 
    1. το περιεχόμενο είναι προστατευμένο, CENC
    1. Διευθύνσεις URL απόκτηση της άδειας χρήσης.

1. Πρόγραμμα αναπαραγωγής κάνει μια αίτηση acquisition άδεια χρήσης που βασίζονται σε πρόγραμμα περιήγησης/DRM υποστηρίζονται. Στην πρόσκληση σε απόκτηση άδειας χρήσης, Αναγνωριστικό κλειδιού και το διακριτικό JWT επίσης θα υποβληθεί. Η υπηρεσία παράδοσης άδειας χρήσης θα επαληθεύσετε το διακριτικό JWT και τις απαιτήσεις που περιέχονται πριν από την έκδοση την απαραίτητη άδεια χρήσης.

##<a name="implementation"></a>Εφαρμογή

###<a name="implementation-procedures"></a>Διαδικασίες υλοποίησης

Η εφαρμογή θα περιλαμβάνει τα παρακάτω βήματα:

1. Προετοιμασία δοκιμών asset(s): κωδικοποιείτε και πακέτο δοκιμής βίντεο για πολλούς-ρυθμό μετάδοσης bit κατακερματιστεί MP4 στο υπηρεσιών Azure Media Services. Αυτού του περιουσιακού στοιχείου δεν είναι προστατευμένο DRM. Προστασία DRM θα εκτελεστεί από δυναμική προστασία αργότερα.
1. Δημιουργία βασικών Αναγνωριστικό και περιεχόμενο κλειδιού (προαιρετικά από βασικών σπόρων). Για το σκοπό, σύστημα διαχείρισης κλειδιών δεν είναι απαραίτητος εφόσον μας σας ενδιαφέρει μόνο ένα σύνολο βασικές Αναγνωριστικό και περιεχομένου κλειδί για δύο στοιχεία ελέγχου;
1. Χρησιμοποιήστε αθροιστικής μέτρησης ενισχύσεων API για να ρυθμίσετε πολλούς DRM υπηρεσίες παράδοσης άδεια χρήσης του παγίου δοκιμής. Εάν χρησιμοποιείτε διακομιστές προσαρμοσμένο αδειών χρήσης από την εταιρεία σας ή τους προμηθευτές της εταιρείας σας αντί για υπηρεσίες άδειας χρήσης στο υπηρεσιών Azure Media Services, μπορείτε να παραλείψετε αυτό το βήμα και να καθορίσετε διευθύνσεις URL απόκτηση άδειας χρήσης στο βήμα για τη ρύθμιση παραμέτρων παράδοσης άδεια χρήσης. API αθροιστικής μέτρησης ενισχύσεων είναι απαραίτητη για να καθορίσετε ορισμένες λεπτομερείς ρυθμίσεις παραμέτρων, όπως περιορισμού πολιτικής εξουσιοδότησης, πρότυπα απόκριση άδειας χρήσης για διαφορετικές υπηρεσίες άδειας χρήσης DRM, κ.λπ. Αυτήν τη στιγμή, την πύλη του Azure δεν παρέχει ακόμη το περιβάλλον εργασίας Χρήστη απαιτείται για αυτήν τη ρύθμιση παραμέτρων. Μπορείτε να βρείτε πληροφορίες επιπέδου API και δείγμα κώδικα σε έγγραφο του Julia Kornich: [Χρήση PlayReady ή/και Widevine δυναμική κοινές κρυπτογράφηση](media-services-protect-with-drm.md). 
1. Χρησιμοποιήστε αθροιστικής μέτρησης ενισχύσεων API για να ρυθμίσετε πολιτική παράδοσης περιουσιακών στοιχείων του παγίου δοκιμής. Μπορείτε να βρείτε πληροφορίες επιπέδου API και δείγμα κώδικα σε έγγραφο του Julia Kornich: [Χρήση PlayReady ή/και Widevine δυναμική κοινές κρυπτογράφηση](media-services-protect-with-drm.md).
1. Δημιουργία και ρύθμιση παραμέτρων ένα μισθωτή του Azure Active Directory στο Azure;
1. Δημιουργία μερικά λογαριασμούς χρηστών και ομάδων στο μισθωτή του Azure Active Directory: θα πρέπει να δημιουργήσετε τουλάχιστον "EntitledUser" Ομαδοποίηση και Προσθήκη χρήστη σε αυτήν την ομάδα. Οι χρήστες σε αυτή την ομάδα θα μεταβίβαση ελέγχου δικαίωμα σε απόκτηση άδειας χρήσης και οι χρήστες δεν σε αυτή την ομάδα θα αποτύχει για τη μεταβίβαση ελέγχου του ελέγχου ταυτότητας και δεν θα μπορείτε να αποκτήσετε άδεια χρήσης. Είναι μέλος της ομάδας "EntitledUser" είναι μιας απαίτησης απαιτούμενες "ομάδες" από το διακριτικό JWT εκδοθεί από Azure AD. Αυτή η απαίτηση διεκδίκηση θα πρέπει να έχει καθοριστεί με τη ρύθμιση παραμέτρων DRM πολλαπλών αδειών χρήσης παράδοσης υπηρεσιών-βήμα.
1. Δημιουργία εφαρμογής ASP.NET MVC που θα φιλοξενίας του προγράμματος αναπαραγωγής βίντεο. Αυτή η εφαρμογή ASP.NET θα προστατεύονται με έλεγχο ταυτότητας χρήστη σε σχέση με το μισθωτή Azure Active Directory. PROPER αξιώσεων θα συμπεριληφθούν στην τα διακριτικά πρόσβασης που λαμβάνονται μετά τον έλεγχο ταυτότητας χρήστη. API σύνδεση OpenID προτείνεται για αυτό το βήμα. Πρέπει να εγκαταστήσετε τα πακέτα NuGet παρακάτω:
    - Εγκατάσταση του πακέτου Microsoft.Azure.ActiveDirectory.GraphClient
    - Εγκατάσταση του πακέτου Microsoft.Owin.Security.OpenIdConnect
    - Εγκατάσταση του πακέτου Microsoft.Owin.Security.Cookies
    - Εγκατάσταση του πακέτου Microsoft.Owin.Host.SystemWeb
    - Εγκατάσταση του πακέτου Microsoft.IdentityModel.Clients.ActiveDirectory
1. Δημιουργήστε ένα πρόγραμμα αναπαραγωγής χρήση [API του προγράμματος αναπαραγωγής πολυμέσων Azure](http://amp.azure.net/libs/amp/latest/docs/). [API ProtectionInfo του Azure Media Player](http://amp.azure.net/libs/amp/latest/docs/) σάς επιτρέπει να καθορίσετε την τεχνολογία DRM που θα χρησιμοποιήσετε σε διαφορετικό πλατφόρμα DRM.
1. Δοκιμή πίνακα:

**DRM**|**Πρόγραμμα περιήγησης**|**Αποτέλεσμα για δικαιούνται χρήστη**|**Αποτέλεσμα για κατάργησης δικαιούνται χρήστη**
---|---|-----|---------
**PlayReady**|MS άκρη ή IE11 στα Windows 10|Ολοκληρωθεί με επιτυχία|Αποτυχία
**Widevine**|Chrome στα Windows 10|Ολοκληρωθεί με επιτυχία|Αποτυχία
**FairPlay** |TBD||

Γιώργος Trifonov της ομάδας υπηρεσίες πολυμέσων Azure έχει εγγραφεί ιστολογίου παρέχει λεπτομερείς οδηγίες σε τη ρύθμιση του Azure Active Directory για μια εφαρμογή προγράμματος αναπαραγωγής ASP.NET MVC: [ενοποίηση Azure Media Services OWIN MVC βάσει εφαρμογή με το Azure Active Directory και να περιορίσετε την παράδοση περιεχομένου κλειδιού βάσει αξιώσεων JWT](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).

Γιώργος έχει εγγραφεί επίσης ένα ιστολόγιο [JWT διακριτικού](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/)ελέγχου ταυτότητας σε υπηρεσιών Azure Media Services και δυναμική κρυπτογράφηση. Και εδώ είναι το [δείγμα Azure AD ενοποίηση με το πλήκτρο παράδοσης υπηρεσιών Azure Media Services](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).

Για πληροφορίες σχετικά με την υπηρεσία καταλόγου Azure Active Directory:

- Μπορείτε να βρείτε πληροφορίες για προγραμματιστές [Azure Active Directory για προγραμματιστές του](../active-directory/active-directory-developers-guide.md)οδηγού.
- Μπορείτε να βρείτε πληροφορίες διαχειριστή στη [Διαχείριση των Azure AD Directory](../active-directory/active-directory-administer.md).

### <a name="some-gotchas-in-implementation"></a>Ορισμένες υποδείξεις στην εφαρμογή

Υπάρχουν ορισμένα "υποδείξεις" κατά την εφαρμογή. Ελπίζουμε η ακόλουθη λίστα "υποδείξεις" μπορεί να σας βοηθήσει να αντιμετώπιση προβλημάτων σε περίπτωση να αντιμετωπίσετε προβλήματα.

1. **Εκδότης** Διεύθυνση URL πρέπει να τελειώνει με **"/"**.  

    **Ακροατήριο** πρέπει να είναι το Αναγνωριστικό αναπαραγωγής της εφαρμογής υπολογιστή-πελάτη και μπορείτε, επίσης, θα πρέπει να προσθέσετε **"/"** στο τέλος της διεύθυνσης URL εκδότη.

        <add key="ida:audience" value="[Application Client ID GUID]" />
        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/" /> 

    Στο [Αποκωδικοποιητή JWT](http://jwt.calebb.net/), θα πρέπει να βλέπετε **πληροφορίες** και **iss** ως κάτω από το στοιχείο στο διακριτικό JWT:
    
    ![1η gotcha](./media/media-services-cenc-with-multidrm-access-control/media-services-1st-gotcha.png)


2. Προσθήκη δικαιωμάτων στην εφαρμογή σε AAD (στην καρτέλα ρύθμιση παραμέτρων της εφαρμογής). Αυτό είναι απαραίτητο για κάθε εφαρμογή (τοπικό και ανεπτυγμένος εκδόσεις).

    ![2η gotcha](./media/media-services-cenc-with-multidrm-access-control/media-services-perms-to-other-apps.png)


3. Χρησιμοποιήστε τον εκδότη δεξιά κατά τον ορισμό δυναμικής προστασίας CENC:

        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/"/>
    
    Τα ακόλουθα δεν λειτουργούν:
    
        <add key="ida:issuer" value="https://willzhanad.onmicrosoft.com/" />
    
    Το GUID είναι το αναγνωριστικό του μισθωτή AAD. Μπορείτε να βρείτε το GUID στο αναδυόμενο τελικά σημεία στην πύλη Azure.

4. Ιδιότητα μέλους ομάδας εκχώρηση απαιτήσεων δικαιώματα. Βεβαιωθείτε ότι στο αρχείο δηλώσεων εφαρμογής AAD, έχουμε τα εξής

    "groupMembershipClaims": "Όλα", (η προεπιλεγμένη τιμή είναι null)

5. Ρύθμιση proper TokenType κατά τη δημιουργία απαιτήσεις περιορισμού.

        objTokenRestrictionTemplate.TokenType = TokenType.JWT;

    Μετά την προσθήκη της υποστήριξης του JWT (AAD) εκτός από SWT (ACS), η προεπιλογή TokenType είναι TokenType.JWT. Εάν χρησιμοποιείτε το SWT/ACS, πρέπει να ορίσετε TokenType.SWT.

## <a name="additional-topics-for-implementation"></a>Πρόσθετα θέματα για την εφαρμογή
Στη συνέχεια θα σας θα disc uss ορισμένα πρόσθετα θέματα στη σχεδίαση και υλοποίηση μας.

###<a name="http-or-https"></a>HTTP ή HTTPS;

Η εφαρμογή του προγράμματος αναπαραγωγής ASP.NET MVC μας ενσωματωμένη πρέπει να υποστηρίζει τα εξής:

1. Ο έλεγχος ταυτότητας χρήστη μέσω Azure AD που πρέπει να βρίσκεται στην περιοχή HTTPS;
1. JWT διακριτικού exchange μεταξύ του προγράμματος-πελάτη και Azure AD που πρέπει να βρίσκεται στην περιοχή HTTPS;
1. Απόκτηση DRM άδειας χρήσης από το πρόγραμμα-πελάτη που πρέπει να είναι στην περιοχή HTTPS εάν παράδοσης άδειας χρήσης παρέχονται μέσω των υπηρεσιών Azure Media Services. Φυσικά, οικογένεια προϊόντος PlayReady δεν υποχρεώνει HTTPS για την παράδοση άδεια χρήσης. Εάν ο διακομιστής αδειών χρήσης PlayReady είναι εκτός των υπηρεσιών Azure Media Services, μπορεί να χρησιμοποιηθεί HTTP ή HTTPS.

Γι ' αυτό, η εφαρμογή του προγράμματος αναπαραγωγής ASP.NET θα χρησιμοποιήσει HTTPS ως βέλτιστη πρακτική. Αυτό σημαίνει ότι το πρόγραμμα αναπαραγωγής πολυμέσων Azure θα εμφανίζεται σε μια σελίδα στην περιοχή HTTPS. Ωστόσο, για τη ροή προτιμότερο HTTP, επομένως πρέπει να εξετάστε το ενδεχόμενο να μεικτές ζήτημα περιεχομένου.

1. Δεν επιτρέπονται περιήγησης μεικτό περιεχόμενο. Αλλά επιτρέπει προσθήκες, όπως η προσθήκη Silverlight και OSMF για ομαλές και ΠΑΎΛΑΣ. Μεικτό περιεχόμενο είναι ένα πρόβλημα ασφαλείας - αυτό οφείλεται υπό την απειλή τη δυνατότητα εισαγωγής κακόβουλο JS που μπορούν να προκαλέσουν τα δεδομένα πελατών που θα σε κίνδυνο.  Προγράμματα περιήγησης αποκλείσετε αυτό από προεπιλογή και ο μόνος τρόπος για να επιλύσετε αυτό είναι μέχρι στιγμής από την πλευρά του διακομιστή (προέλευσης), για να επιτρέψετε σε όλους τους τομείς (ανεξάρτητα https ή http). Αυτό μάλλον δεν είναι καλή ιδέα είτε.
1. Θα σας θα πρέπει να αποφύγετε μεικτό περιεχόμενο: είτε και τις δύο Χρησιμοποιήστε HTTP ή και τα δύο HTTPS. Κατά την αναπαραγωγή μεικτό περιεχόμενο, silverlightSS tech απαιτεί εκκαθάριση μια προειδοποίηση μεικτό περιεχόμενο. flashSS tech χειρίζεται μεικτό περιεχόμενο χωρίς προειδοποίηση μεικτό περιεχόμενο.
1. Εάν το τελικό σημείο ροής δημιουργήθηκε πριν Αυγούστου 2014, δεν υποστηρίζει HTTPS. Σε αυτήν την περίπτωση, δημιουργήστε και χρησιμοποιήστε ένα νέο τελικό σημείο ροής για HTTPS.

Κατά την εκτέλεση αναφοράς, για προστασία DRM περιεχόμενα, εφαρμογών και η ροή θα βρίσκονται στην περιοχή HTTTPS. Για άνοιγμα περιεχομένων, το πρόγραμμα αναπαραγωγής δεν χρειάζεται να ελέγχου ταυτότητας ή άδεια χρήσης, ώστε να έχετε το ελευθερίας για να χρησιμοποιήσετε HTTP ή HTTPS.

### <a name="azure-active-directory-signing-key-rollover"></a>Azure Active Directory είσοδο αναστροφής κλειδιού

Αυτό είναι ένα σημαντικό σημείο για να λάβετε υπόψη σας εφαρμογής. Εάν δεν θεωρείτε στην υλοποίηση, το ολοκληρωμένο σύστημα θα σταματήσει τελικά εργασία πλήρως εντός πολύ 6 εβδομάδων.

Azure AD χρησιμοποιεί τυπική κλάδο για τη δημιουργία αξιοπιστίας ανάμεσα στον ίδιο και τις εφαρμογές που χρησιμοποιούν Azure AD. Συγκεκριμένα, Azure AD χρησιμοποιεί ένα κλειδί υπογραφής που αποτελείται από ένα ζεύγος κλειδιών δημόσια και ιδιωτικά. Όταν το Azure AD δημιουργεί έναν κωδικό ασφαλείας που περιέχει πληροφορίες σχετικά με το χρήστη, αυτό το διακριτικό είναι υπογεγραμμένο από Azure AD χρησιμοποιώντας το ιδιωτικό κλειδί πριν από την αποστολή ξανά με την εφαρμογή. Για να επαληθεύσετε ότι το διακριτικό δεν είναι έγκυρη και στην πραγματικότητα εκδοθέντων από το Azure AD, η εφαρμογή πρέπει να επικυρώσετε το διακριτικό υπογραφή χρησιμοποιώντας το δημόσιο κλειδί που εκτίθεται από Azure AD που περιέχεται στο έγγραφο μετα-δεδομένων ομοσπονδίας του μισθωτή. Δημόσιο κλειδί – και το πλήκτρο υπογραφής από την οποία προέρχεται – είναι η ίδια με εκείνη που χρησιμοποιείται για όλα τα μισθωτές στο Azure AD.

Μπορείτε να βρείτε λεπτομερείς πληροφορίες σε αναστροφής κλειδιού Azure AD στο έγγραφο: [Σημαντικές πληροφορίες σχετικά με την είσοδο κατάδειξη αριθμό-κλειδί στο Azure AD](../active-directory/active-directory-signing-key-rollover.md).

Μεταξύ [δημόσιων-ιδιωτικών ζεύγος κλειδιών](https://login.windows.net/common/discovery/keys/), 

- Το ιδιωτικό κλειδί χρησιμοποιείται από το Azure Active Directory για τη δημιουργία ενός διακριτικού JWT;
- Το δημόσιο κλειδί χρησιμοποιείται από μια εφαρμογή όπως υπηρεσίες παράδοσης άδειας χρήσης DRM στο αθροιστικής μέτρησης ενισχύσεων για να επαληθεύσετε το διακριτικό JWT;
 
Για το σκοπό ασφαλείας, Azure Active Directory Περιστρέφει αυτό το πιστοποιητικό περιοδικά (κάθε 6 εβδομάδες). Σε περίπτωση παραβιάσεις ασφαλείας, το αναστροφής κλειδιού μπορεί να προκύψουν οποιαδήποτε στιγμή. Επομένως, οι υπηρεσίες παράδοσης άδειας χρήσης στο αθροιστικής μέτρησης ενισχύσεων πρέπει να ενημερώσετε το δημόσιο κλειδί που χρησιμοποιούνται ως Azure AD Περιστρέφει το ζεύγος κλειδιών, διαφορετικά θα αποτύχει διακριτικού ελέγχου ταυτότητας σε αθροιστικής μέτρησης ενισχύσεων και θα εκδοθεί χωρίς άδεια χρήσης. 

Αυτό είναι δυνατό, ορίζοντας TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument κατά τη ρύθμιση παραμέτρων υπηρεσιών παράδοσης DRM άδεια χρήσης.

Η ροή διακριτικού JWT είναι ως παρακάτω:

1.  Azure AD θα θεμάτων το διακριτικό JWT με το τρέχον ιδιωτικό κλειδί για ένα χρήστη με έλεγχο ταυτότητας.
2.  Όταν ένα πρόγραμμα αναπαραγωγής εντοπίσει ένα CENC με το περιεχόμενο με προστασία DRM πολλούς, αυτό θα εντοπίσει πρώτα το διακριτικό JWT εκδοθεί από Azure AD.
3.  Το πρόγραμμα αναπαραγωγής στέλνει την αίτηση απόκτηση άδειας χρήσης με το διακριτικό JWT στις υπηρεσίες παράδοσης άδειας χρήσης στο αθροιστικής μέτρησης ενισχύσεων;
4.  Οι υπηρεσίες παράδοσης άδειας χρήσης στο αθροιστικής μέτρησης ενισχύσεων θα χρησιμοποιήσει το τρέχον/έγκυρη δημόσιο κλειδί από Azure AD για να επαληθεύσετε το διακριτικό JWT, πριν από την έκδοση αδειών χρήσης.

Υπηρεσίες παράδοσης άδειας χρήσης DRM πάντα θα τον έλεγχο για το τρέχον/έγκυρη δημόσιο κλειδί από Azure AD. Το δημόσιο κλειδί παρουσίαση από Azure AD θα είναι το κλειδί που χρησιμοποιείται για την επαλήθευση ενός διακριτικού JWT εκδοθεί από Azure AD.

Τι γίνεται εάν το αναστροφής κλειδιού συμβαίνει αφού AAD δημιουργεί ένα διακριτικό JWT αλλά πριν από την JWT διακριτικό αποστέλλεται από προγράμματα αναπαραγωγής DRM άδειας χρήσης υπηρεσίες παράδοσης στο αθροιστικής μέτρησης ενισχύσεων για την επαλήθευση; 

Επειδή ένα κλειδί μπορεί να γίνει επαναφορά ανά πάσα στιγμή, υπάρχει πάντα περισσότερα από ένα έγκυρο κλειδί δημόσια διαθέσιμη στο έγγραφο Ομοσπονδία μετα-δεδομένων. Παράδοση άδειας χρήσης Azure Media Services να χρησιμοποιήσετε οποιοδήποτε από τα πλήκτρα που καθορίζεται στο έγγραφο, επειδή ένα πλήκτρο μπορεί να γίνει επαναφορά σύντομα, μια άλλη μπορεί να είναι το αντικατάστασης, και ούτω καθεξής.

### <a name="where-is-the-access-token"></a>Πού βρίσκεται το διακριτικό πρόσβασης;

Αν κοιτάξετε πώς σε μια εφαρμογή web κλήσεις API εφαρμογής στην περιοχή [Εφαρμογή ταυτότητας με το διακριτικό 2.0 προγράμματος-πελάτη διαπιστευτήρια εκχώρηση](active-directory-authentication-scenarios.md#web-application-to-web-api), η ροή ελέγχου ταυτότητας είναι όπως παρακάτω:

1.  Ένας χρήστης έχει συνδεθεί στη Azure AD στην εφαρμογή web (ανατρέξτε στο θέμα πρόγραμμα [Περιήγησης Web σε εφαρμογή Web](active-directory-authentication-scenarios.md#web-browser-to-web-application).
2.  Το τελικό σημείο εξουσιοδότησης Azure AD ανακατευθύνει παράγοντα χρήστη την εφαρμογή-πελάτη με έναν κωδικό εξουσιοδότησης. Ο παράγοντας χρήστη επιστρέφει κωδικό εξουσιοδότησης URI ανακατεύθυνσης την εφαρμογή-πελάτη.
3.  Η εφαρμογή web πρέπει να αποκτήσετε ένα διακριτικό πρόσβασης, έτσι ώστε να μπορούν να τον έλεγχο ταυτότητας για το API web και να ανακτήσετε την επιθυμητή πόρων. Κάνει μια αίτηση Azure AD διακριτικού τελικό σημείο, παρέχοντας τα διαπιστευτήρια, Αναγνωριστικό υπολογιστή-πελάτη και την εφαρμογή web του API URI Αναγνωριστικό. Παρουσιάζει τον κωδικό εξουσιοδότησης για να αποδείξετε ότι ο χρήστης έχει δεχθεί.
4.  Azure AD πραγματοποιεί έλεγχο ταυτότητας της εφαρμογής και επιστρέφει ένα διακριτικό πρόσβασης JWT που χρησιμοποιείται για να καλέσετε το API web.
5.  Μέσω HTTPS, η εφαρμογή web χρησιμοποιεί το επιστρεφόμενο διακριτικό πρόσβασης JWT για να προσθέσετε τη συμβολοσειρά JWT με ονομασία "Φορέα" στην κεφαλίδα της εξουσιοδότησης της αίτησης για το API στο web. Το API web, στη συνέχεια, επικυρώσει το διακριτικό JWT και εάν η επικύρωση είναι επιτυχής, επιστρέφει την επιθυμητή πόρων.

Σε αυτήν τη ροή "ταυτότητα της εφαρμογής", το API web εμπιστεύεται ότι η εφαρμογή web με έλεγχο ταυτότητας χρήστη. Για αυτόν το λόγο, αυτό το μοτίβο ονομάζεται μια αξιόπιστη υποσυστήματος. Το [διάγραμμα σε αυτήν τη σελίδα](http://msdn.microsoft.com/library/azure/dn645542.aspx/) περιγράφει πώς κωδικό εξουσιοδότησης εκχώρηση works ροής.

Στο απόκτηση άδειας χρήσης με περιορισμό διακριτικού, θα σας ακολουθείτε το ίδιο μοτίβο αξιόπιστων υποσυστήματος. Και η υπηρεσία παράδοσης άδεια χρήσης σε υπηρεσιών Azure Media Services είναι web API πόρο, το "παρασκηνίου πόρου" μιας εφαρμογής web πρέπει να έχετε πρόσβαση. Επομένως, πού βρίσκεται το διακριτικό πρόσβασης;

Στην πραγματικότητα, θα σας απόκτηση διακριτικό πρόσβασης από το Azure AD. Μετά την επιτυχή χρήστη τον έλεγχο ταυτότητας, επιστρέφεται κωδικό εξουσιοδότησης. Ο κωδικός εξουσιοδότησης, στη συνέχεια, χρησιμοποιείται, μαζί με το κλειδί Αναγνωριστικό και εφαρμογή προγράμματος-πελάτη, για την ανταλλαγή για το διακριτικό πρόσβασης. Και το διακριτικό πρόσβασης για πρόσβαση σε μια εφαρμογή "δείκτης" κατεύθυνση ή που αντιπροσωπεύει την υπηρεσία παράδοσης άδεια χρήσης των υπηρεσιών Azure Media Services.

Πρέπει να καταχωρήσετε και ρύθμιση παραμέτρων της εφαρμογής "δείκτης" στο Azure AD, ακολουθώντας τα παρακάτω βήματα:

1.  Azure AD μισθωτή

    - Προσθήκη μιας εφαρμογής (πόρος) με τη σύνδεση διεύθυνση URL: 

    https://[resource_name].azurewebsites.NET/ και 

    - εφαρμογή Αναγνωριστικό διεύθυνσης URL: 
    
    https://[aad_tenant_name].onmicrosoft.com/[resource_name]; 
2.  Προσθήκη νέου αριθμού-κλειδιού για την εφαρμογή πόρων;
3.  Ενημέρωση του αρχείου δήλωσης εφαρμογή, έτσι ώστε η ιδιότητα groupMembershipClaims έχει την ακόλουθη τιμή: "groupMembershipClaims": "Όλα",  
4.  Στην εφαρμογή Azure AD που δείχνει προς το πρόγραμμα αναπαραγωγής web app, στην ενότητα "δικαιωμάτων σε άλλες εφαρμογές", προσθέστε την εφαρμογή πόρων που προστέθηκε στο παραπάνω βήμα 1. Στην περιοχή "δικαιώματα πληρεξούσιου", επιλέξτε "Access [resource_name]" σημάδι ελέγχου. Αυτό σας δίνει το δικαίωμα του web app για να δημιουργήσετε διακριτικά πρόσβασης για να αποκτήσετε πρόσβαση στην εφαρμογή πόρων. Θα πρέπει να κάνετε αυτό για την έκδοση της εφαρμογής web τοπικούς και ανεπτυγμένος Εάν κάνετε ανάπτυξη με το Visual Studio και το Azure web app.
    
Επομένως, το διακριτικό JWT εκδοθεί από Azure AD είναι στην πραγματικότητα το διακριτικό πρόσβασης για την πρόσβαση σε αυτόν τον πόρο "δείκτης".

### <a name="what-about-live-streaming"></a>Τι γίνεται με ζωντανή ροή;

Στα παραπάνω μας συζήτησης έχει εστιάζοντας στα στοιχεία σε ζήτηση. Τι γίνεται με live ροή;

Τα καλά νέα είναι ότι μπορείτε να χρησιμοποιήσετε ακριβώς το ίδιο σχεδίαση και υλοποίηση για την προστασία των ζωντανή ροή σε υπηρεσίες πολυμέσων Azure, θεωρώντας το περιουσιακών στοιχείων που σχετίζονται με ένα πρόγραμμα ως "Πάγιο VOD".

Συγκεκριμένα, είναι γνωστό ότι για να το κάνετε ζωντανή ροή δεδομένων στις υπηρεσίες πολυμέσων Azure, πρέπει να δημιουργήσετε ένα κανάλι, στη συνέχεια, ένα πρόγραμμα στην περιοχή του καναλιού. Για να δημιουργήσετε το πρόγραμμα, χρειάζεστε για τη δημιουργία περιουσιακού στοιχείου που θα περιέχει το πραγματικό αρχείο για το πρόγραμμα. Προκειμένου να παρέχετε CENC με πολλούς DRM προστασία του live περιεχομένου, μόνο που πρέπει να κάνετε, είναι να εφαρμόσετε την ίδια ρύθμιση/επεξεργασία στο πάγιο σαν να ήταν ένα "περιουσιακών στοιχείων VOD" πριν από την εκκίνηση του προγράμματος.

### <a name="what-about-license-servers-outside-of-azure-media-services"></a>Τι γίνεται με διακομιστές αδειών χρήσης εκτός των υπηρεσιών Azure Media Services;

Συχνά, οι πελάτες μπορεί να έχουν επενδυθεί άδειας χρήσης συμπλέγματος διακομιστών είτε στο δικό τους δεδομένων στοίχιση στο κέντρο ή φιλοξενούνται από τις υπηρεσίες παροχής DRM. Ευτυχώς, προστασία περιεχομένου υπηρεσίες πολυμέσων Azure σάς επιτρέπει να λειτουργεί σε υβριδική λειτουργία: περιεχόμενα φιλοξενούνται και δυναμικά προστατεύονται στο των υπηρεσιών Azure Media Services, ενώ θα παραδίδονται DRM άδειες χρήσης από τους διακομιστές εκτός των υπηρεσιών Azure Media Services. Σε αυτήν την περίπτωση, υπάρχουν τα παρακάτω ζητήματα με τις αλλαγές:

1. Η υπηρεσία διακριτικού ασφαλούς πρέπει να θεμάτων διακριτικά που είναι αποδεκτές και μπορεί να επαληθευτεί από τη συστοιχία διακομιστών άδεια χρήσης. Για παράδειγμα, οι διακομιστές αδειών χρήσης Widevine που παρέχεται από Axinom απαιτεί ένα συγκεκριμένο διακριτικό JWT που περιέχει "δικαίωμα μήνυμα". Επομένως, πρέπει να έχετε μια STS για την έκδοση όπως διακριτικό JWT. Οι συντάκτες έχουν ολοκληρωθεί όπως μια εφαρμογή και μπορείτε να βρείτε τις λεπτομέρειες του ακόλουθου εγγράφου στο [Κέντρο τεκμηρίωση Azure](https://azure.microsoft.com/documentation/): [Χρήση Axinom για παράδοση Widevine άδειες χρήσης των υπηρεσιών Azure Media Services](media-services-axinom-integration.md). 
1. Δεν χρειάζεται πλέον να ρυθμίσετε τις παραμέτρους υπηρεσία παράδοσης αδειών χρήσης (ContentKeyAuthorizationPolicy) στο υπηρεσιών Azure Media Services. Τι πρέπει να κάνετε είναι για την παροχή της άδειας χρήσης διευθύνσεις URL acquisition (PlayReady, Widevine και FairPlay) όταν ρυθμίζετε τις παραμέτρους AssetDeliveryPolicy στη ρύθμιση CENC με πολλούς DRM.
 
### <a name="what-if-i-want-to-use-a-custom-sts"></a>Τι γίνεται εάν θέλετε να χρησιμοποιήσετε ένα προσαρμοσμένο STS;

Ενδέχεται να υπάρχουν Μερικοί λόγοι που ένας πελάτης μπορεί να επιλέξετε να χρησιμοποιήσετε ένα προσαρμοσμένο STS (διακριτικού υπηρεσία ασφαλούς) για την παροχή διακριτικά JWT. Ορισμένες από αυτές είναι οι εξής:

1.  Η ταυτότητα παροχής (IDP) χρησιμοποιείται από τον πελάτη δεν υποστηρίζει STS. Σε αυτήν την περίπτωση μια προσαρμοσμένη STS μπορεί να είναι μια επιλογή.
2.  Ο πελάτης μπορεί να χρειαστεί πιο ευέλικτο ή μεγαλύτερη στοιχείο ελέγχου σε ενοποίηση STS με χρέωση συστήματος συνδρομητής του πελάτη. Για παράδειγμα, έναν τελεστή MVPD ενδέχεται να προσφέρουν πολλές πακέτων συνδρομητών OTT όπως premium, βασικές sports, κ.λπ. Τον τελεστή μπορεί να θέλετε να συμφωνεί με το αξιώσεων σε ένα διακριτικό με το πακέτο του συνδρομητής, έτσι ώστε μόνο τα περιεχόμενα στο δεξιό πακέτο έχει κάνει διαθέσιμες. Σε αυτήν την περίπτωση, μια προσαρμοσμένη STS παρέχει τις απαραίτητες ευελιξία και στοιχείο ελέγχου.

Δύο αλλαγές πρέπει να γίνουν κατά τη χρήση μιας προσαρμοσμένης STS:

1.  Κατά τη ρύθμιση υπηρεσία παράδοσης άδειας χρήσης για ενός περιουσιακού στοιχείου, πρέπει να ορίσετε το κλειδί ασφαλείας που χρησιμοποιούνται για την επαλήθευση από το προσαρμοσμένο STS (περισσότερες λεπτομέρειες παρακάτω) αντί για το τρέχον κλειδί από το Azure Active Directory.
2.  Όταν δημιουργείτε ένα διακριτικό JTW, ένα κλειδί ασφαλείας έχει καθοριστεί αντί για το ιδιωτικό κλειδί από την τρέχουσα X509 πιστοποιητικό στο Azure Active Directory.

Υπάρχουν δύο τύποι κλειδιά ασφαλείας:

1.  Συμμετρική κλειδί: το ίδιο κλειδί χρησιμοποιείται για το δημιουργό και επαλήθευση ενός διακριτικού JWT;
2.  Ασύμμετρη κλειδί: ζεύγος δημόσιου-ιδιωτικού κλειδιού σε ένα πιστοποιητικό χρησιμοποιείται με ιδιωτικό κλειδί για την κρυπτογράφηση/δημιουργία ενός διακριτικού JWT και το δημόσιο κλειδί για την επαλήθευση το διακριτικό X509.

####<a name="tech-note"></a>Τεχνική σημείωση

Εάν χρησιμοποιείτε το .NET Framework / C# ως την πλατφόρμα ανάπτυξης, X509 το πιστοποιητικό που χρησιμοποιείται για το κλειδί ασύμμετρη ασφαλείας πρέπει να έχει μήκος τουλάχιστον 2048 κλειδιού. Αυτή είναι μια απαίτηση της κλάσης System.IdentityModel.Tokens.X509AsymmetricSecurityKey στο .NET Framework. Διαφορετικά, το παρακάτω θα είναι εξαίρεση:

IDX10630: Το 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' για την υπογραφή δεν μπορεί να είναι μικρότερο από '2048' bit. 

## <a name="the-completed-system-and-test"></a>Το ολοκληρωμένο σύστημα και έλεγχος

Θα θα καθοδηγήσουμε ορισμένα σενάρια στο σύστημα του ολοκληρωμένη σε ολοκληρωμένες, έτσι ώστε οι αναγνώστες να έχουν μια βασική "εικόνα" της συμπεριφοράς πριν από τη λήψη ενός λογαριασμού σύνδεσης.

Μπορείτε να βρείτε την εφαρμογή web του προγράμματος αναπαραγωγής και τη σύνδεση [εδώ](https://openidconnectweb.azurewebsites.net/).

Εάν αυτό που χρειάζεστε είναι "μη ολοκληρωμένη" σενάριο: βίντεο περιουσιακών στοιχείων που φιλοξενούνται στο υπηρεσιών Azure Media Services που είτε είναι προστατευμένο ή προστατευμένο DRM αλλά χωρίς έλεγχο ταυτότητας διακριτικού (έκδοσης μιας άδειας χρήσης για να όποιος ζητήσει), μπορείτε να την ελέγξετε χωρίς σύνδεση (, μεταβαίνοντας σε HTTP στην περίπτωση που το ροή βίντεο μέσω HTTP).

Εάν ό, τι χρειάζεστε είναι ενσωματωμένη σε ολοκληρωμένες σενάριο: βίντεο παγίων βρίσκεται στην περιοχή δυναμική προστασία DRM στο των υπηρεσιών Azure Media Services, με έλεγχο ταυτότητας διακριτικού και JWT διακριτικό που δημιουργείται από Azure AD, χρειάζεται να συνδεθείτε.

### <a name="user-login"></a>Σύνδεση χρήστη

Για να εξετάσετε το ολοκληρωμένο σύστημα DRM για ολοκληρωμένες, πρέπει να έχετε μια "Λογαριασμός" δημιουργηθεί ή έχουν προστεθεί. 

Ποιο λογαριασμό;

Παρόλο που Azure αρχικά επιτρέπεται η πρόσβαση μόνο από χρήστες λογαριασμό Microsoft, επιτρέπει πλέον πρόσβαση από χρήστες από δύο συστήματα. Αυτό έγινε με αντιμετωπίζετε όλα τα Azure ιδιότητες αξιοπιστίας Azure AD για έλεγχο ταυτότητας, έχοντας Azure AD τον έλεγχο ταυτότητας οι χρήστες του οργανισμού, και με τη δημιουργία μιας σχέσης Ομοσπονδία όπου Azure AD εμπιστεύεται το σύστημα ταυτότητας καταναλωτή του Microsoft λογαριασμού για τον έλεγχο ταυτότητας χρήστες λιανικής πώλησης. Ως αποτέλεσμα, Azure AD είναι δυνατός λογαριασμούς Microsoft "επισκέπτες", καθώς και "εγγενής" Λογαριασμοί Azure AD.

Επειδή το Azure AD εμπιστεύεται τομέα λογαριασμό Microsoft (MSA), μπορείτε να προσθέσετε οποιοδήποτε λογαριασμοί από οποιονδήποτε από τους παρακάτω τομείς για την προσαρμοσμένη Azure AD μισθωτή και χρησιμοποιήστε το λογαριασμό για να συνδεθείτε:

**Το όνομα του τομέα**|**Τομέα**
-----------|----------
**Προσαρμοσμένη Azure AD μισθωτή τομέα**|somename.onmicrosoft.com
**Εταιρικό τομέα**|Microsoft.com
**Τομέα λογαριασμό Microsoft (MSA)**|Outlook.com, live.com, hotmail.com

Μπορείτε να επικοινωνήσετε με οποιονδήποτε από τους συντάκτες να έχετε ένα λογαριασμό δημιουργηθεί ή έχουν προστεθεί για εσάς. 

Παρακάτω παρατίθενται τα στιγμιότυπα οθόνης σε διαφορετικές σελίδες σύνδεσης χρησιμοποιούνται από λογαριασμούς διαφορετικό τομέα.

**Προσαρμοσμένο Azure λογαριασμού τομέα μισθωτή AD**: σε αυτήν την περίπτωση, εμφανίζεται η σελίδα προσαρμοσμένων login από τα προσαρμοσμένα Azure AD μισθωτή του τομέα.

![Προσαρμοσμένη Azure AD μισθωτή τομέα λογαριασμού](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain1.png)

**Λογαριασμός Microsoft τομέα με έξυπνη κάρτα**: σε αυτήν την περίπτωση εμφανίζεται η σελίδα login προσαρμόσει από τη Microsoft εταιρικό IT με έλεγχο ταυτότητας δύο παραγόντων.

![Προσαρμοσμένη Azure AD μισθωτή τομέα λογαριασμού](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain2.png)

**Λογαριασμός Microsoft (MSA)**: σε αυτήν την περίπτωση, μπορείτε να δείτε τη σελίδα σύνδεσης του λογαριασμού Microsoft για τους καταναλωτές.

![Προσαρμοσμένη Azure AD μισθωτή τομέα λογαριασμού](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain3.png)

### <a name="using-encrypted-media-extensions-for-playready"></a>Χρήση κρυπτογραφημένης Media επεκτάσεις για PlayReady

Σε ένα σύγχρονο πρόγραμμα περιήγησης με το επεκτάσεις κρυπτογραφημένα πολυμέσων (EME) για την υποστήριξη PlayReady, όπως 11 IE στα Windows 8.1 και προς τα επάνω και το πρόγραμμα περιήγησης Microsoft Edge στα Windows 10, PlayReady θα είναι το υποκείμενο DRM για EME.

![Χρήση EME για PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready1.png)

Η περιοχή σκούρο player είναι οφείλεται στο γεγονός ότι PlayReady προστασία δεν επιτρέπει μία πραγματοποίηση καταγραφής οθόνης προστατευμένο βίντεο από. 

Η παρακάτω οθόνη δείχνει το πρόγραμμα αναπαραγωγής προσθηκών και MSE/EME υποστήριξης.

![Χρήση EME για PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready2.png)

EME στο Microsoft Edge και 11 IE στα Windows 10 επιτρέπει την κλήση του [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) σε συσκευές με Windows 10 που υποστηρίζει. PlayReady SL3000 ξεκλειδώνονται διαθέτει τη ροή περιεχομένου βελτιωμένη premium (4K, HDR, κ.λπ.) και τα νέα μοντέλα παράδοσης περιεχομένου (πρώιμη παράθυρο εμπλουτισμένου περιεχομένου).

Εστίαση στις συσκευές των Windows: PlayReady είναι το μόνο DRM στο το Διμερή διαθέσιμα σε συσκευές των Windows (PlayReady SL3000). Ροή υπηρεσίας να χρησιμοποιήσετε PlayReady μέσω EME ή μέσω μιας εφαρμογής UWP και να προσφέρουν μια υψηλότερη ποιότητα βίντεο χρησιμοποιώντας PlayReady SL3000 από μια άλλη DRM. Συνήθως, 2K περιεχόμενο ροή του Chrome ή Firefox και 4K περιεχομένου μέσω του Microsoft Edge/IE11 ή σε μια εφαρμογή UWP στην ίδια συσκευή (ανάλογα με τις ρυθμίσεις υπηρεσίας και υλοποίηση).


#### <a name="using-eme-for-widevine"></a>Χρήση EME για Widevine

Σε ένα πρόγραμμα περιήγησης σύγχρονο με την υποστήριξη του EME/Widevine, όπως το Chrome 41 + σε Windows 10, Windows 8.1, Mac OSX Yosemite και το Chrome σε Android 4.4.4, Google Widevine είναι το DRM πίσω από EME.

![Χρήση EME για Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine1.png)

Παρατηρήστε ότι Widevine δεν εμποδίζει ένα πραγματοποίηση καταγραφής οθόνης προστατευμένο βίντεο από.

![Χρήση EME για Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine2.png)

### <a name="not-entitled-users"></a>Οι χρήστες δεν δικαιούνται

Εάν ένας χρήστης δεν είναι μέλος της ομάδας "Χρήστες με τίτλο", ο χρήστης δεν θα μπορούν να μεταβιβάζουν "δικαίωμα ελέγχου" και την υπηρεσία άδειας χρήσης πολλών DRM θα αρνηθεί την έκδοση της ζητήθηκε άδειας χρήσης, όπως φαίνεται παρακάτω. Είναι τα λεπτομερή περιγραφή "απόκτηση άδειας χρήσης απέτυχε", που είναι όπως έχει σχεδιαστεί.

![Δικαιούνται κατάργησης χρηστών](./media/media-services-cenc-with-multidrm-access-control/media-services-unentitledusers.png)

### <a name="running-custom-secure-token-service"></a>Εκτέλεση προσαρμοσμένης διακριτικού υπηρεσία ασφαλούς

Για το σενάριο που εκτελούνται προσαρμοσμένο ασφαλούς διακριτικού υπηρεσίας (STS), το διακριτικό JWT θα εκδοθεί από το προσαρμοσμένο STS χρήση αριθμού-κλειδιού συμμετρική ή ασύμμετρη. 

Περίπτωση χρήσης συμμετρική αριθμού-κλειδιού (χρησιμοποιώντας Chrome):

![Εκτέλεση προσαρμοσμένης STS](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts1.png)

Περίπτωση χρήσης ασύμμετρη κλειδί μέσω ενός X509 πιστοποιητικού (χρησιμοποιώντας το Microsoft σύγχρονο προγράμματος περιήγησης).

![Εκτέλεση προσαρμοσμένης STS](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts2.png)

Και στις δύο παραπάνω περιπτώσεις, τον έλεγχο ταυτότητας χρήστη παραμένει ίδια – μέσω Azure AD. Η μόνη διαφορά είναι ότι τα διακριτικά JWT εκδίδονται από το προσαρμοσμένο STS αντί για το Azure AD. Φυσικά, όταν ρυθμίζετε τις παραμέτρους δυναμικής προστασίας CENC, τον περιορισμό της άδειας χρήσης υπηρεσία παράδοσης καθορίζει τον τύπο του JWT διακριτικό, συμμετρική ή ασύμμετρη κλειδί.

## <a name="summary"></a>Σύνοψη

Σε αυτό το έγγραφο, είπαμε CENC με πολλών native DRM και ο έλεγχος πρόσβασης μέσω διακριτικού ελέγχου ταυτότητας: το σχεδιασμό και την εφαρμογή με Azure, των υπηρεσιών Azure Media Services και το πρόγραμμα αναπαραγωγής πολυμέσων Azure.

- Μια αναφορά σχεδίαση παρουσιάζονται που περιέχει όλα τα απαραίτητα στοιχεία σε μια υποσυστήματος DRM/CENC.
- Μια αναφορά υλοποίηση Azure, των υπηρεσιών Azure Media Services και Azure Media Player.
- Επίσης περιγράφονται ορισμένα θέματα απευθείας που περιλαμβάνονται στη σχεδίαση και στην εφαρμογή.


##<a name="media-services-learning-paths"></a>Διαδικασίες εκμάθησης Media Services

[AZURE.INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

##<a name="provide-feedback"></a>Παροχή σχολίων

[AZURE.INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

###<a name="acknowledgments"></a>Επιβεβαίωση 

Γουίλιαμ Zhang, Mingfei Yan, Χρήστος Le φράγκο, Kilroy Hughes, Julia Kornich
