<properties 
    pageTitle="Ενημέρωση των υπηρεσιών πολυμέσων μετά τη σάρωση πλήκτρα πρόσβασης χώρου αποθήκευσης | Microsoft Azure" 
    description="Αυτό το άρθρο σάς παρέχουν οδηγίες σχετικά με τον τρόπο για να ενημερώσετε τις υπηρεσίες πολυμέσων μετά τη σάρωση πλήκτρα πρόσβασης χώρου αποθήκευσης." 
    services="media-services" 
    documentationCenter="" 
    authors="Juliako"
    manager="erikre" 
    editor=""/>

<tags 
    ms.service="media-services" 
    ms.workload="media" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="09/26/2016" 
    ms.author="milangada;cenkdin;juliako"/>

#<a name="update-media-services-after-rolling-storage-access-keys"></a>Υπηρεσίες πολυμέσων ενημέρωση μετά τη σάρωση πλήκτρα πρόσβασης χώρου αποθήκευσης

Όταν δημιουργείτε ένα νέο λογαριασμό των υπηρεσιών Azure Media Services, σας ζητείται να επιλέξετε ένα λογαριασμό αποθήκευσης Azure που χρησιμοποιείται για την αποθήκευση του περιεχομένου πολυμέσων. Σημειώστε ότι μπορείτε να [προσθέσετε περισσότερους από έναν λογαριασμούς χώρου αποθήκευσης](meda-services-managing-multiple-storage-accounts.md) στο λογαριασμό σας Media Services.

Όταν δημιουργείται το νέο λογαριασμό του χώρου αποθήκευσης, Azure δημιουργεί δύο πλήκτρα πρόσβασης 512 bit χώρου αποθήκευσης, που χρησιμοποιούνται για τον έλεγχο ταυτότητας πρόσβαση στο λογαριασμό σας χώρου αποθήκευσης. Για να διατηρήσετε τις συνδέσεις του χώρου αποθήκευσης σας πιο ασφαλή, συνιστάται να περιοδικά αναδημιουργήσετε και περιστροφή κλειδιού πρόσβασης χώρου αποθήκευσης. Παρέχονται δύο πλήκτρα πρόσβασης (κύριας και δευτερεύουσας) προκειμένου να δίνουν τη δυνατότητα να διατηρείτε συνδέσεις με το λογαριασμό χώρου αποθήκευσης, χρησιμοποιώντας ένα πλήκτρο πρόσβασης, ενώ μπορείτε να αναδημιουργήσετε το άλλο πλήκτρο πρόσβασης. Αυτή η διαδικασία ονομάζεται επίσης "συνάθροισης πλήκτρα πρόσβασης".

Υπηρεσίες πολυμέσων εξαρτάται από έναν αριθμό-κλειδί χώρου αποθήκευσης που παρέχονται σε αυτήν. Συγκεκριμένα, η locators που χρησιμοποιούνται για τη ροή ή λήψη τους πόρους σας εξαρτώνται από το πλήκτρο πρόσβασης καθορισμένο χώρου αποθήκευσης. Όταν δημιουργείται ένας λογαριασμός αθροιστικής μέτρησης ενισχύσεων παίρνει εξάρτησης το κλειδί πρόσβασης πρωτεύοντος αποθήκευσης από προεπιλογή αλλά ως χρήστης, μπορείτε να ενημερώσετε το κλειδί αποθήκευσης που έχει αθροιστικής μέτρησης ενισχύσεων. Θα πρέπει να βεβαιωθείτε ότι για να επιτρέψετε σε υπηρεσίες πολυμέσων που γνωρίζετε ποιες κλειδιού για να χρησιμοποιήσετε ακολουθώντας τα βήματα που περιγράφονται σε αυτό το θέμα. Επίσης, όταν σάρωση πλήκτρα πρόσβασης χώρου αποθήκευσης, πρέπει να βεβαιωθείτε ότι για να ενημερώσετε το locators επομένως, θα υπάρχει καμία διακοπή στην υπηρεσία ροής (αυτό το βήμα περιγράφεται επίσης στο θέμα).

>[AZURE.NOTE]Εάν έχετε πολλούς λογαριασμούς χώρου αποθήκευσης, θα μπορείτε να εκτελέσετε αυτήν τη διαδικασία με κάθε λογαριασμό χώρου αποθήκευσης.
>
>Πριν από την εκτέλεση βήματα που περιγράφονται σε αυτό το θέμα σε ένα λογαριασμό παραγωγής, φροντίστε να ελέγξετε τους σε ένα λογαριασμό προ-παραγωγής.


## <a name="step-1-regenerate-secondary-storage-access-key"></a>Βήμα 1: Αναδημιουργήσετε πλήκτρο πρόσβασης δευτερεύοντα χώρου αποθήκευσης

Ξεκινήστε με αναδημιουργία χώρο αποθήκευσης στο δευτερεύον κλειδί. Από προεπιλογή, το δευτερεύον κλειδί δεν χρησιμοποιείται από το Media Services.  Για πληροφορίες σχετικά με τον τρόπο για να ρίξετε πλήκτρα χώρου αποθήκευσης, ανατρέξτε στο θέμα [Τρόπος: προβολή, αντιγραφή και regenerate χώρου αποθήκευσης, πρόσβαση πλήκτρα](../storage-create-storage-account.md#view-copy-and-regenerate-storage-access-keys).
  
##<a id="step2"></a>Βήμα 2: Ενημέρωση Media Services για να χρησιμοποιήσετε το νέο κλειδί δευτερεύοντα χώρου αποθήκευσης

Ενημέρωση των υπηρεσιών πολυμέσων για να χρησιμοποιήσετε το πλήκτρο πρόσβασης δευτερεύοντα χώρου αποθήκευσης. Μπορείτε να χρησιμοποιήσετε μία από τις ακόλουθες δύο μεθόδους για να συγχρονίσετε το κλειδί δημιουργηθεί ξανά αποθήκευσης με τις υπηρεσίες πολυμέσων.

- Χρησιμοποιήστε την πύλη του Azure: για να βρείτε το όνομα και το κλειδί τιμές, μεταβείτε στην πύλη του Azure και επιλέξτε το λογαριασμό σας. Εμφανίζεται το παράθυρο διαλόγου ρυθμίσεις στα δεξιά. Στο παράθυρο "Ρυθμίσεις", επιλέξτε κλειδιά. Ανάλογα με το ποια κλειδί χώρου αποθήκευσης που θέλετε για τις υπηρεσίες πολυμέσων για συγχρονισμό με, επιλέξτε το πρωτεύον κλειδί συγχρονισμός ή δευτερεύον κλειδί κουμπί συγχρονισμός. Σε αυτήν την περίπτωση, χρησιμοποιήστε το δευτερεύον κλειδί.

- Χρησιμοποιήστε τη Διαχείριση Media Services REST API.

Το ακόλουθο παράδειγμα κώδικα δείχνει πώς μπορείτε να δημιουργήσετε το https://endpoint/***subscriptionId/υπηρεσίες/mediaservices/λογαριασμούς/όνομα λογαριασμού*/StorageAccounts/*storageAccountName*/Key αίτηση για να συγχρονίσετε το κλειδί καθορισμένο αποθήκευσης με τις υπηρεσίες πολυμέσων. Σε αυτήν την περίπτωση, χρησιμοποιείται η τιμή του κλειδιού δευτερεύοντα χώρου αποθήκευσης. Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [ΔΙΑΔΙΚΑΣΙΕΣ: χρήση πολυμέσων υπηρεσίες διαχείρισης REST API](http://msdn.microsoft.com/library/azure/dn167656.aspx).
    
    public void UpdateMediaServicesWithStorageAccountKey(string mediaServicesAccount, string storageAccountName, string storageAccountKey)
    {
        var clientCert = GetCertificate(CertThumbprint);
        
        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(string.Format("{0}/{1}/services/mediaservices/Accounts/{2}/StorageAccounts/{3}/Key",
        Endpoint, SubscriptionId, mediaServicesAccount, storageAccountName));
        request.Method = "PUT";
        request.ContentType = "application/json; charset=utf-8";
        request.Headers.Add("x-ms-version", "2011-10-01");
        request.Headers.Add("Accept-Encoding: gzip, deflate");
        request.ClientCertificates.Add(clientCert);
        
        
        using (var streamWriter = new StreamWriter(request.GetRequestStream()))
        {
            streamWriter.Write("\"");
            streamWriter.Write(storageAccountKey);
            streamWriter.Write("\"");
            streamWriter.Flush();
        }
        
        using (var response = (HttpWebResponse)request.GetResponse())
        {
            string jsonResponse;
            Stream receiveStream = response.GetResponseStream();
            Encoding encode = Encoding.GetEncoding("utf-8");
            if (receiveStream != null)
            {
                var readStream = new StreamReader(receiveStream, encode);
                jsonResponse = readStream.ReadToEnd();
            }
        }
    }

Μετά από αυτό το βήμα, Ενημέρωση υπάρχουσας locators (που έχει εξάρτηση από το παλιό κλειδί αποθήκευσης), όπως φαίνεται στο ακόλουθο βήμα.

>[AZURE.NOTE]Περιμένετε 30 λεπτά πριν να εκτελέσετε οποιαδήποτε λειτουργίες με τις υπηρεσίες πολυμέσων (για παράδειγμα, τη δημιουργία νέας locators) για να αποτρέψετε οποιαδήποτε επίδραση σε εκκρεμείς εργασίες.

##<a name="step-3-update-locators"></a>Βήμα 3: Ενημέρωση locators

>[AZURE.NOTE]Όταν σάρωση πλήκτρα πρόσβασης χώρου αποθήκευσης, πρέπει να βεβαιωθείτε ότι για να ενημερώσετε το υπάρχον locators, επομένως δεν υπάρχει καμία διακοπή στην υπηρεσία ροής.

Περιμένετε τουλάχιστον 30 λεπτά μετά από το συγχρονισμό το νέο κλειδί χώρου αποθήκευσης με αθροιστικής μέτρησης ενισχύσεων. Στη συνέχεια, μπορείτε να δημιουργήσετε ξανά το locators OnDemand να διαρκέσει εξάρτηση στο χώρο αποθήκευσης στο καθορισμένο κλειδί και να διατηρήσετε την υπάρχουσα διεύθυνση URL.

Σημειώστε ότι όταν ενημερώνετε (ή δημιουργήστε ξανά) ένα προσδιοριστικό συσχετισμών Ασφαλείας, τη διεύθυνση URL θα πάντα να αλλάξετε.

>[AZURE.NOTE] Για να βεβαιωθείτε ότι μπορείτε να διατηρήσετε την υπάρχουσα διευθύνσεις URL των σας locators OnDemand, πρέπει να διαγράψετε το υπάρχον αρχείο εντοπισμού και δημιουργήστε ένα νέο με το ίδιο αναγνωριστικό.

Το παρακάτω παράδειγμα .NET δείχνει πώς μπορείτε να δημιουργήσετε ξανά ένα προσδιοριστικό με το ίδιο αναγνωριστικό.

ιδιωτική στατική ILocator RecreateLocator(CloudMediaContext context, ILocator locator) {/ / αποθήκευση ιδιότητες του υπάρχοντος προσδιοριστικό.
VAR περιουσιακών στοιχείων = προσδιοριστικό. Περιουσιακών στοιχείων; VAR accessPolicy = προσδιοριστικό. AccessPolicy; VAR locatorId = προσδιοριστικό. Αναγνωριστικό. VAR ΗμερομηνίαΈναρξης = προσδιοριστικό. Ώρα έναρξης; VAR locatorType = προσδιοριστικό. Πληκτρολογήστε; VAR locatorName = προσδιοριστικό. Όνομα.

Διαγράψτε το παλιό προσδιοριστικό.
προσδιοριστικό. Delete();

Εάν (προσδιοριστικό. ExpirationDateTime < = DateTime.UtcNow) {Δημιουργήστε νέα εξαίρεση (String.Format ("δεν είναι δυνατό να αναδημιουργήσετε προσδιοριστικό αναγνωριστικό = {0} επειδή το χρόνο λήξης της προσδιοριστικό ανήκει στο παρελθόν", προσδιοριστικό. Αναγνωριστικό)). }
    
        // Create new locator using saved properties.
        var newLocator = context.Locators.CreateLocator(
            locatorId,
            locatorType,
            asset,
            accessPolicy,
            startDate,
            locatorName);
    
    
    
        return newLocator;
    }


##<a name="step-5-regenerate--primary-storage-access-key"></a>Βήμα 5: Αναδημιουργήσετε πλήκτρο πρόσβασης πρωτεύοντος χώρου αποθήκευσης

Αναδημιουργήσετε το κλειδί πρόσβασης πρωτεύοντος αποθήκευσης. Για πληροφορίες σχετικά με τον τρόπο για να ρίξετε πλήκτρα χώρου αποθήκευσης, ανατρέξτε στο θέμα [Τρόπος: προβολή, αντιγραφή και regenerate χώρου αποθήκευσης, πρόσβαση πλήκτρα](../storage-create-storage-account.md#view-copy-and-regenerate-storage-access-keys).

##<a name="step-6-update-media-services-to-use-the-new-primary-storage-key"></a>Βήμα 6: Ενημέρωση Media Services για να χρησιμοποιήσετε το νέο κλειδί πρωτεύοντος χώρου αποθήκευσης
    
Χρησιμοποιήστε την ίδια διαδικασία όπως περιγράφεται στο [βήμα 2](media-services-roll-storage-access-keys.md#step2) μόνο αυτήν τη φορά συγχρονίσετε το νέο κλειδί πρόσβασης πρωτεύοντος χώρου αποθήκευσης με το λογαριασμό Media Services.

>[AZURE.NOTE]Περιμένετε 30 λεπτά πριν να εκτελέσετε οποιαδήποτε λειτουργίες με τις υπηρεσίες πολυμέσων (για παράδειγμα, τη δημιουργία νέας locators) για να αποτρέψετε οποιαδήποτε επίδραση σε εκκρεμείς εργασίες.

##<a name="step-7-update-locators"></a>Βήμα 7: Ενημέρωση locators  

Έπειτα από 30 λεπτά μπορείτε να δημιουργήσετε ξανά το locators OnDemand να διαρκέσει εξάρτηση στο νέο κλειδί πρωτεύοντος χώρου αποθήκευσης και να διατηρήσετε την υπάρχουσα διεύθυνση URL.

Χρησιμοποιήστε την ίδια διαδικασία που περιγράφεται στο [βήμα 3](media-services-roll-storage-access-keys.md#step-3-update-locators).


##<a name="media-services-learning-paths"></a>Διαδικασίες εκμάθησης Media Services

[AZURE.INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

##<a name="provide-feedback"></a>Παροχή σχολίων

[AZURE.INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]



###<a name="acknowledgments"></a>Επιβεβαίωση 

Προτείνεται να αποδεχτείτε τα ακόλουθα άτομα που συνεισφέρει για τη δημιουργία αυτού του εγγράφου: Cenk Dingiloglu, Gada Μιλάνου, Seva Titov.
