<properties 
    pageTitle="Azure Media Services κατακερματισμένα MP4 live ingest προδιαγραφή | Microsoft Azure" 
    description="Προδιαγραφή αυτό περιγράφει το πρωτόκολλο και τη μορφή για κατακερματιστεί MP4 βάσει ζωντανή ροή κατάποσης για το Microsoft Azure Media Services. Υπηρεσίες πολυμέσων Azure της Microsoft παρέχει ζωντανή ροή υπηρεσία η οποία επιτρέπει στους πελάτες να ροή ζωντανά συμβάντα και μετάδοση περιεχομένου σε πραγματικό χρόνο με χρήση του Microsoft Azure ως την πλατφόρμα cloud. Αυτό το έγγραφο περιγράφει επίσης βέλτιστες πρακτικές κατά τη δημιουργία ιδιαίτερα πλεονάζοντα και ισχυρό live ingest μηχανισμούς." 
    services="media-services" 
    documentationCenter="" 
    authors="cenkdin" 
    manager="erikre" 
    editor=""/>

<tags 
    ms.service="media-services" 
    ms.workload="media" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="09/26/2016"     
    ms.author="cenkdin;juliako"/>

#<a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a>Azure Media Services κατακερματισμένα MP4 live ingest προδιαγραφή

Προδιαγραφή αυτό περιγράφει το πρωτόκολλο και τη μορφή για κατακερματιστεί MP4 βάσει ζωντανή ροή κατάποσης για το Microsoft Azure Media Services. Υπηρεσίες πολυμέσων Azure της Microsoft παρέχει ζωντανή ροή υπηρεσία η οποία επιτρέπει στους πελάτες να ροή ζωντανά συμβάντα και μετάδοση περιεχομένου σε πραγματικό χρόνο με χρήση του Microsoft Azure ως την πλατφόρμα cloud. Αυτό το έγγραφο περιγράφει επίσης βέλτιστες πρακτικές κατά τη δημιουργία ιδιαίτερα πλεονάζοντα και ισχυρό live ingest μηχανισμούς.


##<a name="1-conformance-notation"></a>1. σημειογραφία συμμόρφωσης με

Τις λέξεις-κλειδιά "πρέπει να", "Πρέπει να NOT", "ΕΝΕΡΓΕΙΕΣ", "SHALL", "ΜΈΛΗ NOT", "SHOULD", "Δεν θα πρέπει να", "ΠΡΟΤΕΙΝΌΜΕΝΕΣ", "Μπορεί να" και "ΠΡΟΑΙΡΕΤΙΚΆ" σε αυτό το έγγραφο θα πρέπει να ερμηνεύεται όπως περιγράφεται στο RFC: όπως.

##<a name="2-service-diagram"></a>2. διάγραμμα υπηρεσίας 

Το παρακάτω διάγραμμα παρουσιάζει την αρχιτεκτονική υψηλού επιπέδου της υπηρεσίας του live ροής στο Microsoft Azure Media Services:

1.  Ζωντανή Encoder προωθεί ζωντανή τροφοδοσίες στα κανάλια που δημιουργούνται και παροχή της υπηρεσίας μέσω του Microsoft Azure Media Services SDK.
2.  Κανάλια, προγράμματα και όλα τα ζωντανή ροή λειτουργίες ingest, μορφοποίηση, όπως η ροή τελικό σημείο στο Microsoft Azure Media Services λαβή στο cloud DVR, ασφάλεια, κλιμάκωση και πλεονασμού.
3.  Προαιρετικά πελάτες μπορεί να επιλέξετε να αναπτύξετε ένα επίπεδο CDN μεταξύ το τελικό σημείο ροής και τα τελικά σημεία υπολογιστή-πελάτη.
4.  Ροή τελικά σημεία υπολογιστή-πελάτη από το τελικό σημείο ροής χρησιμοποιώντας πρωτόκολλα προσαρμόσιμη ροής HTTP (π.χ. ομαλή ροή, ΠΑΎΛΑ, σκληροί ΔΊΣΚΟΙ ή HLS).

![image1][image1]


##<a name="3-bit-stream-format--iso-14496-12-fragmented-mp4"></a>3. μορφή bit-ροής – ISO 14496-12 κατακερματιστεί MP4

Η μορφή σύρματος για ζωντανή ροή ingest που περιγράφεται σε αυτό το έγγραφο βασίζεται σε [ISO-14496-12]. Ελέγξτε ανατρέξτε [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx) για αναλυτική εξήγηση των μορφή MP4 κατακερματιστεί και επεκτάσεις για τα αρχεία και τα δύο video-on-demand και live ροής κατάποσης.

###<a name="live-ingest-format-definitions"></a>Live ingest ορισμών μορφή 

Ακολουθεί μια λίστα με ειδική μορφοποίηση ορισμών που ισχύουν για live ingest στο Microsoft Azure Media Services:

1. Η 'ftyp' LiveServerManifestBox και το πλαίσιο 'moov' πρέπει να αποσταλεί με κάθε αίτηση (ΔΗΜΟΣΊΕΥΣΗ HTTP).  ΠΡΈΠΕΙ να αποσταλεί στην αρχή της ροής και οποιαδήποτε στιγμή ο κωδικοποιητής πρέπει να συνδεθείτε ξανά για να συνεχίσετε ingest ροής.  Ανατρέξτε στην ενότητα 6 στο [1] για περισσότερες λεπτομέρειες.
2. Ενότητα 3.3.2 στο [1] Ορίζει ένα προαιρετικό πλαίσιο που ονομάζεται StreamManifestBox για ζωντανή ingest. Λόγω της λογικής δρομολόγηση του Microsoft Azure εξισορρόπηση φόρτου, χρήση αυτού του πλαισίου έχει καταργηθεί και δεν θα πρέπει να υπάρχει όταν ingesting στο Microsoft Azure Media υπηρεσίας. Εάν αυτό το πλαίσιο υπάρχει, των υπηρεσιών Azure Media Services σιωπηρά το παραβλέπει.
3. Το TrackFragmentExtendedHeaderBox ορίζεται στο 3.2.3.2 στο [1] πρέπει να υπάρχει για κάθε τμήμα.
4. Έκδοση 2 του TrackFragmentExtendedHeaderBox θα πρέπει να χρησιμοποιηθεί προκειμένου να δημιουργήσετε τμήματα μέσων με πανομοιότυπες διευθύνσεις URL σε πολλά κέντρα δεδομένων. Το πεδίο index τμήματος ΑΠΑΙΤΕΊΤΑΙ για την ανακατεύθυνση σταυρό-κέντρο δεδομένων βάσει ευρετηρίου ροής μορφών όπως Apple HTTP Live ροής (HLS) και βασίζονται σε ευρετήριο MPEG-ΠΑΎΛΑΣ.  Για να ενεργοποιήσετε την ανακατεύθυνση σταυρό-κέντρου δεδομένων, το ευρετήριο τμήματος πρέπει να συγχρονιστούν σε πολλές κωδικοποιητές και αύξηση κατά 1 για κάθε τμήμα διαδοχικές πολυμέσων, ακόμη και σε επανεκκίνηση του κωδικοποιητή ή αποτυχίες.
5. Ενότητα 3.3.6 στο [1] Καθορίζει πλαίσιο που ονομάζεται MovieFragmentRandomAccessBox ('mfra') που ΕΝΔΈΧΕΤΑΙ να σταλούν στο τέλος του live κατάποσης για να υποδείξετε EOS (τέλος ροή) για το κανάλι. Λόγω της λογικής ingest των υπηρεσιών Azure Media Services, έχει καταργηθεί η χρήση της EOS (τέλος ροή) και το πλαίσιο 'mfra' για ζωντανή κατάποσης δεν θα πρέπει να αποσταλεί. Εάν η αποστολή, των υπηρεσιών Azure Media Services σιωπηρά το παραβλέπει. Συνιστάται να χρησιμοποιήσετε [Καναλιού επαναφορά](https://msdn.microsoft.com/library/azure/dn783458.aspx#reset_channels) για να επαναφέρετε την κατάσταση του σημείου ingest και επίσης συνιστάται να χρησιμοποιήσετε το [Πρόγραμμα σταματήσει](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) για να τερματίσετε μια παρουσίαση και ροής.
6. Η διάρκεια τμήματος MP4 πρέπει να είναι σταθερή, για να μειώσετε το μέγεθος των δηλώσεων του προγράμματος-πελάτη και τη βελτίωση λύσεις λήψης προγράμματος-πελάτη μέσω της επανάληψης ετικέτες.  Η διάρκεια ενδέχεται να παρουσιάζουν προκειμένου να αποζημιώσει για χρεώσεις πλαισίου μη ακέραιος αριθμός.
7. Η διάρκεια τμήματος MP4 πρέπει να είναι μεταξύ περίπου 2 και 6 δευτερόλεπτα.
8. Χρονικές σημάνσεις τμήματος mp4 και ευρετήρια (TrackFragmentExtendedHeaderBox fragment_ absolute_ ώρα και fragment_index) θα πρέπει να παραδίδεται στο αύξουσα σειρά.  Παρόλο που υπηρεσιών Azure Media Services είναι είναι ανθεκτικά στις διπλότυπες τμήματα, που έχει πολύ περιορισμένη δυνατότητα να αναδιατάξετε τμήματα σύμφωνα με τη λωρίδα χρόνου πολυμέσων.

##<a name="4-protocol-format--http"></a>4. μορφή πρωτοκόλλου – HTTP

MP4 κατακερματιστεί ISO βάσει live ingest για το Microsoft Azure Media Services χρησιμοποιεί μια τυπική χρόνο εκτελείται HTTP POST αίτηση για τη μετάδοση δεδομένων κωδικοποιημένο πολυμέσων συσκευαστούν σε μορφή MP4 κατακερματιστεί στην υπηρεσία. Κάθε ΔΗΜΟΣΊΕΥΣΗ HTTP στέλνει μια ολοκληρωμένη κατακερματιστεί MP4 ροή bit ("ροής") ξεκινώντας από αρχίζουν με πλαίσια κεφαλίδας ('ftyp', "Live διακομιστή δήλωσης πλαίσιο" και 'moov' πλαίσιο) και συνεχίζοντας με μια ακολουθία τμημάτων (πλαίσια 'moof' και 'mdat'). Ανατρέξτε στην ενότητα 9,2 σε [1] για τη σύνταξη διεύθυνσης URL για την αίτηση HTTP POST. Ένα παράδειγμα της διεύθυνσης URL ΔΗΜΟΣΊΕΥΣΗ είναι: 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

###<a name="requirements"></a>Απαιτήσεις

Εδώ θα βρείτε τις λεπτομερείς απαιτήσεις:

1. Ο κωδικοποιητής πρέπει να ξεκινήσετε την εκπομπή στέλνοντας μια αίτηση HTTP POST με μια κενή "Σώμα" (μηδενικών μήκος περιεχομένου) χρησιμοποιώντας την ίδια διεύθυνση URL κατάποσης. Αυτό μπορεί να εντοπίσει γρήγορα εάν το τελικό σημείο ζωντανή κατάποσης είναι έγκυρη και εάν υπάρχει κάθε ελέγχου ταυτότητας ή άλλες συνθήκες απαιτείται. Ανά πρωτοκόλλου HTTP, ο διακομιστής δεν θα μπορείτε να στείλετε πίσω απόκριση HTTP μέχρι την παραλαβή της αίτησης ολόκληρο συμπεριλαμβανομένων σώμα ΔΗΜΟΣΊΕΥΣΗ. Δεδομένης της μεγάλης διάρκειας ζωντανή συμβάν, χωρίς αυτό το βήμα, ο κωδικοποιητής ενδέχεται να μην μπορεί να εντοπίσει οποιοδήποτε σφάλμα μέχρι να ολοκληρωθεί η αποστολή όλων των δεδομένων.
2. Encoder πρέπει να χειριστείτε σφάλματα ή τον έλεγχο ταυτότητας προκλήσεις ως αποτέλεσμα (1). Εάν (1) με επιτυχία με 200 απόκριση, συνεχίστε.
3. ΠΡΈΠΕΙ να ξεκινήσετε μια νέα αίτηση HTTP POST με τη ροή κατακερματισμένα MP4 κωδικοποιητή.  Το φορτίο πρέπει να ξεκινά με τα πλαίσια κεφαλίδας ακολουθούμενο από τμήματα.  Σημείωση το πλαίσιο 'ftyp', "Live διακομιστή δήλωσης πλαίσιο" και 'moov' (με αυτήν τη σειρά) πρέπει να αποσταλεί με κάθε αίτηση, ακόμα και αν ο κωδικοποιητής πρέπει να συνδεθείτε ξανά, επειδή η προηγούμενη αίτηση τερματίστηκε πριν από το τέλος της ροής. 
4. Encoder πρέπει να χρησιμοποιήσετε κατατμημένης μεταφορά κωδικοποίησης για αποστολή επειδή δεν είναι δυνατό να πρόβλεψης ολόκληρο μήκος περιεχομένου του live συμβάντος.
5. Όταν ολοκληρωθεί, μετά την αποστολή του τελευταίου τμήματος, το συμβάν ο κωδικοποιητής ομαλά πρέπει να τελειώνει την ακολουθία μήνυμα κατατμημένης μεταφορά κωδικοποίησης (περισσότερες στοίβες προγραμμάτων-πελατών HTTP χειρίστηκε αυτόματα). Ο κωδικοποιητής πρέπει να περιμένετε για την υπηρεσία για να επιστρέψετε τον κώδικα τελική απόκριση και, στη συνέχεια, να τερματίσετε τη σύνδεση. 
6. Encoder πρέπει να χρησιμοποιείτε το ουσιαστικό Events() όπως περιγράφεται στο 9,2 σε [1] για ζωντανή κατάποσης στο Microsoft Azure Media Services.
7. Εάν η αίτηση HTTP POST καταγγελία ή λήγει το χρονικό όριο πριν από το τέλος της ροής με ένα σφάλμα TCP, ο κωδικοποιητής πρέπει να εκδώσετε μια νέα πρόσκληση σε ΔΗΜΟΣΊΕΥΣΗ χρησιμοποιώντας μια νέα σύνδεση και ακολουθήστε τις απαιτήσεις παραπάνω με την επιπλέον απαίτηση ότι ο κωδικοποιητής πρέπει να στείλετε ξανά την προηγούμενη δύο τμήματα MP4 για κάθε κομμάτι στη ροή και συνέχιση χωρίς παρουσίαση των δεδομένων στη λωρίδα χρόνου πολυμέσων.  Επανάληψη αποστολής τα τελευταία δύο τμήματα MP4 για κάθε κομμάτι εξασφαλίζει ότι υπάρχει απώλεια δεδομένων.  Με άλλα λόγια, εάν μια ροή περιέχει ένα ήχου και βίντεο παρακολούθηση και την τρέχουσα ΚΑΤΑΧΏΡΗΣΗ αίτηση αποτυγχάνει, ο κωδικοποιητής πρέπει να συνδεθείτε ξανά και να στείλετε ξανά τα τελευταία δύο τμήματα για το κομμάτι ήχου, το οποίο ήταν προηγουμένως αποστολή με επιτυχία, και τα δύο τελευταία τμημάτων για το βίντεο κομμάτι, που έχουν προηγουμένως με επιτυχία αποσταλεί, προκειμένου να διασφαλίσετε ότι υπάρχει απώλεια δεδομένων.  Ο κωδικοποιητής πρέπει να διατηρούν "Προώθηση" buffer των τμημάτων πολυμέσων, τα οποία το αποστέλλει ξανά όταν επανασυνδεθείτε.

##<a name="5-timescale"></a>5. κλίμακα χρόνου 

[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) περιγράφει τη χρήση του "Κλίμακα χρόνου" για SmoothStreamingMedia (ενότητα σημείο 2.2.2.1.), StreamElement (ενότητα 2.2.2.3), StreamFragmentElement(2.2.2.6) και LiveSMIL (ενότητα 2.2.7.3.1). Εάν δεν υπάρχει τιμή κλίμακας χρόνου, η προεπιλεγμένη τιμή που χρησιμοποιήθηκε είναι 10,000,000 (10 MHz). Παρόλο που ομαλή ροή προδιαγραφές μορφής δεν αποκλεισμός χρήση της άλλες τιμές κλίμακας χρόνου, οι περισσότερες από τις χρήσεις υλοποιήσεις κωδικοποιητή αυτήν την προεπιλεγμένη τιμή (10 MHz) για να δημιουργήσετε ομαλές ροή ingest δεδομένων. Λόγω τη δυνατότητα [Συσκευασία δυναμικής πολυμέσων Azure](media-services-dynamic-packaging-overview.md) , είναι συνιστάται να χρησιμοποιήσετε χρονικής κλίμακας 90 kHz για ροές βίντεο και 44,1 ή 48.1 kHz για ροές ήχου. Εάν χρησιμοποιούνται διαφορετική κλίμακα χρόνου τιμές για διαφορετικά ροές, πρέπει να αποσταλεί της χρονικής κλίμακας επιπέδου ροής. Ανατρέξτε στην [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).     

##<a name="6-definition-of-stream"></a>6. Ορισμός "Ροής"  

"Ροής" είναι η βασική μονάδα της λειτουργίας σε ζωντανή κατάποσης για τη σύνταξη ζωντανής παρουσίασης, χειρισμός ροής ανακατεύθυνσης και πλεονασμού σενάρια. "Ροής" έχει οριστεί ως ένα μοναδικό κατακερματιστεί MP4 bit-ροή η οποία μπορεί να περιέχει ένα μεμονωμένο κομμάτι ή πολλά κομμάτια. Μια πλήρη ζωντανή παρουσίαση μπορεί να περιέχει μία ή περισσότερες ροές ανάλογα με τη ρύθμιση παραμέτρων του live encoder(s). Τα παρακάτω παραδείγματα εξηγούν διάφορες επιλογές της χρήσης stream(s) για να συντάξετε μια πλήρη ζωντανή παρουσίαση.

**Παράδειγμα:** 

Πελάτης σας θέλει να δημιουργήσετε μια ζωντανή παρουσίαση ροής που περιλαμβάνει τα παρακάτω bitrates ήχου/βίντεο:

Βίντεο-3000kbps, 1500kbps, 750kbps

Ήχος-128kbps

###<a name="option-1-all-tracks-in-one-stream"></a>Επιλογή 1: Όλα τα κομμάτια σε μία ροή

Σε αυτή την επιλογή, ένα μεμονωμένο encoder δημιουργεί όλα τα κομμάτια ήχου/βίντεο και να ομαδοποιηθούν τους σε μία κατακερματιστεί MP4 bit-ροή η οποία, στη συνέχεια, αποστέλλονται μέσω μιας μεμονωμένης σύνδεσης HTTP POST. Σε αυτό το παράδειγμα, υπάρχει μόνο μία ροή για αυτήν την παρουσίαση ζωντανή:

![image2][image2]

###<a name="option-2-each-track-in-a-separate-stream"></a>Επιλογή 2: Κάθε παρακολούθηση σε μια ξεχωριστή ροή

Σε αυτή την επιλογή, το encoder(s) τοποθετήσετε μόνο μία παρακολούθηση σε κάθε τμήμα MP4 bit-ροή και δημοσιεύστε όλων των ροών πάνω από πολλές συνδέσεις HTTP ξεχωριστά. Αυτό μπορεί να γίνει με κωδικοποιητές μία ή πολλές κωδικοποιητές. Από το live κατάποσης άποψη, αυτή η ζωντανή παρουσίαση αποτελείται από τέσσερα ροών.

![image3][image3]

###<a name="option-3-bundle-audio-track-with-the-lowest-bitrate-video-track-into-one-stream"></a>Επιλογή 3: Ομαδοποιηθούν κομμάτι ήχου με τη χαμηλότερη κομμάτι βίντεο ρυθμό μετάδοσης bit σε μία ροή

Σε αυτή την επιλογή, ο πελάτης επιλέξει να ομαδοποιηθούν το κομμάτι ήχου με το μικρότερο κομμάτι βίντεο ρυθμό μετάδοσης bit στη μία MP4 τμήματος bit-ροή και αφήστε τα άλλα κομμάτια δύο βίντεο είναι το δικό της ροής. 


![image4][image4]


###<a name="summary"></a>Σύνοψη

Τι εμφανίζεται παραπάνω δεν είναι μια εκτεταμένη λίστα όλων των πιθανών κατάποσης επιλογών για αυτό το παράδειγμα. Ως ένα matter των πραγματικότητα, οποιαδήποτε ομαδοποίηση κομματιών σε ροές υποστηρίζεται από το live κατάποσης. Πελάτες και προμηθευτές encoder να επιλέξετε τις δικές τους υλοποιήσεις βάση μηχανικής πολυπλοκότητα, χωρητικότητα encoder, και πλεονασμού και ζητήματα ανακατεύθυνσης. Ωστόσο πρέπει να σημειωθεί ότι στις περισσότερες περιπτώσεις υπάρχει μόνο ένα κομμάτι ήχου για ολόκληρη την παρουσίαση ζωντανή, ώστε να είναι σημαντικό για να βεβαιωθείτε ότι η καταλληλότητα της ροής ingest που περιέχει το κομμάτι ήχου. Συχνά αυτό εξέταση αποτέλεσμα θέση κομμάτι ήχου σε δικό του ροής (όπως στο επιλογή 2) ή το δέσμης με τη χαμηλότερη κομμάτι βίντεο ρυθμό μετάδοσης bit (όπως στο επιλογή 3). Επίσης για καλύτερη πλεονασμού και ανοχή σφαλμάτων, αποστολή παρακολούθηση την ίδια ήχου σε δύο διαφορετικούς ροές (επιλογή 2 με πλεονάζοντα κομμάτια ήχου) ή δέσμης το κομμάτι ήχου τουλάχιστον δύο χαμηλότερη ρυθμό μετάδοσης bit βίντεο κομμάτια (επιλογή 3 με ήχο ομαδοποιημένα σε τουλάχιστον δύο ροών βίντεο) συνιστάται για live ingest στο Microsoft Azure Media Services.

##<a name="7-service-failover"></a>7. ανακατεύθυνση υπηρεσίας 

Δεδομένο ζωντανή ροή της φύσης, καλή ανακατεύθυνσης υποστήριξης είναι κρίσιμες για τη διασφάλιση τη διαθεσιμότητα της υπηρεσίας. Microsoft Azure Media Services έχει σχεδιαστεί για το χειρισμό διάφορους τύπους αποτυχιών όπως σφάλματα δικτύου, σφάλματα διακομιστή, προβλήματα αποθήκευσης, κ.λπ. Όταν χρησιμοποιείται σε συνδυασμό με λογική proper ανακατεύθυνσης από την πλευρά του live encoder, πελατών να επιτύχετε ιδιαίτερα αξιόπιστη ζωντανή ροή υπηρεσίας από το cloud.

Σε αυτήν την ενότητα, αναλύονται υπηρεσίας ανακατεύθυνσης σενάρια. Σε αυτήν την περίπτωση, η αποτυχία συμβαίνει κάπου μέσα στην υπηρεσία και εκδηλώνεται ως σφάλμα δικτύου. Εδώ θα βρείτε ορισμένες προτάσεις για την εφαρμογή encoder για τη Διαχείριση υπηρεσίας ανακατεύθυνσης:


1. Χρησιμοποιήστε ένα δεύτερο χρονικό όριο 10 για τη δημιουργία της σύνδεσης TCP.  Εάν η προσπάθεια για να δημιουργήσετε τη σύνδεση διαρκεί περισσότερο από 10 δευτερόλεπτα, ματαιώσετε τη λειτουργία και προσπαθήστε ξανά. 
2. Χρησιμοποιήστε ένα σύντομο χρονικό όριο για την αποστολή της αίτησης HTTP μπλοκ μηνύματος.  Εάν η διάρκεια τμήματος προορισμού MP4 είναι Ν δευτερόλεπτα, χρησιμοποιήστε ένα χρονικό όριο αποστολής μεταξύ N και 2N δευτερολέπτων; Χρησιμοποιήστε ένα χρονικό όριο του 6 έως 12 δευτερόλεπτα, για παράδειγμα, αν η διάρκεια τμήματος MP4 είναι 6 δευτερόλεπτα.  Εάν παρουσιαστεί ένα χρονικό όριο, επαναφέρετε τη σύνδεση, ανοίξτε μια νέα σύνδεση και να συνεχίσετε ροή ingest στη νέα σύνδεση. 
3. Διατήρηση συνάθροισης buffer που περιέχει τα τελευταία δύο τμήματα, για κάθε κομμάτι, που στάλθηκαν με επιτυχία και πλήρως με την υπηρεσία.  Εάν η αίτηση HTTP POST για μια ροή τερματίζεται ή λήγει το χρονικό όριο πριν το τέλος της ροής, ανοίξει μια νέα σύνδεση και ξεκινήσετε μια άλλη αίτηση HTTP POST, στείλει τις κεφαλίδες ροής, επανάληψη αποστολής τα τελευταία δύο τμήματα για κάθε κομμάτι και συνεχίσετε τη ροή χωρίς εισαγωγή μιας ασυνέχεια στη λωρίδα χρόνου πολυμέσων.  Αυτό θα μειωθεί η πιθανότητα απώλειας δεδομένων.
4. Συνιστάται να ότι ο κωδικοποιητής δεν περιορίζει τον αριθμό των επαναλήψεων για να δημιουργήσετε μια σύνδεση ή συνέχιση ροής αφού παρουσιάζεται ένα σφάλμα TCP.
5. Μετά από ένα σφάλμα TCP:
    1. Η τρέχουσα σύνδεση πρέπει να κλείσει και πρέπει να δημιουργήσετε μια νέα σύνδεση για μια νέα αίτηση HTTP POST.
    2. Η νέα HTTP ΔΗΜΟΣΊΕΥΣΗ διεύθυνση URL πρέπει να είναι ίδια με την αρχική διεύθυνση URL ΔΗΜΟΣΊΕΥΣΗ.
    3. Η νέα HTTP ΔΗΜΟΣΊΕΥΣΗ πρέπει να συμπεριλάβετε τις κεφαλίδες ροής (πλαίσιο 'ftyp', "Live διακομιστή δήλωσης πλαίσιο" και 'moov') ίδιες με τις κεφαλίδες ροής στο την αρχική ΔΗΜΟΣΊΕΥΣΗ.
    4. ΠΡΈΠΕΙ να αποσταλούν ξανά τα τελευταία δύο τμήματα στείλατε για κάθε παρακολούθηση και η ροή επαναλαμβάνονται χωρίς εισαγωγή μιας ασυνέχεια στη λωρίδα χρόνου πολυμέσων.  Το χρονικές σημάνσεις τμήματος MP4 πρέπει να αυξάνονται συνεχώς, ακόμα και σε όλες τις αιτήσεις HTTP POST.
6. Ο κωδικοποιητής θα πρέπει να τερματίσετε την αίτηση HTTP POST αν δεδομένων δεν αποστέλλεται ρυθμό ανάλογα με τη διάρκεια του τμήματος MP4.  Μια αίτηση HTTP POST που να μην στέλνει δεδομένων να αποτρέψετε τη γρήγορη αποσύνδεση από τον κωδικοποιητή σε περίπτωση μια ενημερωμένη έκδοση υπηρεσίας των υπηρεσιών Azure Media Services.  Για αυτόν το λόγο, η ΔΗΜΟΣΊΕΥΣΗ HTTP για κατακερματισμένο κομμάτια (ad σήμα) πρέπει να είναι σύντομο διάρκειας, τον τερματισμό μόλις το τμήμα κατακερματισμένο αποστέλλεται.

##<a name="8-encoder-failover"></a>8. ανακατεύθυνση encoder

Ανακατεύθυνση Encoder είναι το δεύτερο τύπο σεναρίου ανακατεύθυνσης που πρέπει να εκτελούνται για την παράδοση ζωντανή ροής για να ολοκληρωμένες. Σε αυτό το σενάριο, τη συνθήκη σφάλματος συνέβη στην πλευρά κωδικοποιητή. 

![image5][image5]


Ακολουθούν τις προσδοκίες από το τελικό σημείο ζωντανή κατάποσης όταν συμβαίνει encoder ανακατεύθυνση:

1. Μια νέα παρουσία encoder πρέπει να δημιουργηθεί προκειμένου να συνεχίσετε ροής, όπως φαίνεται στο παρακάτω διάγραμμα (ροής για 3000 k βίντεο διακεκομμένη γραμμή).
2. Το νέο encoder πρέπει να χρησιμοποιήσετε την ίδια διεύθυνση URL για αιτήσεις HTTP ΔΗΜΟΣΊΕΥΣΗ ως αποτυχίας περίοδο λειτουργίας.
3. Ο κωδικοποιητής νέα αίτηση POST πρέπει να συμπεριλάβετε τα ίδια κατακερματισμένα πλαίσια κεφαλίδας MP4 ως αποτυχίας περίοδο λειτουργίας.
4. Η νέα encoder πρέπει να συγχρονιστούν σωστά με όλα άλλες εκτελείται κωδικοποιητές για την ίδια παρουσίαση live για τη Δημιουργία συγχρονισμένου δείγματα ήχου/βίντεο με όρια στοιχισμένα τμήματος.
5. Η νέα ροή πρέπει να σημειωτικής ισοδύναμο με το προηγούμενο ροής και δυνατότητα εναλλαγής σε επίπεδο κεφαλίδα και το τμήμα.
6. Το νέο encoder πρέπει να προσπαθήσετε να ελαχιστοποιήσετε τις απώλειες δεδομένων.  Η fragment_absolute_time και fragment_index τμημάτων πολυμέσων πρέπει να αυξήσετε από το σημείο όπου ο κωδικοποιητής σταμάτησε την τελευταία φορά.  Πρέπει να αυξήσετε το fragment_absolute_time και fragment_index με συνεχή τρόπο, αλλά επιτρέπεται να εισαχθεί μια ασυνέχεια, εάν είναι απαραίτητο.  Azure Media Services θα αγνοήσει τμήματα που έχει ήδη λάβει και υποβάλλονται σε επεξεργασία, ώστε να είναι προτιμότερο να σφάλμα στο πλάι Επανάληψη αποστολής τμήματα από για να εισάγουν δεδομένων στη λωρίδα χρόνου πολυμέσων. 

##<a name="9-encoder-redundancy"></a>9. πλεονασμού encoder 

Για ορισμένες κρίσιμες live συμβάντα που ζήτηση ακόμη μεγαλύτερη διαθεσιμότητα και την ποιότητα της εμπειρία, συνιστάται να χρησιμοποιούν ενεργούς πλεονάζοντα κωδικοποιητές για να επιτύχετε απρόσκοπτη ανακατεύθυνσης χωρίς απώλεια δεδομένων.

![image6][image6]

Όπως φαίνεται στο παρακάτω διάγραμμα, υπάρχουν δύο ομάδα κωδικοποιητές Ώθηση ταυτόχρονα δύο αντίγραφα του κάθε ροή στην υπηρεσία live. Αυτή η διαμόρφωση υποστηρίζεται επειδή Microsoft Azure Media Services έχει τη δυνατότητα να φιλτράρετε διπλότυπων τμημάτων που βασίζονται σε ροή Αναγνωριστικό και τμήμα χρονικής σήμανσης. Η ζωντανή ροή που προκύπτει και αρχειοθέτησης θα είναι ένα μόνο αντιγράφου της όλων των ροών που είναι η καλύτερη δυνατή συγκέντρωση από τις δύο προελεύσεις. Για παράδειγμα, σε μια υποθετική ακραίων περίπτωση, εφόσον υπάρχει μία encoder (δεν χρειάζεται να είναι τα ίδια) εκτελείται σε οποιοδήποτε σημείο δεδομένη στιγμή για κάθε ροή, η ζωντανή ροή που προκύπτει από την υπηρεσία θα είναι συνεχής χωρίς απώλεια δεδομένων. 

Η απαίτηση για αυτό το σενάριο είναι σχεδόν ίδια με τις απαιτήσεις σε περίπτωση ανακατεύθυνσης Encoder με την εξαίρεση που λειτουργούν με το δεύτερο σύνολο κωδικοποιητές την ίδια στιγμή ως η κύρια κωδικοποιητές.

##<a name="10-service-redundancy"></a>10. πλεονασμού υπηρεσίας  

Ιδιαίτερα πλεονάζοντα καθολικού κατανομή, μερικές φορές απαιτείται να έχουν σταυρό περιοχής δημιουργίας αντιγράφων ασφαλείας για το χειρισμό τοπικές καταστροφές. Ανάπτυξη την τοπολογία "Encoder πλεονασμού", οι πελάτες να επιλέξετε μια ανάπτυξη πλεονάζοντα υπηρεσίας σε διαφορετική περιοχή που συνδέεται με το σύνολο 2η κωδικοποιητές. Οι πελάτες θα μπορούσε να λειτουργούν επίσης με μια υπηρεσία παροχής CDN για την ανάπτυξη μιας GTM (καθολικός διαχειριστής κίνηση) μπροστά από το αναπτύξεις δύο υπηρεσίας για τη δρομολόγηση απρόσκοπτα κίνησης προγράμματος-πελάτη. Οι απαιτήσεις για το κωδικοποιητές είναι ίδια με την περίπτωση "Encoder πλεονασμού" με η μοναδική εξαίρεση που δεύτερο σύνολο κωδικοποιητές πρέπει να υποδεικνύεται σε διαφορετική live ingest τελικού σημείου. Το παρακάτω διάγραμμα παρουσιάζει αυτό το πρόγραμμα εγκατάστασης:

![image7][image7]

##<a name="11-special-types-of-ingestion-formats"></a>11. Ειδικοί τύποι μορφών κατάποσης 

Αυτή η ενότητα περιγράφει ορισμένες ειδικός τύπος ζωντανή κατάποσης μορφές αρχείων που έχουν σχεδιαστεί για το χειρισμό ορισμένα συγκεκριμένα σενάρια.

###<a name="sparse-track"></a>Παρακολούθηση κατακερματισμένο

Κατά τη διάρκεια μιας ζωντανής παρουσίασης ροής εμπειρία εμπλουτισμένο πρόγραμμα-πελάτη, συχνά είναι απαραίτητο να συγχρονιστεί χρόνου συμβάντων μετάδοσης ή σήματα εντός ζώνης με τα δεδομένα του κύριου πολυμέσων. Ένα παράδειγμα αυτό είναι δυναμική ζωντανή διαφημίσεις εισαγωγής. Αυτός ο τύπος συμβάντος σηματοδότηση είναι διαφορετική από κανονική ήχου/βίντεο ροής λόγω του κατακερματισμένο χαρακτήρα. Με άλλα λόγια, τα δεδομένα σηματοδότησης συνήθως δεν συμβεί συνεχώς και το χρονικό διάστημα που μπορεί να είναι δύσκολο να πρόβλεψης. Την έννοια της κατακερματισμένο παρακολούθηση σχεδιάστηκε ειδικά για να ingest και εκπομπή σηματοδότησης δεδομένων εντός ζώνης.

Ακολουθεί μια προτεινόμενη υλοποίηση για ingesting κατακερματισμένο παρακολούθηση:

1. Δημιουργήστε μια ξεχωριστή κατακερματιστεί MP4 bit-ροή η οποία περιέχει απλώς κατακερματισμένο track(s) χωρίς κομμάτια ήχου/βίντεο.
2. Στο παράθυρο"Live διακομιστή δήλωσης" όπως ορίζεται στο τμήμα 6 στο [1], χρησιμοποιήστε παράμετρο "parentTrackName" για να καθορίσετε το όνομα της γονικής γραμμής. Ανατρέξτε στην ενότητα 4.2.1.2.1.2 στο [1] για περισσότερες λεπτομέρειες.
3. Στο παράθυρο"Live διακομιστή δήλωσης", manifestOutput πρέπει να έχει οριστεί σε "true".
4. Δεδομένης της κατακερματισμένο σηματοδότησης συμβάντος, συνιστάται να που:
    1. Στην αρχή του live συμβάντος, encoder στέλνει τα πλαίσια αρχική κεφαλίδα για την υπηρεσία που θα επιτρέπουν την υπηρεσία για να καταχωρήσετε την παρακολούθηση κατακερματισμένο στο δηλωτικό προγράμματος-πελάτη.
    2. Ο κωδικοποιητής θα πρέπει να τερματίσετε την αίτηση HTTP POST όταν δεδομένων δεν αποστέλλεται.  Μια μεγάλης διάρκειας ΚΑΤΑΧΏΡΗΣΗ HTTP που να μην στέλνει δεδομένων να αποτρέψετε υπηρεσιών Azure Media Services γρήγορα αποσύνδεση από τον κωδικοποιητή σε περίπτωση μια υπηρεσία ενημέρωσης ή διακομιστή επανεκκινήστε τον υπολογιστή, όπως ο διακομιστής πολυμέσων θα αποκλειστούν προσωρινά σε μια λειτουργία παραλαβής στην υποδοχή. 
    3. Στη διάρκεια του χρόνου όταν σηματοδότησης δεδομένων δεν είναι διαθέσιμη, ο κωδικοποιητής SHOULD κλείστε τη ΔΗΜΟΣΊΕΥΣΗ HTTP αίτηση.  Κατά την αίτηση POST είναι ενεργό, ο κωδικοποιητής πρέπει να αποστολή δεδομένων 
    4. Κατά την αποστολή κατακερματισμένο τμήματα, encoder να ορίσετε ρητή κεφαλίδα περιεχομένου-μήκους, εάν είναι διαθέσιμη.
    5. Κατά την αποστολή κατακερματισμένο τμήματος με μια νέα σύνδεση, θα πρέπει να ξεκινήσετε την αποστολή από τα πλαίσια κεφαλίδας ακολουθούμενο από το νέο τμήματα κωδικοποιητή. Πρόκειται για το χειρισμό περίπτωση που ανακατεύθυνσης συνέβη στο μεταξύ και τη νέα σύνδεση κατακερματισμένο πραγματοποιείται σε νέο διακομιστή που δεν έχει ορατό το κατακερματισμένο κομμάτι πριν από.
    6. Το τμήμα κατακερματισμένο παρακολούθηση θα γίνουν διαθέσιμες στο πρόγραμμα-πελάτη όταν το τμήμα που έχει ίσο παρακολούθηση το αντίστοιχο γονικό στοιχείο ή μεγαλύτερη τιμή χρονικής σήμανσης έχει κάνει διαθέσιμες στο πρόγραμμα-πελάτη. Για παράδειγμα, εάν το τμήμα κατακερματισμένο έχει μια χρονική σήμανση της t = 1000, αναμένεται μετά το πρόγραμμα-πελάτη που βλέπει το βίντεο (αν υποθέσουμε ότι το όνομα παρακολούθηση γονικό είναι βίντεο) τμήμα χρονικής σήμανσης 1000 ή ΑΛΛΑ, αυτό μπορεί να κάνει λήψη του τμήματος κατακερματισμένο t = 1000. Έχετε υπόψη ότι το πραγματικό σήμα θα μπορούσε να πολύ καλά να χρησιμοποιηθεί για μια διαφορετική θέση στη λωρίδα χρόνου παρουσίασης για το σκοπό που έχει οριστεί ως. Στο παραπάνω παράδειγμα, είναι πιθανό που το κατακερματισμένο τμήμα της t = 1000 περιλαμβάνει ένα φορτίο XML που είναι για την εισαγωγή ενός Ad σε μια θέση που είναι μερικά δευτερόλεπτα αργότερα.
    7. Το φορτίο του τμήματος κατακερματισμένο παρακολούθηση μπορεί να είναι σε διάφορες διαφορετικές μορφές (π.χ. XML ή κειμένου ή δυαδικό, κ.λπ.) ανάλογα με διαφορετικά σενάρια. 


###<a name="redundant-audio-track"></a>Πλεονάζοντα κομμάτι ήχου

Σε ένα τυπικό προσαρμόσιμη ροής HTTP σενάριο (π.χ. ομαλή ροή ή ΠΑΎΛΑΣ), υπάρχει συχνά μόνο ένα κομμάτι ήχου σε ολόκληρη την παρουσίαση. Σε αντίθεση με βίντεο κομματιών που έχουν πολλά επίπεδα ποιότητας για το πρόγραμμα-πελάτη για να επιλέξετε από υπό συνθήκες σφάλματος, το κομμάτι ήχου μπορεί να είναι ένα μοναδικό σημείο αποτυχίας αν έχει διακοπεί η πρόσληψη του ροής που περιέχει το κομμάτι ήχου. 

Για να επιλύσετε αυτό το πρόβλημα, το Microsoft Azure Media Services υποστηρίζει ζωντανή πρόσληψη του πλεονάζοντα κομμάτια ήχου. Η ιδέα είναι ότι το ίδιο κομμάτι ήχου μπορούν να αποσταλούν πολλές φορές σε διαφορετικές ροές. Ενώ η υπηρεσία θα μόνο καταχώρηση το κομμάτι ήχου μία φορά στο δηλωτικό προγράμματος-πελάτη, είναι να χρησιμοποιήσετε πλεονάζοντα κομμάτια ήχου ως αντίγραφα ασφαλείας για την ανάκτηση ήχου τμήματα εάν το πρωτεύον κομμάτι ήχου είναι αντιμετωπίζετε προβλήματα. Για να ingest πλεονάζοντα κομμάτια ήχου, ο κωδικοποιητής πρέπει να:

1. Δημιουργήστε το ίδιο κομμάτι ήχου σε πολλές MP4 τμήματος bit-ροές. Τα πλεονάζοντα κομμάτια ήχου πρέπει να σημειωτικής ισοδύναμο με ακριβώς το ίδιο χρονικές σημάνσεις του τμήματος και δυνατότητα εναλλαγής σε επίπεδο κεφαλίδα και το τμήμα.
2. Βεβαιωθείτε ότι το "Ήχος" καταχώρηση στο το Live διακομιστή δήλωσης (6 ενότητας στο [1]) είναι η ίδια για όλα τα πλεονάζοντα κομμάτια ήχου.

Ακολουθεί μια προτεινόμενη υλοποίηση για πλεονάζοντα κομμάτια ήχου:

1. Αποστολή κάθε μοναδικό κομμάτι ήχου σε μια ροή μόνη.  Επίσης να στείλετε μια ροή πλεονάζοντα για κάθε μία από αυτές τις ροές κομμάτι ήχου, όπου η 2η ροή διαφέρει από την 1η μόνο το αναγνωριστικό στη διεύθυνση URL ΔΗΜΟΣΊΕΥΣΗ HTTP: {πρωτόκολλο} :// {διεύθυνση διακομιστή} / {δημοσίευσης path}/Streams({identifier}) σημείο.
2. Χρησιμοποιήστε ξεχωριστές ροές για να στείλετε τα δύο bitrates χαμηλότερη βίντεο. Κάθε μία από αυτές τις ροές θα πρέπει να περιέχει ένα αντίγραφο του κάθε μοναδικό κομμάτι ήχου.  Για παράδειγμα, όταν πολλές γλώσσες που υποστηρίζονται, αυτές οι ροών πρέπει να περιέχει κομμάτια ήχου για κάθε γλώσσα.
3. Χρησιμοποιήστε διαφορετικό διακομιστή (κωδικοποιητή) παρουσίες για την κωδικοποίηση και στείλτε τα πλεονάζοντα ροές που αναφέρεται στο (1) και (2). 



##<a name="media-services-learning-paths"></a>Διαδικασίες εκμάθησης Media Services

[AZURE.INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

##<a name="provide-feedback"></a>Παροχή σχολίων

[AZURE.INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]


[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png

 