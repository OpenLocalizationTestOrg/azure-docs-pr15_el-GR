<properties 
    pageTitle="Πρωτόκολλο συνδέσεις υβριδική Azure μεταγωγής | Microsoft Azure"
    description="zure μεταγωγή υβριδική συνδέσεις πρωτόκολλο οδηγός."
    services="service-bus"
    documentationCenter="na"
    authors="clemensv"
    manager="timlt"
    editor="tysonn" />
<tags 
    ms.service="service-bus"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="na"
    ms.date="10/28/2016"
    ms.author="sethm" />

# <a name="azure-relay-hybrid-connections-protocol"></a>Πρωτόκολλο συνδέσεις υβριδική Azure αναμετάδοσης

Azure αναμετάδοσης είναι ένας από τους πυλώνες βασικών δυνατοτήτων της πλατφόρμας Bus υπηρεσίας Azure. Η νέα δυνατότητα "Υβριδική συνδέσεις" η μετάδοση είναι ένα ασφαλές, Άνοιγμα πρωτόκολλο εξέλιξη βάση HTTP και WebSockets.

Αντικαθιστά του πρώτου, εξίσου με το όνομα "Υπηρεσίες BizTalk" δυνατότητα που έχει δημιουργηθεί σε θεμέλια ΚΥΡΙΟΤΗΤΑΣ πρωτόκολλο. Την ενοποίηση υβριδική συνδέσεων σε υπηρεσίες εφαρμογή Azure θα συνεχίσει να λειτουργεί ως-είναι.

"Υβριδική συνδέσεις" επιτρέπει τη δημιουργία διπλής κατεύθυνσης, δυαδική ροής επικοινωνίας μεταξύ των δύο εφαρμογών σε δίκτυο, με την οποία μπορεί να βρίσκεται είτε μία είτε και τα δύο από τα μέρη πίσω από NAT ή τα τείχη προστασίας.

Αυτό το έγγραφο περιγράφει τις αλληλεπιδράσεις πλευρά του προγράμματος-πελάτη με τη μετάδοση υβριδική συνδέσεις για τη σύνδεση σε προγράμματα-πελάτες σε ρόλους ακρόασης και αποστολέα και πώς ακροατών αποδέχεται νέες συνδέσεις.

## <a name="interaction-model"></a>Μοντέλο επικοινωνίας

Η μετάδοση του υβριδικού συνδέσεις συνδέει δύο μέρη, παρέχοντας ένα σημείο σημείο συνάντησης στο cloud Azure που δύο μέρη μπορούν να εντοπίσουν και να συνδεθείτε με από την πλευρά του δικτύου τις δικές τους. Αυτό το σημείο σημείο συνάντησης ονομάζεται "Υβριδική σύνδεσης" σε αυτό και άλλα έγγραφα, τα API στη επίσης στην πύλη του Azure. Το τελικό σημείο υπηρεσίας υβριδική συνδέσεις θα αναφέρεται ως "υπηρεσίας" για τα υπόλοιπα αυτού του εγγράφου.

Το μοντέλο αλληλεπίδραση leans στην την ορολογία που έχει δημιουργηθεί από πολλές άλλες κοινωνικής δικτύωσης API:

Υπάρχει μια υπηρεσία ακρόασης που υποδεικνύει πρώτα ετοιμότητας να χειρίζεται τις εισερχόμενες συνδέσεις και, στη συνέχεια αποδέχεται τους κατά την άφιξή τους. Από την άλλη πλευρά, υπάρχει ένας υπολογιστής-πελάτης σύνδεσης που θα σας συνδέει το ακροατήριο, περιμένετε αυτήν τη σύνδεση για να αποδεχτεί για τη δημιουργία μιας διαδρομής αμφίδρομη επικοινωνία. "Σύνδεση", "Παρακολούθηση", "Αποδοχή" είναι τους ίδιους όρους που θα βρείτε σε περισσότερες socket APIs.

Οποιοδήποτε μοντέλο αναμετάδοση επικοινωνίας έχει δύο μέρη κάνει εξερχόμενες συνδέσεις προς ένα τελικό σημείο υπηρεσίας, οποίος δημιουργεί την "Παρακολούθηση" επίσης "Πελάτης" σε χρήση καθομιλουμένης και μπορεί να προκαλέσει επίσης άλλες τύποι ορολογία; την ακριβή ορολογία χρησιμοποιούμε, επομένως, για τις συνδέσεις του υβριδικού είναι ως εξής:

Τα προγράμματα και στις δύο πλευρές μιας σύνδεσης ονομάζονται "Πελάτης", επειδή υπάρχουν προγράμματα-πελάτες για την υπηρεσία. Το πρόγραμμα-πελάτη που περιμένει και αποδέχεται συνδέσεις είναι την "Παρακολούθηση" ή said να ενσωματωθεί το ρόλο"Παρακολούθηση". Το πρόγραμμα-πελάτη που ξεκινά μια νέα σύνδεση προς μια υπηρεσία ακρόασης μέσω της υπηρεσίας ονομάζεται "αποστολέα" ή στο "ρόλο αποστολέα".

## <a name="listener-interactions"></a>Ακρόαση αλληλεπιδράσεις

Το ακροατήριο περιλαμβάνει τέσσερις αλληλεπιδράσεις με την υπηρεσία. όλες οι λεπτομέρειες σύρματος περιγράφονται παρακάτω σε αυτό το έγγραφο στην ενότητα αναφορά.

### <a name="listen"></a>Ακρόαση

Για να υποδείξετε ετοιμότητας για την υπηρεσία που είναι μια υπηρεσία ακρόασης είστε έτοιμοι για να αποδεχτείτε τις συνδέσεις, δημιουργεί μια σύνδεση υποδοχής εξερχομένων web. Ο συγχρονισμός σύνδεσης φέρει το όνομα μιας σύνδεσης υβριδική έχει ρυθμιστεί στο χώρο ονομάτων αναμετάδοσης και έναν κωδικό ασφαλείας που παρέχει την "Παρακολούθηση" δεξιά στη αυτό το όνομα. Όταν απαντηθεί η υποδοχή web από την υπηρεσία, η καταχώρηση έχει ολοκληρωθεί και της δημιουργίας web υποδοχής διατηρείται ενεργών ως "κανάλι στοιχείου ελέγχου" για την ενεργοποίηση όλες οι επόμενες επικοινωνίες. Η υπηρεσία σας επιτρέπει έως και 25 ταυτόχρονες ακροατών σε μια σύνδεση υβριδική. Εάν υπάρχουν ακροατών 2 ή πιο ενεργό, εισερχόμενες συνδέσεις θα είναι εξισορρόπηση μεταξύ τους σε τυχαία σειρά. δεν εγγυάται έκθεσης διανομής.

### <a name="accept"></a>Αποδοχή

Κάθε φορά που ανοίγει έναν αποστολέα μια νέα σύνδεση στην υπηρεσία, η υπηρεσία θα επιλέξτε και ενημερώστε ένα από το ενεργό ακρόασης κατά τη σύνδεση υβριδική. Ειδοποίηση αποστέλλεται το ακροατήριο μέσω του καναλιού ανοιχτό στοιχείο ελέγχου ως μήνυμα JSON που περιέχει τη διεύθυνση URL του τελικού σημείου socket Web που πρέπει να συνδέσετε το ακροατήριο για την αποδοχή της σύνδεσης.

Τη διεύθυνση URL πρέπει να χρησιμοποιηθούν και απευθείας από το ακροατήριο χωρίς επιπλέον εργασία; Οι πληροφορίες κωδικοποιημένο ισχύει μόνο για ένα σύντομο χρονικό διάστημα, ουσιαστικά για κατά τη διάρκεια του αποστολέα είναι πρόθυμοι να περιμένετε για τη σύνδεση για να υπάρχοντα για ολοκληρωμένες, αλλά έως και 30 δευτερόλεπτα. Η διεύθυνση URL μπορεί να χρησιμοποιηθεί μόνο για μία σύνδεση επιτυχή προσπάθεια. Μόλις δημιουργηθεί η σύνδεση υποδοχής Web με τη διεύθυνση URL σημείο συνάντησης, όλων των δραστηριοτήτων περαιτέρω σε αυτήν την υποδοχή Web μεταδίδεται από και έως στον αποστολέα, χωρίς παρέμβαση ή ερμηνεία από την υπηρεσία.

### <a name="renew"></a>Ανανέωση 

Το διακριτικό ασφαλείας που πρέπει να χρησιμοποιηθούν για να καταχωρήσετε το ακροατήριο και να διατηρήσετε το κανάλι ελέγχου μπορεί να λήξει, ενώ το ακροατήριο είναι ενεργή. Τη λήξη διακριτικού δεν θα επηρεάσει συνδέσεων σε εξέλιξη, αλλά θα προκαλέσει το κανάλι ελέγχου για να καταργηθεί από την υπηρεσία στο ή αμέσως μετά τη άμεσων μηνυμάτων από τη λήξη. Την κίνηση "Ανανέωση" είναι ένα μήνυμα JSON που το ακροατήριο να στείλετε για να αντικαταστήσετε το διακριτικό που σχετίζεται με το κανάλι του στοιχείου ελέγχου, ώστε να μπορεί να διατηρηθεί το κανάλι ελέγχου για μεγάλο χρονικό διάστημα.

### <a name="ping"></a>Εντολή ping 

Εάν το κανάλι ελέγχου παραμένει αδρανής για μεγάλο χρονικό διάστημα, μεσάζοντες στον τρόπο με τον, όπως η φόρτωση balancers ή NAT μπορεί να απορρίψετε τη σύνδεση TCP. Την κίνηση "ping" που αποκλείει στέλνοντας μια μικρή ποσότητα δεδομένων στο κανάλι που σας υπενθυμίζει όλα τα μέλη της διαδρομής δικτύου που η σύνδεση είναι δυνατό να είναι ενεργή και, επίσης εξυπηρετεί ως μια δοκιμαστική liveness για το ακροατήριο. Εάν αποτύχει η εντολή ping, το κανάλι ελέγχου θα πρέπει να θεωρούνται χωρίς δυνατότητα χρήσης και θα πρέπει να συνδεθείτε ξανά το ακροατήριο.

## <a name="sender-interaction"></a>Αλληλεπίδραση αποστολέα

Ο αποστολέας έχει μόνο μιας επικοινωνίας με την υπηρεσία, το οποίο συνδέεται.

### <a name="connect"></a>Σύνδεση

Την κίνηση "σύνδεση" ανοίγει μια υποδοχή Web στην υπηρεσία, παρέχοντας το όνομα της σύνδεσης υβριδική και (προαιρετικό, αλλά απαιτείται από προεπιλογή) διακριτικού ασφαλείας αναθέτουν δικαιώματα "Αποστολή" στη συμβολοσειρά ερωτήματος. Η υπηρεσία, στη συνέχεια, θα αλληλεπίδραση με το ακροατήριο με τον τρόπο που περιγράφεται παραπάνω και έχετε το ακροατήριο να δημιουργήσετε μια σύνδεση σημείο συνάντησης που θα είναι συνδεδεμένα με αυτήν την υποδοχή Web. Μετά την υποδοχή Web έχει γίνει αποδεκτή, όλες οι περαιτέρω επικοινωνίες στην υποδοχή Web θα, επομένως, με ένα συνδεδεμένο ακρόασης.

## <a name="interaction-summary"></a>Αλληλεπίδραση σύνοψης

Το αποτέλεσμα αυτό το μοντέλο επικοινωνίας είναι ότι το πρόγραμμα-πελάτη του αποστολέα προέρχεται από ο συγχρονισμός με μια "Εκκαθάριση" υποδοχή Web που είναι συνδεδεμένο σε μια υπηρεσία ακρόασης και που χρειάζονται χωρίς περαιτέρω preambles ή προετοιμασίας. Αυτό σας επιτρέπει σχεδόν οποιαδήποτε υπάρχουσα εφαρμογή Web υποδοχής προγράμματος-πελάτη για εύκολα να επωφεληθείτε από την υπηρεσία υβριδική συνδέσεις απλώς, παρέχοντας μια διεύθυνση URL σωστά κατασκευαστεί σε τους επιπέδου Web υποδοχής προγράμματος-πελάτη.

Η σύνδεση σημείο συνάντησης υποδοχής Web που λαμβάνει το ακροατήριο έως την αλληλεπίδραση αποδοχή είναι επίσης clean και μπορεί να παραδοθεί σε οποιαδήποτε υπάρχουσα εφαρμογή Web socket διακομιστή με ορισμένες ελάχιστο επιπλέον αφαίρεσης που ξεχωρίζει μεταξύ των εργασιών "Αποδοχή" στην ακροατών τους framework τοπικού δικτύου και των συνδέσεων υβριδική λειτουργίες απομακρυσμένης "Αποδοχή".

## <a name="protocol-reference"></a>Πρωτόκολλο αναφοράς

Αυτή η ενότητα περιγράφει τις λεπτομέρειες των επικοινωνιών πρωτόκολλο που περιγράφονται παραπάνω.

Όλες οι συνδέσεις socket Web έχουν κατασκευαστεί στη θύρα 443 ως αναβάθμιση από HTTPS 1.1, η οποία είναι συνήθως αφαιρεθούν από ορισμένες framework socket Web ή API. Δείτε την περιγραφή διατηρείται υλοποίηση ουδέτεροι, χωρίς να προτείνει ένα συγκεκριμένο πλαίσιο.

## <a name="listener-protocol"></a>Πρωτόκολλο ακρόασης

Το πρωτόκολλο ακρόασης αποτελείται από δύο χειρονομίες σύνδεσης και τριών λειτουργιών μηνυμάτων.

### <a name="listener-control-channel-connection"></a>Η σύνδεση του καναλιού ελέγχου ακρόασης

Με τη δημιουργία σύνδεσης υποδοχής Web με το άνοιγμα του καναλιού ελέγχου:

*wss: / / {χώρος ονομάτων-διεύθυνση} /* *$servicebus* */* *hybridconnection /**{path}; μικρές-hc-ενέργεια =... & μικρές hc αναγνωριστικό =... & μικρές-hc-διακριτικό =... "*

Η *διεύθυνση χώρος ονομάτων* είναι το πλήρως προσδιορισμένο όνομα τομέα του χώρου ονομάτων αναμετάδοσης Azure που φιλοξενεί την υβριδική σύνδεσης, συνήθως της φόρμας {*myname}. servicebus.windows.net.*

Οι επιλογές παραμέτρου συμβολοσειράς ερωτήματος είναι ως εξής

| Παραμέτρου        | Απαιτείται; | Περιγραφή                                                                                                                                                                                        |
|--------------|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| μικρές-hc-ενέργειας | Ναι       | Για το ρόλο ακρόασης πρέπει να είναι η παράμετρος **μικρές-hc-ενέργεια = ακρόαση**                                                                                                                                |
| {path}       | Ναι       | Η διαδρομή URL κωδικοποιημένα χώρο ονομάτων της προδιαμορφωμένο υβριδική σύνδεσης για την καταχώρηση αυτό ακρόασης στην. Αυτή η παράσταση είναι προσαρτημένο σε σταθερά * **$servicebus**/**hybridconnection /*** τμήμα διαδρομής. |
| μικρές-hc-διακριτικού  | Ναι\*     | Το ακροατήριο πρέπει να δώσετε μια έγκυρη, κωδικοποιημένη διεύθυνση URL υπηρεσίας Bus θέσει σε κοινή χρήση Access διακριτικού για το χώρο ονομάτων ή σύνδεση υβριδική που παρέχει το δικαίωμα **ακρόαση** .                                           |
| μικρές hc αναγνωριστικού     | Όχι        | Αυτό που παρέχεται από το πρόγραμμα-πελάτη προαιρετικά το Αναγνωριστικό σας επιτρέπει να ολοκληρωμένες διαγνωστικών ανίχνευση.                                                                                                                             |

Εάν αποτύχει η σύνδεση υποδοχής Web λόγω της διαδρομής σύνδεσης υβριδική δεν που έχουν καταχωρηθεί, ή ένα διακριτικό δεν είναι έγκυρη ή που λείπουν ή κάποιο άλλο σφάλμα, το σφάλμα σχολίων θα παρέχονται με το κανονικό μοντέλο σχολίων κατάστασης HTTP 1.1. Την περιγραφή της κατάστασης θα περιέχει ένα σφάλμα παρακολούθησης-αναγνωριστικό που μπορούν να κοινοποιηθούν για την υποστήριξη του Azure:

| Κωδικός | Σφάλμα          | Περιγραφή                                                            |
|------|----------------|------------------------------------------------------------------------|
| 404  | Δεν βρέθηκε      | Η σύνδεση υβριδική **διαδρομή** είναι έγκυρη ή τη βασική διεύθυνση URL είναι ακατάλληλη |
| 401  | Μη εξουσιοδοτημένο   | Είναι το διακριτικό ασφαλείας που λείπουν ή ακατάλληλη ή δεν είναι έγκυρη                  |
| 403  | Δεν επιτρέπεται      | Το διακριτικό ασφαλείας δεν είναι έγκυρο για αυτήν τη διαδρομή για αυτήν την ενέργεια          |
| 500  | Εσωτερικό σφάλμα | Παρουσιάστηκε κάποιο πρόβλημα στην υπηρεσία                                    |

Εάν η σύνδεση υποδοχής Web σκόπιμα τερματίζεται από την υπηρεσία αφού έχει οριστεί αρχικά προς τα επάνω, ο λόγος για αυτήν την ενέργεια, θα κοινοποιηθούν χρησιμοποιώντας κατάλληλο Web socket πρωτόκολλο κωδικός σφάλματος μαζί με ένα περιγραφικό μήνυμα λάθους που θα περιλαμβάνει επίσης ένα αναγνωριστικό παρακολούθησης. Η υπηρεσία δεν τερματισμός θα το κανάλι ελέγχου χωρίς να αντιμετωπίσουν συνθήκη σφάλματος. Οποιαδήποτε τερματισμό είναι προγράμματος-πελάτη ελέγχεται.

| Κατάσταση WS | Περιγραφή                                                                        |
|-----------|------------------------------------------------------------------------------------|
| 1001      | Τη διαδρομή υβριδική σύνδεσης έχει διαγραφεί ή έχει απενεργοποιηθεί.                           |
| 1008      | Έχει λήξει το διακριτικό ασφαλείας και, επομένως, είναι παραβιάζει την πολιτική εξουσιοδότησης. |
| 1011      | Παρουσιάστηκε κάποιο πρόβλημα μέσα στην υπηρεσία.                                           |

### <a name="accept-handshake"></a>Αποδοχή συγχρονισμός 

Ειδοποίηση αποδοχή αποστέλλεται από την υπηρεσία το ακροατήριο πάνω από το κανάλι που δημιουργήθηκε νωρίτερα ελέγχου ως μήνυμα JSON σε ένα πλαίσιο κειμένου socket Web. Δεν υπάρχει καμία απάντηση σε αυτό το μήνυμα.

Το μήνυμα περιέχει ένα αντικείμενο JSON με το όνομα "Αποδοχή", το οποίο ορίζει τις ακόλουθες ιδιότητες αυτήν τη στιγμή:

-   **διεύθυνση** – η συμβολοσειρά διεύθυνσης URL που θα χρησιμοποιηθεί για τη δημιουργία του υποδοχής Web της υπηρεσίας για να αποδεχτείτε μια εισερχόμενη σύνδεση.

-   **αναγνωριστικό** – το μοναδικό αναγνωριστικό για αυτήν τη σύνδεση. Εάν το αναγνωριστικό δόθηκε από το πρόγραμμα-πελάτη του αποστολέα, είναι η τιμή που παρέχεται αποστολέα, διαφορετικά είναι μια τιμή που δημιουργούνται από το σύστημα.

-   **connectHeaders** – όλες οι κεφαλίδες HTTP που παρέχονται στο τελικό σημείο μετάδοση από τον αποστολέα, η οποία περιλαμβάνει επίσης το πρωτόκολλο WebSocket Sec και τις κεφαλίδες Sec-WebSocket-επεκτάσεις.

| Αποδοχή του μηνύματος                                                                     |
|------------------------------------------------------------------------------------|
```json
{                                                                                  
    "accept" : {                                                                                    
        "address" : "wss://168.61.148.205:443/$servicebus/hybridconnection/{path}?...",                                                                          
        "id" : "4cb542c3-047a-4d40-a19f-bdc66441e736\_G0\_G1",                         
        "connectHeaders" : {                                                                
            "Host" : "…",                                                                       
            "Sec-WebSocket-Protocol" : "…",                                                     
            "Sec-WebSocket-Extensions" : "…"                                                    
        }                                                                                     
    }
}
```

Τη διεύθυνση URL που παρέχονται στο μήνυμα JSON χρησιμοποιείται από το ακροατήριο, για να καθορίσετε την υποδοχή Web για αποδοχή ή απόρριψη της υποδοχής του αποστολέα.

#### <a name="accepting-the-socket"></a>Αποδοχή της υποδοχής

Για να αποδεχτείτε, το ακροατήριο δημιουργεί μια σύνδεση WebSocket με τη διεύθυνση που παρέχεται.

Έχετε υπόψη σας ότι για την περίοδο preview, τη διεύθυνση URI μπορεί να χρησιμοποιεί μια απολύτως διεύθυνση IP και το πιστοποιητικό TLS που παρέχεται από το διακομιστή θα αποτύχει επικύρωση σε αυτήν τη διεύθυνση. Αυτό θα αποκατασταθούν κατά τη διάρκεια της προεπισκόπησης.

Εάν το μήνυμα "Αποδοχή" έχει μια κεφαλίδα "Sec-WebSocket-πρωτόκολλο", αναμένεται ότι η ακρόαση μόνο αποδέχεται την WebSocket εάν υποστηρίζει το πρωτόκολλο και ότι ρυθμίζει την κεφαλίδα όπως καθορίζεται η WebSocket.

Το ίδιο ισχύει για την κεφαλίδα "Sec-WebSocket-επεκτάσεις". Εάν το πλαίσιο υποστηρίζει επέκταση, πρέπει να την τιμή στην κεφαλίδα της απάντησης πλευρά του *διακομιστή* του ο συγχρονισμός απαιτείται "Sec-WebSocket-επεκτάσεις" για την επέκταση.

Η διεύθυνση URL πρέπει να χρησιμοποιούνται ως-είναι για τον καθορισμό της υποδοχής αποδοχή, αλλά περιέχει τις ακόλουθες παραμέτρους:

| Παραμέτρου        | Απαιτείται; | Περιγραφή                                                                                                                                                                                                                                                                                   |
|--------------|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| μικρές-hc-ενέργειας | Ναι       | Για την αποδοχή μιας υποδοχής πρέπει να είναι η παράμετρος **μικρές-hc-ενέργεια = αποδοχή**                                                                                                                                                                                                                          |
| {path}       | Ναι       | Η διαδρομή URL κωδικοποιημένα χώρο ονομάτων της προδιαμορφωμένο υβριδική σύνδεσης για την καταχώρηση αυτό ακρόασης στην. Αυτή η παράσταση είναι προσαρτημένο σε σταθερά * **$servicebus**/**hybridconnection /*** τμήμα διαδρομής.                                                                                            
                                                                                                                                                                                                                                                                                                                           
                            The path expression MAY be extended with a suffix and a query string expression that follows the registered name after a separating forward slash.                                                                                                                                             
                                                                                                                                                                                                                                                                                                                           
                            This allows the sender client to pass dispatch arguments to the accepting listener when it is not possible to include HTTP headers.                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                           
                            The expectation is that the listener framework will parse out the fixed path portion and the registered name from the path and make the remainder, possibly without any query string arguments prefixed by “sb-“, available to the application for deciding whether to accept the connection.  
                                                                                                                                                                                                                                                                                                                           
                            For more detail see the “Sender Protocol” section below.                                                                                                                                                                                                                                       |
| μικρές hc αναγνωριστικού | No        | Ανατρέξτε στο θέμα Περιγραφή του **αναγνωριστικού** παραπάνω.                                                                                                                                                                                                                                                              |

Εάν υπάρχει ένα σφάλμα, η υπηρεσία ενδέχεται να απαντήσετε ως εξής:

| Κωδικός | Σφάλμα          | Περιγραφή                         |
|------|----------------|-------------------------------------|
| 403  | Δεν επιτρέπεται      | Η διεύθυνση URL δεν είναι έγκυρη.               |
| 500  | Εσωτερικό σφάλμα | Παρουσιάστηκε κάποιο πρόβλημα στην υπηρεσία |

Αφού έχει δημιουργηθεί η σύνδεση, ο διακομιστής θα τερματιστεί η υποδοχή Web όταν τερματίζει την υποδοχή Web αποστολέα προς τα κάτω ή με την ακόλουθη κατάσταση

| Κατάσταση WS | Περιγραφή                                                                        |
|-----------|------------------------------------------------------------------------------------|
| 1001      | Το πρόγραμμα-πελάτη του αποστολέα τερματίζεται η σύνδεση                                        |
| 1001      | Τη διαδρομή υβριδική σύνδεσης έχει διαγραφεί ή έχει απενεργοποιηθεί.                           |
| 1008      | Έχει λήξει το διακριτικό ασφαλείας και, επομένως, είναι παραβιάζει την πολιτική εξουσιοδότησης. |
| 1011      | Παρουσιάστηκε κάποιο πρόβλημα μέσα στην υπηρεσία.                                           |

#### <a name="rejecting-the-socket"></a>Απόρριψη της υποδοχής

Απόρριψη της υποδοχής μετά την επιθεώρηση το μήνυμα "Αποδοχή" απαιτεί μια παρόμοια συγχρονισμός, έτσι ώστε να ρέει από τον κωδικό κατάστασης και περιγραφή κατάστασης ενημέρωση σχετικά με το λόγο για τον απόρριψης στον αποστολέα.

Η επιλογή σχεδίαση πρωτόκολλο εδώ είναι να χρησιμοποιήσετε μια συγχρονισμός WebSocket (που έχει σχεδιαστεί για να τερματίσετε σε κατάσταση σφάλματος καθορισμένο) ώστε να εφαρμογές προγράμματος-πελάτη ακρόασης να συνεχίσετε να βασίζεται σε ένα πρόγραμμα-πελάτη WebSocket και δεν χρειάζεται να χρησιμοποιούν ένα πρόσθετο, χωρίς λειτουργικό σύστημα HTTP προγράμματος-πελάτη.

Για να απορρίψετε την υποδοχή, ο υπολογιστής-πελάτης λαμβάνει τη διεύθυνση URI από το μήνυμα "Αποδοχή" και τοποθετεί δύο παραμέτρους συμβολοσειράς ερωτήματος:

| Παραμέτρου             | Απαιτείται; | Περιγραφή                             |
|-------------------|-----------|-----------------------------------------|
| statusCode        | Ναι       | Αριθμητικό κωδικό κατάστασης HTTP                |
| statusDescription | Ναι       | Ανθρώπινο αναγνώσιμο λόγο για την απόρριψη |

Το URI που προκύπτει, στη συνέχεια, χρησιμοποιείται για να δημιουργήσετε μια σύνδεση WebSocket; ξανά, έχετε υπόψη ότι το πιστοποιητικό TLS μπορεί να δεν ταιριάζουν με τη διεύθυνση κατά την προεπισκόπηση, ώστε να επικύρωσης, ίσως χρειαστεί να απενεργοποιηθεί.

Όταν ολοκληρώσετε σωστά, αυτό συγχρονισμός σκόπιμα θα αποτύχει με έναν κωδικό σφάλματος HTTP 410, επειδή δεν υπάρχει WebSocket έχει δημιουργηθεί. Εάν προκύψει σφάλμα, αυτές είναι οι επιλογές:

| Κωδικός | Σφάλμα          | Περιγραφή                         |
|------|----------------|-------------------------------------|
| 403  | Δεν επιτρέπεται      | Η διεύθυνση URL δεν είναι έγκυρη.               |
| 500  | Εσωτερικό σφάλμα | Παρουσιάστηκε κάποιο πρόβλημα στην υπηρεσία |

### <a name="listener-token-renewal"></a>Ανανέωση διακριτικών ακρόασης

Όταν το ακροατήριο διακριτικό πρόκειται να λήξει, το να την αντικαταστήσετε με την αποστολή ενός μηνύματος πλαισίου κειμένου για την υπηρεσία μέσω του καναλιού δημιουργίας στοιχείου ελέγχου. Το μήνυμα περιέχει ένα αντικείμενο JSON με το όνομα "renewToken", το οποίο ορίζει την ακόλουθη ιδιότητα αυτήν τη στιγμή:

-   **διακριτικού** – υβριδική σύνδεσης που παρέχει το δικαίωμα **ακρόαση** ή μια έγκυρη, κωδικοποιημένη διεύθυνση URL υπηρεσίας Bus θέσει σε κοινή χρήση Access διακριτικού για το χώρο ονομάτων.

| renewToken μήνυμα                                                                                                                                                    
|------------------------------------------------------------------------------------------------|
```json
{
    "renewToken" : {      
        "token" : "SharedAccessSignature sr=http%3a%2f%2fcontoso.servicebus.windows.net%2fHybridConnection1%2f&amp;sig=XXXXXXXXXX%3d&amp;se=1471633754&amp;skn=SasKeyName"
    }                                                                                                                                                            
}
```                                                                                                                                                                      

Εάν αποτύχει η επικύρωση διακριτικού, δεν επιτρέπεται η πρόσβαση και υπηρεσία cloud θα κλείσει το στοιχείο ελέγχου websocket καναλιού με ένα σφάλμα, διαφορετικά δεν υπάρχει καμία απάντηση.

| Κατάσταση WS | Περιγραφή                                                                        |
|-----------|------------------------------------------------------------------------------------|
| 1008      | Έχει λήξει το διακριτικό ασφαλείας και, επομένως, είναι παραβιάζει την πολιτική εξουσιοδότησης. |

<a name="sender-protocol"></a>Πρωτόκολλο αποστολέα
---------------

Το πρωτόκολλο αποστολέα είναι ουσιαστικά ίδια με πώς δημιουργείται μια παρακολούθηση. Ο στόχος είναι μέγιστο διαφάνειας για την υποδοχή Web για να ολοκληρωμένες. Η διεύθυνση για να συνδεθείτε με είναι η ίδια όπως για το ακροατήριο, αλλά διαφέρει από την "ενέργεια" και το διακριτικό χρειάζεται μια διαφορετική δικαιωμάτων:

*wss: / / {χώρος ονομάτων-διεύθυνση} /* *$servicebus* */* *hybridconnection /**{path}; μικρές-hc-ενέργεια =... & μικρές hc αναγνωριστικό =... \[& sbc-hc-διακριτικό =... \]*

Η *διεύθυνση χώρος ονομάτων* είναι το πλήρως προσδιορισμένο όνομα τομέα του χώρου ονομάτων αναμετάδοσης Azure που φιλοξενεί την υβριδική σύνδεσης, συνήθως της φόρμας {*myname}. servicebus.windows.net.*

Η αίτηση μπορεί να περιέχει αυθαίρετο επιπλέον HTTP κεφαλίδες, όπως ορίζεται από την εφαρμογή από αυτές. Όλες οι επικεφαλίδες που δόθηκε ροής για να το ακροατήριο και μπορείτε να βρείτε το αντικείμενο "connectHeader" του μηνύματος ελέγχου "Αποδοχή".

Οι επιλογές παραμέτρου συμβολοσειράς ερωτήματος είναι ως εξής

| Παραμέτρου        | Απαιτείται; | Περιγραφή                                                                                                                                                                                                       |
|--------------|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| μικρές-hc-ενέργειας | Ναι       | Για το ρόλο ακρόασης πρέπει να είναι η παράμετρος **ενέργειας = σύνδεση**                                                                                                                                                    |
| {path}       | Ναι       | Η διαδρομή URL κωδικοποιημένα χώρο ονομάτων της προδιαμορφωμένο υβριδική σύνδεσης για την καταχώρηση αυτό ακρόασης στην.                                                                                                               
                                                                                                                                                                                                                                               
                            The path expression MAY be extended with a suffix and a query string expression to communicate further                                                                                                             
                                                                                                                                                                                                                                               
                            If the Hybrid Connection is registered under the path “hyco”, the path expression can be “**hyco/**suffix?param=value&…” followed by the query string parameters defined here. A complete expression may then be:  
                                                                                                                                                                                                                                               
                            *wss://{ns}/**$servicebus**/**hybridconnection/*** **hyco/**suffix?param=value*& sb-hc-action=…&sb-hc-id=…\[&sbc-hc-token=…\]*                                                                                     
                                                                                                                                                                                                                                               
                            The path expression is passed through to the listener in the address URI contained in the “accept” control message.                                                                                                |
| μικρές-hc-διακριτικό | Yes\*     | Το ακροατήριο πρέπει να δώσετε μια έγκυρη, κωδικοποιημένη διεύθυνση URL υπηρεσίας Bus θέσει σε κοινή χρήση Access διακριτικού για το χώρο ονομάτων ή σύνδεση υβριδική που παρέχει το δικαίωμα **Αποστολή** .                                                            | | μικρές hc αναγνωριστικού | No        | Ένα προαιρετικό Αναγνωριστικό που σας επιτρέπει να ολοκληρωμένες διαγνωστικών ανίχνευση και γίνεται διαθέσιμη για το ακροατήριο κατά τη διάρκεια ο συγχρονισμός αποδοχή.                                                                                       |

Εάν αποτύχει η σύνδεση υποδοχής Web λόγω της διαδρομής σύνδεσης υβριδική δεν που έχουν καταχωρηθεί, ή ένα διακριτικό δεν είναι έγκυρη ή που λείπουν ή κάποιο άλλο σφάλμα, το σφάλμα σχολίων θα παρέχονται με το κανονικό μοντέλο σχολίων κατάστασης HTTP 1.1. Την περιγραφή της κατάστασης θα περιέχει ένα σφάλμα παρακολούθησης-αναγνωριστικό που μπορούν να κοινοποιηθούν για την υποστήριξη του Azure:

| Κωδικός | Σφάλμα          | Περιγραφή                                                            |
|------|----------------|------------------------------------------------------------------------|
| 404  | Δεν βρέθηκε      | Η σύνδεση υβριδική **διαδρομή** είναι έγκυρη ή τη βασική διεύθυνση URL είναι ακατάλληλη |
| 401  | Μη εξουσιοδοτημένο   | Είναι το διακριτικό ασφαλείας που λείπουν ή ακατάλληλη ή δεν είναι έγκυρη                  |
| 403  | Δεν επιτρέπεται      | Το διακριτικό ασφαλείας δεν είναι έγκυρο για αυτήν τη διαδρομή για αυτήν την ενέργεια          |
| 500  | Εσωτερικό σφάλμα | Παρουσιάστηκε κάποιο πρόβλημα στην υπηρεσία                                    |

Εάν η σύνδεση υποδοχής Web σκόπιμα τερματίζεται από την υπηρεσία αφού έχει οριστεί αρχικά προς τα επάνω, ο λόγος για αυτήν την ενέργεια, θα κοινοποιηθούν χρησιμοποιώντας κατάλληλο Web socket πρωτόκολλο κωδικός σφάλματος μαζί με ένα περιγραφικό μήνυμα λάθους που θα περιλαμβάνει επίσης ένα αναγνωριστικό παρακολούθησης.

| Κατάσταση WS | Περιγραφή                                                                        |
|-----------|------------------------------------------------------------------------------------|
| 1000      | Το ακροατήριο τερματισμός της υποδοχής.                                                 |
| 1001      | Τη διαδρομή υβριδική σύνδεσης έχει διαγραφεί ή έχει απενεργοποιηθεί.                           |
| 1008      | Έχει λήξει το διακριτικό ασφαλείας και, επομένως, είναι παραβιάζει την πολιτική εξουσιοδότησης. |
| 1011      | Παρουσιάστηκε κάποιο πρόβλημα μέσα στην υπηρεσία.                                           |

## <a name="next-steps"></a>Επόμενα βήματα:

- [Μετάδοση συνήθεις Ερωτήσεις](relay-faq.md)
- [Δημιουργία ενός χώρου ονομάτων](relay-create-namespace-portal.md)
- [Γρήγορα αποτελέσματα με το .NET](relay-hybrid-connections-dotnet-get-started.md)
- [Γρήγορα αποτελέσματα με το κόμβου](relay-hybrid-connections-node-get-started.md)