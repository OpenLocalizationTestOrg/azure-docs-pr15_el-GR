<properties
   pageTitle="Azure Αποκατάσταση υπηρεσίας ύφασμα | Microsoft Azure"
   description="Azure Service ύφασμα προσφέρει τις δυνατότητες που είναι απαραίτητο να ασχοληθείτε με όλους τους τύπους των καταστροφών. Σε αυτό το άρθρο περιγράφει τους τύπους καταστροφές που μπορεί να προκύψουν και πώς μπορείτε να ασχοληθείτε με αυτά."
   services="service-fabric"
   documentationCenter=".net"
   authors="seanmck"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotNet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="08/10/2016"
   ms.author="seanmck"/>

# <a name="disaster-recovery-in-azure-service-fabric"></a>Αποκατάσταση σε ύφασμα υπηρεσίας Azure

Ένα κρίσιμο μέρος της την εκτέλεση μιας εφαρμογής cloud υψηλής διαθεσιμότητας είναι να εξασφαλίσετε ότι το κατά όλους τους διαφορετικούς τύπους αποτυχίες, συμπεριλαμβανομένων και αυτών που βρίσκονται εκτός του στοιχείου ελέγχου. Σε αυτό το άρθρο περιγράφει η φυσική διάταξη της ένα σύμπλεγμα Azure Service ύφασμα στο περιβάλλον της πιθανές καταστροφές και παρέχει οδηγίες σχετικά με τον τρόπο για να ασχοληθείτε με τέτοιων καταστροφών για να περιορίσετε ή να αποκλείσετε τον κίνδυνο χρόνου εκτός λειτουργίας ή απώλειας δεδομένων.

## <a name="physical-layout-of-service-fabric-clusters-in-azure"></a>Φυσική διάταξη της υπηρεσίας ύφασμα συμπλεγμάτων στο Azure

Για να κατανοήσετε τον κίνδυνο που ενέχει διαφορετικούς τύπους αποτυχίες, είναι χρήσιμο να γνωρίζετε πώς συμπλεγμάτων φυσικά εμφανίζονται σε Azure.

Όταν δημιουργείτε ένα σύμπλεγμα ύφασμα υπηρεσίας στο Azure, πρέπει να επιλέξετε μια περιοχή όπου φιλοξενούνται. Η υποδομή Azure διατάξεις, στη συνέχεια, οι πόροι για το συγκεκριμένο σύμπλεγμα μέσα στην περιοχή, κυρίως τον αριθμό των εικονικές μηχανές (ΣΠΣ) ζητήθηκε. Ας εξετάσουμε πιο προσεκτικά τον τρόπο και το σημείο όπου έχουν παρασχεθεί αυτά τα ΣΠΣ.

### <a name="fault-domains"></a>Τομείς σφαλμάτων

Από προεπιλογή, το ΣΠΣ στο σύμπλεγμα είναι ομοιόμορφα εκτείνεται λογικές ομάδες, γνωστό ως σφαλμάτων τομείς (FDs), που τμήμα οι υπολογιστές που βασίζονται σε πιθανές αποτυχίες στο υλικό κεντρικού υπολογιστή. Συγκεκριμένα, εάν δύο ΣΠΣ που βρίσκονται σε δύο ξεχωριστές FDs, μπορείτε να βεβαιωθείτε ότι δεν έχουν τον ίδιο διακόπτη δικτύου ή προέλευσης power. Ως αποτέλεσμα, ένα τοπικό δίκτυο ή ρεύματος που επηρεάζουν μία Εικονική δεν θα επηρεάσει το άλλο, επιτρέποντας ύφασμα υπηρεσίας για νέα εξισορρόπηση τη φόρτωση εργασίας του υπολογιστή δεν ανταποκρίνεται μέσα στο σύμπλεγμα.

Μπορείτε να απεικονίσετε οπτικά τη διάταξη του συμπλέγματος σε όλους τους τομείς σφαλμάτων με τη χρήση των σύμπλεγμα που παρέχεται στην [Εξερεύνηση ύφασμα υπηρεσίας](service-fabric-visualizing-your-cluster.md):

![Οι κόμβοι που εκτείνεται τομείς σφαλμάτων στην Εξερεύνηση ύφασμα υπηρεσίας][sfx-cluster-map]

>[AZURE.NOTE] Άλλες άξονα στο χάρτη σύμπλεγμα εμφανίζει αναβάθμισης τομείς, οι οποίοι λογικά ομαδοποίηση κόμβους που βασίζονται σε δραστηριότητες προγραμματισμένη συντήρηση. Υπηρεσία ύφασμα συμπλεγμάτων στο Azure πάντα διάταξη πέντε αναβάθμισης τομέων.

### <a name="geographic-distribution"></a>Γεωγραφική κατανομή

Υπάρχουν αυτήν τη στιγμή [26 Azure περιοχές σε όλο τον κόσμο][azure-regions], με αρκετά πιο ανακοινώθηκε. Μια περιοχή μεμονωμένα μπορεί να περιέχει ένα ή περισσότερα κέντρα δεδομένων φυσικής ανάλογα με το ζήτηση και τη διαθεσιμότητα των κατάλληλες θέσεις, μεταξύ άλλων παραγόντων. Ωστόσο, σημειώστε ότι ακόμη και σε περιοχές που περιέχουν πολλά κέντρα δεδομένων φυσικής, δεν υπάρχει εγγύηση ότι το σύμπλεγμά ΣΠΣ θα είναι ομοιόμορφα που εκτείνεται φυσικής αυτές τις θέσεις. Στην πραγματικότητα, προς το παρόν, όλα ΣΠΣ για ένα δεδομένο σύμπλεγμα έχουν παρασχεθεί μέσα σε μια μεμονωμένη τοποθεσία φυσικής.

## <a name="dealing-with-failures"></a>Χειρισμός αποτυχίες

Υπάρχουν διάφοροι τύποι αποτυχιών που μπορούν να επηρεάσουν το σύμπλεγμά σας, κάθε μία με τη δική του μετριασμού. Θα εξετάσουμε τα με τη σειρά πιθανότητα να προκύψει.

### <a name="individual-machine-failures"></a>Αποτυχίες μεμονωμένα υπολογιστή

Όπως αναφέρθηκε, μεμονωμένα μηχανικής αποτυχίες, είτε μέσα η Εικονική είτε σε υλικού ή λογισμικού φιλοξενίας που βασίζεται σε έναν τομέα σφαλμάτων, χωρίς κινδύνους μόνος του. Υπηρεσία ύφασμα συνήθως θα εντοπίσει την αποτυχία μέσα σε δευτερόλεπτα και να απαντούν ανάλογα με βάση την κατάσταση του συμπλέγματος. Για παράδειγμα, εάν ο κόμβος ήταν φιλοξενίας την κύρια αντίγραφα για ένα διαμερίσματα, μια νέα κύρια αυτή από τα διαμερίσματα δευτερεύοντα αντίγραφα. Όταν Azure επαναφέρει αποτυχίας υπολογιστή δημιουργίας αντιγράφων ασφαλείας, θα επανάληψη συμμετοχής στο σύμπλεγμα αυτόματα και θα χρησιμοποιήσετε ξανά την κοινή χρήση από το φόρτο εργασίας.

### <a name="multiple-concurrent-machine-failures"></a>Πολλαπλές αποτυχίες ταυτόχρονες υπολογιστή

Ενώ τομείς σφαλμάτων μειώνουν σημαντικά τον κίνδυνο αποτυχιών ταυτόχρονες υπολογιστή, υπάρχει πάντα το ενδεχόμενο πολλών τυχαίες αποτυχίες για να εμφανίσετε ταυτόχρονα προς τα κάτω πολλές μηχανές σε ένα σύμπλεγμα.

Σε γενικές γραμμές, με την προϋπόθεση ότι ένα μεγαλύτερο μέρος των τους κόμβους παραμένουν διαθέσιμα, το σύμπλεγμα θα συνεχίσει να λειτουργεί, μολονότι στο κάτω ιδιότητά του ως κατάστασης αντίγραφα γρήγορα συσκευασμένο σε ένα μικρότερο σύνολο μηχανές και λιγότερες χωρίς κατάσταση παρουσίες είναι διαθέσιμες για να διαδώσετε φόρτωση.

#### <a name="quorum-loss"></a>Απώλεια απαρτίας

Εάν ένα μεγαλύτερο μέρος των τα αντίγραφα για διαμερίσματα της κατάστασης υπηρεσίας μεταβείτε προς τα κάτω, διαμερισμάτων που μεταβαίνει σε κατάσταση γνωστό ως "απαρτίας απώλεια." Σε αυτό το σημείο, υπηρεσία ύφασμα σταματά επιτρέποντάς εγγραφές που διαμερίσματα για να βεβαιωθείτε ότι η κατάστασή παραμένει συνεπή και αξιόπιστη. Στην πραγματικότητα, θα σας επιλογή για να αποδεχτείτε μια περίοδο μη διαθεσιμότητα για να βεβαιωθείτε ότι οι υπολογιστές-πελάτες είναι αναφέρεται δεν ότι τα δεδομένα έχουν αποθηκευτεί όταν στην πραγματικότητα δεν ήταν. Λάβετε υπόψη ότι εάν έχετε επιλέξει να υπάρχει δυνατότητα διαβάζει από δευτερεύοντα αντίγραφα για αυτήν την υπηρεσία κατάστασης, μπορείτε να συνεχίσετε να εκτελέσετε τις λειτουργίες ενώ βρίσκεστε σε αυτήν την κατάσταση ανάγνωσης. Ένα διαμερίσματα παραμένουν απώλεια απαρτίας έως ότου αρκετά αντίγραφα επιστρέψει ή ο διαχειριστής συμπλέγματος επιβάλει το σύστημα για να μετακινήσετε με χρήση του [API του επιδιόρθωση ServiceFabricPartition][repair-partition-ps].

>[AZURE.WARNING] Εκτέλεση μιας ενέργειας του επιδιόρθωση, ενώ η κύρια ρεπλίκα είναι προς τα κάτω θα έχει ως αποτέλεσμα την απώλεια δεδομένων.

Υπηρεσίες συστήματος επίσης μπορεί να υποστεί απώλεια απαρτίας, με την επίδραση που αφορούν την υπηρεσία εν λόγω. Για παράδειγμα, απώλεια απαρτίας στην υπηρεσία ονομασίας θα επηρεάσει ανάλυση ονόματος, ότι αποκλείει την απώλεια απαρτίας στην υπηρεσία διαχείρισης ανακατεύθυνσης Δημιουργία νέας υπηρεσίας και ανακατευθύνσεις. Σημειώστε ότι σε αντίθεση με τη δική σας περίπτωση υπηρεσιών, επιχειρήσετε να επιδιορθώσετε υπηρεσίες συστήματος είναι *δεν* συνιστάται. Αντί για αυτό, είναι προτιμότερο να απλώς περιμένετε να επιστρέψει την κάτω αντίγραφα.

#### <a name="minimizing-the-risk-of-quorum-loss"></a>Ελαχιστοποίηση του κινδύνου ζημίας απαρτίας

Μπορείτε να ελαχιστοποιήσετε τον κίνδυνο απώλειας απαρτίας, αυξάνοντας το μέγεθος του συνόλου ρεπλίκα προορισμού της υπηρεσίας. Είναι χρήσιμο να πιστεύετε ότι του αριθμού των αντίγραφα χρειάζεστε όσον αφορά τον αριθμό των μη διαθέσιμες κόμβους που μπορεί να αποδεχτεί τις στο μόλις ενώ παραμένει διαθέσιμη για εγγραφές, διατηρώντας σε υπόψη αυτής της εφαρμογής ή αναβαθμίσεις σύμπλεγμα μπορεί να κάνει κόμβους προσωρινά μη διαθέσιμος, εκτός από την αποτυχία υλικού.

Λάβετε υπόψη τα παρακάτω παραδείγματα, υπό την προϋπόθεση ότι ότι έχετε ρυθμίσει τις παραμέτρους των υπηρεσιών σας για να έχετε μια MinReplicaSetSize τριών, τον μικρότερο αριθμό για τις υπηρεσίες παραγωγής. Με μια TargetReplicaSetSize τριών (ένα κύριο και δύο secondaries), ένα σφάλμα υλικού κατά την αναβάθμιση (δύο αντίγραφα προς τα κάτω) θα έχει ως αποτέλεσμα την απώλεια απαρτίας και την υπηρεσία θα γίνουν μόνο για ανάγνωση. Εναλλακτικά, εάν έχετε πέντε αντίγραφα, θα ήταν μπορούν να δέχονται δύο αποτυχίες κατά την αναβάθμιση (τρεις αντίγραφα προς τα κάτω), όπως τα υπόλοιπα αντίγραφα δύο εξακολουθούν να μπορούν να φόρμας απαρτίας εντός του συνόλου ελάχιστη αντιγράφου.

### <a name="data-center-outages-or-destruction"></a>Διακοπές του κέντρου δεδομένων ή την καταστροφή

Στην περίπτωση αυτή, μπορεί να γίνει προσωρινά διαθέσιμες λόγω απώλεια σύνδεσης δικτύου ή power κέντρα δεδομένων φυσικής. Σε αυτές τις περιπτώσεις, τα συμπλεγμάτων ύφασμα υπηρεσίας και τις εφαρμογές με τον ίδιο τρόπο θα είναι διαθέσιμη, αλλά θα διατηρηθούν τα δεδομένα σας. Για συμπλεγμάτων εκτελείται στο Azure, μπορείτε να προβάλετε ενημερωμένες εκδόσεις στη ΡΕΥΜΑΤΟΣ στη [σελίδα κατάστασης Azure][azure-status-dashboard].

Στην περίπτωση ιδιαίτερα πιθανό ότι ένα κέντρο ολόκληρο φυσικής δεδομένων έχει καταστραφεί, οποιαδήποτε υπηρεσία ύφασμα συμπλεγμάτων φιλοξενούνται εκεί θα χαθούν, μαζί με την κατάστασή τους.

Για να προστατεύσετε σε σχέση με τη δυνατότητα αυτή, είναι εξαιρετικά σημαντικά περιοδικά [Δημιουργία αντιγράφων ασφαλείας την κατάσταση](service-fabric-reliable-services-backup-restore.md) σε ένα χώρο αποθήκευσης παν πλεονάζοντα και βεβαιωθείτε ότι μπορείτε να επικυρωθεί τη δυνατότητα να το επαναφέρετε. Πόσο συχνά μπορείτε να δημιουργήσετε ένα αντίγραφο ασφαλείας θα εξαρτάται από το σημείο στόχο ανάκτησης (RPO). Ακόμα και αν δεν έχει υλοποιηθεί πλήρως δημιουργίας αντιγράφων ασφαλείας και επαναφορά ακόμα, θα πρέπει να υλοποιήσετε ένα πρόγραμμα χειρισμού για το `OnDataLoss` συμβάν έτσι ώστε να μπορείτε να συνδεθείτε όταν αυτή εμφανίζεται ως εξής:

```c#
protected virtual Task<bool> OnDataLoss(CancellationToken cancellationToken)
{
  ServiceEventSource.Current.ServiceMessage(this, "OnDataLoss event received.");
  return Task.FromResult(true);
}
```


### <a name="software-failures-and-other-sources-of-data-loss"></a>Αποτυχίες λογισμικού και άλλες πηγές απώλειας δεδομένων

Ως αιτία απώλειας δεδομένων, κωδικός ελαττώματα σε υπηρεσίες, human λειτουργικά σφάλματα και παραβιάσεις ασφαλείας είναι πιο κοινές από ευρεία δεδομένων κέντρου αποτυχίες. Ωστόσο, σε όλες τις περιπτώσεις, η ανάκτηση στρατηγική είναι η ίδια: λήψη τακτικής δημιουργίας αντιγράφων ασφαλείας όλων των υπηρεσιών κατάστασης και να τη δυνατότητα να επαναφέρετε αυτήν την κατάσταση.

## <a name="next-steps"></a>Επόμενα βήματα

- Μάθετε πώς μπορείτε να προσομοιώσετε διάφορες αποτυχίες χρησιμοποιώντας το [πλαίσιο με δυνατότητα δοκιμής](service-fabric-testability-overview.md)
- Διαβάστε άλλων αποκατάστασης και υψηλής διαθεσιμότητας πόρων. Η Microsoft έχει δημοσιεύσει μια μεγάλη ποσότητα καθοδήγηση σχετικά με αυτά τα θέματα. Ενώ ορισμένα από αυτά τα έγγραφα αναφέρονται σε συγκεκριμένες τεχνικές για χρήση με άλλα προϊόντα, μπορούν να περιέχουν πολλά γενικά βέλτιστες πρακτικές μπορείτε να εφαρμόσετε στο περιβάλλον ύφασμα υπηρεσίας:
 - [Λίστα ελέγχου διαθεσιμότητας](../best-practices-availability-checklist.md)
 - [Εκτέλεση αποκατάστασης από καταστροφή εμφάνιση λεπτομερειών](../sql-database/sql-database-disaster-recovery-drills.md)
 - [Αποκατάσταση και υψηλή διαθεσιμότητα για τις εφαρμογές του Azure][dr-ha-guide]


<!-- External links -->

[repair-partition-ps]: https://msdn.microsoft.com/library/mt163522.aspx
[azure-status-dashboard]:https://azure.microsoft.com/status/
[azure-regions]: https://azure.microsoft.com/regions/
[dr-ha-guide]: https://msdn.microsoft.com/library/azure/dn251004.aspx


<!-- Images -->

[sfx-cluster-map]: ./media/service-fabric-disaster-recovery/sfx-clustermap.png
