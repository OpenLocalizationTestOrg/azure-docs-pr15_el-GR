<properties
   pageTitle="Χρήση Elasticsearch ως χώρος αποθήκευσης ανίχνευση εφαρμογής υπηρεσίας ύφασμα | Microsoft Azure"
   description="Περιγράφει τον τρόπο εφαρμογές υπηρεσίας ύφασμα μπορούν να χρησιμοποιήσουν Elasticsearch και Kibana για την αποθήκευση, index, και αναζήτηση σε ανιχνεύσεις εφαρμογής (αρχεία καταγραφής)"
   services="service-fabric"
   documentationCenter=".net"
   authors="karolz-ms"
   manager="adegeo"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotNet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="08/09/2016"
   ms.author="karolz@microsoft.com"/>

# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a>Χρήση Elasticsearch ως μια ανίχνευση εφαρμογής υπηρεσίας ύφασμα αποθήκευση
## <a name="introduction"></a>Εισαγωγή
Σε αυτό το άρθρο περιγράφει πώς [Azure Service ύφασμα](https://azure.microsoft.com/documentation/services/service-fabric/) εφαρμογές μπορούν να χρησιμοποιήσουν **Elasticsearch** και **Kibana** για το χώρο αποθήκευσης ανίχνευση εφαρμογής, η δημιουργία ευρετηρίου και αναζήτησης. [Elasticsearch](https://www.elastic.co/guide/index.html) είναι ένας ανοιχτού κώδικα, κατανέμεται και μεταβλητού μεγέθους σε πραγματικό χρόνο αναζήτησης και τις αναλύσεις μηχανισμός που είναι κατάλληλη για αυτήν την εργασία. Αυτό μπορεί να εγκατασταθεί σε Windows και Linux εικονικές μηχανές εκτελούνται στο Microsoft Azure. Elasticsearch αποτελεσματικά μπορεί να επεξεργαστεί *δομημένες* ανιχνεύσεις παραχθεί χρησιμοποιώντας τεχνολογίες, όπως **Συμβάντων ανίχνευσης για Windows (ETW)**.

ETW χρησιμοποιείται από runtime ύφασμα υπηρεσίας για να διαγνωστικών πληροφοριών προέλευσης (ανιχνεύσεις). Είναι η προτεινόμενη μέθοδος για τους πληροφορίες διαγνωστικών, προέλευσης πολύ εφαρμογές υπηρεσίας ύφασμα. Χρησιμοποιώντας τον ίδιο μηχανισμό επιτρέπει συσχέτισης μεταξύ που παρέχεται από το χρόνο εκτέλεσης και που παρέχονται από εφαρμογή ανιχνεύσεις και κάνει ευκολότερη την αντιμετώπιση προβλημάτων. Πρότυπα έργων ύφασμα υπηρεσίας στο Visual Studio περιλαμβάνουν καταγραφής API (με βάση την κλάση .NET **Προέλευση_συμβάντος** ) που εκπέμπει ανιχνεύσεις ETW από προεπιλογή. Για μια γενική επισκόπηση της ανίχνευσης εφαρμογής υπηρεσίας ύφασμα χρησιμοποιώντας ETW, ανατρέξτε στο θέμα [Παρακολούθηση και τη διάγνωση υπηρεσίες σε μια ρύθμιση ανάπτυξης του τοπικού υπολογιστή](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).

Για τα ίχνη ώστε να εμφανίζεται στο Elasticsearch, πρέπει να είναι καταγράφονται στην υπηρεσία ύφασμα κόμβους σε πραγματικό χρόνο (ενώ εκτελείται η εφαρμογή) και να σταλεί σε ένα τελικό σημείο Elasticsearch. Υπάρχουν δύο κύριες επιλογές για την καταγραφή ανίχνευσης:

+ **Καταγραφή ανίχνευση σε εξέλιξη**  
Της εφαρμογής ή μεγαλύτερη ακρίβεια, διαδικασία της υπηρεσίας, είναι υπεύθυνος για την αποστολή του διαγνωστικών δεδομένα στο χώρο αποθήκευσης ανίχνευση (Elasticsearch).

+ **Καταγραφή εκτός της διαδικασίας ανίχνευσης**  
Μια ξεχωριστή παράγοντας είναι καταγραφή ανιχνεύσεις από τη διαδικασία της υπηρεσίας ή διαδικασιών και αποστολή στο χώρο αποθήκευσης ανίχνευση.

Παρακάτω, θα σας περιγράφουν πώς να ρυθμίσετε Elasticsearch στην Azure, να συζητήσετε για επαγγελματίες και τα μειονεκτήματα για τα δύο καταγραφή επιλογές και εξηγούν πώς μπορείτε να ρυθμίσετε τις παραμέτρους μιας υπηρεσίας ύφασμα υπηρεσία για την αποστολή δεδομένων σε Elasticsearch.


## <a name="set-up-elasticsearch-on-azure"></a>Ρύθμιση του Elasticsearch σε Azure
Ο πιο άμεσος τρόπος για να ρυθμίσετε την υπηρεσία Elasticsearch σε Azure είναι πρότυπα [**Για τη διαχείριση πόρων Azure**](../azure-resource-manager/resource-group-overview.md). Μια ολοκληρωμένη [πρότυπο διαχείρισης πόρων Azure γρήγορης έναρξης για Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) είναι διαθέσιμο από γρήγορη έναρξη Azure πρότυπα αποθετήριο. Αυτό το πρότυπο χρησιμοποιεί λογαριασμούς ξεχωριστή χώρου αποθήκευσης για μονάδες κλίμακας (ομάδες κόμβοι). Το επίσης μπορούν να προμηθεύσουν ξεχωριστή προγράμματος-πελάτη και διακομιστή κόμβους με διαφορετικές ρυθμίσεις παραμέτρων και διάφορους αριθμών δίσκων δεδομένων που έχουν επισυναφθεί.

Εδώ, χρησιμοποιήστε ένα άλλο πρότυπο, που ονομάζεται **Εσ MultiNode** από το [Azure διαγνωστικά εργαλεία αποθετήριο](https://github.com/Azure/azure-diagnostics-tools). Αυτό το πρότυπο είναι ευκολότερο να χρησιμοποιήσετε και δημιουργεί ένα σύμπλεγμα Elasticsearch προστατεύονται από HTTP βασικό έλεγχο ταυτότητας. Πριν να συνεχίσετε, κάντε λήψη του αποθετηρίου από GitHub στον υπολογιστή σας (με κλωνοποίηση του αποθετηρίου είτε με τη λήψη ένα αρχείο zip). Το πρότυπο ΕΣ MultiNode βρίσκεται στο φάκελο με το ίδιο όνομα.

### <a name="prepare-a-machine-to-run-elasticsearch-installation-scripts"></a>Προετοιμασία ενός υπολογιστή για να εκτελούν δέσμες ενεργειών εγκατάστασης Elasticsearch
Ο ευκολότερος τρόπος για να χρησιμοποιήσετε το πρότυπο ΕΣ MultiNode είναι μέσω παρεχόμενη δέσμη ενεργειών Azure PowerShell που ονομάζεται `CreateElasticSearchCluster`. Για να χρησιμοποιήσετε αυτήν τη δέσμη ενεργειών, πρέπει να εγκαταστήσετε το PowerShell λειτουργικές μονάδες και ένα εργαλείο που ονομάζεται **openssl**. Η τελευταία είναι απαραίτητη για τη δημιουργία ενός αριθμού-κλειδιού SSH που μπορούν να χρησιμοποιηθούν για να διαχειριστείτε το σύμπλεγμά σας Elasticsearch από απόσταση.

`CreateElasticSearchCluster`δέσμη ενεργειών έχει σχεδιαστεί για μεγαλύτερη ευκολία στη χρήση με το πρότυπο ΕΣ MultiNode από έναν υπολογιστή Windows. Μπορείτε να χρησιμοποιήσετε το πρότυπο σε υπολογιστή εκτός των Windows, αλλά αυτό το σενάριο είναι πέρα από το πεδίο αυτού του άρθρου.

1. Εάν δεν έχετε εγκαταστήσει τις ήδη, εγκαταστήστε το [**Azure PowerShell λειτουργικές μονάδες**](http://aka.ms/webpi-azps). Όταν σας ζητηθεί, κάντε κλικ στην επιλογή **Εκτέλεση**, στη συνέχεια, να **εγκαταστήσετε**. Απαιτείται Azure PowerShell 1,3 ή νεότερη έκδοση.

2. Το εργαλείο **openssl** περιλαμβάνει την κατανομή των [**Git για Windows**](http://www.git-scm.com/downloads). Εάν δεν το έχετε κάνει ήδη, εγκαταστήστε τώρα [Git για Windows](http://www.git-scm.com/downloads) . (Τις προεπιλεγμένες επιλογές εγκατάστασης είναι OK).

3. Εάν υποθέσουμε ότι Git που έχει εγκατασταθεί αλλά δεν περιλαμβάνεται στη διαδρομή συστήματος, ανοίξτε ένα παράθυρο του Microsoft Azure PowerShell και εκτελέστε τις ακόλουθες εντολές:

    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```

    Αντικαταστήστε το `<Git installation folder>` με τη θέση Git στον υπολογιστή σας; η προεπιλογή είναι **"C:\Program Files\Git"**. Σημείωση το χαρακτήρα ελληνικό ερωτηματικό στην αρχή της πρώτης διαδρομής.

4. Βεβαιωθείτε ότι είστε συνδεδεμένοι Azure (μέσω [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) και ότι έχετε επιλέξει τη συνδρομή στην οποία θα χρησιμοποιηθεί για να δημιουργήσετε το σύμπλεγμά σας ελαστικότητας αναζήτησης. Μπορείτε να επαληθεύσετε ότι έχει επιλεγεί σωστό συνδρομής με χρήση `Get-AzureRmContext` και `Get-AzureRmSubscription` cmdlet του.

5. Εάν δεν το έχετε κάνει ήδη, μεταβείτε στο φάκελο MultiNode ΕΣ του τρέχοντος καταλόγου.

### <a name="run-the-createelasticsearchcluster-script"></a>Εκτελέστε τη δέσμη ενεργειών CreateElasticSearchCluster
Πριν εκτελέσετε τη δέσμη ενεργειών, ανοίξτε το `azuredeploy-parameters.json` αρχείων και επαλήθευση ή δώστε τις τιμές για τις παραμέτρους δέσμης ενεργειών. Παρέχονται οι ακόλουθες παράμετροι:

|Όνομα παραμέτρου           |Περιγραφή|
|-----------------------  |--------------------------|
|dnsNameForLoadBalancerIP |Το όνομα που χρησιμοποιείται για να δημιουργήσετε το κοινό ορατό όνομα DNS για το σύμπλεγμα ελαστικότητας αναζήτησης (προσαρτώντας Azure περιοχή τομέα για το όνομα που πληκτρολογήθηκε). Για παράδειγμα, εάν η τιμή αυτή η παράμετρος είναι "myBigCluster" και η επιλεγμένη περιοχή Azure είναι Δυτική η.π.α., το όνομα που προκύπτει DNS για το σύμπλεγμα είναι myBigCluster.westus.cloudapp.azure.com. <br /><br />Αυτό το όνομα λειτουργεί επίσης ως ένα όνομα ριζικού για πολλά αντικείμενα που σχετίζονται με το σύμπλεγμα ελαστικότητας αναζήτησης, όπως ονόματα κόμβου δεδομένων.|
|adminUsername           |Το όνομα του λογαριασμού του διαχειριστή για τη διαχείριση του συμπλέγματος ελαστικότητας αναζήτησης (αντίστοιχα κλειδιά SSH δημιουργούνται αυτόματα).|
|dataNodeCount           |Ο αριθμός των κόμβους του συμπλέγματος ελαστικότητας αναζήτησης. Η τρέχουσα έκδοση της δέσμης ενεργειών δεν κάνει διάκριση κόμβους δεδομένων και ερωτήματος; Όλοι οι κόμβοι αναπαραγωγή τους ρόλους και τα δύο. Η προεπιλεγμένη τιμή 3 κόμβους.|
|dataDiskSize            |Το μέγεθος των δεδομένων δίσκων (σε GB) που έχει εκχωρηθεί για κάθε κόμβο δεδομένων. Κάθε κόμβο λαμβάνει 4 δίσκων δεδομένων, αποκλειστικά αφοσιωμένη στο να υπηρεσίας ελαστικότητας αναζήτησης.|
|περιοχή                  |Το όνομα του Azure περιοχής όπου πρέπει να βρίσκονται στο σύμπλεγμα ελαστικότητας αναζήτησης.|
|esUserName              |Το όνομα χρήστη του χρήστη που έχει ρυθμιστεί ώστε να έχετε πρόσβαση σε σύμπλεγμα ΕΣ (υπόκεινται HTTP βασικό έλεγχο ταυτότητας). Ο κωδικός πρόσβασης δεν αποτελεί μέρος του αρχείου παραμέτρους και πρέπει να παρέχεται όταν `CreateElasticSearchCluster` δέσμη ενεργειών ενεργοποιείται.|
|vmSizeDataNodes         |Το μέγεθος του Azure εικονική μηχανή για κόμβους συμπλέγματος ελαστικότητας αναζήτησης. Η προεπιλεγμένη τιμή Standard_D2.|

Τώρα είστε έτοιμοι να εκτελέσετε τη δέσμη ενεργειών. Εισαγάγετε την ακόλουθη εντολή:

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

όπου 

|Όνομα παραμέτρου δέσμης ενεργειών    |Περιγραφή|
|-----------------------  |--------------------------|
|`<es-group-name>`        |Το όνομα της ομάδας Azure πόρων που θα περιέχει όλους τους πόρους συμπλέγματος ελαστικότητας αναζήτησης.|
|`<azure-region>`         |Το όνομα της περιοχής Azure όπου θα πρέπει να δημιουργηθεί το σύμπλεγμα ελαστικότητας αναζήτησης.|         
|`<es-password>`          |Ο κωδικός πρόσβασης για το χρήστη ελαστικότητας αναζήτησης.|

>[AZURE.NOTE] Εάν λάβετε ένα NullReferenceException από το cmdlet δοκιμής AzureResourceGroup, έχετε ξεχάσει για να συνδεθείτε με Azure (`Add-AzureRmAccount`).

Εάν λάβετε ένα σφάλμα από την εκτέλεση της δέσμης ενεργειών και διαπιστώσετε ότι το σφάλμα προκλήθηκε από μια τιμή παραμέτρου λάθος πρότυπο, διορθώσετε το αρχείο παραμέτρων και εκτελέστε ξανά τη δέσμη ενεργειών με ένα όνομα ομάδας διαφορετικό πόρο. Μπορείτε επίσης να εκ νέου χρήση το ίδιο όνομα ομάδας πόρων και να ρυθμίσετε τη δέσμη ενεργειών εκκαθάριση το παλαιό προσθέτοντας το `-RemoveExistingResourceGroup` παράμετρος της κλήσης δέσμης ενεργειών.

### <a name="result-of-running-the-createelasticsearchcluster-script"></a>Αποτέλεσμα από την εκτέλεση της δέσμης ενεργειών CreateElasticSearchCluster
Μετά την εκτέλεση του `CreateElasticSearchCluster` δέσμης ενεργειών, τα ακόλουθα αντικείμενα κύριο θα δημιουργηθεί. Για αυτό το παράδειγμα υποθέσουμε ότι ότι έχετε χρησιμοποιήσει "myBigCluster" ως τιμή του το `dnsNameForLoadBalancerIP` παράμετρο και ότι η περιοχή όπου δημιουργήσατε το σύμπλεγμα είναι Δυτική η.π.α..

|Αντικείμενο|Όνομα, θέση και παρατηρήσεις|
|----------------------------------|----------------------------------|
|Πλήκτρο SSH για απομακρυσμένης διαχείρισης |αρχείο myBigCluster.key (στον κατάλογο από τον οποίο εκτελέστηκε το CreateElasticSearchCluster). <br /><br />Αυτό το αρχείο κλειδιού μπορεί να χρησιμοποιηθεί για τη σύνδεση στον κόμβο διαχείρισης και (μέσω τον κόμβο διαχείρισης) για να τους κόμβους δεδομένων του συμπλέγματος.|
|Διαχείριση κόμβου                        |myBigCluster admin.westus.cloudapp.azure.com <br /><br />Μια αποκλειστική Εικονική για διαχείριση απομακρυσμένου συμπλέγματος Elasticsearch--ο μοναδικός χρήστης που επιτρέπει εξωτερικές συνδέσεις SSH. Εκτελείται στον ίδιο εικονικό δίκτυο με όλους τους κόμβους συμπλεγμάτων Elasticsearch, αλλά δεν εκτελείται οποιεσδήποτε υπηρεσίες Elasticsearch.|
|Οι κόμβοι δεδομένων                        |myBigCluster1... myBigCluster*N* <br /><br />Κόμβοι δεδομένων που εκτελούνται υπηρεσίες Elasticsearch και Kibana. Μπορείτε να συνδεθείτε μέσω SSH σε κάθε κόμβο, αλλά μόνο μέσω του κόμβου διαχείρισης.|
|Elasticsearch συμπλέγματος             |http://myBigCluster.westus.cloudapp.Azure.com/ES/ <br /><br />Το κύριο τελικό σημείο για το σύμπλεγμα Elasticsearch (Σημειώστε το επίθημα /es). Προστατεύεται με βασικό έλεγχο ταυτότητας HTTP (τα διαπιστευτήρια που έχουν τις καθορισμένες παραμέτρους esUserName/esPassword του προτύπου MultiNode ΕΣ). Το σύμπλεγμα έχει επίσης τον προϊστάμενο προσθήκης εγκατεστημένο (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) για διαχείριση βασικές σύμπλεγμα.|
|Υπηρεσία Kibana                    |http://myBigCluster.westus.cloudapp.Azure.com <br /><br />Η υπηρεσία Kibana έχει ρυθμιστεί ώστε να εμφανίζει τα δεδομένα από το σύμπλεγμα Elasticsearch που έχουν δημιουργηθεί. Προστατεύεται με τα ίδια διαπιστευτήρια ελέγχου ταυτότητας ως το σύμπλεγμα μόνη.|

## <a name="in-process-versus-out-of-process-trace-capturing"></a>Σε εξέλιξη έναντι καταγραφή εκτός της διαδικασίας ανίχνευσης
Στην εισαγωγή, αναφέρθηκε δύο βασικοί τρόποι με τους της συλλογής δεδομένων διαγνωστικών: σε εξέλιξη και εκτός της διαδικασίας. Κάθε έχει πλεονεκτήματα και μειονεκτήματα.

Τα πλεονεκτήματα της **καταγραφής ανίχνευσης σε εξέλιξη** είναι:

1. *Εύκολης ρύθμισης παραμέτρων και την ανάπτυξη*

    * Η ρύθμιση παραμέτρων της συλλογής δεδομένων διαγνωστικών είναι μόνο μέρος της ρύθμισης παραμέτρων της εφαρμογής. Είναι εύκολο να διατηρείτε πάντα το "συγχρονισμένοι" με το υπόλοιπο της εφαρμογής.

    * Ρύθμιση παραμέτρων ανά εφαρμογή ή ανά υπηρεσία είναι εφικτό εύκολα.

    * Καταγραφή εκτός της διαδικασίας ανίχνευσης συνήθως απαιτεί μια ξεχωριστή ανάπτυξης και ρύθμισης παραμέτρων του διαγνωστικών παράγοντα, που είναι μια εργασία επιπλέον διαχείρισης και μια πιθανή πηγή σφάλματα. Η συγκεκριμένη παράγοντας τεχνολογία επιτρέπει συχνά μόνο μία παρουσία του παράγοντα ανά εικονική μηχανή (κόμβο). Αυτό σημαίνει ότι η ρύθμιση παραμέτρων για τη συλλογή της ρύθμισης παραμέτρων διαγνωστικών χρησιμοποιούνται από κοινού από όλες τις εφαρμογές και υπηρεσίες που εκτελούνται σε αυτόν τον κόμβο.

2. *Ευελιξία*

    * Η εφαρμογή να στείλετε τα δεδομένα, όπου και αν χρειάζεται να μεταβείτε, με την προϋπόθεση ότι υπάρχει μια βιβλιοθήκη προγράμματος-πελάτη που υποστηρίζει το σύστημα αποθήκευσης δεδομένων προορισμού. Μπορείτε να προσθέσετε νέα δέκτες σύμφωνα με τις προτιμήσεις.

    * Μπορεί να υλοποιηθεί σύνθετων κανόνων καταγραφής, φιλτράρισμα και συγκέντρωση δεδομένων.

    * Μια καταγραφή εκτός της διαδικασίας ανίχνευσης συχνά περιορίζεται από τη δέκτες δεδομένων που υποστηρίζει τον παράγοντα. Ορισμένες παράγοντες είναι επεκτάσιμη.

3. *Πρόσβαση σε δεδομένα εσωτερική εφαρμογή και περιβάλλον*

    * Υποσυστήματος διαγνωστικών εκτελείται εντός της διαδικασίας/υπηρεσία εφαρμογής εύκολα να ενισχύσετε την ανιχνεύσεις με τις πληροφορίες με βάση τα συμφραζόμενα.

    * Στο η προσέγγιση εκτός της διαδικασίας, πρέπει να αποστέλλονται τα δεδομένα σε έναν παράγοντα μέσω ορισμένες μηχανισμού επικοινωνία μεταξύ διαδικασιών, όπως η παρακολούθηση συμβάντων για τα Windows. Αυτός ο μηχανισμός θα μπορούσε να επιβληθούν περιορισμοί επιπλέον.

Τα πλεονεκτήματα της την **Καταγραφή εκτός της διαδικασίας ανίχνευσης** περιλαμβάνουν τα εξής:

1. *Η δυνατότητα για την παρακολούθηση της εφαρμογής και συλλογής σφάλμα Αποτυπώνει*

    * Καταγραφή ανίχνευση σε εξέλιξη ενδέχεται να αποτύχει εάν η εφαρμογή δεν μπορεί να ξεκινήσει ή παρουσιάζει σφάλμα. Μια ανεξάρτητη παράγοντας έχει πολύ περισσότερες πιθανότητες να καταγράφετε κρίσιμης σημασίας πληροφορίες αντιμετώπισης προβλημάτων.<br /><br />

2. *Λήξη, ισχύ και την απόδοση αποδεδειγμένη*

    * Παράγοντας αναπτύχθηκε από έναν προμηθευτή πλατφόρμα (όπως έναν παράγοντα τα Διαγνωστικά του Microsoft Azure) έχει υπόκεινται αυστηρών δοκιμών και μάχη ενίσχυσης.

    * Με καταγραφή ανίχνευση σε εξέλιξη, πρέπει να λαμβάνονται περίθαλψη ώστε να τη δραστηριότητα αποστολής διαγνωστικών δεδομένων από μια διαδικασία εφαρμογής δεν παρεμβάλλεται με την εφαρμογή κύριες εργασίες ή Παρουσιάστε χρόνου ή επιδόσεων προβλήματα. Παράγοντας ανεξάρτητη εκτελείται είναι λιγότερο πιθανό να αυτά τα θέματα και έχει σχεδιαστεί ειδικά για να περιορίσετε τις επιπτώσεις στο σύστημα.

Είναι δυνατό να συνδυάσετε και να επωφεληθείτε από τις δύο μεθόδους. Στην πραγματικότητα, μπορεί να είναι η καλύτερη λύση για πολλές εφαρμογές.

Εδώ, χρησιμοποιούμε τη **βιβλιοθήκη Microsoft.Diagnostic.Listeners** και καταγραφή για την αποστολή δεδομένων από μια εφαρμογή υπηρεσίας ύφασμα σε ένα σύμπλεγμα Elasticsearch ανίχνευση σε εξέλιξη.

## <a name="use-the-listeners-library-to-send-diagnostic-data-to-elasticsearch"></a>Χρησιμοποιήσετε τη βιβλιοθήκη ακροατών για Αποστολή διαγνωστικών δεδομένων στο Elasticsearch
Η βιβλιοθήκη Microsoft.Diagnostic.Listeners είναι μέρος της εφαρμογής υπηρεσίας ύφασμα δείγμα PartyCluster. Για να χρησιμοποιήσετε τα εξής:

1. Κάντε λήψη [του δείγματος PartyCluster](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) από GitHub.

2. Αντιγράψτε τα σχέδια Microsoft.Diagnostics.Listeners και Microsoft.Diagnostics.Listeners.Fabric (ολόκληρη τους φακέλους) από τον κατάλογο δείγμα PartyCluster φάκελο της λύσης της εφαρμογής που είναι πρέπει να στείλετε τα δεδομένα σε Elasticsearch.

3. Ανοίξτε τη λύση προορισμού, κάντε δεξί κλικ στον κόμβο λύση στην Εξερεύνηση λύσεων και επιλέξτε **Προσθήκη υπάρχοντος έργου**. Προσθέστε το έργο Microsoft.Diagnostics.Listeners στη λύση. Επαναλάβετε την ίδια για το έργο Microsoft.Diagnostics.Listeners.Fabric.

4. Προσθέστε μια αναφορά έργου από την υπηρεσία έργα για τα δύο έργα προστέθηκε. (Κάθε υπηρεσία που είναι πρέπει να στείλουν δεδομένα σε Elasticsearch πρέπει να αναφοράς Microsoft.Diagnostics.EventListeners και Microsoft.Diagnostics.EventListeners.Fabric).

    ![Οι αναφορές έργου σε βιβλιοθήκες Microsoft.Diagnostics.EventListeners και Microsoft.Diagnostics.EventListeners.Fabric][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a>Υπηρεσία ύφασμα γενικά διάθεσης και Microsoft.Diagnostics.Tracing Nuget πακέτου
Εφαρμογές που δημιουργήθηκαν με την υπηρεσία ύφασμα γενικά διάθεσης (2.0.135, κυκλοφορήσει 31 Μαρτίου 2016) στοχεύετε **.NET Framework 4.5.2**. Αυτή η έκδοση είναι η υψηλότερη έκδοση του .NET Framework υποστηρίζονται από το Azure τη στιγμή της έκδοσης GA. Δυστυχώς, αυτή η έκδοση του framework δεν διαθέτει ορισμένες API EventListener που χρειάζεται η βιβλιοθήκη Microsoft.Diagnostics.Listeners. Επειδή Προέλευση_συμβάντος (το στοιχείο που αποτελεί τη βάση της καταγραφής APIs σε ύφασμα εφαρμογές) και EventListener είναι στενά συνδεδεμένων κάθε έργο που χρησιμοποιεί τη βιβλιοθήκη Microsoft.Diagnostics.Listeners πρέπει να χρησιμοποιήσετε μια εναλλακτική υλοποίηση της Προέλευση_συμβάντος. Αυτή η υλοποίηση παρέχεται από το **πακέτο Microsoft.Diagnostics.Tracing Nuget**, δημιουργήθηκε από τη Microsoft. Το πακέτο είναι πλήρως συμβατή με Προέλευση_συμβάντος περιλαμβάνονται στο πλαίσιο, ώστε να καμία αλλαγή κώδικα πρέπει να είναι απαραίτητο, εκτός από αλλαγές αναφοράς χώρο ονομάτων.

Για να ξεκινήσετε να χρησιμοποιείτε την εφαρμογή Microsoft.Diagnostics.Tracing της κλάσης Προέλευση_συμβάντος, ακολουθήστε τα παρακάτω βήματα για κάθε υπηρεσία έργο που χρειάζεται για την αποστολή δεδομένων σε Elasticsearch:

1. Κάντε δεξί κλικ στο έργο υπηρεσίας και επιλέξτε **Διαχείριση πακέτων Nuget**.

2. Μεταβείτε στο αρχείο προέλευσης πακέτου nuget.org (Εάν δεν είναι ήδη επιλεγμένο) και αναζήτηση για "**Microsoft.Diagnostics.Tracing**".

3. Εγκαταστήστε το `Microsoft.Diagnostics.Tracing.EventSource` πακέτου (και τις εξαρτήσεις του).

4. Ανοίξτε το αρχείο **ServiceEventSource.cs** ή **ActorEventSource.cs** στο έργο σας υπηρεσίας και να αντικαταστήσετε το `using System.Diagnostics.Tracing` οδηγία επάνω από το αρχείο με το `using Microsoft.Diagnostics.Tracing` οδηγία.

Αυτά τα βήματα δεν θα είναι απαραίτητο, όταν το **.NET Framework 4.6** υποστηρίζεται από το Windows Azure.

### <a name="elasticsearch-listener-instantiation-and-configuration"></a>Elasticsearch ακρόασης δημιουργίας και ρύθμισης παραμέτρων
Το τελικό βήμα για την αποστολή δεδομένων διαγνωστικών σε Elasticsearch είναι να δημιουργήσετε μια παρουσία του `ElasticSearchListener` και ρυθμίστε τις παραμέτρους του με Elasticsearch σύνδεσης δεδομένων. Το ακροατήριο καταγράφει αυτόματα όλα τα συμβάντα υψωμένο μέσω Προέλευση_συμβάντος κλάσεις του έργου υπηρεσίας. Πρέπει να είναι ενεργή κατά τη διάρκεια ζωής της υπηρεσίας, ώστε να είναι το καλύτερο σημείο για να δημιουργήσετε τον κώδικα προετοιμασίας υπηρεσίας. Ακολουθεί πώς μπορεί να μοιάζει κώδικα προετοιμασίας για μια υπηρεσία χωρίς κατάσταση μετά τις απαραίτητες αλλαγές (προσθήκες επισημαίνεται στο σχόλια ξεκινώντας με `****`):

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add the following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is the entry point of the service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider);
                }

                // The ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name to a .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of the class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that the ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

Elasticsearch σύνδεσης δεδομένων θα πρέπει να τεθούν σε μια ξεχωριστή ενότητα στο αρχείο ρύθμισης παραμέτρων της υπηρεσίας (**PackageRoot\Config\Settings.xml**). Το όνομα της ενότητας πρέπει να αντιστοιχεί στην τιμή που του μεταβιβάστηκε η `FabricConfigurationProvider` κατασκευή, για παράδειγμα:

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
Οι τιμές των `serviceUri`, `userName` και `password` παράμετροι αντιστοιχούν σε τη διεύθυνση τελικού σημείου σύμπλεγμα Elasticsearch Elasticsearch όνομα χρήστη και τον κωδικό πρόσβασης, αντίστοιχα. `indexNamePrefix`είναι το πρόθεμα για Elasticsearch ευρετήρια. η βιβλιοθήκη Microsoft.Diagnostics.Listeners δημιουργεί ένα νέο ευρετήριο για τα δεδομένα του καθημερινά.

### <a name="verification"></a>Επαλήθευση
Αυτό είναι! Τώρα, κάθε φορά που εκτελείται η υπηρεσία, ξεκινά αποστολή ανιχνεύσεις στην υπηρεσία Elasticsearch που καθορίζεται στη ρύθμιση παραμέτρων. Μπορείτε να επαληθεύσετε αυτό, ανοίγοντας το περιβάλλον εργασίας Χρήστη Kibana που σχετίζεται με την παρουσία Elasticsearch προορισμού. Στο παράδειγμά μας, τη διεύθυνση της σελίδας είναι http://myBigCluster.westus.cloudapp.azure.com/. Ελέγξτε ότι ευρετήρια με το πρόθεμα όνομα επιλέξει για το `ElasticSearchListener` παρουσία στην πραγματικότητα έχουν δημιουργηθεί και συμπληρωμένη με δεδομένα.

![Συμβάντα εφαρμογής που εμφανίζει Kibana PartyCluster][2]

## <a name="next-steps"></a>Επόμενα βήματα
- [Μάθετε περισσότερα σχετικά με τη διάγνωση και την παρακολούθηση μιας υπηρεσίας ύφασμα υπηρεσίας](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
