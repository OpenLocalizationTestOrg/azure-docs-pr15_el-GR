<properties
   pageTitle="Χρήση των υπηρεσιών αξιόπιστη για προχωρημένους | Microsoft Azure"
   description="Μάθετε σχετικά με τη χρήση σύνθετων της υπηρεσίας ύφασμα αξιόπιστων υπηρεσιών για μεγαλύτερη ευελιξία στον των υπηρεσιών σας."
   services="Service-Fabric"
   documentationCenter=".net"
   authors="vturecek"
   manager="timlt"
   editor="masnider"/>

<tags
   ms.service="Service-Fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="10/19/2016"
   ms.author="vturecek"/>

# <a name="advanced-usage-of-the-reliable-services-programming-model"></a>Χρήση των υπηρεσιών αξιόπιστη προγραμματισμού μοντέλου για προχωρημένους
Azure Service ύφασμα απλοποιεί γράφετε και τη Διαχείριση αξιόπιστων υπηρεσιών χωρίς κατάσταση και με κατάσταση. Αυτός ο οδηγός θα μιλήσουμε για προχωρημένους χρήσεις των αξιόπιστων υπηρεσιών για να αποκτήσετε περισσότερα έλεγχο και ευελιξία μέσω των υπηρεσιών σας. Πριν από την ανάγνωση αυτού του οδηγού, εξοικειωθείτε με [Τις υπηρεσίες αξιόπιστη προγραμματισμού μοντέλο](service-fabric-reliable-services-introduction.md).

Υπηρεσίες τόσο με κατάσταση και χωρίς κατάσταση έχουν δύο σημεία εισόδου πρωτεύοντος για τον κωδικό χρήστη:

 - `RunAsync`υπάρχει ένα σημείο εισόδου γενικής χρήσης για την υπηρεσία κώδικα.
 - `CreateServiceReplicaListeners`και `CreateServiceInstanceListeners` είναι για το άνοιγμα ακροατών επικοινωνίας για αιτήσεις προγράμματος-πελάτη.
 
Για περισσότερες υπηρεσίες, αυτά τα σημεία δύο καταχώρησης είναι επαρκείς. Στην περίπτωση αυτή όταν απαιτείται περισσότερο έλεγχο κύκλου ζωής μιας υπηρεσίας, επιπλέον κύκλου ζωής συμβάντα είναι διαθέσιμα.

## <a name="stateless-service-instance-lifecycle"></a>Κύκλος ζωής παρουσία χωρίς κατάσταση υπηρεσίας

Κύκλος ζωής μιας υπηρεσίας χωρίς κατάσταση είναι πολύ απλής. Χωρίς κατάσταση υπηρεσίας να μόνο να ανοίξει, κλειστό ή ματαιώθηκε. `RunAsync`σε μια υπηρεσία χωρίς κατάσταση εκτελείται όταν μια παρουσία της υπηρεσίας είναι δυνατό το άνοιγμα και ακυρώνεται όταν είναι κλειστό ή ματαιώθηκε μια παρουσία της υπηρεσίας. 

Παρόλο που `RunAsync` πρέπει να είναι αρκετό σε σχεδόν όλες τις περιπτώσεις, το ανοιχτό, κλείστε και συμβάντα ματαίωση στο χωρίς κατάσταση υπηρεσίας είναι επίσης διαθέσιμες:

- `Task OnOpenAsync(IStatelessServicePartition, CancellationToken)`
  OnOpenAsync καλείται όταν η παρουσία της υπηρεσίας χωρίς κατάσταση πρόκειται να χρησιμοποιηθεί. Εργασίες προετοιμασίας εκτεταμένη υπηρεσία μπορεί να ξεκινήσει αυτήν τη στιγμή.

- `Task OnCloseAsync(CancellationToken)`
  OnCloseAsync καλείται όταν η παρουσία της υπηρεσίας χωρίς κατάσταση πρόκειται να ομαλά τερματιστεί. Αυτό μπορεί να συμβεί όταν αναβαθμίζεται κώδικα της υπηρεσίας, η παρουσία της υπηρεσίας για τη μετακίνηση λόγω εξισορρόπηση φόρτου ή εντοπίζεται ένα σφάλμα μεταβατικές. OnCloseAsync μπορεί να χρησιμοποιηθεί για την ασφάλεια κλείστε τυχόν πόρων, διακόψετε οποιαδήποτε επεξεργασία στο παρασκήνιο, ολοκληρώσει την αποθήκευση εξωτερικών κατάσταση ή κλείσιμο προς τα κάτω υπάρχουσες συνδέσεις.

- `void OnAbort()`
  OnAbort καλείται όταν η παρουσία της υπηρεσίας χωρίς κατάσταση αναγκαστικά τερματίζεται. Αυτό συνήθως ονομάζεται όταν ένα μόνιμο σφάλμα εντοπίζεται στον κόμβο ή όταν ύφασμα υπηρεσίας δεν είναι δυνατό να αξιόπιστα Διαχείριση κύκλου ζωής της παρουσίας της υπηρεσίας του λόγω αποτυχιών του εσωτερικού.

## <a name="stateful-service-replica-lifecycle"></a>Κύκλος ζωής ρεπλίκα κατάστασης υπηρεσίας

Κύκλος ζωής της κατάστασης υπηρεσίας ρεπλίκα είναι πολύ πιο σύνθετο από μια παρουσία χωρίς κατάσταση υπηρεσίας. Επιπλέον για να ανοίξετε, να κλείσει και να ματαιώσετε συμβάντα, μια ρεπλίκα με κατάσταση υπηρεσίας υφίσταται αλλαγές ρόλων κατά τη διάρκεια ζωής. Όταν μια ρεπλίκα με κατάσταση υπηρεσίας αλλάζει ρόλου, η `OnChangeRoleAsync` ενεργοποιείται συμβάν:

- `Task OnChangeRoleAsync(ReplicaRole, CancellationToken)`
  OnChangeRoleAsync καλείται όταν η κατάσταση υπηρεσίας ρεπλίκα αλλάζει ρόλου, για παράδειγμα πρωτεύον ή δευτερεύον. Κύρια αντίγραφα παρέχονται κατάστασης εγγραφής (επιτρέπονται για να δημιουργήσετε και να γράψετε σε αξιόπιστη συλλογές). Δευτερεύουσα αντίγραφα δίνονται κατάσταση ανάγνωσης (μόνο Διαβάστε από υπάρχουσα αξιόπιστη συλλογές). Οι περισσότερες εργασία στην κατάσταση υπηρεσίας εκτελείται στην κύρια ρεπλίκα. Δευτερεύουσα αντίγραφα να εκτελέσετε μόνο για ανάγνωση επικύρωσης, δημιουργία αναφορών, εξόρυξης δεδομένων ή άλλες εργασίες μόνο για ανάγνωση.

Σε μια υπηρεσία κατάστασης, μόνο η κύρια ρεπλίκα έχει δικαιώματα εγγραφής σε κατάσταση και, επομένως, είναι γενικά όταν η υπηρεσία εκτελεί πραγματική εργασία. Το `RunAsync` μέθοδος σε μια υπηρεσία κατάστασης εκτελείται μόνο όταν η κατάσταση υπηρεσίας ρεπλίκα είναι πρωτεύον. Το `RunAsync` μέθοδο ακυρώθηκε όταν αλλάζει μια κύρια ρεπλίκα ρόλο μακριά από την κύρια, καθώς και κατά το κλείσιμο και ματαίωση συμβάντων. 

Χρήση του `OnChangeRoleAsync` συμβάν σάς επιτρέπει να εκτελούν μια εργασία, ανάλογα με το ρόλο ρεπλίκα καθώς και όπως απόκριση σε αλλαγή ρόλων.

Κατάσταση υπηρεσίας παρέχει επίσης την ίδια τέσσερα συμβάντα κύκλου ζωής ως χωρίς κατάσταση υπηρεσίας, με την ίδια σημασιολογία και περιπτώσεις χρήσης:

- `Task OnOpenAsync(IStatefulServicePartition, CancellationToken)`
- `Task OnCloseAsync(CancellationToken)`
- `void OnAbort()`



## <a name="next-steps"></a>Επόμενα βήματα
Για πιο σύνθετες θέματα που σχετίζονται με ύφασμα υπηρεσίας, ανατρέξτε στα ακόλουθα άρθρα:

- [Ρύθμιση παραμέτρων υπηρεσιών κατάστασης αξιόπιστη](service-fabric-reliable-services-configuration.md)

- [Εισαγωγή εύρυθμης λειτουργίας υπηρεσίας ύφασμα](service-fabric-health-introduction.md)

- [Χρήση αναφορών εύρυθμης λειτουργίας συστήματος για την αντιμετώπιση προβλημάτων](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

- [Ρύθμιση παραμέτρων υπηρεσιών με την υπηρεσία ύφασμα σύμπλεγμα από διαχειριστή πόρων](service-fabric-cluster-resource-manager-configure-services.md)
