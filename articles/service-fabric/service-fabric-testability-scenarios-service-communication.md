<properties
   pageTitle="Με δυνατότητα δοκιμής: Υπηρεσίας επικοινωνίας | Microsoft Azure"
   description="Επικοινωνία με υπηρεσία είναι ένα σημείο κρίσιμες ενοποίηση μιας εφαρμογής υπηρεσίας ύφασμα. Σε αυτό το άρθρο περιγράφει θέματα σχεδίασης και τεχνικές δοκιμής."
   services="service-fabric"
   documentationCenter=".net"
   authors="vturecek"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="07/06/2016"
   ms.author="vturecek"/>

# <a name="service-fabric-testability-scenarios-service-communication"></a>Υπηρεσία υφάσματος με δυνατότητα δοκιμής σενάρια: υπηρεσίας επικοινωνίας

Microservices και προσανατολισμένος σε υπηρεσία αρχιτεκτονική στυλ επιφάνεια ομαλά σε ύφασμα υπηρεσίας Azure. Σε αυτούς τους τύπους κατανέμεται αρχιτεκτονικές, componentized microservice εφαρμογές είναι συνήθως που αποτελείται από πολλαπλές υπηρεσίες που πρέπει να επικοινωνούν μεταξύ τους. Στις ακόμα πιο απλός περιπτώσεις, έχετε γενικά τουλάχιστον μια υπηρεσία web χωρίς κατάσταση και μια υπηρεσία αποθήκευσης με κατάσταση δεδομένων που πρέπει να επικοινωνήσετε.

Επικοινωνία με υπηρεσία είναι ένα σημείο κρίσιμες ενοποίηση μιας εφαρμογής του, επειδή κάθε υπηρεσία εκθέτει ένα απομακρυσμένο API με άλλες υπηρεσίες. Εργασία με ένα σύνολο API όρια που περιλαμβάνει την εισόδου/εξόδου γενικά απαιτεί ορισμένες περίθαλψη, με μια καλή ποσό δοκιμών και επικύρωση.

Υπάρχουν πολλά θέματα για να κάνετε όταν αυτά τα όρια της υπηρεσίας είναι ενσύρματο μαζί σε ένα Κατανεμημένο σύστημα:

 - *Πρωτόκολλο μεταφοράς*. Θα χρησιμοποιήσετε HTTP για αυξημένη διαλειτουργικότητα, ή ένα προσαρμοσμένο δυαδικό πρωτόκολλο για μέγιστη ταχύτητα μετάδοσης;
 - *Χειρισμός σφάλματος*. Πώς θα σφάλματα μόνιμο και μεταβατικές γίνεται ο χειρισμός; Τι θα συμβεί όταν μια υπηρεσία μετακινείται σε διαφορετικό κόμβο;
 - *Χρονικών ορίων και λανθάνοντος χρόνου*. Στις εφαρμογές πολλαπλών επιπέδων, πώς θα κάθε επίπεδο υπηρεσίας χειρίζεται λανθάνων χρόνος στη στοίβα και στο χρήστη;

Εάν χρησιμοποιείτε ένα από τα στοιχεία επικοινωνίας ενσωματωμένη υπηρεσία που παρέχεται από την υπηρεσία ύφασμα ή μπορείτε να δημιουργήσετε το δικό σας, έλεγχος των επικοινωνιών μεταξύ των υπηρεσιών σας είναι σημαντικό να διασφαλίσει την ανοχή στην εφαρμογή σας.

## <a name="prepare-for-services-to-move"></a>Προετοιμασία για τις υπηρεσίες για να μετακινήσετε

Παρουσίες υπηρεσίας μπορεί να μετακινηθείτε μέσα στο χρόνο. Αυτό ισχύει ιδίως όταν να έχουν ρυθμιστεί με φόρτωση μετρήσεις για εξισορρόπηση προσαρμοσμένες προσαρμοσμένη βέλτιστη πόρων. Υπηρεσία ύφασμα μετακινεί σας παρουσιών της υπηρεσίας για να μεγιστοποιήσετε τη διαθεσιμότητά τους, ακόμα και κατά τη διάρκεια αναβαθμίσεις, ανακατευθύνσεις, κλιμάκωσης και άλλες περιπτώσεις που προκύπτουν στη διάρκεια ζωής του ένα Κατανεμημένο σύστημα.

Ως υπηρεσίες μετακίνηση μέσα στο σύμπλεγμα, θα πρέπει να προετοιμαστώ τους πελάτες σας και άλλες υπηρεσίες για να χειρίζεται τις δύο σενάρια, όταν τους να συνομιλήσετε με μια υπηρεσία:

- Η παρουσία ή διαμερίσματα ρεπλίκα υπηρεσίας έχει μετακινηθεί από την τελευταία φορά που συνομιλία σε αυτήν. Αυτή είναι μια κανονική μέρος ενός κύκλου ζωής της υπηρεσίας και αυτό θα πρέπει να αναμένεται ότι θα συμβεί κατά τη διάρκεια ζωής της εφαρμογής σας.
- Η παρουσία ή διαμερίσματα ρεπλίκα υπηρεσίας είναι σε διαδικασία μετακίνηση. Παρόλο που η ανακατεύθυνση μιας υπηρεσίας από έναν κόμβο σε μια άλλη παρουσιάζεται πολύ γρήγορα σε ύφασμα υπηρεσίας, μπορεί να υπάρχουν καθυστέρηση στη διαθεσιμότητα εάν τα στοιχεία επικοινωνίας της υπηρεσίας σας είναι αργή για να ξεκινήσετε.

Χειρισμός αυτά τα σενάρια ομαλά είναι σημαντικό για ένα σύστημα εκτελείται ομαλά. Για να το κάνετε, λάβετε υπόψη ότι:

- Κάθε υπηρεσία που μπορεί να συνδεθεί με έχει μια *διεύθυνση* που κάνει ακρόαση σε (για παράδειγμα, HTTP ή WebSockets). Όταν μια παρουσία της υπηρεσίας ή διαμερίσματα μετακινεί, αλλάζει τη διεύθυνση τελικού σημείου. (Πραγματοποιεί μετακίνηση σε διαφορετικό κόμβο με μια διαφορετική διεύθυνση IP.) Εάν χρησιμοποιείτε τα στοιχεία επικοινωνίας ενσωματωμένα, αυτά θα χειρίζεται εκ νέου την ανάλυση διευθύνσεις υπηρεσίας για εσάς.
- Μπορεί να υπάρχει ένα προσωρινό αύξηση της υπηρεσίας λανθάνων χρόνος ως ξεκινήσει η υπηρεσία παρουσία του το ακροατήριο ξανά. Αυτό εξαρτάται από το πόσο γρήγορα την υπηρεσία ανοίγει το πρόγραμμα ακρόασης μετά τη μετακίνηση της παρουσίας της υπηρεσίας.
- Τυχόν υπάρχουσες συνδέσεις πρέπει να κλείσει και ανοίξει ξανά μετά την υπηρεσία ανοίγει σε ένα νέο κόμβο. Τερματισμός λειτουργίας φυσιολογική κόμβου ή επανεκκίνηση επιτρέπει χρόνο για υπάρχουσες συνδέσεις να τερματιστεί ομαλά.

### <a name="test-it-move-service-instances"></a>Δοκιμάστε το: μετακίνηση παρουσιών της υπηρεσίας

Με τη χρήση της υπηρεσίας υφάσματος με δυνατότητα δοκιμής εργαλεία, μπορεί να συντάσσετε ένα σενάριο δοκιμή για να ελέγξετε αυτές τις περιπτώσεις με διάφορους τρόπους:

1. Μετακίνηση μιας κατάστασης υπηρεσίας πρωτεύον αντίγραφο.

    Η κύρια ρεπλίκα από ένα διαμερίσματα με κατάσταση υπηρεσίας μπορούν να μετακινηθούν για διάφορους λόγους. Χρησιμοποιήστε αυτήν την επιλογή για να στοχεύσετε πρωτεύον αντίγραφο των ένα συγκεκριμένο διαμερίσματα για να δείτε πώς με τις υπηρεσίες αντικείμενο για τη μετακίνηση με πολύ ελεγχόμενο τρόπο.

    ```powershell

    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService

    ```

2. Διακοπή έναν κόμβο.

    Όταν ένας κόμβος έχει διακοπεί, ύφασμα υπηρεσία πραγματοποιεί μετακίνηση όλων των παρουσιών της υπηρεσίας ή διαμερισμάτων που έγιναν σε αυτόν τον κόμβο σε ένα από τα άλλα διαθέσιμα κόμβους του συμπλέγματος. Χρησιμοποιήστε αυτήν την επιλογή για να ελέγξετε την περίπτωση που χάνονται έναν κόμβο από το σύμπλεγμά σας και όλες τις παρουσίες υπηρεσίας και αντίγραφα από αυτόν τον κόμβο πρέπει να μετακινήσετε.

    Μπορείτε να διακόψετε έναν κόμβο χρησιμοποιώντας το cmdlet του PowerShell **Διακοπή ServiceFabricNode** :

    ```powershell

    PS > Restart-ServiceFabricNode -NodeName Node_1

    ```

## <a name="maintain-service-availability"></a>Διατήρηση διαθεσιμότητα υπηρεσίας

Ως πλατφόρμα, ύφασμα υπηρεσίας έχει σχεδιαστεί για την παροχή υψηλή διαθεσιμότητα των υπηρεσιών σας. Αλλά σε ακραίες περιπτώσεις, υποκείμενων προβλημάτων υποδομής μπορεί να προκαλέσει μη διαθεσιμότητα. Είναι σημαντικό για τον έλεγχο για αυτά τα σενάρια, πολύ.

Ρύθμιση υπηρεσιών χρησιμοποιούν ένα σύστημα που βασίζεται σε απαρτίας για την αναπαραγωγή κατάσταση για υψηλή διαθεσιμότητα. Αυτό σημαίνει ότι απαρτία αντίγραφα πρέπει να είναι διαθέσιμος για να εκτελέσετε λειτουργίες εγγραφής. Στην περίπτωση αυτή, όπως αποτυχία εκτεταμένο υλικό, απαρτία αντίγραφα ενδέχεται να μην είναι διαθέσιμη. Σε αυτές τις περιπτώσεις, δεν θα μπορείτε να εκτελέσετε λειτουργίες εγγραφής, αλλά θα εξακολουθείτε να μπορέσετε να εκτελέσετε λειτουργίες ανάγνωσης.

### <a name="test-it-write-operation-unavailability"></a>Δοκιμάστε το: σύνταξη λειτουργία μη διαθεσιμότητα

Με χρήση των εργαλείων με δυνατότητα δοκιμής σε ύφασμα υπηρεσίας, μπορεί να εισαγωγής ένα σφάλμα που υποδείξει απώλεια απαρτίας δοκιμή. Παρόλο που ένα τέτοιο σενάριο είναι σπάνια, είναι σημαντικό ότι οι υπολογιστές-πελάτες και τις υπηρεσίες που εξαρτώνται από μια υπηρεσία κατάστασης είναι προετοιμασμένοι να χειρίζεται τις περιπτώσεις όπου δεν είναι δυνατό να κάνουν εγγραφή αιτήσεων σε αυτήν. Είναι επίσης σημαντικό γνωρίζει τη δυνατότητα αυτή την ίδια την υπηρεσία κατάστασης και να ομαλά την μπορούν να επικοινωνούν για τους καλούντες.

Που μπορεί να προκαλέσει απώλεια απαρτίας, χρησιμοποιώντας το cmdlet του PowerShell **Ενεργοποίηση ServiceFabricPartitionQuorumLoss** :

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

Σε αυτό το παράδειγμα, μπορούμε να εγκαταστήσουμε `QuorumLossMode` να `QuorumReplicas` για να υποδείξει ότι θέλουμε να προκαλέσουν απώλεια απαρτίας χωρίς διαρκεί προς τα κάτω όλα τα αντίγραφα. Με αυτόν τον τρόπο, λειτουργίες ανάγνωσης είναι δυνατή. Για να δοκιμάσετε ένα σενάριο όπου μια ολόκληρη διαμερίσματα δεν είναι διαθέσιμη, μπορείτε να ρυθμίσετε αυτόν το διακόπτη να `AllReplicas`.

## <a name="next-steps"></a>Επόμενα βήματα

[Μάθετε περισσότερα σχετικά με τις ενέργειες με δυνατότητα δοκιμής](service-fabric-testability-actions.md)

[Μάθετε περισσότερα σχετικά με τα σενάρια με δυνατότητα δοκιμής](service-fabric-testability-scenarios.md)
