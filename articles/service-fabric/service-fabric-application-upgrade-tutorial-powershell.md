<properties
   pageTitle="Αναβάθμιση εφαρμογής υπηρεσίας υφάσματος με χρήση του PowerShell | Microsoft Azure"
   description="Σε αυτό το άρθρο παρουσιάζει την εμπειρία για την ανάπτυξη μιας εφαρμογής υπηρεσίας ύφασμα, εάν αλλάξετε τον κωδικό και παράδοση αναβάθμισης χρήση του PowerShell."
   services="service-fabric"
   documentationCenter=".net"
   authors="mani-ramaswamy"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="09/14/2016"
   ms.author="subramar"/>


# <a name="service-fabric-application-upgrade-using-powershell"></a>Αναβάθμιση εφαρμογής υπηρεσίας υφάσματος με χρήση του PowerShell

> [AZURE.SELECTOR]
- [PowerShell](service-fabric-application-upgrade-tutorial-powershell.md)
- [Visual Studio](service-fabric-application-upgrade-tutorial.md)

<br/>

Τις πιο συχνά χρησιμοποιούμενες και συνιστώμενη αναβάθμισης προσέγγιση είναι η αναβάθμιση εποπτευόμενη.  Azure Service ύφασμα παρακολουθεί την εύρυθμη λειτουργία της εφαρμογής να αναβαθμίζεται βάσει ενός συνόλου των πολιτικών εύρυθμης λειτουργίας. Μετά την αναβάθμιση ενός τομέα ενημέρωση (UD), ύφασμα υπηρεσίας αξιολογεί την εύρυθμη λειτουργία της εφαρμογής και είτε προχωρά στο επόμενο τομέα ενημέρωση ή αποτύχει η αναβάθμιση ανάλογα με τις πολιτικές εύρυθμης λειτουργίας.

Μια αναβάθμιση εποπτευόμενη εφαρμογή μπορεί να πραγματοποιηθεί χρησιμοποιώντας τη διαχειριζόμενη εγγενούς APIs, PowerShell ή ΥΠΌΛΟΙΠΟ. Για οδηγίες σχετικά με την εκτέλεση μιας αναβάθμισης χρήση του Visual Studio, ανατρέξτε στο θέμα [αναβάθμιση εφαρμογή σας με χρήση του Visual Studio](service-fabric-application-upgrade-tutorial.md).

Με υπηρεσία ύφασμα παρακολουθούνται συνάθροισης αναβαθμίσεις, ο διαχειριστής της εφαρμογής να ρυθμίσετε τις παραμέτρους της πολιτικής αξιολόγησης εύρυθμης λειτουργίας που χρησιμοποιεί ύφασμα υπηρεσίας για να προσδιορίσετε εάν η εφαρμογή είναι σε καλή κατάσταση. Επιπλέον, ο διαχειριστής να ρυθμίσετε τις παραμέτρους της ενέργειας που λαμβάνονται κατά την αξιολόγηση της υγείας αποτυγχάνει (για παράδειγμα, κάνοντας μια αυτόματη επαναφορά.) Αυτή η ενότητα παρουσιάζει μια εποπτευόμενη αναβάθμιση για ένα από τα δείγματα SDK που χρησιμοποιεί το PowerShell.

## <a name="step-1-build-and-deploy-the-visual-objects-sample"></a>Βήμα 1: Δημιουργήστε και αναπτύξτε το δείγμα οπτικά αντικείμενα


Δημιουργία και δημοσίευση της εφαρμογής κάνοντας δεξί κλικ στο έργο εφαρμογής, **VisualObjectsApplication,** και επιλέγοντας την εντολή " **Δημοσίευση** ".  Για περισσότερες πληροφορίες, ανατρέξτε στο θέμα [εφαρμογή υπηρεσίας ύφασμα αναβάθμιση του προγράμματος εκμάθησης](service-fabric-application-upgrade-tutorial.md).  Εναλλακτικά, μπορείτε να χρησιμοποιήσετε PowerShell για να αναπτύξετε την εφαρμογή σας.

> [AZURE.NOTE] Οποιαδήποτε από τις εντολές της υπηρεσίας ύφασμα μπορεί να χρησιμοποιηθεί σε PowerShell, πρέπει πρώτα να συνδεθείτε με το σύμπλεγμα, χρησιμοποιώντας το `Connect-ServiceFabricCluster` cmdlet. Ομοίως, θεωρείται ότι το σύμπλεγμα έχει ήδη οριστεί στον τοπικό υπολογιστή σας. Ανατρέξτε στο άρθρο σχετικά με τη [Ρύθμιση του περιβάλλοντος ανάπτυξης ύφασμα υπηρεσίας](service-fabric-get-started.md).

Μετά τη δημιουργία του έργου στο Visual Studio, μπορείτε να χρησιμοποιήσετε την εντολή PowerShell **ServiceFabricApplicationPackage αντιγραφή** για να αντιγράψετε το πακέτο εφαρμογών του ImageStore. Το επόμενο βήμα είναι να καταχωρήσετε την εφαρμογή με το χρόνο εκτέλεσης υπηρεσίας ύφασμα χρησιμοποιώντας το cmdlet **Register-ServiceFabricApplicationPackage** . Το τελικό βήμα είναι να ξεκινήσετε μια παρουσία της εφαρμογής, χρησιμοποιώντας το cmdlet **New-ServiceFabricApplication** .  Αυτά τα τρία βήματα είναι ανάλογα με τη χρήση του στοιχείου μενού " **Ανάπτυξη** " στο Visual Studio.

Τώρα, μπορείτε να χρησιμοποιήσετε [Explorer ύφασμα υπηρεσίας για να προβάλετε το σύμπλεγμα και την εφαρμογή](service-fabric-visualizing-your-cluster.md). Η εφαρμογή έχει μια υπηρεσία web που μπορεί να μεταβεί στον Internet Explorer, πληκτρολογώντας [http://localhost:8081/visualobjects](http://localhost:8081/visualobjects) στη γραμμή διευθύνσεων.  Θα πρέπει να δείτε ορισμένα κινητά αντικείμενα οπτική μετακίνηση μέσα στην οθόνη.  Επιπλέον, μπορείτε να χρησιμοποιήσετε **Get-ServiceFabricApplication** για να ελέγξετε την κατάσταση της εφαρμογής.

## <a name="step-2-update-the-visual-objects-sample"></a>Βήμα 2: Ενημερώστε το δείγμα οπτικά αντικείμενα

Ίσως παρατηρήσετε ότι με την έκδοση που έχει αναπτυχθεί στο βήμα 1, τα οπτικά αντικείμενα δεν περιστροφή. Ας αναβάθμιση αυτήν την εφαρμογή σε μία όπου περιστροφή επίσης τα οπτικά αντικείμενα.

Επιλέξτε το έργο VisualObjects.ActorService μέσα στη λύση VisualObjects και ανοίξτε το αρχείο StatefulVisualObjectActor.cs. Σε αυτό το αρχείο, μεταβείτε στη μέθοδο `MoveObject`, σχολιάσετε `this.State.Move()`, και καταργήστε τα σχόλια από `this.State.Move(true)`. Αυτή η αλλαγή Περιστρέφει τα αντικείμενα μετά την αναβάθμιση της υπηρεσίας.

Πρέπει επίσης να ενημερώσετε το αρχείο *ServiceManifest.xml* (στην περιοχή PackageRoot) του έργου **VisualObjects.ActorService**. Ενημερώστε την *CodePackage* και την έκδοση υπηρεσίας σε 2.0 και οι αντίστοιχες γραμμές στο αρχείο *ServiceManifest.xml* .
Μπορείτε να χρησιμοποιήσετε την επιλογή Visual Studio *Επεξεργασία αρχείων δήλωσης* αφού κάνετε δεξιό κλικ για τη λύση για να κάνετε τις αλλαγές αρχείο δηλώσεων.


Αφού οι αλλαγές γίνονται, δηλωτικό πρέπει να μοιάζει με την παρακάτω (επισήμανση τμήματα εμφάνιση των αλλαγών):

```xml
<ServiceManifestName="VisualObjects.ActorService" Version="2.0" xmlns="http://schemas.microsoft.com/2011/01/fabric" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<CodePackageName="Code" Version="2.0">
```

Τώρα το αρχείο *ApplicationManifest.xml* (που βρίσκονται κάτω από το έργο **VisualObjects** στην περιοχή της λύσης **VisualObjects** ) είναι ενημερωθεί στην έκδοση 2.0 του έργου **VisualObjects.ActorService** . Επιπλέον, η έκδοση εφαρμογής ενημερώνεται για να 2.0.0.0 από 1.0.0.0. Το *ApplicationManifest.xml* θα πρέπει να μοιάζει με το παρακάτω τμήμα κώδικα:

```xml
<ApplicationManifestxmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ApplicationTypeName="VisualObjects" ApplicationTypeVersion="2.0.0.0" xmlns="http://schemas.microsoft.com/2011/01/fabric">

 <ServiceManifestRefServiceManifestName="VisualObjects.ActorService" ServiceManifestVersion="2.0" />
```


Τώρα, δημιουργήστε το έργο, επιλέγοντας απλώς το έργο **ActorService** , και, στη συνέχεια, κάνοντας δεξί κλικ και επιλέγοντας την επιλογή " **Δημιουργία** " στο Visual Studio. Εάν επιλέξετε **εκ νέου δημιουργία όλες**, θα πρέπει να ενημερώσετε τις εκδόσεις για όλα τα έργα, επειδή ο κώδικας θα έχει αλλάξει. Επόμενο, ας συσκευασία της ενημερωμένης εφαρμογής κάνοντας δεξί κλικ σε ***VisualObjectsApplication***, επιλέγοντας το μενού ύφασμα υπηρεσίας και επιλέγοντας **το πακέτο**. Αυτή η ενέργεια δημιουργεί ένα πακέτο εφαρμογών που μπορούν να αναπτυχθούν.  Εφαρμογή σας ενημερωμένο είναι έτοιμο για ανάπτυξη.


## <a name="step-3--decide-on-health-policies-and-upgrade-parameters"></a>Βήμα 3: Αποφασίστε σχετικά με τις πολιτικές εύρυθμης λειτουργίας και αναβάθμιση παραμέτρους

Εξοικειωθείτε με την [εφαρμογή αναβάθμισης παραμέτρους](service-fabric-application-upgrade-parameters.md) και τη [διαδικασία αναβάθμισης](service-fabric-application-upgrade.md) για να κατανοήσει καλά τα διάφορα αναβάθμισης παραμέτρους, λήξη περιόδων και εύρυθμης λειτουργίας κριτηρίου εφαρμοστεί. Για αυτόν τον οδηγό, το κριτήριο αξιολόγησης εύρυθμης λειτουργίας υπηρεσίας έχει οριστεί στην προεπιλεγμένη (και προτεινόμενα) τιμές, γεγονός που σημαίνει ότι όλες οι υπηρεσίες και τις εμφανίσεις πρέπει να είναι _σε καλή κατάσταση_ μετά την αναβάθμιση.  

Ωστόσο, ας αύξηση του *HealthCheckStableDuration* σε 60 δευτερόλεπτα (έτσι ώστε οι υπηρεσίες είναι σε καλή κατάσταση για τουλάχιστον 20 δευτερόλεπτα πριν από την αναβάθμιση προχωρά στο επόμενο τομέα ενημερωμένη έκδοση).  Ας επίσης να ορίσετε το *UpgradeDomainTimeout* να είναι 1200 δευτερόλεπτα και το *UpgradeTimeout* να είναι 3000 δευτερόλεπτα.

Τέλος, ας επίσης να ορίσετε το *UpgradeFailureAction* επαναφοράς. Αυτή η επιλογή απαιτεί ύφασμα υπηρεσίας για να επαναφέρετε την εφαρμογή στην προηγούμενη έκδοση εάν αντιμετωπίσει προβλήματα κατά την αναβάθμιση. Επομένως, κατά την εκκίνηση της αναβάθμισης (στο βήμα 4), τις παρακάτω παραμέτρους καθορίζονται:

FailureAction = επαναφοράς

HealthCheckStableDurationSec = 60

UpgradeDomainTimeoutSec = 1200

UpgradeTimeout = 3000


## <a name="step-4-prepare-application-for-upgrade"></a>Βήμα 4: Προετοιμασία εφαρμογής για αναβάθμιση

Τώρα, η εφαρμογή είναι δομημένα και είστε έτοιμοι να αναβαθμιστούν. Εάν ανοίξετε ένα παράθυρο του PowerShell ως διαχειριστής και τύπος **Get-ServiceFabricApplication**, αυτό θα πρέπει να σας επιτρέπουν να γνωρίζετε ότι είναι τύπος εφαρμογής 1.0.0.0 των **VisualObjects** που έχει αναπτυχθεί.  

Το πακέτο εφαρμογών είναι αποθηκευμένο στην ακόλουθη διαδρομή σχετική όπου έχετε χωρίς συμπίεση στο SDK ύφασμα υπηρεσίας - *Samples\Services\Stateful\VisualObjects\VisualObjects\obj\x64\Debug*. Πρέπει να βρείτε ένα φάκελο "Package" σε αυτόν τον κατάλογο, όπου είναι αποθηκευμένο το πακέτο εφαρμογών. Ελέγξτε τις σημάνσεις χρόνου για να βεβαιωθείτε ότι είναι στην πιο πρόσφατη έκδοση (ίσως χρειαστεί να τροποποιήσετε τις διαδρομές κατάλληλα καθώς και).

Τώρα ας αντιγράψτε το πακέτο εφαρμογών ενημερωμένες το ImageStore ύφασμα υπηρεσίας (όπου είναι αποθηκευμένες στα πακέτα εφαρμογών από ύφασμα υπηρεσίας). Η παράμετρος *ApplicationPackagePathInImageStore* ενημερώνει ύφασμα υπηρεσία όπου είναι δυνατό να εντοπίσει το πακέτο εφαρμογών. Έχουμε την ενημερωμένη εφαρμογή "VisualObjects\_V2" με την ακόλουθη εντολή (ίσως χρειαστεί να τροποποιήσετε διαδρομές ξανά σωστά).

```powershell
Copy-ServiceFabricApplicationPackage  -ApplicationPackagePath .\Samples\Services\Stateful\VisualObjects\VisualObjects\obj\x64\Debug\Package
-ImageStoreConnectionString fabric:ImageStore   -ApplicationPackagePathInImageStore "VisualObjects\_V2"
```

Το επόμενο βήμα είναι να δηλώσετε αυτής της εφαρμογής υπηρεσίας ύφασμα, το οποίο μπορούν να εκτελεστούν χρησιμοποιώντας την ακόλουθη εντολή:

```powershell
Register-ServiceFabricApplicationType -ApplicationPathInImageStore "VisualObjects\_V2"
```

Εάν δεν ολοκληρωθεί με επιτυχία την προηγούμενη εντολή, είναι πιθανό ότι χρειάζεστε ένα αναδόμηση όλων των υπηρεσιών. Όπως αναφέρεται στο βήμα 2, ίσως χρειαστεί να ενημερώσετε την έκδοση WebService καθώς και.

## <a name="step-5-start-the-application-upgrade"></a>Βήμα 5: Έναρξη της αναβάθμισης εφαρμογής

Τώρα, θα σας είστε έτοιμοι να ξεκινήσετε την αναβάθμιση της εφαρμογής, χρησιμοποιώντας την ακόλουθη εντολή:

```powershell
Start-ServiceFabricApplicationUpgrade -ApplicationName fabric:/VisualObjects -ApplicationTypeVersion 2.0.0.0 -HealthCheckStableDurationSec 60 -UpgradeDomainTimeoutSec 1200 -UpgradeTimeout 3000   -FailureAction Rollback -Monitored
```


Το όνομα της εφαρμογής είναι ίδια όπως ήταν που περιγράφονται στο αρχείο *ApplicationManifest.xml* . Υπηρεσία ύφασμα χρησιμοποιεί αυτό το όνομα για να προσδιορίσετε ποια εφαρμογή γρήγορα αναβαθμίζεται. Εάν ορίσετε τη λήξη περιόδων για να είναι πολύ μικρό, που μπορεί να αντιμετωπίσετε ένα μήνυμα αποτυχία που αναφέρει το πρόβλημα. Ανατρέξτε στην ενότητα αντιμετώπισης προβλημάτων ή να αυξήσετε τη λήξη περιόδων.

Σήμερα, όπως το προϊόν αναβάθμισης εφαρμογής, μπορείτε να παρακολουθείτε το με την Εξερεύνηση των υπηρεσιών ύφασμα ή με τη χρήση του PowerShell παρακάτω εντολή: **ύφασμα Get-ServiceFabricApplicationUpgrade: / VisualObjects**.

Μετά από μερικά λεπτά, την κατάσταση που λάβατε χρησιμοποιώντας την προηγούμενη εντολή PowerShell, θα πρέπει να αναφέρει ότι έχουν αναβαθμιστεί σε όλους τους τομείς ενημέρωση (ολοκληρωθεί). Και πρέπει να βρείτε ότι έχετε ξεκινήσει τα οπτικά αντικείμενα στο παράθυρο του προγράμματος περιήγησης, περιστροφή!

Μπορείτε να δοκιμάσετε την αναβάθμιση από την έκδοση 2 στην έκδοση 3 ή από την έκδοση 2 στην έκδοση 1 ως άσκηση. Μετακίνηση από την έκδοση 2 στην έκδοση 1 θεωρείται επίσης μια αναβάθμιση. Αναπαραγωγή με διακοπές και τις πολιτικές εύρυθμης λειτουργίας για να είστε εξοικειωμένοι με αυτές. Όταν αναπτύσσετε σε ένα σύμπλεγμα Azure, οι παράμετροι πρέπει να οριστούν κατάλληλα. Καλό είναι να ορίσετε τη λήξη περιόδων συντηρητικά.


## <a name="next-steps"></a>Επόμενα βήματα

[Αναβάθμιση εφαρμογής σας με χρήση του Visual Studio](service-fabric-application-upgrade-tutorial.md) σάς καθοδηγεί σε μια εφαρμογή αναβάθμιση χρήση του Visual Studio.

Να ελέγχετε τον τρόπο αναβαθμίζει την εφαρμογή σας, χρησιμοποιώντας [παραμέτρους αναβάθμιση](service-fabric-application-upgrade-parameters.md).

Κάνει σας αναβαθμίσεις εφαρμογή συμβατά μαθαίνοντας πώς μπορείτε να χρησιμοποιήσετε [δεδομένα σειριοποίησης](service-fabric-application-upgrade-data-serialization.md).

Μάθετε πώς μπορείτε να χρησιμοποιήσετε λειτουργίες για προχωρημένους κατά την αναβάθμιση της εφαρμογής σας με αναφορά σε [θέματα για προχωρημένους](service-fabric-application-upgrade-advanced.md).

Διορθώστε συνήθη προβλήματα στην εφαρμογή αναβαθμίσεις με αναφορά σε τα βήματα στο θέμα [Αντιμετώπιση προβλημάτων εφαρμογής αναβαθμίσεις](service-fabric-application-upgrade-troubleshooting.md).
