<properties 
    pageTitle="Λεπτομέρειες ρύθμισης παραμέτρων δικτύου για την εργασία με δρομολόγηση Express" 
    description="Λεπτομέρειες ρύθμισης παραμέτρων δικτύου για την εκτέλεση της εφαρμογής υπηρεσίας περιβάλλοντα σε μια εικονική δίκτυα συνδεδεμένο με ένα κύκλωμα ExpressRoute." 
    services="app-service" 
    documentationCenter="" 
    authors="stefsch" 
    manager="nirma" 
    editor=""/>

<tags 
    ms.service="app-service" 
    ms.workload="na" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="10/14/2016" 
    ms.author="stefsch"/>   

# <a name="network-configuration-details-for-app-service-environments-with-expressroute"></a>Λεπτομέρειες ρύθμισης παραμέτρων δικτύου για περιβάλλοντα εφαρμογής υπηρεσίας με ExpressRoute 

## <a name="overview"></a>Επισκόπηση ##
Οι πελάτες μπορούν να συνδεθούν ένα [Azure ExpressRoute] [ ExpressRoute] κυκλώματος προς τους υποδομή εικονικού δικτύου, επέκταση, επομένως, το δίκτυο εσωτερικής εγκατάστασης σε Azure.  Περιβάλλον εφαρμογής υπηρεσίας μπορούν να δημιουργηθούν σε ένα υποδίκτυο αυτού του [εικονικού δικτύου] [ virtualnetwork] υποδομής.  Εφαρμογές που εκτελούνται στο περιβάλλον υπηρεσίας εφαρμογής, στη συνέχεια, να δημιουργήσετε ασφαλείς συνδέσεις για πόρους υποστήριξης προσβάσιμα μόνο μέσω της σύνδεσης ExpressRoute.  

Μπορεί να δημιουργηθεί ένα περιβάλλον εφαρμογής υπηρεσίας στο **είτε** ένα διαχειριστή πόρων Azure εικονικού δικτύου, **ή** μια κλασική ανάπτυξη του μοντέλου εικονικού δικτύου.  Με μια πρόσφατη αλλαγή που κάνατε στο 2016 Ιουνίου, ASEs επίσης τώρα μπορεί να αναπτυχθεί σε εικονικό δίκτυα που χρησιμοποιούν είτε δημόσια διεύθυνση περιοχές ή κενά διαστήματα διεύθυνση RFC1918 (π.χ. Οι ιδιωτικές διευθύνσεις). 

[AZURE.INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)] 

## <a name="required-network-connectivity"></a>Η συνδεσιμότητα του δικτύου απαιτείται ##
Υπάρχουν απαιτήσεις συνδεσιμότητας δικτύου για εφαρμογή υπηρεσίας περιβάλλοντα που δεν μπορεί να πληρούνται αρχικά σε ένα εικονικό δίκτυο συνδεδεμένο με ένα ExpressRoute.  Εφαρμογή υπηρεσίας περιβάλλοντα απαιτούν όλα τα εξής για να λειτουργήσει σωστά:


-  Η συνδεσιμότητα του δικτύου εξερχομένων στο χώρο αποθήκευσης Azure τελικά σημεία σε όλο τον κόσμο σε δύο θύρες 80 και 443.  Αυτό περιλαμβάνει που βρίσκεται στην ίδια περιοχή κατά την εφαρμογή υπηρεσίας περιβάλλον, καθώς και τα τελικά σημεία χώρου αποθήκευσης που βρίσκονται σε **άλλες** περιοχές Azure τα τελικά σημεία.  Επίλυση Azure τελικά σημεία αποθήκευσης κάτω από τους παρακάτω τομείς DNS: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net* και *file.core.windows.net*.  
-  Η συνδεσιμότητα του δικτύου εξερχομένων για την υπηρεσία Azure αρχεία στη θύρα 445.
-  Η συνδεσιμότητα του δικτύου εξερχομένων για τα τελικά σημεία Sql DB που βρίσκεται στην ίδια περιοχή ως το περιβάλλον εφαρμογής υπηρεσίας.  Επίλυση SQL DB τελικά σημεία κάτω από τον παρακάτω τομέα: *database.windows.net*.  Αυτό απαιτεί Άνοιγμα πρόσβαση σε θύρες 1433, 11000 11999 και 14000 14999.  Για περισσότερες λεπτομέρειες, ανατρέξτε [σε αυτό το άρθρο χρήση της θύρας V12 βάσης δεδομένων Sql](../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).
-  Η συνδεσιμότητα του δικτύου εξερχομένων για τα τελικά σημεία επίπεδο Azure διαχείρισης (ASM και ARM τελικά σημεία).  Αυτό περιλαμβάνει εξερχόμενη σύνδεση με *management.core.windows.net* και *management.azure.com*. 
-  Η συνδεσιμότητα του δικτύου εξερχομένων *ocsp.msocsp.com*, *mscrl.microsoft.com* και *crl.microsoft.com*.  Αυτό είναι απαραίτητο για την υποστήριξη λειτουργίες SSL.
-  Τις παραμέτρους DNS για το εικονικό δίκτυο πρέπει να είναι δυνατό να επιλύσει όλα τα τελικά σημεία και τους τομείς που αναφέρονται σε τα παλαιότερα σημεία.  Εάν δεν είναι δυνατό να επιλυθούν αυτά τα τελικά σημεία, θα αποτύχει προσπάθειες Δημιουργία εφαρμογής υπηρεσίας περιβάλλον και υπάρχουσα εφαρμογή υπηρεσίας περιβάλλοντα θα επισημανθούν ως κατεστραμμένες.
-  Εξερχόμενη πρόσβαση στη θύρα 53 απαιτείται για την επικοινωνία με τους διακομιστές DNS.
-  Εάν υπάρχει ένα προσαρμοσμένο διακομιστή DNS από την άλλη πλευρά μιας πύλης VPN, ο διακομιστής DNS πρέπει να είναι προσβάσιμος από το υποδίκτυο που περιέχει το περιβάλλον εφαρμογής υπηρεσίας. 
-  Τη διαδρομή εξερχομένων δικτύου δεν διέρχονται από εσωτερικές εταιρικό διακομιστές μεσολάβησης, ούτε είναι δυνατόν να γίνει διοχέτευση στην εσωτερική εγκατάσταση ισχύ.  Αυτή η ενέργεια αλλάζει τη αποτελεσματικές διεύθυνση NAT εξερχόμενη κυκλοφορία δικτύου από το περιβάλλον της εφαρμογής υπηρεσίας.  Αλλαγή της διεύθυνσης NAT από μια εφαρμογή υπηρεσίας περιβάλλον εξερχόμενη κυκλοφορία του δικτύου θα προκαλέσει αποτυχίες συνδεσιμότητας σε πολλά από τα τελικά σημεία που αναφέρονται παραπάνω.  Το αποτέλεσμα αποτυχημένων προσπαθειών Δημιουργία εφαρμογής υπηρεσίας περιβάλλον, καθώς και προηγουμένως σε καλή κατάσταση εφαρμογής υπηρεσίας περιβάλλοντα που έχει επισημανθεί ως κατεστραμμένες.  
-  Εισερχόμενη πρόσβαση στο δίκτυο για να απαιτείται θύρες για πρέπει να επιτρέπεται η εφαρμογή υπηρεσίας περιβάλλοντα που περιγράφεται σε αυτό το [άρθρο][requiredports].

Μπορώ να πληρούνται οι απαιτήσεις DNS, εξασφαλίζοντας έγκυρη υποδομή DNS έχει ρυθμιστεί και διατηρούνται για το εικονικό δίκτυο.  Εάν για κάποιο λόγο τη ρύθμιση παραμέτρων DNS αλλάξει αφού δημιουργηθεί ένα περιβάλλον εφαρμογής υπηρεσίας, οι προγραμματιστές να επιβάλετε ένα περιβάλλον υπηρεσίας εφαρμογή, μπορείτε να ορίσετε τη νέα ρύθμιση παραμέτρων του DNS.  Ενεργοποίηση συνάθροισης επανεκκίνηση περιβάλλον χρησιμοποιώντας το εικονίδιο "Επανεκκίνηση" που βρίσκεται στο επάνω μέρος του blade διαχείρισης εφαρμογής υπηρεσίας περιβάλλον στην [πύλη του Azure] [ NewPortal] θα έχει ως αποτέλεσμα το περιβάλλον μπορείτε να ορίσετε τη νέα ρύθμιση παραμέτρων του DNS.

Τις απαιτήσεις πρόσβασης δικτύου εισερχόμενη να να πληρούνται από τη ρύθμιση των παραμέτρων μιας [ομάδας ασφαλείας δικτύου] [ NetworkSecurityGroups] στο περιβάλλον των εφαρμογών υπηρεσίας υποδίκτυο για να επιτρέψετε την απαιτούμενη πρόσβαση, όπως περιγράφεται σε αυτό το [άρθρο][requiredports].

## <a name="enabling-outbound-network-connectivity-for-an-app-service-environment"></a>Ενεργοποίηση της σύνδεσης εξερχομένων δικτύου για ένα περιβάλλον εφαρμογής υπηρεσίας##
Από προεπιλογή, ένα που έχουν δημιουργηθεί πρόσφατα κύκλωμα ExpressRoute Εμφανίζει κοινοποιήσεις μια προεπιλεγμένη δρομολόγηση που επιτρέπει την εξερχόμενη σύνδεση στο Internet.  Με αυτήν τη ρύθμιση θα μπορείτε να συνδεθείτε με άλλους Azure τελικά σημεία περιβάλλον εφαρμογής υπηρεσίας.

Ωστόσο είναι μια κοινές ρυθμίσεις παραμέτρων πελάτη για να ορίσετε τις δικές τους προεπιλεγμένη δρομολόγηση (0.0.0.0/0) που επιβάλει εξερχόμενη κυκλοφορία Internet αντί για αυτό ροή εσωτερικής εγκατάστασης.  Αυτήν τη ροή κυκλοφορίας αλλαγές είναι πάντοτε εφαρμογή υπηρεσίας περιβάλλοντα επειδή την εξερχόμενη κυκλοφορία είναι είτε αποκλεισμένων εσωτερικής εγκατάστασης ή NAT που κάνατε σε ένα σύνολο αναγνωρίσιμη διευθύνσεις που δεν λειτουργούν πλέον με διάφορες Azure τελικά σημεία.

Η λύση είναι να ορίσετε ένα (ή περισσότερα) δρομολογεί ορίζονται από το χρήστη (UDRs) στο υποδίκτυο που περιέχει το περιβάλλον εφαρμογής υπηρεσίας.  Μια UDR καθορίζει δρομολογεί συγκεκριμένο υποδίκτυο που θα εξακολουθήσουν να ισχύουν αντί για την προεπιλεγμένη δρομολόγηση.

Εάν είναι δυνατόν, συνιστάται να χρησιμοποιήσετε τις ακόλουθες ρυθμίσεις παραμέτρων:

- Η ρύθμιση παραμέτρων ExpressRoute κοινοποιείται 0.0.0.0/0 και από προεπιλογή ισχύ διοχετεύει όλα εξερχόμενη κυκλοφορία εσωτερικής εγκατάστασης.
- Το UDR εφαρμόζονται στο υποδίκτυο που περιέχει το περιβάλλον εφαρμογής υπηρεσίας καθορίζει 0.0.0.0/0 με έναν τύπο επόμενη μεταπήδηση του Internet (το παράδειγμα αυτό είναι πιο μακριά προς τα κάτω σε αυτό το άρθρο).

Το συνολικό εφέ από αυτά τα βήματα είναι ότι το επίπεδο υποδικτύου UDR θα έχει προτεραιότητα πάνω από το ExpressRoute υποχρεωτική διοχέτευση, διασφαλίζοντας την εξερχόμενη πρόσβαση στο Internet από το περιβάλλον της εφαρμογής υπηρεσίας.

> [AZURE.IMPORTANT] Τις διαδρομές που ορίζονται από το σε μια UDR **πρέπει να** είναι συγκεκριμένες για να αναλάβετε οποιαδήποτε δρομολογεί κοινοποιείται από τη ρύθμιση παραμέτρων ExpressRoute προτεραιότητας.  Το παρακάτω παράδειγμα χρησιμοποιεί την περιοχή διευθύνσεων γενικά 0.0.0.0/0 και ως τέτοια να ενδεχομένως να κατά λάθος παρακαμφθούν από διαφημίσεις δρομολόγηση χρησιμοποιώντας πιο συγκεκριμένες περιοχές διευθύνσεων.
>
>Εφαρμογή υπηρεσίας περιβάλλοντα δεν είναι υποστηρίζονται με ρυθμίσεις παραμέτρων ExpressRoute που **σταυρό κοινοποιήσετε δρομολογεί από τη δημόσια peering διαδρομή προς το ιδιωτικό peering path**.  Ρυθμίσεις παραμέτρων ExpressRoute που έχουν δημόσια διεισδύουν ρυθμιστεί, θα λάβετε κοινοποιήσεις διαδρομής από τη Microsoft για μια μεγάλη ομάδα περιοχές διευθύνσεων IP του Microsoft Azure.  Εάν αυτές οι περιοχές διευθύνσεων σταυρό κοινοποιείται στην ιδιωτική peering διαδρομή, το τελικό αποτέλεσμα είναι ότι όλα τα πακέτα εξερχομένων δικτύου από την εφαρμογή υπηρεσίας περιβάλλον υποδίκτυο θα ισχύουν-γίνει διοχέτευση στην υποδομή δικτύου ενός πελάτη εσωτερικής εγκατάστασης.  Αυτήν τη ροή δικτύου αυτήν τη στιγμή δεν υποστηρίζεται με εφαρμογή υπηρεσίας περιβάλλοντα.  Μια λύση για αυτό το ζήτημα είναι για να διακόψετε την δρομολογεί σταυρό διαφημίσεις από τη δημόσια peering διαδρομή στην ιδιωτική peering διαδρομή.

Πληροφορίες φόντου σε διαδρομές που ορίζονται από το χρήστη είναι διαθέσιμες σε αυτή η [Επισκόπηση][UDROverview].  

Λεπτομέρειες σχετικά με τη δημιουργία και ρύθμιση παραμέτρων διαδρομών ορίζονται από το χρήστη είναι διαθέσιμο σε αυτόν [Τον Οδηγό][UDRHowTo].

## <a name="example-udr-configuration-for-an-app-service-environment"></a>Παράδειγμα ρύθμισης παραμέτρων UDR για ένα περιβάλλον εφαρμογής υπηρεσίας ##

**Προαπαιτούμενα**

1. Εγκατάσταση του Azure Powershell από τη [σελίδα λήψεων του Azure] [ AzureDownloads] (με ημερομηνία Ιουνίου 2015 ή νεότερη έκδοση).  Στην περιοχή "Εργαλεία γραμμής εντολών" υπάρχει μια σύνδεση "Εγκατάσταση" στην περιοχή "Του Windows Powershell" που θα εγκαταστήσετε την πιο πρόσφατη cmdlet του Powershell.

2. Συνιστάται να που δημιουργείται ένα μοναδικό υποδίκτυο για αποκλειστική χρήση από ένα περιβάλλον εφαρμογής υπηρεσίας.  Αυτό εξασφαλίζει ότι το UDRs εφαρμόζονται στο υποδίκτυο θα ανοίξει μόνο εξερχόμενη κυκλοφορία για το περιβάλλον εφαρμογής υπηρεσίας.
3. **ΣΗΜΑΝΤΙΚΟ**: Μην αναπτύξετε το περιβάλλον εφαρμογής υπηρεσίας μέχρι **μετά** θα ακολουθήσετε τα παρακάτω βήματα ρύθμισης παραμέτρων.  Αυτό εξασφαλίζει ότι είναι διαθέσιμη η συνδεσιμότητα του δικτύου εξερχομένων πριν να επιχειρήσετε να αναπτύξετε ένα περιβάλλον εφαρμογής υπηρεσίας.

**Βήμα 1: Δημιουργία πίνακα με όνομα δρομολόγηση**

Το παρακάτω τμήμα κώδικα δημιουργεί έναν πίνακα δρομολόγηση που ονομάζεται "DirectInternetRouteTable" στην περιοχή Azure Δυτική ΜΑΣ:

    New-AzureRouteTable -Name 'DirectInternetRouteTable' -Location uswest

**Βήμα 2: Δημιουργήστε μία ή περισσότερες διαδρομές στον πίνακα δρομολόγησης**

Θα πρέπει να προσθέσετε μία ή περισσότερες διαδρομές στον πίνακα διαδρομών για να ενεργοποιήσετε την εξερχόμενη πρόσβαση στο Internet.  

Είναι η προτεινόμενη προσέγγιση για τη ρύθμιση παραμέτρων εξερχόμενου πρόσβαση στο Internet για να ορίσετε μια διαδρομή για 0.0.0.0/0 όπως φαίνεται παρακάτω.
  
    Get-AzureRouteTable -Name 'DirectInternetRouteTable' | Set-AzureRoute -RouteName 'Direct Internet Range 0' -AddressPrefix 0.0.0.0/0 -NextHopType Internet

Να θυμάστε ότι αυτό 0.0.0.0/0 είναι μια περιοχή διεύθυνση γενικά και, όπως θα αντικατασταθούν από πιο συγκεκριμένες περιοχές διευθύνσεων κοινοποιείται από το ExpressRoute.  Για να επαναλάβετε εκ νέου την προηγούμενη σύσταση, μια UDR με μια διαδρομή 0.0.0.0/0 πρέπει να χρησιμοποιείται σε συνδυασμό με μια ρύθμιση παραμέτρων ExressRoute που μόνο κοινοποιείται 0.0.0.0/0 καθώς και. 

Ως εναλλακτική λύση, μπορείτε να λάβετε μια ολοκληρωμένη και ενημερωμένη λίστα με τις περιοχές CIDR χρησιμοποιείται από Azure.  Το αρχείο Xml που περιέχει όλες τις περιοχές διευθύνσεων Azure IP είναι διαθέσιμο από το [Κέντρο λήψης της Microsoft][DownloadCenterAddressRanges].  

Σημείωση μέσω ότι αυτές τις περιοχές αλλάξουν με τον καιρό, έτσι απαιτεί περιοδικές μη αυτόματες ενημερώσεις για τις διαδρομές που ορίζονται από το χρήστη για να διατηρήσετε συγχρονισμένα.  Επίσης, επειδή υπάρχει ένα προεπιλεγμένο όριο επάνω 100 διαδρομών σε ένα μεμονωμένο UDR, θα πρέπει να "Σύνοψη" το περιοχές διευθύνσεων Azure IP ώστε να χωρά εντός του ορίου 100 δρομολόγηση, λαμβάνοντας υπόψη ότι UDR που ορίζονται από το διαδρομές πρέπει να είναι πιο συγκεκριμένος από τις διαδρομές κοινοποιείται από το ExpressRoute σας.  


**Βήμα 3: Ο συσχετισμός δρομολόγηση στο υποδίκτυο που περιέχει το περιβάλλον εφαρμογής υπηρεσίας**

Το τελευταίο βήμα ρύθμισης παραμέτρων είναι να συσχετίσετε τον πίνακα δρομολόγησης στο υποδίκτυο όπου πρόκειται να αναπτυχθούν το περιβάλλον εφαρμογής υπηρεσίας.  Η παρακάτω εντολή συσχετίζει την "DirectInternetRouteTable" για το "ASESubnet" που θα εμφανίσει περιέχει ένα περιβάλλον εφαρμογής υπηρεσίας.

    Set-AzureSubnetRouteTable -VirtualNetworkName 'YourVirtualNetworkNameHere' -SubnetName 'ASESubnet' -RouteTableName 'DirectInternetRouteTable'


**Βήμα 4: Τελικά βήματα**

Όταν ο πίνακας δρομολόγησης είναι συνδεδεμένο με το υποδίκτυο, συνιστάται να δοκιμάσετε πρώτα και επιβεβαιώστε το επιθυμητό αποτέλεσμα.  Για παράδειγμα, αναπτύξτε μια εικονική μηχανή στο δευτερεύον και επιβεβαιώστε ότι:


- Εξερχόμενη κυκλοφορία για τα τελικά σημεία Azure και μη Azure αναφέρθηκε προηγουμένως **σε αυτό το άρθρο είναι ρέουν προς τα κάτω το κύκλωμα ExpressRoute** .  Είναι πολύ σημαντικό για να επιβεβαιώσετε αυτήν τη συμπεριφορά, επειδή το εάν είναι εξερχόμενη κυκλοφορία από το υποδίκτυο εξακολουθεί να αναγκαστική γίνει διοχέτευση εσωτερικής εγκατάστασης, εφαρμογή υπηρεσίας περιβάλλον δημιουργίας πάντοτε θα αποτύχει. 
- Αναζητήσεις DNS για τα τελικά σημεία που αναφέρονται παραπάνω είναι όλα αναλύει σωστά. 

Αφού επιβεβαιώσει τα παραπάνω βήματα, θα πρέπει να διαγράψετε την εικονική μηχανή, επειδή το υποδίκτυο πρέπει να είναι "κενή" όταν δημιουργείται το περιβάλλον εφαρμογής υπηρεσίας.
 
Στη συνέχεια, συνεχίστε με τη δημιουργία εφαρμογής υπηρεσίας περιβάλλοντος!

## <a name="getting-started"></a>Γρήγορα αποτελέσματα
Όλα τα άρθρα και με ποιον τρόπο-για να του για εφαρμογή υπηρεσίας περιβάλλοντα είναι διαθέσιμες στο το [αρχείο README για περιβάλλοντα εφαρμογών υπηρεσίας](../app-service/app-service-app-service-environments-readme.md).

Για να ξεκινήσετε με εφαρμογή υπηρεσίας περιβάλλοντα, ανατρέξτε στο θέμα [Εισαγωγή στο περιβάλλον εφαρμογής υπηρεσίας][IntroToAppServiceEnvironment]

Για περισσότερες πληροφορίες σχετικά με την πλατφόρμα Azure εφαρμογής υπηρεσίας, ανατρέξτε στο θέμα [Azure εφαρμογής υπηρεσίας][AzureAppService].

<!-- LINKS -->
[virtualnetwork]: http://azure.microsoft.com/services/virtual-network/
[ExpressRoute]: http://azure.microsoft.com/services/expressroute/
[requiredports]: http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-control-inbound-traffic/
[NetworkSecurityGroups]: http://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[UDROverview]: http://azure.microsoft.com/documentation/articles/virtual-networks-udr-overview/
[UDRHowTo]: http://azure.microsoft.com/documentation/articles/virtual-networks-udr-how-to/
[HowToCreateAnAppServiceEnvironment]: http://azure.microsoft.com/documentation/articles/app-service-web-how-to-create-an-app-service-environment/
[AzureDownloads]: http://azure.microsoft.com/en-us/downloads/ 
[DownloadCenterAddressRanges]: http://www.microsoft.com/download/details.aspx?id=41653  
[NetworkSecurityGroups]: https://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[AzureAppService]: http://azure.microsoft.com/documentation/articles/app-service-value-prop-what-is/
[IntroToAppServiceEnvironment]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-intro/
[NewPortal]:  https://portal.azure.com
 

<!-- IMAGES -->
