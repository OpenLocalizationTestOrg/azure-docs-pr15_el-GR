<properties 
    pageTitle="Πώς μπορείτε να δημιουργήσετε ένα ASE ILB με τη χρήση προτύπων Azure διαχείριση πόρων | Microsoft Azure" 
    description="Μάθετε πώς μπορείτε να δημιουργήσετε ένα ASE εξισορρόπησης εσωτερικό φόρτωσης με τη χρήση προτύπων από διαχειριστή πόρων Azure." 
    services="app-service" 
    documentationCenter="" 
    authors="stefsch" 
    manager="nirma" 
    editor=""/>

<tags 
    ms.service="app-service" 
    ms.workload="na" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="09/21/2016" 
    ms.author="stefsch"/>   

# <a name="how-to-create-an-ilb-ase-using-azure-resource-manager-templates"></a>Πώς μπορείτε να δημιουργήσετε ένα ASE ILB με τη χρήση προτύπων Azure διαχείριση πόρων

## <a name="overview"></a>Επισκόπηση ##
Εφαρμογή υπηρεσίας περιβάλλοντα μπορούν να δημιουργηθούν με μια εσωτερική διεύθυνση εικονικού δικτύου αντί για μια δημόσια VIP.  Αυτή η διεύθυνση εσωτερικού παρέχεται από ένα στοιχείο Azure που ονομάζεται το εσωτερικό εξισορρόπηση φόρτου (ILB).  Μια ASE ILB μπορούν να δημιουργηθούν με την πύλη Azure.  Μπορεί επίσης να δημιουργηθεί με την αυτοματοποίηση κατά πρότυπα διαχείρισης πόρων Azure.  Σε αυτό το άρθρο παρουσιάζει τα βήματα και σύνταξη που απαιτούνται για να δημιουργήσετε ένα ASE ILB με τα πρότυπα για τη διαχείριση πόρων Azure.

Υπάρχουν τρία βήματα που περιλαμβάνονται στη αυτοματοποίηση δημιουργίας ενός ASE ILB:
1. Πρώτα το βασικό ASE έχει δημιουργηθεί σε ένα εικονικό δίκτυο με χρήση διεύθυνσης εξισορρόπησης εσωτερικό φόρτωση αντί για μια δημόσια VIP.  Ως μέρος αυτού του βήματος, ένα όνομα τομέα ριζικού αντιστοιχίζεται το ASE ILB.
2. Αφού δημιουργηθεί το ASE ILB, αποστέλλεται ένα πιστοποιητικό SSL.  
3. Το πιστοποιητικό SSL που έχουν αποσταλεί αντιστοιχίζεται ρητά την ASE ILB με το πιστοποιητικό SSL "Προεπιλογή".  Αυτό το πιστοποιητικό SSL θα χρησιμοποιηθεί για την κίνηση SSL εφαρμογών σε το ASE ILB όταν εξετάζονται στις εφαρμογές χρησιμοποιώντας τα κοινά ριζικό τομέα που έχουν εκχωρηθεί σε το ASE (π.χ., https://someapp.mycustomrootcomain.com)

## <a name="creating-the-base-ilb-ase"></a>Δημιουργία της βάσης ILB ASE ##
Ένα πρότυπο από διαχειριστή πόρων Azure παράδειγμα και τις σχετικές παραμέτρους αρχείου, είναι διαθέσιμες στην GitHub [εδώ][quickstartilbasecreate].

Οι περισσότερες από τις παραμέτρους του αρχείου *azuredeploy.parameters.json* είναι κοινά και για τη δημιουργία τόσο ILB ASEs, καθώς και ASEs δεσμευμένο με μια δημόσια VIP.  Η λίστα κάτω από τις κλήσεις εκτός παράμετροι ειδική σημείωση ή που είναι μοναδικές, κατά τη δημιουργία μιας ASE ILB:


- *interalLoadBalancingMode*: Ορισμός έτσι ώστε να 3, γεγονός που σημαίνει ότι τόσο την κυκλοφορία HTTP/HTTPS σε θύρες 80/443 και το στοιχείο ελέγχου/δεδομένων θύρες καναλιού λάβει υπόψη από την υπηρεσία FTP στη το ASE, στις περισσότερες περιπτώσεις θα συνδεθούν ένα ILB έχει εκχωρηθεί εσωτερική διεύθυνση εικονικού δικτύου.  Εάν αυτή η ιδιότητα αντί για αυτό έχει οριστεί σε 2, στη συνέχεια, μόνο την υπηρεσία FTP που σχετίζονται με θύρες (στοιχείο ελέγχου και δεδομένα κανάλια) θα είναι συνδεδεμένο με μια διεύθυνση ILB, ενώ η κυκλοφορία HTTP/HTTPS θα παραμείνει στο τη δημόσια VIP.
-  *dnsSuffix*: η παράμετρος αυτή καθορίζει τον προεπιλεγμένο τομέα ρίζας που εκχωρούνται σε το ASE.  Στη δημόσια παραλλαγή του Azure εφαρμογής υπηρεσίας, τον ριζικό τομέα προεπιλογή για όλες τις εφαρμογές web είναι *azurewebsites.net*.  Ωστόσο επειδή ένα ASE ILB είναι εσωτερικός εικονικού δικτύου ενός πελάτη, δεν έχει νόημα να χρησιμοποιήσετε το δημόσιας υπηρεσίας προεπιλεγμένη ριζικό τομέα.  Αντί για αυτό, μια ASE ILB πρέπει να έχει ένα προεπιλεγμένο τομέα ρίζας που έχει νόημα για χρήση μέσα σε μια εταιρεία εσωτερικής εικονικού δικτύου.  Για παράδειγμα, μια υποθετική Corporation Contoso μπορεί να χρησιμοποιήσετε μια προεπιλεγμένη ριζικό τομέα του *εσωτερικού contoso.com* για εφαρμογές που προορίζονται μόνο επιλυθεί και πρόσβαση στο δίκτυο της Contoso εικονικού. 
-  *ipSslAddressCount*: Αυτή η παράμετρος πεδίο είναι αυτόματα '' σε μια τιμή 0 στο αρχείο *azuredeploy.json* επειδή ILB ASEs έχετε μόνο μία διεύθυνση ILB.  Δεν υπάρχουν ρητές διευθύνσεις IP SSL για μια ASE ILB, και επομένως το σύνολο διευθύνσεων IP SSL για μια ASE ILB πρέπει να οριστεί στην τιμή μηδέν, διαφορετικά θα εμφανιστεί ένα σφάλμα προετοιμασίας. 

Όταν το αρχείο *azuredeploy.parameters.json* έχει συμπληρωθεί για μια ASE ILB, το ASE ILB μπορεί, στη συνέχεια, να δημιουργηθεί χρησιμοποιώντας το παρακάτω τμήμα κώδικα του Powershell.  Αλλαγή του αρχείου διαδρομές ώστε να ταιριάζει με πού βρίσκονται τα αρχεία προτύπων διαχείρισης πόρων Azure στον υπολογιστή σας.  Να θυμάστε να παρέχετε τις δικές σας τιμές για τη διαχείριση πόρων Azure ανάπτυξης όνομα και όνομα ομάδας πόρων.

    $templatePath="PATH\azuredeploy.json"
    $parameterPath="PATH\azuredeploy.parameters.json"
    
    New-AzureRmResourceGroupDeployment -Name "CHANGEME" -ResourceGroupName "YOUR-RG-NAME-HERE" -TemplateFile $templatePath -TemplateParameterFile $parameterPath

Μετά από τη διαχείριση πόρων Azure πρότυπο υποβάλλεται θα διαρκέσει μερικές ώρες για το ASE ILB θα δημιουργηθεί.  Μόλις ολοκληρωθεί η δημιουργία, η ASE ILB θα εμφανιστεί στην πύλη του UX στη λίστα των εφαρμογών υπηρεσίας περιβάλλοντα για τη συνδρομή που την ενεργοποίησε ανάπτυξης.

## <a name="uploading-and-configuring-the-default-ssl-certificate"></a>Αποστολή και τη ρύθμιση των παραμέτρων του πιστοποιητικού SSL "Προεπιλογή" ##

Αφού δημιουργηθεί το ASE ILB, ένα πιστοποιητικό SSL πρέπει να σχετίζονται με το ASE ως Χρησιμοποιήστε το πιστοποιητικό SSL "Προεπιλογή" για τον καθορισμό SSL συνδέσεων σε εφαρμογές.  Συνεχίζοντας με υποθετική Contoso Corporation παράδειγμα, αν το ASE προεπιλεγμένη DNS επίθημα είναι *εσωτερικό contoso.com*και, στη συνέχεια, μια σύνδεση για να *https://some-random-app.internal-contoso.com* απαιτεί ένα πιστοποιητικό SSL που είναι έγκυρο για **.internal contoso.com*. 

Υπάρχουν διάφορους τρόπους για να αποκτήσετε ένα έγκυρο πιστοποιητικό SSL όπως εσωτερικές αρχές έκδοσης πιστοποιητικών, αγορά ένα πιστοποιητικό από μια εξωτερική εκδότη και τη χρήση αυτο-υπογεγραμμένο πιστοποιητικό.  Ανεξάρτητα από την προέλευση του πιστοποιητικού SSL, τα παρακάτω χαρακτηριστικά πιστοποιητικό πρέπει να έχουν ρυθμιστεί σωστά:

- *Θέμα*: αυτό το χαρακτηριστικό πρέπει να οριστεί σε **.your-ρίζα-τομέα-here.com*
- *Όνομα θέματος εναλλακτική λύση*: αυτό το χαρακτηριστικό πρέπει να συμπεριλάβετε και τις δύο * *.your-ρίζα-τομέα-here.com*, και * *.scm.your-ρίζα-τομέα-here.com*.  Ο λόγος για τη δεύτερη καταχώρηση είναι ότι θα να γίνουν συνδέσεις SSL στην τοποθεσία SCM/Kudu που σχετίζονται με κάθε εφαρμογή με χρήση μιας διεύθυνσης τη φόρμα *your-app-name.scm.your-root-domain-here.com*.

Με μια έγκυρη πιστοποιητικού SSL στο χέρι, απαιτούνται δύο επιπλέον βήματα προετοιμασίας.  Το πιστοποιητικό SSL πρέπει να μετατραπεί/αποθηκευτεί ως αρχείο .pfx.  Να θυμάστε ότι το αρχείο .pfx πρέπει να συμπεριλάβετε όλα ενδιάμεσου και πιστοποιητικών ρίζας και πρέπει επίσης να ενισχύσετε την ασφάλεια με κωδικό πρόσβασης.

Στη συνέχεια, το αρχείο .pfx προκύπτει πρέπει να μετατραπούν σε μια συμβολοσειρά base64, επειδή το πιστοποιητικό SSL θα αποσταλεί με χρήση ενός προτύπου για τη διαχείριση πόρων Azure.  Επειδή τα πρότυπα διαχείρισης πόρων Azure είναι αρχεία κειμένου, το αρχείο .pfx πρέπει να μετατραπεί σε μια συμβολοσειρά base64, ώστε να μπορεί να συμπεριληφθεί ως παράμετρο του προτύπου.

Το Powershell τμήμα κώδικα παρακάτω εμφανίζει ένα παράδειγμα παράγει ένα αυτο-υπογεγραμμένο πιστοποιητικό, εξαγάγετε το πιστοποιητικό ως αρχείο .pfx, τη μετατροπή το αρχείο .pfx σε base64 μια κωδικοποιημένη συμβολοσειρά και, στη συνέχεια, αποθηκεύσετε την base64 κωδικοποιημένη συμβολοσειρά σε ξεχωριστό αρχείο.  Ο κωδικός του Powershell για κωδικοποίηση base64 ήταν προσαρμοστούν από το [Ιστολόγιο δεσμών ενεργειών του Powershell][examplebase64encoding].

    $certificate = New-SelfSignedCertificate -certstorelocation cert:\localmachine\my -dnsname "*.internal-contoso.com","*.scm.internal-contoso.com"

    $certThumbprint = "cert:\localMachine\my\" + $certificate.Thumbprint
    $password = ConvertTo-SecureString -String "CHANGETHISPASSWORD" -Force -AsPlainText

    $fileName = "exportedcert.pfx"
    Export-PfxCertificate -cert $certThumbprint -FilePath $fileName -Password $password     
    
    $fileContentBytes = get-content -encoding byte $fileName
    $fileContentEncoded = [System.Convert]::ToBase64String($fileContentBytes)
    $fileContentEncoded | set-content ($fileName + ".b64")
    
Όταν το πιστοποιητικό SSL έχει με επιτυχία που δημιουργούνται και μετατρέπονται σε μια base64 κωδικοποιημένη συμβολοσειρά, το πρότυπο διαχείρισης πόρων Azure παράδειγμα στην GitHub για [τη ρύθμιση παραμέτρων του πιστοποιητικού SSL προεπιλεγμένη] [ configuringDefaultSSLCertificate] μπορεί να χρησιμοποιηθεί.

Οι παράμετροι του αρχείου *azuredeploy.parameters.json* παρατίθενται παρακάτω:

- *appServiceEnvironmentName*: το όνομα του το ASE ILB που έχει ρυθμιστεί.
- *existingAseLocation*: συμβολοσειρά κειμένου που περιέχει το Azure περιοχή όπου έχει αναπτυχθεί το ASE ILB.  Για παράδειγμα: "Νότια κεντρικής ΜΑΣ".
- *pfxBlobString*: το based64 κωδικοποιημένη συμβολοσειρά αναπαριστάται με το αρχείο .pfx.  Χρησιμοποιώντας το τμήμα κώδικα φαίνεται παραπάνω, θα αντιγράψτε τη συμβολοσειρά που περιέχονται στο "exportedcert.pfx.b64" και να το επικολλήσετε ως η τιμή του χαρακτηριστικού *pfxBlobString* .
- *κωδικός πρόσβασης*: Ο κωδικός πρόσβασης που χρησιμοποιούνται για την ασφάλιση το αρχείο .pfx.
- *certificateThumbprint*: αποτύπωση του πιστοποιητικού.  Εάν κάνετε ανάκτηση αυτή την τιμή από Powershell (π.χ. *$certificate. Αποτύπωση* από το τμήμα κώδικα προηγούμενες), μπορείτε να χρησιμοποιήσετε την τιμή ως-είναι.  Ωστόσο εάν αντιγράψετε την τιμή από το παράθυρο διαλόγου πιστοποιητικό των Windows, μην ξεχάσετε να διαγράψετε τα περιττά κενά διαστήματα.  Το *certificateThumbprint* θα πρέπει να μοιάζει κάπως έτσι: AF3143EB61D43F6727842115BB7F17BBCECAECAE
- *certificateName*: ένα αναγνωριστικό φιλικό συμβολοσειρά της επιλογής σας χρησιμοποιούνται για την ταυτότητα του πιστοποιητικού.  Ως μέρος του το μοναδικό αναγνωριστικό για τη διαχείριση πόρων Azure χρησιμοποιείται το όνομα για την οντότητα *Microsoft.Web/certificates* που αντιπροσωπεύει το πιστοποιητικό SSL.  Όνομα **πρέπει να** τελειώνει με το εξής επίθημα: \_yourASENameHere_InternalLoadBalancingASE.  Αυτό το επίθημα χρησιμοποιείται από την πύλη ως ένδειξη ότι το πιστοποιητικό που χρησιμοποιείται για την ασφάλεια των μια ASE με δυνατότητα ILB.


Παράδειγμα συντετμημένα *azuredeploy.parameters.json* φαίνεται παρακάτω:


    {
         "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json",
         "contentVersion": "1.0.0.0",
         "parameters": {
              "appServiceEnvironmentName": {
                   "value": "yourASENameHere"
              },
              "existingAseLocation": {
                   "value": "East US 2"
              },
              "pfxBlobString": {
                   "value": "MIIKcAIBAz...snip...snip...pkCAgfQ"
              },
              "password": {
                   "value": "PASSWORDGOESHERE"
              },
              "certificateThumbprint": {
                   "value": "AF3143EB61D43F6727842115BB7F17BBCECAECAE"
              },
              "certificateName": {
                   "value": "DefaultCertificateFor_yourASENameHere_InternalLoadBalancingASE"
              }
         }
    }

Αφού συμπληρώσετε το αρχείο *azuredeploy.parameters.json* , το προεπιλεγμένο πιστοποιητικό SSL μπορούν να ρυθμιστούν χρησιμοποιώντας το παρακάτω τμήμα κώδικα του Powershell.  Αλλαγή του αρχείου διαδρομές ώστε να ταιριάζει με πού βρίσκονται τα αρχεία προτύπων διαχείρισης πόρων Azure στον υπολογιστή σας.  Να θυμάστε να παρέχετε τις δικές σας τιμές για τη διαχείριση πόρων Azure ανάπτυξης όνομα και όνομα ομάδας πόρων.

    $templatePath="PATH\azuredeploy.json"
    $parameterPath="PATH\azuredeploy.parameters.json"
    
    New-AzureRmResourceGroupDeployment -Name "CHANGEME" -ResourceGroupName "YOUR-RG-NAME-HERE" -TemplateFile $templatePath -TemplateParameterFile $parameterPath

Μετά την υποβολή του προτύπου για τη διαχείριση πόρων Azure θα χρειαστεί περίπου λεπτά 40 λεπτά ανά ASE προσκηνίου για να εφαρμόσετε την αλλαγή.  Για παράδειγμα, με μια χρησιμοποιώντας δύο εμπρός-άκρα ASE προεπιλεγμένο μέγεθος, το πρότυπο θα χρειαστεί περίπου μία ώρα και είκοσι λεπτά για να ολοκληρωθεί.  Ενώ εκτελείται το πρότυπο το ASE δεν θα μπορούν να κλιμάκωση.  

Μόλις ολοκληρωθεί το πρότυπο, είναι δυνατή η πρόσβαση εφαρμογών σε το ASE ILB μέσω HTTPS και οι συνδέσεις θα είναι ασφαλείς χρησιμοποιώντας το προεπιλεγμένο πιστοποιητικό SSL.  Το πιστοποιητικό SSL προεπιλογή θα χρησιμοποιηθεί όταν εφαρμογές σε το ASE ILB εξετάζονται με ένα συνδυασμό από το όνομα της εφαρμογής συν το όνομα κεντρικού υπολογιστή προεπιλεγμένη.  Για παράδειγμα *https://mycustomapp.internal-contoso.com* χρησιμοποιούσατε το πιστοποιητικό SSL προεπιλογή για **.internal contoso.com*.

Ωστόσο, όπως εφαρμογές που λειτουργεί με τη δημόσια υπηρεσία πολλών μισθωτών, τους προγραμματιστές να επίσης να ρυθμίσετε τις παραμέτρους host προσαρμοσμένα ονόματα για μεμονωμένες εφαρμογές και, στη συνέχεια, ρύθμιση παραμέτρων μοναδικών συνδέσεις πιστοποιητικού SNI SSL για μεμονωμένες εφαρμογές.  


## <a name="getting-started"></a>Γρήγορα αποτελέσματα

Για να ξεκινήσετε με εφαρμογή υπηρεσίας περιβάλλοντα, ανατρέξτε στο θέμα [Εισαγωγή στο περιβάλλον εφαρμογής υπηρεσίας](app-service-app-service-environment-intro.md)

Όλα τα άρθρα και με ποιον τρόπο-για να του για εφαρμογή υπηρεσίας περιβάλλοντα είναι διαθέσιμες στο το [αρχείο README για περιβάλλοντα εφαρμογών υπηρεσίας](../app-service/app-service-app-service-environments-readme.md).

[AZURE.INCLUDE [app-service-web-whats-changed](../../includes/app-service-web-whats-changed.md)]

[AZURE.INCLUDE [app-service-web-try-app-service](../../includes/app-service-web-try-app-service.md)]

<!-- LINKS -->
[quickstartilbasecreate]: https://azure.microsoft.com/documentation/templates/201-web-app-ase-ilb-create/
[examplebase64encoding]: http://powershellscripts.blogspot.com/2007/02/base64-encode-file.html 
[configuringDefaultSSLCertificate]: https://azure.microsoft.com/documentation/templates/201-web-app-ase-ilb-configure-default-ssl/ 
 
