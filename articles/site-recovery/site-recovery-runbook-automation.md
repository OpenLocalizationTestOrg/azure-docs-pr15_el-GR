<properties
   pageTitle="Προσθήκη runbooks Azure Αυτοματισμός σχέδια ανάκτησης | Microsoft Azure"
   description="Σε αυτό το άρθρο περιγράφει πώς Επαναφορά τοποθεσίας Azure τώρα σάς επιτρέπει να επεκτείνετε σχέδια ανάκτησης χρησιμοποιώντας αυτοματισμού Azure για να ολοκληρώσετε σύνθετες εργασίες κατά την ανάκτηση να Azure"
   services="site-recovery"
   documentationCenter=""
   authors="ruturaj"
   manager="gauravd"
   editor=""/>

<tags
   ms.service="site-recovery"
   ms.devlang="powershell"
   ms.tgt_pltfrm="na"
   ms.topic="article"
   ms.workload="required"
   ms.date="10/23/2016"
   ms.author="ruturajd@microsoft.com"/>


# <a name="add-azure-automation-runbooks-to-recovery-plans"></a>Προσθήκη runbooks Azure αυτοματισμού σχέδια ανάκτησης


Αυτό το πρόγραμμα εκμάθησης περιγράφει πώς Επαναφορά τοποθεσίας Azure ενοποιείται με το Azure αυτοματισμού για την παροχή επεκτασιμότητα του προγράμματα αποκατάστασης. Σχέδια ανάκτησης μπορούν να οργανώσετε ανάκτησης του σας εικονικές μηχανές που προστατεύονται με χρήση του Azure Επαναφορά τοποθεσίας για να δευτερεύοντα cloud αναπαραγωγή και να Azure σενάρια αναπαραγωγή. Βοηθούν στην το αποκατάστασης **με συνέπεια ακριβή** **επαναλαμβανόμενη**και **αυτοματοποιημένη**. Εάν αποτυγχάνει επάνω από τις εικονικές μηχανές σε Azure, ενοποίηση με το Azure αυτοματισμού επεκτείνει τα σχέδια ανάκτησης και σας δίνει τη δυνατότητα να εκτελέσει runbooks, επιτρέποντας ισχυρή αυτοματοποίηση εργασιών.

Εάν έχετε δεν ακούσει για Αυτοματισμός Azure ακόμα, εγγραφείτε [εδώ](https://azure.microsoft.com/services/automation/) και να κάνετε λήψη τους δείγματα δεσμών ενεργειών [εδώ](https://azure.microsoft.com/documentation/scripts/). Διαβάστε περισσότερα σχετικά με την [Επαναφορά τοποθεσίας Azure](https://azure.microsoft.com/services/site-recovery/) και πώς μπορείτε να οργανώσετε ανάκτησης για να Azure χρησιμοποιώντας σχέδια ανάκτησης [εδώ](https://azure.microsoft.com/blog/?p=166264).

Σε αυτό το πρόγραμμα εκμάθησης, θα εξετάσουμε πώς μπορείτε να ενοποιήσετε το Azure Αυτοματισμός runbooks σε σχέδια ανάκτησης. Θα αυτοματοποίηση απλές εργασίες που προαναφέρθηκαν απαιτείται μη αυτόματη παρέμβαση και δείτε πώς μπορείτε να μετατρέψετε αποκατάστασης πολλών βήμα σε μια ενέργεια ανάκτησης μονό κλικ. Θα επίσης εξετάσουμε πώς μπορείτε να αντιμετωπίσετε μια απλή δέσμη ενεργειών Εάν μεταβαίνετε λάθος.

## <a name="customize-the-recovery-plan"></a>Προσαρμογή του σχεδίου ανάκτησης

1. Επιτρέψτε μας ξεκινήστε από operning το blade πόρων του σχεδίου αποκατάστασης. Μπορείτε να δείτε το πρόγραμμα αποκατάστασης έχει δύο εικονικές μηχανές προστεθεί σε αυτό για την ανάκτηση. 

    ![](media/site-recovery-runbook-automation-new/essentials-rp.PNG)
---------------------

2. Κάντε κλικ στο κουμπί Προσαρμογή για να ξεκινήσετε την προσθήκη ενός runbook. Αυτό θα ανοίξει στο πρόγραμμα αποκατάστασης Προσαρμογή blade.


    ![](media/site-recovery-runbook-automation-new/customize-rp.PNG)


3. Κάντε δεξί κλικ στην ομάδα Έναρξη 1 και επιλέξτε για να προσθέσετε μια 'ενέργεια δημοσίευση Προσθήκη'.

4. Επιλέξτε για να επιλέξετε μια δέσμη ενεργειών στο το νέο blade.

5. Όνομα της δέσμης ενεργειών 'Γεια'.

6. Επιλέξτε ένα όνομα λογαριασμού αυτοματισμού. Αυτός είναι ο λογαριασμός Azure αυτοματισμού. Σημειώστε ότι αυτός ο λογαριασμός μπορεί να είναι σε οποιαδήποτε Azure Γεωγραφία αλλά πρέπει να είναι στην ίδια συνδρομή ως το θάλαμο Επαναφορά τοποθεσίας.

7. Επιλέξτε μια runbook από το λογαριασμό αυτοματισμού. Αυτή είναι η δέσμη ενεργειών που θα εκτελείται κατά την εκτέλεση του σχεδίου αποκατάστασης μετά την αποκατάσταση της πρώτης ομάδας.

    ![](media/site-recovery-runbook-automation-new/update-rp.PNG)


8. Επιλέξτε OK για να αποθηκεύσετε τη δέσμη ενεργειών. Αυτό θα προσθέσετε τη δέσμη ενεργειών στην ομάδα ενέργεια δημοσίευση ομάδας 1: Έναρξη.


    ![](media/site-recovery-runbook-automation-new/addedscript-rp.PNG)


## <a name="salient-points-of-adding-a-script"></a>Βασικά σημεία της προσθήκης μιας δέσμης ενεργειών

1. Μπορείτε να κάντε δεξί κλικ στην τη δέσμη ενεργειών και επιλέξτε 'Διαγραφή βήμα' ή 'Ενημέρωση δέσμης ενεργειών'.

2. Μια δέσμη ενεργειών μπορούν να εκτελέσουν σε το Azure κατά την ανακατεύθυνση από εσωτερικής εγκατάστασης για Azure και μπορεί να εκτελεστεί σε Azure ως μια δέσμη ενεργειών του πρωτεύοντος πριν από τον τερματισμό, κατά τη διάρκεια αποκατάσταση μετά από από το Azure στο εσωτερικής εγκατάστασης.

3. Όταν εκτελείται μια δέσμη ενεργειών, αυτό θα εισαγάγει ένα περιβάλλον πρόγραμμα αποκατάστασης.

Ακολουθεί ένα παράδειγμα του πώς θα φαίνεται η μεταβλητή περιβάλλοντος.

        {"RecoveryPlanName":"hrweb-recovery",

        "FailoverType":"Test",

        "FailoverDirection":"PrimaryToSecondary",

        "GroupId":"1",

        "VmMap":{"7a1069c6-c1d6-49c5-8c5d-33bfce8dd183":

                {"CloudServiceName":"pod02hrweb-Chicago-test",

                "RoleName":"Fabrikam-Hrweb-frontend-test"}

                }

        }


Ο παρακάτω πίνακας περιέχει όνομα και μια περιγραφή για κάθε μεταβλητή στο περιβάλλον.

**Το όνομα της μεταβλητής** | **Περιγραφή**
---|---
RecoveryPlanName | Το όνομα του προγράμματος που εκτελείται. Σας βοηθά να εκτέλεση ενεργειών που βασίζονται σε όνομα, χρησιμοποιώντας την ίδια δέσμη ενεργειών
FailoverType | Καθορίζει αν είναι δοκιμή του εφεδρικού, προγραμματισμένες ή μη προγραμματισμένες.
FailoverDirection | Καθορίστε εάν αποκατάστασης είναι πρωτεύον ή δευτερεύον
Αναγνωριστικό ομάδας | Προσδιορίστε τον αριθμό ομάδα μέσα στο πρόγραμμα αποκατάστασης όταν εκτελείται το πρόγραμμα
VmMap | Πίνακας με όλες τις εικονικές μηχανές σε ομάδα
Πλήκτρο VMMap | Μοναδικό κλειδί (GUID) για κάθε Εικονική. Είναι το ίδιο με το Αναγνωριστικό VMM η εικονική μηχανή ανάλογα με την περίπτωση.
Όνομα ρόλου | Όνομα της η Εικονική Azure που γίνεται ανάκτηση
CloudServiceName | Στην περιοχή που έχει δημιουργηθεί η εικονική μηχανή Azure όνομα υπηρεσία στο Cloud.
CloudServiceName (στο μοντέλο ανάπτυξης για τη διαχείριση πόρων) | Ομάδα πόρων Azure όνομα με το οποίο έχει δημιουργηθεί η εικονική μηχανή.


## <a name="using-complex-variables-per-recovery-plan"></a>Χρήση μεταβλητών μιγαδικού ανά σχεδίου αποκατάστασης

Ορισμένες φορές, ένα runbook απαιτεί περισσότερες πληροφορίες από μόνο του RecoveryPlanContext. Δεν υπάρχει πρώτης κλάσης μηχανισμός για τη μεταβίβαση μιας παραμέτρου σε μια runbook. Ωστόσο, εάν θέλετε να χρησιμοποιήσετε την ίδια δέσμη ενεργειών μέσω πολλά σχέδια ανάκτησης μπορείτε να χρησιμοποιήσετε τη μεταβλητή περιβάλλοντος Σχεδιασμός αποκατάστασης 'RecoveryPlanName' και να χρησιμοποιήσετε την παρακάτω πειραματικής τεχνική για να χρησιμοποιήσετε μια μεταβλητή μιγαδικού αυτοματισμού Azure σε μια runbook. Το παρακάτω παράδειγμα δείχνει πώς μπορείτε να δημιουργήσετε τρεις διαφορετικές μεταβλητή μιγαδικού στοιχεία και να τις χρησιμοποιήσετε σε runbook με βάση το όνομα του σχεδίου αποκατάστασης.

Λάβετε υπόψη ότι θέλετε να χρησιμοποιήσετε 3 επιπλέον παραμέτρους σε ένα runbook. Επιτρέψτε μας να κωδικοποιήσετε τους σε φόρμα JSON {"Var1": "testautomation", "Var2": "Μη προγραμματισμένη", "Var3": "PrimaryToSecondary"}

Χρησιμοποιήστε [αα μιγαδικού μεταβλητή](../automation/automation-variables.md#variable-types Complex variable) για να δημιουργήσετε ένα νέο πάγιο Αυτοματισμός.
Όνομα της μεταβλητής ως <RecoveryPlanName>- παραμέτρων.
Μπορείτε να χρησιμοποιήσετε την αναφορά εδώ για να δημιουργήσετε μια [μεταβλητή μιγαδικού](https://msdn.microsoft.com/library/dn913767.aspx?f=255&MSPPError=-2147217396).

Για τα προγράμματα διαφορετικό ανάκτησης, δώστε ένα όνομα της μεταβλητής ως

1. recoveryPlanName1 >-παραμέτρων
2. recoveryPlanName2 >-παραμέτρων
3. recoveryPlanName3 >-παραμέτρων

Τώρα, στη δέσμη ενεργειών που αναφέρονται σε το παραμέτρων ως

1. Λάβετε το όνομα RP από το $rpname = $Recoveryplancontext μεταβλητή
2. Λήψη διαθέσιμων στοιχείων του $paramValue = "$($rpname)-παραμέτρων"
3. Χρησιμοποιήστε αυτήν την επιλογή ως μεταβλητή μιγαδικού για το πρόγραμμα αποκατάστασης καλώντας Get-AzureAutomationVariable [-AutomationAccountName] <String> -όνομα $paramValue.

Ως παράδειγμα, για να λάβετε μεταβλητή μιγαδικού παραμέτρου για το πρόγραμμα αποκατάστασης SharepointApp, δημιουργήστε μια μεταβλητή μιγαδικού Αυτοματισμός Azure που ονομάζεται 'SharepointApp-παραμέτρων'.

Χρησιμοποιήστε στο πρόγραμμα αποκατάστασης κατά την εξαγωγή της μεταβλητής από παγίου χρησιμοποιώντας την εντολή Get-AzureAutomationVariable [-AutomationAccountName] <String> [-όνομα] $paramValue. [Αναφορά αυτό για περισσότερες λεπτομέρειες](https://msdn.microsoft.com/library/dn913772.aspx)

Με αυτόν τον τρόπο η ίδια δέσμη ενεργειών μπορεί να χρησιμοποιηθεί για διαφορετικές αποκατάστασης πρόγραμμα αποθηκεύοντας τη μεταβλητή πρόγραμμα συγκεκριμένες μιγαδικού των περιουσιακών στοιχείων.

## <a name="sample-scripts"></a>Δείγμα δεσμών ενεργειών

Για ένα αρχείο φύλαξης των δεσμών ενεργειών που μπορείτε να εισαγάγετε απευθείας στο λογαριασμό σας Αυτοματισμός, ανατρέξτε στο θέμα [Kristian Nese του αποθετηρίου OMS για τις δέσμες ενεργειών](https://github.com/krnese/AzureDeploy/tree/master/OMS/MSOMS/Solutions/asrautomation)

Η δέσμη ενεργειών εδώ είναι ένα πρότυπο από διαχειριστή πόρων Azure που θα αναπτύξετε όλα τα παρακάτω δέσμες ενεργειών

* NSG

NSG runbook θα εκχώρηση διευθύνσεων IP δημόσια σε κάθε Εικονική εντός του Σχεδιασμός αποκατάστασης και θα επισυνάψει τους προσαρμογέων δικτύου εικονικού σε μια ομάδα ασφαλείας δικτύου που θα επιτρέπεται η επικοινωνία προεπιλεγμένη

* PublicIP

Δημόσια IP runbook θα αντιστοίχιση διευθύνσεων IP δημόσια σε κάθε Εικονική εντός του Σχεδιασμός αποκατάστασης. Πρόσβαση στις μηχανές και εφαρμογές θα εξαρτώνται από τις ρυθμίσεις του τείχους προστασίας μέσα σε κάθε επισκέπτη


* CustomScript

CustomScript runbook θα εκχώρηση διευθύνσεων IP δημόσια σε κάθε Εικονική εντός του Σχεδιασμός αποκατάστασης και να εγκαταστήσετε μια επέκταση προσαρμοσμένη δέσμη ενεργειών που θα τραβήξτε τη δέσμη ενεργειών που αναφέρονται σε κατά την ανάπτυξη του προτύπου

* NSGwithCustomScript

Το NSGwithCustomScript runbook θα αντιστοιχίσει διευθύνσεις IP δημόσια σε κάθε Εικονική μέσα αποκατάστασης σχεδιασμό, την εγκατάσταση μια προσαρμοσμένη δέσμη ενεργειών χρησιμοποιώντας την επέκταση και σύνδεση των προσαρμογέων δικτύου εικονικού με μια δυνατότητα NSG προεπιλεγμένη εισερχόμενων και εξερχόμενων επικοινωνίας για απομακρυσμένη πρόσβαση

## <a name="additional-resources"></a>Πρόσθετοι πόροι

[Υπηρεσία Azure αυτοματοποίησης εκτελείται ως λογαριασμός](../automation/automation-sec-configure-azure-runas-account.md)

[Επισκόπηση Azure αυτοματισμού] (http://msdn.microsoft.com/library/azure/dn643629.aspx "Επισκόπηση Azure αυτοματισμού")

[Δείγμα δεσμών ενεργειών αυτοματισμού Azure] (http://gallery.technet.microsoft.com/scriptcenter/site/search?f[0].Type=User&f[0].Value=SC%20Automation%20Product%20Team&f[0].Text=SC%20Automation%20Product%20Team "Δείγμα δεσμών ενεργειών αυτοματισμού Azure")
