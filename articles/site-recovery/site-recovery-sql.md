<properties 
    pageTitle="Προστασία του SQL Server με αποκατάσταση SQL Server και Επαναφορά τοποθεσίας Azure | Microsoft Azure" 
    description="Σε αυτό το άρθρο περιγράφει τον τρόπο για την αναπαραγωγή του SQL Server, χρησιμοποιώντας δυνατότητες καταστροφής Azure τοποθεσίας ανάκτησης του SQL Server." 
    services="site-recovery" 
    documentationCenter="" 
    authors="rayne-wiselman" 
    manager="jwhit" 
    editor=""/>

<tags 
    ms.service="site-recovery" 
    ms.workload="backup-recovery" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="08/04/2016" 
    ms.author="raynew"/>


# <a name="protect-sql-server-with-sql-server-disaster-recovery-and-azure-site-recovery"></a>Προστασία του SQL Server με αποκατάσταση SQL Server και Επαναφορά τοποθεσίας Azure 


Της υπηρεσίας ανάκτησης τοποθεσίας Azure συμβάλλει της στρατηγικής ανάκτησης (BCDR) επιχειρήσεις συνέχειας και καταστροφή από orchestrating αναπαραγωγή, ανακατεύθυνσης και αποκατάστασης εικονικές μηχανές και φυσική διακομιστών. Μηχανές μπορούν να αναπαραχθούν Azure ή σε ένα κέντρο δεδομένων δευτερεύοντα εσωτερικής εγκατάστασης. Για μια γρήγορη επισκόπηση Διαβάστε [Τι είναι η Επαναφορά τοποθεσίας Azure;](site-recovery-overview.md).

 Σε αυτό το άρθρο περιγράφει τον τρόπο για την προστασία του παρασκηνίου SQL Server από μια εφαρμογή χρησιμοποιώντας ένα συνδυασμό τεχνολογίες SQL Server BCDR και Επαναφορά τοποθεσίας Azure. Θα πρέπει να έχετε μια καλή Κατανόηση των δυνατοτήτων αποκατάστασης από καταστροφή του SQL Server (ανακατεύθυνση συμπλεγμάτων, ομάδες διαθεσιμότητας AlwaysOn, της βάσης δεδομένων αποτελούν πιστή αναπαράσταση, συνδεθείτε αποστολής) και της ανάκτησης τοποθεσίας Azure, πριν να αναπτύξετε τα σενάρια που περιγράφονται σε αυτό το άρθρο.



## <a name="overview"></a>Επισκόπηση

Πολλά φόρτους εργασίας Χρησιμοποιήστε SQL Server ως βάση. Εφαρμογές, όπως το SharePoint, Dynamics και SAP χρήση SQL Server για την υλοποίηση υπηρεσίες δεδομένων.  Εφαρμογές ανάπτυξη του SQL Server με πολλούς διαφορετικούς τρόπους:

- **Μεμονωμένη SQL Server**: SQL Server και όλες τις βάσεις δεδομένων φιλοξενούνται σε έναν υπολογιστή (φυσικά ή μια εικονική). Όταν εικονικά διαμορφωμένη συστοιχία, κεντρικός υπολογιστής συμπλέγματος χρησιμοποιείται για τοπική υψηλή διαθεσιμότητα. Δεν υπάρχει υψηλή διαθεσιμότητα επισκέπτη επιπέδου έχει υλοποιηθεί.
- **SQL Server ανακατεύθυνσης συμπλέγματος παρουσίες (πάντα στην FCI)**: δύο ή περισσότερες κόμβους παρουσίες του SQL server με κοινόχρηστα δίσκων έχουν ρυθμιστεί οι παράμετροι σε ένα σύμπλεγμα ανακατεύθυνσης των Windows. Εάν οποιαδήποτε από τις παρουσίες συμπλέγματος είναι προς τα κάτω, το σύμπλεγμα μπορεί να αποτύχει πάνω από SQL Server σε μια άλλη παρουσία. Αυτή η διαμόρφωση χρησιμοποιείται συνήθως για HA σε μια κύρια τοποθεσία. Αυτό δεν προστασία από αποτυχία ή μη διαθεσιμότητα στο επίπεδο κοινόχρηστου χώρου αποθήκευσης. Κοινή χρήση δίσκου μπορεί να υλοποιηθεί χρησιμοποιώντας ISCSI, κανάλι ίνα ή VHDx θέσει σε κοινή χρήση.
- **Πάντα στη διαθεσιμότητα ομάδες SQL**: σε αυτό το πρόγραμμα εγκατάστασης, δύο κόμβους είναι το πρόγραμμα εγκατάστασης σε ένα κοινόχρηστο τίποτα συμπλέγματος με βάσεις δεδομένων SQL Server έχει ρυθμιστεί σε μια ομάδα διαθεσιμότητα με σύγχρονη αναπαραγωγής και αυτόματη ανακατεύθυνση.

Σε εκδόσεις για μεγάλες επιχειρήσεις, SQL Server παρέχει επίσης εγγενούς καταστροφής τεχνολογιών αποκατάστασης για την ανάκτηση βάσεων δεδομένων σε μια απομακρυσμένη τοποθεσία. Σε αυτό το άρθρο, θα αξιοποιήσετε και θα την ενοποίηση με αυτά τα εγγενή τεχνολογιών αποκατάστασης από καταστροφή SQL: 

- Πάντα στη διαθεσιμότητα ομάδες SQL για αποκατάσταση για SQL Server 2012 ή εκδόσεις Enterprise 2014.
- SQL βάσης δεδομένων αποτελούν πιστή αναπαράσταση στη λειτουργία υψηλής ασφάλειας για SQL Server Standard edition (οποιαδήποτε έκδοση) ή για SQL Server 2008 R2.


Επαναφορά τοποθεσίας να προστατεύσετε SQL Server, όπως συνοψίζεται στον πίνακα.

 |**Εσωτερικής εγκατάστασης στην εσωτερική εγκατάσταση** | **Εσωτερικής εγκατάστασης για να Azure** 
---|---|---
**Hyper-V** | Ναι | Ναι
**VMware** | Ναι | Ναι 
**Φυσικός διακομιστής** | Ναι | Ναι


## <a name="support-and-integration"></a>Υποστήριξη και ενοποίηση

Αυτές τις εκδόσεις του SQL Server που υποστηρίζονται από τα σενάρια σε αυτό το άρθρο:


- SQL Server 2014 για μεγάλες επιχειρήσεις και τυπική
- SQL Server 2012 για μεγάλες επιχειρήσεις και τυπική
- SQL Server 2008 R2 για μεγάλες επιχειρήσεις και τυπική


Επαναφορά τοποθεσίας είναι δυνατό να ενοποιηθούν με εγγενή τις τεχνολογίες SQL Server BCDR συνοψίζονται στον παρακάτω πίνακα για την παροχή μια λύση αποκατάστασης από καταστροφή.

**Η δυνατότητα** |**Λεπτομέρειες** | **Έκδοση SQL Server** 
---|---|---
**Ομάδας διαθεσιμότητας AlwaysOn** | Πολλές παρουσίες μεμονωμένη του SQL Server κάθε λειτουργούν σε ένα σύμπλεγμα ανακατεύθυνσης που έχει πολλούς κόμβους.<br/><br/>Βάσεις δεδομένων μπορεί να είναι ομαδοποιημένα σε ανακατεύθυνσης ομάδες που μπορούν να αντιγραφούν (αντικριστά) σε παρουσίες του SQL Server, έτσι ώστε να είναι απαραίτητη χωρίς κοινόχρηστου χώρου αποθήκευσης.<br/><br/>Παρέχει αποκατάσταση ανάμεσα σε μια κύρια τοποθεσία και μία ή περισσότερες δευτερεύουσες τοποθεσίες. Δύο κόμβους μπορεί να ρυθμιστεί σε ένα κοινόχρηστο τίποτα σύμπλεγμα με βάσεις δεδομένων SQL Server έχει ρυθμιστεί σε μια ομάδα διαθεσιμότητα με σύγχρονη αναπαραγωγής και αυτόματη ανακατεύθυνση. | SQL Server 2014 & έκδοση Enterprise 2012
**Ανακατεύθυνση συμπλεγμάτων (AlwaysOn FCI)** | SQL Server αξιοποιεί Windows ανακατεύθυνση συμπλεγμάτων για υψηλή διαθεσιμότητα από φόρτους εργασίας του SQL Server εσωτερικής εγκατάστασης.<br/><br/>Κόμβοι παρουσίες του SQL Server με κοινόχρηστα δίσκων έχουν ρυθμιστεί οι παράμετροι σε ένα σύμπλεγμα ανακατεύθυνσης. Εάν μια παρουσία είναι προς τα κάτω στο σύμπλεγμα αποτυγχάνει πάνω από διαφορετικό.<br/><br/>Το σύμπλεγμα δεν προστασία από αποτυχία ή ΡΕΥΜΑΤΟΣ στο κοινόχρηστο χώρο αποθήκευσης. Κοινόχρηστο δίσκο μπορούν να εφαρμοστούν με το iSCSI, ίνα καναλιού, ή VHDXs σε κοινή χρήση. | Εκδόσεις του SQL Server για μεγάλες επιχειρήσεις<br/><br/>SQL Server Standard edition (περιορίζεται σε δύο κόμβους μόνο)
**Βάση δεδομένων που αποτελούν πιστή αναπαράσταση (υψηλή ασφάλεια λειτουργίας)** | Προστατεύει μία βάση δεδομένων σε ένα δευτερεύον αντίγραφο. Διαθέσιμο σε δύο υψηλή ασφάλεια (σύγχρονη) λειτουργιών (ασύγχρονης) αναπαραγωγής υψηλές επιδόσεις και. Δεν απαιτεί ένα σύμπλεγμα ανακατεύθυνσης. | SQL Server 2008 R2<br/><br/>SQL Server Enterprise όλες τις εκδόσεις
**Μεμονωμένη SQL Server** | Το SQL Server και βάση δεδομένων φιλοξενούνται σε ένα διακομιστή (φυσική ή εικονική). Κεντρικός υπολογιστής συμπλέγματος χρησιμοποιείται για υψηλή διαθεσιμότητα εάν ο διακομιστής είναι εικονικό. Υψηλή διαθεσιμότητα χωρίς επισκέπτη επιπέδου. | Για μεγάλες επιχειρήσεις ή τυπική edition

## <a name="deployment-recommendations"></a>Συστάσεις ανάπτυξης


Αυτός ο πίνακας συνοψίζει μας συστάσεις για την ενοποίηση τεχνολογίες SQL Server BCDR με Επαναφορά τοποθεσίας.

**Έκδοση** |**Edition** | **Ανάπτυξη** | **Εσωτερικής εγκατάστασης για να εσωτερικής εγκατάστασης** | **Εσωτερικής εγκατάστασης για να Azure** 
---|---|---|---|---
SQL Server 2014 ή 2012 | Για μεγάλες επιχειρήσεις | Παρουσία συμπλέγματος ανακατεύθυνσης | Ομάδες διαθεσιμότητας AlwaysOn | Ομάδες διαθεσιμότητας AlwaysOn
 | Για μεγάλες επιχειρήσεις | Ομάδες διαθεσιμότητας AlwaysOn για υψηλή διαθεσιμότητα | Ομάδες διαθεσιμότητας AlwaysOn | Ομάδες διαθεσιμότητας AlwaysOn
 | Τυπική | Παρουσία σύμπλεγμα ανακατεύθυνσης (FCI) | Αναπαραγωγή αποκατάστασης τοποθεσίας με τοπική αντικριστά | Αναπαραγωγή αποκατάστασης τοποθεσίας με τοπική αντικριστά
 | Για μεγάλες επιχειρήσεις ή τυπική | Μεμονωμένη | Αναπαραγωγή αποκατάστασης τοποθεσίας | Αναπαραγωγή αποκατάστασης τοποθεσίας
SQL Server 2008 R2 | Για μεγάλες επιχειρήσεις ή τυπική | Παρουσία σύμπλεγμα ανακατεύθυνσης (FCI) | Αναπαραγωγή αποκατάστασης τοποθεσίας με τοπική αντικριστά | Αναπαραγωγή αποκατάστασης τοποθεσίας με τοπική αντικριστά
 | Για μεγάλες επιχειρήσεις ή τυπική | Μεμονωμένη | Αναπαραγωγή αποκατάστασης τοποθεσίας | Αναπαραγωγή αποκατάστασης τοποθεσίας
SQL Server (οποιαδήποτε έκδοση) | Για μεγάλες επιχειρήσεις ή τυπική | Ανακατεύθυνση συμπλέγματος παρουσία - DTC εφαρμογής | Αναπαραγωγή αποκατάστασης τοποθεσίας | Δεν υποστηρίζεται


## <a name="deployment-prerequisites"></a>Προαπαιτούμενα ανάπτυξης

Εδώ είναι ό, τι χρειάζεστε πριν να ξεκινήσετε:

- Μια ανάπτυξη εσωτερικής εγκατάστασης SQL Server εκτελεί μια υποστηριζόμενη έκδοση του SQL Server. Συνήθως θα χρειαστεί επίσης μια υπηρεσία καταλόγου Active Directory για τον SQL server.
- Τις προϋποθέσεις για το σενάριο που θέλετε να αναπτύξετε. Μπορείτε να βρείτε τις προϋποθέσεις σε κάθε άρθρο ανάπτυξης. Συνδέσεις σε αυτά παρέχονται στην [Επισκόπηση αποκατάστασης τοποθεσίας](site-recovery-overview.md).
- Εάν θέλετε να ρυθμίσετε αποκατάστασης στο Azure, θα πρέπει να εκτελέσετε το εργαλείο [Αξιολόγηση ετοιμότητας εικονική μηχανή Azure](http://www.microsoft.com/download/details.aspx?id=40898) σε σας εικονικές μηχανές του SQL Server για να βεβαιωθείτε ότι είναι συμβατά με το Azure και Επαναφορά τοποθεσίας.


## <a name="set-up-active-directory"></a>Ρύθμιση υπηρεσίας καταλόγου Active Directory

Θα χρειαστεί υπηρεσίας καταλόγου Active Directory στην τοποθεσία δευτερεύοντα ανάκτησης για τον SQL Server για να εκτελέσετε σωστά. Υπάρχουν δύο επιλογές:

- **Μικρή επιχείρηση**— εάν έχετε ένα μικρό αριθμό των εφαρμογών και έναν μεμονωμένο ελεγκτή τομέα για την τοποθεσία εσωτερικής εγκατάστασης και θέλετε να γίνει ανακατεύθυνση ολόκληρη την τοποθεσία, συνιστάται να χρησιμοποιήσετε repication Επαναφορά τοποθεσίας για την αναπαραγωγή του ελεγκτή τομέα με το κέντρο δεδομένων δευτερεύοντα ή για να Azure.

- **Μεσαίο σε μεγάλο enterprise**— εάν έχετε ένα μεγάλο αριθμό της εφαρμογής, χρησιμοποιείτε ένα σύμπλεγμα δομών της υπηρεσίας καταλόγου Active Directory και θέλετε να αποτύχει από την αρχή εφαρμογής ή φόρτο εργασίας, συνιστάται να ρυθμίσετε ενός πρόσθετου ελεγκτή τομέα στο δευτερεύον κέντρο δεδομένων ή στο Azure. Λάβετε υπόψη ότι εάν χρησιμοποιείτε ομάδες διαθεσιμότητας AlwaysOn για να ανακτήσετε μια απομακρυσμένη τοποθεσία συνιστούμε να ρυθμίσετε μια άλλη πρόσθετου ελεγκτή τομέα στη δευτερεύουσα τοποθεσία ή Azure, για να χρησιμοποιήσετε για τα ανακτημένα παρουσία του SQL Server.

Τις οδηγίες σε αυτό το έγγραφο που λαμβάνουν ως δεδομένο ότι ελεγκτή τομέα είναι διαθέσιμο στη δευτερεύουσα θέση. [Διαβάστε περισσότερα](site-recovery-active-directory.md) σχετικά με την προστασία της υπηρεσίας καταλόγου Active Directory με Επαναφορά τοποθεσίας.

## <a name="integrate-protection-with-sql-server-always-on-on-premises-to-azure"></a>Ενοποίηση προστασία με Always-On SQL Server (εσωτερικής εγκατάστασης για να Azure)


Επαναφορά τοποθεσίας υποστηρίζει εγγενώς SQL AlwaysOn. Εάν έχετε δημιουργήσει μια ομάδα διαθεσιμότητα SQL με μια Azure εικονική μηχανή ρύθμιση ως 'Δευτερεύον', στη συνέχεια, μπορείτε να χρησιμοποιήσετε Επαναφορά τοποθεσίας για τη διαχείριση του εφεδρικού των ομάδων διαθεσιμότητα. 

>[AZURE.NOTE] Αυτή η δυνατότητα είναι αυτήν τη στιγμή σε προεπισκόπηση και διαθέσιμο όταν γίνεται Hyper-V κεντρικούς διακομιστές στο κύριο κέντρο δεδομένων σε σύννεφων VMM και όταν VMware ρύθμισης γίνεται από ένα [Διακομιστή ρύθμισης παραμέτρων](site-recovery-vmware-to-azure.md#configuration-server-prerequisites). Δεξιά τώρα αυτή η δυνατότητα δεν είναι διαθέσιμη στην πύλη του νέου Azure.

#### <a name="prerequisites"></a>Προαπαιτούμενα στοιχεία

Ακολουθεί τι χρειάζεστε για να ενσωματώσετε SQL AlwaysOn με Επαναφορά τοποθεσίας:

- Μια εσωτερική SQL Server (διακομιστής μεμονωμένη ή ένα σύμπλεγμα ανακατεύθυνσης).
- Ένα ή περισσότερα Azure εικονικές μηχανές με εγκατεστημένο το SQL Server
- Ρύθμιση μιας ομάδας διαθεσιμότητα SQL μεταξύ μιας εσωτερικής εγκατάστασης SQL Server και SQL Server που εκτελείται στο Azure
- Θα πρέπει να είναι ενεργοποιημένη PowerShell απομακρυσμένης πρόσβασης στον υπολογιστή SQL Server εσωτερικής εγκατάστασης. Ο διακομιστής VMM ή ο διακομιστής ρύθμισης παραμέτρων πρέπει να μπορείτε να κάνετε απομακρυσμένο PowerShell κλήσεις με τον SQL Server.
- Ένα λογαριασμό χρήστη πρέπει να προστεθεί στον SQL Server εσωτερικής εγκατάστασης, σε αυτές τις ομάδες χρηστών SQL με τουλάχιστον τα δικαιώματα:
    - ΤΡΟΠΟΠΟΊΗΣΗ ΟΜΆΔΑΣ ΔΙΑΘΕΣΙΜΌΤΗΤΑΣ: δικαιώματα [εδώ](https://msdn.microsoft.com/library/hh231018.aspx)και [εδώ](https://msdn.microsoft.com/library/ff878601.aspx#Anchor_3)
    - Η πρόταση ALTER βάσης ΔΕΔΟΜΈΝΩΝ - δικαιώματα[εδώ](https://msdn.microsoft.com/library/ff877956.aspx#Security)
- Θα πρέπει να δημιουργηθεί ένα λογαριασμό RunAs σε διακομιστή VMM ή θα πρέπει να δημιουργηθεί ένα λογαριασμό στο διακομιστή ρύθμισης παραμέτρων, χρησιμοποιώντας το CSPSConfigtool.exe για το χρήστη που αναφέρεται στο προηγούμενο βήμα 
- Πρέπει να εγκατασταθούν τη λειτουργική μονάδα SQL PS σε διακομιστές SQL που εκτελούν εσωτερικής εγκατάστασης και, στη Azure εικονικές μηχανές
- Ο παράγοντας Εικονική πρέπει να είναι εγκατεστημένο εικονικές μηχανές εκτελούνται στο Azure
- NTAUTHORITY\System θα πρέπει να έχετε ακολουθώντας δικαιώματα στον SQL Server που εκτελείται σε εικονικές μηχανές στο Azure:
    - ΤΡΟΠΟΠΟΊΗΣΗ ΟΜΆΔΑΣ ΔΙΑΘΕΣΙΜΌΤΗΤΑΣ - δικαιώματα [εδώ](https://msdn.microsoft.com/library/hh231018.aspx)και [εδώ](https://msdn.microsoft.com/library/ff878601.aspx#Anchor_3)
    - Η πρόταση ALTER βάσης ΔΕΔΟΜΈΝΩΝ - δικαιώματα [εδώ](https://msdn.microsoft.com/library/ff877956.aspx#Security)

####  <a name="step-1-add-a-sql-server"></a>Βήμα 1: Προσθήκη SQL Server


1. Κάντε κλικ στην επιλογή **Προσθήκη SQL** για να προσθέσετε μια νέα SQL Server. 

    ![Προσθήκη SQL](./media/site-recovery-sql/add-sql.png)

2. Στη **Διαμόρφωση παραμέτρων ρυθμίσεων SQL** > **όνομα** παρέχουν ένα φιλικό όνομα για αναφορά για τον SQL Server.
3. **Στο SQL Server (FQDN)** Καθορίστε το FQDN του SQL Server που θέλετε να προσθέσετε αρχείου προέλευσης. Σε περίπτωση που το SQL Server είναι εγκατεστημένος σε ένα σύμπλεγμα ανακατεύθυνσης, στη συνέχεια, καταχωρήστε FQDN του συμπλέγματος και όχι από οποιονδήποτε από τους κόμβους συμπλέγματος.  
4. Στην **Παρουσία του SQL Server** επιλέξτε την παρουσία του προεπιλεγμένου ή πληκτρολογήστε το όνομα της προσαρμοσμένης παρουσίας.
5. Στο **Διακομιστή διαχείρισης** , επιλέξτε ένα διακομιστή VMM ή ρύθμισης παραμέτρων διακομιστή καταχωρηθεί στον το θάλαμο Επαναφορά τοποθεσίας. Επαναφορά τοποθεσίας χρησιμοποιεί αυτόν το διακομιστή διαχείρισης για να επικοινωνήσετε με τον SQL Server.
6. Πληκτρολογήστε το όνομα του λογαριασμού RunAs που δημιουργήθηκε στον καθορισμένο διακομιστή VMM ή το λογαριασμό που έχει δημιουργηθεί στο διακομιστή Configuraaaon στις **εκτελείται ως λογαριασμός** . Αυτός ο λογαριασμός χρησιμοποιείται για να αποκτήσετε πρόσβαση στον SQL Server και θα πρέπει να έχετε δικαιώματα ανάγνωσης και ανακατεύθυνσης διαθεσιμότητα ομάδες στον υπολογιστή SQL Server.

    ![Παράθυρο διαλόγου SQL προσθήκης](./media/site-recovery-sql/add-sql-dialog.png)

Αφού προσθέσετε τον SQL Server θα εμφανίζεται στην καρτέλα **Διακομιστές SQL** . 

![Λίστα SQL Server](./media/site-recovery-sql/sql-server-list.png)


#### <a name="step-2-add-a-sql-availability-group"></a>Βήμα 2: Προσθήκη σε ομάδα διαθεσιμότητα SQL

1. Μετά από τον SQL Server μηχανικής προστίθεται το επόμενο βήμα είναι να προσθέσετε τη διαθεσιμότητα των ομάδων στις Επαναφορά τοποθεσίας. Για να το κάνετε, Διερεύνηση εντός του SQL Server που προστέθηκαν στο προηγούμενο βήμα και κάντε κλικ στην εντολή Προσθήκη ομάδας διαθεσιμότητας SQL. 

    ![Προσθήκη SQL AG](./media/site-recovery-sql/add-sqlag.png)

2. Ομάδα διαθεσιμότητα SQL μπορεί να αναπαραγωγή σε μία ή περισσότερες εικονικές μηχανές στο Azure. Προσθήκη κατά ομάδα διαθεσιμότητα sql, πρέπει να παρέχετε το όνομα και τη συνδρομή του Azure εικονικές υπολογιστή όπου θέλετε να είναι απέτυχε επάνω από Επαναφορά τοποθεσίας την ομάδα διαθεσιμότητα.

    ![Παράθυρο διαλόγου SQL AG προσθήκης](./media/site-recovery-sql/add-sqlag-dialog.png)

3. Στο παραπάνω παράδειγμα, καθίσταται διαθεσιμότητα ομάδα Φθίνουσα 1-AG πρωτεύοντος στην εικονική μηχανή SQLAGVM2 εκτελούνται μέσα σε συνδρομή DevTesting2 στο ανακατεύθυνσης. 

>[AZURE.NOTE] Μόνο διαθεσιμότητα που είναι κύρια στον SQL Server που προσθέσατε στο βήμα παραπάνω είναι διαθέσιμες οι ομάδες για να προστεθεί Επαναφορά τοποθεσίας. Εάν έχετε κάνει μια κύρια ομάδα διαθεσιμότητα στον SQL Server ή εάν έχετε προσθέσει περισσότερες ομάδες διαθεσιμότητα στον SQL Server μετά την προσθήκη της, να την ανανεώσετε χρησιμοποιώντας την επιλογή ανανέωσης διαθέσιμο στον SQL Server.

#### <a name="step-3-create-a-recovery-plan"></a>Βήμα 3: Δημιουργία σχεδίου αποκατάστασης

Το επόμενο βήμα είναι να δημιουργήσετε σχεδίου αποκατάστασης χρησιμοποιώντας εικονικές μηχανές και τη διαθεσιμότητα των ομάδων. Επιλέξτε το ίδιο διακομιστή VMM ή ρύθμισης παραμέτρων διακομιστή που χρησιμοποιήσατε στο βήμα 1 ως προέλευσης και Microsoft Azure ως προορισμού.

![Δημιουργία σχεδίου ανάκτησης](./media/site-recovery-sql/create-rp1.png)

![Δημιουργία σχεδίου ανάκτησης](./media/site-recovery-sql/create-rp2.png)

Στο παράδειγμα της εφαρμογής Sharepoint αποτελείται από 3 εικονικές μηχανές που χρησιμοποιεί μια ομάδα διαθεσιμότητα SQL ως το παρασκηνίου. Σε αυτό το πρόγραμμα αποκατάστασης θα σας θα μπορούσε να επιλέξτε τόσο τη διαθεσιμότητα ομάδας, καθώς και η εικονική μηχανή που να αποτελούν την εφαρμογή. 

Μπορείτε να προσαρμόσετε περαιτέρω το πρόγραμμα ανάκτησης, μετακινώντας εικονικές μηχανές σε ομάδες διαφορετικό ανακατεύθυνσης για την ακολουθία της σειράς των ανακατεύθυνσης. Διαθεσιμότητα ομάδας είναι πάντα απέτυχε επάνω από την πρώτη που θα χρησιμοποιηθεί ως έναν υπολογιστή στο παρασκήνιο οποιασδήποτε εφαρμογής του. 

![Προσαρμογή σχεδίου αποκατάστασης](./media/site-recovery-sql/customize-rp.png)

### <a name="step-4--fail-over"></a>Βήμα 4: Ανακατευθύνει

Επιλογές διαφορετικό ανακατεύθυνσης είναι διαθέσιμες όταν μια ομάδα διαθεσιμότητα έχει προστεθεί σε ένα πρόγραμμα αποκατάστασης.

Ανακατεύθυνση | Λεπτομέρειες
--- | ---
**Προγραμματισμένη ανακατεύθυνσης** | Προγραμματισμένη ανακατεύθυνσης σημαίνει χωρίς ανακατεύθυνσης απώλεια δεδομένων. Για να επιτύχετε ότι λειτουργία διαθεσιμότητα ομάδας διαθεσιμότητας SQL πρώτα έχει οριστεί σε σύγχρονη και, στη συνέχεια, ενεργοποιηθεί ανακατεύθυνσης για να κάνετε την ομάδα διαθεσιμότητα κύρια με το εικονικό μηχάνημα που παρέχονται κατά την προσθήκη στην ομάδα διαθεσιμότητα Επαναφορά τοποθεσίας. Μόλις ολοκληρωθεί η ανακατεύθυνση, διαθεσιμότητα λειτουργία έχει οριστεί σε την ίδια τιμή, όπως ήταν πριν από την προγραμματισμένη ανακατεύθυνσης ενεργοποιήθηκε.
**Μη προγραμματισμένη ανακατεύθυνσης** | Μη προγραμματισμένη ανακατεύθυνσης μπορεί να οδηγήσει σε απώλεια δεδομένων. Κατά την ενεργοποίηση μη προγραμματισμένη ανακατεύθυνσης δεν αλλάζει τη λειτουργία διαθεσιμότητα της διαθεσιμότητας ομάδας και το αυτό γίνεται πρωτεύοντος με την εικονική μηχανή που παρέχονται κατά την προσθήκη στην ομάδα διαθεσιμότητα Επαναφορά τοποθεσίας. Αφού ολοκληρωθεί μη προγραμματισμένη ανακατεύθυνσης και εσωτερικής εκτελεί τον SQL Server είναι διαθέσιμος ο διακομιστής ξανά, αντίστροφη αναπαραγωγή έχει ενεργοποιηθεί κατά την ομάδα διαθεσιμότητα. Σημειώστε ότι αυτή η ενέργεια δεν είναι διαθέσιμη στο σχέδιο αποκατάστασης και μπορούν να ληφθούν στην ομάδα διαθεσιμότητα SQL στην καρτέλα διακομιστές SQL
**Δοκιμή ανακατεύθυνσης** | Δοκιμή ανακατεύθυνσης για την ομάδα διαθεσιμότητα SQL δεν υποστηρίζεται. Εάν έναυσμα δοκιμής ανακατεύθυνσης από ένα πρόγραμμα αποκατάστασης που περιέχει SQL διαθεσιμότητα ομάδας, θα παραλείπεται ανακατεύθυνσης για την ομάδα διαθεσιμότητα.


Λάβετε υπόψη αυτές τις επιλογές ανακατεύθυνσης.

Επιλογή | Λεπτομέρειες
--- | ---
**Επιλογή 1** | 1. Εκτελέστε ανακατεύθυνσης δοκιμή της εφαρμογής και του προσκηνίου βαθμίδες.<br/><br/>2. ενημερώστε το επίπεδο εφαρμογής για να αποκτήσετε πρόσβαση στο αντίγραφο ρεπλίκα σε λειτουργία μόνο για ανάγνωση και εκτελέστε μια δοκιμαστική μόνο για ανάγνωση της εφαρμογής.
**Επιλογή 2** | 1. Δημιουργήστε ένα αντίγραφο της παρουσίας εικονική μηχανή ρεπλίκα SQL Server (χρήση κλωνοποίηση VMM για--τοποθεσίας ή του Azure δημιουργίας αντιγράφων ασφαλείας) και να την ανοίξετε σε ένα δίκτυο δοκιμής<br/><br/> 2. Εκτελέστε την ανακατεύθυνση δοκιμής χρησιμοποιώντας το πρόγραμμα αποκατάστασης.

Βήμα 5: Αποτύχει ξανά

Εάν θέλετε να κάνετε τη διαθεσιμότητα ομάδα ξανά πρωτεύοντος στον SQL Server εσωτερικής εγκατάστασης, στη συνέχεια, μπορείτε να το κάνετε ενεργοποίηση προγραμματισμένη ανακατεύθυνσης στην το πεδίο σχέδιο αποκατάστασης και επιλέγοντας την κατεύθυνση από το Microsoft Azure διακομιστή VMM εσωτερικής εγκατάστασης.

>[AZURE.NOTE] Μετά από μια μη προγραμματισμένη ανακατεύθυνσης αντίστροφη αναπαραγωγή έχει ενεργοποιηθεί κατά την ομάδα διαθεσιμότητας για να συνεχίσετε την αναπαραγωγή. Έως ότου αυτό γίνεται η αναπαραγωγή παραμένει σε αναστολή.



### <a name="protect-machines-without-a-vmm-server-or-a-configuration-server"></a>Προστασία μηχανές χωρίς διακομιστή VMM ή σε ένα διακομιστή ρύθμισης παραμέτρων

Για τα περιβάλλοντα που δεν πραγματοποιείται από ένα διακομιστή VMM ή σε ένα διακομιστή ρύθμισης παραμέτρων, Azure αυτοματισμού Runbooks μπορεί να χρησιμοποιηθεί για τη ρύθμιση παραμέτρων μιας δέσμης ενεργειών ανακατεύθυνσης των ομάδων διαθεσιμότητα SQL. Ακολουθούν τα βήματα για να ρυθμίσετε τις παραμέτρους που:

1.  Δημιουργήστε ένα τοπικό αρχείο για τη δέσμη ενεργειών αποτυχία επάνω από μια ομάδα διαθεσιμότητα. Το δείγμα δέσμης ενεργειών καθορίζει μια διαδρομή για την ομάδα διαθεσιμότητα στη ρεπλίκα Azure και αποτυγχάνει επάνω σε αυτήν την παρουσία αντιγράφου. Αυτή η δέσμη ενεργειών θα εκτελεστεί στον SQL Server ρεπλίκα εικονική μηχανή, μεταφέροντας είναι με την επέκταση προσαρμοσμένων δεσμών ενεργειών.

        Param(
        [string]$SQLAvailabilityGroupPath
        )
        import-module sqlps
        Switch-SqlAvailabilityGroup -Path $SQLAvailabilityGroupPath -AllowDataLoss -force

2.  Στείλτε τη δέσμη ενεργειών σε ένα αντικείμενο blob σε ένα λογαριασμό Azure χώρου αποθήκευσης. Χρησιμοποιήστε αυτό το παράδειγμα:

        $context = New-AzureStorageContext -StorageAccountName "Account" -StorageAccountKey "Key"
        Set-AzureStorageBlobContent -Blob "AGFailover.ps1" -Container "script-container" -File "ScriptLocalFilePath" -context $context

3.  Δημιουργήστε ένα Azure αυτοματισμού runbook για να καλέσετε τις δέσμες ενεργειών στον υπολογιστή εικονικές ρεπλίκα SQL Server στο Azure. Χρησιμοποιήστε αυτήν τη δέσμη ενεργειών δείγμα να το κάνετε αυτό. [Μάθετε περισσότερα](site-recovery-runbook-automation.md) σχετικά με τη χρήση runbooks αυτοματισμού σχέδια ανάκτησης. 

        workflow SQLAvailabilityGroupFailover
        {
            param (
                [Object]$RecoveryPlanContext
            )

            $Cred = Get-AutomationPSCredential -name 'AzureCredential'
    
            #Connect to Azure
            $AzureAccount = Add-AzureAccount -Credential $Cred
            $AzureSubscriptionName = Get-AutomationVariable –Name ‘AzureSubscriptionName’
            Select-AzureSubscription -SubscriptionName $AzureSubscriptionName
    
            InLineScript
            {
            #Update the script with name of your storage account, key and blob name
            $context = New-AzureStorageContext -StorageAccountName "Account" -StorageAccountKey "Key";
            $sasuri = New-AzureStorageBlobSASToken -Container "script-container"- Blob "AGFailover.ps1" -Permission r -FullUri -Context $context;
     
            Write-output "failovertype " + $Using:RecoveryPlanContext.FailoverType;
               
            if ($Using:RecoveryPlanContext.FailoverType -eq "Test")
                {
                #Skipping TFO in this version.
                #We will update the script in a follow-up post with TFO support
                Write-output "tfo: Skipping SQL Failover";
                }
            else
                {
                Write-output "pfo/ufo";
                #Get the SQL Azure Replica VM.
                #Update the script to use the name of your VM and Cloud Service
                $VM = Get-AzureVM -Name "SQLAzureVM" -ServiceName "SQLAzureReplica";     
       
                Write-Output "Installing custom script extension"
                #Install the Custom Script Extension on teh SQL Replica VM
                Set-AzureVMExtension -ExtensionName CustomScriptExtension -VM $VM -Publisher Microsoft.Compute -Version 1.3| Update-AzureVM; 
                    
                Write-output "Starting AG Failover";
                #Execute the SQL Failover script
                #Pass the SQL AG path as the argument.
       
                $AGArgs="-SQLAvailabilityGroupPath sqlserver:\sql\sqlazureVM\default\availabilitygroups\testag";
       
                Set-AzureVMCustomScriptExtension -VM $VM -FileUri $sasuri -Run "AGFailover.ps1" -Argument $AGArgs | Update-AzureVM;
       
                Write-output "Completed AG Failover";

                }
        
            }
        }

4.  Κατά τη δημιουργία σχεδίου αποκατάστασης για την εφαρμογή προσθέστε ένα βήμα δέσμες ενεργειών προ-"ομαδοποίηση 1 εκκίνησης" που καλεί runbook αυτοματισμού να ανακατευθύνει διαθεσιμότητα ομάδες.

## <a name="integrate-protection-with-sql-alwayson-on-premises-to-on-premises"></a>Ενοποίηση προστασία με AlwaysOn SQL (εσωτερικής εγκατάστασης στην εσωτερική εγκατάσταση)

Εάν ο SQL Server χρησιμοποιεί ομάδες διαθεσιμότητα για υψηλή διαθεσιμότητα ή μια παρουσία σύμπλεγμα ανακατεύθυνσης, συνιστάται να χρησιμοποιείτε ομάδες διαθεσιμότητας στην τοποθεσία αποκατάστασης. Σημειώστε ότι αυτές οι οδηγίες για τις εφαρμογές που δεν χρησιμοποιείτε κατανεμημένες συναλλαγές.

1. [Ρύθμιση παραμέτρων βάσεων δεδομένων](https://msdn.microsoft.com/library/hh213078.aspx) σε ομάδες διαθεσιμότητας.
2. Δημιουργήστε ένα νέο εικονικό δίκτυο σε δευτερεύουσα τοποθεσία.
3. Ρύθμιση τοποθεσίας σε τοποθεσία VPN μεταξύ το νέο δίκτυο εικονικού και την κύρια τοποθεσία.
4. Δημιουργήστε μια εικονική μηχανή στην τοποθεσία αποκατάστασης και να εγκαταστήσετε τον SQL Server σε αυτό.
5. Επέκταση τις υπάρχουσες ομάδες διαθεσιμότητας AlwaysOn για να η νέα εικονική μηχανή SQL Server. Ρύθμιση παραμέτρων αυτό παρουσία του SQL Server ως αντιγράφου ασύγχρονης αντιγράφου.
6. Δημιουργία μιας υπηρεσίας ακρόασης διαθεσιμότητα ομάδας ή ενημερώστε την υπάρχουσα υπηρεσία ακρόασης για να συμπεριλάβετε την εικονική μηχανή ασύγχρονης αντιγράφου.
7. Βεβαιωθείτε ότι τη συστοιχία εφαρμογής είναι το πρόγραμμα εγκατάστασης χρησιμοποιώντας το ακροατήριο. Εάν είναι το πρόγραμμα εγκατάστασης χρησιμοποιώντας το όνομα του διακομιστή βάσης δεδομένων, ενημερώστε ώστε να χρησιμοποιεί το ακροατήριο, οπότε δεν χρειάζεται να ρυθμίσει ξανά τις παραμέτρους του μετά την ανακατεύθυνση.

Για εφαρμογές που χρησιμοποιούν κατανεμημένες συναλλαγές μας σύσταση χρησιμοποιείτε [Επαναφορά τοποθεσίας με την αναπαραγωγή ΣΑΝ](site-recovery-vmm-san.md) ή [VMWare/φυσικά διακομιστή τοποθεσίας σε τοποθεσία αναπαραγωγής](site-recovery-vmware-to-vmware.md).

### <a name="recovery-plan-considerations"></a>Ζητήματα πρόγραμμα ανάκτησης

1. Προσθέστε αυτήν τη δέσμη ενεργειών δείγμα στη βιβλιοθήκη VMM στις κύριες και δευτερεύουσες τοποθεσίες.

        Param(
        [string]$SQLAvailabilityGroupPath
        )
        import-module sqlps
        Switch-SqlAvailabilityGroup -Path $SQLAvailabilityGroupPath -AllowDataLoss -force

2. Όταν δημιουργείτε ένα σχέδιο ανάκτησης για την εφαρμογή προσθέστε ένα βήμα δέσμες ενεργειών προ-"ομαδοποίηση 1 εκκίνησης" που ενεργοποιεί τη δέσμη ενεργειών να ανακατευθύνει διαθεσιμότητα ομάδες.



## <a name="protect-a-standalone-sql-server"></a>Προστασία αυτόνομης υπηρεσίας SQL Server

Σε αυτήν τη ρύθμιση συνιστάται να χρησιμοποιείτε την αναπαραγωγή Επαναφορά τοποθεσίας για να προστατεύσετε τον υπολογιστή SQL Server. Τα ακριβή βήματα εξαρτάται εάν SQL Server έχει ρυθμιστεί ως εικονική μηχανή ή φυσικό διακομιστή, και εάν θέλετε να αναπαραγάγετε σε Azure ή δευτερεύον εσωτερικής τοποθεσίας. Λάβετε οδηγίες για όλα τα σενάρια ανάπτυξης στην [Επισκόπηση αποκατάστασης τοποθεσίας](site-recovery-overview.md).


## <a name="protect-a-sql-server-cluster-standard-or-2008-r2"></a>Προστασία ένα σύμπλεγμα SQL Server (τυπικά ή 2008 R2)

Για ένα σύμπλεγμα που εκτελεί SQL Server Standard edition ή SQL Server 2008 R2 συνιστάται να χρησιμοποιείτε την αναπαραγωγή Επαναφορά τοποθεσίας για την προστασία του SQL Server.

### <a name="on-premises-to-on-premises"></a>Εσωτερικής εγκατάστασης στην εσωτερική εγκατάσταση

- Εάν η εφαρμογή χρησιμοποιεί κατανεμημένες συναλλαγές συνιστάται να αναπτύξετε [Επαναφορά τοποθεσίας με ΣΑΝ αναπαραγωγής](site-recovery-vmm-san.md) για ένα περιβάλλον Hyper-V και [VMware/φυσικά διακομιστή σε VMware](site-recovery-vmware-to-vmware.md) για το περιβάλλον VMware.

- Για μη DTC εφαρμογές, αξιοποιήσετε η παραπάνω προσέγγιση για την ανάκτηση του συμπλέγματος ως μεμονωμένο διακομιστή, χρησιμοποιώντας μια τοπική υψηλή ασφάλεια αντικριστά DB.

### <a name="on-premises-to-azure"></a>Εσωτερικής εγκατάστασης για να Azure

Επαναφορά τοποθεσίας δεν υποστηρίζει υποστήριξη συμπλέγματος επισκέπτη όταν αναπαράγονται σε Azure. SQL Server δεν παρέχουν επίσης μια λύση αποκατάστασης από καταστροφή χαμηλού κόστους για Standard edition. Συνιστάται να προστατεύσετε το σύμπλεγμα SQL Server εσωτερικής εγκατάστασης σε μια μεμονωμένη SQL Server και το ανακτήσετε στο Azure.


1. Ρύθμιση παραμέτρων μια παρουσία του SQL Server επιπλέον μεμονωμένη στην τοποθεσία εσωτερικής εγκατάστασης.
2. Ρύθμιση παραμέτρων αυτήν την παρουσία για να λειτουργήσει ως ειδώλου για τις βάσεις δεδομένων που χρειάζεστε προστασία. Ρυθμίστε τις παραμέτρους του κατοπτρισμού στη λειτουργία υψηλής ασφάλειας.
3.  Ρύθμιση παραμέτρων Επαναφορά τοποθεσίας στην τοποθεσία εσωτερικής εγκατάστασης με βάση το περιβάλλον ([Hyper-V](site-recovery-hyper-v-site-to-azure.md) ή [VMware/φυσικά διακομιστή](site-recovery-vmware-to-azure-classic.md).
4.  Χρησιμοποιήστε αναπαραγωγής Επαναφορά τοποθεσίας να αναπαραγάγετε τη νέα παρουσία του SQL Server για Azure. Είναι ένα αντίγραφο αντικριστά υψηλή ασφάλεια και επομένως αυτό θα συγχρονιστεί με το πρωτεύον σύμπλεγμα, αλλά αυτό θα να αναπαραχθούν σε Azure χρησιμοποιώντας αναπαραγωγής Επαναφορά τοποθεσίας.

Το ακόλουθο γραφικό δείχνει αυτό το πρόγραμμα εγκατάστασης.

![Τυπική συμπλέγματος](./media/site-recovery-sql/BCDRStandaloneClusterLocal.png)


### <a name="failback-considerations"></a>Αποκατάσταση μετά από ζητήματα

Για τυπικές συμπλεγμάτων SQL, αποκατάσταση μετά από μετά από μια μη προγραμματισμένη ανακατεύθυνσης θα απαιτούν ένα αντίγραφο ασφαλείας SQL και επαναφορά από στην παρουσία ειδώλου για το αρχικό σύμπλεγμα και αποκατάσταση ειδώλου.

## <a name="next-steps"></a>Επόμενα βήματα
[Μάθετε περισσότερα](site-recovery-best-practices.md) σχετικά με τη λήψη έτοιμοι να αναπτύξετε Επαναφορά τοποθεσίας.










 